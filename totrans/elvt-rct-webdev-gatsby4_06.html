<html><head></head><body>
		<div id="_idContainer028">
			<h1 id="_idParaDest-79"><em class="italic"><a id="_idTextAnchor080"/>Chapter 5</em>: Working with Images</h1>
			<p>In this chapter, you will master the art of adding images to your Gatsby site. First, we will learn a little about the history of images on the web, before understanding why importing images is not as easy you might think. We will then move on to creating images that progressively load in and are performant.</p>
			<p>In this chapter, we will cover the following topics:</p>
			<ul>
				<li>Images on the web</li>
				<li>The <strong class="source-inline">StaticImage</strong> component</li>
				<li>The <strong class="source-inline">GatsbyImage</strong> component</li>
				<li>Overriding the <strong class="source-inline">gatsby-plugin-image</strong> defaults</li>
				<li>Sourcing images from CMS</li>
			</ul>
			<h1 id="_idParaDest-80"><a id="_idTextAnchor081"/>Technical requirements</h1>
			<p>To complete this chapter, you will need to have completed <a href="B15983_03_ePub_RK.xhtml#_idTextAnchor057"><em class="italic">Chapter 3</em></a>, <em class="italic">Sourcing and Querying Data (from Anywhere!)</em>. </p>
			<p>The code for this chapter can be found at <a href="https://github.com/PacktPublishing/Elevating-React-Web-Development-with-Gatsby-4/tree/main/Chapter05">https://github.com/PacktPublishing/Elevating-React-Web-Development-with-Gatsby-4/tree/main/Chapter05</a>.</p>
			<h1 id="_idParaDest-81"><a id="_idTextAnchor082"/>Images on the web</h1>
			<p>When was the last time you visited a website without any images? You might be thinking that this is a hard question to answer. Images are a critical part of websites and our browsing experience. We use images<a id="_idIndexMarker302"/> for logos, products, profiles, and marketing to convey information, entice, or excite through a visual medium. While images are great for these use cases (and many more!), they are the single largest contributor to page size. According to the <a id="_idIndexMarker303"/>HTTP Archive (<a href="https://httparchive.org/">https://httparchive.org/</a>), the median page size on desktops is 2,124 KB. Images make up 973 KB of this size, which is roughly 45% of the total page size.</p>
			<p>As images<a id="_idIndexMarker304"/> are so integral to our browsing experience, we cannot do away with them. But when they account for so much of the page size, we should be doing everything in our power to ensure that they are optimized, accessible, and as performant as possible. Newer versions of browsers (including Chrome) have <strong class="bold">responsive image</strong> capabilities <a id="_idIndexMarker305"/>built into them. Instead of providing a single source for the image, the browser can accept a source set. The browser uses this set to load an image at a different size, depending on the size of the device. This ensures the browser never loads images that are too big for the space available. Another way in which developers can optimize images, specifically in React, is with <strong class="bold">lazy loading</strong>. Lazy loading<a id="_idIndexMarker306"/> is the process of deferring the load of your images until a later point in time. This could be after the initial load, or when they specifically become visible on the screen. Using this technique, you can improve your site's speed, better utilize a device's resources, and reduce a user's data consumption.</p>
			<h2 id="_idParaDest-82"><a id="_idTextAnchor083"/>Images in Gatsby</h2>
			<p>Manually creating <a id="_idIndexMarker307"/>high-performance sites that contain lazy-loaded images is a project in itself. Luckily, Gatsby has a plugin that takes the pain away when you're generating <a id="_idIndexMarker308"/>responsive, optimized images – <strong class="source-inline">gatsby-plugin-image</strong>.</p>
			<p>This plugin contains two React image components with specific features aimed at creating a better user experience when using images, both for the developer and the site visitor:</p>
			<ul>
				<li>Loads the correct image for the device viewing the site.</li>
				<li>Reduces cumulative layout shift by holding the position of the image while it is loading.</li>
				<li>Uses a lazy loading strategy to speed up the initial load time of your site.</li>
				<li>Has multiple options for placeholder images that appear while the image is loading. You can make the images blur up or use a traced <strong class="bold">Scalable Vector Graphics</strong> (<strong class="bold">SVG</strong>) of the<a id="_idIndexMarker309"/> image in its place. </li>
				<li>Supports new image formats such as <strong class="bold">WebP</strong> if<a id="_idIndexMarker310"/> the browser can support it.</li>
			</ul>
			<p>In the next section, we will begin looking at the first of the two image components in this chapter – the <strong class="source-inline">StaticImage</strong> component.</p>
			<h1 id="_idParaDest-83"><a id="_idTextAnchor084"/>The StaticImage component</h1>
			<p><strong class="source-inline">StaticImage</strong> is<a id="_idIndexMarker311"/> best used when an image will always remain the same. It could be your site logo, which is the same across all pages, or a profile photo that you use at the end of blog posts, or a home page hero section, or anywhere else where the image is not required to be dynamic. </p>
			<p>Unlike most React components, the <strong class="source-inline">StaticImage</strong> component has some limitations on how you can pass the props to it. It will not accept and use any of its parents' props. If you are looking for this functionality, you will want to use the <strong class="source-inline">GatsbyImage</strong> component.</p>
			<p>To get an understanding of how <a id="_idIndexMarker312"/>we utilize the <strong class="source-inline">StaticImage</strong> component, we will implement an image on the hero of our home page:</p>
			<ol>
				<li>Create an <strong class="source-inline">assets</strong> folder next to your <strong class="source-inline">src</strong> folder. To keep things organized, it is good practice to keep images away from your source code. We will use the <strong class="source-inline">assets</strong> folder to house any visual assets.</li>
				<li>Create a folder within <strong class="source-inline">assets</strong> called <strong class="source-inline">images</strong>. We will use this folder to store the visual assets of the <strong class="source-inline">image</strong> type.</li>
				<li>Add an image to your <strong class="source-inline">images</strong> folder. The image file type must be in <strong class="source-inline">.png</strong>, <strong class="source-inline">.jpg</strong>, <strong class="source-inline">.jpeg</strong>, <strong class="source-inline">.webp</strong>, or <strong class="source-inline">.avif</strong> format.</li>
				<li>Install <strong class="source-inline">gatsby-plugin-image</strong> and its dependencies:<p class="source-code">npm install gatsby-plugin-image gatsby-plugin-sharp</p><p class="source-code">gatsby-source-filesystem</p><p>These dependencies spawn other node processes and may take a little longer to install compared to our previous installs.</p></li>
				<li>Update your <strong class="source-inline">gatsby-config.js</strong> file so that it includes the three new dependencies:<p class="source-code">plugins: [</p><p class="source-code">    'gatsby-plugin-image',</p><p class="source-code">    'gatsby-plugin-sharp',</p><p class="source-code">    'gatsby-transformer-sharp',</p><p class="source-code">    // Other plugins</p><p class="source-code">],</p></li>
				<li>Import <a id="_idIndexMarker313"/>the <strong class="source-inline">StaticImage</strong> component into your <strong class="source-inline">index.js</strong> file:<p class="source-code">import { StaticImage } from "gatsby-plugin-image";</p></li>
				<li>Use the <strong class="source-inline">StaticImage</strong> component within the render on the page:<p class="source-code">&lt;StaticImage </p><p class="source-code">   src="../../assets/images/sample-photo.jpeg" </p><p class="source-code">/&gt;</p><p>The <strong class="source-inline">src</strong> prop should be the relative path to the image from the current file, <em class="italic">not</em> the root directory. </p></li>
				<li>Modify the image that's rendered via props:<p class="source-code">&lt;StaticImage</p><p class="source-code">    src="../../assets/images/sample-photo.jpeg"</p><p class="source-code">    alt="A man smiling"</p><p class="source-code">    placeholder="tracedSVG"</p><p class="source-code">    layout="fixed"</p><p class="source-code">    width={400}</p><p class="source-code">    height={600}</p><p class="source-code">/&gt;</p><p>Let's look at these props in detail:</p><ul><li><strong class="source-inline">src</strong>: This prop is the relative path to the image from the current file. </li><li><strong class="source-inline">alt</strong>: As you would with a normal <strong class="source-inline">img</strong> tag, be sure to include an <strong class="source-inline">alt</strong> prop with text describing the image so that your image remains accessible.</li><li><strong class="source-inline">Placeholder</strong>: This prop tells the component what to display while the image is loading. Here, we have set it to <strong class="source-inline">tracedSVG</strong>, which uses a placeholder SVG (created by tracing the image) to fill the gap where the image will load in, but also gives the user a sense of the shape of whatever is in the photo. Other options include <strong class="source-inline">blurred</strong>, <strong class="source-inline">dominantColor</strong>, and <strong class="source-inline">none</strong>.</li><li><strong class="source-inline">layout</strong>: This prop <a id="_idIndexMarker314"/>determines the size of images that are produced as the output by the plugin and their resizing. Here, we have set it to <strong class="source-inline">fixed</strong> – this suggests that the image will be at a consistent size when it renders. Other layout options include <strong class="source-inline">constrained</strong>, which takes a maximum height or width and can scale down, and <strong class="source-inline">fullWidth</strong>, which will also resize to fit the container but is not restricted to the maximum height or width.</li><li><strong class="source-inline">width</strong> and <strong class="source-inline">height</strong>: We can use these props to specify the width and height of the image.<p class="callout-heading">Tip</p><p class="callout"><strong class="source-inline">StaticImage</strong> can also take a remote source as its <strong class="source-inline">src</strong> prop. Any images that are specified as URLs will be downloaded at build time and then resized. Using remote images instead of local images is a great way to keep your repository small, but it should also be remembered that Gatsby does not know when that image changes if it is outside of your repository. If the image is changed on the remote server, it will only update when you rebuild your project.</p></li></ul></li>
			</ol>
			<p>Now that we understand how to utilize the <strong class="source-inline">StaticImage</strong> component, let's turn our attention to the other half of <strong class="source-inline">gatsby-plugin-image</strong> and learn about the <strong class="source-inline">GatsbyImage</strong> component.</p>
			<h1 id="_idParaDest-84"><a id="_idTextAnchor085"/>The GatsbyImage component</h1>
			<p>If ever you need to use dynamic images, such as those embedded in your Markdown content, then you can use the <strong class="source-inline">GatsbyImage</strong> component. </p>
			<p>Let's add hero images<a id="_idIndexMarker315"/> to our Markdown/MDX blog posts using the <strong class="source-inline">GatsbyImage</strong> component:</p>
			<ol>
				<li value="1">Install the <strong class="source-inline">gatsby-transformer-sharp</strong> npm package:<p class="source-code">npm install gatsby-transformer-sharp</p></li>
				<li>Add some images to <strong class="source-inline">assets/images</strong> that you would like to use as covers for your blog posts – one per blog post.</li>
				<li>Update your <strong class="source-inline">Gatsby-config.js</strong> file so that it includes your <strong class="source-inline">assets</strong> source:<p class="source-code">{</p><p class="source-code">      resolve: 'gatsby-source-filesystem',</p><p class="source-code">      options: {</p><p class="source-code">        path: '${__dirname}/assets/images',</p><p class="source-code">      },</p><p class="source-code"> },</p><p>Unlike <strong class="source-inline">StaticImage</strong>, <strong class="source-inline">GatsbyImage</strong> requires that images are ingested into our data layer. We can use the <strong class="source-inline">gatsby-source-filesystem</strong> plugin to achieve this, but by giving it the path to our images.</p></li>
				<li>For each blog post, modify the post file's <strong class="source-inline">frontmatter</strong> so that it includes a <strong class="source-inline">hero</strong> key that contains the relative path to the image:<p class="source-code">---</p><p class="source-code">type: Blog</p><p class="source-code">title: My First Hackathon Experience</p><p class="source-code">desc: This post is all about my learnings from my</p><p class="source-code"> first hackathon experience in London.</p><p class="source-code">date: 2020-06-20</p><p class="source-code"><strong class="bold">hero: ../../assets/images/cover-1.jpeg</strong></p><p class="source-code">tags: [hackathon, webdev, ux]</p><p class="source-code">---</p><p>Here, you can see an updated example of the <strong class="source-inline">placeholder</strong> Markdown with a <strong class="source-inline">hero</strong> key added. Be sure to replace the relative path in this example with the one to your image. </p></li>
				<li>Add<a id="_idIndexMarker316"/> the <strong class="source-inline">GatsbyImage</strong> component and the <strong class="source-inline">getImage</strong> function as imports, at the top of the <strong class="source-inline">src/templates/blog-page.js</strong> file:<p class="source-code">import { GatsbyImage, getImage } from "gatsby-plugin-</p><p class="source-code">image";</p></li>
				<li>Modify the file's page query to reference the new images:<p class="source-code">export const pageQuery = graphql'</p><p class="source-code">  query($slug: String!) {</p><p class="source-code">    blogpost: markdownRemark(fields: { slug: { eq:</p><p class="source-code">      $slug } }) {</p><p class="source-code">      frontmatter {</p><p class="source-code">        date</p><p class="source-code">        title</p><p class="source-code">        tags</p><p class="source-code">        <strong class="bold">hero {</strong></p><p class="source-code"><strong class="bold">          childImageSharp {</strong></p><p class="source-code"><strong class="bold">            gatsbyImageData(</strong></p><p class="source-code"><strong class="bold">              width: 600</strong></p><p class="source-code"><strong class="bold">              height: 400</strong></p><p class="source-code"><strong class="bold">              placeholder: BLURRED</strong></p><p class="source-code"><strong class="bold">            )</strong></p><p class="source-code"><strong class="bold">          }</strong></p><p class="source-code"><strong class="bold">        }</strong></p><p class="source-code">      }</p><p class="source-code">      html</p><p class="source-code">    }</p><p class="source-code">  }</p><p class="source-code">';</p><p>You may notice that the data that's passed to the <strong class="source-inline">gatsbyImageData</strong> function looks very similar to the props of the <strong class="source-inline">StaticImage</strong> component that we saw in <em class="italic">Step 8</em> of the previous section. In this instance, we are using the <strong class="source-inline">BLURRED</strong> placeholder for the image, which uses a blurred, lower-resolution version of the image in place of the original image while it is loading. We are now able to retrieve the <strong class="source-inline">hero</strong> data from the component as it is included in the page query.</p></li>
				<li>Use the new<a id="_idIndexMarker317"/> data within the <strong class="source-inline">data</strong> prop to get the image within the component:<p class="source-code">const {</p><p class="source-code">    blogpost: {</p><p class="source-code">      frontmatter: { date, tags, title, <strong class="bold">hero</strong> },</p><p class="source-code">      html,</p><p class="source-code">    },</p><p class="source-code">  } = data;</p><p class="source-code">  <strong class="bold">const heroImage = getImage(hero)</strong></p><p>First, retrieve <strong class="source-inline">hero</strong> from the <strong class="source-inline">data</strong> prop, and then use the <strong class="source-inline">getImage</strong> utility from <strong class="source-inline">gatsby-plugin-image</strong> to retrieve the image data that's required to render it and assign it to a <strong class="source-inline">const</strong>.</p></li>
				<li>Render your image within your <strong class="source-inline">return</strong> statement:<p class="source-code">&lt;GatsbyImage image={<strong class="bold">heroImage</strong>} alt="Your alt text" /&gt;</p><p>Use the <strong class="source-inline">const</strong> defined in <em class="italic">Step 7</em> to render the image within a <strong class="source-inline">GatsbyImage</strong> component. Be <a id="_idIndexMarker318"/>sure to provide it with <strong class="source-inline">alt</strong> text to keep your image accessible – you could provide this via <strong class="source-inline">frontmatter</strong> as well if you wish.</p></li>
				<li>Start or restart your development server and admire your hard work. Navigate to one of the blog posts and you should see your image blur in gracefully.<p class="callout-heading">Further Exercise</p><p class="callout">We've learned how to add images to our blog pages, so why not use what you have learned to add a smaller version of the same image to the blog preview page? An implementation can be found in this book's GitHub repository (<a href="https://github.com/PacktPublishing/Elevating-React-Web-Development-with-Gatsby-3/tree/main/Chapter05">https://github.com/PacktPublishing/Elevating-React-Web-Development-with-Gatsby-3/tree/main/Chapter05</a>) if you want to see how it can be achieved.</p></li>
			</ol>
			<p>You might find yourself adding the same configuration to your images across the whole site. Let's find out how we can use the defaults to keep our code in <strong class="bold">Don't Repeat Yourself</strong> (<strong class="bold">DRY</strong>) form.</p>
			<h1 id="_idParaDest-85"><a id="_idTextAnchor086"/>Overriding the gatsby-plugin-image defaults</h1>
			<p>To create a consistent <a id="_idIndexMarker319"/>look and feel, you may have included the same props with many instances of the two image components. Keeping these image components updated can be a monotonous task if your site is image-heavy. Instead, you could configure the defaults within the options of <strong class="source-inline">gatsby-plugin-sharp</strong>:</p>
			<p class="source-code">{</p>
			<p class="source-code">      resolve: 'gatsby-plugin-sharp',</p>
			<p class="source-code">      options: {</p>
			<p class="source-code">        defaults: {</p>
			<p class="source-code"><strong class="bold">          formats: ['auto', 'webp'],</strong></p>
			<p class="source-code"><strong class="bold">          placeholder: 'blurred'</strong></p>
			<p class="source-code"><strong class="bold">          quality: 70</strong></p>
			<p class="source-code"><strong class="bold">          breakpoints: [300…]</strong></p>
			<p class="source-code"><strong class="bold">          backgroundColor: 'transparent'</strong></p>
			<p class="source-code"><strong class="bold">          tracedSVGOptions: {}</strong></p>
			<p class="source-code"><strong class="bold">          blurredOptions: {}</strong></p>
			<p class="source-code"><strong class="bold">          jpgOptions: {}</strong></p>
			<p class="source-code"><strong class="bold">          pngOptions: {}</strong></p>
			<p class="source-code"><strong class="bold">          webpOptions: {}</strong></p>
			<p class="source-code"><strong class="bold">          avifOptions: {}</strong></p>
			<p class="source-code">        }</p>
			<p class="source-code">      }</p>
			<p class="source-code">    },</p>
			<p>Let's look at each of these options in detail:</p>
			<ul>
				<li><strong class="source-inline">formats</strong>: The file formats generated by the plugin.</li>
				<li><strong class="source-inline">placeholder</strong>: Overrides the style of the temporary image.</li>
				<li><strong class="source-inline">quality</strong>: The default image quality that's created.</li>
				<li><strong class="source-inline">breakpoints</strong>: The widths to use for full-width images. It will never create an image with a width that's longer than the source.</li>
				<li><strong class="source-inline">backgroundColor</strong>: The default background color of the images.</li>
				<li><strong class="source-inline">tracedSVGOptions</strong> and <strong class="source-inline">blurredOptions</strong>: The default options to use for placeholder image types in the case that these are different from the global defaults.</li>
				<li><strong class="source-inline">jpgOptions</strong>, <strong class="source-inline">pngOptions</strong>, <strong class="source-inline">webpOptions</strong>, and <strong class="source-inline">avifOptions</strong>: The default options<a id="_idIndexMarker320"/> to use for image types in the case that these are different from the global defaults.</li>
			</ul>
			<p>We now have a good understanding of the <strong class="source-inline">gatsby-plugin-image</strong> package. There are, however, some important niches to using this package with other sources such as <strong class="bold">Content Management Systems</strong> (<strong class="bold">CMSes</strong>) – let's take a look.</p>
			<h1 id="_idParaDest-86"><a id="_idTextAnchor087"/>Sourcing images from CMS</h1>
			<p>It is not always <a id="_idIndexMarker321"/>practical to store images within your repository. You may <a id="_idIndexMarker322"/>want someone other than yourself to be able to update or add images to your site without you needing to change the code. In these cases, serving images via CMS is preferable. It's still important that we use the Gatsby image plugin as we want our images to be performant, regardless of the source. To understand how we would integrate images via CMS, let's use an example. Let's add a profile image to our <em class="italic">about</em> page using <strong class="source-inline">gatsby-plugin-image</strong> and a CMS.</p>
			<p class="callout-heading">Important Note</p>
			<p class="callout">Due to the vast number of headless CMSes in the market, we will continue to focus on the two mentioned in the <em class="italic">Sourcing data from a Headless CMS</em> section of <a href="B15983_03_ePub_RK.xhtml#_idTextAnchor057"><em class="italic">Chapter 3</em></a>, <em class="italic">Sourcing and Querying Data (from Anywhere!)</em>: GraphCMS and Prismic. </p>
			<p>Both of the following sections will assume you have already installed the CMS's dependencies and integrated the CMS via your <strong class="source-inline">gatsby-config.js</strong> file. Please only implement one of the following.</p>
			<h2 id="_idParaDest-87"><a id="_idTextAnchor088"/>Sourcing images from GraphCMS</h2>
			<p>By making some small modifications to our configuration and queries, we can ensure that we can<a id="_idIndexMarker323"/> source images from<a id="_idIndexMarker324"/> GraphCMS that utilize <strong class="source-inline">gatsby-plugin-image</strong> and load in on the site in the same way as those that are locally sourced:</p>
			<ol>
				<li value="1">Navigate to the GraphCMS<a id="_idIndexMarker325"/> website (<a href="https://graphcms.com">graphcms.com</a>) and log in. </li>
				<li>Navigate to your project's assets and click the <strong class="bold">upload</strong> button. </li>
				<li>Drag and drop a local image you wish to use onto the page. Be sure to take note of the file's name as we will need it later. </li>
				<li>Publish the asset.</li>
				<li>Modify your <strong class="source-inline">gatsby-source-graphcms</strong> plugin:<p class="source-code">{</p><p class="source-code">      resolve: 'gatsby-source-graphcms',</p><p class="source-code">      options: {</p><p class="source-code">        endpoint: process.env.GRAPHCMS_ENDPOINT,</p><p class="source-code">        <strong class="bold">downloadLocalImages: true,</strong></p><p class="source-code">      },</p><p class="source-code">    },</p><p>By modifying your <strong class="source-inline">gatsby-source-graphcms</strong> plugin's options to include the <strong class="source-inline">downloadLocalImages</strong> option, the plugin will download and cache the CMS's image assets within your Gatsby project.</p></li>
				<li>Modify your about page's <strong class="source-inline">query</strong> so that it includes the <strong class="source-inline">graphCmsAsset</strong> source:<p class="source-code">export const query = graphql'</p><p class="source-code">  {</p><p class="source-code">    markdownRemark(frontmatter: { type: { eq: "bio" } }) {</p><p class="source-code">      html</p><p class="source-code">    }</p><p class="source-code">    <strong class="bold">graphCmsAsset(fileName: { eq: "profile.jpeg" }) {</strong></p><p class="source-code"><strong class="bold">      localFile {</strong></p><p class="source-code"><strong class="bold">        childImageSharp {</strong></p><p class="source-code"><strong class="bold">          gatsbyImageData(layout: FULL_WIDTH)</strong></p><p class="source-code"><strong class="bold">        }</strong></p><p class="source-code"><strong class="bold">      }</strong></p><p class="source-code">    }</p><p class="source-code">  }</p><p class="source-code">';</p><p>As with the<a id="_idIndexMarker326"/> local queries we looked at in the <em class="italic">The GatsbyImage component</em> section, we are using <strong class="source-inline">gatsbyImageData</strong> within our <strong class="source-inline">query</strong> and can make use of any of the configuration options that<a id="_idIndexMarker327"/> it supports. Here, we are specifying that the image should be full width.</p></li>
				<li>Add the <strong class="source-inline">GatsbyImage</strong> component and the <strong class="source-inline">getImage</strong> function as imports at the top of the <strong class="source-inline">src/pages/about.js</strong> file:<p class="source-code">import { GatsbyImage, getImage } from "gatsby-plugin-</p><p class="source-code">image";</p></li>
				<li>Use the new data within the <strong class="source-inline">data</strong> prop to get the image within the component:<p class="source-code">const {</p><p class="source-code">    markdownRemark: { html },</p><p class="source-code">    graphCmsAsset: { localFile },</p><p class="source-code">  } = data;</p><p class="source-code">  const profileImage = getImage(localFile);</p><p>First, retrieve <strong class="source-inline">graphCmsAsset</strong> from the <strong class="source-inline">data</strong> prop and then use the <strong class="source-inline">getImage</strong> utility from <strong class="source-inline">gatsby-plugin-image</strong> to retrieve the image data that's required to render it. Finally, assign it to a <strong class="source-inline">const</strong> called <strong class="source-inline">profileImage</strong>.</p></li>
				<li>Render your<a id="_idIndexMarker328"/> image within<a id="_idIndexMarker329"/> your <strong class="source-inline">return</strong> statement:<p class="source-code">return (</p><p class="source-code">    &lt;Layout&gt;</p><p class="source-code">      &lt;div className="max-w-5xl mx-auto py-16 lg:py-24</p><p class="source-code">        text-center"&gt;</p><p class="source-code">        <strong class="bold">&lt;GatsbyImage</strong></p><p class="source-code"><strong class="bold">          image={profileImage}</strong></p><p class="source-code"><strong class="bold">          alt="Your alt text"</strong></p><p class="source-code"><strong class="bold">          className="mx-auto max-w-sm"</strong></p><p class="source-code"><strong class="bold">        /&gt;</strong></p><p class="source-code">        &lt;div dangerouslySetInnerHTML={{ __html: html</p><p class="source-code">         }}&gt;&lt;/div&gt;</p><p class="source-code">      &lt;/div&gt;</p><p class="source-code">    &lt;/Layout&gt;</p><p class="source-code">  );</p><p>Use the <strong class="source-inline">const</strong> parameter that we defined in <em class="italic">Step 8</em> to render the image within a <strong class="source-inline">GatsbyImage</strong> component. Be sure to provide it with <strong class="source-inline">alt</strong> text to keep your image accessible – you could provide this via <strong class="source-inline">frontmatter</strong> as well if you wish.</p></li>
				<li>Restart your<a id="_idIndexMarker330"/> development server and admire your hard <a id="_idIndexMarker331"/>work by navigating to your <em class="italic">about</em> page.</li>
			</ol>
			<p>Now that we understand how we can source images within GraphCMS, let's turn our attention to how the same can be achieved in Prismic.</p>
			<h2 id="_idParaDest-88"><a id="_idTextAnchor089"/>Sourcing images from Prismic</h2>
			<p>With a few <a id="_idIndexMarker332"/>simple changes to our configuration and queries, we can<a id="_idIndexMarker333"/> source images from Prismic utilizing <strong class="source-inline">gatsby-plugin-image</strong> and load them in on the site in the same way as local images:</p>
			<ol>
				<li value="1">Navigate to Prismic's website (<a href="https://prismic.io">prismic.io</a>) and log in. Select your existing repository.</li>
				<li>Navigate to the <strong class="bold">CustomTypes</strong> tab, click the <strong class="bold">Create new</strong> button, and select <strong class="bold">Single Type</strong>. Name your type <strong class="bold">Profile</strong> and submit it.</li>
				<li>Using the <strong class="bold">build-mode</strong> sidebar (on the right), drag an image component into the type.</li>
				<li>Name your field <strong class="bold">photo</strong>; the corresponding API ID should populate on its own. Click <strong class="bold">OK</strong> to confirm this. If you've done this correctly, your profile type should look as follows:<div id="_idContainer027" class="IMG---Figure"><img src="image/Figure_5.1_B15983.jpg" alt="Figure 5.1 – Prismic profile type &#13;&#10;"/></div><p class="figure-caption">Figure 5.1 – Prismic profile type </p></li>
				<li>Save the document.</li>
				<li>Navigate to the<a id="_idIndexMarker334"/> JSON editor and copy its contents to a new<a id="_idIndexMarker335"/> file called <strong class="source-inline">profile.json</strong> within your <strong class="source-inline">src/schemas</strong> folder. </li>
				<li>Navigate to the <strong class="bold">Documents</strong> tab and click the <strong class="bold">Create new</strong> button. If Prismic has not automatically opened your new type, select <strong class="bold">Profile</strong>. Using the interface, upload a new image into the document in the <strong class="bold">photo</strong> field.</li>
				<li>Save and publish the new document. We now have everything set up in the CMS and can return to our Gatsby project.</li>
				<li>Update your <strong class="source-inline">gatsby-source-prismic</strong> configuration within your <strong class="source-inline">gatsby-config.js</strong> file:<p class="source-code">{</p><p class="source-code">      resolve: "gatsby-source-prismic",</p><p class="source-code">      options: {</p><p class="source-code">        repositoryName: "elevating-gatsby",</p><p class="source-code">        schemas: {</p><p class="source-code">          icebreaker:</p><p class="source-code">           require("./src/schemas/icebreaker.json"),</p><p class="source-code">          <strong class="bold">profile:</strong></p><p class="source-code"><strong class="bold">           require("./src/schemas/profile.json"),</strong></p><p class="source-code">        },</p><p class="source-code">        <strong class="bold">shouldDownloadFiles: () =&gt;  true,</strong></p><p class="source-code">      },</p><p class="source-code">    },</p><p>Add the new scheme to <strong class="source-inline">schemas</strong> that we added in <em class="italic">Step 6</em>. We will also add the <strong class="source-inline">shouldDownloadFiles</strong> option. This is a function that determines whether to download images. In our case, we always want it to download images so that<a id="_idIndexMarker336"/> we can use <strong class="source-inline">gatsby-plugin-image</strong>, and<a id="_idIndexMarker337"/> therefore set the function to always return <strong class="source-inline">true</strong>.</p></li>
				<li>Add the <strong class="source-inline">GatsbyImage</strong> component and the <strong class="source-inline">getImage</strong> function as imports at the top of the <strong class="source-inline">src/pages/about.js</strong> file:<p class="source-code">import { GatsbyImage, getImage } from "gatsby-plugin-</p><p class="source-code">image";</p></li>
				<li>Modify your about page's <strong class="source-inline">query</strong> so that it includes the <strong class="source-inline">prismicProfile</strong> source:<p class="source-code">export const query = graphql'</p><p class="source-code">  {</p><p class="source-code">    markdownRemark(frontmatter: { type: { eq: "bio" }</p><p class="source-code"> }) {</p><p class="source-code">      html</p><p class="source-code">    }</p><p class="source-code">    prismicProfile {</p><p class="source-code">      data {</p><p class="source-code">        photo {</p><p class="source-code">          localFile {</p><p class="source-code">            childImageSharp {</p><p class="source-code">              gatsbyImageData(layout: FULL_WIDTH)</p><p class="source-code">            }</p><p class="source-code">          }</p><p class="source-code">        }</p><p class="source-code">      }</p><p class="source-code">    }</p><p class="source-code">  }</p><p class="source-code">';</p><p>We utilize <strong class="source-inline">gatsbyImageData</strong> within our <strong class="source-inline">query</strong> and can make use of any of the configuration <a id="_idIndexMarker338"/>options that it supports. Here, we are specifying<a id="_idIndexMarker339"/> that the image should be full width.</p></li>
				<li>Use the new data within the <strong class="source-inline">data</strong> prop to get the image within the component:<p class="source-code">const {</p><p class="source-code">    markdownRemark: { html },</p><p class="source-code">    prismicProfile: {</p><p class="source-code">      data: {</p><p class="source-code">        photo: { localFile },</p><p class="source-code">      },</p><p class="source-code">    },</p><p class="source-code">  } = data;</p><p class="source-code">  const profileImage = getImage(localFile);</p><p>First, retrieve the <strong class="source-inline">prismicProfile</strong> data from the <strong class="source-inline">data</strong> prop and then use the <strong class="source-inline">getImage</strong> utility from <strong class="source-inline">gatsby-plugin-image</strong> to retrieve the image data that's required to render it and assign it to a <strong class="source-inline">const</strong> called <strong class="source-inline">profileImage</strong>.</p></li>
				<li>Render your <a id="_idIndexMarker340"/>image <a id="_idIndexMarker341"/>within your <strong class="source-inline">return</strong> statement:<p class="source-code">&lt;GatsbyImage</p><p class="source-code">          image={profileImage}</p><p class="source-code">          alt="Your alt text"</p><p class="source-code">          className="mx-auto max-w-sm"</p><p class="source-code">        /&gt;</p><p>Use the <strong class="source-inline">const</strong> parameter defined in <em class="italic">Step 12</em> to render the image within a <strong class="source-inline">GatsbyImage</strong> component. Be sure to provide it with <strong class="source-inline">alt</strong> text to keep your image accessible – you could provide this via <strong class="source-inline">frontmatter</strong> as well if you wish.</p></li>
				<li>Restart your development server and admire your hard work by navigating to your <em class="italic">about</em> page.</li>
			</ol>
			<p>You should now feel comfortable using images and sourcing images via the Prismic CMS. While we have only looked at two CMSes, these concepts can be taken and applied to any headless CMS that supports images. Now, let's summarize what we have learned in this chapter.</p>
			<h1 id="_idParaDest-89"><a id="_idTextAnchor090"/>Summary</h1>
			<p>In this chapter, we learned about images on the web, and how critical they are to our browsing experience. We learned about <strong class="source-inline">gatsby-plugin-image</strong> and implemented the two contained image components. We also learned in which circumstances to use which component.  </p>
			<p>At this stage, you should feel comfortable developing all manner of pages for your Gatsby site. In the next chapter, we will begin to look at how we can take our development site live. We will start this journey by looking at <strong class="bold">search engine optimization</strong>.</p>
		</div>
	</body></html>