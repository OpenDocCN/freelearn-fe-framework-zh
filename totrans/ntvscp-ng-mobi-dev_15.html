<html><head></head><body>
        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Deploying to the Apple App Store</h1>
                
            
            <article>
                
<p class="mce-root">In this chapter, we will focus on how to deploy our app to the Apple App Store. There are several important steps we will want to follow, so pay close attention to all the details presented here.</p>
<p class="mce-root">Whether you need to work with Signing Certificates to build a release target of our app, generate app icons and splash screens, or work within XCode to archive our app for upload to the App Store, we will cover all these topics in this chapter.</p>
<p class="mce-root">TJ VanToll, a NativeScript expert and developer advocate for Progress, wrote an excellent article detailing deployment steps titled <em class="calibre21">8 Steps to Publish Your NativeScript App to the App Stores</em> (<a href="https://www.nativescript.org/blog/steps-to-publish-your-nativescript-app-to-the-app-stores" class="calibre3">https://www.nativescript.org/blog/steps-to-publish-your-nativescript-app-to-the-app-stores</a>). We will take excerpts from that article and expand on sections wherever possible here in this chapter and the next chapter.</p>
<div class="packt_quote">There's no point in lying to you—releasing an iOS app to the iOS App Store is one of the most painful processes you'll go through in your software development career. So, in case you get stuck or confused in these steps, just know that it's not just you—everyone gets frustrated when releasing iOS apps the first time.</div>
<p class="mce-root">The following topics are covered in this chapter:</p>
<ul class="calibre13">
<li class="calibre14">How to create an App ID and production certificate to sign your app release target with</li>
<li class="calibre14">How to configure a NativeScript app with the appropriate metadata needed for a release</li>
<li class="calibre14">How to handle app icons and splash screens</li>
<li class="calibre14">Uploading your build to iTunes Connect using the NativeScript CLI</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Preparing for App Store distribution</h1>
                
            
            <article>
                
<p class="mce-root">To deploy iOS apps to the iOS App Store, you absolutely must have an active Apple Developer account. It costs $99 USD per year to be a part of the program, and you can sign up at <a href="https://developer.apple.com/register" class="calibre3">developer.apple.com/register</a>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">App ID, certificates, and profiles</h1>
                
            
            <article>
                
<p class="mce-root">Once you create an Apple Developer account, you'll need to create an App ID, Production Certificate, and a Distribution Provisioning Profile on the Apple Developer portal. This is the most tedious part of the entire process, as it takes some time to learn what each of these various files do and how to use them:</p>
<ol class="calibre16">
<li value="1" class="calibre14">For our app, we will begin by creating the App ID with the following:</li>
</ol>
<div class="mce-root1"><img class="image-border49" src="../images/00059.jpeg"/></div>
<ol start="2" class="calibre16">
<li value="2" class="calibre14">Once we create this App ID, we can now create a <span>Production</span> certificate:</li>
</ol>
<div class="mce-root1"><img class="image-border50" src="../images/00060.jpeg"/></div>
<ol start="3" class="calibre16">
<li value="3" class="calibre14">Select <span>Continue</span>. Then, the next screen will provide instructions on how to sign your production certificate, which we will walk through next. First, open <kbd class="calibre11">/Applications/Utilities/Keychain Access.app</kbd> and then go to the top-left menu and select <span>Certificate Assistant</span> | <span>Request a Certificate from a Certificate Authority</span> using a setup like this:</li>
</ol>
<div class="mce-root1"><img class="image-border51" src="../images/00061.jpeg"/></div>
<p class="cdpaligncenter">This will save a signing request file wherever you choose, which you will need in the next step.</p>
<ol start="4" class="calibre16">
<li value="4" class="calibre14">Now, select that signing request file at this step in the portal:</li>
</ol>
<div class="mce-root1"><img class="image-border52" src="../images/00062.jpeg"/></div>
<ol start="5" class="calibre16">
<li value="5" class="calibre14">On the next screen, it's very important to download and then double-click the file that you need to install into your keychain as it specifies:</li>
</ol>
<div class="mce-root1"><img class="image-border53" src="../images/00063.jpeg"/></div>
<ol start="6" class="calibre16">
<li value="6" class="calibre14">When double-clicking the file to install into the keychain, it may prompt you to provide the keychain to install the file into; using the <em class="calibre21">login</em> keychain will work fine:</li>
</ol>
<div class="mce-root1"><img class="image-border54" src="../images/00064.jpeg"/></div>
<p class="mce-root">You should now see something similar to the following screenshot in your keychain access app:</p>
<div class="mce-root1"><img class="image-border55" src="../images/00065.jpeg"/></div>
<ol start="7" class="calibre16">
<li value="7" class="calibre14">You can now quit keychain access.</li>
</ol>
<p class="mce-root"> </p>
<ol start="8" class="calibre16">
<li value="8" class="calibre14">Next, we want to create a Distribution Provisioning Profile:</li>
</ol>
<div class="mce-root1"><img class="image-border56" src="../images/00066.jpeg"/></div>
<ol start="9" class="calibre16">
<li value="9" class="calibre14">On the next screen, just ensure that you select the App ID that you created:</li>
</ol>
<div class="mce-root1"><img class="image-border57" src="../images/00067.jpeg"/></div>
<ol start="10" class="calibre16">
<li value="10" class="calibre14">Then, on the next screen, you should be able to select the <span>Distribution</span> certificate you created:</li>
</ol>
<div class="mce-root1"><img class="image-border58" src="../images/00068.jpeg"/></div>
<ol start="11" class="calibre16">
<li value="11" class="calibre14">Then, you will be able to give the profile a name:</li>
</ol>
<div class="mce-root1"><img class="image-border59" src="../images/00069.jpeg"/></div>
<ol start="12" class="calibre16">
<li value="12" class="calibre14">You can download the profile and just place it alongside your <kbd class="calibre11">ios_distribution.cer</kbd> file; however, there is no need to open that provisioning profile file, as XCode will handle everything else.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Configure the app metadata such as App ID and Display Name</h1>
                
            
            <article>
                
<p class="mce-root">iOS and Android apps have a lot of information that you will need to configure before you deploy your apps to their respective stores. NativeScript provides intelligent defaults for many of these values, but there are a few that you'll want to review before you deploy.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">App ID</h1>
                
            
            <article>
                
<p class="mce-root">The App ID configured in the Apple developer portal moments ago is a unique identifier for your app that uses something called reverse domain name notation. Our NativeScript app's metadata must match. Our App ID for this app is <kbd class="calibre11">io.nstudio.nStudio</kbd>. The NativeScript CLI has a convention for setting the App ID during app creation:</p>
<pre class="calibre22"><strong class="calibre1"> tns create YourApp --appid com.mycompany.myappname</strong></pre>
<p class="mce-root">We did not use this option when we created our app; however, it's easy enough to change our App ID.</p>
<p class="mce-root">Open the app's root <kbd class="calibre11">package.json</kbd> file and find the <kbd class="calibre11">nativescript</kbd> key. Ensure that the <kbd class="calibre11">id</kbd> attribute contains the value you'd like to use:</p>
<div class="mce-root1"><img class="image-border60" src="../images/00070.jpeg"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Display name</h1>
                
            
            <article>
                
<p class="mce-root"><span>You app's display name is the name the user sees next to your icon on their screen. </span>By default, NativeScript sets your app's display name based on the value you passed to <kbd class="calibre11">tns create</kbd>, which is oftentimes not exactly what you want the user to see. For example, running <kbd class="calibre11">tns create my-app</kbd> results in an app with a display name of <kbd class="calibre11">myapp</kbd>.</p>
<p class="mce-root">To change that value on iOS, first open your app's <kbd class="calibre11">app/App_Resources/iOS/Info.plist</kbd> file. The <kbd class="calibre11">Info.plist</kbd> file is iOS's main configuration file, and here you'll find a number of values you may want to tinker with before releasing your app. For display name, you'll want to alter the <kbd class="calibre11">CFBundleDisplayName</kbd> value.</p>
<p class="mce-root">Here's what this value looks like for <kbd class="calibre11">nStudio</kbd>:</p>
<div class="mce-root1"><img class="image-border61" src="../images/00071.jpeg"/></div>
<div class="packt_infobox"><span class="calibre31"><br class="calibre24"/>
Although there's no real character limit to display names, both iOS and Android will truncate your display names after somewhere around 10–12 characters.</span></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Create your app icons and splash screens</h1>
                
            
            <article>
                
<p class="mce-root"><span>Your app's icon is the first thing your users notice about your app. When you start a new NativeScript app, you will get a placeholder icon, which is fine for development; however, for production, you will need to replace the placeholder icon with the image you'll want to go to the stores with.</span></p>
<p class="mce-root">To get your production-ready app icon files in place, you will need to first create a 1024 x 1024 pixel <kbd class="calibre11">.png</kbd> image asset that represents your app.</p>
<p class="mce-root">To make your life difficult, both iOS and Android require you to provide a variety of icon images in a wide array of sizes. Don't worry though; once you have a 1024 x 1024 image, there are a few sites that will generate images in the various dimensions that Android and iOS require. For the NativeScript development, I recommend that you use the Nathanael Anderson's NativeScript Image Builder, which is available at <kbd class="calibre11">images.nativescript.rocks</kbd>.</p>
<p class="mce-root">We will build our icon in Photoshop:</p>
<div class="mce-root1"><img class="image-border62" src="../images/00072.jpeg"/></div>
<p class="mce-root">We can then export that as a <kbd class="calibre11">.png</kbd> and upload it to <kbd class="calibre11">images.nativescript.rocks</kbd>:</p>
<div class="mce-root1"><img class="image-border63" src="../images/00073.jpeg"/></div>
<p class="mce-root">When you click on <span>Go</span>, a zip file will be downloaded, and the contents will include your app icons and splash screens. You can copy these images into your <kbd class="calibre11">app/App_Resources</kbd> folder, respectively, for iOS (we will cover Android in the next chapter).</p>
<p class="mce-root">We now have our app icon and splash screens in place.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Build the app for release</h1>
                
            
            <article>
                
<p class="mce-root">Since we have already covered webpack bundling issues in the preceding chapter, we are now ready to build the final releasable bundle with the following command:</p>
<pre class="calibre22"><strong class="calibre1">npm run build-ios-bundle -- --release --forDevice --teamId KXPB57C8BE</strong></pre>
<p class="mce-root">Note that the <kbd class="calibre11">--teamId</kbd> will be different for you. It is the prefix on the App ID provided in the preceding command.</p>
<p class="mce-root">After this command finishes, you'll have the <kbd class="calibre11">.ipa</kbd> file you'll need in your <kbd class="calibre11">platforms/ios/build/device</kbd> folder. Make a note of the location of that file, as you'll need it in the final step of this guide.</p>
<p class="mce-root">Phew! Hopefully, you've made it to this point in one piece. You're now ready for the final step, iTunes Connect.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Upload to iTunes Connect</h1>
                
            
            <article>
                
<p class="mce-root">The first thing you'll need to do is register your app. To do that, visit <a href="https://itunesconnect.apple.com/" class="calibre3">https://itunesconnect.apple.com/</a>, click on <span>My Apps</span>, and, click on the <span>+</span> button (currently in the top-left corner of the screen), and then select <span>New App</span>. In the screen that follows, ensure that you select the correct <span>Bundle ID</span>, and the <span>SKU</span> can be any number you'd like to identify your app; we like to use the current date:</p>
<div class="mce-root1"><img class="image-border64" src="../images/00074.jpeg"/></div>
<p class="mce-root">After providing this information, you'll be taken to your app's dashboard where we need to provide more metadata about our app. Most of this information is pretty straightforward, such as descriptions and pricing, but there are a few <em class="calibre21">fun</em> pieces we'll have to deal with, such as screenshots.</p>
<p class="mce-root">iTunes Connect now requires you to upload two sets of screenshots, one for the largest iPhone devices (5.5-inch displays), and another for the largest iPad devices (12.9-inch devices). Apple still gives you the ability to provide optimized screenshots for each and every iOS device dimension, but if you provide only 5.5-inch and 12.9-inch screenshots, Apple will rescale your provided screenshots for smaller display devices automatically.</p>
<p class="mce-root">To get those screenshots we could run the app on a physical iPhone Plus and iPad Pro device, but we find it far easier to get these screenshots from iOS simulators. </p>
<p class="mce-root">With the correct simulated device running, we can use the simulator's <em class="calibre21">Cmd</em> + <em class="calibre21">S</em> keyboard shortcut to take a screenshot of the app, which will save the appropriate image to our desktop.</p>
<p class="mce-root">At this point, we're all set. We will use a service such as DaVinci (<a href="https://www.davinciapps.com/" class="calibre3">https://www.davinciapps.com</a>) to polish our image files, but when we are ready, we'll drag our images into the <span>App Preview and Screenshots</span> area of iTunes Connect.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Uploading your .ipa file</h1>
                
            
            <article>
                
<p class="mce-root">We're almost there! Once all the information has been entered into iTunes Connect, the final step is to associate the built <kbd class="calibre11">.ipa</kbd> file with all the information we just typed out.</p>
<p class="mce-root">We will use the NativeScript CLI to do this.</p>
<div class="packt_tip"><br class="calibre24"/>
Remember that your .ipa file is in your app's <kbd class="calibre29">platforms/ios/build/device</kbd> folder. </div>
<p class="mce-root"><span>Run the following command to publish your app to iTunes Connect:</span></p>
<pre class="calibre22"><strong class="calibre1">tns publish ios --ipa &lt;path to your ipa file&gt;</strong></pre>
<p class="mce-root">That's it. One important note, though, for whatever crazy reason, there's a nontrivial delay between the time you upload your iOS app and the time that your app shows up in iTunes Connect. We saw that the delay can be as short as 30 seconds and as long as an hour. Once the build shows up there, we can go ahead and click on the big <span>Submit for Review</span> button, and cross our fingers.</p>
<p class="mce-root">Apple has a notoriously sporadic delay for reviewing the iOS apps that you submit. At the time of writing this book, the average time to review for the iOS App Store was around 2 days.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Summary</h1>
                
            
            <article>
                
<p class="mce-root">In this chapter, we highlighted the critical steps that must be taken to release an app to the Apple App Store, including signing certificates, app id, app icons, and splash screens. The process may seem heavily involved at first, but once you understand the various steps better, it becomes more clear.</p>
<p class="mce-root">We now have an app pending review in the store and are well on our way to making our app available for users around the world.</p>
<p class="mce-root">In the next chapter, let's finish this by deploying our app to the Google Play Store to broaden our audience.</p>


            </article>

            
        </section>
    </body></html>