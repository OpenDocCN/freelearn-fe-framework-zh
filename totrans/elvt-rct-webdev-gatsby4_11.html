<html><head></head><body>
		<div id="_idContainer064">
			<h1 id="_idParaDest-125"><em class="italic"><a id="_idTextAnchor127"/>Chapter 9</em>: Deployment and Hosting</h1>
			<p>In this chapter, we will finally take the project we have been working on and deploy it for the world to see! We will delve into the different types of builds that Gatsby creates and gain an understanding of how to debug common build errors. Following this, we will continue to learn how we can deploy them using a variety of different platforms. Additionally, we will discover how we can lock down access to our site by serving it up as part of an Express server.</p>
			<p>In this chapter, we will cover the following topics:</p>
			<ul>
				<li>Understanding build types</li>
				<li>Common build errors</li>
				<li>Your pre-deployment checklist</li>
				<li>Platforms for deploying hybrid builds</li>
				<li>Platforms for deploying static builds</li>
				<li>Serving a Gatsby site with reduced user access</li>
			</ul>
			<h1 id="_idParaDest-126"><a id="_idTextAnchor128"/>Technical requirements</h1>
			<p>To navigate this chapter, you will need to have completed <a href="B15983_08_ePub_RK.xhtml#_idTextAnchor116"><em class="italic">Chapter 8</em></a>, <em class="italic">Web Analytics and Performance Monitoring</em>. </p>
			<p>The code that is presented in this chapter can be found at <a href="https://github.com/PacktPublishing/Elevating-React-Web-Development-with-Gatsby-4/tree/main/Chapter09">https://github.com/PacktPublishing/Elevating-React-Web-Development-with-Gatsby-4/tree/main/Chapter09</a>.</p>
			<h1 id="_idParaDest-127"><a id="_idTextAnchor129"/>Understanding build types</h1>
			<p>Gatsby version 4<a id="_idIndexMarker473"/> introduced the ability for your website to be built in two different ways:</p>
			<ul>
				<li>As a <strong class="bold">static build</strong>: This <a id="_idIndexMarker474"/>creates all your pages at build time using<a id="_idIndexMarker475"/> Node.js. The resulting files are all static HTML, JavaScript, and CSS, which can be served entirely statically. </li>
				<li>As a <strong class="bold">hybrid build</strong>: This is <a id="_idIndexMarker476"/>a mixture of a static build combined with<a id="_idIndexMarker477"/> pages that are server-side rendered or have been created via deferred static generation. </li>
			</ul>
			<p>When running <strong class="source-inline">gatsby build</strong>, Gatsby will inspect your site's content, and if possible, create a static build. However, if your site contains pages that are server-side rendered or have been created via deferred static generation, it will create a build that requires server-side code that runs on a Node.js server or via serverless functions. Builds of both types can be tested locally using the <strong class="source-inline">gatsby serve</strong> command. </p>
			<p>Before deploying your build, it's worth ensuring that everything is working as it should locally. Now, let's take a moment to look at common build errors and learn how you can avoid them.</p>
			<h1 id="_idParaDest-128"><a id="_idTextAnchor130"/>Common build errors</h1>
			<p>While working<a id="_idIndexMarker478"/> on our project, we mostly run the project in development mode. This is a great idea to ensure that the site also works with a production build by running the <strong class="source-inline">gatsby build</strong> command. </p>
			<p>Sometimes, you<a id="_idIndexMarker479"/> might find that errors occur during the build process. So, let's talk about the most common issues and how we can fix them:</p>
			<ul>
				<li>The most common error that you'll come across is <strong class="bold">window/document is not defined</strong>. Node.js does not contain the <strong class="source-inline">window</strong> and <strong class="source-inline">document</strong> variables found in the browser. Therefore, while your site is being built, it is unable to access them. You can get around this issue in a couple of ways. You can perform a check to confirm that the variable is defined (for example, <strong class="source-inline">typeof window !== undefined &amp;&amp; yourFunction()</strong>), or if appropriate, you can move the code into a <strong class="source-inline">useEffect</strong> hook.</li>
				<li>Ensure that all your components, your pages, and your <strong class="source-inline">gatsby-browser.js</strong> and <strong class="source-inline">gatsby-ssr.js</strong> files do not mix <strong class="bold">ES5</strong> and <strong class="bold">ES6</strong> syntax, as this can lead to builds crashing out.</li>
				<li>Take <a id="_idIndexMarker480"/>special care to ensure that all JavaScript files found within your <strong class="source-inline">pages</strong> directory are React components with a default export. Gatsby<a id="_idIndexMarker481"/> treats all JavaScript files as pages within this folder. If you have components or other utility functions within this directory, you will get an error that says <strong class="bold">A page component must export a React component for it to be valid</strong>. If you see this error, just move the files in question outside of the folder.</li>
			</ul>
			<p>Now that we can build our site without issues, let's examine a practical checklist that we should run through before deploying our site.</p>
			<h1 id="_idParaDest-129"><a id="_idTextAnchor131"/>Your pre-deployment checklist</h1>
			<p>Regardless of how <a id="_idIndexMarker482"/>you intend to deploy your site, there are a few<a id="_idIndexMarker483"/> steps you should follow on your local machine to ensure that your first deployment will run smoothly:</p>
			<ol>
				<li><em class="italic">Ensure any deployment platform plugins that are required have been installed.</em> A couple of the platforms we will look at have Gatsby plugins specifically for use with their product. By adding them to your Gatsby site, the platform is better able to understand your project and, as a result, build your site faster.</li>
				<li><em class="italic">Make sure your Gatsby site builds without an error.</em> Once the build has passed successfully, try running <strong class="source-inline">gatsby serve</strong> to ensure that you can use the site without issue. </li>
				<li><em class="italic">Ensure all your tests are passing.</em> Make sure that you have run your unit tests that we set up in <a href="B15983_07_ePub_RK.xhtml#_idTextAnchor105"><em class="italic">Chapter 7</em></a>, <em class="italic">Testing and Auditing Your Site</em>, using <strong class="source-inline">npm run test</strong>, and ensure that they are all passing.</li>
				<li><em class="italic">Take note of your Node.js version.</em> As of Gatsby version 4, your Node.js version should be 14 or higher. You'll want to ensure that the Node.js version matches your deployment platform so that you don't have compatibility issues. You can check this by running <strong class="source-inline">node -v</strong> in your terminal.</li>
			</ol>
			<p>Now<a id="_idIndexMarker484"/> that we <a id="_idIndexMarker485"/>have completed our checklist, let's look at the various platforms we can deploy our site with, starting with those that support hybrid sites.</p>
			<p class="callout-heading">Important Note</p>
			<p class="callout">It is recommended that you only deploy your site on one deployment platform and not multiple platforms. Managing multiple platforms when you can do the job with one is far easier for you to maintain. Try experimenting with all the options to find the best fit for your project.</p>
			<h1 id="_idParaDest-130"><a id="_idTextAnchor132"/>Platforms for deploying hybrid builds</h1>
			<p>As <a id="_idIndexMarker486"/>hybrid sites require a Node.js server, we need to use platforms that can provision them. Hybrid sites are also very new to the Gatsby ecosystem. At the time of writing, the only stable option for hosting a hybrid build is Gatsby Cloud Hosting, so let's look at the platform next.</p>
			<h2 id="_idParaDest-131"><a id="_idTextAnchor133"/>Deploying to Gatsby Cloud Hosting</h2>
			<p><strong class="bold">Gatsby Cloud</strong> is a<a id="_idIndexMarker487"/> cloud platform that has been specifically designed and built for the<a id="_idIndexMarker488"/> Gatsby framework by the Gatsby organization. Because they focus on this framework, they excel at building<a id="_idIndexMarker489"/> technology that makes your builds run as fast as possible. This includes the following:</p>
			<ul>
				<li><strong class="bold">Incremental builds</strong>: Gatsby <a id="_idIndexMarker490"/>Cloud observes the GraphQL data layer <a id="_idIndexMarker491"/>and identifies page dependencies. When you push changes to your code, it identifies the data layer changes and only rebuilds the pages that are dependent on that data. This can drastically speed up repeat builds – Gatsby says that incremental builds can be as much as 1,000 times faster than traditional builds.</li>
				<li><strong class="bold">Intelligent caching</strong>: Special <a id="_idIndexMarker492"/>caching headers are sent to the <a id="_idIndexMarker493"/>browser when requesting your site. These are used to ensure that the browser does not re-download any content that has not changed between builds. </li>
			</ul>
			<p>It should<a id="_idIndexMarker494"/> be noted that incremental builds are not<a id="_idIndexMarker495"/> available on the free tier of the platform. If you want to benefit from them, you'll need to upgrade.</p>
			<p>Now that we understand the benefits of using the platform, let's look at how we can deploy our site to the platform.</p>
			<p class="callout-heading">Quick Note</p>
			<p class="callout">The process for deploying a hybrid site and a static site is the same on the Gatsby platform, so these instructions will work in both cases.</p>
			<p>Perform the following steps to deploy your site to the Gatsby Cloud platform:</p>
			<ol>
				<li value="1">Install the Gatsby Cloud plugin:<p class="source-code">npm install --save gatsby-plugin-gatsby-cloud</p><p>Here, we are installing the Gatsby Cloud plugin. This adds basic security headers during the build for the Gatsby Cloud platform.</p></li>
				<li>Include the <strong class="source-inline">gatsby-plugin-gatsby-cloud</strong> plugin in your <strong class="source-inline">gatsby-config.js</strong> file:<p class="source-code">module.exports = {</p><p class="source-code">  // rest of config</p><p class="source-code">  plugins: [</p><p class="source-code">    <strong class="bold">`gatsby-plugin-gatsby-cloud`</strong>,</p><p class="source-code">   // other plugins</p><p class="source-code">  ]</p><p class="source-code">}</p></li>
				<li>Commit and push all changes to your chosen Git repository.</li>
				<li>Open a browser and navigate to <a href="https://www.gatsbyjs.com/products/cloud">https://www.gatsbyjs.com/products/cloud</a>. Click on <strong class="bold">Get Started</strong>.</li>
				<li>Sign <a id="_idIndexMarker496"/>up to the platform by populating <a id="_idIndexMarker497"/>the form with your name, email, and country of residence:<div id="_idContainer046" class="IMG---Figure"><img src="image/Figure_9.01_B15983.jpg" alt="Figure 9.1 – Signing up to Gatsby Cloud&#13;&#10;"/></div><p class="figure-caption">Figure 9.1 – Signing up to Gatsby Cloud</p></li>
				<li>Select your <strong class="bold">VCS </strong>(<strong class="bold">version control system</strong>) provider, log in, and approve the requested permissions that the Gatsby Cloud platform requires in order to integrate with it:<div id="_idContainer047" class="IMG---Figure"><img src="image/Figure_9.02_B15983.jpg" alt="Figure 9.2 – The Gatsby Cloud VCS Provider authorization step&#13;&#10;"/></div><p class="figure-caption">Figure 9.2 – The Gatsby Cloud VCS Provider authorization step</p></li>
				<li>Upon<a id="_idIndexMarker498"/> being redirected to Gatsby Cloud, you <a id="_idIndexMarker499"/>will be asked whether you would like to trial a 14-day upgrade. This is up to you.</li>
				<li>Then, you will be navigated to your dashboard, which will be empty, as we have not set up any sites yet. Let's add our site now by clicking on <strong class="bold">Add Site</strong>.</li>
				<li>Select <strong class="bold">Import from a Git Repository</strong>, and click on <strong class="bold">Next</strong>.</li>
				<li>Select your Git provider from the list, followed by the organization and repository name. If, for some reason, this list has not been populated, ensure that you have given Gatsby the relevant permissions to read from your Git repositories.</li>
				<li>Following this, you will need to provide your site details, including a base branch and base directory. Your base directory should point to the root of the Gatsby project <a id="_idIndexMarker500"/>within the repository – this is most likely the root directory or <strong class="source-inline">/</strong>. Click on <strong class="bold">Next</strong>.</li>
				<li>You will<a id="_idIndexMarker501"/> then be presented with optional integrations for your site. These integrations can help your CMS communicate with Gatsby Cloud. When you make a change to your CMS, you can see a preview of how that content will look via Gatsby Cloud. If you desire to do this, you can click on <strong class="bold">Connect</strong> next to the CMS platform you are using and follow the steps; otherwise, you can click on <strong class="bold">Skip this Step</strong>.</li>
				<li>Finally, you will be asked to add any environment variables that your site needs to build. Gatsby scans your site's integrations and plugins to help fill in the environment variables it thinks you need. Be sure to cross-check this with your local <strong class="source-inline">.env</strong> file to ensure you have everything that is required.</li>
				<li>Click on <strong class="bold">Create site</strong>. This will prompt Gatsby to start building your site for the very first time:</li>
			</ol>
			<div>
				<div id="_idContainer048" class="IMG---Figure">
					<img src="image/Figure_9.03_B15983.jpg" alt="Figure 9.3 – The Gatsby Cloud site dashboard&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 9.3 – The Gatsby Cloud site dashboard</p>
			<p>Once the build has been completed, you can see the deployed site live by following the purple hyperlink underneath the <strong class="bold">HOSTED ON GATSBY CLOUD </strong>heading in the preceding screenshot.</p>
			<p>With every <a id="_idIndexMarker502"/>subsequent push to the base branch, Gatsby Cloud <a id="_idIndexMarker503"/>will build and deploy the change automatically.</p>
			<p>Now that we understand how to deploy a hybrid build, let's look at the options we have for deploying static builds.</p>
			<h1 id="_idParaDest-132"><a id="_idTextAnchor134"/>Platforms for deploying static builds</h1>
			<p>As static <a id="_idIndexMarker504"/>builds are a far more common and predictable format, there are plenty more options for where you can host them. We have already looked at Gatsby Cloud, which can deploy static sites in the same way as it does hybrid. Now, let's look at three other platforms – Netlify, Render, and Firebase.</p>
			<h2 id="_idParaDest-133"><a id="_idTextAnchor135"/>Deploying to Netlify</h2>
			<p>Netlify is<a id="_idIndexMarker505"/> the<a id="_idIndexMarker506"/> deployment platform<a id="_idIndexMarker507"/> used for over 500,000 websites. It is popular among developers for its ease of use. It also provides a free <strong class="bold">Secure Sockets Layer</strong> (<strong class="bold">SSL</strong>). Let's<a id="_idIndexMarker508"/> learn how we can deploy our site with Netlify:</p>
			<ol>
				<li value="1">Install the Netlify plugin:<p class="source-code">npm install --save gatsby-plugin-netlify</p><p>Here, we are installing the Netlify plugin, which adds basic security headers during the build for the Netlify platform.</p></li>
				<li>Include the <strong class="source-inline">gatsby-plugin-netlify</strong> plugin in your <strong class="source-inline">gatsby-config.js</strong> file:<p class="source-code">module.exports = {</p><p class="source-code">  // rest of config</p><p class="source-code">  plugins: [</p><p class="source-code">    <strong class="bold">`gatsby-plugin-netlify`</strong>,</p><p class="source-code">   // other plugins</p><p class="source-code">  ]</p><p class="source-code">}</p></li>
				<li>Commit and push all changes to a Git repository.</li>
				<li>Navigate to <a href="https://app.netlify.com/signup">https://app.netlify.com/signup</a> in your browser.</li>
				<li>Sign up by logging in with the third-party login details provided by your VCS, and approve the requested permissions that the Netlify platform<a id="_idIndexMarker509"/> requires to integrate with it.</li>
				<li>Click<a id="_idIndexMarker510"/> on <strong class="bold">Create New Site</strong> from your dashboard:<div id="_idContainer049" class="IMG---Figure"><img src="image/Figure_9.04_B15983.jpg" alt="Figure 9.4 – The Netlify new site page&#13;&#10;"/></div><p class="figure-caption">Figure 9.4 – The Netlify new site page</p><p>Select the Git provider where your repository is stored. Then, pick the repository that you would like to build.</p></li>
				<li>You can leave the <strong class="bold">Owner</strong> option in its default setting. However, make sure that the deploy branch matches your site's main production branch:<div id="_idContainer050" class="IMG---Figure"><img src="image/Figure_9.05_B15983.jpg" alt="Figure 9.5 – The Netlify site creation settings&#13;&#10;"/></div><p class="figure-caption">Figure 9.5 – The Netlify site creation settings</p></li>
				<li>Finally, provide<a id="_idIndexMarker511"/> the <strong class="bold">Build command</strong> and <strong class="bold">Publish directory</strong> details <a id="_idIndexMarker512"/>for the site, which should be <strong class="source-inline">npm run build</strong> and <strong class="source-inline">public</strong>, respectively:<div id="_idContainer051" class="IMG---Figure"><img src="image/Figure_9.06_B15983.jpg" alt="Figure 9.6 – The Netlify site creation build settings&#13;&#10;"/></div><p class="figure-caption">Figure 9.6 – The Netlify site creation build settings</p></li>
				<li>Clicking on <strong class="bold">Deploy site</strong> will start the build process.</li>
				<li>While<a id="_idIndexMarker513"/> your<a id="_idIndexMarker514"/> site is building, take note of the URL, in blue, at the top of the dashboard. This is where your site will be deployed:</li>
			</ol>
			<div>
				<div id="_idContainer052" class="IMG---Figure">
					<img src="image/Figure_9.07_B15983.jpg" alt="Figure 9.7 – The Netlify site dashboard&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 9.7 – The Netlify site dashboard</p>
			<p>If everything <a id="_idIndexMarker515"/>goes well, your site should be deployed after <a id="_idIndexMarker516"/>a few minutes. With every subsequent push to the base branch, Netlify will build and deploy the change automatically.</p>
			<p>Now that we understand how to deploy with Netlify, let's look at another alternative – Render.</p>
			<h2 id="_idParaDest-134"><a id="_idTextAnchor136"/>Deploying to Render</h2>
			<p>Render <a id="_idIndexMarker517"/>is a<a id="_idIndexMarker518"/> cloud platform that can build and run Gatsby websites with free SSL and a global CDN. Let's learn how we can deploy our site with<a id="_idIndexMarker519"/> Render:</p>
			<ol>
				<li value="1">Commit and push all changes to a Git repository.</li>
				<li>Navigate to <a href="https://dashboard.render.com/register">https://dashboard.render.com/register</a>, and then create an account.</li>
				<li>From the dashboard, click on <strong class="bold">New</strong>:<div id="_idContainer053" class="IMG---Figure"><img src="image/Figure_9.08_B15983.jpg" alt="Figure 9.8 – The Render site dashboard&#13;&#10;"/></div><p class="figure-caption">Figure 9.8 – The Render site dashboard</p></li>
				<li>Select <strong class="bold">Static Site</strong>.</li>
				<li>At this point, you<a id="_idIndexMarker520"/> will be asked to present a<a id="_idIndexMarker521"/> repository. However, as you have not connected Render to your VCS, the list will be empty. Click on the hyperlink for your VCS and proceed to connect Render to that system by following the UI journey from that third party. In the case of GitHub, it will look something like this:<div id="_idContainer054" class="IMG---Figure"><img src="image/Figure_9.09_B15983.jpg" alt="Figure 9.9 – GitHub's third-party installation&#13;&#10;"/></div><p class="figure-caption">Figure 9.9 – GitHub's third-party installation</p></li>
				<li>The list <a id="_idIndexMarker522"/>should now be populated with your repositories. Select<a id="_idIndexMarker523"/> the one containing your Gatsby site. </li>
				<li>Next, configure your site settings:<div id="_idContainer055" class="IMG---Figure"><img src="image/Figure_9.10_B15983.jpg" alt="Figure 9.10 – The Render site settings &#13;&#10;"/></div><p class="figure-caption">Figure 9.10 – The Render site settings </p><p>The <strong class="bold">Name</strong> field can<a id="_idIndexMarker524"/> be anything you like, and the <strong class="bold">Branch</strong> field should be the branch of your repository that you would like to<a id="_idIndexMarker525"/> be deployed. Additionally, <strong class="bold">Build Command</strong> should be <strong class="source-inline">npm run build</strong>, and <strong class="bold">Publish directory</strong> should be <strong class="source-inline">./public</strong>.</p></li>
				<li>Click on <strong class="bold">Create Static Site</strong>.</li>
				<li>While your site is building, take note of the URL, in blue, at the top of the dashboard. This is where your site will be deployed:</li>
			</ol>
			<div>
				<div id="_idContainer056" class="IMG---Figure">
					<img src="image/Figure_9.11_B15983.jpg" alt="Figure 9.11 – The Render site dashboard&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 9.11 – The Render site dashboard</p>
			<p>If everything <a id="_idIndexMarker526"/>goes well, your site should be deployed after<a id="_idIndexMarker527"/> a few minutes. Check the URL to be sure. With every subsequent push to the base branch, Render will build and deploy the change automatically.</p>
			<p>Now that we understand how to deploy with Render, let's look at another alternative – Firebase.</p>
			<h2 id="_idParaDest-135"><a id="_idTextAnchor137"/>Deploying to Firebase</h2>
			<p>Firebase is <a id="_idIndexMarker528"/>Google's mobile development application. It<a id="_idIndexMarker529"/> allows you to focus on the frontend of your application by allowing you to manage your backend infrastructure through a no-code/low-code development UI. Firebase has <a id="_idIndexMarker530"/>a large number of features, including real-time databases, machine learning, Cloud Functions authentication, and – the feature we will be focusing on – hosting. Let's learn how we can deploy our site with Firebase:</p>
			<ol>
				<li value="1">Navigate to <a href="https://console.firebase.google.com">https://console.firebase.google.com</a>, and sign in with a Google account.</li>
				<li>Once logged in, you<a id="_idIndexMarker531"/> will be directed to the Firebase console. From there, click on <strong class="bold">Add Project</strong>.</li>
				<li>You will <a id="_idIndexMarker532"/>be prompted to give your project a name. Once entered, take note of your project ID, and click on <strong class="bold">Continue</strong>:<div id="_idContainer057" class="IMG---Figure"><img src="image/Figure_9.12_B15983.jpg" alt="Figure 9.12 – Firebase project naming&#13;&#10;"/></div><p class="figure-caption">Figure 9.12 – Firebase project naming</p></li>
				<li>At this point, you can optionally set up Google Analytics for your project. If you added Google Analytics to your site as part of <a href="B15983_08_ePub_RK.xhtml#_idTextAnchor116"><em class="italic">Chapter 8</em></a>, <em class="italic">Web Analytics and Performance Monitoring</em>, then do not set this up again here:<div id="_idContainer058" class="IMG---Figure"><img src="image/Figure_9.13_B15983.jpg" alt="Figure 9.13 – Setting up Firebase project analytics&#13;&#10;"/></div><p class="figure-caption">Figure 9.13 – Setting up Firebase project analytics</p></li>
				<li>Click on <strong class="bold">Create project</strong> – this will provision the Google Cloud services that are required <a id="_idIndexMarker533"/>for your project. Now we have set up <a id="_idIndexMarker534"/>everything we need within the Firebase platform and can return to the code.</li>
				<li>Install the Firebase CLI:<p class="source-code">npm install -g firebase-tools</p><p>This package allows us to integrate local projects with the Firebase platform. We can use the <strong class="source-inline">-g</strong> command to install it globally.</p></li>
				<li>Run the <strong class="source-inline">firebase login</strong> command:<p class="source-code">firebase login</p><p>This will open a browser window prompting you to log in with a Google account. Log in with the Google account that you signed up to Firebase with.</p></li>
				<li>Once <a id="_idIndexMarker535"/>complete, return to your Gatsby project's root directory and run the following:<p class="source-code">firebase init</p><p>This will <a id="_idIndexMarker536"/>trigger the Firebase initialization UI within our Gatsby project and present you with the following:</p><div id="_idContainer059" class="IMG---Figure"><img src="image/Figure_9.14_B15983.jpg" alt="Figure 9.14 – Firebase CLI project initialization&#13;&#10;"/></div><p class="figure-caption">Figure 9.14 – Firebase CLI project initialization</p><p>Within this project, we are only using hosting, so press the down arrow key until <strong class="bold">Hosting</strong> is selected. Then, hit the spacebar to select it followed by <em class="italic">Enter</em> to confirm your choice. </p></li>
				<li>Firebase will then ask you which Firebase project to associate with this directory:<div id="_idContainer060" class="IMG---Figure"><img src="image/Figure_9.15_B15983.jpg" alt="Figure 9.15 – Setting up the Firebase CLI project &#13;&#10;"/></div><p class="figure-caption">Figure 9.15 – Setting up the Firebase CLI project </p><p>We have already created a Firebase project, so ensure <strong class="bold">Use an existing project</strong> is selected and hit <em class="italic">Enter</em>. </p></li>
				<li>Use the<a id="_idIndexMarker537"/> up <a id="_idIndexMarker538"/>and down arrow keys to select the project ID that we created in <em class="italic">Step 3</em> (the project name should be visible in brackets next to the ID). Then, hit <em class="italic">Enter</em>.</li>
				<li>Tell Firebase where to find the static build during the hosting setup: <div id="_idContainer061" class="IMG---Figure"><img src="image/Figure_9.16_B15983.jpg" alt="Figure 9.16 – Setting up Firebase CLI hosting &#13;&#10;"/></div><p class="figure-caption">Figure 9.16 – Setting up Firebase CLI hosting </p><p>By default, Firebase uses the <strong class="source-inline">public</strong> directory, so we can hit <em class="italic">Enter</em> without changing this.</p></li>
				<li>Then, it will ask you whether you would like it to configure your application as a single-page app. Type in <strong class="source-inline">n</strong> and hit <em class="italic">Enter</em>.</li>
				<li>Finally, it will ask whether you want to set up automatic deploys with GitHub. Type in <strong class="source-inline">n</strong> and hit <em class="italic">Enter</em>. You can change this in the future if needed, but for now, we will focus on manual deployments.</li>
				<li>We now <a id="_idIndexMarker539"/>have everything in place ready to deploy to Firebase. Run the following command:<p class="source-code">gatsby build &amp;&amp; firebase deploy</p><p>As we <a id="_idIndexMarker540"/>already know, <strong class="source-inline">gatsby build</strong> will create a production-ready build of our site. Then, the <strong class="source-inline">firebase deploy</strong> command will take our build and upload it to the Firebase platform, ready to be served to site visitors:</p></li>
			</ol>
			<div>
				<div id="_idContainer062" class="IMG---Figure">
					<img src="image/Figure_9.17_B15983.jpg" alt="Figure 9.17 – Deploying the Firebase CLI &#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 9.17 – Deploying the Firebase CLI </p>
			<p>At the end of the Firebase deployment, it will log a <strong class="bold">Hosting URL</strong> to the terminal. Navigate to this link in a browser to see your deployed application.</p>
			<p class="callout-heading">Quick Tip</p>
			<p class="callout">As you might have noticed from these instructions, Firebase is the only platform in this list that does not require you to push your code to a VCS. If you have a project where you do not wish to use a VCS, this is a great choice. It's important to note that, unlike the other platforms, Firebase will not automatically deploy your project unless it has been set up as part of a deployment pipeline. </p>
			<p>We have now looked at a multitude of different ways to deploy our site onto the internet. If you <a id="_idIndexMarker541"/>have completed any of the implementations <a id="_idIndexMarker542"/>discussed in the previous sections, you should be able to send a friend the site URL, and they should be able to see it. However, what if you don't want your site to be visible to everyone but only a selected few? Next, let's look at how we can reduce the level of access to our site for when the situation requires it.</p>
			<h1 id="_idParaDest-136"><a id="_idTextAnchor138"/>Serving a Gatsby site with reduced user access</h1>
			<p>You <a id="_idIndexMarker543"/>might be asking yourself why you would ever want to reduce the access to your site. One word – security. In all the examples we have seen so far, our site is public and out there on the internet for all to see, but what if you are building an application that is only for a selected group of people? Perhaps it's portfolio work that you want to have locked behind a password or an onboarding application that should only be available to colleagues at a specific company. We can achieve functionalities such as these using most backend web applications. </p>
			<p class="callout-heading">Important Note</p>
			<p class="callout">This type of authentication is not to be confused with that of <a href="B15983_11_ePub_RK.xhtml#_idTextAnchor152"><em class="italic">Chapter 11</em></a>, <em class="italic">Creating Authenticated Experiences</em>. Here, we are restricting access to the entirety of the site unless you have been approved. In <a href="B15983_11_ePub_RK.xhtml#_idTextAnchor152"><em class="italic">Chapter 11</em></a>, <em class="italic">Creating Authenticated Experiences</em>, access is only partially restricted, as we allow users to visit parts of the application without logging in.</p>
			<p>As an example, let's explore how we can use Express to introduce a password login to our site:</p>
			<ol>
				<li value="1">Install the dependencies:<p class="source-code">npm i express express-basic-auth</p><p>We will be using Express as our backend and <strong class="source-inline">express-basic-auth</strong> to implement HTTP basic authorization as middleware.</p></li>
				<li>At the<a id="_idIndexMarker544"/> root of your Gatsby project, create a <strong class="source-inline">server.js</strong> file with the following: <p class="source-code">const express = require("express");</p><p class="source-code">const app = express();</p><p class="source-code">const basicAuth = require("express-basic-auth");</p><p class="source-code">const port = 3000;</p><p class="source-code">app.use(</p><p class="source-code">  basicAuth({</p><p class="source-code">    challenge: true,</p><p class="source-code">    users: { admin: "testing" },</p><p class="source-code">  })</p><p class="source-code">);</p><p class="source-code">app.use(express.static(`${__dirname}/public`));</p><p class="source-code">app.listen(port, () =&gt; {</p><p class="source-code">  console.log(`Example app listening at</p><p class="source-code">    http://localhost:${port}`);</p><p class="source-code">});</p><p>First, we create an <strong class="source-inline">express</strong> app. Then, we instruct it to use the <strong class="source-inline">express-basic-auth</strong> middleware. You will see that we are passing an object that instructs the middleware to challenge the user. When a user navigates to the site, before seeing any content, they will be prompted with the following dialog box:</p><div id="_idContainer063" class="IMG---Figure"><img src="image/Figure_9.18_B15983.jpg" alt="Figure 9.18 – Basic auth challenge dialog box&#13;&#10;"/></div><p class="figure-caption">Figure 9.18 – Basic auth challenge dialog box</p><p>They will only be allowed onto the site if the credentials they provide match those in the <strong class="source-inline">users</strong> object provided to <strong class="source-inline">basicAuth</strong>. </p><p>Assuming<a id="_idIndexMarker545"/> they successfully pass this middleware check, we then allow them to view the static content of our site using the <strong class="source-inline">express.static()</strong> method.</p></li>
				<li>Modify your scripts in <strong class="source-inline">package.json</strong> to include a <strong class="source-inline">start:server</strong> script:<p class="source-code">"scripts": {</p><p class="source-code">    ...</p><p class="source-code">    "start:server": "node server.js"</p><p class="source-code">  },</p><p>This script will run our <strong class="source-inline">server.js</strong> file using Node.js.</p></li>
				<li>We now have everything in place to try our server:<p class="source-code">gatsby build &amp;&amp; npm run start:server</p><p>This will build your Gatsby project and then run your server code, which will serve up your Gatsby build content. If all has gone well, you should be able to visit <strong class="source-inline">localhost:3000</strong> and see this implementation working. Upon entering the username and password that has been specified on the server, you should be able to see your Gatsby application.</p></li>
			</ol>
			<p>All the other<a id="_idIndexMarker546"/> static deployment methods we have looked at within this chapter have assumed that the Gatsby project is being hosted on its own dedicated server, but sometimes, you don't always have the luxury of multiple servers. This example is also a great demonstration of how you can combine backend and frontend code on a single server. You could use a similar approach to lock down your site to certain IP ranges. For instance, we could expand upon this Express server to serve API endpoints alongside our Gatsby project within the same repository. </p>
			<p class="callout-heading">Quick Tip</p>
			<p class="callout">You might be wondering how to deploy a site using this functionality – deploying Express servers is beyond the remit of this book, but platforms that support this include Heroku, Render, and Google Cloud.</p>
			<p>Now, let's take a moment to summarize what we have learned in this chapter.</p>
			<h1 id="_idParaDest-137"><a id="_idTextAnchor139"/>Summary</h1>
			<p>In this chapter, we investigated the builds that a Gatsby project can create and the differences between them. We looked at common errors that crop up during build time and how we can debug them. We learned how we can deploy hybrid builds using Gatsby Cloud and how we can deploy static builds with Netlify, Render, and Firebase. Additionally, we discovered how we can lock down access to our site by serving it up as part of an Express server. You should now feel comfortable with the process of taking your site live. </p>
			<p>In the next chapter, we will start looking at more advanced concepts. We will begin by learning about Gatsby's plugin creation. </p>
		</div>
	</body></html>