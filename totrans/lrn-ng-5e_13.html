<html><head></head><body>
  <div class="Basic-Text-Frame" id="_idContainer328">
   <h1 class="chapterNumber">
    <span class="koboSpan" id="kobo.1.1">
     13
    </span>
   </h1>
   <h1 class="chapterTitle" id="_idParaDest-234">
    <span class="koboSpan" id="kobo.2.1">
     Unit Testing Angular Applications
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.3.1">
     In the previous chapters, we went through many aspects of how to build an Angular enterprise application from scratch.
    </span>
    <span class="koboSpan" id="kobo.3.2">
     But how can we ensure that an application can be maintained in the future without much hassle?
    </span>
    <span class="koboSpan" id="kobo.3.3">
     A comprehensive automated testing layer can become our lifeline once our application begins to scale up and we have to mitigate the impact of bugs.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.4.1">
     Testing, specifically unit testing, is meant to be carried out by the developer as the project is being developed.
    </span>
    <span class="koboSpan" id="kobo.4.2">
     Now that our knowledge of the framework is mature, we will briefly cover all the intricacies of unit testing an Angular application in this chapter including the use of testing tools..
    </span>
   </p>
   <div class="note">
    <p class="normal">
     <span class="koboSpan" id="kobo.5.1">
      For simplicity, the examples in this chapter are not related to the e-shop application that we have built throughout the book.
     </span>
    </p>
   </div>
   <p class="normal">
    <span class="koboSpan" id="kobo.6.1">
     In more detail, we will learn about the following:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.7.1">
      Why do we need unit tests?
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.8.1">
      The anatomy of a unit test
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.9.1">
      Introducing unit tests in Angular
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.10.1">
      Testing components
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.11.1">
      Testing services
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.12.1">
      Testing pipes
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.13.1">
      Testing directives
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.14.1">
      Testing forms
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.15.1">
      Testing the router
     </span>
    </li>
   </ul>
   <h1 class="heading-1" id="_idParaDest-235">
    <span class="koboSpan" id="kobo.16.1">
     Technical requirements
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.17.1">
     The chapter contains various code samples to walk you through the concept of unit testing in Angular.
    </span>
    <span class="koboSpan" id="kobo.17.2">
     You can find the related source code in the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.18.1">
      ch13
     </span>
    </code>
    <span class="koboSpan" id="kobo.19.1">
     folder of the following GitHub repository:
    </span>
   </p>
   <p class="normal">
    <a href="https://www.github.com/PacktPublishing/Learning-Angular-Fifth-Edition">
     <span class="url">
      <span class="koboSpan" id="kobo.20.1">
       https://www.github.com/PacktPublishing/Learning-Angular-Fifth-Edition
      </span>
     </span>
    </a>
    <span class="koboSpan" id="kobo.21.1">
     .
    </span>
   </p>
   <h1 class="heading-1" id="_idParaDest-236">
    <span class="koboSpan" id="kobo.22.1">
     Why do we need unit tests?
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.23.1">
     In this section, we will learn what unit tests are and why they are useful in web development.
    </span>
   </p>
   <div class="note">
    <p class="normal">
     <span class="koboSpan" id="kobo.24.1">
      You can skip to the next section if you’re familiar with unit testing and test-driven development.
     </span>
    </p>
   </div>
   <p class="normal">
    <span class="koboSpan" id="kobo.25.1">
     Unit tests
    </span>
    <a id="_idIndexMarker773">
    </a>
    <span class="koboSpan" id="kobo.26.1">
     are part of an engineering philosophy for efficient and agile development processes.
    </span>
    <span class="koboSpan" id="kobo.26.2">
     They add a layer of automated testing to the application code before it is developed.
    </span>
    <span class="koboSpan" id="kobo.26.3">
     The core concept is that a piece of code is accompanied by its test, both of which are built by the developer who works on that code.
    </span>
    <span class="koboSpan" id="kobo.26.4">
     First, we design the test against the feature we want to deliver, checking the accuracy of its output and behavior.
    </span>
    <span class="koboSpan" id="kobo.26.5">
     Since the feature is still not implemented, the test will fail, so the developer’s job is to build the feature to pass the test.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.27.1">
     Unit testing is quite controversial.
    </span>
    <span class="koboSpan" id="kobo.27.2">
     While test-driven development is beneficial for ensuring code quality and maintenance over time, not everybody undertakes unit testing in their daily development workflow.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.28.1">
     Building tests as we develop our code can sometimes feel like a burden, especially when the test results become larger than the functionality it aims to test.
    </span>
    <span class="koboSpan" id="kobo.28.2">
     However, the arguments in favor of testing outnumber the arguments against it:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.29.1">
      Building tests
     </span>
     <a id="_idIndexMarker774">
     </a>
     <span class="koboSpan" id="kobo.30.1">
      contributes to better code design.
     </span>
     <span class="koboSpan" id="kobo.30.2">
      Our code must conform to the test requirements and not vice versa.
     </span>
     <span class="koboSpan" id="kobo.30.3">
      If we try to test an existing piece of code and find ourselves blocked at some point, the chances are that the code is not well designed and requires some rethinking.
     </span>
     <span class="koboSpan" id="kobo.30.4">
      On the other hand, building testable features can help with the early detection of side effects.
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.31.1">
      Refactoring tested code is a lifeline against introducing bugs in later stages.
     </span>
     <span class="koboSpan" id="kobo.31.2">
      Development is meant to evolve with time, and the risk of introducing a bug with every refactor is high.
     </span>
     <span class="koboSpan" id="kobo.31.3">
      Unit tests are an excellent way to ensure we catch bugs early, either when introducing new features or updating existing ones.
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.32.1">
      Building tests
     </span>
     <a id="_idIndexMarker775">
     </a>
     <span class="koboSpan" id="kobo.33.1">
      is an excellent way to document our code.
     </span>
     <span class="koboSpan" id="kobo.33.2">
      It becomes a priceless resource when someone unfamiliar with the code base takes over the development endeavor.
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.34.1">
     These are only a few arguments, but you can find countless resources on the web about the benefits of testing your code.
    </span>
    <span class="koboSpan" id="kobo.34.2">
     If you do not feel convinced yet, give it a try; otherwise, let’s continue with our journey and look at the overall form of a unit test.
    </span>
   </p>
   <h1 class="heading-1" id="_idParaDest-237">
    <span class="koboSpan" id="kobo.35.1">
     The anatomy of a unit test
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.36.1">
     There are many different
    </span>
    <a id="_idIndexMarker776">
    </a>
    <span class="koboSpan" id="kobo.37.1">
     ways to test a piece of code.
    </span>
    <span class="koboSpan" id="kobo.37.2">
     In this chapter, we will look at the anatomy of a unit test—the separate parts it’s made of.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.38.1">
     To test any code, we need a framework for writing the test and a runner to run it on.
    </span>
    <span class="koboSpan" id="kobo.38.2">
     In this section, we will focus on the test framework.
    </span>
    <span class="koboSpan" id="kobo.38.3">
     The test framework should provide utility functions for building test suites containing one or several test specs.
    </span>
    <span class="koboSpan" id="kobo.38.4">
     As a result, unit testing involves the following concepts:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.39.1">
       Test suite
      </span>
     </strong>
     <span class="koboSpan" id="kobo.40.1">
      : A
     </span>
     <a id="_idIndexMarker777">
     </a>
     <span class="koboSpan" id="kobo.41.1">
      suite that
     </span>
     <a id="_idIndexMarker778">
     </a>
     <span class="koboSpan" id="kobo.42.1">
      creates a logical grouping for many tests.
     </span>
     <span class="koboSpan" id="kobo.42.2">
      A suite, for example, can contain all the tests for a specific feature.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.43.1">
       Test spec
      </span>
     </strong>
     <span class="koboSpan" id="kobo.44.1">
      : The actual
     </span>
     <a id="_idIndexMarker779">
     </a>
     <span class="koboSpan" id="kobo.45.1">
      unit
     </span>
     <a id="_idIndexMarker780">
     </a>
     <span class="koboSpan" id="kobo.46.1">
      test.
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.47.1">
     We will use
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.48.1">
      Jasmine
     </span>
    </strong>
    <span class="koboSpan" id="kobo.49.1">
     in this
    </span>
    <a id="_idIndexMarker781">
    </a>
    <span class="koboSpan" id="kobo.50.1">
     chapter, a popular test framework that is also used by default in Angular CLI projects.
    </span>
    <span class="koboSpan" id="kobo.50.2">
     This is what a unit test looks like in Jasmine:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.51.1">describe</span></span><span class="koboSpan" id="kobo.52.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.53.1">'Calculator'</span></span><span class="koboSpan" id="kobo.54.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.55.1">() =&gt;</span></span><span class="koboSpan" id="kobo.56.1"> {
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.57.1">it</span></span><span class="koboSpan" id="kobo.58.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.59.1">'should add two numbers'</span></span><span class="koboSpan" id="kobo.60.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.61.1">() =&gt;</span></span><span class="koboSpan" id="kobo.62.1"> {
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.63.1">expect</span></span><span class="koboSpan" id="kobo.64.1">(</span><span class="hljs-number"><span class="koboSpan" id="kobo.65.1">1</span></span><span class="koboSpan" id="kobo.66.1">+</span><span class="hljs-number"><span class="koboSpan" id="kobo.67.1">1</span></span><span class="koboSpan" id="kobo.68.1">).</span><span class="hljs-title"><span class="koboSpan" id="kobo.69.1">toBe</span></span><span class="koboSpan" id="kobo.70.1">(</span><span class="hljs-number"><span class="koboSpan" id="kobo.71.1">2</span></span><span class="koboSpan" id="kobo.72.1">);
  });
});
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.73.1">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.74.1">
      describe
     </span>
    </code>
    <span class="koboSpan" id="kobo.75.1">
     method defines the test suite and accepts a name and an arrow function as parameters.
    </span>
    <span class="koboSpan" id="kobo.75.2">
     The arrow function is the body of the test suite and contains several unit tests.
    </span>
    <span class="koboSpan" id="kobo.75.3">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.76.1">
      it
     </span>
    </code>
    <span class="koboSpan" id="kobo.77.1">
     method defines a single unit test.
    </span>
    <span class="koboSpan" id="kobo.77.2">
     It accepts a name and an arrow function as parameters.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.78.1">
     Each
    </span>
    <a id="_idIndexMarker782">
    </a>
    <span class="koboSpan" id="kobo.79.1">
     test spec validates a specific functionality of the feature described in the suite name and declares one or several expectations in its body.
    </span>
    <span class="koboSpan" id="kobo.79.2">
     Each expectation takes a value, called the
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.80.1">
      expected
     </span>
    </strong>
    <span class="koboSpan" id="kobo.81.1">
     value, which is compared against an
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.82.1">
      actual
     </span>
    </strong>
    <span class="koboSpan" id="kobo.83.1">
     value using a
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.84.1">
      matcher
     </span>
    </strong>
    <span class="koboSpan" id="kobo.85.1">
     function.
    </span>
    <span class="koboSpan" id="kobo.85.2">
     The function checks whether the expected and actual values match accordingly, which is called an
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.86.1">
      assertion
     </span>
    </strong>
    <span class="koboSpan" id="kobo.87.1">
     .
    </span>
    <span class="koboSpan" id="kobo.87.2">
     The
    </span>
    <a id="_idIndexMarker783">
    </a>
    <span class="koboSpan" id="kobo.88.1">
     test framework passes or fails the spec depending on the result of such assertions.
    </span>
    <span class="koboSpan" id="kobo.88.2">
     In the previous example,
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.89.1">
      1+1
     </span>
    </code>
    <span class="koboSpan" id="kobo.90.1">
     will return the actual value that is supposed to match the expected value,
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.91.1">
      2
     </span>
    </code>
    <span class="koboSpan" id="kobo.92.1">
     , declared in the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.93.1">
      toBe
     </span>
    </code>
    <span class="koboSpan" id="kobo.94.1">
     matcher function.
    </span>
   </p>
   <div class="note">
    <p class="normal">
     <span class="koboSpan" id="kobo.95.1">
      The Jasmine framework contains various matcher functions according to user-specific needs, as we will see later in the chapter.
     </span>
    </p>
   </div>
   <p class="normal">
    <span class="koboSpan" id="kobo.96.1">
     Suppose the previous code
    </span>
    <a id="_idIndexMarker784">
    </a>
    <span class="koboSpan" id="kobo.97.1">
     contains another mathematical operation that must be tested.
    </span>
    <span class="koboSpan" id="kobo.97.2">
     It would make sense to group both operations under the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.98.1">
      Calculator
     </span>
    </code>
    <span class="koboSpan" id="kobo.99.1">
     suite, as follows:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.100.1">describe</span></span><span class="koboSpan" id="kobo.101.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.102.1">'Calculator'</span></span><span class="koboSpan" id="kobo.103.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.104.1">() =&gt;</span></span><span class="koboSpan" id="kobo.105.1"> {
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.106.1">it</span></span><span class="koboSpan" id="kobo.107.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.108.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.109.1">should add two numbers'</span></span><span class="koboSpan" id="kobo.110.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.111.1">() =&gt;</span></span><span class="koboSpan" id="kobo.112.1"> {
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.113.1">expect</span></span><span class="koboSpan" id="kobo.114.1">(</span><span class="hljs-number"><span class="koboSpan" id="kobo.115.1">1</span></span><span class="koboSpan" id="kobo.116.1">+</span><span class="hljs-number"><span class="koboSpan" id="kobo.117.1">1</span></span><span class="koboSpan" id="kobo.118.1">).</span><span class="hljs-title"><span class="koboSpan" id="kobo.119.1">toBe</span></span><span class="koboSpan" id="kobo.120.1">(</span><span class="hljs-number"><span class="koboSpan" id="kobo.121.1">2</span></span><span class="koboSpan" id="kobo.122.1">);
  });
  </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.123.1">it('should subtract two numbers', () =&gt; {</span></strong></span>
    <span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.124.1">expect(1-1).toBe(0);</span></strong></span>
  <span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.125.1">});</span></strong></span><span class="koboSpan" id="kobo.126.1">
});
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.127.1">
     So far, we have learned about test suites and how to use them to group tests according to their functionality.
    </span>
    <span class="koboSpan" id="kobo.127.2">
     Furthermore, we have learned about invoking the code we want to test and affirming that it does what it should do.
    </span>
    <span class="koboSpan" id="kobo.127.3">
     However, more concepts are involved in unit tests that are worth knowing about, namely, the
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.128.1">
      setup
     </span>
    </strong>
    <span class="koboSpan" id="kobo.129.1">
     and
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.130.1">
      teardown
     </span>
    </strong>
    <span class="koboSpan" id="kobo.131.1">
     functionalities.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.132.1">
     A setup functionality
    </span>
    <a id="_idIndexMarker785">
    </a>
    <span class="koboSpan" id="kobo.133.1">
     prepares your code before you start running the tests.
    </span>
    <span class="koboSpan" id="kobo.133.2">
     It’s a way to keep your code clean by focusing on invoking the code and checking the assertions.
    </span>
    <span class="koboSpan" id="kobo.133.3">
     A teardown functionality
    </span>
    <a id="_idIndexMarker786">
    </a>
    <span class="koboSpan" id="kobo.134.1">
     is the opposite.
    </span>
    <span class="koboSpan" id="kobo.134.2">
     It is responsible for tearing down what we initially set up, involving activities such as cleaning up resources.
    </span>
    <span class="koboSpan" id="kobo.134.3">
     Let’s see what this looks like in practice with a code example:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.135.1">describe</span></span><span class="koboSpan" id="kobo.136.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.137.1">'Calculator'</span></span><span class="koboSpan" id="kobo.138.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.139.1">() =&gt;</span></span><span class="koboSpan" id="kobo.140.1"> {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.141.1">let</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.142.1">total</span></span><span class="koboSpan" id="kobo.143.1">: </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.144.1">number</span></span><span class="koboSpan" id="kobo.145.1">;
  </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.146.1">beforeEach(() =&gt; total = 1);</span></strong></span>
  <span class="hljs-title"><span class="koboSpan" id="kobo.147.1">it</span></span><span class="koboSpan" id="kobo.148.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.149.1">'should add two numbers'</span></span><span class="koboSpan" id="kobo.150.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.151.1">() =&gt;</span></span><span class="koboSpan" id="kobo.152.1"> {
    total = total + </span><span class="hljs-number"><span class="koboSpan" id="kobo.153.1">1</span></span><span class="koboSpan" id="kobo.154.1">;
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.155.1">expect</span></span><span class="koboSpan" id="kobo.156.1">(total).</span><span class="hljs-title"><span class="koboSpan" id="kobo.157.1">toBe</span></span><span class="koboSpan" id="kobo.158.1">(</span><span class="hljs-number"><span class="koboSpan" id="kobo.159.1">2</span></span><span class="koboSpan" id="kobo.160.1">);
  });
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.161.1">it</span></span><span class="koboSpan" id="kobo.162.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.163.1">'should subtract two numbers'</span></span><span class="koboSpan" id="kobo.164.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.165.1">() =&gt;</span></span><span class="koboSpan" id="kobo.166.1"> {
    total = total - </span><span class="hljs-number"><span class="koboSpan" id="kobo.167.1">1</span></span><span class="koboSpan" id="kobo.168.1">;
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.169.1">expect</span></span><span class="koboSpan" id="kobo.170.1">(total).</span><span class="hljs-title"><span class="koboSpan" id="kobo.171.1">toBe</span></span><span class="koboSpan" id="kobo.172.1">(</span><span class="hljs-number"><span class="koboSpan" id="kobo.173.1">0</span></span><span class="koboSpan" id="kobo.174.1">);
  });
  </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.175.1">afterEach(() =&gt; total = 0);</span></strong></span><span class="koboSpan" id="kobo.176.1">
});
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.177.1">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.178.1">
      beforeEach
     </span>
    </code>
    <span class="koboSpan" id="kobo.179.1">
     method is used for the setup functionality and runs before every unit test.
    </span>
    <span class="koboSpan" id="kobo.179.2">
     In this example, we set the value of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.180.1">
      total
     </span>
    </code>
    <span class="koboSpan" id="kobo.181.1">
     variable to
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.182.1">
      1
     </span>
    </code>
    <span class="koboSpan" id="kobo.183.1">
     before each test.
    </span>
    <span class="koboSpan" id="kobo.183.2">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.184.1">
      afterEach
     </span>
    </code>
    <span class="koboSpan" id="kobo.185.1">
     method is used to run teardown logic.
    </span>
    <span class="koboSpan" id="kobo.185.2">
     After each test, we reset the value of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.186.1">
      total
     </span>
    </code>
    <span class="koboSpan" id="kobo.187.1">
     variable to
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.188.1">
      0
     </span>
    </code>
    <span class="koboSpan" id="kobo.189.1">
     .
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.190.1">
     It is evident that the test
    </span>
    <a id="_idIndexMarker787">
    </a>
    <span class="koboSpan" id="kobo.191.1">
     only has to care about invoking application code and asserting the outcome, which makes tests cleaner; however, tests tend to have much more setup in a real-world application.
    </span>
    <span class="koboSpan" id="kobo.191.2">
     Most importantly, the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.192.1">
      beforeEach
     </span>
    </code>
    <span class="koboSpan" id="kobo.193.1">
     method tends to make it easier to add new tests, which is great.
    </span>
    <span class="koboSpan" id="kobo.193.2">
     We want well-tested code; the easier it is to write and maintain such code, the better for our software.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.194.1">
     Now that we have covered the basics of a unit test, let’s see how we can implement them in the context of the Angular framework.
    </span>
   </p>
   <h1 class="heading-1" id="_idParaDest-238">
    <span class="koboSpan" id="kobo.195.1">
     Introducing unit tests in Angular
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.196.1">
     In the previous section, we
    </span>
    <a id="_idIndexMarker788">
    </a>
    <span class="koboSpan" id="kobo.197.1">
     familiarized ourselves with unit testing and its general concepts, such as test suites, test specs, and assertions.
    </span>
    <span class="koboSpan" id="kobo.197.2">
     It is time to venture into unit testing with Angular, armed with that knowledge.
    </span>
    <span class="koboSpan" id="kobo.197.3">
     Before we start writing tests for Angular, though, let’s have a look at the tooling that the
    </span>
    <a id="_idIndexMarker789">
    </a>
    <span class="koboSpan" id="kobo.198.1">
     Angular framework and the Angular CLI provide us with:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.199.1">
       Jasmine
      </span>
     </strong>
     <span class="koboSpan" id="kobo.200.1">
      : We have
     </span>
     <a id="_idIndexMarker790">
     </a>
     <span class="koboSpan" id="kobo.201.1">
      already learned that this is the testing framework.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.202.1">
       Karma
      </span>
     </strong>
     <span class="koboSpan" id="kobo.203.1">
      : The test
     </span>
     <a id="_idIndexMarker791">
     </a>
     <span class="koboSpan" id="kobo.204.1">
      runner for running our unit tests.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.205.1">
       Angular testing utilities
      </span>
     </strong>
     <span class="koboSpan" id="kobo.206.1">
      : A set of helper methods that assist us in setting up our unit tests and writing our assertions
     </span>
     <a id="_idIndexMarker792">
     </a>
     <span class="koboSpan" id="kobo.207.1">
      in the context of the Angular framework.
     </span>
    </li>
   </ul>
   <div class="note">
    <p class="normal">
     <span class="koboSpan" id="kobo.208.1">
      When we use the Angular CLI, we do not have to do anything to configure Jasmine and Karma in an Angular application.
     </span>
     <span class="koboSpan" id="kobo.208.2">
      Unit testing works out of the box when we create a new Angular CLI project.
     </span>
     <span class="koboSpan" id="kobo.208.3">
      Most of the time, we will interact with the Angular testing utilities.
     </span>
    </p>
   </div>
   <p class="normal">
    <span class="koboSpan" id="kobo.209.1">
     Angular testing utilities help us to create a testing environment that makes writing tests for our Angular artifacts easy.
    </span>
    <span class="koboSpan" id="kobo.209.2">
     It consists of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.210.1">
      TestBed
     </span>
    </code>
    <span class="koboSpan" id="kobo.211.1">
     class and various helper methods in the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.212.1">
      @angular/core/testing
     </span>
    </code>
    <span class="koboSpan" id="kobo.213.1">
     namespace.
    </span>
    <span class="koboSpan" id="kobo.213.2">
     As this chapter progresses, we will learn what these are and how they can help us test various artifacts.
    </span>
    <span class="koboSpan" id="kobo.213.3">
     For now, let’s have a look at the most commonly used concepts so that you are familiar with them when we look at them in more detail later on:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.214.1">
       TestBed
      </span>
     </code>
     <span class="koboSpan" id="kobo.215.1">
      : A class that creates a testing module.
     </span>
     <span class="koboSpan" id="kobo.215.2">
      We attach an Angular artifact to this testing module when we test it.
     </span>
     <span class="koboSpan" id="kobo.215.3">
      The
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.216.1">
       TestBed
      </span>
     </code>
     <span class="koboSpan" id="kobo.217.1">
      class contains the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.218.1">
       configureTestingModule
      </span>
     </code>
     <span class="koboSpan" id="kobo.219.1">
      method we use to set up the test module as needed.
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.220.1">
       ComponentFixture
      </span>
     </code>
     <span class="koboSpan" id="kobo.221.1">
      : A wrapper class around an Angular component instance.
     </span>
     <span class="koboSpan" id="kobo.221.2">
      It allows us to interact with the component and its corresponding HTML element.
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.222.1">
       DebugElement
      </span>
     </code>
     <span class="koboSpan" id="kobo.223.1">
      : A wrapper around the DOM element of the component.
     </span>
     <span class="koboSpan" id="kobo.223.2">
      It is an abstraction that operates cross-platform so that our tests are platform-independent.
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.224.1">
     Now that we know our testing environment and the frameworks and libraries used, we can start writing our first unit tests in Angular.
    </span>
   </p>
   <div class="note">
    <p class="normal">
     <span class="koboSpan" id="kobo.225.1">
      All the examples described in this chapter have been created in a new Angular CLI project.
     </span>
    </p>
   </div>
   <p class="normal">
    <span class="koboSpan" id="kobo.226.1">
     We will embark on this great journey from the most fundamental building block in Angular, the component.
    </span>
   </p>
   <h1 class="heading-1" id="_idParaDest-239">
    <span class="koboSpan" id="kobo.227.1">
     Testing components
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.228.1">
     You may have noticed that
    </span>
    <a id="_idIndexMarker793">
    </a>
    <span class="koboSpan" id="kobo.229.1">
     whenever we used the Angular CLI to scaffold a new Angular application or generate an Angular artifact, it created some test files for us.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.230.1">
     Test files in the Angular CLI contain the word
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.231.1">
      spec
     </span>
    </code>
    <span class="koboSpan" id="kobo.232.1">
     in their filename.
    </span>
    <span class="koboSpan" id="kobo.232.2">
     The filename of a test is the same as the Angular artifact it is testing, followed by the suffix
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.233.1">
      .spec.ts
     </span>
    </code>
    <span class="koboSpan" id="kobo.234.1">
     .
    </span>
    <span class="koboSpan" id="kobo.234.2">
     For example, the test file for the main component of an Angular application is
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.235.1">
      app.component.spec.ts
     </span>
    </code>
    <span class="koboSpan" id="kobo.236.1">
     and it resides in the same path as the component file.
    </span>
   </p>
   <div class="packt_tip">
    <p class="normal">
     <span class="koboSpan" id="kobo.237.1">
      We should consider an Angular artifact and its corresponding test one thing.
     </span>
     <span class="koboSpan" id="kobo.237.2">
      When we change the logic of the artifact, we may need to modify the unit test as well.
     </span>
     <span class="koboSpan" id="kobo.237.3">
      Placing unit test files with their Angular artifacts makes it easier for us to remember and edit them.
     </span>
     <span class="koboSpan" id="kobo.237.4">
      It also helps us when we need to refactor our code, such as moving artifacts (not forgetting to move the unit test).
     </span>
    </p>
   </div>
   <p class="normal">
    <span class="koboSpan" id="kobo.238.1">
     When we scaffold a new Angular application, the Angular CLI automatically creates a test for the main component,
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.239.1">
      AppComponent
     </span>
    </code>
    <span class="koboSpan" id="kobo.240.1">
     .
    </span>
    <span class="koboSpan" id="kobo.240.2">
     At the beginning of the file, there is a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.241.1">
      beforeEach
     </span>
    </code>
    <span class="koboSpan" id="kobo.242.1">
     statement that is used for setup purposes:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.243.1">beforeEach</span></span><span class="koboSpan" id="kobo.244.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.245.1">async</span></span><span class="koboSpan" id="kobo.246.1"> () =&gt; {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.247.1">await</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.248.1">TestBed</span></span><span class="koboSpan" id="kobo.249.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.250.1">configureTestingModule</span></span><span class="koboSpan" id="kobo.251.1">({
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.252.1">imports</span></span><span class="koboSpan" id="kobo.253.1">: [</span><span class="hljs-title"><span class="koboSpan" id="kobo.254.1">AppComponent</span></span><span class="koboSpan" id="kobo.255.1">],
  }).</span><span class="hljs-title"><span class="koboSpan" id="kobo.256.1">compileComponents</span></span><span class="koboSpan" id="kobo.257.1">();
});
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.258.1">
     It uses the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.259.1">
      configureTestingModule
     </span>
    </code>
    <span class="koboSpan" id="kobo.260.1">
     method of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.261.1">
      TestBed
     </span>
    </code>
    <span class="koboSpan" id="kobo.262.1">
     class and passes an object as a parameter.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.263.1">
     We can specify an
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.264.1">
      imports
     </span>
    </code>
    <span class="koboSpan" id="kobo.265.1">
     array that contains the component we want to test.
    </span>
    <span class="koboSpan" id="kobo.265.2">
     Additionally, we can define teardown options using the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.266.1">
      teardown
     </span>
    </code>
    <span class="koboSpan" id="kobo.267.1">
     property.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.268.1">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.269.1">
      teardown
     </span>
    </code>
    <span class="koboSpan" id="kobo.270.1">
     property contains an object of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.271.1">
      ModuleTeardownOptions
     </span>
    </code>
    <span class="koboSpan" id="kobo.272.1">
     type that can set the following properties:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.273.1">
       destroyAfterEach
      </span>
     </code>
     <span class="koboSpan" id="kobo.274.1">
      : It creates a new instance of the module at each test to eliminate bugs caused by the incomplete cleanup of HTML elements.
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.275.1">
       rethrowErrors
      </span>
     </code>
     <span class="koboSpan" id="kobo.276.1">
      : It throws any errors that occur when the module is destroyed.
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.277.1">
     Finally, we call the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.278.1">
      compileComponents
     </span>
    </code>
    <span class="koboSpan" id="kobo.279.1">
     method to compile the TypeScript class and the HTML template of our component.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.280.1">
     The first unit test verifies whether we can create a new instance of
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.281.1">
      AppComponent
     </span>
    </code>
    <span class="koboSpan" id="kobo.282.1">
     using the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.283.1">
      createComponent
     </span>
    </code>
    <span class="koboSpan" id="kobo.284.1">
     method:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.285.1">it</span></span><span class="koboSpan" id="kobo.286.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.287.1">'should create the app'</span></span><span class="koboSpan" id="kobo.288.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.289.1">() =&gt;</span></span><span class="koboSpan" id="kobo.290.1"> {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.291.1">const</span></span><span class="koboSpan" id="kobo.292.1"> fixture = </span><span class="hljs-title"><span class="koboSpan" id="kobo.293.1">TestBed</span></span><span class="koboSpan" id="kobo.294.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.295.1">createComponent</span></span><span class="koboSpan" id="kobo.296.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.297.1">AppComponent</span></span><span class="koboSpan" id="kobo.298.1">);
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.299.1">const</span></span><span class="koboSpan" id="kobo.300.1"> app = fixture.</span><span class="hljs-property"><span class="koboSpan" id="kobo.301.1">componentInstance</span></span><span class="koboSpan" id="kobo.302.1">;
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.303.1">expect</span></span><span class="koboSpan" id="kobo.304.1">(app).</span><span class="hljs-title"><span class="koboSpan" id="kobo.305.1">toBeTruthy</span></span><span class="koboSpan" id="kobo.306.1">();
});
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.307.1">
     The result of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.308.1">
      createComponent
     </span>
    </code>
    <span class="koboSpan" id="kobo.309.1">
     method is a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.310.1">
      ComponentFixture
     </span>
    </code>
    <span class="koboSpan" id="kobo.311.1">
     instance of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.312.1">
      AppComponent
     </span>
    </code>
    <span class="koboSpan" id="kobo.313.1">
     type that can give us the component instance using the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.314.1">
      componentInstance
     </span>
    </code>
    <span class="koboSpan" id="kobo.315.1">
     property.
    </span>
    <span class="koboSpan" id="kobo.315.2">
     We also use the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.316.1">
      toBeTruthy
     </span>
    </code>
    <span class="koboSpan" id="kobo.317.1">
     matcher function to check whether the resulting instance is valid.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.318.1">
     As soon as we have access to
    </span>
    <a id="_idIndexMarker794">
    </a>
    <span class="koboSpan" id="kobo.319.1">
     the component instance, we can query any of its public properties and methods:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.320.1">it</span></span><span class="koboSpan" id="kobo.321.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.322.1">`should have the 'my-app' title`</span></span><span class="koboSpan" id="kobo.323.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.324.1">() =&gt;</span></span><span class="koboSpan" id="kobo.325.1"> {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.326.1">const</span></span><span class="koboSpan" id="kobo.327.1"> fixture = </span><span class="hljs-title"><span class="koboSpan" id="kobo.328.1">TestBed</span></span><span class="koboSpan" id="kobo.329.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.330.1">createComponent</span></span><span class="koboSpan" id="kobo.331.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.332.1">AppComponent</span></span><span class="koboSpan" id="kobo.333.1">);
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.334.1">const</span></span><span class="koboSpan" id="kobo.335.1"> app = fixture.</span><span class="hljs-property"><span class="koboSpan" id="kobo.336.1">componentInstance</span></span><span class="koboSpan" id="kobo.337.1">;
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.338.1">expect</span></span><span class="koboSpan" id="kobo.339.1">(app.</span><span class="hljs-property"><span class="koboSpan" id="kobo.340.1">title</span></span><span class="koboSpan" id="kobo.341.1">).</span><span class="hljs-title"><span class="koboSpan" id="kobo.342.1">toEqual</span></span><span class="koboSpan" id="kobo.343.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.344.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.345.1">my-app'</span></span><span class="koboSpan" id="kobo.346.1">);
});
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.347.1">
     In the previous test, we check whether the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.348.1">
      title
     </span>
    </code>
    <span class="koboSpan" id="kobo.349.1">
     component property is set to
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.350.1">
      my-app
     </span>
    </code>
    <span class="koboSpan" id="kobo.351.1">
     using another matcher function,
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.352.1">
      toEqual
     </span>
    </code>
    <span class="koboSpan" id="kobo.353.1">
     .
    </span>
   </p>
   <div class="note">
    <p class="normal">
     <span class="koboSpan" id="kobo.354.1">
      The value of the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.355.1">
       title
      </span>
     </code>
     <span class="koboSpan" id="kobo.356.1">
      component property in a new Angular application will be the name you passed in the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.357.1">
       ng new
      </span>
     </code>
     <span class="koboSpan" id="kobo.358.1">
      command while creating the application.
     </span>
    </p>
   </div>
   <p class="normal">
    <span class="koboSpan" id="kobo.359.1">
     As we have learned, a
    </span>
    <a id="_idIndexMarker795">
    </a>
    <span class="koboSpan" id="kobo.360.1">
     component consists of a TypeScript class and a template file.
    </span>
    <span class="koboSpan" id="kobo.360.2">
     So, testing it only from the class perspective, as in the previous test, is not sufficient.
    </span>
    <span class="koboSpan" id="kobo.360.3">
     We should also test whether the class interacts correctly with the DOM:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.361.1">it</span></span><span class="koboSpan" id="kobo.362.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.363.1">'should render title'</span></span><span class="koboSpan" id="kobo.364.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.365.1">() =&gt;</span></span><span class="koboSpan" id="kobo.366.1"> {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.367.1">const</span></span><span class="koboSpan" id="kobo.368.1"> fixture = </span><span class="hljs-title"><span class="koboSpan" id="kobo.369.1">TestBed</span></span><span class="koboSpan" id="kobo.370.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.371.1">createComponent</span></span><span class="koboSpan" id="kobo.372.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.373.1">AppComponent</span></span><span class="koboSpan" id="kobo.374.1">);
  fixture.</span><span class="hljs-title"><span class="koboSpan" id="kobo.375.1">detectChanges</span></span><span class="koboSpan" id="kobo.376.1">();
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.377.1">const</span></span><span class="koboSpan" id="kobo.378.1"> compiled = fixture.</span><span class="hljs-property"><span class="koboSpan" id="kobo.379.1">nativeElement</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.380.1">as</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.381.1">HTMLElement</span></span><span class="koboSpan" id="kobo.382.1">;
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.383.1">expect</span></span><span class="koboSpan" id="kobo.384.1">(compiled.</span><span class="hljs-title"><span class="koboSpan" id="kobo.385.1">querySelector</span></span><span class="koboSpan" id="kobo.386.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.387.1">'h1'</span></span><span class="koboSpan" id="kobo.388.1">)?.</span><span class="hljs-property"><span class="koboSpan" id="kobo.389.1">textContent</span></span><span class="koboSpan" id="kobo.390.1">).</span><span class="hljs-title"><span class="koboSpan" id="kobo.391.1">toContain</span></span><span class="koboSpan" id="kobo.392.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.393.1">'Hello, my-app'</span></span><span class="koboSpan" id="kobo.394.1">);
});
</span></code></pre>
   <div class="note">
    <p class="normal">
     <span class="koboSpan" id="kobo.395.1">
      Many developers favor class testing over DOM testing and rely on
     </span>
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.396.1">
       end-to-end
      </span>
     </strong>
     <span class="koboSpan" id="kobo.397.1">
      (
     </span>
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.398.1">
       E2E
      </span>
     </strong>
     <span class="koboSpan" id="kobo.399.1">
      ) testing, which is slower and
     </span>
     <a id="_idIndexMarker796">
     </a>
     <span class="koboSpan" id="kobo.400.1">
      performs poorly.
     </span>
     <span class="koboSpan" id="kobo.400.2">
      E2E tests often validate the integration of an application with a backend API and are easy to break.
     </span>
     <span class="koboSpan" id="kobo.400.3">
      Thus, performing DOM unit testing in your Angular applications is recommended.
     </span>
    </p>
   </div>
   <p class="normal">
    <span class="koboSpan" id="kobo.401.1">
     In the preceding test, we create a component and call the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.402.1">
      detectChanges
     </span>
    </code>
    <span class="koboSpan" id="kobo.403.1">
     method of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.404.1">
      ComponentFixture
     </span>
    </code>
    <span class="koboSpan" id="kobo.405.1">
     .
    </span>
    <span class="koboSpan" id="kobo.405.2">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.406.1">
      detectChanges
     </span>
    </code>
    <span class="koboSpan" id="kobo.407.1">
     method triggers the Angular change detection mechanism, forcing the data bindings to be updated.
    </span>
    <span class="koboSpan" id="kobo.407.2">
     It executes the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.408.1">
      ngOnInit
     </span>
    </code>
    <span class="koboSpan" id="kobo.409.1">
     life cycle event of the component the first time it is called and the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.410.1">
      ngOnChanges
     </span>
    </code>
    <span class="koboSpan" id="kobo.411.1">
     in subsequent calls so that we can query the DOM element of the component using the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.412.1">
      nativeElement
     </span>
    </code>
    <span class="koboSpan" id="kobo.413.1">
     property.
    </span>
    <span class="koboSpan" id="kobo.413.2">
     In this example, we check the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.414.1">
      textContent
     </span>
    </code>
    <span class="koboSpan" id="kobo.415.1">
     of the HTML element corresponding to the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.416.1">
      title
     </span>
    </code>
    <span class="koboSpan" id="kobo.417.1">
     property.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.418.1">
     To run tests, we use the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.419.1">
      ng test
     </span>
    </code>
    <span class="koboSpan" id="kobo.420.1">
     command of the Angular CLI.
    </span>
    <span class="koboSpan" id="kobo.420.2">
     It will start the Karma test runner, fetch all unit test files, execute them, and open a browser to display the results of each test.
    </span>
    <span class="koboSpan" id="kobo.420.3">
     The Angular CLI uses the Google Chrome browser by default.
    </span>
    <span class="koboSpan" id="kobo.420.4">
     The output will look like this:
    </span>
   </p>
   <figure class="mediaobject">
    <span class="koboSpan" id="kobo.421.1">
     <img alt="Εικόνα που περιέχει κείμενο, γραμματοσειρά, στιγμιότυπο οθόνης, λευκό  Περιγραφή που δημιουργήθηκε αυτόματα" src="../Images/B21418_13_01.png"/>
    </span>
   </figure>
   <p class="packt_figref">
    <span class="koboSpan" id="kobo.422.1">
     Figure 13.1: Test execution output
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.423.1">
     In the previous figure, we can see the result of each test at the top of the page.
    </span>
    <span class="koboSpan" id="kobo.423.2">
     We can also see how Karma visually groups each test by suite.
    </span>
    <span class="koboSpan" id="kobo.423.3">
     In our case, the only test suite is
    </span>
    <strong class="screenText">
     <span class="koboSpan" id="kobo.424.1">
      AppComponent
     </span>
    </strong>
    <span class="koboSpan" id="kobo.425.1">
     .
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.426.1">
     Now, let’s make one
    </span>
    <a id="_idIndexMarker797">
    </a>
    <span class="koboSpan" id="kobo.427.1">
     of our tests fail.
    </span>
    <span class="koboSpan" id="kobo.427.2">
     Open the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.428.1">
      app.component.ts
     </span>
    </code>
    <span class="koboSpan" id="kobo.429.1">
     file, change the value of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.430.1">
      title
     </span>
    </code>
    <span class="koboSpan" id="kobo.431.1">
     property to
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.432.1">
      my-new-app
     </span>
    </code>
    <span class="koboSpan" id="kobo.433.1">
     , and save the file.
    </span>
    <span class="koboSpan" id="kobo.433.2">
     Karma will re-execute our tests and display the results on the page:
    </span>
   </p>
   <figure class="mediaobject">
    <span class="koboSpan" id="kobo.434.1">
     <img alt="Εικόνα που περιέχει κείμενο, στιγμιότυπο οθόνης, γραμματοσειρά, αριθμός  Περιγραφή που δημιουργήθηκε αυτόματα" src="../Images/B21418_13_02.png"/>
    </span>
   </figure>
   <p class="packt_figref">
    <span class="koboSpan" id="kobo.435.1">
     Figure 13.2: Test failure
    </span>
   </p>
   <div class="packt_tip">
    <p class="normal">
     <span class="koboSpan" id="kobo.436.1">
      Karma runs in
     </span>
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.437.1">
       watch mode
      </span>
     </strong>
     <span class="koboSpan" id="kobo.438.1">
      , so we do
     </span>
     <a id="_idIndexMarker798">
     </a>
     <span class="koboSpan" id="kobo.439.1">
      not need to execute the Angular CLI test command every time we make a change.
     </span>
    </p>
   </div>
   <p class="normal">
    <span class="koboSpan" id="kobo.440.1">
     Sometimes, reading
    </span>
    <a id="_idIndexMarker799">
    </a>
    <span class="koboSpan" id="kobo.441.1">
     the output of tests in the browser is not very convenient.
    </span>
    <span class="koboSpan" id="kobo.441.2">
     Alternatively, we can inspect the console window that we used to run the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.442.1">
      ng test
     </span>
    </code>
    <span class="koboSpan" id="kobo.443.1">
     command, which contains a trimmed version of the test results:
    </span>
   </p>
   <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.444.1">Executed 3 of 3 SUCCESS (0.117 secs / 0.044 secs)
TOTAL: 3 SUCCESS
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.445.1">
     We’ve gained quite a lot of insight just by looking at the test of
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.446.1">
      AppComponent
     </span>
    </code>
    <span class="koboSpan" id="kobo.447.1">
     that the Angular CLI automatically created for us.
    </span>
    <span class="koboSpan" id="kobo.447.2">
     In the following section, we will look at a more advanced scenario for testing a component with dependencies.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-240">
    <span class="koboSpan" id="kobo.448.1">
     Testing with dependencies
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.449.1">
     In a real-world
    </span>
    <a id="_idIndexMarker800">
    </a>
    <span class="koboSpan" id="kobo.450.1">
     scenario, components are not usually as
    </span>
    <a id="_idIndexMarker801">
    </a>
    <span class="koboSpan" id="kobo.451.1">
     simple as the main component.
    </span>
    <span class="koboSpan" id="kobo.451.2">
     They will almost certainly be dependent on one or more services.
    </span>
    <span class="koboSpan" id="kobo.451.3">
     They will also possibly contain other child components in their template.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.452.1">
     We have different ways of dealing with testing in such situations.
    </span>
    <span class="koboSpan" id="kobo.452.2">
     One thing is clear: if we are testing the component, we should not test the service or its child components.
    </span>
    <span class="koboSpan" id="kobo.452.3">
     So, when we set up such a test, the dependency should not be the real class.
    </span>
    <span class="koboSpan" id="kobo.452.4">
     There are different ways of dealing with that when it comes to unit testing; no solution is strictly better than another:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.453.1">
       Stubbing
      </span>
     </strong>
     <span class="koboSpan" id="kobo.454.1">
      : A
     </span>
     <a id="_idIndexMarker802">
     </a>
     <span class="koboSpan" id="kobo.455.1">
      method that instructs the dependency injector to inject a stub of the dependency that we provide instead of the real class.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.456.1">
       Spying
      </span>
     </strong>
     <span class="koboSpan" id="kobo.457.1">
      : A
     </span>
     <a id="_idIndexMarker803">
     </a>
     <span class="koboSpan" id="kobo.458.1">
      method that injects the actual dependency but attaches a spy to the method that we call in our component.
     </span>
     <span class="koboSpan" id="kobo.458.2">
      We can then either return mock data or let the method call through.
     </span>
     <div class="packt_tip">
      <p class="normal">
       <span class="koboSpan" id="kobo.459.1">
        Using stubbing over spying is preferable when a dependency is complicated.
       </span>
       <span class="koboSpan" id="kobo.459.2">
        Some services inject other services, so using the real dependency in a test requires you to compensate for other dependencies.
       </span>
       <span class="koboSpan" id="kobo.459.3">
        It is also the preferred method when the component we want to test contains child components in its template.
       </span>
      </p>
     </div>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.460.1">
     Regardless of the approach, we ensure that the test does not perform unintended actions, such as accessing the filesystem or attempting to communicate via HTTP; we are testing the component in complete isolation.
    </span>
   </p>
   <h3 class="heading-3" id="_idParaDest-241">
    <span class="koboSpan" id="kobo.461.1">
     Replacing the dependency with a stub
    </span>
   </h3>
   <p class="normal">
    <span class="koboSpan" id="kobo.462.1">
     Replacing a
    </span>
    <a id="_idIndexMarker804">
    </a>
    <span class="koboSpan" id="kobo.463.1">
     dependency with a stub means that we completely
    </span>
    <a id="_idIndexMarker805">
    </a>
    <span class="koboSpan" id="kobo.464.1">
     replace the dependency with a fake one.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.465.1">
     We can create a fake dependency in the following ways:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.466.1">
      Create a constant variable or class that contains properties and methods of the real dependency.
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.467.1">
      Create a mock definition of the actual class of the dependency.
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.468.1">
     The approaches are not so different.
    </span>
    <span class="koboSpan" id="kobo.468.2">
     In this section, we will look at the first one as it is most common in Angular development.
    </span>
    <span class="koboSpan" id="kobo.468.3">
     Feel free to explore the second one at your own pace.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.469.1">
     Consider the following
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.470.1">
      stub.component.ts
     </span>
    </code>
    <span class="koboSpan" id="kobo.471.1">
     component file:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.472.1">import</span></span><span class="koboSpan" id="kobo.473.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.474.1">Component</span></span><span class="koboSpan" id="kobo.475.1">, </span><span class="hljs-title"><span class="koboSpan" id="kobo.476.1">OnInit</span></span><span class="koboSpan" id="kobo.477.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.478.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.479.1">'@angular/core'</span></span><span class="koboSpan" id="kobo.480.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.481.1">import</span></span><span class="koboSpan" id="kobo.482.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.483.1">StubService</span></span><span class="koboSpan" id="kobo.484.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.485.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.486.1">'../stub.service'</span></span><span class="koboSpan" id="kobo.487.1">;
</span><span class="hljs-meta"><span class="koboSpan" id="kobo.488.1">@Component</span></span><span class="koboSpan" id="kobo.489.1">({
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.490.1">selector</span></span><span class="koboSpan" id="kobo.491.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.492.1">'app-stub'</span></span><span class="koboSpan" id="kobo.493.1">,
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.494.1">template</span></span><span class="koboSpan" id="kobo.495.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.496.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.497.1">&lt;span&gt;{{ msg }}&lt;/span&gt;'</span></span><span class="koboSpan" id="kobo.498.1">
})
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.499.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.500.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.501.1">StubComponent</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.502.1">implements</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.503.1">OnInit</span></span><span class="koboSpan" id="kobo.504.1"> {
  msg = </span><span class="hljs-string"><span class="koboSpan" id="kobo.505.1">''</span></span><span class="koboSpan" id="kobo.506.1">;
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.507.1">constructor</span></span><span class="koboSpan" id="kobo.508.1">(</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.509.1">private</span></span><span class="hljs-params"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.510.1">stubService</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.511.1">: </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.512.1">StubService</span></span><span class="koboSpan" id="kobo.513.1">) {}
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.514.1">ngOnInit</span></span><span class="koboSpan" id="kobo.515.1">(): </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.516.1">void</span></span><span class="koboSpan" id="kobo.517.1"> {
    </span><span class="hljs-variable"><span class="koboSpan" id="kobo.518.1">this</span></span><span class="koboSpan" id="kobo.519.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.520.1">msg</span></span><span class="koboSpan" id="kobo.521.1"> = </span><span class="hljs-variable"><span class="koboSpan" id="kobo.522.1">this</span></span><span class="koboSpan" id="kobo.523.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.524.1">stubService</span></span><span class="koboSpan" id="kobo.525.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.526.1">isBusy</span></span><span class="koboSpan" id="kobo.527.1">
      ? </span><span class="hljs-variable"><span class="koboSpan" id="kobo.528.1">this</span></span><span class="koboSpan" id="kobo.529.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.530.1">stubService</span></span><span class="koboSpan" id="kobo.531.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.532.1">name</span></span><span class="koboSpan" id="kobo.533.1"> + </span><span class="hljs-string"><span class="koboSpan" id="kobo.534.1">' is on mission'</span></span><span class="koboSpan" id="kobo.535.1">
      : </span><span class="hljs-variable"><span class="koboSpan" id="kobo.536.1">this</span></span><span class="koboSpan" id="kobo.537.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.538.1">stubService</span></span><span class="koboSpan" id="kobo.539.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.540.1">name</span></span><span class="koboSpan" id="kobo.541.1"> + </span><span class="hljs-string"><span class="koboSpan" id="kobo.542.1">' is available'</span></span><span class="koboSpan" id="kobo.543.1">;
  }
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.544.1">
     It injects
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.545.1">
      StubService
     </span>
    </code>
    <span class="koboSpan" id="kobo.546.1">
     , which contains two public properties.
    </span>
    <span class="koboSpan" id="kobo.546.2">
     Providing a stub for this service in tests is pretty straightforward, as shown in the following example:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.547.1">const</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.548.1">serviceStub</span></span><span class="koboSpan" id="kobo.549.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.550.1">Partial</span></span><span class="koboSpan" id="kobo.551.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.552.1">StubService</span></span><span class="koboSpan" id="kobo.553.1">&gt; = {
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.554.1">name</span></span><span class="koboSpan" id="kobo.555.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.556.1">'Boothstomper'</span></span><span class="koboSpan" id="kobo.557.1">
};
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.558.1">
     We have declared the service as
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.559.1">
      Partial
     </span>
    </code>
    <span class="koboSpan" id="kobo.560.1">
     because we want only to set the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.561.1">
      name
     </span>
    </code>
    <span class="koboSpan" id="kobo.562.1">
     property initially.
    </span>
    <span class="koboSpan" id="kobo.562.2">
     We can now use the object literal syntax to inject the stub service in our testing module:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.563.1">await</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.564.1">TestBed</span></span><span class="koboSpan" id="kobo.565.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.566.1">configureTestingModule</span></span><span class="koboSpan" id="kobo.567.1">({
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.568.1">imports</span></span><span class="koboSpan" id="kobo.569.1">: [</span><span class="hljs-title"><span class="koboSpan" id="kobo.570.1">StubComponent</span></span><span class="koboSpan" id="kobo.571.1">],
  </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.572.1">providers: [</span></strong></span>
    <span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.573.1">{ provide: StubService, useValue: serviceStub }</span></strong></span>
  <span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.574.1">]</span></strong></span><span class="koboSpan" id="kobo.575.1">
})
.</span><span class="hljs-title"><span class="koboSpan" id="kobo.576.1">compileComponents</span></span><span class="koboSpan" id="kobo.577.1">();
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.578.1">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.579.1">
      msg
     </span>
    </code>
    <span class="koboSpan" id="kobo.580.1">
     component
    </span>
    <a id="_idIndexMarker806">
    </a>
    <span class="koboSpan" id="kobo.581.1">
     property relies on the value of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.582.1">
      isBusy
     </span>
    </code>
    <span class="koboSpan" id="kobo.583.1">
     service
    </span>
    <a id="_idIndexMarker807">
    </a>
    <span class="koboSpan" id="kobo.584.1">
     property.
    </span>
    <span class="koboSpan" id="kobo.584.2">
     Therefore, we need to get a reference to the service in the test suite and provide alternate values for this property in each test.
    </span>
    <span class="koboSpan" id="kobo.584.3">
     We can get the injected instance of
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.585.1">
      StubService
     </span>
    </code>
    <span class="koboSpan" id="kobo.586.1">
     using the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.587.1">
      inject
     </span>
    </code>
    <span class="koboSpan" id="kobo.588.1">
     method of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.589.1">
      TestBed
     </span>
    </code>
    <span class="koboSpan" id="kobo.590.1">
     class:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.591.1">describe</span></span><span class="koboSpan" id="kobo.592.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.593.1">'status'</span></span><span class="koboSpan" id="kobo.594.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.595.1">() =&gt;</span></span><span class="koboSpan" id="kobo.596.1"> {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.597.1">let</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.598.1">service</span></span><span class="koboSpan" id="kobo.599.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.600.1">StubService</span></span><span class="koboSpan" id="kobo.601.1">;
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.602.1">beforeEach</span></span><span class="koboSpan" id="kobo.603.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.604.1">() =&gt;</span></span><span class="koboSpan" id="kobo.605.1"> {
    service = </span><span class="hljs-title"><span class="koboSpan" id="kobo.606.1">TestBed</span></span><span class="koboSpan" id="kobo.607.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.608.1">inject</span></span><span class="koboSpan" id="kobo.609.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.610.1">StubService</span></span><span class="koboSpan" id="kobo.611.1">);
  })
});
</span></code></pre>
   <div class="note">
    <p class="normal">
     <span class="koboSpan" id="kobo.612.1">
      We pass the real
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.613.1">
       StubService
      </span>
     </code>
     <span class="koboSpan" id="kobo.614.1">
      as a parameter to the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.615.1">
       inject
      </span>
     </code>
     <span class="koboSpan" id="kobo.616.1">
      method, not the stubbed version we created.
     </span>
     <span class="koboSpan" id="kobo.616.2">
      Modifying the value of the stub will not affect the injected service since our component uses an instance of the real service.
     </span>
     <span class="koboSpan" id="kobo.616.3">
      The
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.617.1">
       inject
      </span>
     </code>
     <span class="koboSpan" id="kobo.618.1">
      method asks the root injector of the application for the requested service.
     </span>
     <span class="koboSpan" id="kobo.618.2">
      If the service was provided from the component injector, we would need to get it from the component injector using
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.619.1">
       fixture.debugElement.injector.get(StubService)
      </span>
     </code>
     <span class="koboSpan" id="kobo.620.1">
      .
     </span>
    </p>
   </div>
   <p class="normal">
    <span class="koboSpan" id="kobo.621.1">
     We can now write our tests to check whether the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.622.1">
      msg
     </span>
    </code>
    <span class="koboSpan" id="kobo.623.1">
     component property behaves correctly during data binding:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.624.1">describe</span></span><span class="koboSpan" id="kobo.625.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.626.1">'status'</span></span><span class="koboSpan" id="kobo.627.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.628.1">() =&gt;</span></span><span class="koboSpan" id="kobo.629.1"> {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.630.1">let</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.631.1">service</span></span><span class="koboSpan" id="kobo.632.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.633.1">StubService</span></span><span class="koboSpan" id="kobo.634.1">;
  </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.635.1">let msgDisplay: HTMLElement;</span></strong></span>
  <span class="hljs-title"><span class="koboSpan" id="kobo.636.1">beforeEach</span></span><span class="koboSpan" id="kobo.637.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.638.1">() =&gt;</span></span><span class="koboSpan" id="kobo.639.1"> {
    service = </span><span class="hljs-title"><span class="koboSpan" id="kobo.640.1">TestBed</span></span><span class="koboSpan" id="kobo.641.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.642.1">inject</span></span><span class="koboSpan" id="kobo.643.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.644.1">StubService</span></span><span class="koboSpan" id="kobo.645.1">);
    </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.646.1">msgDisplay = fixture.nativeElement.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.647.1">querySelector</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.648.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.649.1">'span'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.650.1">);</span></strong></span><span class="koboSpan" id="kobo.651.1">
  })
  </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.652.1">it('should be on a mission', () =&gt; {</span></strong></span>
<code class="codeHighlighted" style="font-weight: bold;">    </code><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.653.1">service.isBusy = true;</span></strong></span>
<code class="codeHighlighted" style="font-weight: bold;">    </code><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.654.1">fixture.detectChanges();</span></strong></span>
<code class="codeHighlighted" style="font-weight: bold;">    </code><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.655.1">expect(msgDisplay.textContent).toContain('is on mission');</span></strong></span>
<code class="codeHighlighted" style="font-weight: bold;">  </code><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.656.1">});</span></strong></span>
  <span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.657.1">it('should be available', () =&gt; {</span></strong></span>
    <span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.658.1">service.isBusy = false;</span></strong></span>
    <span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.659.1">fixture.detectChanges();</span></strong></span>
    <span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.660.1">expect(msgDisplay.textContent).toContain('is available');</span></strong></span>
  <span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.661.1">});</span></strong></span><span class="koboSpan" id="kobo.662.1">
});
</span></code></pre>
   <div class="note">
    <p class="normal">
     <span class="koboSpan" id="kobo.663.1">
      We have removed the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.664.1">
       fixture.detectChanges
      </span>
     </code>
     <span class="koboSpan" id="kobo.665.1">
      line from the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.666.1">
       beforeEach
      </span>
     </code>
     <span class="koboSpan" id="kobo.667.1">
      statement because we want to trigger change detection in our tests separately.
     </span>
    </p>
   </div>
   <p class="normal">
    <span class="koboSpan" id="kobo.668.1">
     Stubbing a
    </span>
    <a id="_idIndexMarker808">
    </a>
    <span class="koboSpan" id="kobo.669.1">
     dependency is not always viable, especially when the
    </span>
    <a id="_idIndexMarker809">
    </a>
    <span class="koboSpan" id="kobo.670.1">
     root injector does not provide it.
    </span>
    <span class="koboSpan" id="kobo.670.2">
     A service can be provided at the component injector level.
    </span>
    <span class="koboSpan" id="kobo.670.3">
     Providing a stub using the process we looked at earlier doesn’t have any effect.
    </span>
    <span class="koboSpan" id="kobo.670.4">
     To tackle such a scenario, we can use the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.671.1">
      overrideComponent
     </span>
    </code>
    <span class="koboSpan" id="kobo.672.1">
     method of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.673.1">
      TestBed
     </span>
    </code>
    <span class="koboSpan" id="kobo.674.1">
     class:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.675.1">await</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.676.1">TestBed</span></span><span class="koboSpan" id="kobo.677.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.678.1">configureTestingModule</span></span><span class="koboSpan" id="kobo.679.1">({
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.680.1">imports</span></span><span class="koboSpan" id="kobo.681.1">: [</span><span class="hljs-title"><span class="koboSpan" id="kobo.682.1">StubComponent</span></span><span class="koboSpan" id="kobo.683.1">],
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.684.1">providers</span></span><span class="koboSpan" id="kobo.685.1">: [
    { </span><span class="hljs-attr"><span class="koboSpan" id="kobo.686.1">provide</span></span><span class="koboSpan" id="kobo.687.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.688.1">StubService</span></span><span class="koboSpan" id="kobo.689.1">, </span><span class="hljs-attr"><span class="koboSpan" id="kobo.690.1">useValue</span></span><span class="koboSpan" id="kobo.691.1">: serviceStub }
  ]
})
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.692.1">.overrideComponent(StubComponent, {</span></strong></span>
  <span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.693.1">set: {</span></strong></span>
    <span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.694.1">providers: [</span></strong></span>
      <span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.695.1">{ provide: StubService, useValue: serviceStub }</span></strong></span>
    <span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.696.1">]</span></strong></span>
  <span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.697.1">}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.698.1">})</span></strong></span><span class="koboSpan" id="kobo.699.1">
.</span><span class="hljs-title"><span class="koboSpan" id="kobo.700.1">compileComponents</span></span><span class="koboSpan" id="kobo.701.1">();
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.702.1">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.703.1">
      overrideComponent
     </span>
    </code>
    <span class="koboSpan" id="kobo.704.1">
     method accepts two parameters: the type of component that provides the service and an override metadata object.
    </span>
    <span class="koboSpan" id="kobo.704.2">
     The metadata object contains the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.705.1">
      set
     </span>
    </code>
    <span class="koboSpan" id="kobo.706.1">
     property, which provides services to the component.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.707.1">
     Suppose that the component we want to test contains a child component in its template, such as:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-meta"><span class="koboSpan" id="kobo.708.1">@Component</span></span><span class="koboSpan" id="kobo.709.1">({
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.710.1">selector</span></span><span class="koboSpan" id="kobo.711.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.712.1">'app-stub'</span></span><span class="koboSpan" id="kobo.713.1">,
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.714.1">template</span></span><span class="koboSpan" id="kobo.715.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.716.1">`</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.717.1">    &lt;span&gt;{{ msg }}&lt;/span&gt;</span></span>
<span class="hljs-string">    </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.718.1">&lt;app-child&gt;&lt;/app-child&gt;</span></strong></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.719.1">  `</span></span><span class="koboSpan" id="kobo.720.1">
})
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.721.1">
     In the preceding case, when
    </span>
    <a id="_idIndexMarker810">
    </a>
    <span class="koboSpan" id="kobo.722.1">
     we tested the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.723.1">
      StubComponent
     </span>
    </code>
    <span class="koboSpan" id="kobo.724.1">
     , we also
    </span>
    <a id="_idIndexMarker811">
    </a>
    <span class="koboSpan" id="kobo.725.1">
     needed to import the TypeScript class of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.726.1">
      &lt;app-child&gt;
     </span>
    </code>
    <span class="koboSpan" id="kobo.727.1">
     component when configuring the testing module:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.728.1">await</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.729.1">TestBed</span></span><span class="koboSpan" id="kobo.730.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.731.1">configureTestingModule</span></span><span class="koboSpan" id="kobo.732.1">({
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.733.1">imports</span></span><span class="koboSpan" id="kobo.734.1">: [</span><span class="hljs-title"><span class="koboSpan" id="kobo.735.1">StubComponent</span></span><span class="koboSpan" id="kobo.736.1">],
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.737.1">providers</span></span><span class="koboSpan" id="kobo.738.1">: [
    { </span><span class="hljs-attr"><span class="koboSpan" id="kobo.739.1">provide</span></span><span class="koboSpan" id="kobo.740.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.741.1">StubService</span></span><span class="koboSpan" id="kobo.742.1">, </span><span class="hljs-attr"><span class="koboSpan" id="kobo.743.1">useValue</span></span><span class="koboSpan" id="kobo.744.1">: serviceStub }
  ],
  </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.745.1">imports: [ChildComponent]</span></strong></span><span class="koboSpan" id="kobo.746.1">
})
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.747.1">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.748.1">
      ChildComponent
     </span>
    </code>
    <span class="koboSpan" id="kobo.749.1">
     class may have other dependencies as well.
    </span>
    <span class="koboSpan" id="kobo.749.2">
     Providing stubs for those dependencies is not viable because it is not the responsibility of the component under test.
    </span>
    <span class="koboSpan" id="kobo.749.3">
     Instead, we can create a stub TypeScript class for the component and import it when configuring the testing module:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-meta"><span class="koboSpan" id="kobo.750.1">@Component</span></span><span class="koboSpan" id="kobo.751.1">({ </span><span class="hljs-attr"><span class="koboSpan" id="kobo.752.1">selector</span></span><span class="koboSpan" id="kobo.753.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.754.1">'app-child'</span></span><span class="koboSpan" id="kobo.755.1">, </span><span class="hljs-attr"><span class="koboSpan" id="kobo.756.1">template</span></span><span class="koboSpan" id="kobo.757.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.758.1">''</span></span><span class="koboSpan" id="kobo.759.1"> })
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.760.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.761.1">ChildStubComponent</span></span><span class="koboSpan" id="kobo.762.1"> {}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.763.1">
     In the preceding snippet, we passed an empty array in the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.764.1">
      template
     </span>
    </code>
    <span class="koboSpan" id="kobo.765.1">
     property of the component because we are not interested in the internal implementation of the child component.
    </span>
   </p>
   <div class="note">
    <p class="normal">
     <span class="koboSpan" id="kobo.766.1">
      If the child component contains properties and methods that are used while testing the parent component, we need to define them as well in the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.767.1">
       ChildStubComponent
      </span>
     </code>
     <span class="koboSpan" id="kobo.768.1">
      .
     </span>
    </p>
   </div>
   <p class="normal">
    <span class="koboSpan" id="kobo.769.1">
     Alternatively, to provide
    </span>
    <a id="_idIndexMarker812">
    </a>
    <span class="koboSpan" id="kobo.770.1">
     a stub of the component, we can pass
    </span>
    <a id="_idIndexMarker813">
    </a>
    <span class="koboSpan" id="kobo.771.1">
     the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.772.1">
      NO_ERRORS_SCHEMA
     </span>
    </code>
    <span class="koboSpan" id="kobo.773.1">
     from the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.774.1">
      @angular/core
     </span>
    </code>
    <span class="koboSpan" id="kobo.775.1">
     npm package while configuring the testing module:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.776.1">await</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.777.1">TestBed</span></span><span class="koboSpan" id="kobo.778.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.779.1">configureTestingModule</span></span><span class="koboSpan" id="kobo.780.1">({
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.781.1">imports</span></span><span class="koboSpan" id="kobo.782.1">: [</span><span class="hljs-title"><span class="koboSpan" id="kobo.783.1">StubComponent</span></span><span class="koboSpan" id="kobo.784.1">],
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.785.1">providers</span></span><span class="koboSpan" id="kobo.786.1">: [
    { </span><span class="hljs-attr"><span class="koboSpan" id="kobo.787.1">provide</span></span><span class="koboSpan" id="kobo.788.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.789.1">StubService</span></span><span class="koboSpan" id="kobo.790.1">, </span><span class="hljs-attr"><span class="koboSpan" id="kobo.791.1">useValue</span></span><span class="koboSpan" id="kobo.792.1">: serviceStub },
  ],
  </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.793.1">schemas: [NO_ERRORS_SCHEMA]</span></strong></span><span class="koboSpan" id="kobo.794.1">
})
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.795.1">
     The preceding snippet instructs Angular to ignore any components that have not been imported into the testing module.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.796.1">
     Stubbing a dependency is very simple, but it is not always possible, as we will see in the following section.
    </span>
   </p>
   <h3 class="heading-3" id="_idParaDest-242">
    <span class="koboSpan" id="kobo.797.1">
     Spying on the dependency method
    </span>
   </h3>
   <p class="normal">
    <span class="koboSpan" id="kobo.798.1">
     Using a stub is not the only
    </span>
    <a id="_idIndexMarker814">
    </a>
    <span class="koboSpan" id="kobo.799.1">
     way to isolate logic in a unit test.
    </span>
    <span class="koboSpan" id="kobo.799.2">
     We don’t have to replace the entire dependency—only the parts our component uses.
    </span>
    <span class="koboSpan" id="kobo.799.3">
     Replacing certain parts means we point out specific methods on the dependency and assign a spy to them.
    </span>
    <span class="koboSpan" id="kobo.799.4">
     A spy can answer what you want, but you can also see how many times it was called and with what arguments.
    </span>
    <span class="koboSpan" id="kobo.799.5">
     So, a spy gives you much more information about what is happening.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.800.1">
     There are two ways to set up a spy in a dependency:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.801.1">
      Inject the actual dependency and spy on its methods.
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.802.1">
      Use the Jasmine
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.803.1">
       createSpyObj
      </span>
     </code>
     <span class="koboSpan" id="kobo.804.1">
      method to create a fake dependency instance.
     </span>
     <span class="koboSpan" id="kobo.804.2">
      We can then spy on the methods of this dependency as we would with the real one.
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.805.1">
     The first case is most common in Angular development.
    </span>
    <span class="koboSpan" id="kobo.805.2">
     Let’s see how to set it up.
    </span>
    <span class="koboSpan" id="kobo.805.3">
     Consider the following
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.806.1">
      spy.component.ts
     </span>
    </code>
    <span class="koboSpan" id="kobo.807.1">
     file, which uses the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.808.1">
      Title
     </span>
    </code>
    <span class="koboSpan" id="kobo.809.1">
     service of the Angular framework:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.810.1">import</span></span><span class="koboSpan" id="kobo.811.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.812.1">Component</span></span><span class="koboSpan" id="kobo.813.1">, </span><span class="hljs-title"><span class="koboSpan" id="kobo.814.1">OnInit</span></span><span class="koboSpan" id="kobo.815.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.816.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.817.1">'@angular/core'</span></span><span class="koboSpan" id="kobo.818.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.819.1">import</span></span><span class="koboSpan" id="kobo.820.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.821.1">Title</span></span><span class="koboSpan" id="kobo.822.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.823.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.824.1">'@angular/platform-browser'</span></span><span class="koboSpan" id="kobo.825.1">;
</span><span class="hljs-meta"><span class="koboSpan" id="kobo.826.1">@Component</span></span><span class="koboSpan" id="kobo.827.1">({
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.828.1">selector</span></span><span class="koboSpan" id="kobo.829.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.830.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.831.1">app-spy'</span></span><span class="koboSpan" id="kobo.832.1">,
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.833.1">template</span></span><span class="koboSpan" id="kobo.834.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.835.1">'{{ caption }}'</span></span><span class="koboSpan" id="kobo.836.1">
})
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.837.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.838.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.839.1">SpyComponent</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.840.1">implements</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.841.1">OnInit</span></span><span class="koboSpan" id="kobo.842.1"> {
  caption = </span><span class="hljs-string"><span class="koboSpan" id="kobo.843.1">''</span></span><span class="koboSpan" id="kobo.844.1">;
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.845.1">constructor</span></span><span class="koboSpan" id="kobo.846.1">(</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.847.1">private</span></span><span class="hljs-params"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.848.1">title</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.849.1">: </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.850.1">Title</span></span><span class="koboSpan" id="kobo.851.1">) {}
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.852.1">ngOnInit</span></span><span class="koboSpan" id="kobo.853.1">(): </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.854.1">void</span></span><span class="koboSpan" id="kobo.855.1"> {
    </span><span class="hljs-variable"><span class="koboSpan" id="kobo.856.1">this</span></span><span class="koboSpan" id="kobo.857.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.858.1">title</span></span><span class="koboSpan" id="kobo.859.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.860.1">setTitle</span></span><span class="koboSpan" id="kobo.861.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.862.1">'My Angular app'</span></span><span class="koboSpan" id="kobo.863.1">);
    </span><span class="hljs-variable"><span class="koboSpan" id="kobo.864.1">this</span></span><span class="koboSpan" id="kobo.865.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.866.1">caption</span></span><span class="koboSpan" id="kobo.867.1"> = </span><span class="hljs-variable"><span class="koboSpan" id="kobo.868.1">this</span></span><span class="koboSpan" id="kobo.869.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.870.1">title</span></span><span class="koboSpan" id="kobo.871.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.872.1">getTitle</span></span><span class="koboSpan" id="kobo.873.1">();
  }
}
</span></code></pre>
   <div class="note">
    <p class="normal">
     <span class="koboSpan" id="kobo.874.1">
      The
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.875.1">
       Title
      </span>
     </code>
     <span class="koboSpan" id="kobo.876.1">
      service interacts with the title of the main HTML document in an Angular application.
     </span>
    </p>
   </div>
   <p class="normal">
    <span class="koboSpan" id="kobo.877.1">
     We do not have any
    </span>
    <a id="_idIndexMarker815">
    </a>
    <span class="koboSpan" id="kobo.878.1">
     control over the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.879.1">
      Title
     </span>
    </code>
    <span class="koboSpan" id="kobo.880.1">
     service since it is built into the framework.
    </span>
    <span class="koboSpan" id="kobo.880.2">
     It may have dependencies that we do not know about.
    </span>
    <span class="koboSpan" id="kobo.880.3">
     Spying on its methods is the easiest and safest way to use it in our tests.
    </span>
    <span class="koboSpan" id="kobo.880.4">
     We inject it in the testing module using the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.881.1">
      providers
     </span>
    </code>
    <span class="koboSpan" id="kobo.882.1">
     array and then use it in our test, such as:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.883.1">it</span></span><span class="koboSpan" id="kobo.884.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.885.1">'should set the title'</span></span><span class="koboSpan" id="kobo.886.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.887.1">() =&gt;</span></span><span class="koboSpan" id="kobo.888.1"> {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.889.1">const</span></span><span class="koboSpan" id="kobo.890.1"> title = </span><span class="hljs-title"><span class="koboSpan" id="kobo.891.1">TestBed</span></span><span class="koboSpan" id="kobo.892.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.893.1">inject</span></span><span class="koboSpan" id="kobo.894.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.895.1">Title</span></span><span class="koboSpan" id="kobo.896.1">);
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.897.1">const</span></span><span class="koboSpan" id="kobo.898.1"> spy = </span><span class="hljs-title"><span class="koboSpan" id="kobo.899.1">spyOn</span></span><span class="koboSpan" id="kobo.900.1">(title, </span><span class="hljs-string"><span class="koboSpan" id="kobo.901.1">'setTitle'</span></span><span class="koboSpan" id="kobo.902.1">);
  component.</span><span class="hljs-title"><span class="koboSpan" id="kobo.903.1">ngOnInit</span></span><span class="koboSpan" id="kobo.904.1">();
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.905.1">expect</span></span><span class="koboSpan" id="kobo.906.1">(spy).</span><span class="hljs-title"><span class="koboSpan" id="kobo.907.1">toHaveBeenCalledWith</span></span><span class="koboSpan" id="kobo.908.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.909.1">'My Angular app'</span></span><span class="koboSpan" id="kobo.910.1">);
});
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.911.1">
     We use the Jasmine
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.912.1">
      spyOn
     </span>
    </code>
    <span class="koboSpan" id="kobo.913.1">
     method, which accepts two parameters: the object and its specific method to spy.
    </span>
    <span class="koboSpan" id="kobo.913.2">
     We used it before calling the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.914.1">
      ngOnInit
     </span>
    </code>
    <span class="koboSpan" id="kobo.915.1">
     component method to attach the spy before triggering the change detection mechanism.
    </span>
    <span class="koboSpan" id="kobo.915.2">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.916.1">
      expect
     </span>
    </code>
    <span class="koboSpan" id="kobo.917.1">
     statement validates that the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.918.1">
      setTitle
     </span>
    </code>
    <span class="koboSpan" id="kobo.919.1">
     method was called with the correct arguments.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.920.1">
     Our component also uses the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.921.1">
      getTitle
     </span>
    </code>
    <span class="koboSpan" id="kobo.922.1">
     method to get the document title.
    </span>
    <span class="koboSpan" id="kobo.922.2">
     We can spy directly on that method and return mock data:
    </span>
   </p>
   <ol>
    <li class="numberedList" value="1">
     <span class="koboSpan" id="kobo.923.1">
      First, we need to define the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.924.1">
       Title
      </span>
     </code>
     <span class="koboSpan" id="kobo.925.1">
      service as a spy object and initialize it by passing two parameters—the name of the service and an array of the method names that the component currently uses:
     </span>
     <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.926.1">const</span></span><span class="koboSpan" id="kobo.927.1"> titleSpy = jasmine.</span><span class="hljs-title"><span class="koboSpan" id="kobo.928.1">createSpyObj</span></span><span class="koboSpan" id="kobo.929.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.930.1">'Title'</span></span><span class="koboSpan" id="kobo.931.1">, [
  </span><span class="hljs-string"><span class="koboSpan" id="kobo.932.1">'getTitle'</span></span><span class="koboSpan" id="kobo.933.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.934.1">'setTitle'</span></span><span class="koboSpan" id="kobo.935.1">
]);
</span></code></pre>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.936.1">
      Then we attach a spy to the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.937.1">
       getTitle
      </span>
     </code>
     <span class="koboSpan" id="kobo.938.1">
      method and return a custom title using the Jasmine
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.939.1">
       returnValue
      </span>
     </code>
     <span class="koboSpan" id="kobo.940.1">
      method:
     </span>
     <pre class="programlisting code-one"><code class="hljs-code"><span class="koboSpan" id="kobo.941.1">titleSpy.</span><span class="hljs-property"><span class="koboSpan" id="kobo.942.1">getTitle</span></span><span class="koboSpan" id="kobo.943.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.944.1">and</span></span><span class="koboSpan" id="kobo.945.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.946.1">returnValue</span></span><span class="koboSpan" id="kobo.947.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.948.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.949.1">My title'</span></span><span class="koboSpan" id="kobo.950.1">);
</span></code></pre>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.951.1">
      Finally, we add the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.952.1">
       titleSpy
      </span>
     </code>
     <span class="koboSpan" id="kobo.953.1">
      variable in the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.954.1">
       providers
      </span>
     </code>
     <span class="koboSpan" id="kobo.955.1">
      array of the testing module:
     </span>
     <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.956.1">await</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.957.1">TestBed</span></span><span class="koboSpan" id="kobo.958.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.959.1">configureTestingModule</span></span><span class="koboSpan" id="kobo.960.1">({
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.961.1">imports</span></span><span class="koboSpan" id="kobo.962.1">: [</span><span class="hljs-title"><span class="koboSpan" id="kobo.963.1">SpyComponent</span></span><span class="koboSpan" id="kobo.964.1">],
  </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.965.1">providers: [</span></strong></span>
    <span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.966.1">{ provide: Title, useValue: titleSpy }</span></strong></span>
  <span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.967.1">]</span></strong></span><span class="koboSpan" id="kobo.968.1">
})
.</span><span class="hljs-title"><span class="koboSpan" id="kobo.969.1">compileComponents</span></span><span class="koboSpan" id="kobo.970.1">();
</span></code></pre>
    </li>
   </ol>
   <p class="normal">
    <span class="koboSpan" id="kobo.971.1">
     The resulting test
    </span>
    <a id="_idIndexMarker816">
    </a>
    <span class="koboSpan" id="kobo.972.1">
     should look like the following:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.973.1">it</span></span><span class="koboSpan" id="kobo.974.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.975.1">'should get the title'</span></span><span class="koboSpan" id="kobo.976.1">, </span><span class="hljs-title"><span class="koboSpan" id="kobo.977.1">async</span></span><span class="koboSpan" id="kobo.978.1"> () =&gt; {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.979.1">const</span></span><span class="koboSpan" id="kobo.980.1"> titleSpy = jasmine.</span><span class="hljs-title"><span class="koboSpan" id="kobo.981.1">createSpyObj</span></span><span class="koboSpan" id="kobo.982.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.983.1">'Title'</span></span><span class="koboSpan" id="kobo.984.1">, [
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.985.1">'getTitle'</span></span><span class="koboSpan" id="kobo.986.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.987.1">'setTitle'</span></span><span class="koboSpan" id="kobo.988.1">
  ]);    
  titleSpy.</span><span class="hljs-property"><span class="koboSpan" id="kobo.989.1">getTitle</span></span><span class="koboSpan" id="kobo.990.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.991.1">and</span></span><span class="koboSpan" id="kobo.992.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.993.1">returnValue</span></span><span class="koboSpan" id="kobo.994.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.995.1">'My title'</span></span><span class="koboSpan" id="kobo.996.1">);
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.997.1">await</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.998.1">TestBed</span></span><span class="koboSpan" id="kobo.999.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1000.1">configureTestingModule</span></span><span class="koboSpan" id="kobo.1001.1">({
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1002.1">imports</span></span><span class="koboSpan" id="kobo.1003.1">: [</span><span class="hljs-title"><span class="koboSpan" id="kobo.1004.1">SpyComponent</span></span><span class="koboSpan" id="kobo.1005.1">],
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1006.1">providers</span></span><span class="koboSpan" id="kobo.1007.1">: [
      { </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1008.1">provide</span></span><span class="koboSpan" id="kobo.1009.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.1010.1">Title</span></span><span class="koboSpan" id="kobo.1011.1">, </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1012.1">useValue</span></span><span class="koboSpan" id="kobo.1013.1">: titleSpy }
    ]
  })
  .</span><span class="hljs-title"><span class="koboSpan" id="kobo.1014.1">compileComponents</span></span><span class="koboSpan" id="kobo.1015.1">();    
  
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1016.1">const</span></span><span class="koboSpan" id="kobo.1017.1"> fixture = </span><span class="hljs-title"><span class="koboSpan" id="kobo.1018.1">TestBed</span></span><span class="koboSpan" id="kobo.1019.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1020.1">createComponent</span></span><span class="koboSpan" id="kobo.1021.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.1022.1">SpyComponent</span></span><span class="koboSpan" id="kobo.1023.1">);
  fixture.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1024.1">detectChanges</span></span><span class="koboSpan" id="kobo.1025.1">();
  
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.1026.1">expect</span></span><span class="koboSpan" id="kobo.1027.1">(fixture.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1028.1">nativeElement</span></span><span class="koboSpan" id="kobo.1029.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1030.1">textContent</span></span><span class="koboSpan" id="kobo.1031.1">).</span><span class="hljs-title"><span class="koboSpan" id="kobo.1032.1">toContain</span></span><span class="koboSpan" id="kobo.1033.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1034.1">'My title'</span></span><span class="koboSpan" id="kobo.1035.1">);
});
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1036.1">
     Very few services
    </span>
    <a id="_idIndexMarker817">
    </a>
    <span class="koboSpan" id="kobo.1037.1">
     are well behaved and straightforward, such as the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1038.1">
      Title
     </span>
    </code>
    <span class="koboSpan" id="kobo.1039.1">
     service, in the sense that they are synchronous.
    </span>
    <span class="koboSpan" id="kobo.1039.2">
     Most of the time, they are asynchronous and can return observables or promises.
    </span>
    <span class="koboSpan" id="kobo.1039.3">
     In the following section, we will learn how to test asynchronous dependencies.
    </span>
   </p>
   <h3 class="heading-3" id="_idParaDest-243">
    <span class="koboSpan" id="kobo.1040.1">
     Testing asynchronous services
    </span>
   </h3>
   <p class="normal">
    <span class="koboSpan" id="kobo.1041.1">
     Angular testing utilities
    </span>
    <a id="_idIndexMarker818">
    </a>
    <span class="koboSpan" id="kobo.1042.1">
     provide two artifacts to tackle asynchronous
    </span>
    <a id="_idIndexMarker819">
    </a>
    <span class="koboSpan" id="kobo.1043.1">
     testing scenarios:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1044.1">
       waitForAsync
      </span>
     </code>
     <span class="koboSpan" id="kobo.1045.1">
      : An asynchronous approach to unit test services.
     </span>
     <span class="koboSpan" id="kobo.1045.2">
      It is combined with the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1046.1">
       whenStable
      </span>
     </code>
     <span class="koboSpan" id="kobo.1047.1">
      method of the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1048.1">
       ComponentFixture
      </span>
     </code>
     <span class="koboSpan" id="kobo.1049.1">
      class.
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1050.1">
       fakeAsync
      </span>
     </code>
     <span class="koboSpan" id="kobo.1051.1">
      : A synchronous approach to unit test services.
     </span>
     <span class="koboSpan" id="kobo.1051.2">
      It is used in combination with the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1052.1">
       tick
      </span>
     </code>
     <span class="koboSpan" id="kobo.1053.1">
      function.
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.1054.1">
     Both approaches provide roughly the same functionality; they only differ in how we use them.
    </span>
    <span class="koboSpan" id="kobo.1054.2">
     Let’s see how we can use each by looking at an example.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1055.1">
     Consider the following
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1056.1">
      async.component.ts
     </span>
    </code>
    <span class="koboSpan" id="kobo.1057.1">
     file:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1058.1">import</span></span><span class="koboSpan" id="kobo.1059.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.1060.1">AsyncPipe</span></span><span class="koboSpan" id="kobo.1061.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1062.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1063.1">'@angular/common'</span></span><span class="koboSpan" id="kobo.1064.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1065.1">import</span></span><span class="koboSpan" id="kobo.1066.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.1067.1">Component</span></span><span class="koboSpan" id="kobo.1068.1">, </span><span class="hljs-title"><span class="koboSpan" id="kobo.1069.1">OnInit</span></span><span class="koboSpan" id="kobo.1070.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1071.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1072.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1073.1">@angular/core'</span></span><span class="koboSpan" id="kobo.1074.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1075.1">import</span></span><span class="koboSpan" id="kobo.1076.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.1077.1">Observable</span></span><span class="koboSpan" id="kobo.1078.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1079.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1080.1">'rxjs'</span></span><span class="koboSpan" id="kobo.1081.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1082.1">import</span></span><span class="koboSpan" id="kobo.1083.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.1084.1">AsyncService</span></span><span class="koboSpan" id="kobo.1085.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1086.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1087.1">'../async.service'</span></span><span class="koboSpan" id="kobo.1088.1">;
</span><span class="hljs-meta"><span class="koboSpan" id="kobo.1089.1">@Component</span></span><span class="koboSpan" id="kobo.1090.1">({
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1091.1">selector</span></span><span class="koboSpan" id="kobo.1092.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.1093.1">'app-async'</span></span><span class="koboSpan" id="kobo.1094.1">,
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1095.1">imports</span></span><span class="koboSpan" id="kobo.1096.1">: [</span><span class="hljs-title"><span class="koboSpan" id="kobo.1097.1">AsyncPipe</span></span><span class="koboSpan" id="kobo.1098.1">],
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1099.1">template</span></span><span class="koboSpan" id="kobo.1100.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.1101.1">`</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.1102.1">    @for(item of items$ | async; track item) {</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.1103.1">      &lt;p&gt;{{ item }}&lt;/p&gt;</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.1104.1">    }</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.1105.1">  `</span></span><span class="koboSpan" id="kobo.1106.1">
})
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1107.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1108.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1109.1">AsyncComponent</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1110.1">implements</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1111.1">OnInit</span></span><span class="koboSpan" id="kobo.1112.1"> {
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1113.1">items$</span></span><span class="koboSpan" id="kobo.1114.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.1115.1">Observable</span></span><span class="koboSpan" id="kobo.1116.1">&lt;</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1117.1">string</span></span><span class="koboSpan" id="kobo.1118.1">[]&gt; | </span><span class="hljs-literal"><span class="koboSpan" id="kobo.1119.1">undefined</span></span><span class="koboSpan" id="kobo.1120.1">;
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.1121.1">constructor</span></span><span class="koboSpan" id="kobo.1122.1">(</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1123.1">private</span></span><span class="hljs-params"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1124.1">asyncService</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1125.1">: </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.1126.1">AsyncService</span></span><span class="koboSpan" id="kobo.1127.1">) {}
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.1128.1">ngOnInit</span></span><span class="koboSpan" id="kobo.1129.1">(): </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1130.1">void</span></span><span class="koboSpan" id="kobo.1131.1"> {
    </span><span class="hljs-variable"><span class="koboSpan" id="kobo.1132.1">this</span></span><span class="koboSpan" id="kobo.1133.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1134.1">items$</span></span><span class="koboSpan" id="kobo.1135.1"> = </span><span class="hljs-variable"><span class="koboSpan" id="kobo.1136.1">this</span></span><span class="koboSpan" id="kobo.1137.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1138.1">asyncService</span></span><span class="koboSpan" id="kobo.1139.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1140.1">getItems</span></span><span class="koboSpan" id="kobo.1141.1">();
  }
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1142.1">
     It injects the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1143.1">
      AsyncService
     </span>
    </code>
    <span class="koboSpan" id="kobo.1144.1">
     from the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1145.1">
      async.service.ts
     </span>
    </code>
    <span class="koboSpan" id="kobo.1146.1">
     file and calls its
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1147.1">
      getItems
     </span>
    </code>
    <span class="koboSpan" id="kobo.1148.1">
     method inside the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1149.1">
      ngOnInit
     </span>
    </code>
    <span class="koboSpan" id="kobo.1150.1">
     method.
    </span>
    <span class="koboSpan" id="kobo.1150.2">
     As we can see, the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1151.1">
      getItems
     </span>
    </code>
    <span class="koboSpan" id="kobo.1152.1">
     method returns an observable of strings.
    </span>
    <span class="koboSpan" id="kobo.1152.2">
     It also introduces a slight delay so that the scenario looks asynchronous:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.1153.1">getItems</span></span><span class="koboSpan" id="kobo.1154.1">(): </span><span class="hljs-title"><span class="koboSpan" id="kobo.1155.1">Observable</span></span><span class="koboSpan" id="kobo.1156.1">&lt;</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1157.1">string</span></span><span class="koboSpan" id="kobo.1158.1">[]&gt; {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1159.1">return</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1160.1">of</span></span><span class="koboSpan" id="kobo.1161.1">(items).</span><span class="hljs-title"><span class="koboSpan" id="kobo.1162.1">pipe</span></span><span class="koboSpan" id="kobo.1163.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.1164.1">delay</span></span><span class="koboSpan" id="kobo.1165.1">(</span><span class="hljs-number"><span class="koboSpan" id="kobo.1166.1">500</span></span><span class="koboSpan" id="kobo.1167.1">));
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1168.1">
     The unit test queries
    </span>
    <a id="_idIndexMarker820">
    </a>
    <span class="koboSpan" id="kobo.1169.1">
     the native element of the component
    </span>
    <a id="_idIndexMarker821">
    </a>
    <span class="koboSpan" id="kobo.1170.1">
     and checks whether the value of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1171.1">
      items$
     </span>
    </code>
    <span class="koboSpan" id="kobo.1172.1">
     observable is displayed correctly:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.1173.1">it</span></span><span class="koboSpan" id="kobo.1174.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1175.1">'should get data with waitForAsync'</span></span><span class="koboSpan" id="kobo.1176.1">, </span><span class="hljs-title"><span class="koboSpan" id="kobo.1177.1">waitForAsync</span></span><span class="koboSpan" id="kobo.1178.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.1179.1">async</span></span><span class="koboSpan" id="kobo.1180.1">() =&gt; {
  fixture.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1181.1">detectChanges</span></span><span class="koboSpan" id="kobo.1182.1">();
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1183.1">await</span></span><span class="koboSpan" id="kobo.1184.1"> fixture.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1185.1">whenStable</span></span><span class="koboSpan" id="kobo.1186.1">();
  fixture.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1187.1">detectChanges</span></span><span class="koboSpan" id="kobo.1188.1">();
  
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1189.1">const</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.1190.1">itemDisplay</span></span><span class="koboSpan" id="kobo.1191.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.1192.1">HTMLElement</span></span><span class="koboSpan" id="kobo.1193.1">[] = fixture.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1194.1">nativeElement</span></span><span class="koboSpan" id="kobo.1195.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1196.1">querySelectorAll</span></span><span class="koboSpan" id="kobo.1197.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1198.1">'p'</span></span><span class="koboSpan" id="kobo.1199.1">);
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.1200.1">expect</span></span><span class="koboSpan" id="kobo.1201.1">(itemDisplay.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1202.1">length</span></span><span class="koboSpan" id="kobo.1203.1">).</span><span class="hljs-title"><span class="koboSpan" id="kobo.1204.1">toBe</span></span><span class="koboSpan" id="kobo.1205.1">(</span><span class="hljs-number"><span class="koboSpan" id="kobo.1206.1">2</span></span><span class="koboSpan" id="kobo.1207.1">);
}));
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1208.1">
     We wrap the test body inside the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1209.1">
      waitForAsync
     </span>
    </code>
    <span class="koboSpan" id="kobo.1210.1">
     method and call the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1211.1">
      detectChanges
     </span>
    </code>
    <span class="koboSpan" id="kobo.1212.1">
     method to trigger change detection.
    </span>
    <span class="koboSpan" id="kobo.1212.2">
     Furthermore, we call the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1213.1">
      whenStable
     </span>
    </code>
    <span class="koboSpan" id="kobo.1214.1">
     method, which returns a promise that is resolved immediately when the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1215.1">
      items$
     </span>
    </code>
    <span class="koboSpan" id="kobo.1216.1">
     observable is complete.
    </span>
    <span class="koboSpan" id="kobo.1216.2">
     When the promise is resolved, we call the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1217.1">
      detectChanges
     </span>
    </code>
    <span class="koboSpan" id="kobo.1218.1">
     method again to trigger data binding and query the DOM accordingly.
    </span>
   </p>
   <div class="note">
    <p class="normal">
     <span class="koboSpan" id="kobo.1219.1">
      The
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1220.1">
       whenStable
      </span>
     </code>
     <span class="koboSpan" id="kobo.1221.1">
      method is also used when we want to test a component that contains a template-driven form.
     </span>
     <span class="koboSpan" id="kobo.1221.2">
      The asynchronous nature of this method makes it preferable to use reactive forms in our Angular applications.
     </span>
    </p>
   </div>
   <p class="normal">
    <span class="koboSpan" id="kobo.1222.1">
     An alternative synchronous approach would be to use the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1223.1">
      fakeAsync
     </span>
    </code>
    <span class="koboSpan" id="kobo.1224.1">
     method and write the same unit test as follows:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.1225.1">it</span></span><span class="koboSpan" id="kobo.1226.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1227.1">'should get items with fakeAsync'</span></span><span class="koboSpan" id="kobo.1228.1">, </span><span class="hljs-title"><span class="koboSpan" id="kobo.1229.1">fakeAsync</span></span><span class="koboSpan" id="kobo.1230.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.1231.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1232.1"> {
  fixture.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1233.1">detectChanges</span></span><span class="koboSpan" id="kobo.1234.1">();
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.1235.1">tick</span></span><span class="koboSpan" id="kobo.1236.1">(</span><span class="hljs-number"><span class="koboSpan" id="kobo.1237.1">500</span></span><span class="koboSpan" id="kobo.1238.1">);
  fixture.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1239.1">detectChanges</span></span><span class="koboSpan" id="kobo.1240.1">();
  
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1241.1">const</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.1242.1">itemDisplay</span></span><span class="koboSpan" id="kobo.1243.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.1244.1">HTMLElement</span></span><span class="koboSpan" id="kobo.1245.1">[] = fixture.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1246.1">nativeElement</span></span><span class="koboSpan" id="kobo.1247.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1248.1">querySelectorAll</span></span><span class="koboSpan" id="kobo.1249.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1250.1">'p'</span></span><span class="koboSpan" id="kobo.1251.1">);
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.1252.1">expect</span></span><span class="koboSpan" id="kobo.1253.1">(itemDisplay.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1254.1">length</span></span><span class="koboSpan" id="kobo.1255.1">).</span><span class="hljs-title"><span class="koboSpan" id="kobo.1256.1">toBe</span></span><span class="koboSpan" id="kobo.1257.1">(</span><span class="hljs-number"><span class="koboSpan" id="kobo.1258.1">2</span></span><span class="koboSpan" id="kobo.1259.1">);
}));
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1260.1">
     In the previous snippet, we wrapped the test body in a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1261.1">
      fakeAsync
     </span>
    </code>
    <span class="koboSpan" id="kobo.1262.1">
     method and replaced the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1263.1">
      whenStable
     </span>
    </code>
    <span class="koboSpan" id="kobo.1264.1">
     method with the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1265.1">
      tick
     </span>
    </code>
    <span class="koboSpan" id="kobo.1266.1">
     function.
    </span>
    <span class="koboSpan" id="kobo.1266.2">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1267.1">
      tick
     </span>
    </code>
    <span class="koboSpan" id="kobo.1268.1">
     function advances the time by
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1269.1">
      500
     </span>
    </code>
    <span class="koboSpan" id="kobo.1270.1">
     ms, which is the virtual delay we introduced in the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1271.1">
      getItems
     </span>
    </code>
    <span class="koboSpan" id="kobo.1272.1">
     method of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1273.1">
      AsyncService
     </span>
    </code>
    <span class="koboSpan" id="kobo.1274.1">
     .
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1275.1">
     Testing
    </span>
    <a id="_idIndexMarker822">
    </a>
    <span class="koboSpan" id="kobo.1276.1">
     components with asynchronous services
    </span>
    <a id="_idIndexMarker823">
    </a>
    <span class="koboSpan" id="kobo.1277.1">
     can sometimes become a nightmare.
    </span>
    <span class="koboSpan" id="kobo.1277.2">
     Still, each of the described approaches can significantly help us in this task.
    </span>
    <span class="koboSpan" id="kobo.1277.3">
     However, components are not only about services but also input and output bindings.
    </span>
    <span class="koboSpan" id="kobo.1277.4">
     In the following section, we will learn how to test the public API of a component.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-244">
    <span class="koboSpan" id="kobo.1278.1">
     Testing with inputs and outputs
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.1279.1">
     So far, we have
    </span>
    <a id="_idIndexMarker824">
    </a>
    <span class="koboSpan" id="kobo.1280.1">
     learned how to test components with simple properties and tackle synchronous and asynchronous dependencies.
    </span>
    <span class="koboSpan" id="kobo.1280.2">
     But there is more to a component than that.
    </span>
    <span class="koboSpan" id="kobo.1280.3">
     As we learned in
    </span>
    <em class="chapterRef">
     <span class="koboSpan" id="kobo.1281.1">
      Chapter 3
     </span>
    </em>
    <span class="koboSpan" id="kobo.1282.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1283.1">
      Structuring User Interfaces with Components
     </span>
    </em>
    <span class="koboSpan" id="kobo.1284.1">
     , a component has a public API consisting of inputs and outputs that should also be tested.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1285.1">
     Since we want to test the public API of a component, it makes sense to test how it interacts when hosted from another component.
    </span>
    <span class="koboSpan" id="kobo.1285.2">
     Testing such a component can be done in two ways:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.1286.1">
      We can verify that our input binding is correctly set.
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.1287.1">
      We can verify that our output binding triggers correctly and that what it emits is received.
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.1288.1">
     Suppose that we have the following
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1289.1">
      bindings.component.ts
     </span>
    </code>
    <span class="koboSpan" id="kobo.1290.1">
     file with an input and output binding:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1291.1">import</span></span><span class="koboSpan" id="kobo.1292.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.1293.1">Component</span></span><span class="koboSpan" id="kobo.1294.1">, input, output } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1295.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1296.1">'@angular/core'</span></span><span class="koboSpan" id="kobo.1297.1">;
</span><span class="hljs-meta"><span class="koboSpan" id="kobo.1298.1">@Component</span></span><span class="koboSpan" id="kobo.1299.1">({
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1300.1">selector</span></span><span class="koboSpan" id="kobo.1301.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.1302.1">'app-bindings'</span></span><span class="koboSpan" id="kobo.1303.1">,
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1304.1">template</span></span><span class="koboSpan" id="kobo.1305.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.1306.1">`</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.1307.1">    &lt;p&gt;{{ title() }}&lt;/p&gt;</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.1308.1">    &lt;button (click)="liked.emit()"&gt;Like!&lt;/button&gt;</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.1309.1">  `</span></span><span class="koboSpan" id="kobo.1310.1">
})
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1311.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1312.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1313.1">BindingsComponent</span></span><span class="koboSpan" id="kobo.1314.1"> {
  title = </span><span class="hljs-title"><span class="koboSpan" id="kobo.1315.1">input</span></span><span class="koboSpan" id="kobo.1316.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1317.1">''</span></span><span class="koboSpan" id="kobo.1318.1">);
  liked = </span><span class="hljs-title"><span class="koboSpan" id="kobo.1319.1">output</span></span><span class="koboSpan" id="kobo.1320.1">();
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1321.1">
     Before we start writing our tests, we should create a test host component inside the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1322.1">
      bindings.component.spec.ts
     </span>
    </code>
    <span class="koboSpan" id="kobo.1323.1">
     file that is going to use the component under test:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-meta"><span class="koboSpan" id="kobo.1324.1">@Component</span></span><span class="koboSpan" id="kobo.1325.1">({
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1326.1">imports</span></span><span class="koboSpan" id="kobo.1327.1">: [</span><span class="hljs-title"><span class="koboSpan" id="kobo.1328.1">BindingsComponent</span></span><span class="koboSpan" id="kobo.1329.1">],
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1330.1">template</span></span><span class="koboSpan" id="kobo.1331.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.1332.1">`</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.1333.1">    &lt;app-bindings [title]="testTitle" (liked)="isFavorite = true"&gt;&lt;/app-bindings&gt;</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.1334.1">  `</span></span><span class="koboSpan" id="kobo.1335.1">
})
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1336.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1337.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1338.1">TestHostComponent</span></span><span class="koboSpan" id="kobo.1339.1"> {
  testTitle = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1340.1">'My title'</span></span><span class="koboSpan" id="kobo.1341.1">;
  isFavorite = </span><span class="hljs-literal"><span class="koboSpan" id="kobo.1342.1">false</span></span><span class="koboSpan" id="kobo.1343.1">;
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1344.1">
     In the setup phase, notice that the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1345.1">
      ComponentFixture
     </span>
    </code>
    <span class="koboSpan" id="kobo.1346.1">
     is of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1347.1">
      TestHostComponent
     </span>
    </code>
    <span class="koboSpan" id="kobo.1348.1">
     type:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.1349.1">describe</span></span><span class="koboSpan" id="kobo.1350.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1351.1">'BindingsComponent'</span></span><span class="koboSpan" id="kobo.1352.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.1353.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1354.1"> {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1355.1">let</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.1356.1">component</span></span><span class="koboSpan" id="kobo.1357.1">: </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1358.1">TestHostComponent</span></strong></span><span class="koboSpan" id="kobo.1359.1">;
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1360.1">let</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.1361.1">fixture</span></span><span class="koboSpan" id="kobo.1362.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.1363.1">ComponentFixture</span></span><span class="koboSpan" id="kobo.1364.1">&lt;</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1365.1">TestHostComponent</span></strong></span><span class="koboSpan" id="kobo.1366.1">&gt;;
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.1367.1">beforeEach</span></span><span class="koboSpan" id="kobo.1368.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.1369.1">async</span></span><span class="koboSpan" id="kobo.1370.1"> () =&gt; {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1371.1">await</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1372.1">TestBed</span></span><span class="koboSpan" id="kobo.1373.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1374.1">configureTestingModule</span></span><span class="koboSpan" id="kobo.1375.1">({
      </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1376.1">imports</span></span><span class="koboSpan" id="kobo.1377.1">: [</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1378.1">TestHostComponent</span></strong></span><span class="koboSpan" id="kobo.1379.1">]
    })
    .</span><span class="hljs-title"><span class="koboSpan" id="kobo.1380.1">compileComponents</span></span><span class="koboSpan" id="kobo.1381.1">();
    
    fixture = </span><span class="hljs-title"><span class="koboSpan" id="kobo.1382.1">TestBed</span></span><span class="koboSpan" id="kobo.1383.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1384.1">createComponent</span></span><span class="koboSpan" id="kobo.1385.1">(</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1386.1">TestHostComponent</span></strong></span><span class="koboSpan" id="kobo.1387.1">);
    component = fixture.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1388.1">componentInstance</span></span><span class="koboSpan" id="kobo.1389.1">;
    fixture.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1390.1">detectChanges</span></span><span class="koboSpan" id="kobo.1391.1">();
  });
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.1392.1">it</span></span><span class="koboSpan" id="kobo.1393.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1394.1">'should create'</span></span><span class="koboSpan" id="kobo.1395.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.1396.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1397.1"> {
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1398.1">expect</span></span><span class="koboSpan" id="kobo.1399.1">(component).</span><span class="hljs-title"><span class="koboSpan" id="kobo.1400.1">toBeTruthy</span></span><span class="koboSpan" id="kobo.1401.1">();
  });
});
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1402.1">
     Our unit tests will validate the behavior of
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1403.1">
      BindingsComponent
     </span>
    </code>
    <span class="koboSpan" id="kobo.1404.1">
     when interacting with
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1405.1">
      TestHostComponent
     </span>
    </code>
    <span class="koboSpan" id="kobo.1406.1">
     .
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1407.1">
     The first test checks whether the input binding to the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1408.1">
      title
     </span>
    </code>
    <span class="koboSpan" id="kobo.1409.1">
     property has been applied correctly:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.1410.1">it</span></span><span class="koboSpan" id="kobo.1411.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1412.1">'should display the title'</span></span><span class="koboSpan" id="kobo.1413.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.1414.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1415.1"> {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1416.1">const</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.1417.1">titleDisplay</span></span><span class="koboSpan" id="kobo.1418.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.1419.1">HTMLElement</span></span><span class="koboSpan" id="kobo.1420.1"> = fixture.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1421.1">nativeElement</span></span><span class="koboSpan" id="kobo.1422.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1423.1">querySelector</span></span><span class="koboSpan" id="kobo.1424.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1425.1">'p'</span></span><span class="koboSpan" id="kobo.1426.1">);
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.1427.1">expect</span></span><span class="koboSpan" id="kobo.1428.1">(titleDisplay.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1429.1">textContent</span></span><span class="koboSpan" id="kobo.1430.1">).</span><span class="hljs-title"><span class="koboSpan" id="kobo.1431.1">toEqual</span></span><span class="koboSpan" id="kobo.1432.1">(component.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1433.1">testTitle</span></span><span class="koboSpan" id="kobo.1434.1">);
});
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1435.1">
     The second test validates whether the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1436.1">
      isFavorite
     </span>
    </code>
    <span class="koboSpan" id="kobo.1437.1">
     property is wired up correctly with the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1438.1">
      liked
     </span>
    </code>
    <span class="koboSpan" id="kobo.1439.1">
     output event:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.1440.1">it</span></span><span class="koboSpan" id="kobo.1441.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1442.1">'should emit the liked event'</span></span><span class="koboSpan" id="kobo.1443.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.1444.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1445.1"> {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1446.1">const</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.1447.1">button</span></span><span class="koboSpan" id="kobo.1448.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.1449.1">HTMLButtonElement</span></span><span class="koboSpan" id="kobo.1450.1"> = fixture.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1451.1">nativeElement</span></span><span class="koboSpan" id="kobo.1452.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1453.1">querySelector</span></span><span class="koboSpan" id="kobo.1454.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1455.1">'button'</span></span><span class="koboSpan" id="kobo.1456.1">);
  button.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1457.1">click</span></span><span class="koboSpan" id="kobo.1458.1">();
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.1459.1">expect</span></span><span class="koboSpan" id="kobo.1460.1">(component.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1461.1">isFavorite</span></span><span class="koboSpan" id="kobo.1462.1">).</span><span class="hljs-title"><span class="koboSpan" id="kobo.1463.1">toBeTrue</span></span><span class="koboSpan" id="kobo.1464.1">();
});
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1465.1">
     In the previous test, we
    </span>
    <a id="_idIndexMarker825">
    </a>
    <span class="koboSpan" id="kobo.1466.1">
     query the DOM for the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1467.1">
      &lt;button&gt;
     </span>
    </code>
    <span class="koboSpan" id="kobo.1468.1">
     element using the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1469.1">
      nativeElement
     </span>
    </code>
    <span class="koboSpan" id="kobo.1470.1">
     property of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1471.1">
      ComponentFixture
     </span>
    </code>
    <span class="koboSpan" id="kobo.1472.1">
     class.
    </span>
    <span class="koboSpan" id="kobo.1472.2">
     Then, we click on it for the output event to emit.
    </span>
    <span class="koboSpan" id="kobo.1472.3">
     Alternatively, we could have used the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1473.1">
      debugElement
     </span>
    </code>
    <span class="koboSpan" id="kobo.1474.1">
     property to find the button and use its
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1475.1">
      triggerEventHandler
     </span>
    </code>
    <span class="koboSpan" id="kobo.1476.1">
     method to click on it:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.1477.1">it</span></span><span class="koboSpan" id="kobo.1478.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1479.1">'should emit the liked event using debugElement'</span></span><span class="koboSpan" id="kobo.1480.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.1481.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1482.1"> {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1483.1">const</span></span><span class="koboSpan" id="kobo.1484.1"> buttonDe = fixture.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1485.1">debugElement</span></span><span class="koboSpan" id="kobo.1486.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1487.1">query</span></span><span class="koboSpan" id="kobo.1488.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.1489.1">By</span></span><span class="koboSpan" id="kobo.1490.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1491.1">css</span></span><span class="koboSpan" id="kobo.1492.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1493.1">'button'</span></span><span class="koboSpan" id="kobo.1494.1">));
  buttonDe.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1495.1">triggerEventHandler</span></span><span class="koboSpan" id="kobo.1496.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1497.1">'click'</span></span><span class="koboSpan" id="kobo.1498.1">);
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.1499.1">expect</span></span><span class="koboSpan" id="kobo.1500.1">(component.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1501.1">isFavorite</span></span><span class="koboSpan" id="kobo.1502.1">).</span><span class="hljs-title"><span class="koboSpan" id="kobo.1503.1">toBeTrue</span></span><span class="koboSpan" id="kobo.1504.1">();
});
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1505.1">
     In the preceding test, we use the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1506.1">
      query
     </span>
    </code>
    <span class="koboSpan" id="kobo.1507.1">
     method, which accepts a
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.1508.1">
      predicate
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1509.1">
     function
    </span>
    <a id="_idIndexMarker826">
    </a>
    <span class="koboSpan" id="kobo.1510.1">
     as a parameter.
    </span>
    <span class="koboSpan" id="kobo.1510.2">
     The predicate uses the CSS method of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1511.1">
      By
     </span>
    </code>
    <span class="koboSpan" id="kobo.1512.1">
     class to locate an element by its CSS selector.
    </span>
   </p>
   <div class="note">
    <p class="normal">
     <span class="koboSpan" id="kobo.1513.1">
      As we learned in the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.1514.1">
       Introducing unit tests in Angular
      </span>
     </em>
     <span class="koboSpan" id="kobo.1515.1">
      section, the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1516.1">
       debugElement
      </span>
     </code>
     <span class="koboSpan" id="kobo.1517.1">
      is framework agnostic.
     </span>
     <span class="koboSpan" id="kobo.1517.2">
      If you are sure that your tests will only run in a browser, you should go with the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1518.1">
       nativeElement
      </span>
     </code>
     <span class="koboSpan" id="kobo.1519.1">
      property.
     </span>
    </p>
   </div>
   <p class="normal">
    <span class="koboSpan" id="kobo.1520.1">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1521.1">
      triggerEventHandler
     </span>
    </code>
    <span class="koboSpan" id="kobo.1522.1">
     method accepts the event name we want to trigger as a parameter; in this case, it is the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1523.1">
      click
     </span>
    </code>
    <span class="koboSpan" id="kobo.1524.1">
     event.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1525.1">
     We could have
    </span>
    <a id="_idIndexMarker827">
    </a>
    <span class="koboSpan" id="kobo.1526.1">
     avoided a lot of code if we had only tested the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1527.1">
      BindingsComponent
     </span>
    </code>
    <span class="koboSpan" id="kobo.1528.1">
     , which would still have been valid.
    </span>
    <span class="koboSpan" id="kobo.1528.2">
     But we would have missed the opportunity to test it as a real-world scenario.
    </span>
    <span class="koboSpan" id="kobo.1528.3">
     The public API of a component is intended to be used by other components, so we should test it in this way.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1529.1">
     Currently, the button we use in the template of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1530.1">
      BindingsComponent
     </span>
    </code>
    <span class="koboSpan" id="kobo.1531.1">
     is a native HTML
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1532.1">
      &lt;button&gt;
     </span>
    </code>
    <span class="koboSpan" id="kobo.1533.1">
     element.
    </span>
    <span class="koboSpan" id="kobo.1533.2">
     If the button was an Angular Material button component, we could use an alternate approach for interacting with it, which is the topic of the following section.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-245">
    <span class="koboSpan" id="kobo.1534.1">
     Testing with a component harness
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.1535.1">
     The Angular CDK library, the
    </span>
    <a id="_idIndexMarker828">
    </a>
    <span class="koboSpan" id="kobo.1536.1">
     core of Angular Material, contains a set of utilities that allow a test to interact with a component over a public testing API.
    </span>
    <span class="koboSpan" id="kobo.1536.2">
     Angular CDK testing utilities enable us to access Angular Material components without relying on their
    </span>
    <a id="_idIndexMarker829">
    </a>
    <span class="koboSpan" id="kobo.1537.1">
     internal implementation using a
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.1538.1">
      component harness
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1539.1">
     .
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1540.1">
     The process of testing an Angular component using a harness consists of the following parts:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1541.1">
       @angular/cdk/testing
      </span>
     </code>
     <span class="koboSpan" id="kobo.1542.1">
      : The npm package that contains infrastructure for interacting with a component harness.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1543.1">
       Testing environment
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1544.1">
      : The environment in which the component harness test will be loaded.
     </span>
     <span class="koboSpan" id="kobo.1544.2">
      The Angular CDK contains a built-in testing environment for unit testing with Karma.
     </span>
     <span class="koboSpan" id="kobo.1544.3">
      It also provides a rich set of tools that allow developers to create custom testing environments.
     </span>
    </li>
    <li class="bulletList">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1545.1">
       Component harness
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1546.1">
      : A
     </span>
     <a id="_idIndexMarker830">
     </a>
     <span class="koboSpan" id="kobo.1547.1">
      class that gives the developer access to the instance of a component in the browser DOM.
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.1548.1">
     To learn how to use
    </span>
    <a id="_idIndexMarker831">
    </a>
    <span class="koboSpan" id="kobo.1549.1">
     component harnesses, we will convert the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1550.1">
      &lt;button&gt;
     </span>
    </code>
    <span class="koboSpan" id="kobo.1551.1">
     element of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1552.1">
      BindingsComponent
     </span>
    </code>
    <span class="koboSpan" id="kobo.1553.1">
     into an Angular Material button:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1554.1">import</span></span><span class="koboSpan" id="kobo.1555.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.1556.1">Component</span></span><span class="koboSpan" id="kobo.1557.1">, input, output } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1558.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1559.1">'@angular/core'</span></span><span class="koboSpan" id="kobo.1560.1">;
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1561.1">import { MatButton } from '@angular/material/button';</span></strong></span>
<span class="hljs-meta"><span class="koboSpan" id="kobo.1562.1">@Component</span></span><span class="koboSpan" id="kobo.1563.1">({
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1564.1">selector</span></span><span class="koboSpan" id="kobo.1565.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.1566.1">'app-bindings'</span></span><span class="koboSpan" id="kobo.1567.1">,
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1568.1">imports</span></span><span class="koboSpan" id="kobo.1569.1">: [</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1570.1">MatButton</span></strong></span><span class="koboSpan" id="kobo.1571.1">],
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1572.1">template</span></span><span class="koboSpan" id="kobo.1573.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.1574.1">`</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.1575.1">    &lt;p&gt;{{ title() }}&lt;/p&gt;</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.1576.1">    &lt;button </span></span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1577.1">mat-button</span></strong></span><span class="hljs-string"><span class="koboSpan" id="kobo.1578.1"> (click)="liked.emit()"&gt;Like!&lt;/button&gt;</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.1579.1">  `</span></span><span class="koboSpan" id="kobo.1580.1">
})
</span></code></pre>
   <div class="note">
    <p class="normal">
     <span class="koboSpan" id="kobo.1581.1">
      The preceding snippet assumes that you have added the Angular Material library to the project that you are working on.
     </span>
    </p>
   </div>
   <p class="normal">
    <span class="koboSpan" id="kobo.1582.1">
     To start using a component harness from the Angular CDK, we need to import the following artifacts from the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1583.1">
      @angular/cdk/testing
     </span>
    </code>
    <span class="koboSpan" id="kobo.1584.1">
     namespace:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1585.1">import</span></span><span class="koboSpan" id="kobo.1586.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.1587.1">TestbedHarnessEnvironment</span></span><span class="koboSpan" id="kobo.1588.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1589.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1590.1">'@angular/cdk/testing/testbed'</span></span><span class="koboSpan" id="kobo.1591.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1592.1">import</span></span><span class="koboSpan" id="kobo.1593.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.1594.1">MatButtonHarness</span></span><span class="koboSpan" id="kobo.1595.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1596.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1597.1">'@angular/material/button/testing'</span></span><span class="koboSpan" id="kobo.1598.1">;
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1599.1">
     In the preceding snippet, we have added the following classes:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1600.1">
       TestbedHarnessEnvironment
      </span>
     </code>
     <span class="koboSpan" id="kobo.1601.1">
      : Represents the testing environment for running unit tests with Karma.
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1602.1">
       MatButtonHarness
      </span>
     </code>
     <span class="koboSpan" id="kobo.1603.1">
      : The component harness for the Angular Material button component.
     </span>
     <span class="koboSpan" id="kobo.1603.2">
      Almost all components of the Angular Material library have a corresponding component harness that we can use.
     </span>
     <div class="packt_tip">
      <p class="normal">
       <span class="koboSpan" id="kobo.1604.1">
        If you are a component library author, the Angular CDK provides all the necessary tools for creating harnesses for your UI components.
       </span>
      </p>
     </div>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.1605.1">
     After we have finished importing all the necessary artifacts, we can write our test:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.1606.1">it</span></span><span class="koboSpan" id="kobo.1607.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1608.1">'should emit the liked event using harness'</span></span><span class="koboSpan" id="kobo.1609.1">, </span><span class="hljs-title"><span class="koboSpan" id="kobo.1610.1">async</span></span><span class="koboSpan" id="kobo.1611.1"> () =&gt; {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1612.1">const</span></span><span class="koboSpan" id="kobo.1613.1"> loader = </span><span class="hljs-title"><span class="koboSpan" id="kobo.1614.1">TestbedHarnessEnvironment</span></span><span class="koboSpan" id="kobo.1615.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1616.1">loader</span></span><span class="koboSpan" id="kobo.1617.1">(fixture);
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1618.1">const</span></span><span class="koboSpan" id="kobo.1619.1"> buttonHarness = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1620.1">await</span></span><span class="koboSpan" id="kobo.1621.1"> loader.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1622.1">getHarness</span></span><span class="koboSpan" id="kobo.1623.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.1624.1">MatButtonHarness</span></span><span class="koboSpan" id="kobo.1625.1">);
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1626.1">await</span></span><span class="koboSpan" id="kobo.1627.1"> buttonHarness.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1628.1">click</span></span><span class="koboSpan" id="kobo.1629.1">();
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.1630.1">expect</span></span><span class="koboSpan" id="kobo.1631.1">(component.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1632.1">isFavorite</span></span><span class="koboSpan" id="kobo.1633.1">).</span><span class="hljs-title"><span class="koboSpan" id="kobo.1634.1">toBeTrue</span></span><span class="koboSpan" id="kobo.1635.1">();
});
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1636.1">
     In the preceding test, the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1637.1">
      loader
     </span>
    </code>
    <span class="koboSpan" id="kobo.1638.1">
     method of the testing environment accepts the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1639.1">
      ComponentFixture
     </span>
    </code>
    <span class="koboSpan" id="kobo.1640.1">
     instance of the current component as a parameter and returns a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1641.1">
      HarnessLoader
     </span>
    </code>
    <span class="koboSpan" id="kobo.1642.1">
     object.
    </span>
    <span class="koboSpan" id="kobo.1642.2">
     The abstraction that an Angular CDK harness provides is based on the concept that it operates on the component fixture, which is an abstraction layer on top of the actual DOM element.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1643.1">
     We surround the
    </span>
    <a id="_idIndexMarker832">
    </a>
    <span class="koboSpan" id="kobo.1644.1">
     body of the test inside an
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1645.1">
      async
     </span>
    </code>
    <span class="koboSpan" id="kobo.1646.1">
     function because component harnesses are promise-based.
    </span>
    <span class="koboSpan" id="kobo.1646.2">
     We use the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1647.1">
      getHarness
     </span>
    </code>
    <span class="koboSpan" id="kobo.1648.1">
     method of the harness loader to load the specific harness for the button component.
    </span>
    <span class="koboSpan" id="kobo.1648.2">
     Finally, we call the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1649.1">
      click
     </span>
    </code>
    <span class="koboSpan" id="kobo.1650.1">
     method of the button component harness to trigger the button click event.
    </span>
   </p>
   <div class="packt_tip">
    <p class="normal">
     <span class="koboSpan" id="kobo.1651.1">
      We do not need to call the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1652.1">
       detectChanges
      </span>
     </code>
     <span class="koboSpan" id="kobo.1653.1">
      method because the Angular CDK component harness triggers change detection automatically.
     </span>
    </p>
   </div>
   <p class="normal">
    <span class="koboSpan" id="kobo.1654.1">
     The component harness is a powerful Angular CDK tool that ensures we interact with components abstractly and safely during testing.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1655.1">
     We have discussed many ways to test a component with a dependency.
    </span>
    <span class="koboSpan" id="kobo.1655.2">
     Now, it is time to learn how to test the dependency itself.
    </span>
   </p>
   <h1 class="heading-1" id="_idParaDest-246">
    <span class="koboSpan" id="kobo.1656.1">
     Testing services
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.1657.1">
     As we learned in
    </span>
    <em class="chapterRef">
     <span class="koboSpan" id="kobo.1658.1">
      Chapter 5
     </span>
    </em>
    <span class="koboSpan" id="kobo.1659.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1660.1">
      Managing Complex Tasks with Services
     </span>
    </em>
    <span class="koboSpan" id="kobo.1661.1">
     , a service can inject other services.
    </span>
    <span class="koboSpan" id="kobo.1661.2">
     Testing a
    </span>
    <a id="_idIndexMarker833">
    </a>
    <span class="koboSpan" id="kobo.1662.1">
     standalone service is pretty straightforward: we get an instance from the injector and then start to query its public properties and methods.
    </span>
   </p>
   <div class="note">
    <p class="normal">
     <span class="koboSpan" id="kobo.1663.1">
      We are only interested in testing the public API of a service, which is the interface that components and other artifacts use.
     </span>
     <span class="koboSpan" id="kobo.1663.2">
      Private properties and methods do not have any value when tested because they represent the internal implementation of the service.
     </span>
    </p>
   </div>
   <p class="normal">
    <span class="koboSpan" id="kobo.1664.1">
     There are two
    </span>
    <a id="_idIndexMarker834">
    </a>
    <span class="koboSpan" id="kobo.1665.1">
     different types of testing that we can perform in a service:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.1666.1">
      Testing synchronous and asynchronous operations, such as a method that returns a simple array or one that returns an observable
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.1667.1">
      Testing services with dependencies, such as a method that makes HTTP requests
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.1668.1">
     In the following sections, we will go through each in more detail.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-247">
    <span class="koboSpan" id="kobo.1669.1">
     Testing synchronous/asynchronous methods
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.1670.1">
     When we create an
    </span>
    <a id="_idIndexMarker835">
    </a>
    <span class="koboSpan" id="kobo.1671.1">
     Angular service using the Angular CLI, it also creates a corresponding test file.
    </span>
    <span class="koboSpan" id="kobo.1671.2">
     Consider the following
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1672.1">
      async.service.spec.ts
     </span>
    </code>
    <span class="koboSpan" id="kobo.1673.1">
     file, which is the test file for the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1674.1">
      AsyncService
     </span>
    </code>
    <span class="koboSpan" id="kobo.1675.1">
     we used earlier:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1676.1">import</span></span><span class="koboSpan" id="kobo.1677.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.1678.1">TestBed</span></span><span class="koboSpan" id="kobo.1679.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1680.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1681.1">'@angular/core/testing'</span></span><span class="koboSpan" id="kobo.1682.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1683.1">import</span></span><span class="koboSpan" id="kobo.1684.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.1685.1">AsyncService</span></span><span class="koboSpan" id="kobo.1686.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1687.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1688.1">'./async.service'</span></span><span class="koboSpan" id="kobo.1689.1">;
</span><span class="hljs-title"><span class="koboSpan" id="kobo.1690.1">describe</span></span><span class="koboSpan" id="kobo.1691.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1692.1">'AsyncService'</span></span><span class="koboSpan" id="kobo.1693.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.1694.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1695.1"> {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1696.1">let</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.1697.1">service</span></span><span class="koboSpan" id="kobo.1698.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.1699.1">AsyncService</span></span><span class="koboSpan" id="kobo.1700.1">;
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.1701.1">beforeEach</span></span><span class="koboSpan" id="kobo.1702.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.1703.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1704.1"> {
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1705.1">TestBed</span></span><span class="koboSpan" id="kobo.1706.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1707.1">configureTestingModule</span></span><span class="koboSpan" id="kobo.1708.1">({});
    service = </span><span class="hljs-title"><span class="koboSpan" id="kobo.1709.1">TestBed</span></span><span class="koboSpan" id="kobo.1710.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1711.1">inject</span></span><span class="koboSpan" id="kobo.1712.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.1713.1">AsyncService</span></span><span class="koboSpan" id="kobo.1714.1">);
  });
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.1715.1">it</span></span><span class="koboSpan" id="kobo.1716.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1717.1">'should be created'</span></span><span class="koboSpan" id="kobo.1718.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.1719.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1720.1"> {
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1721.1">expect</span></span><span class="koboSpan" id="kobo.1722.1">(service).</span><span class="hljs-title"><span class="koboSpan" id="kobo.1723.1">toBeTruthy</span></span><span class="koboSpan" id="kobo.1724.1">();
  });
});
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1725.1">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1726.1">
      AsyncService
     </span>
    </code>
    <span class="koboSpan" id="kobo.1727.1">
     is not dependent on anything.
    </span>
    <span class="koboSpan" id="kobo.1727.2">
     It is also provided with the root injector of the Angular application, so it passes an empty object to the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1728.1">
      configureTestingModule
     </span>
    </code>
    <span class="koboSpan" id="kobo.1729.1">
     method.
    </span>
    <span class="koboSpan" id="kobo.1729.2">
     We can get an instance of the service we test using the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1730.1">
      inject
     </span>
    </code>
    <span class="koboSpan" id="kobo.1731.1">
     method of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1732.1">
      TestBed
     </span>
    </code>
    <span class="koboSpan" id="kobo.1733.1">
     class.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1734.1">
     The first test that
    </span>
    <a id="_idIndexMarker836">
    </a>
    <span class="koboSpan" id="kobo.1735.1">
     we can write is pretty straightforward as it calls the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1736.1">
      setItems
     </span>
    </code>
    <span class="koboSpan" id="kobo.1737.1">
     method and inspects its result:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.1738.1">it</span></span><span class="koboSpan" id="kobo.1739.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1740.1">'should set items'</span></span><span class="koboSpan" id="kobo.1741.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.1742.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1743.1"> {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1744.1">const</span></span><span class="koboSpan" id="kobo.1745.1"> result = service.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1746.1">setItems</span></span><span class="koboSpan" id="kobo.1747.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1748.1">'Camera'</span></span><span class="koboSpan" id="kobo.1749.1">);
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.1750.1">expect</span></span><span class="koboSpan" id="kobo.1751.1">(result.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1752.1">length</span></span><span class="koboSpan" id="kobo.1753.1">).</span><span class="hljs-title"><span class="koboSpan" id="kobo.1754.1">toBe</span></span><span class="koboSpan" id="kobo.1755.1">(</span><span class="hljs-number"><span class="koboSpan" id="kobo.1756.1">3</span></span><span class="koboSpan" id="kobo.1757.1">);
});
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1758.1">
     Writing a test for
    </span>
    <a id="_idIndexMarker837">
    </a>
    <span class="koboSpan" id="kobo.1759.1">
     synchronous methods, as in the previous case, is usually relatively easy; however, things are different when we want to test an asynchronous method such as the following.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1760.1">
     This second test is a bit tricky because it involves an observable.
    </span>
    <span class="koboSpan" id="kobo.1760.2">
     We need to subscribe to the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1761.1">
      getItems
     </span>
    </code>
    <span class="koboSpan" id="kobo.1762.1">
     method and inspect the value as soon as the observable is complete:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.1763.1">it</span></span><span class="koboSpan" id="kobo.1764.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1765.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1766.1">should get items'</span></span><span class="koboSpan" id="kobo.1767.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.1768.1">(</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1769.1">done</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1770.1">: </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.1771.1">DoneFn</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1772.1">) =&gt;</span></span><span class="koboSpan" id="kobo.1773.1"> {
  service.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1774.1">getItems</span></span><span class="koboSpan" id="kobo.1775.1">().</span><span class="hljs-title"><span class="koboSpan" id="kobo.1776.1">subscribe</span></span><span class="koboSpan" id="kobo.1777.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.1778.1">items</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1779.1"> =&gt;</span></span><span class="koboSpan" id="kobo.1780.1"> {
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1781.1">expect</span></span><span class="koboSpan" id="kobo.1782.1">(items.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1783.1">length</span></span><span class="koboSpan" id="kobo.1784.1">).</span><span class="hljs-title"><span class="koboSpan" id="kobo.1785.1">toBe</span></span><span class="koboSpan" id="kobo.1786.1">(</span><span class="hljs-number"><span class="koboSpan" id="kobo.1787.1">2</span></span><span class="koboSpan" id="kobo.1788.1">);
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1789.1">done</span></span><span class="koboSpan" id="kobo.1790.1">();
  });
}); 
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1791.1">
     The Karma test runner does not know when an observable will complete, so we provide the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1792.1">
      done
     </span>
    </code>
    <span class="koboSpan" id="kobo.1793.1">
     method to signal that the observable has been completed, and we can now assert the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1794.1">
      expect
     </span>
    </code>
    <span class="koboSpan" id="kobo.1795.1">
     statement.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-248">
    <span class="koboSpan" id="kobo.1796.1">
     Testing services with dependencies
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.1797.1">
     Testing services with
    </span>
    <a id="_idIndexMarker838">
    </a>
    <span class="koboSpan" id="kobo.1798.1">
     dependencies is similar to testing components with
    </span>
    <a id="_idIndexMarker839">
    </a>
    <span class="koboSpan" id="kobo.1799.1">
     dependencies.
    </span>
    <span class="koboSpan" id="kobo.1799.2">
     Every method we saw in the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1800.1">
      Testing components
     </span>
    </em>
    <span class="koboSpan" id="kobo.1801.1">
     section can be applied similarly; however, we follow a different approach when testing a service that injects the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1802.1">
      HttpClient
     </span>
    </code>
    <span class="koboSpan" id="kobo.1803.1">
     service.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1804.1">
     Consider the following
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1805.1">
      deps.service.ts
     </span>
    </code>
    <span class="koboSpan" id="kobo.1806.1">
     file that uses the HTTP client:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1807.1">import</span></span><span class="koboSpan" id="kobo.1808.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.1809.1">HttpClient</span></span><span class="koboSpan" id="kobo.1810.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1811.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1812.1">'@angular/common/http'</span></span><span class="koboSpan" id="kobo.1813.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1814.1">import</span></span><span class="koboSpan" id="kobo.1815.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.1816.1">Injectable</span></span><span class="koboSpan" id="kobo.1817.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1818.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1819.1">'@angular/core'</span></span><span class="koboSpan" id="kobo.1820.1">;
</span><span class="hljs-meta"><span class="koboSpan" id="kobo.1821.1">@Injectable</span></span><span class="koboSpan" id="kobo.1822.1">({
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1823.1">providedIn</span></span><span class="koboSpan" id="kobo.1824.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.1825.1">'root'</span></span><span class="koboSpan" id="kobo.1826.1">
})
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1827.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1828.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1829.1">DepsService</span></span><span class="koboSpan" id="kobo.1830.1"> {
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.1831.1">constructor</span></span><span class="koboSpan" id="kobo.1832.1">(</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1833.1">private</span></span><span class="hljs-params"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1834.1">http</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1835.1">: </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.1836.1">HttpClient</span></span><span class="koboSpan" id="kobo.1837.1">) { }
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.1838.1">getItems</span></span><span class="koboSpan" id="kobo.1839.1">() {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1840.1">return</span></span> <span class="hljs-variable"><span class="koboSpan" id="kobo.1841.1">this</span></span><span class="koboSpan" id="kobo.1842.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1843.1">http</span></span><span class="koboSpan" id="kobo.1844.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1845.1">get</span></span><span class="koboSpan" id="kobo.1846.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1847.1">'http://some.url'</span></span><span class="koboSpan" id="kobo.1848.1">);
  }
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.1849.1">addItem</span></span><span class="koboSpan" id="kobo.1850.1">(</span><span class="hljs-attr"><span class="koboSpan" id="kobo.1851.1">item</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1852.1">: </span></span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1853.1">string</span></span><span class="koboSpan" id="kobo.1854.1">) {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1855.1">return</span></span> <span class="hljs-variable"><span class="koboSpan" id="kobo.1856.1">this</span></span><span class="koboSpan" id="kobo.1857.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1858.1">http</span></span><span class="koboSpan" id="kobo.1859.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1860.1">post</span></span><span class="koboSpan" id="kobo.1861.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1862.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1863.1">http://some.url'</span></span><span class="koboSpan" id="kobo.1864.1">, { </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1865.1">name</span></span><span class="koboSpan" id="kobo.1866.1">: item });
  }
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1867.1">
     Angular testing
    </span>
    <a id="_idIndexMarker840">
    </a>
    <span class="koboSpan" id="kobo.1868.1">
     utilities provide two artifacts for mocking HTTP
    </span>
    <a id="_idIndexMarker841">
    </a>
    <span class="koboSpan" id="kobo.1869.1">
     requests in unit tests: the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1870.1">
      provideHttpClientTesting
     </span>
    </code>
    <span class="koboSpan" id="kobo.1871.1">
     function, which provides an HTTP client for testing, and the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1872.1">
      HttpTestingController
     </span>
    </code>
    <span class="koboSpan" id="kobo.1873.1">
     , which mocks the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1874.1">
      HttpClient
     </span>
    </code>
    <span class="koboSpan" id="kobo.1875.1">
     service.
    </span>
    <span class="koboSpan" id="kobo.1875.2">
     We can import both from the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1876.1">
      @angular/common/http/testing
     </span>
    </code>
    <span class="koboSpan" id="kobo.1877.1">
     namespace:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1878.1">import</span></span><span class="koboSpan" id="kobo.1879.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.1880.1">TestBed</span></span><span class="koboSpan" id="kobo.1881.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1882.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1883.1">'@angular/core/testing'</span></span><span class="koboSpan" id="kobo.1884.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1885.1">import</span></span><span class="koboSpan" id="kobo.1886.1"> { provideHttpClient } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1887.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1888.1">'@angular/common/http'</span></span><span class="koboSpan" id="kobo.1889.1">;
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1890.1">import { HttpTestingController, provideHttpClientTesting } from '@angular/common/http/testing';</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1891.1">import</span></span><span class="koboSpan" id="kobo.1892.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.1893.1">DepsService</span></span><span class="koboSpan" id="kobo.1894.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1895.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1896.1">'./deps.service'</span></span><span class="koboSpan" id="kobo.1897.1">;
</span><span class="hljs-title"><span class="koboSpan" id="kobo.1898.1">describe</span></span><span class="koboSpan" id="kobo.1899.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1900.1">'DepsService'</span></span><span class="koboSpan" id="kobo.1901.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.1902.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1903.1"> {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1904.1">let</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.1905.1">service</span></span><span class="koboSpan" id="kobo.1906.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.1907.1">DepsService</span></span><span class="koboSpan" id="kobo.1908.1">;
  </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1909.1">let httpTestingController: HttpTestingController;</span></strong></span>
  <span class="hljs-title"><span class="koboSpan" id="kobo.1910.1">beforeEach</span></span><span class="koboSpan" id="kobo.1911.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.1912.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1913.1"> {
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1914.1">TestBed</span></span><span class="koboSpan" id="kobo.1915.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1916.1">configureTestingModule</span></span><span class="koboSpan" id="kobo.1917.1">({
      </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1918.1">providers: [</span></strong></span>
        <span class="hljs-title"><span class="koboSpan" id="kobo.1919.1">provideHttpClient</span></span><span class="koboSpan" id="kobo.1920.1">(),
        </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1921.1">provideHttpClientTesting()</span></strong></span>
      <span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1922.1">]</span></strong></span><span class="koboSpan" id="kobo.1923.1">
    });
    service = </span><span class="hljs-title"><span class="koboSpan" id="kobo.1924.1">TestBed</span></span><span class="koboSpan" id="kobo.1925.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1926.1">inject</span></span><span class="koboSpan" id="kobo.1927.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.1928.1">DepsService</span></span><span class="koboSpan" id="kobo.1929.1">);
    </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1930.1">httpTestingController = TestBed.inject(HttpTestingController);</span></strong></span><span class="koboSpan" id="kobo.1931.1">
  });
});
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1932.1">
     Our tests should not make a real HTTP request.
    </span>
    <span class="koboSpan" id="kobo.1932.2">
     They only need to validate that it will be made with the correct options.
    </span>
    <span class="koboSpan" id="kobo.1932.3">
     The following is the first test that validates the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1933.1">
      getItems
     </span>
    </code>
    <span class="koboSpan" id="kobo.1934.1">
     method:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.1935.1">it</span></span><span class="koboSpan" id="kobo.1936.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1937.1">'should get items'</span></span><span class="koboSpan" id="kobo.1938.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.1939.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1940.1"> {
  service.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1941.1">getItems</span></span><span class="koboSpan" id="kobo.1942.1">().</span><span class="hljs-title"><span class="koboSpan" id="kobo.1943.1">subscribe</span></span><span class="koboSpan" id="kobo.1944.1">();
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1945.1">const</span></span><span class="koboSpan" id="kobo.1946.1"> req = httpTestingController.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1947.1">expectOne</span></span><span class="koboSpan" id="kobo.1948.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1949.1">'http://some.url'</span></span><span class="koboSpan" id="kobo.1950.1">);
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.1951.1">expect</span></span><span class="koboSpan" id="kobo.1952.1">(req.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1953.1">request</span></span><span class="koboSpan" id="kobo.1954.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1955.1">method</span></span><span class="koboSpan" id="kobo.1956.1">).</span><span class="hljs-title"><span class="koboSpan" id="kobo.1957.1">toBe</span></span><span class="koboSpan" id="kobo.1958.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1959.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1960.1">GET'</span></span><span class="koboSpan" id="kobo.1961.1">);
});
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1962.1">
     In the preceding
    </span>
    <a id="_idIndexMarker842">
    </a>
    <span class="koboSpan" id="kobo.1963.1">
     test, we create a fake request using
    </span>
    <a id="_idIndexMarker843">
    </a>
    <span class="koboSpan" id="kobo.1964.1">
     the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1965.1">
      expectOne
     </span>
    </code>
    <span class="koboSpan" id="kobo.1966.1">
     method of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1967.1">
      HttpTestingController
     </span>
    </code>
    <span class="koboSpan" id="kobo.1968.1">
     that takes a URL as an argument.
    </span>
    <span class="koboSpan" id="kobo.1968.2">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1969.1">
      expectOne
     </span>
    </code>
    <span class="koboSpan" id="kobo.1970.1">
     method creates a mock request object and asserts that only one request is made to the specific URL.
    </span>
    <span class="koboSpan" id="kobo.1970.2">
     After we have created our request, we can validate that its method is
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1971.1">
      GET
     </span>
    </code>
    <span class="koboSpan" id="kobo.1972.1">
     .
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1973.1">
     We follow a similar approach when testing the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1974.1">
      addItem
     </span>
    </code>
    <span class="koboSpan" id="kobo.1975.1">
     method, except that we need to make sure that the body of the request contains the correct data:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.1976.1">it</span></span><span class="koboSpan" id="kobo.1977.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1978.1">'should add an item'</span></span><span class="koboSpan" id="kobo.1979.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.1980.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1981.1"> {
  service.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1982.1">addItem</span></span><span class="koboSpan" id="kobo.1983.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1984.1">'Camera'</span></span><span class="koboSpan" id="kobo.1985.1">).</span><span class="hljs-title"><span class="koboSpan" id="kobo.1986.1">subscribe</span></span><span class="koboSpan" id="kobo.1987.1">();
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1988.1">const</span></span><span class="koboSpan" id="kobo.1989.1"> req = httpTestingController.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1990.1">expectOne</span></span><span class="koboSpan" id="kobo.1991.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1992.1">'http://some.url'</span></span><span class="koboSpan" id="kobo.1993.1">);
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.1994.1">expect</span></span><span class="koboSpan" id="kobo.1995.1">(req.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1996.1">request</span></span><span class="koboSpan" id="kobo.1997.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1998.1">method</span></span><span class="koboSpan" id="kobo.1999.1">).</span><span class="hljs-title"><span class="koboSpan" id="kobo.2000.1">toBe</span></span><span class="koboSpan" id="kobo.2001.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2002.1">'POST'</span></span><span class="koboSpan" id="kobo.2003.1">);
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.2004.1">expect</span></span><span class="koboSpan" id="kobo.2005.1">(req.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2006.1">request</span></span><span class="koboSpan" id="kobo.2007.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2008.1">body</span></span><span class="koboSpan" id="kobo.2009.1">).</span><span class="hljs-title"><span class="koboSpan" id="kobo.2010.1">toEqual</span></span><span class="koboSpan" id="kobo.2011.1">({
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2012.1">name</span></span><span class="koboSpan" id="kobo.2013.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.2014.1">'Camera'</span></span><span class="koboSpan" id="kobo.2015.1">
  });
});
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.2016.1">
     After each test, we make sure that no unmatched requests are pending using the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2017.1">
      verify
     </span>
    </code>
    <span class="koboSpan" id="kobo.2018.1">
     method inside an
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2019.1">
      afterEach
     </span>
    </code>
    <span class="koboSpan" id="kobo.2020.1">
     block:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.2021.1">afterEach</span></span><span class="koboSpan" id="kobo.2022.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.2023.1">() =&gt;</span></span><span class="koboSpan" id="kobo.2024.1"> {
  httpTestingController.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2025.1">verify</span></span><span class="koboSpan" id="kobo.2026.1">();
});
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.2027.1">
     In the following section, we continue our journey through the testing world by learning how to test a pipe.
    </span>
   </p>
   <h1 class="heading-1" id="_idParaDest-249">
    <span class="koboSpan" id="kobo.2028.1">
     Testing pipes
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.2029.1">
     As we learned in
    </span>
    <em class="chapterRef">
     <span class="koboSpan" id="kobo.2030.1">
      Chapter 4
     </span>
    </em>
    <span class="koboSpan" id="kobo.2031.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.2032.1">
      Enriching Applications Using Pipes and Directives
     </span>
    </em>
    <span class="koboSpan" id="kobo.2033.1">
     , a pipe is a TypeScript class that
    </span>
    <a id="_idIndexMarker844">
    </a>
    <span class="koboSpan" id="kobo.2034.1">
     implements the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2035.1">
      PipeTransform
     </span>
    </code>
    <span class="koboSpan" id="kobo.2036.1">
     interface.
    </span>
    <span class="koboSpan" id="kobo.2036.2">
     It exposes a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2037.1">
      transform
     </span>
    </code>
    <span class="koboSpan" id="kobo.2038.1">
     method, which is usually synchronous, which means it is straightforward to test.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2039.1">
     Consider the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2040.1">
      list.pipe.ts
     </span>
    </code>
    <span class="koboSpan" id="kobo.2041.1">
     file
    </span>
    <a id="_idIndexMarker845">
    </a>
    <span class="koboSpan" id="kobo.2042.1">
     containing a pipe that converts a comma-separated string into a list:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2043.1">import</span></span><span class="koboSpan" id="kobo.2044.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.2045.1">Pipe</span></span><span class="koboSpan" id="kobo.2046.1">, </span><span class="hljs-title"><span class="koboSpan" id="kobo.2047.1">PipeTransform</span></span><span class="koboSpan" id="kobo.2048.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2049.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2050.1">'@angular/core'</span></span><span class="koboSpan" id="kobo.2051.1">;
 
</span><span class="hljs-meta"><span class="koboSpan" id="kobo.2052.1">@Pipe</span></span><span class="koboSpan" id="kobo.2053.1">({
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2054.1">name</span></span><span class="koboSpan" id="kobo.2055.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.2056.1">'list'</span></span><span class="koboSpan" id="kobo.2057.1">
})
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2058.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2059.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2060.1">ListPipe</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2061.1">implements</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2062.1">PipeTransform</span></span><span class="koboSpan" id="kobo.2063.1"> {
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.2064.1">transform</span></span><span class="koboSpan" id="kobo.2065.1">(</span><span class="hljs-attr"><span class="koboSpan" id="kobo.2066.1">value</span></span><span class="koboSpan" id="kobo.2067.1">: </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2068.1">string</span></span><span class="koboSpan" id="kobo.2069.1">): </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2070.1">string</span></span><span class="koboSpan" id="kobo.2071.1">[] {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2072.1">return</span></span><span class="koboSpan" id="kobo.2073.1"> value.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2074.1">split</span></span><span class="koboSpan" id="kobo.2075.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2076.1">','</span></span><span class="koboSpan" id="kobo.2077.1">);
  }
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.2078.1">
     Writing a test is simple.
    </span>
    <span class="koboSpan" id="kobo.2078.2">
     The only thing that we need to do is to instantiate an instance of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2079.1">
      ListPipe
     </span>
    </code>
    <span class="koboSpan" id="kobo.2080.1">
     class and verify the outcome of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2081.1">
      transform
     </span>
    </code>
    <span class="koboSpan" id="kobo.2082.1">
     method with some mock data:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.2083.1">it</span></span><span class="koboSpan" id="kobo.2084.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2085.1">'should return an array'</span></span><span class="koboSpan" id="kobo.2086.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.2087.1">() =&gt;</span></span><span class="koboSpan" id="kobo.2088.1"> {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2089.1">const</span></span><span class="koboSpan" id="kobo.2090.1"> pipe = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2091.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2092.1">ListPipe</span></span><span class="koboSpan" id="kobo.2093.1">();
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.2094.1">expect</span></span><span class="koboSpan" id="kobo.2095.1">(pipe.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2096.1">transform</span></span><span class="koboSpan" id="kobo.2097.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2098.1">'A,B,C'</span></span><span class="koboSpan" id="kobo.2099.1">)).</span><span class="hljs-title"><span class="koboSpan" id="kobo.2100.1">toEqual</span></span><span class="koboSpan" id="kobo.2101.1">([</span><span class="hljs-string"><span class="koboSpan" id="kobo.2102.1">'A'</span></span><span class="koboSpan" id="kobo.2103.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.2104.1">'B'</span></span><span class="koboSpan" id="kobo.2105.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.2106.1">'C'</span></span><span class="koboSpan" id="kobo.2107.1">]);
});
</span></code></pre>
   <div class="note">
    <p class="normal">
     <span class="koboSpan" id="kobo.2108.1">
      Angular testing utilities are not involved when testing a pipe.
     </span>
     <span class="koboSpan" id="kobo.2108.2">
      We create an instance of the pipe class, and we can start calling the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.2109.1">
       transform
      </span>
     </code>
     <span class="koboSpan" id="kobo.2110.1">
      method.
     </span>
    </p>
   </div>
   <p class="normal">
    <span class="koboSpan" id="kobo.2111.1">
     Angular directives are artifacts that we may not create very often since the built-in collection that the framework provides is more than enough; however, if we create custom directives, we should also test them.
    </span>
    <span class="koboSpan" id="kobo.2111.2">
     In the following section, we will learn how to accomplish this.
    </span>
   </p>
   <h1 class="heading-1" id="_idParaDest-250">
    <span class="koboSpan" id="kobo.2112.1">
     Testing directives
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.2113.1">
     Directives are
    </span>
    <a id="_idIndexMarker846">
    </a>
    <span class="koboSpan" id="kobo.2114.1">
     usually quite straightforward in their overall shape, being components with no view attached.
    </span>
    <span class="koboSpan" id="kobo.2114.2">
     The fact that directives usually work with components gives us a good idea of how to proceed when testing them.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2115.1">
     Consider the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2116.1">
      copyright.directive.ts
     </span>
    </code>
    <span class="koboSpan" id="kobo.2117.1">
     file that we created in
    </span>
    <em class="chapterRef">
     <span class="koboSpan" id="kobo.2118.1">
      Chapter 5
     </span>
    </em>
    <span class="koboSpan" id="kobo.2119.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.2120.1">
      Enriching Applications Using Pipes and Directives
     </span>
    </em>
    <span class="koboSpan" id="kobo.2121.1">
     :
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2122.1">import</span></span><span class="koboSpan" id="kobo.2123.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.2124.1">Directive</span></span><span class="koboSpan" id="kobo.2125.1">, </span><span class="hljs-title"><span class="koboSpan" id="kobo.2126.1">ElementRef</span></span><span class="koboSpan" id="kobo.2127.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2128.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2129.1">'@angular/core'</span></span><span class="koboSpan" id="kobo.2130.1">;
</span><span class="hljs-meta"><span class="koboSpan" id="kobo.2131.1">@Directive</span></span><span class="koboSpan" id="kobo.2132.1">({
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2133.1">selector</span></span><span class="koboSpan" id="kobo.2134.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.2135.1">'[appCopyright]'</span></span><span class="koboSpan" id="kobo.2136.1">
})
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2137.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2138.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2139.1">CopyrightDirective</span></span><span class="koboSpan" id="kobo.2140.1"> {
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.2141.1">constructor</span></span><span class="koboSpan" id="kobo.2142.1">(</span><span class="hljs-attr"><span class="koboSpan" id="kobo.2143.1">el</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2144.1">: </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.2145.1">ElementRef</span></span><span class="koboSpan" id="kobo.2146.1">) {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2147.1">const</span></span><span class="koboSpan" id="kobo.2148.1"> currentYear = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2149.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2150.1">Date</span></span><span class="koboSpan" id="kobo.2151.1">().</span><span class="hljs-title"><span class="koboSpan" id="kobo.2152.1">getFullYear</span></span><span class="koboSpan" id="kobo.2153.1">();
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2154.1">const</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.2155.1">targetEl</span></span><span class="koboSpan" id="kobo.2156.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.2157.1">HTMLElement</span></span><span class="koboSpan" id="kobo.2158.1"> = el.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2159.1">nativeElement</span></span><span class="koboSpan" id="kobo.2160.1">;
    targetEl.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2161.1">classList</span></span><span class="koboSpan" id="kobo.2162.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2163.1">add</span></span><span class="koboSpan" id="kobo.2164.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2165.1">'copyright'</span></span><span class="koboSpan" id="kobo.2166.1">);
    targetEl.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2167.1">textContent</span></span><span class="koboSpan" id="kobo.2168.1"> = </span><span class="hljs-string"><span class="koboSpan" id="kobo.2169.1">`Copyright ©</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.2170.1">${currentYear}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2171.1"> All Rights Reserved`</span></span><span class="koboSpan" id="kobo.2172.1">;
  }  
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.2173.1">
     A directive is usually used with a component, so it makes sense to unit test it while using it on a component.
    </span>
    <span class="koboSpan" id="kobo.2173.2">
     Let’s create a test host component and add it to the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2174.1">
      imports
     </span>
    </code>
    <span class="koboSpan" id="kobo.2175.1">
     array of the testing module:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-meta"><span class="koboSpan" id="kobo.2176.1">@Component</span></span><span class="koboSpan" id="kobo.2177.1">({
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2178.1">imports</span></span><span class="koboSpan" id="kobo.2179.1">: [</span><span class="hljs-title"><span class="koboSpan" id="kobo.2180.1">CopyrightDirective</span></span><span class="koboSpan" id="kobo.2181.1">],
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2182.1">template</span></span><span class="koboSpan" id="kobo.2183.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.2184.1">'&lt;span appCopyright&gt;&lt;/span&gt;'</span></span><span class="koboSpan" id="kobo.2185.1">
})
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2186.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2187.1">TestHostComponent</span></span><span class="koboSpan" id="kobo.2188.1"> { }
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.2189.1">
     We can now write our tests that check whether the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2190.1">
      &lt;span&gt;
     </span>
    </code>
    <span class="koboSpan" id="kobo.2191.1">
     element contains the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2192.1">
      copyright
     </span>
    </code>
    <span class="koboSpan" id="kobo.2193.1">
     class and displays the current year in its
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2194.1">
      textContent
     </span>
    </code>
    <span class="koboSpan" id="kobo.2195.1">
     property:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.2196.1">describe</span></span><span class="koboSpan" id="kobo.2197.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2198.1">'CopyrightDirective'</span></span><span class="koboSpan" id="kobo.2199.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.2200.1">() =&gt;</span></span><span class="koboSpan" id="kobo.2201.1"> {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2202.1">let</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.2203.1">container</span></span><span class="koboSpan" id="kobo.2204.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.2205.1">HTMLElement</span></span><span class="koboSpan" id="kobo.2206.1">;
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.2207.1">beforeEach</span></span><span class="koboSpan" id="kobo.2208.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.2209.1">() =&gt;</span></span><span class="koboSpan" id="kobo.2210.1"> {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2211.1">const</span></span><span class="koboSpan" id="kobo.2212.1"> fixture = </span><span class="hljs-title"><span class="koboSpan" id="kobo.2213.1">TestBed</span></span><span class="koboSpan" id="kobo.2214.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2215.1">configureTestingModule</span></span><span class="koboSpan" id="kobo.2216.1">({
      </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2217.1">imports</span></span><span class="koboSpan" id="kobo.2218.1">: [</span><span class="hljs-title"><span class="koboSpan" id="kobo.2219.1">TestHostComponent</span></span><span class="koboSpan" id="kobo.2220.1">]
    })
    .</span><span class="hljs-title"><span class="koboSpan" id="kobo.2221.1">createComponent</span></span><span class="koboSpan" id="kobo.2222.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.2223.1">TestHostComponent</span></span><span class="koboSpan" id="kobo.2224.1">);
    container = fixture.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2225.1">nativeElement</span></span><span class="koboSpan" id="kobo.2226.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2227.1">querySelector</span></span><span class="koboSpan" id="kobo.2228.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2229.1">'span'</span></span><span class="koboSpan" id="kobo.2230.1">);
  });
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.2231.1">it</span></span><span class="koboSpan" id="kobo.2232.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2233.1">'should have copyright class'</span></span><span class="koboSpan" id="kobo.2234.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.2235.1">() =&gt;</span></span><span class="koboSpan" id="kobo.2236.1"> {
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.2237.1">expect</span></span><span class="koboSpan" id="kobo.2238.1">(container.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2239.1">classList</span></span><span class="koboSpan" id="kobo.2240.1">).</span><span class="hljs-title"><span class="koboSpan" id="kobo.2241.1">toContain</span></span><span class="koboSpan" id="kobo.2242.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2243.1">'copyright'</span></span><span class="koboSpan" id="kobo.2244.1">);
  });
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.2245.1">it</span></span><span class="koboSpan" id="kobo.2246.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2247.1">'should display copyright details'</span></span><span class="koboSpan" id="kobo.2248.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.2249.1">() =&gt;</span></span><span class="koboSpan" id="kobo.2250.1"> {
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.2251.1">expect</span></span><span class="koboSpan" id="kobo.2252.1">(container.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2253.1">textContent</span></span><span class="koboSpan" id="kobo.2254.1">).</span><span class="hljs-title"><span class="koboSpan" id="kobo.2255.1">toContain</span></span><span class="koboSpan" id="kobo.2256.1">(</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2257.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2258.1">Date</span></span><span class="koboSpan" id="kobo.2259.1">().</span><span class="hljs-title"><span class="koboSpan" id="kobo.2260.1">getFullYear</span></span><span class="koboSpan" id="kobo.2261.1">().</span><span class="hljs-title"><span class="koboSpan" id="kobo.2262.1">toString</span></span><span class="koboSpan" id="kobo.2263.1">());
  });
});
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.2264.1">
     This is how simple it can be to test a directive.
    </span>
    <span class="koboSpan" id="kobo.2264.2">
     The key takeaways are that you need a component to
    </span>
    <a id="_idIndexMarker847">
    </a>
    <span class="koboSpan" id="kobo.2265.1">
     place the directive on and that you implicitly test the directive using the component.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2266.1">
     In the following section, we will learn how to test reactive forms.
    </span>
   </p>
   <h1 class="heading-1" id="_idParaDest-251">
    <span class="koboSpan" id="kobo.2267.1">
     Testing forms
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.2268.1">
     As we saw in
    </span>
    <em class="chapterRef">
     <span class="koboSpan" id="kobo.2269.1">
      Chapter 10
     </span>
    </em>
    <span class="koboSpan" id="kobo.2270.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.2271.1">
      Collecting User Data with Forms
     </span>
    </em>
    <span class="koboSpan" id="kobo.2272.1">
     , forms are integral to an Angular application.
    </span>
    <span class="koboSpan" id="kobo.2272.2">
     It is rare for an Angular application not to have at least one simple form, such as a search form.
    </span>
    <span class="koboSpan" id="kobo.2272.3">
     In
    </span>
    <a id="_idIndexMarker848">
    </a>
    <span class="koboSpan" id="kobo.2273.1">
     this chapter, we will focus on reactive forms because they are easier to test than template-driven forms.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2274.1">
     Consider the following
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2275.1">
      search.component.ts
     </span>
    </code>
    <span class="koboSpan" id="kobo.2276.1">
     file:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2277.1">import</span></span><span class="koboSpan" id="kobo.2278.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.2279.1">Component</span></span><span class="koboSpan" id="kobo.2280.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2281.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2282.1">'@angular/core'</span></span><span class="koboSpan" id="kobo.2283.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2284.1">import</span></span><span class="koboSpan" id="kobo.2285.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.2286.1">FormGroup</span></span><span class="koboSpan" id="kobo.2287.1">, </span><span class="hljs-title"><span class="koboSpan" id="kobo.2288.1">FormControl</span></span><span class="koboSpan" id="kobo.2289.1">, </span><span class="hljs-title"><span class="koboSpan" id="kobo.2290.1">Validators</span></span><span class="koboSpan" id="kobo.2291.1">, </span><span class="hljs-title"><span class="koboSpan" id="kobo.2292.1">ReactiveFormsModule</span></span><span class="koboSpan" id="kobo.2293.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2294.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2295.1">'@angular/forms'</span></span><span class="koboSpan" id="kobo.2296.1">;
</span><span class="hljs-meta"><span class="koboSpan" id="kobo.2297.1">@Component</span></span><span class="koboSpan" id="kobo.2298.1">({
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2299.1">selector</span></span><span class="koboSpan" id="kobo.2300.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.2301.1">'app-search'</span></span><span class="koboSpan" id="kobo.2302.1">,
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2303.1">imports</span></span><span class="koboSpan" id="kobo.2304.1">: [</span><span class="hljs-title"><span class="koboSpan" id="kobo.2305.1">ReactiveFormsModule</span></span><span class="koboSpan" id="kobo.2306.1">],
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2307.1">template</span></span><span class="koboSpan" id="kobo.2308.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.2309.1">`</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.2310.1">    &lt;form [formGroup]="searchForm" (ngSubmit)="search()"&gt;</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.2311.1">      &lt;input type="text" formControlName="searchText"&gt;</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.2312.1">      &lt;button type="submit" [disabled]="searchForm.invalid"&gt;Search&lt;/button&gt;</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.2313.1">    &lt;/form&gt;</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.2314.1">  `</span></span><span class="koboSpan" id="kobo.2315.1">
})
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2316.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2317.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2318.1">SearchComponent</span></span><span class="koboSpan" id="kobo.2319.1"> {
  searchForm = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2320.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2321.1">FormGroup</span></span><span class="koboSpan" id="kobo.2322.1">({
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2323.1">searchText</span></span><span class="koboSpan" id="kobo.2324.1">: </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2325.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2326.1">FormControl</span></span><span class="koboSpan" id="kobo.2327.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2328.1">''</span></span><span class="koboSpan" id="kobo.2329.1">, </span><span class="hljs-title"><span class="koboSpan" id="kobo.2330.1">Validators</span></span><span class="koboSpan" id="kobo.2331.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2332.1">required</span></span><span class="koboSpan" id="kobo.2333.1">)
  });
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.2334.1">search</span></span><span class="koboSpan" id="kobo.2335.1">() {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2336.1">if</span></span><span class="koboSpan" id="kobo.2337.1">(</span><span class="hljs-variable"><span class="koboSpan" id="kobo.2338.1">this</span></span><span class="koboSpan" id="kobo.2339.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2340.1">searchForm</span></span><span class="koboSpan" id="kobo.2341.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2342.1">valid</span></span><span class="koboSpan" id="kobo.2343.1">) {
      </span><span class="hljs-variable"><span class="koboSpan" id="kobo.2344.1">console</span></span><span class="koboSpan" id="kobo.2345.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2346.1">log</span></span><span class="koboSpan" id="kobo.2347.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2348.1">'You searched for: '</span></span><span class="koboSpan" id="kobo.2349.1"> + </span><span class="hljs-variable"><span class="koboSpan" id="kobo.2350.1">this</span></span><span class="koboSpan" id="kobo.2351.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2352.1">searchForm</span></span><span class="koboSpan" id="kobo.2353.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2354.1">controls</span></span><span class="koboSpan" id="kobo.2355.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2356.1">searchText</span></span><span class="koboSpan" id="kobo.2357.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2358.1">value</span></span><span class="koboSpan" id="kobo.2359.1">);
    }
  }
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.2360.1">
     In the preceding component, we can write our unit tests to verify that:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.2361.1">
      The value of the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.2362.1">
       searchText
      </span>
     </code>
     <span class="koboSpan" id="kobo.2363.1">
      form control can be set correctly
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.2364.1">
      The
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.2365.1">
       Search
      </span>
     </code>
     <span class="koboSpan" id="kobo.2366.1">
      button is disabled when the form is invalid
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.2367.1">
      The
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.2368.1">
       console.log
      </span>
     </code>
     <span class="koboSpan" id="kobo.2369.1">
      method is called when the form is valid, and the user clicks the
     </span>
     <strong class="screenText">
      <span class="koboSpan" id="kobo.2370.1">
       Search
      </span>
     </strong>
     <span class="koboSpan" id="kobo.2371.1">
      button
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.2372.1">
     To test a reactive form, we
    </span>
    <a id="_idIndexMarker849">
    </a>
    <span class="koboSpan" id="kobo.2373.1">
     first need to import
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2374.1">
      ReactiveFormsModule
     </span>
    </code>
    <span class="koboSpan" id="kobo.2375.1">
     into the testing module:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2376.1">await</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2377.1">TestBed</span></span><span class="koboSpan" id="kobo.2378.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2379.1">configureTestingModule</span></span><span class="koboSpan" id="kobo.2380.1">({
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2381.1">imports</span></span><span class="koboSpan" id="kobo.2382.1">: [</span><span class="hljs-title"><span class="koboSpan" id="kobo.2383.1">SearchComponent</span></span><span class="koboSpan" id="kobo.2384.1">, </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2385.1">ReactiveFormsModule</span></strong></span><span class="koboSpan" id="kobo.2386.1">]
})
.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2387.1">compileComponents</span></span><span class="koboSpan" id="kobo.2388.1">();
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.2389.1">
     For the first test, we need to assert whether the value propagates to the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2390.1">
      searchText
     </span>
    </code>
    <span class="koboSpan" id="kobo.2391.1">
     form control when we type something into the input control:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.2392.1">it</span></span><span class="koboSpan" id="kobo.2393.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2394.1">'should set the searchText'</span></span><span class="koboSpan" id="kobo.2395.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.2396.1">() =&gt;</span></span><span class="koboSpan" id="kobo.2397.1"> {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2398.1">const</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.2399.1">input</span></span><span class="koboSpan" id="kobo.2400.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.2401.1">HTMLInputElement</span></span><span class="koboSpan" id="kobo.2402.1"> = fixture.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2403.1">nativeElement</span></span><span class="koboSpan" id="kobo.2404.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2405.1">querySelector</span></span><span class="koboSpan" id="kobo.2406.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2407.1">'input'</span></span><span class="koboSpan" id="kobo.2408.1">);
  input.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2409.1">value</span></span><span class="koboSpan" id="kobo.2410.1"> = </span><span class="hljs-string"><span class="koboSpan" id="kobo.2411.1">'Angular'</span></span><span class="koboSpan" id="kobo.2412.1">;
  input.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2413.1">dispatchEvent</span></span><span class="koboSpan" id="kobo.2414.1">(</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2415.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2416.1">CustomEvent</span></span><span class="koboSpan" id="kobo.2417.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2418.1">'input'</span></span><span class="koboSpan" id="kobo.2419.1">));
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.2420.1">expect</span></span><span class="koboSpan" id="kobo.2421.1">(component.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2422.1">searchForm</span></span><span class="koboSpan" id="kobo.2423.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2424.1">controls</span></span><span class="koboSpan" id="kobo.2425.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2426.1">searchText</span></span><span class="koboSpan" id="kobo.2427.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2428.1">value</span></span><span class="koboSpan" id="kobo.2429.1">).</span><span class="hljs-title"><span class="koboSpan" id="kobo.2430.1">toBe</span></span><span class="koboSpan" id="kobo.2431.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2432.1">'Angular'</span></span><span class="koboSpan" id="kobo.2433.1">);
});
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.2434.1">
     In the preceding test, we
    </span>
    <a id="_idIndexMarker850">
    </a>
    <span class="koboSpan" id="kobo.2435.1">
     use the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2436.1">
      querySelector
     </span>
    </code>
    <span class="koboSpan" id="kobo.2437.1">
     method of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2438.1">
      nativeElement
     </span>
    </code>
    <span class="koboSpan" id="kobo.2439.1">
     property to find the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2440.1">
      &lt;input&gt;
     </span>
    </code>
    <span class="koboSpan" id="kobo.2441.1">
     HTML element and set its value.
    </span>
    <span class="koboSpan" id="kobo.2441.2">
     But this alone will not be sufficient for the value to propagate to the form control.
    </span>
    <span class="koboSpan" id="kobo.2441.3">
     The Angular framework will not know whether the value of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2442.1">
      &lt;input&gt;
     </span>
    </code>
    <span class="koboSpan" id="kobo.2443.1">
     HTML element has changed until we trigger the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2444.1">
      input
     </span>
    </code>
    <span class="koboSpan" id="kobo.2445.1">
     DOM event to that element.
    </span>
    <span class="koboSpan" id="kobo.2445.2">
     We are using the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2446.1">
      dispatchEvent
     </span>
    </code>
    <span class="koboSpan" id="kobo.2447.1">
     method to trigger the event, which accepts a single method as a parameter that points to an instance of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2448.1">
      CustomEvent
     </span>
    </code>
    <span class="koboSpan" id="kobo.2449.1">
     class.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2450.1">
     Now that we are sure that the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2451.1">
      searchText
     </span>
    </code>
    <span class="koboSpan" id="kobo.2452.1">
     form control is wired up correctly, we can use it to write the remaining tests:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.2453.1">it</span></span><span class="koboSpan" id="kobo.2454.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2455.1">'should disable search button'</span></span><span class="koboSpan" id="kobo.2456.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.2457.1">() =&gt;</span></span><span class="koboSpan" id="kobo.2458.1"> {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2459.1">const</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.2460.1">button</span></span><span class="koboSpan" id="kobo.2461.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.2462.1">HTMLButtonElement</span></span><span class="koboSpan" id="kobo.2463.1"> = fixture.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2464.1">nativeElement</span></span><span class="koboSpan" id="kobo.2465.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2466.1">querySelector</span></span><span class="koboSpan" id="kobo.2467.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2468.1">'button'</span></span><span class="koboSpan" id="kobo.2469.1">);
  component.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2470.1">searchForm</span></span><span class="koboSpan" id="kobo.2471.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2472.1">controls</span></span><span class="koboSpan" id="kobo.2473.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2474.1">searchText</span></span><span class="koboSpan" id="kobo.2475.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2476.1">setValue</span></span><span class="koboSpan" id="kobo.2477.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2478.1">''</span></span><span class="koboSpan" id="kobo.2479.1">);
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.2480.1">expect</span></span><span class="koboSpan" id="kobo.2481.1">(button.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2482.1">disabled</span></span><span class="koboSpan" id="kobo.2483.1">).</span><span class="hljs-title"><span class="koboSpan" id="kobo.2484.1">toBeTrue</span></span><span class="koboSpan" id="kobo.2485.1">();
});
</span><span class="hljs-title"><span class="koboSpan" id="kobo.2486.1">it</span></span><span class="koboSpan" id="kobo.2487.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2488.1">'should log to the console'</span></span><span class="koboSpan" id="kobo.2489.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.2490.1">() =&gt;</span></span><span class="koboSpan" id="kobo.2491.1"> {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2492.1">const</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.2493.1">button</span></span><span class="koboSpan" id="kobo.2494.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.2495.1">HTMLButtonElement</span></span><span class="koboSpan" id="kobo.2496.1"> = fixture.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2497.1">nativeElement</span></span><span class="koboSpan" id="kobo.2498.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2499.1">querySelector</span></span><span class="koboSpan" id="kobo.2500.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2501.1">'button'</span></span><span class="koboSpan" id="kobo.2502.1">);
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2503.1">const</span></span><span class="koboSpan" id="kobo.2504.1"> spy = </span><span class="hljs-title"><span class="koboSpan" id="kobo.2505.1">spyOn</span></span><span class="koboSpan" id="kobo.2506.1">(</span><span class="hljs-variable"><span class="koboSpan" id="kobo.2507.1">console</span></span><span class="koboSpan" id="kobo.2508.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.2509.1">'log'</span></span><span class="koboSpan" id="kobo.2510.1">);
  component.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2511.1">searchForm</span></span><span class="koboSpan" id="kobo.2512.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2513.1">controls</span></span><span class="koboSpan" id="kobo.2514.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2515.1">searchText</span></span><span class="koboSpan" id="kobo.2516.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2517.1">setValue</span></span><span class="koboSpan" id="kobo.2518.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2519.1">'Angular'</span></span><span class="koboSpan" id="kobo.2520.1">);
  fixture.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2521.1">detectChanges</span></span><span class="koboSpan" id="kobo.2522.1">();
  button.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2523.1">click</span></span><span class="koboSpan" id="kobo.2524.1">();
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.2525.1">expect</span></span><span class="koboSpan" id="kobo.2526.1">(spy).</span><span class="hljs-title"><span class="koboSpan" id="kobo.2527.1">toHaveBeenCalledWith</span></span><span class="koboSpan" id="kobo.2528.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2529.1">'You searched for: Angular'</span></span><span class="koboSpan" id="kobo.2530.1">);
});
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.2531.1">
     Note that in the second test, we set the value of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2532.1">
      searchText
     </span>
    </code>
    <span class="koboSpan" id="kobo.2533.1">
     form control, and then we call the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2534.1">
      detectChanges
     </span>
    </code>
    <span class="koboSpan" id="kobo.2535.1">
     method for the button to be enabled.
    </span>
    <span class="koboSpan" id="kobo.2535.2">
     Clicking on the button triggers the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2536.1">
      submit
     </span>
    </code>
    <span class="koboSpan" id="kobo.2537.1">
     event of the form, and we can finally assert the expectation of our test.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2538.1">
     In cases where a form has many controls, it is not convenient to query them inside our tests.
    </span>
    <span class="koboSpan" id="kobo.2538.2">
     Alternatively, we can create a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2539.1">
      Page
     </span>
    </code>
    <span class="koboSpan" id="kobo.2540.1">
     object that takes care of querying HTML elements and spying on services:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2541.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2542.1">Page</span></span><span class="koboSpan" id="kobo.2543.1"> {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2544.1">get</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2545.1">searchText</span></span><span class="koboSpan" id="kobo.2546.1">() { </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2547.1">return</span></span> <span class="hljs-variable"><span class="koboSpan" id="kobo.2548.1">this</span></span><span class="koboSpan" id="kobo.2549.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2550.1">query</span></span><span class="koboSpan" id="kobo.2551.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.2552.1">HTMLInputElement</span></span><span class="koboSpan" id="kobo.2553.1">&gt;(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2554.1">'input'</span></span><span class="koboSpan" id="kobo.2555.1">); }
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2556.1">get</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2557.1">submitButton</span></span><span class="koboSpan" id="kobo.2558.1">() { </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2559.1">return</span></span> <span class="hljs-variable"><span class="koboSpan" id="kobo.2560.1">this</span></span><span class="koboSpan" id="kobo.2561.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2562.1">query</span></span><span class="koboSpan" id="kobo.2563.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.2564.1">HTMLButtonElement</span></span><span class="koboSpan" id="kobo.2565.1">&gt;(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2566.1">'button'</span></span><span class="koboSpan" id="kobo.2567.1">); }
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2568.1">private</span></span><span class="koboSpan" id="kobo.2569.1"> query&lt;T&gt;(</span><span class="hljs-attr"><span class="koboSpan" id="kobo.2570.1">selector</span></span><span class="koboSpan" id="kobo.2571.1">: </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2572.1">string</span></span><span class="koboSpan" id="kobo.2573.1">): T {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2574.1">return</span></span><span class="koboSpan" id="kobo.2575.1"> fixture.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2576.1">nativeElement</span></span><span class="koboSpan" id="kobo.2577.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2578.1">querySelector</span></span><span class="koboSpan" id="kobo.2579.1">(selector);
  }
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.2580.1">
     We can then create an instance of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2581.1">
      Page
     </span>
    </code>
    <span class="koboSpan" id="kobo.2582.1">
     object in the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2583.1">
      beforeEach
     </span>
    </code>
    <span class="koboSpan" id="kobo.2584.1">
     statement and access its properties and
    </span>
    <a id="_idIndexMarker851">
    </a>
    <span class="koboSpan" id="kobo.2585.1">
     methods in our tests.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2586.1">
     As we have seen, reactive forms are very easy to test since the form model is the single source of truth.
    </span>
    <span class="koboSpan" id="kobo.2586.2">
     In the following section, we will learn how to test parts of an Angular application that use the router.
    </span>
   </p>
   <h1 class="heading-1" id="_idParaDest-252">
    <span class="koboSpan" id="kobo.2587.1">
     Testing the router
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.2588.1">
     Testing code interacting with the Angular
    </span>
    <a id="_idIndexMarker852">
    </a>
    <span class="koboSpan" id="kobo.2589.1">
     router could easily be a separate chapter.
    </span>
    <span class="koboSpan" id="kobo.2589.2">
     In this section, we will focus on the following router concepts:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.2590.1">
      Routed and routing components
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.2591.1">
      Guards
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.2592.1">
      Resolvers
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.2593.1">
     Let’s see first how to test routed and routing components.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-253">
    <span class="koboSpan" id="kobo.2594.1">
     Routed and routing components
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.2595.1">
     A routed component
    </span>
    <a id="_idIndexMarker853">
    </a>
    <span class="koboSpan" id="kobo.2596.1">
     is a component that is activated when we navigate to a specific application route.
    </span>
    <span class="koboSpan" id="kobo.2596.2">
     Consider the following
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2597.1">
      app.routes.ts
     </span>
    </code>
    <span class="koboSpan" id="kobo.2598.1">
     file:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2599.1">import</span></span><span class="koboSpan" id="kobo.2600.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.2601.1">Routes</span></span><span class="koboSpan" id="kobo.2602.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2603.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2604.1">'@angular/router'</span></span><span class="koboSpan" id="kobo.2605.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2606.1">import</span></span><span class="koboSpan" id="kobo.2607.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.2608.1">RoutedComponent</span></span><span class="koboSpan" id="kobo.2609.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2610.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2611.1">'./routed/routed.component'</span></span><span class="koboSpan" id="kobo.2612.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2613.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2614.1">const</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.2615.1">routes</span></span><span class="koboSpan" id="kobo.2616.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.2617.1">Routes</span></span><span class="koboSpan" id="kobo.2618.1"> = [
  { </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2619.1">path</span></span><span class="koboSpan" id="kobo.2620.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.2621.1">'routed'</span></span><span class="koboSpan" id="kobo.2622.1">, </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2623.1">component</span></span><span class="koboSpan" id="kobo.2624.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.2625.1">RoutedComponent</span></span><span class="koboSpan" id="kobo.2626.1"> }
];
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.2627.1">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2628.1">
      RoutedComponent
     </span>
    </code>
    <span class="koboSpan" id="kobo.2629.1">
     class is defined in the following
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2630.1">
      routed.component.ts
     </span>
    </code>
    <span class="koboSpan" id="kobo.2631.1">
     file:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2632.1">import</span></span><span class="koboSpan" id="kobo.2633.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.2634.1">Component</span></span><span class="koboSpan" id="kobo.2635.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2636.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2637.1">'@angular/core'</span></span><span class="koboSpan" id="kobo.2638.1">;
</span><span class="hljs-meta"><span class="koboSpan" id="kobo.2639.1">@Component</span></span><span class="koboSpan" id="kobo.2640.1">({
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2641.1">selector</span></span><span class="koboSpan" id="kobo.2642.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.2643.1">'app-routed'</span></span><span class="koboSpan" id="kobo.2644.1">,
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2645.1">template</span></span><span class="koboSpan" id="kobo.2646.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.2647.1">'&lt;span&gt;{{ title }}&lt;/span&gt;'</span></span><span class="koboSpan" id="kobo.2648.1">
})
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2649.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2650.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2651.1">RoutedComponent</span></span><span class="koboSpan" id="kobo.2652.1"> {
  title = </span><span class="hljs-string"><span class="koboSpan" id="kobo.2653.1">'My routed component'</span></span><span class="koboSpan" id="kobo.2654.1">;
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.2655.1">
     The preceding component binds the value of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2656.1">
      title
     </span>
    </code>
    <span class="koboSpan" id="kobo.2657.1">
     component property to a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2658.1">
      &lt;span&gt;
     </span>
    </code>
    <span class="koboSpan" id="kobo.2659.1">
     HTML element.
    </span>
    <span class="koboSpan" id="kobo.2659.2">
     The test we will write will assert if the binding works correctly.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2660.1">
     Angular router testing is based on the component harness approach we learned about in the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.2661.1">
      Testing components
     </span>
    </em>
    <span class="koboSpan" id="kobo.2662.1">
     section.
    </span>
    <span class="koboSpan" id="kobo.2662.2">
     It exposes the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2663.1">
      RouterTestingHarness
     </span>
    </code>
    <span class="koboSpan" id="kobo.2664.1">
     class, which contains various utility methods for working with routed components in tests:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2665.1">import</span></span><span class="koboSpan" id="kobo.2666.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.2667.1">RouterTestingHarness</span></span><span class="koboSpan" id="kobo.2668.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2669.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2670.1">'@angular/router/testing'</span></span><span class="koboSpan" id="kobo.2671.1">;
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.2672.1">
     Before we can
    </span>
    <a id="_idIndexMarker854">
    </a>
    <span class="koboSpan" id="kobo.2673.1">
     start testing a routed component, we must register the application routing configuration in the testing module:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.2674.1">beforeEach</span></span><span class="koboSpan" id="kobo.2675.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.2676.1">async</span></span><span class="koboSpan" id="kobo.2677.1"> () =&gt; {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2678.1">await</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2679.1">TestBed</span></span><span class="koboSpan" id="kobo.2680.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2681.1">configureTestingModule</span></span><span class="koboSpan" id="kobo.2682.1">({
    </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2683.1">providers: [provideRouter(routes)]</span></strong></span><span class="koboSpan" id="kobo.2684.1">
  })
  .</span><span class="hljs-title"><span class="koboSpan" id="kobo.2685.1">compileComponents</span></span><span class="koboSpan" id="kobo.2686.1">();
  
  fixture = </span><span class="hljs-title"><span class="koboSpan" id="kobo.2687.1">TestBed</span></span><span class="koboSpan" id="kobo.2688.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2689.1">createComponent</span></span><span class="koboSpan" id="kobo.2690.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.2691.1">RoutedComponent</span></span><span class="koboSpan" id="kobo.2692.1">);
  component = fixture.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2693.1">componentInstance</span></span><span class="koboSpan" id="kobo.2694.1">;
  fixture.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2695.1">detectChanges</span></span><span class="koboSpan" id="kobo.2696.1">();
});
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.2697.1">
     In the preceding setup process, we provide the application routing configuration as in the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2698.1">
      app.config.ts
     </span>
    </code>
    <span class="koboSpan" id="kobo.2699.1">
     file.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2700.1">
     We have already learned that we can query the DOM of the native HTML element from the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2701.1">
      ComponentFixture
     </span>
    </code>
    <span class="koboSpan" id="kobo.2702.1">
     class.
    </span>
    <span class="koboSpan" id="kobo.2702.2">
     When a component is loaded using the router, we use the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2703.1">
      routeNativeElement
     </span>
    </code>
    <span class="koboSpan" id="kobo.2704.1">
     property instead from the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2705.1">
      RouterTestingHarness
     </span>
    </code>
    <span class="koboSpan" id="kobo.2706.1">
     class:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.2707.1">it</span></span><span class="koboSpan" id="kobo.2708.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2709.1">'should display a span element'</span></span><span class="koboSpan" id="kobo.2710.1">, </span><span class="hljs-title"><span class="koboSpan" id="kobo.2711.1">async</span></span><span class="koboSpan" id="kobo.2712.1"> () =&gt; {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2713.1">const</span></span><span class="koboSpan" id="kobo.2714.1"> harness = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2715.1">await</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2716.1">RouterTestingHarness</span></span><span class="koboSpan" id="kobo.2717.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2718.1">create</span></span><span class="koboSpan" id="kobo.2719.1">();
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2720.1">await</span></span><span class="koboSpan" id="kobo.2721.1"> harness.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2722.1">navigateByUrl</span></span><span class="koboSpan" id="kobo.2723.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2724.1">'/routed'</span></span><span class="koboSpan" id="kobo.2725.1">);
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.2726.1">expect</span></span><span class="koboSpan" id="kobo.2727.1">(harness.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2728.1">routeNativeElement</span></span><span class="koboSpan" id="kobo.2729.1">?.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2730.1">querySelector</span></span><span class="koboSpan" id="kobo.2731.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2732.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2733.1">span'</span></span><span class="koboSpan" id="kobo.2734.1">)?.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2735.1">textContent</span></span><span class="koboSpan" id="kobo.2736.1">).</span><span class="hljs-title"><span class="koboSpan" id="kobo.2737.1">toBe</span></span><span class="koboSpan" id="kobo.2738.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2739.1">'My routed component'</span></span><span class="koboSpan" id="kobo.2740.1">);
});
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.2741.1">
     The preceding test is separated into the following steps:
    </span>
   </p>
   <ol>
    <li class="numberedList" value="1">
     <span class="koboSpan" id="kobo.2742.1">
      We use the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.2743.1">
       create
      </span>
     </code>
     <span class="koboSpan" id="kobo.2744.1">
      method of the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.2745.1">
       RouterTestingHarness
      </span>
     </code>
     <span class="koboSpan" id="kobo.2746.1">
      to create a new routing harness for our component.
     </span>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.2747.1">
      We navigate to the registered route path using the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.2748.1">
       navigateByUrl
      </span>
     </code>
     <span class="koboSpan" id="kobo.2749.1">
      method.
     </span>
     <span class="koboSpan" id="kobo.2749.2">
      According to the application routing configuration, the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.2750.1">
       /routed
      </span>
     </code>
     <span class="koboSpan" id="kobo.2751.1">
      URL will activate the component under test.
     </span>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.2752.1">
      We use standard query methods of the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.2753.1">
       routeNativeElement
      </span>
     </code>
     <span class="koboSpan" id="kobo.2754.1">
      property to verify that the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.2755.1">
       &lt;span&gt;
      </span>
     </code>
     <span class="koboSpan" id="kobo.2756.1">
      HTML element displays the correct text.
     </span>
    </li>
   </ol>
   <div class="note">
    <p class="normal">
     <span class="koboSpan" id="kobo.2757.1">
      The
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.2758.1">
       RouterTestingHarness
      </span>
     </code>
     <span class="koboSpan" id="kobo.2759.1">
      class also contains the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.2760.1">
       routeDebugElement
      </span>
     </code>
     <span class="koboSpan" id="kobo.2761.1">
      property, which works cross-platform similarly to the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.2762.1">
       debugElement
      </span>
     </code>
     <span class="koboSpan" id="kobo.2763.1">
      property of the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.2764.1">
       ComponentFixture
      </span>
     </code>
     <span class="koboSpan" id="kobo.2765.1">
      class.
     </span>
    </p>
   </div>
   <p class="normal">
    <span class="koboSpan" id="kobo.2766.1">
     A routing component
    </span>
    <a id="_idIndexMarker855">
    </a>
    <span class="koboSpan" id="kobo.2767.1">
     is a component that is used to navigate to another component in an Angular application.
    </span>
    <span class="koboSpan" id="kobo.2767.2">
     It usually involves calling the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2768.1">
      navigate
     </span>
    </code>
    <span class="koboSpan" id="kobo.2769.1">
     method of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2770.1">
      Router
     </span>
    </code>
    <span class="koboSpan" id="kobo.2771.1">
     service as follows:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2772.1">import</span></span><span class="koboSpan" id="kobo.2773.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.2774.1">Component</span></span><span class="koboSpan" id="kobo.2775.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2776.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2777.1">'@angular/core'</span></span><span class="koboSpan" id="kobo.2778.1">;
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2779.1">import { Router } from '@angular/router';</span></strong></span>
<span class="hljs-meta"><span class="koboSpan" id="kobo.2780.1">@Component</span></span><span class="koboSpan" id="kobo.2781.1">({
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2782.1">selector</span></span><span class="koboSpan" id="kobo.2783.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.2784.1">'app-routed'</span></span><span class="koboSpan" id="kobo.2785.1">,
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2786.1">template</span></span><span class="koboSpan" id="kobo.2787.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.2788.1">'&lt;span&gt;{{ title }}&lt;/span&gt;'</span></span><span class="koboSpan" id="kobo.2789.1">
})
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2790.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2791.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2792.1">RoutedComponent</span></span><span class="koboSpan" id="kobo.2793.1"> {
  title = </span><span class="hljs-string"><span class="koboSpan" id="kobo.2794.1">'My routed component'</span></span><span class="koboSpan" id="kobo.2795.1">;
  </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2796.1">constructor(private router: Router) {}</span></strong></span>
  <span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2797.1">goBack() {</span></strong></span>
    <span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2798.1">this.router.navigate(['/']);</span></strong></span>
  <span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2799.1">}</span></strong></span><span class="koboSpan" id="kobo.2800.1">
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.2801.1">
     According to the preceding snippet, our test should verify that the router will navigate to the root path when we call the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2802.1">
      goBack
     </span>
    </code>
    <span class="koboSpan" id="kobo.2803.1">
     method:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.2804.1">it</span></span><span class="koboSpan" id="kobo.2805.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2806.1">'should navigate to the root path'</span></span><span class="koboSpan" id="kobo.2807.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.2808.1">() =&gt;</span></span><span class="koboSpan" id="kobo.2809.1"> {
  component.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2810.1">goBack</span></span><span class="koboSpan" id="kobo.2811.1">();
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.2812.1">expect</span></span><span class="koboSpan" id="kobo.2813.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.2814.1">TestBed</span></span><span class="koboSpan" id="kobo.2815.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2816.1">inject</span></span><span class="koboSpan" id="kobo.2817.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.2818.1">Router</span></span><span class="koboSpan" id="kobo.2819.1">).</span><span class="hljs-property"><span class="koboSpan" id="kobo.2820.1">url</span></span><span class="koboSpan" id="kobo.2821.1">).</span><span class="hljs-title"><span class="koboSpan" id="kobo.2822.1">toBe</span></span><span class="koboSpan" id="kobo.2823.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2824.1">'/'</span></span><span class="koboSpan" id="kobo.2825.1">);
});
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.2826.1">
     In the preceding
    </span>
    <a id="_idIndexMarker856">
    </a>
    <span class="koboSpan" id="kobo.2827.1">
     test, we use the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2828.1">
      inject
     </span>
    </code>
    <span class="koboSpan" id="kobo.2829.1">
     method of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2830.1">
      TestBed
     </span>
    </code>
    <span class="koboSpan" id="kobo.2831.1">
     class to get a reference to the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2832.1">
      Router
     </span>
    </code>
    <span class="koboSpan" id="kobo.2833.1">
     service.
    </span>
    <span class="koboSpan" id="kobo.2833.2">
     We then access the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2834.1">
      url
     </span>
    </code>
    <span class="koboSpan" id="kobo.2835.1">
     property to verify that the navigation process was completed correctly.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2836.1">
     In the following section, we will learn how to test router guards.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-254">
    <span class="koboSpan" id="kobo.2837.1">
     Guards
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.2838.1">
     We learned in
    </span>
    <em class="chapterRef">
     <span class="koboSpan" id="kobo.2839.1">
      Chapter 9
     </span>
    </em>
    <span class="koboSpan" id="kobo.2840.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.2841.1">
      Navigating through Applications with Routing
     </span>
    </em>
    <span class="koboSpan" id="kobo.2842.1">
     , that router guards
    </span>
    <a id="_idIndexMarker857">
    </a>
    <span class="koboSpan" id="kobo.2843.1">
     are plain functions.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2844.1">
     Consider the following guard that checks the authentication status of a user:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2845.1">import</span></span><span class="koboSpan" id="kobo.2846.1"> { inject } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2847.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2848.1">'@angular/core'</span></span><span class="koboSpan" id="kobo.2849.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2850.1">import</span></span><span class="koboSpan" id="kobo.2851.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.2852.1">CanActivateFn</span></span><span class="koboSpan" id="kobo.2853.1">, </span><span class="hljs-title"><span class="koboSpan" id="kobo.2854.1">Router</span></span><span class="koboSpan" id="kobo.2855.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2856.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2857.1">'@angular/router'</span></span><span class="koboSpan" id="kobo.2858.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2859.1">import</span></span><span class="koboSpan" id="kobo.2860.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.2861.1">AuthService</span></span><span class="koboSpan" id="kobo.2862.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2863.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2864.1">'./auth.service'</span></span><span class="koboSpan" id="kobo.2865.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2866.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2867.1">const</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.2868.1">authGuard</span></span><span class="koboSpan" id="kobo.2869.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.2870.1">CanActivateFn</span></span><span class="koboSpan" id="kobo.2871.1"> = </span><span class="hljs-function"><span class="koboSpan" id="kobo.2872.1">() =&gt;</span></span><span class="koboSpan" id="kobo.2873.1"> {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2874.1">const</span></span><span class="koboSpan" id="kobo.2875.1"> authService = </span><span class="hljs-title"><span class="koboSpan" id="kobo.2876.1">inject</span></span><span class="koboSpan" id="kobo.2877.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.2878.1">AuthService</span></span><span class="koboSpan" id="kobo.2879.1">);
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2880.1">const</span></span><span class="koboSpan" id="kobo.2881.1"> router = </span><span class="hljs-title"><span class="koboSpan" id="kobo.2882.1">inject</span></span><span class="koboSpan" id="kobo.2883.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.2884.1">Router</span></span><span class="koboSpan" id="kobo.2885.1">);
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2886.1">if</span></span><span class="koboSpan" id="kobo.2887.1"> (authService.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2888.1">isLoggedIn</span></span><span class="koboSpan" id="kobo.2889.1">) {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2890.1">return</span></span> <span class="hljs-literal"><span class="koboSpan" id="kobo.2891.1">true</span></span><span class="koboSpan" id="kobo.2892.1">;
  }
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2893.1">return</span></span><span class="koboSpan" id="kobo.2894.1"> router.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2895.1">parseUrl</span></span><span class="koboSpan" id="kobo.2896.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2897.1">'/'</span></span><span class="koboSpan" id="kobo.2898.1">);
};
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.2899.1">
     In the preceding guard, we check the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2900.1">
      isLoggedIn
     </span>
    </code>
    <span class="koboSpan" id="kobo.2901.1">
     property of the following
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2902.1">
      AuthService
     </span>
    </code>
    <span class="koboSpan" id="kobo.2903.1">
     class:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2904.1">import</span></span><span class="koboSpan" id="kobo.2905.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.2906.1">Injectable</span></span><span class="koboSpan" id="kobo.2907.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2908.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2909.1">'@angular/core'</span></span><span class="koboSpan" id="kobo.2910.1">;
</span><span class="hljs-meta"><span class="koboSpan" id="kobo.2911.1">@Injectable</span></span><span class="koboSpan" id="kobo.2912.1">({
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2913.1">providedIn</span></span><span class="koboSpan" id="kobo.2914.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.2915.1">'root'</span></span><span class="koboSpan" id="kobo.2916.1">
})
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2917.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2918.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2919.1">AuthService</span></span><span class="koboSpan" id="kobo.2920.1"> {
  isLoggedIn = </span><span class="hljs-literal"><span class="koboSpan" id="kobo.2921.1">false</span></span><span class="koboSpan" id="kobo.2922.1">;
}
</span></code></pre>
   <div class="note">
    <p class="normal">
     <span class="koboSpan" id="kobo.2923.1">
      We decided to keep the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.2924.1">
       AuthService
      </span>
     </code>
     <span class="koboSpan" id="kobo.2925.1">
      class simple and focus on the logic of the authentication guard.
     </span>
    </p>
   </div>
   <p class="normal">
    <span class="koboSpan" id="kobo.2926.1">
     If the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2927.1">
      isLoggedIn
     </span>
    </code>
    <span class="koboSpan" id="kobo.2928.1">
     property
    </span>
    <a id="_idIndexMarker858">
    </a>
    <span class="koboSpan" id="kobo.2929.1">
     is
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2930.1">
      true
     </span>
    </code>
    <span class="koboSpan" id="kobo.2931.1">
     , the guard also returns
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2932.1">
      true
     </span>
    </code>
    <span class="koboSpan" id="kobo.2933.1">
     .
    </span>
    <span class="koboSpan" id="kobo.2933.2">
     Otherwise, it executes the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2934.1">
      parseUrl
     </span>
    </code>
    <span class="koboSpan" id="kobo.2935.1">
     method of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2936.1">
      Router
     </span>
    </code>
    <span class="koboSpan" id="kobo.2937.1">
     service to redirect users to the root path.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2938.1">
     The Angular CLI has created the following unit test for the guard:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2939.1">import</span></span><span class="koboSpan" id="kobo.2940.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.2941.1">TestBed</span></span><span class="koboSpan" id="kobo.2942.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2943.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2944.1">'@angular/core/testing'</span></span><span class="koboSpan" id="kobo.2945.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2946.1">import</span></span><span class="koboSpan" id="kobo.2947.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.2948.1">CanActivateFn</span></span><span class="koboSpan" id="kobo.2949.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2950.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2951.1">'@angular/router'</span></span><span class="koboSpan" id="kobo.2952.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2953.1">import</span></span><span class="koboSpan" id="kobo.2954.1"> { authGuard } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2955.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2956.1">'./auth.guard'</span></span><span class="koboSpan" id="kobo.2957.1">;
</span><span class="hljs-title"><span class="koboSpan" id="kobo.2958.1">describe</span></span><span class="koboSpan" id="kobo.2959.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2960.1">'authGuard'</span></span><span class="koboSpan" id="kobo.2961.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.2962.1">() =&gt;</span></span><span class="koboSpan" id="kobo.2963.1"> {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2964.1">const</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.2965.1">executeGuard</span></span><span class="koboSpan" id="kobo.2966.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.2967.1">CanActivateFn</span></span><span class="koboSpan" id="kobo.2968.1"> = </span><span class="hljs-function"><span class="koboSpan" id="kobo.2969.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2970.1">...guardParameters</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2971.1">) =&gt;</span></span> 
      <span class="hljs-title"><span class="koboSpan" id="kobo.2972.1">TestBed</span></span><span class="koboSpan" id="kobo.2973.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2974.1">runInInjectionContext</span></span><span class="koboSpan" id="kobo.2975.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.2976.1">() =&gt;</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2977.1">authGuard</span></span><span class="koboSpan" id="kobo.2978.1">(...guardParameters));
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.2979.1">beforeEach</span></span><span class="koboSpan" id="kobo.2980.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.2981.1">() =&gt;</span></span><span class="koboSpan" id="kobo.2982.1"> {
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.2983.1">TestBed</span></span><span class="koboSpan" id="kobo.2984.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2985.1">configureTestingModule</span></span><span class="koboSpan" id="kobo.2986.1">({});
  });
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.2987.1">it</span></span><span class="koboSpan" id="kobo.2988.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2989.1">'should be created'</span></span><span class="koboSpan" id="kobo.2990.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.2991.1">() =&gt;</span></span><span class="koboSpan" id="kobo.2992.1"> {
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.2993.1">expect</span></span><span class="koboSpan" id="kobo.2994.1">(executeGuard).</span><span class="hljs-title"><span class="koboSpan" id="kobo.2995.1">toBeTruthy</span></span><span class="koboSpan" id="kobo.2996.1">();
  });
});
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.2997.1">
     In the preceding snippet, the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2998.1">
      executeGuard
     </span>
    </code>
    <span class="koboSpan" id="kobo.2999.1">
     variable encapsulates the creation of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.3000.1">
      authGuard
     </span>
    </code>
    <span class="koboSpan" id="kobo.3001.1">
     function.
    </span>
    <span class="koboSpan" id="kobo.3001.2">
     It uses the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.3002.1">
      runInInjectionContext
     </span>
    </code>
    <span class="koboSpan" id="kobo.3003.1">
     method of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.3004.1">
      TestBed
     </span>
    </code>
    <span class="koboSpan" id="kobo.3005.1">
     class to allow the injection of required services using the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.3006.1">
      inject
     </span>
    </code>
    <span class="koboSpan" id="kobo.3007.1">
     method.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.3008.1">
     To create unit tests that validate the usage of the authentication guard, we must execute the following steps:
    </span>
   </p>
   <ol>
    <li class="numberedList" value="1">
     <span class="koboSpan" id="kobo.3009.1">
      Modify the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.3010.1">
       import
      </span>
     </code>
     <span class="koboSpan" id="kobo.3011.1">
      statement of the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.3012.1">
       @angular/router
      </span>
     </code>
     <span class="koboSpan" id="kobo.3013.1">
      npm package as follows:
     </span>
     <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.3014.1">import</span></span><span class="koboSpan" id="kobo.3015.1"> {
  </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3016.1">ActivatedRouteSnapshot</span></strong></span><span class="koboSpan" id="kobo.3017.1">,
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.3018.1">CanActivateFn</span></span><span class="koboSpan" id="kobo.3019.1">,
  </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3020.1">Router,</span></strong></span>
  <span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3021.1">RouterStateSnapshot</span></strong></span><span class="koboSpan" id="kobo.3022.1">
} </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3023.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.3024.1">'@angular/router'</span></span><span class="koboSpan" id="kobo.3025.1">;
</span></code></pre>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.3026.1">
      Add the following
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.3027.1">
       import
      </span>
     </code>
     <span class="koboSpan" id="kobo.3028.1">
      statement:
     </span>
     <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.3029.1">import</span></span><span class="koboSpan" id="kobo.3030.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.3031.1">AuthService</span></span><span class="koboSpan" id="kobo.3032.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3033.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.3034.1">'./auth.service'</span></span><span class="koboSpan" id="kobo.3035.1">;
</span></code></pre>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.3036.1">
      Create the following variables that correspond to the injected services:
     </span>
     <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.3037.1">let</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.3038.1">authService</span></span><span class="koboSpan" id="kobo.3039.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.3040.1">AuthService</span></span><span class="koboSpan" id="kobo.3041.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3042.1">let</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.3043.1">routerSpy</span></span><span class="koboSpan" id="kobo.3044.1">: jasmine.</span><span class="hljs-property"><span class="koboSpan" id="kobo.3045.1">SpyObj</span></span><span class="koboSpan" id="kobo.3046.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.3047.1">Router</span></span><span class="koboSpan" id="kobo.3048.1">&gt;;
</span></code></pre>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.3049.1">
      Initialize the
     </span>
     <a id="_idIndexMarker859">
     </a>
     <span class="koboSpan" id="kobo.3050.1">
      preceding variables in the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.3051.1">
       beforeEach
      </span>
     </code>
     <span class="koboSpan" id="kobo.3052.1">
      statement of the test suite:
     </span>
     <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.3053.1">beforeEach</span></span><span class="koboSpan" id="kobo.3054.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.3055.1">() =&gt;</span></span><span class="koboSpan" id="kobo.3056.1"> {
  </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3057.1">routerSpy = jasmine.createSpyObj('Router', ['parseUrl']);</span></strong></span>
  <span class="hljs-title"><span class="koboSpan" id="kobo.3058.1">TestBed</span></span><span class="koboSpan" id="kobo.3059.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.3060.1">configureTestingModule</span></span><span class="koboSpan" id="kobo.3061.1">({
    </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3062.1">providers: [</span></strong></span>
      <span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3063.1">{ provide: Router, useValue: routerSpy }</span></strong></span>
    <span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3064.1">]</span></strong></span><span class="koboSpan" id="kobo.3065.1">
  });
  </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3066.1">authService = TestBed.inject(AuthService);</span></strong></span><span class="koboSpan" id="kobo.3067.1">
});
</span></code></pre>
    </li>
   </ol>
   <p class="normal-one">
    <span class="koboSpan" id="kobo.3068.1">
     In the preceding snippet, we use the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.3069.1">
      createSpyObj
     </span>
    </code>
    <span class="koboSpan" id="kobo.3070.1">
     method to create a spy object for the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.3071.1">
      Router
     </span>
    </code>
    <span class="koboSpan" id="kobo.3072.1">
     service and provide it to the testing module.
    </span>
    <span class="koboSpan" id="kobo.3072.2">
     Additionally, we get the instance of the actual
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.3073.1">
      AuthService
     </span>
    </code>
    <span class="koboSpan" id="kobo.3074.1">
     class using the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.3075.1">
      inject
     </span>
    </code>
    <span class="koboSpan" id="kobo.3076.1">
     method of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.3077.1">
      TestBed
     </span>
    </code>
    <span class="koboSpan" id="kobo.3078.1">
     class because it is a simple service with no dependencies.
    </span>
   </p>
   <ol>
    <li class="numberedList" value="5">
     <span class="koboSpan" id="kobo.3079.1">
      The first unit test should assert that the guard execution returns
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.3080.1">
       true
      </span>
     </code>
     <span class="koboSpan" id="kobo.3081.1">
      when the user is authenticated:
     </span>
     <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.3082.1">it</span></span><span class="koboSpan" id="kobo.3083.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.3084.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.3085.1">should return true'</span></span><span class="koboSpan" id="kobo.3086.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.3087.1">() =&gt;</span></span><span class="koboSpan" id="kobo.3088.1"> {
  authService.</span><span class="hljs-property"><span class="koboSpan" id="kobo.3089.1">isLoggedIn</span></span><span class="koboSpan" id="kobo.3090.1"> = </span><span class="hljs-literal"><span class="koboSpan" id="kobo.3091.1">true</span></span><span class="koboSpan" id="kobo.3092.1">;
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.3093.1">expect</span></span><span class="koboSpan" id="kobo.3094.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.3095.1">executeGuard</span></span><span class="koboSpan" id="kobo.3096.1">({} </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3097.1">as</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.3098.1">ActivatedRouteSnapshot</span></span><span class="koboSpan" id="kobo.3099.1">, {} </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3100.1">as</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.3101.1">RouterStateSnapshot</span></span><span class="koboSpan" id="kobo.3102.1">)).</span><span class="hljs-title"><span class="koboSpan" id="kobo.3103.1">toBeTrue</span></span><span class="koboSpan" id="kobo.3104.1">();
});
</span></code></pre>
    </li>
   </ol>
   <div class="note-one">
    <p class="normal">
     <span class="koboSpan" id="kobo.3105.1">
      We pass an empty object for the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.3106.1">
       ActivatedRouteSnapshot
      </span>
     </code>
     <span class="koboSpan" id="kobo.3107.1">
      and
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.3108.1">
       RouterStateSnapshot
      </span>
     </code>
     <span class="koboSpan" id="kobo.3109.1">
      parameters because they are unnecessary in the guard.
     </span>
    </p>
   </div>
   <ol>
    <li class="numberedList" value="6">
     <span class="koboSpan" id="kobo.3110.1">
      The second unit test should verify that the guard execution causes a redirection to the root path:
     </span>
     <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.3111.1">it</span></span><span class="koboSpan" id="kobo.3112.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.3113.1">'should redirect'</span></span><span class="koboSpan" id="kobo.3114.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.3115.1">() =&gt;</span></span><span class="koboSpan" id="kobo.3116.1"> {
  authService.</span><span class="hljs-property"><span class="koboSpan" id="kobo.3117.1">isLoggedIn</span></span><span class="koboSpan" id="kobo.3118.1"> = </span><span class="hljs-literal"><span class="koboSpan" id="kobo.3119.1">false</span></span><span class="koboSpan" id="kobo.3120.1">;
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.3121.1">executeGuard</span></span><span class="koboSpan" id="kobo.3122.1">({} </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3123.1">as</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.3124.1">ActivatedRouteSnapshot</span></span><span class="koboSpan" id="kobo.3125.1">, {} </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3126.1">as</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.3127.1">RouterStateSnapshot</span></span><span class="koboSpan" id="kobo.3128.1">);
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.3129.1">expect</span></span><span class="koboSpan" id="kobo.3130.1">(routerSpy.</span><span class="hljs-property"><span class="koboSpan" id="kobo.3131.1">parseUrl</span></span><span class="koboSpan" id="kobo.3132.1">).</span><span class="hljs-title"><span class="koboSpan" id="kobo.3133.1">toHaveBeenCalledWith</span></span><span class="koboSpan" id="kobo.3134.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.3135.1">'/'</span></span><span class="koboSpan" id="kobo.3136.1">);
});
</span></code></pre>
    </li>
   </ol>
   <p class="normal">
    <span class="koboSpan" id="kobo.3137.1">
     In the following section, we will learn how to test guard resolvers.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-255">
    <span class="koboSpan" id="kobo.3138.1">
     Resolvers
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.3139.1">
     Router resolvers
    </span>
    <a id="_idIndexMarker860">
    </a>
    <span class="koboSpan" id="kobo.3140.1">
     are plain functions of a specific type similar to guards.
    </span>
    <span class="koboSpan" id="kobo.3140.2">
     The most common scenario when testing resolvers is to verify that the returned data is correct.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.3141.1">
     Consider the following resolver, which returns a list of items:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.3142.1">import</span></span><span class="koboSpan" id="kobo.3143.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.3144.1">ResolveFn</span></span><span class="koboSpan" id="kobo.3145.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3146.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.3147.1">'@angular/router'</span></span><span class="koboSpan" id="kobo.3148.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3149.1">import</span></span><span class="koboSpan" id="kobo.3150.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.3151.1">AsyncService</span></span><span class="koboSpan" id="kobo.3152.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3153.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.3154.1">'./async.service'</span></span><span class="koboSpan" id="kobo.3155.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3156.1">import</span></span><span class="koboSpan" id="kobo.3157.1"> { inject } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3158.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.3159.1">'@angular/core'</span></span><span class="koboSpan" id="kobo.3160.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3161.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.3162.1">const</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.3163.1">itemsResolver</span></span><span class="koboSpan" id="kobo.3164.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.3165.1">ResolveFn</span></span><span class="koboSpan" id="kobo.3166.1">&lt;</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.3167.1">string</span></span><span class="koboSpan" id="kobo.3168.1">[]&gt; = </span><span class="hljs-function"><span class="koboSpan" id="kobo.3169.1">() =&gt;</span></span><span class="koboSpan" id="kobo.3170.1"> {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3171.1">const</span></span><span class="koboSpan" id="kobo.3172.1"> asyncService = </span><span class="hljs-title"><span class="koboSpan" id="kobo.3173.1">inject</span></span><span class="koboSpan" id="kobo.3174.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.3175.1">AsyncService</span></span><span class="koboSpan" id="kobo.3176.1">);
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3177.1">return</span></span><span class="koboSpan" id="kobo.3178.1"> asyncService.</span><span class="hljs-title"><span class="koboSpan" id="kobo.3179.1">getItems</span></span><span class="koboSpan" id="kobo.3180.1">();
};
</span></code></pre>
   <div class="note">
    <p class="normal">
     <span class="koboSpan" id="kobo.3181.1">
      The resolver uses the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.3182.1">
       AsyncService
      </span>
     </code>
     <span class="koboSpan" id="kobo.3183.1">
      we saw earlier, which returns an observable of items using the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.3184.1">
       getItems
      </span>
     </code>
     <span class="koboSpan" id="kobo.3185.1">
      method.
     </span>
    </p>
   </div>
   <p class="normal">
    <span class="koboSpan" id="kobo.3186.1">
     The Angular CLI will initially create the following unit test file when scaffolding the resolver:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.3187.1">import</span></span><span class="koboSpan" id="kobo.3188.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.3189.1">TestBed</span></span><span class="koboSpan" id="kobo.3190.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3191.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.3192.1">'@angular/core/testing'</span></span><span class="koboSpan" id="kobo.3193.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3194.1">import</span></span><span class="koboSpan" id="kobo.3195.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.3196.1">ResolveFn</span></span><span class="koboSpan" id="kobo.3197.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3198.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.3199.1">'@angular/router'</span></span><span class="koboSpan" id="kobo.3200.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3201.1">import</span></span><span class="koboSpan" id="kobo.3202.1"> { itemsResolver } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3203.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.3204.1">'./items.resolver'</span></span><span class="koboSpan" id="kobo.3205.1">;
</span><span class="hljs-title"><span class="koboSpan" id="kobo.3206.1">describe</span></span><span class="koboSpan" id="kobo.3207.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.3208.1">'itemsResolver'</span></span><span class="koboSpan" id="kobo.3209.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.3210.1">() =&gt;</span></span><span class="koboSpan" id="kobo.3211.1"> {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3212.1">const</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.3213.1">executeResolver</span></span><span class="koboSpan" id="kobo.3214.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.3215.1">ResolveFn</span></span><span class="koboSpan" id="kobo.3216.1">&lt;</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.3217.1">boolean</span></span><span class="koboSpan" id="kobo.3218.1">&gt; = </span><span class="hljs-function"><span class="koboSpan" id="kobo.3219.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.3220.1">...resolverParameters</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.3221.1">) =&gt;</span></span> 
      <span class="hljs-title"><span class="koboSpan" id="kobo.3222.1">TestBed</span></span><span class="koboSpan" id="kobo.3223.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.3224.1">runInInjectionContext</span></span><span class="koboSpan" id="kobo.3225.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.3226.1">() =&gt;</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.3227.1">itemsResolver</span></span><span class="koboSpan" id="kobo.3228.1">(...resolverParameters));
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.3229.1">beforeEach</span></span><span class="koboSpan" id="kobo.3230.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.3231.1">() =&gt;</span></span><span class="koboSpan" id="kobo.3232.1"> {
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.3233.1">TestBed</span></span><span class="koboSpan" id="kobo.3234.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.3235.1">configureTestingModule</span></span><span class="koboSpan" id="kobo.3236.1">({});
  });
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.3237.1">it</span></span><span class="koboSpan" id="kobo.3238.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.3239.1">'should be created'</span></span><span class="koboSpan" id="kobo.3240.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.3241.1">() =&gt;</span></span><span class="koboSpan" id="kobo.3242.1"> {
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.3243.1">expect</span></span><span class="koboSpan" id="kobo.3244.1">(executeResolver).</span><span class="hljs-title"><span class="koboSpan" id="kobo.3245.1">toBeTruthy</span></span><span class="koboSpan" id="kobo.3246.1">();
  });
});
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.3247.1">
     In the preceding snippet, the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.3248.1">
      executeResolver
     </span>
    </code>
    <span class="koboSpan" id="kobo.3249.1">
     variable encapsulates the creation of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.3250.1">
      itemsResolver
     </span>
    </code>
    <span class="koboSpan" id="kobo.3251.1">
     function, similar
    </span>
    <a id="_idIndexMarker861">
    </a>
    <span class="koboSpan" id="kobo.3252.1">
     to how it does with guards.
    </span>
    <span class="koboSpan" id="kobo.3252.2">
     It also uses the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.3253.1">
      runInInjectionContext
     </span>
    </code>
    <span class="koboSpan" id="kobo.3254.1">
     method of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.3255.1">
      TestBed
     </span>
    </code>
    <span class="koboSpan" id="kobo.3256.1">
     class to allow the injection of required services.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.3257.1">
     The logic of our resolver is very simple, so we must write a single unit test:
    </span>
   </p>
   <ol>
    <li class="numberedList" value="1">
     <span class="koboSpan" id="kobo.3258.1">
      Modify the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.3259.1">
       import
      </span>
     </code>
     <span class="koboSpan" id="kobo.3260.1">
      statement of the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.3261.1">
       @angular/router
      </span>
     </code>
     <span class="koboSpan" id="kobo.3262.1">
      npm package as follows:
     </span>
     <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.3263.1">import</span></span><span class="koboSpan" id="kobo.3264.1"> {
  </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3265.1">ActivatedRouteSnapshot</span></strong></span><span class="koboSpan" id="kobo.3266.1">,
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.3267.1">ResolveFn</span></span><span class="koboSpan" id="kobo.3268.1">,
  </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3269.1">RouterStateSnapshot</span></strong></span><span class="koboSpan" id="kobo.3270.1">
} </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3271.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.3272.1">'@angular/router'</span></span><span class="koboSpan" id="kobo.3273.1">;
</span></code></pre>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.3274.1">
      Add the following
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.3275.1">
       import
      </span>
     </code>
     <span class="koboSpan" id="kobo.3276.1">
      statement:
     </span>
     <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.3277.1">import</span></span><span class="koboSpan" id="kobo.3278.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.3279.1">Observable</span></span><span class="koboSpan" id="kobo.3280.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3281.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.3282.1">'rxjs'</span></span><span class="koboSpan" id="kobo.3283.1">;
</span></code></pre>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.3284.1">
      Change the type of the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.3285.1">
       executeResolver
      </span>
     </code>
     <span class="koboSpan" id="kobo.3286.1">
      variable to
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.3287.1">
       ResolveFn&lt;string[]&gt;
      </span>
     </code>
     <span class="koboSpan" id="kobo.3288.1">
      so that it matches the signature of the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.3289.1">
       itemsResolver
      </span>
     </code>
     <span class="koboSpan" id="kobo.3290.1">
      function:
     </span>
     <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.3291.1">const</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.3292.1">executeResolver</span></span><span class="koboSpan" id="kobo.3293.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.3294.1">ResolveFn</span></span><span class="koboSpan" id="kobo.3295.1">&lt;</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3296.1">string[]</span></strong></span><span class="koboSpan" id="kobo.3297.1">&gt; = </span><span class="hljs-function"><span class="koboSpan" id="kobo.3298.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.3299.1">...resolverParameters</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.3300.1">) =&gt;</span></span> 
    <span class="hljs-title"><span class="koboSpan" id="kobo.3301.1">TestBed</span></span><span class="koboSpan" id="kobo.3302.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.3303.1">runInInjectionContext</span></span><span class="koboSpan" id="kobo.3304.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.3305.1">() =&gt;</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.3306.1">itemsResolver</span></span><span class="koboSpan" id="kobo.3307.1">(...resolverParameters));
</span></code></pre>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.3308.1">
      Write the following unit test:
     </span>
     <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.3309.1">it</span></span><span class="koboSpan" id="kobo.3310.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.3311.1">'should return items'</span></span><span class="koboSpan" id="kobo.3312.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.3313.1">() =&gt;</span></span><span class="koboSpan" id="kobo.3314.1"> {
  (</span><span class="hljs-title"><span class="koboSpan" id="kobo.3315.1">executeResolver</span></span><span class="koboSpan" id="kobo.3316.1">({} </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3317.1">as</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.3318.1">ActivatedRouteSnapshot</span></span><span class="koboSpan" id="kobo.3319.1">, {} </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3320.1">as</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.3321.1">RouterStateSnapshot</span></span><span class="koboSpan" id="kobo.3322.1">) </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3323.1">as</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.3324.1">Observable</span></span><span class="koboSpan" id="kobo.3325.1">&lt;</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.3326.1">string</span></span><span class="koboSpan" id="kobo.3327.1">[]&gt;).</span><span class="hljs-title"><span class="koboSpan" id="kobo.3328.1">subscribe</span></span><span class="koboSpan" id="kobo.3329.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.3330.1">items</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.3331.1"> =&gt;</span></span><span class="koboSpan" id="kobo.3332.1"> {
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.3333.1">expect</span></span><span class="koboSpan" id="kobo.3334.1">(items).</span><span class="hljs-title"><span class="koboSpan" id="kobo.3335.1">toEqual</span></span><span class="koboSpan" id="kobo.3336.1">([</span><span class="hljs-string"><span class="koboSpan" id="kobo.3337.1">'Microphone'</span></span><span class="koboSpan" id="kobo.3338.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.3339.1">'Keyboard'</span></span><span class="koboSpan" id="kobo.3340.1">]);
  })
});
</span></code></pre>
    </li>
   </ol>
   <p class="normal-one">
    <span class="koboSpan" id="kobo.3341.1">
     To verify
    </span>
    <a id="_idIndexMarker862">
    </a>
    <span class="koboSpan" id="kobo.3342.1">
     that the resolver returns correct data, we must subscribe to the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.3343.1">
      executeResolver
     </span>
    </code>
    <span class="koboSpan" id="kobo.3344.1">
     function.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.3345.1">
     In this section, we learned how to unit test some important features of the Angular router.
    </span>
   </p>
   <h1 class="heading-1" id="_idParaDest-256">
    <span class="koboSpan" id="kobo.3346.1">
     Summary
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.3347.1">
     We are at the end of our testing journey, and it’s been a long but exciting one.
    </span>
    <span class="koboSpan" id="kobo.3347.2">
     In this chapter, we saw the importance of introducing unit testing in our Angular applications, the basic shape of a unit test, and the process of setting up Jasmine for our tests.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.3348.1">
     We also learned how to write robust tests for our components, directives, pipes, and services.
    </span>
    <span class="koboSpan" id="kobo.3348.2">
     We also discussed how to test Angular reactive forms and the router.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.3349.1">
     This unit testing chapter has almost completed the puzzle of building a complete Angular application.
    </span>
    <span class="koboSpan" id="kobo.3349.2">
     Only the last piece remains, which is important because web applications are ultimately destined for the web.
    </span>
    <span class="koboSpan" id="kobo.3349.3">
     Therefore, in the next chapter, we will learn how to produce a production build for an Angular application and deploy it to share with the rest of the world!
    </span>
   </p>
  </div>
 </body></html>