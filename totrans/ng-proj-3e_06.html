<html><head></head><body>
  <div id="_idContainer127" class="Basic-Text-Frame">
    <h1 class="chapterNumber">6</h1>
    <h1 id="_idParaDest-99" class="chapterTitle">Building a Mobile Photo Geotagging Application Using Capacitor and 3D Maps</h1>
    <p class="normal">Angular is a cross-platform JavaScript framework that can be used to build applications for different platforms such as web, desktop, and mobile. Moreover, it allows developers to use the same code base and apply the same web techniques to each platform, enjoying the same experience and performance. In this chapter, we will investigate how we can build mobile applications using Angular.</p>
    <p class="normal"><strong class="keyWord">Ionic</strong> is a <a id="_idIndexMarker301"/>popular UI toolkit that allows us to build mobile applications using web technologies such as Angular. The <strong class="keyWord">Capacitor</strong> library <a id="_idIndexMarker302"/>greatly enhances Ionic applications by enabling them to run natively on Android and iOS devices. In this chapter, we will use both technologies to build a mobile application to take geotagged photos and display them on a 3D map.</p>
    <p class="normal">We will cover the following topics in detail:</p>
    <ul>
      <li class="bulletList">Creating a mobile application with Ionic</li>
      <li class="bulletList">Taking photos with Capacitor</li>
      <li class="bulletList">Storing data in <strong class="keyWord">Firebase</strong></li>
      <li class="bulletList">Previewing photos with <strong class="keyWord">CesiumJS</strong></li>
    </ul>
    <h1 id="_idParaDest-100" class="heading-1">Essential background theory and context</h1>
    <p class="normal">Capacitor is a native mobile runtime that enables us to build Android and iOS applications with web technologies, including Angular. It provides an abstraction API layer for web applications to interact with the native resources of a mobile OS. It does not include a UI layer or any other way of interacting with the user interface.</p>
    <p class="normal">Ionic is a mobile framework containing a collection of UI components we can use in an application built with Capacitor. The main advantage of Ionic is that we maintain a single code base across all native mobile platforms. That is, we write the code once, and it works everywhere. Ionic supports all popular JavaScript frameworks, including Angular.</p>
    <p class="normal">Firebase is a <strong class="keyWord">Backend-as-a-Service (BaaS)</strong> platform<a id="_idIndexMarker303"/> provided by Google that contains tools and services for building applications. <strong class="keyWord">Cloud Firestore</strong> is a database <a id="_idIndexMarker304"/>solution provided by Firebase that features a flexible and scalable NoSQL document-oriented database that can be used in web and mobile applications. <strong class="keyWord">Firebase</strong> <strong class="keyWord">Storage</strong> is a <a id="_idIndexMarker305"/>service that allows us to interact with a storage mechanism and upload or download files.</p>
    <p class="normal">CesiumJS is a <a id="_idIndexMarker306"/>JavaScript library for creating interactive 3D maps in the browser. It is an open-source, cross-platform library that uses WebGL and allows us to share geospatial data on multiple platforms. It is powered by <strong class="keyWord">Cesium</strong>, a platform for building high-quality and performant 3D geospatial applications.</p>
    <h1 id="_idParaDest-101" class="heading-1">Project overview</h1>
    <p class="normal">In this project, we<a id="_idIndexMarker307"/> will build a mobile application that can take photos according to the current location and preview them on a map. Initially, we will learn how to create a mobile application using Angular and Ionic. We will then use Capacitor to take photos using the camera of the mobile device and tag them with the current location via GPS. We will upload those photos to Firebase along with their location data. Finally, we will use CesiumJS to load location data on a 3D globe along with a preview of the photo. The following diagram depicts an architectural overview of the project:</p>
    <figure class="mediaobject"><img src="../Images/B18465_06_01.png" alt="Εικόνα που περιέχει διάγραμμα  Περιγραφή που δημιουργήθηκε αυτόματα"/></figure>
    <p class="packt_figref">Figure 6.1 – Project architecture</p>
    <div class="note">
      <p class="normal">In this chapter, you will learn how to build a mobile application with Angular and Ionic. To follow up with the project and preview your application, you must follow the getting started guide for your development environment (Android or iOS), which you can find in the <em class="italic">Further reading</em> section.</p>
    </div>
    <p class="normal">Build time: 2 hours</p>
    <h1 id="_idParaDest-102" class="heading-1">Getting started</h1>
    <p class="normal">You will need the following<a id="_idIndexMarker308"/> software and tools to complete the project:</p>
    <ul>
      <li class="bulletList">For Android development: <strong class="keyWord">Android Studio</strong> with the latest Android SDK.</li>
      <li class="bulletList">For iOS development: <strong class="keyWord">Xcode</strong> with the iOS SDK and Xcode<strong class="keyWord"> </strong>Command Line Tools.</li>
      <li class="bulletList">A physical mobile device.</li>
      <li class="bulletList">Angular CLI: A command-line interface for Angular that you can find at <a href="https://angular.io/cli"><span class="url">https://angular.io/cli</span></a>.</li>
      <li class="bulletList">GitHub material: The related code for this chapter can be found in the <code class="inlineCode">Chapter06</code> folder at <a href="https://github.com/PacktPublishing/Angular-Projects-Third-Edition"><span class="url">https://github.com/PacktPublishing/Angular-Projects-Third-Edition</span></a>.</li>
    </ul>
    <h1 id="_idParaDest-103" class="heading-1">Creating a mobile application with Ionic</h1>
    <p class="normal">The<a id="_idIndexMarker309"/> first step toward building our application is creating a new mobile application using the Ionic toolkit. We will start building our application with the following tasks:</p>
    <ul>
      <li class="bulletList">Scaffolding the application</li>
      <li class="bulletList">Building the main menu</li>
    </ul>
    <p class="normal">Ionic has a pretty straightforward process for creating a new mobile application from scratch without entering a single line of code.</p>
    <h2 id="_idParaDest-104" class="heading-2">Scaffolding the application</h2>
    <p class="normal">To create a new<a id="_idIndexMarker310"/> Ionic application, complete the following steps:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Install the Ionic tooling that we will need using the following command:
        <pre class="programlisting con"><code class="hljs-con">npm install -g @ionic/cli native-run cordova-res
</code></pre>
    <p class="normal">The <strong class="keyWord">Ionic CLI</strong> is used to build and run an Ionic mobile application. The <code class="inlineCode">native-run</code> library is used to run native libraries on mobile devices and emulators. The <code class="inlineCode">cordova-res</code> library generates the icons and splash screens of our application for native mobile devices.</p>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="2">Run the following command to create a new Angular application that uses the <code class="inlineCode">sidemenu</code> starter template from Ionic and also adds Capacitor:
        <pre class="programlisting con"><code class="hljs-con">ionic start phototag sidemenu --type=angular --capacitor 
</code></pre>
      </li>
      <li class="numberedList">The preceding command will ask you if you want to use Angular modules or standalone components. Select <code class="inlineCode">Standalone</code> and press <em class="keystroke">Enter</em>.</li>
    </ol>
    <p class="normal">Ionic will <a id="_idIndexMarker311"/>create a sample application for us with some ready-made data. In the following section, we will learn how to modify it according to our needs.</p>
    <h2 id="_idParaDest-105" class="heading-2">Building the main menu</h2>
    <p class="normal">We will start <a id="_idIndexMarker312"/>building the main menu of our application according to our specifications:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Load the Ionic project we built in the previous section within VSCode and open the main HTML file of the application, <code class="inlineCode">index.html</code>.</li>
      <li class="numberedList">Add the name of your application in the <code class="inlineCode">&lt;title&gt;</code> tag:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag">&lt;</span><span class="hljs-name">title</span><span class="hljs-tag">&gt;</span><span class="code-highlight"><strong class="hljs-slc">Phototag</strong></span> App<span class="hljs-tag">&lt;/</span><span class="hljs-name">title</span><span class="hljs-tag">&gt;</span>
</code></pre>
      </li>
      <li class="numberedList">Open the template file of the main component, <code class="inlineCode">app.component.html</code>, and remove the second <code class="inlineCode">&lt;ion-list&gt;</code> element. An <code class="inlineCode">&lt;ion-list&gt;</code> element displays items in a list view.</li>
      <li class="numberedList">Add the name of your application in the <code class="inlineCode">&lt;ion-list-header&gt;</code> element and change the text of the <code class="inlineCode">&lt;ion-note&gt;</code> element accordingly:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag">&lt;</span><span class="hljs-name">ion-list-header</span><span class="hljs-tag">&gt;</span><span class="code-highlight"><strong class="hljs-slc">Phototag</strong></span><span class="hljs-tag">&lt;/</span><span class="hljs-name">ion-list-header</span><span class="hljs-tag">&gt;</span>
<span class="hljs-tag">&lt;</span><span class="hljs-name">ion-note</span><span class="hljs-tag">&gt;</span><span class="code-highlight"><strong class="hljs-slc">Capture geotagged photos</strong></span><span class="hljs-tag">&lt;/</span><span class="hljs-name">ion-note</span><span class="hljs-tag">&gt;</span>
</code></pre>
    <p class="normal">An <code class="inlineCode">&lt;ion-list-header&gt;</code> element is the header of a list. An <code class="inlineCode">&lt;ion-note&gt;</code> element is a text element used to provide additional information, such as the subtitle of a list.</p>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="5">Open <a id="_idIndexMarker313"/>the TypeScript file of the main component, <code class="inlineCode">app.component.ts</code>, and modify the <code class="inlineCode">AppComponent</code> class as follows:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title">AppComponent</span> {
  <span class="hljs-keyword">public</span> appPages = [
    {
      <span class="hljs-attr">title</span>: <span class="hljs-string">'Take a photo'</span>,
      <span class="hljs-attr">url</span>: <span class="hljs-string">'/capture'</span>,
      <span class="hljs-attr">icon</span>: <span class="hljs-string">'camera'</span>
    },
    {
      <span class="hljs-attr">title</span>: <span class="hljs-string">'View gallery'</span>,
      <span class="hljs-attr">url</span>: <span class="hljs-string">'/view'</span>,
      <span class="hljs-attr">icon</span>: <span class="hljs-string">'globe'</span>
    }
  ];
  <span class="hljs-title">constructor</span>() {}
}
</code></pre>
    <p class="normal">The <code class="inlineCode">appPages</code> property contains all the pages of our application. Each page has a <code class="inlineCode">title</code>, a <code class="inlineCode">url</code> from which it is accessible, and an <code class="inlineCode">icon</code>. Our application will consist of two pages, one that will be used for taking photos using the camera and another for displaying them on a map.</p>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="6">Run the <code class="inlineCode">serve</code> command of the Ionic CLI to start the application:
        <pre class="programlisting con"><code class="hljs-con">ionic serve
</code></pre>
    <p class="normal">The preceding command will build your application and open your default browser at <code class="inlineCode">http://localhost:8100</code>.</p>
    <p class="normal">You should see the following output in the side menu of the application:</p>
    <figure class="mediaobject"><img src="../Images/B18465_06_02.png" alt="Figure 6.8 – Main menu"/></figure>
    <p class="packt_figref">Figure 6.2 – Main menu</p>
      </li>
    </ol>
    <div class="packt_tip">
      <p class="normal">Suppose you adjust your browser window size to achieve a more realistic view for a mobile device or use an emulator like the device toolbar in the Google Chrome developer tools. In that case, you must click the application menu button to see the preceding image.</p>
    </div>
    <p class="normal">We <a id="_idIndexMarker314"/>have learned how to create a new Ionic application using the Ionic CLI and make modifications according to our needs.</p>
    <p class="normal">If we try to click on a menu item, we will notice that nothing happens since we have not created the necessary pages to be activated in each case. In the following section, we will learn how to complete this task by building the functionality of the first page.</p>
    <h1 id="_idParaDest-106" class="heading-1">Taking photos with Capacitor</h1>
    <p class="normal">The first page<a id="_idIndexMarker315"/> of our application will allow the user to take photos using the camera. We will use the Capacitor <a id="_idIndexMarker316"/>runtime to get access to the native resource of the camera. To implement the page, we need to take the following actions:</p>
    <ul>
      <li class="bulletList">Create the user interface.</li>
      <li class="bulletList">Interact with Capacitor.</li>
    </ul>
    <p class="normal">Let’s start building the user interface of the page.</p>
    <h2 id="_idParaDest-107" class="heading-2">Creating the user interface</h2>
    <p class="normal">Each page in our <a id="_idIndexMarker317"/>application is a different Angular component. To create an Angular component in Ionic, we can use the <code class="inlineCode">generate</code> command of the Ionic CLI:</p>
    <pre class="programlisting con"><code class="hljs-con">ionic generate page capture
</code></pre>
    <p class="normal">The previous command will perform the following actions:</p>
    <ul>
      <li class="bulletList">Create an Angular component named <code class="inlineCode">capture</code>.</li>
      <li class="bulletList">Create a related routes file.</li>
    </ul>
    <p class="normal">Let’s start building the logic of our new page now:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">First, make our page the default when the user opens the application. Open the <code class="inlineCode">app.routes.ts</code> file and change the first entry of the <code class="inlineCode">routes</code> property to:
        <pre class="programlisting code"><code class="hljs-code">{
  <span class="hljs-attr">path</span>: <span class="hljs-string">''</span>,
  <span class="hljs-attr">redirectTo</span>: <span class="hljs-string">'</span><span class="code-highlight"><strong class="hljs-string-slc">capture</strong></span><span class="hljs-string">'</span>,
  <span class="hljs-attr">pathMatch</span>: <span class="hljs-string">'full'</span>,
}
</code></pre>
    <p class="normal">The empty path is called the <strong class="keyWord">default</strong> routing path and is activated when our application starts up. The <code class="inlineCode">redirectTo</code> property tells Angular to redirect to the <code class="inlineCode">capture</code> path, which will load the page we created.</p>
    <div class="packt_tip">
      <p class="normal">You can also remove the <code class="inlineCode">folder/:id</code> path as it is no longer needed and the whole <code class="inlineCode">src\app\folder</code> directory from the application, which is part of the Ionic template layout.</p>
    </div>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="2">Open the <code class="inlineCode">capture.page.html</code> file and replace the contents of the first <code class="inlineCode">&lt;ion-toolbar&gt;</code> element as follows:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag">&lt;</span><span class="hljs-name">ion-header</span><span class="hljs-tag"> [</span><span class="hljs-attr">translucent</span><span class="hljs-tag">]=</span><span class="hljs-string">"true"</span><span class="hljs-tag">&gt;</span>
  <span class="hljs-tag">&lt;</span><span class="hljs-name">ion-toolbar</span><span class="hljs-tag">&gt;</span>
    <span class="code-highlight"><strong class="hljs-tag-slc">&lt;</strong><strong class="hljs-name-slc">ion-buttons</strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc">slot</strong><strong class="hljs-tag-slc">=</strong><strong class="hljs-string-slc">"start"</strong><strong class="hljs-tag-slc">&gt;</strong></span>
<span class="code-highlight"><strong class="hljs-slc">      </strong><strong class="hljs-tag-slc">&lt;</strong><strong class="hljs-name-slc">ion-menu-button</strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc">color</strong><strong class="hljs-tag-slc">=</strong><strong class="hljs-string-slc">"primary"</strong><strong class="hljs-tag-slc">&gt;&lt;/</strong><strong class="hljs-name-slc">ion-menu-button</strong><strong class="hljs-tag-slc">&gt;</strong></span>
<span class="code-highlight"><strong class="hljs-slc">    </strong><strong class="hljs-tag-slc">&lt;/</strong><strong class="hljs-name-slc">ion-buttons</strong><strong class="hljs-tag-slc">&gt;</strong></span>
<span class="code-highlight"><strong class="hljs-slc">    </strong></span><span class="hljs-tag">&lt;</span><span class="hljs-name">ion-title</span><span class="hljs-tag">&gt;</span><span class="code-highlight"><strong class="hljs-slc">Take a photo</strong></span><span class="hljs-tag">&lt;/</span><span class="hljs-name">ion-title</span><span class="hljs-tag">&gt;</span>
  <span class="hljs-tag">&lt;/</span><span class="hljs-name">ion-toolbar</span><span class="hljs-tag">&gt;</span>
<span class="hljs-tag">&lt;/</span><span class="hljs-name">ion-header</span><span class="hljs-tag">&gt;</span>
</code></pre>
    <p class="normal">The <code class="inlineCode">&lt;ion-toolbar&gt;</code> element is part of the <code class="inlineCode">&lt;ion-header&gt;</code> element, which is the top navigation bar of the page. It contains an <code class="inlineCode">&lt;ion-menu-button&gt;</code> element for toggling the main menu of the application and an <code class="inlineCode">&lt;ion-title&gt;</code> element that depicts the title of the page.</p>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="3">Modify <a id="_idIndexMarker318"/>the title of the second <code class="inlineCode">&lt;ion-toolbar&gt;</code> element as follows:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag">&lt;</span><span class="hljs-name">ion-title</span><span class="hljs-tag"> </span><span class="hljs-attr">size</span><span class="hljs-tag">=</span><span class="hljs-string">"large"</span><span class="hljs-tag">&gt;</span><span class="code-highlight"><strong class="hljs-slc">Take a photo</strong></span><span class="hljs-tag">&lt;/</span><span class="hljs-name">ion-title</span><span class="hljs-tag">&gt;</span>
</code></pre>
    <p class="normal">The second <code class="inlineCode">&lt;ion-header&gt;</code> element will be displayed when the page is expanded, and the main menu is displayed on the screen.</p>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="4">Add the following HTML code immediately after the second header:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag">&lt;</span><span class="hljs-name">div</span><span class="hljs-tag"> </span><span class="hljs-attr">id</span><span class="hljs-tag">=</span><span class="hljs-string">"container"</span><span class="hljs-tag">&gt;</span>
  <span class="hljs-tag">&lt;</span><span class="hljs-name">strong</span><span class="hljs-tag"> </span><span class="hljs-attr">class</span><span class="hljs-tag">=</span><span class="hljs-string">"capitalize"</span><span class="hljs-tag">&gt;</span>Take a nice photo with your camera<span class="hljs-tag">&lt;/</span><span class="hljs-name">strong</span><span class="hljs-tag">&gt;</span>
  <span class="hljs-tag">&lt;</span><span class="hljs-name">ion-fab</span><span class="hljs-tag"> </span><span class="hljs-attr">vertical</span><span class="hljs-tag">=</span><span class="hljs-string">"center"</span><span class="hljs-tag"> </span><span class="hljs-attr">horizontal</span><span class="hljs-tag">=</span><span class="hljs-string">"center"</span><span class="hljs-tag"> </span><span class="hljs-attr">slot</span><span class="hljs-tag">=</span><span class="hljs-string">"fixed"</span><span class="hljs-tag">&gt;</span>
    <span class="hljs-tag">&lt;</span><span class="hljs-name">ion-fab-button</span><span class="hljs-tag">&gt;</span>
      <span class="hljs-tag">&lt;</span><span class="hljs-name">ion-icon</span><span class="hljs-tag"> </span><span class="hljs-attr">name</span><span class="hljs-tag">=</span><span class="hljs-string">"camera"</span><span class="hljs-tag">&gt;&lt;/</span><span class="hljs-name">ion-icon</span><span class="hljs-tag">&gt;</span>
    <span class="hljs-tag">&lt;/</span><span class="hljs-name">ion-fab-button</span><span class="hljs-tag">&gt;</span>
  <span class="hljs-tag">&lt;/</span><span class="hljs-name">ion-fab</span><span class="hljs-tag">&gt;</span>
<span class="hljs-tag">&lt;/</span><span class="hljs-name">div</span><span class="hljs-tag">&gt;</span>
</code></pre>
    <p class="normal">It contains an <code class="inlineCode">&lt;ion-fab-button&gt;</code> element, which, when clicked, will open the camera of the device to take a photo.</p>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="5">Finally, let’s add some cool styles to our page. Open the <code class="inlineCode">capture.page.scss</code> file and enter the following CSS styles:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-selector-id">#container</span> {
    <span class="hljs-attribute">text-align</span>: center;
    <span class="hljs-attribute">position</span>: absolute;
    <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">right</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">top</span>: <span class="hljs-number">50%</span>;
    <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(-<span class="hljs-number">50%</span>);
}
<span class="hljs-selector-id">#container</span> <span class="hljs-selector-tag">strong</span> {
    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">20px</span>;
    <span class="hljs-attribute">line-height</span>: <span class="hljs-number">26px</span>;
}
<span class="hljs-selector-id">#container</span> <span class="hljs-selector-tag">ion-fab</span> {
    <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">60px</span>;
}
</code></pre>
      </li>
    </ol>
    <p class="normal">Let’s run the <a id="_idIndexMarker319"/>application using <code class="inlineCode">ionic serve</code> to get a quick preview of what we have built so far:</p>
    <figure class="mediaobject"><img src="../Images/B18465_06_03.png" alt=""/></figure>
    <p class="packt_figref">Figure 6.3 – Capture page</p>
    <p class="normal">The camera button on the page needs to open the camera to take a photo. In the following section, we will learn how to use Capacitor to interact with the camera.</p>
    <h2 id="_idParaDest-108" class="heading-2">Interacting with Capacitor</h2>
    <p class="normal">Taking photos<a id="_idIndexMarker320"/> in our<a id="_idIndexMarker321"/> application involves using two APIs from the Capacitor library. The <strong class="keyWord">Camera API</strong> will open the camera to take a photo, and the <strong class="keyWord">Geolocation API</strong> will read the current location from the GPS. Let’s see how we can use both in our application:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Execute the following <code class="inlineCode">npm</code> command to install both APIs:
        <pre class="programlisting con"><code class="hljs-con">npm install @capacitor/camera @capacitor/geolocation
</code></pre>
      </li>
      <li class="numberedList">Create an Angular service using the following Ionic CLI command:
        <pre class="programlisting con"><code class="hljs-con">ionic generate service photo
</code></pre>
      </li>
      <li class="numberedList">Open the <code class="inlineCode">photo.service.ts</code> file and add the following <code class="inlineCode">import</code> statements:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">import</span> { <span class="hljs-title">Camera</span>, <span class="hljs-title">CameraResultType</span>, <span class="hljs-title">CameraSource</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@capacitor/camera'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title">Geolocation</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'</span><span class="hljs-string">@capacitor/geolocation'</span>;
</code></pre>
      </li>
      <li class="numberedList">Create<a id="_idIndexMarker322"/> a method in the <code class="inlineCode">PhotoService</code> class to read the current position from the GPS device:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> <span class="hljs-title">getLocation</span>() {
  <span class="hljs-keyword">const</span> location = <span class="hljs-keyword">await</span> <span class="hljs-title">Geolocation</span>.<span class="hljs-title">getCurrentPosition</span>();
  <span class="hljs-keyword">return</span> location.<span class="hljs-property">coords</span>;
}
</code></pre>
    <p class="normal">The <code class="inlineCode">getCurrentPosition</code> method of the <code class="inlineCode">Geolocation</code> object contains a <code class="inlineCode">coords</code> property with various location-based data such as the latitude and the longitude.</p>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="5">Create<a id="_idIndexMarker323"/> another method that calls the <code class="inlineCode">getLocation</code> method and opens the camera of the device to take a photo:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">async</span> <span class="hljs-title">takePhoto</span>() {
  <span class="hljs-keyword">await</span> <span class="hljs-variable">this</span>.<span class="hljs-title">getLocation</span>();
  <span class="hljs-keyword">await</span> <span class="hljs-title">Camera</span>.<span class="hljs-title">getPhoto</span>({
    <span class="hljs-attr">resultType</span>: <span class="hljs-title">CameraResultType</span>.<span class="hljs-property">DataUrl</span>,
    <span class="hljs-attr">source</span>: <span class="hljs-title">CameraSource</span>.<span class="hljs-property">Camera</span>,
    <span class="hljs-attr">quality</span>: <span class="hljs-number">100</span>
  });
}
</code></pre>
    <p class="normal">We use the <code class="inlineCode">getPhoto</code> method of the <code class="inlineCode">Camera</code> object and pass a configuration object to define the properties for each photo. The <code class="inlineCode">resultType</code> property indicates that the photo will be in a <strong class="keyWord">data URL</strong> format to save it to Firebase later easily. The <code class="inlineCode">source</code> property indicates that we will use the camera device to get the photo, and the <code class="inlineCode">quality</code> property defines the quality of the actual photo.</p>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="6">Open<a id="_idIndexMarker324"/> the <code class="inlineCode">capture.page.ts</code> file and inject <code class="inlineCode">PhotoService</code> in the <code class="inlineCode">constructor</code> of the <code class="inlineCode">CapturePage</code> class:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">import</span> { <span class="hljs-title">Component</span>, <span class="hljs-title">OnInit</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title">CommonModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/common'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title">FormsModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/forms'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title">IonicModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ionic/angular'</span>;
<span class="code-highlight"><strong class="hljs-keyword-slc">import</strong><strong class="hljs-slc"> { </strong><strong class="hljs-title-slc">PhotoService</strong><strong class="hljs-slc"> } </strong><strong class="hljs-keyword-slc">from</strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc">'../photo.service'</strong><strong class="hljs-slc">;</strong></span>
<span class="hljs-meta">@Component</span>({
  <span class="hljs-attr">selector</span>: <span class="hljs-string">'app-capture'</span>,
  <span class="hljs-attr">templateUrl</span>: <span class="hljs-string">'./capture.page.html'</span>,
  <span class="hljs-attr">styleUrls</span>: [<span class="hljs-string">'</span><span class="hljs-string">./capture.page.scss'</span>],
  <span class="hljs-attr">standalone</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">imports</span>: [<span class="hljs-title">IonicModule</span>, <span class="hljs-title">CommonModule</span>, <span class="hljs-title">FormsModule</span>]
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title">CapturePage</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">OnInit</span> {
  <span class="hljs-title">constructor</span>(<span class="code-highlight"><strong class="hljs-keyword-slc">private</strong><strong class="hljs-params-slc"> photoService: PhotoService</strong></span>) { }
  <span class="hljs-title">ngOnInit</span>() {
  }
}
</code></pre>
      </li>
      <li class="numberedList">Create<a id="_idIndexMarker325"/> a component method that will call the <code class="inlineCode">takePhoto</code> method of the <code class="inlineCode">photoService</code> variable:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-title">openCamera</span>() {
  <span class="hljs-variable">this</span>.<span class="hljs-property">photoService</span>.<span class="hljs-title">takePhoto</span>();
}
</code></pre>
      </li>
      <li class="numberedList">Open the <code class="inlineCode">capture.page.html</code> file and bind the <code class="inlineCode">click</code> event of the <code class="inlineCode">&lt;ion-fab-button&gt;</code> element to the <code class="inlineCode">openCamera</code> component method:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag">&lt;</span><span class="hljs-name">ion-fab-button</span><span class="hljs-tag"> </span><span class="code-highlight"><strong class="hljs-tag-slc">(</strong><strong class="hljs-attr-slc">click</strong><strong class="hljs-tag-slc">)=</strong><strong class="hljs-string-slc">"openCamera()"</strong></span><span class="hljs-tag">&gt;</span>
  <span class="hljs-tag">&lt;</span><span class="hljs-name">ion-icon</span><span class="hljs-tag"> </span><span class="hljs-attr">name</span><span class="hljs-tag">=</span><span class="hljs-string">"camera"</span><span class="hljs-tag">&gt;&lt;/</span><span class="hljs-name">ion-icon</span><span class="hljs-tag">&gt;</span>
<span class="hljs-tag">&lt;/</span><span class="hljs-name">ion-fab-button</span><span class="hljs-tag">&gt;</span>
</code></pre>
      </li>
    </ol>
    <p class="normal">We have now added all the necessary pieces to take a photo using the camera of the device. Let’s try to run the application on a real device to test the interaction with the camera:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">First, we need to build our application using the following Ionic CLI command:
        <pre class="programlisting con"><code class="hljs-con">ionic build
</code></pre>
      </li>
    </ol>
    <p class="normal">The<a id="_idIndexMarker326"/> preceding command will create a <code class="inlineCode">www</code> folder in the root folder of your project that contains your application bundle.</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="2">Run<a id="_idIndexMarker327"/> the following command to open the application in the development environment of your chosen platform:
        <pre class="programlisting con"><code class="hljs-con">ionic cap open &lt;os&gt;
</code></pre>
    <p class="normal">In the previous command, <code class="inlineCode">&lt;os&gt;</code> can be either <strong class="keyWord">android</strong> or <strong class="keyWord">ios</strong>. Upon execution, it will open the native mobile project in the respective IDE, Android Studio, or Xcode, depending on the platform that you are targeting. The IDE must then be used to run the native application.</p>
    <div class="note">
      <p class="normal">Whenever you want to rebuild the application, you must run the <code class="inlineCode">ionic cap copy</code> command to copy the application bundle from the <code class="inlineCode">www</code> folder into the native mobile project.</p>
    </div>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="3">Click on the camera button. The application may ask your permission to use the GPS and the camera. Alternatively, you may need to enable location settings on your device before continuing.</li>
    </ol>
    <div class="note">
      <p class="normal">You will probably need to add additional permissions in the native mobile project of your development environment. Check the respective documentation of the APIs on the Capacitor website.</p>
    </div>
    <p class="normal">The first page of our application now has a sleek interface that allows the user to interact with the camera. We have also created an Angular service that ensures a seamless interaction with Capacitor to get location-based data and take photos. In the following section, we will see how to save them in the cloud using Firebase.</p>
    <h1 id="_idParaDest-109" class="heading-1">Storing data in Firebase</h1>
    <p class="normal">The application will be <a id="_idIndexMarker328"/>able to store photos and their location in Firebase. We will use the Storage service to upload our photos and the Cloud Firestore database to keep their location. We will further expand our application in the following tasks:</p>
    <ul>
      <li class="bulletList">Creating a Firebase project</li>
      <li class="bulletList">Integrating the <strong class="keyWord">AngularFire</strong> library</li>
    </ul>
    <p class="normal">First, we must set up a new Firebase project for our application.</p>
    <h2 id="_idParaDest-110" class="heading-2">Creating a Firebase project</h2>
    <p class="normal">We <a id="_idIndexMarker329"/>can set<a id="_idIndexMarker330"/> up and configure a Firebase project using the <strong class="keyWord">Firebase console</strong> at <a href="https://console.firebase.google.com"><span class="url">https://console.firebase.google.com</span></a>:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Click on the <strong class="screenText">Add project</strong> button to create a new Firebase project:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18465_06_04.png" alt="Figure 6.10 – Create a new Firebase project"/></figure>
    <p class="packt_figref">Figure 6.4 – Create a new Firebase project</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="2">Enter a name for your project and click the <strong class="screenText">Continue</strong> button:
    <figure class="mediaobject"><img src="../Images/B18465_06_05.png" alt="Figure 6.11 – Enter the project name"/></figure>
    <p class="packt_figref">Figure 6.5 – Enter the project name</p>
    <div class="note">
      <p class="normal">Firebase generates a unique identifier for your project, which is located underneath the project name and is used in various Firebase services.</p>
    </div></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="3">Disable <strong class="keyWord">Google Analytics</strong> for<a id="_idIndexMarker331"/> this project and <a id="_idIndexMarker332"/>click on the <strong class="screenText">Create project</strong> button:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18465_06_06.png" alt="Figure 6.12 – Disable Google Analytics"/></figure>
    <p class="packt_figref">Figure 6.6 – Disable Google Analytics</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="4">Wait<a id="_idIndexMarker333"/> for the new project to be created and click the <strong class="screenText">Continue</strong> button. You will be redirected to the dashboard of your new project, which contains a list of options:
    <figure class="mediaobject"><img src="../Images/B18465_06_07.png" alt="Figure 6.13 – Select the type of your application"/></figure>
    <p class="packt_figref">Figure 6.7 – Select the type of your application</p>
    <p class="normal">Click<a id="_idIndexMarker334"/> the third option with the <em class="italic">code</em> icon to add Firebase to a web application.</p></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="5">Enter a name for your application in the <strong class="screenText">App nickname</strong> field and click on the <strong class="screenText">Register app</strong> button:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18465_06_08.png" alt="Figure 6.14 – Application registration"/></figure>
    <p class="packt_figref">Figure 6.8 – Application registration</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="6">Firebase <a id="_idIndexMarker335"/>will generate a configuration that we will<a id="_idIndexMarker336"/> use later in the mobile application:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">const</span> firebaseConfig = {
  <span class="hljs-attr">apiKey</span>: <span class="hljs-string">"&lt;Your API key&gt;"</span>,
  <span class="hljs-attr">authDomain</span>: <span class="hljs-string">"&lt;Your project auth domain&gt;"</span>,
  <span class="hljs-attr">projectId</span>: <span class="hljs-string">"&lt;Your project ID&gt;"</span>,
  <span class="hljs-attr">storageBucket</span>: <span class="hljs-string">"&lt;Your storage bucket&gt;"</span>,
  <span class="hljs-attr">messagingSenderId</span>: <span class="hljs-string">"&lt;Your messaging sender ID&gt;"</span>,
  <span class="hljs-attr">appId</span>: <span class="hljs-string">"&lt;Your application ID&gt;"</span>
};
</code></pre>
    <p class="normal">Copy the <code class="inlineCode">firebaseConfig</code> object and click the <strong class="screenText">Continue to console</strong> button.</p>
    <div class="packt_tip">
      <p class="normal">The Firebase configuration can also be accessed later at <code class="inlineCode">https://console.firebase.google.com/project/&lt;project-id&gt;/settings/general</code>, where <code class="inlineCode">project-id</code> is the ID of your Firebase project.</p>
    </div>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="7">Back in the dashboard console, select the <strong class="screenText">Cloud Firestore</strong> option to enable Cloud Firestore in your application.</li>
      <li class="numberedList">Click <a id="_idIndexMarker337"/>on the <strong class="screenText">Create database</strong> button to create a <a id="_idIndexMarker338"/>new Cloud Firestore database:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18465_06_09.png" alt="Figure 6.16 – Create a database"/></figure>
    <p class="packt_figref">Figure 6.9 – Create a database</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="9">Select the operation mode of your database. Choose <strong class="screenText">Start in Test mode</strong> for development purposes and click the <strong class="screenText">Next</strong> button:
    <figure class="mediaobject"><img src="../Images/B18465_06_10.png" alt="Εικόνα που περιέχει κείμενο  Περιγραφή που δημιουργήθηκε αυτόματα"/></figure>
    <p class="packt_figref">Figure 6.10 – Select operation mode</p>
    <p class="normal">Choosing <a id="_idIndexMarker339"/>a mode is nothing less than setting <a id="_idIndexMarker340"/>rules for your database. Test mode allows faster setup and keeps your data public for 30 days. When you are ready to move your application into production, you can modify the rules of your database accordingly to make your data private.</p></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="10">Choose a location for your database according to your regional settings and click the <strong class="screenText">Enable</strong> button.</li>
    </ol>
    <p class="normal">Congratulations! You have created a new Cloud Firestore database. In the next section, we will learn how to use the new database for saving data with our mobile application.</p>
    <h2 id="_idParaDest-111" class="heading-2">Integrating the AngularFire library</h2>
    <p class="normal">The<a id="_idIndexMarker341"/> AngularFire library<a id="_idIndexMarker342"/> is an Angular library that we can use in an Angular application to interact with Firebase family products such as Cloud Firestore and the <a id="_idIndexMarker343"/>Storage service. To install it in our application:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Run the following command in a terminal window to install <strong class="keyWord">Firebase tools</strong>:
        <pre class="programlisting con"><code class="hljs-con">npm install -g firebase-tools
</code></pre>
      </li>
      <li class="numberedList">Run the following command in the same terminal window to authenticate with the Firebase CLI:
        <pre class="programlisting con"><code class="hljs-con">firebase login
</code></pre>
      </li>
      <li class="numberedList">Finally, run the following command of the Angular CLI to install the <code class="inlineCode">@angular/fire</code> npm package in your Angular CLI project:
        <pre class="programlisting con"><code class="hljs-con">ng add @angular/fire
</code></pre>
    <p class="normal">The preceding command will find the latest version of the library and prompt us to install it.</p>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="4">First, it will ask what features of Firebase we want to enable:
        <pre class="programlisting con"><code class="hljs-con">? What features would you like to setup?
</code></pre>
    <p class="normal">Make sure that you select <em class="italic">only</em> the <code class="inlineCode">Firestore</code> option and press <em class="keystroke">Enter</em>.</p>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="5">Then, it will ask us to select which Firebase account we want to use:
        <pre class="programlisting con"><code class="hljs-con">? Which Firebase account would you like to use?
</code></pre>
    <p class="normal">Ensure the account you used earlier is selected, and press <em class="keystroke">Enter</em>.</p>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="6">In the next question, we will choose for which project we are going to use Firestore:
        <pre class="programlisting con"><code class="hljs-con">? Please select a project:
</code></pre>
    <p class="normal">Select the <code class="inlineCode">phototag</code> project that we created earlier and press <em class="keystroke">Enter</em>. </p>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="7">Finally, we must choose the app that has Firestore enabled:
        <pre class="programlisting con"><code class="hljs-con">? Please select an app:
</code></pre>
    <p class="normal">Select the <code class="inlineCode">phototag</code> app that we created earlier and press <em class="keystroke">Enter</em>.</p>
    <div class="note">
      <p class="normal">The preceding command may throw an error stating that the <code class="inlineCode">app.module.ts</code> file does not exist. Please ignore it and continue with the next step.</p>
    </div>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="8">Open<a id="_idIndexMarker344"/> the <code class="inlineCode">main.ts</code> file and add the following <code class="inlineCode">import</code> statements:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">import</span> { provideFirebaseApp, initializeApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/fire/app'</span>;
<span class="hljs-keyword">import</span> { getFirestore, provideFirestore } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/fire/firestore'</span>;
<span class="hljs-keyword">import</span> { getStorage, provideStorage } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/fire/storage'</span>;
</code></pre>
      </li>
      <li class="numberedList">Finally, modify<a id="_idIndexMarker345"/> the <code class="inlineCode">providers</code> array in the <code class="inlineCode">bootstrapApplication</code> method as follows:
        <pre class="programlisting gen"><code class="hljs"><span class="hljs-title">bootstrapApplication</span>(<span class="hljs-title">AppComponent</span>, {
  <span class="hljs-attr">providers</span>: [
    { <span class="hljs-attr">provide</span>: <span class="hljs-title">RouteReuseStrategy</span>, <span class="hljs-attr">useClass</span>: <span class="hljs-title">IonicRouteStrategy</span> },
    importProvidersFrom(<span class="hljs-title">IonicModule</span>.<span class="hljs-title">forRoot</span>({})),
    <span class="hljs-title">provideRouter</span>(routes),
<span class="code-highlight"><strong class="hljs-slc">    importProvidersFrom(</strong><strong class="hljs-title-slc">provideFirebaseApp</strong><strong class="hljs-slc">(</strong><strong class="hljs-function-slc">() =&gt;</strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc">initializeApp</strong><strong class="hljs-slc">(&lt;firebaseConfig&gt;))),</strong></span>
<span class="code-highlight"><strong class="hljs-slc">    importProvidersFrom(</strong><strong class="hljs-title-slc">provideFirestore</strong><strong class="hljs-slc">(</strong><strong class="hljs-function-slc">() =&gt;</strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc">getFirestore</strong><strong class="hljs-slc">())),</strong></span>
<span class="code-highlight"><strong class="hljs-slc">    importProvidersFrom(</strong><strong class="hljs-title-slc">provideStorage</strong><strong class="hljs-slc">(</strong><strong class="hljs-function-slc">() =&gt;</strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc">getStorage</strong><strong class="hljs-slc">()))</strong></span>
  ]
});
</code></pre>
      </li>
    </ol>
    <p class="normal">Replace <code class="inlineCode">&lt;firebaseConfig&gt;</code> with the Firebase configuration object that you copied in the previous section.</p>
    <p class="normal">Let’s see now how we can use the AngularFire library in our application:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Open the <code class="inlineCode">photo.service.ts</code> file and add the following <code class="inlineCode">import</code> statements:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">import</span> { <span class="hljs-title">Firestore</span>, collection, addDoc } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/fire/firestore'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title">Storage</span>, ref, uploadString, getDownloadURL } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/fire/storage'</span>;
</code></pre>
    <p class="normal">The <code class="inlineCode">Firestore</code> service contains all the necessary methods that we will need to interact with our Cloud Firestore database. The <code class="inlineCode">Storage</code> service contains methods for uploading files to the Storage service.</p>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="2">Inject <a id="_idIndexMarker346"/>both services into the <code class="inlineCode">constructor</code> of the <code class="inlineCode">PhotoService</code> class:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-title">constructor</span>(<span class="code-highlight"><strong class="hljs-keyword-slc">private</strong><strong class="hljs-params-slc"> firestore: Firestore, </strong><strong class="hljs-keyword-slc">private</strong><strong class="hljs-params-slc"> storage: Storage</strong></span>) {}
</code></pre>
      </li>
      <li class="numberedList">Create <a id="_idIndexMarker347"/>the following method to save a photo in Firebase:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> <span class="hljs-title">savePhoto</span>(<span class="hljs-params">dataUrl: </span><span class="hljs-built_in">string</span><span class="hljs-params">, latitude: </span><span class="hljs-built_in">number</span><span class="hljs-params">, longitude: </span><span class="hljs-built_in">number</span>) {
  <span class="hljs-keyword">const</span> name = <span class="hljs-keyword">new</span> <span class="hljs-title">Date</span>().<span class="hljs-title">getUTCMilliseconds</span>().<span class="hljs-title">toString</span>();
  <span class="hljs-keyword">const</span> storageRef = <span class="hljs-title">ref</span>(<span class="hljs-variable">this</span>.<span class="hljs-property">storage</span>, name);
  <span class="hljs-keyword">await</span> <span class="hljs-title">uploadString</span>(storageRef, dataUrl, <span class="hljs-string">'</span><span class="hljs-string">data_url'</span>);
  <span class="hljs-keyword">const</span> photoUrl = <span class="hljs-keyword">await</span> <span class="hljs-title">getDownloadURL</span>(storageRef);
  <span class="hljs-keyword">const</span> photoCollection = <span class="hljs-title">collection</span>(<span class="hljs-variable">this</span>.<span class="hljs-property">firestore</span>, <span class="hljs-string">'photos'</span>);
  <span class="hljs-keyword">await</span> <span class="hljs-title">addDoc</span>(photoCollection, {
    <span class="hljs-attr">url</span>: photoUrl,
    <span class="hljs-attr">lat</span>: latitude,
    <span class="hljs-attr">lng</span>: longitude
  })
}
</code></pre>
    <p class="normal">First, we create a random <code class="inlineCode">name</code> for our photo and use the <code class="inlineCode">uploadString</code> method to upload it to Firebase storage. As soon as uploading has been completed, we get a downloadable URL using the <code class="inlineCode">getDownloadURL</code> method, which can be used to access that photo. Finally, we use the <code class="inlineCode">addDoc</code> method to add a new photo in the <code class="inlineCode">photocollection</code> property of the Firestore database.</p>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="4">Modify the <code class="inlineCode">takePhoto</code> method to call the <code class="inlineCode">savePhoto</code> method that we created in the previous step:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">async</span> <span class="hljs-title">takePhoto</span>() {
  <span class="code-highlight"><strong class="hljs-keyword-slc">const</strong><strong class="hljs-slc"> {latitude, longitude} =</strong></span> <span class="hljs-keyword">await</span> <span class="hljs-variable">this</span>.<span class="hljs-title">getLocation</span>();
  <span class="code-highlight"><strong class="hljs-keyword-slc">const</strong><strong class="hljs-slc"> cameraPhoto =</strong></span> <span class="hljs-keyword">await</span> <span class="hljs-title">Camera</span>.<span class="hljs-title">getPhoto</span>({
    <span class="hljs-attr">resultType</span>: <span class="hljs-title">CameraResultType</span>.<span class="hljs-property">DataUrl</span>,
    <span class="hljs-attr">source</span>: <span class="hljs-title">CameraSource</span>.<span class="hljs-property">Camera</span>,
    <span class="hljs-attr">quality</span>: <span class="hljs-number">100</span>
  });
<span class="code-highlight"><strong class="hljs-slc">  </strong><strong class="hljs-keyword-slc">if</strong><strong class="hljs-slc"> (cameraPhoto.</strong><strong class="hljs-property-slc">dataUrl</strong><strong class="hljs-slc">) {</strong></span>
<span class="code-highlight"><strong class="hljs-slc">    </strong><strong class="hljs-keyword-slc">await</strong><strong class="hljs-slc"> </strong><strong class="hljs-variable-slc">this</strong><strong class="hljs-slc">.</strong><strong class="hljs-title-slc">savePhoto</strong><strong class="hljs-slc">(cameraPhoto.</strong><strong class="hljs-property-slc">dataUrl</strong><strong class="hljs-slc">, latitude, longitude);</strong></span>
<span class="code-highlight"><strong class="hljs-slc">  }</strong></span>
}
</code></pre>
      </li>
    </ol>
    <p class="normal">We are now<a id="_idIndexMarker348"/> ready to check the full functionality <a id="_idIndexMarker349"/>of the photo-shooting process:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Run the following command of Capacitor to copy the application bundle to the native mobile project:
        <pre class="programlisting con"><code class="hljs-con">ionic cap copy
</code></pre>
      </li>
      <li class="numberedList">Open the native mobile project using the <code class="inlineCode">open</code> command of Capacitor and run the project using the respective IDE.</li>
      <li class="numberedList">Open the Firebase console of your application and select the <strong class="screenText">Storage</strong> option in the <strong class="screenText">Build</strong> section. Click on the <strong class="screenText">Get started</strong> button, select the <strong class="screenText">Start in Test mode</strong> option, and click <strong class="screenText">Next</strong>. Finally, click <strong class="screenText">Done</strong> to complete the process of setting up cloud storage. </li>
      <li class="numberedList">Use the application to take a nice photo. To verify that your photo has been successfully uploaded to Firebase, refresh the page in the Firebase console. You should see an entry like the following:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18465_06_11.png" alt="Figure 6.19 – Firebase storage"/></figure>
    <p class="packt_figref">Figure 6.11 – Firebase storage</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="5">Similarly, select the <strong class="screenText">Firestore Database</strong> option in the <strong class="screenText">Build</strong> section, and you should see something like the following:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18465_06_12.png" alt="Figure 6.20 – Cloud Firestore"/></figure>
    <p class="packt_figref">Figure 6.12 – Cloud Firestore</p>
    <p class="normal">In the<a id="_idIndexMarker350"/> preceding screenshot, the <strong class="screenText">1oFxxWgQseIwqWUrYBkN</strong> entry is the logical object of the photo that contains the URL of the actual file and its location data.</p>
    <p class="normal">The first page of <a id="_idIndexMarker351"/>our application is now feature-complete. We have gone through the full process of taking and uploading a photo to Firebase, along with its location data. We started by setting up and configuring a Firebase project and finished by learning how to use the AngularFire library to interact with that project. In the next section, we will reach our final destination by implementing the second page of our application.</p>
    <h1 id="_idParaDest-112" class="heading-1">Previewing photos with CesiumJS</h1>
    <p class="normal">The<a id="_idIndexMarker352"/> next feature of our application will be to display all the photos we have taken with the camera on a 3D map. The CesiumJS library provides a viewer with a 3D globe that we can use to visualize various things, such as images in specific locations. This new feature of our application will consist of the following:</p>
    <ul>
      <li class="bulletList">Configuring CesiumJS</li>
      <li class="bulletList">Displaying photos on the viewer</li>
    </ul>
    <p class="normal">We will begin by learning how to set up the CesiumJS library.</p>
    <h2 id="_idParaDest-113" class="heading-2">Configuring CesiumJS</h2>
    <p class="normal">The <a id="_idIndexMarker353"/>CesiumJS library<a id="_idIndexMarker354"/> is an npm package that we can install to start working with 3D maps and visualizations:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Run the following <code class="inlineCode">npm</code> command to install CesiumJS:
        <pre class="programlisting con"><code class="hljs-con">npm install cesium
</code></pre>
      </li>
      <li class="numberedList">Open the <code class="inlineCode">angular.json</code> configuration file and add the following entries in the <code class="inlineCode">assets</code> array of the <code class="inlineCode">build</code> architect option:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"glob"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"**/*"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"input"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node_modules/cesium/Build/Cesium/Workers"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"output"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/assets/cesium/Workers"</span>
<span class="hljs-punctuation">},</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"glob"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"**/*"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"input"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node_modules/cesium/Build/Cesium/ThirdParty"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"output"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/assets/cesium/ThirdParty"</span>
<span class="hljs-punctuation">},</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"glob"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"**/*"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"input"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"</span><span class="hljs-string">node_modules/cesium/Build/Cesium/Assets"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"output"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/assets/cesium/Assets"</span>
<span class="hljs-punctuation">},</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"glob"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"**/*"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"input"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node_modules/cesium/Build/Cesium/Widgets"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"output"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/assets/cesium/Widgets"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
    <p class="normal">The preceding entries will copy all CesiumJS source files into a <code class="inlineCode">cesium</code> folder inside the <code class="inlineCode">assets</code> folder of our application.</p>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="3">Also, add the CesiumJS widgets style sheet file into the <code class="inlineCode">styles</code> array of the <code class="inlineCode">build</code> section:
        <pre class="programlisting code"><code class="hljs-code">"styles": [
  <span class="code-highlight"><strong class="hljs-string-slc">"node_modules/cesium/Build/Cesium/Widgets/widgets.css"</strong><strong class="hljs-slc">,</strong></span>
  <span class="hljs-string">"src/theme/variables.scss"</span>,
  <span class="hljs-string">"src/global.scss"</span>
]
</code></pre>
    <p class="normal">The viewer of CesiumJS contains a toolbar with widgets, including a search bar and a dropdown for selecting a specific type of map, such as Bing Maps or Mapbox.</p>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="4">Open the main entry point file of our application, <code class="inlineCode">main.ts</code>, and add the following line:
        <pre class="programlisting code"><code class="hljs-code">(<span class="hljs-variable">window</span> <span class="hljs-keyword">as</span> <span class="hljs-title">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;)[<span class="hljs-string">'CESIUM_BASE_URL'</span>] = <span class="hljs-string">'/assets/cesium/'</span>;
</code></pre>
    <p class="normal">The <code class="inlineCode">CESIUM_BASE_URL</code> global variable indicates the location of the CesiumJS source files.</p>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="5">Install<a id="_idIndexMarker355"/> a custom webpack builder using the following <code class="inlineCode">npm</code> command:
        <pre class="programlisting con"><code class="hljs-con">npm install -D @angular-builders/custom-webpack
</code></pre>
    <p class="normal">A <strong class="keyWord">builder</strong> is an Angular library that extends the default functionality of the Angular CLI. The <code class="inlineCode">@angular-builders/custom-webpack</code> builder allows us to provide an additional webpack configuration file while building our application. It is beneficial in cases where we want to include other webpack plugins or override existing functionality.</p>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="6">Create a new webpack configuration file named <code class="inlineCode">extra-webpack.config.js</code> in the root folder of the project and add the following content:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-variable">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">resolve</span>: {
    <span class="hljs-attr">fallback</span>: {
      <span class="hljs-string">"https"</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-string">"zlib"</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-string">"http"</span>: <span class="hljs-literal">false</span>,
      <span class="hljs-string">"url"</span>: <span class="hljs-literal">false</span>
    }
  },
  <span class="hljs-attr">module</span>: {
    <span class="hljs-attr">unknownContextCritical</span>: <span class="hljs-literal">false</span>
  }
};
</code></pre>
    <p class="normal">The configuration file will ensure that webpack will only try to load CesiumJS code that it can understand. CesiumJS uses modules in a format that cannot be statically analyzed using webpack.</p>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="7">Open the <code class="inlineCode">angular.json</code> file and change the <code class="inlineCode">builder</code> property of the <code class="inlineCode">build</code> architect section to use the custom webpack builder:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-attr">"builder"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"</span><span class="code-highlight"><strong class="hljs-string-slc">@angular-builders/custom-webpack:browser</strong></span><span class="hljs-string">"</span>
</code></pre>
      </li>
      <li class="numberedList">Define the path of the custom webpack configuration file in the <code class="inlineCode">options</code> property of the <code class="inlineCode">build</code> section:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-attr">"customWebpackConfig"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./extra-webpack.config.js"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
      </li>
      <li class="numberedList">Also <a id="_idIndexMarker356"/>configure the <code class="inlineCode">serve</code> architect section to use the custom webpack builder:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-attr">"serve"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"builder"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"</span><span class="code-highlight"><strong class="hljs-string-slc">@angular-builders/custom-webpack:dev-server</strong></span><span class="hljs-string">"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"configurations"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"production"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"browserTarget"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"app:build:production"</span>
    <span class="hljs-punctuation">},</span>
    <span class="hljs-attr">"development"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"browserTarget"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"app:build:development"</span>
    <span class="hljs-punctuation">},</span>
    <span class="hljs-attr">"ci"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"progress"</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">false</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">},</span>
  <span class="hljs-attr">"defaultConfiguration"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"development"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
      </li>
    </ol>
    <p class="normal">Now that we have completed the configuration of the CesiumJS library, we can start creating the page for our feature:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Run the following command of the Ionic CLI to create a new page:
        <pre class="programlisting con"><code class="hljs-con">ionic generate page view
</code></pre>
      </li>
      <li class="numberedList">Open the <code class="inlineCode">view.page.html</code> file and modify the first <code class="inlineCode">&lt;ion-header&gt;</code> element so that it includes a menu toggle button:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag">&lt;</span><span class="hljs-name">ion-header</span><span class="hljs-tag"> [</span><span class="hljs-attr">translucent</span><span class="hljs-tag">]=</span><span class="hljs-string">"true"</span><span class="hljs-tag">&gt;</span>
  <span class="hljs-tag">&lt;</span><span class="hljs-name">ion-toolbar</span><span class="hljs-tag">&gt;</span>
    <span class="code-highlight"><strong class="hljs-tag-slc">&lt;</strong><strong class="hljs-name-slc">ion-buttons</strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc">slot</strong><strong class="hljs-tag-slc">=</strong><strong class="hljs-string-slc">"start"</strong><strong class="hljs-tag-slc">&gt;</strong></span>
<span class="code-highlight"><strong class="hljs-slc">      </strong><strong class="hljs-tag-slc">&lt;</strong><strong class="hljs-name-slc">ion-menu-button</strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc">color</strong><strong class="hljs-tag-slc">=</strong><strong class="hljs-string-slc">"primary"</strong><strong class="hljs-tag-slc">&gt;&lt;/</strong><strong class="hljs-name-slc">ion-menu-button</strong><strong class="hljs-tag-slc">&gt;</strong></span>
<span class="code-highlight"><strong class="hljs-slc">    </strong><strong class="hljs-tag-slc">&lt;/</strong><strong class="hljs-name-slc">ion-buttons</strong><strong class="hljs-tag-slc">&gt;</strong></span>
    <span class="hljs-tag">&lt;</span><span class="hljs-name">ion-title</span><span class="hljs-tag">&gt;</span><span class="code-highlight"><strong class="hljs-slc">View gallery</strong></span><span class="hljs-tag">&lt;/</span><span class="hljs-name">ion-title</span><span class="hljs-tag">&gt;</span>
  <span class="hljs-tag">&lt;/</span><span class="hljs-name">ion-toolbar</span><span class="hljs-tag">&gt;</span>
<span class="hljs-tag">&lt;/</span><span class="hljs-name">ion-header</span><span class="hljs-tag">&gt;</span>
</code></pre>
      </li>
      <li class="numberedList">Change<a id="_idIndexMarker357"/> the title of the <code class="inlineCode">&lt;ion-content&gt;</code> element and add a <code class="inlineCode">&lt;div&gt;</code> element that will be the container for our viewer:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag">&lt;</span><span class="hljs-name">ion-content</span><span class="hljs-tag"> [</span><span class="hljs-attr">fullscreen</span><span class="hljs-tag">]=</span><span class="hljs-string">"true"</span><span class="hljs-tag">&gt;</span>
  <span class="hljs-tag">&lt;</span><span class="hljs-name">ion-header</span><span class="hljs-tag"> </span><span class="hljs-attr">collapse</span><span class="hljs-tag">=</span><span class="hljs-string">"condense"</span><span class="hljs-tag">&gt;</span>
    <span class="hljs-tag">&lt;</span><span class="hljs-name">ion-toolbar</span><span class="hljs-tag">&gt;</span>
      <span class="hljs-tag">&lt;</span><span class="hljs-name">ion-title</span><span class="hljs-tag"> </span><span class="hljs-attr">size</span><span class="hljs-tag">=</span><span class="hljs-string">"large"</span><span class="hljs-tag">&gt;</span><span class="code-highlight"><strong class="hljs-slc">View gallery</strong></span><span class="hljs-tag">&lt;/</span><span class="hljs-name">ion-title</span><span class="hljs-tag">&gt;</span>
    <span class="hljs-tag">&lt;/</span><span class="hljs-name">ion-toolbar</span><span class="hljs-tag">&gt;</span>
  <span class="hljs-tag">&lt;/</span><span class="hljs-name">ion-header</span><span class="hljs-tag">&gt;</span>
  <span class="code-highlight"><strong class="hljs-tag-slc">&lt;</strong><strong class="hljs-name-slc">div</strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc">#mapContainer</strong><strong class="hljs-tag-slc">&gt;&lt;/</strong><strong class="hljs-name-slc">div</strong><strong class="hljs-tag-slc">&gt;</strong></span>
<span class="hljs-tag">&lt;/</span><span class="hljs-name">ion-content</span><span class="hljs-tag">&gt;</span>
</code></pre>
    <p class="normal">The <code class="inlineCode">#mapContainer</code> is a <strong class="keyWord">template reference variable</strong> we use to declare an alias for an element in our template.</p>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="4">Open the <code class="inlineCode">view.page.scss</code> file and set the size of the map container element:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-selector-tag">div</span> {
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
}
</code></pre>
      </li>
      <li class="numberedList">Let’s create our viewer now. Open the <code class="inlineCode">view.page.ts</code> file and modify it as follows:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">import</span> { <span class="code-highlight"><strong class="hljs-title-slc">AfterViewInit</strong></span>, <span class="hljs-title">Component</span>, <span class="code-highlight"><strong class="hljs-title-slc">ElementRef</strong></span>, <span class="hljs-title">OnInit</span>, <span class="code-highlight"><strong class="hljs-title-slc">ViewChild</strong></span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title">CommonModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/common'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title">FormsModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/forms'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title">IonicModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'</span><span class="hljs-string">@ionic/angular'</span>;
<span class="code-highlight"><strong class="hljs-keyword-slc">import</strong><strong class="hljs-slc"> { </strong><strong class="hljs-title-slc">Viewer</strong><strong class="hljs-slc"> } </strong><strong class="hljs-keyword-slc">from</strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc">'cesium'</strong><strong class="hljs-slc">;</strong></span>
<span class="hljs-meta">@Component</span>({
  <span class="hljs-attr">selector</span>: <span class="hljs-string">'app-view'</span>,
  <span class="hljs-attr">templateUrl</span>: <span class="hljs-string">'./view.page.html'</span>,
  <span class="hljs-attr">styleUrls</span>: [<span class="hljs-string">'./view.page.scss'</span>],
  <span class="hljs-attr">standalone</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">imports</span>: [<span class="hljs-title">IonicModule</span>, <span class="hljs-title">CommonModule</span>, <span class="hljs-title">FormsModule</span>]
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ViewPage</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">OnInit</span>, <span class="code-highlight"><strong class="hljs-title-slc">AfterViewInit</strong></span> {
<span class="code-highlight"><strong class="hljs-slc">  </strong><strong class="hljs-meta-slc">@ViewChild</strong><strong class="hljs-slc">(</strong><strong class="hljs-string-slc">'mapContainer'</strong><strong class="hljs-slc">) </strong><strong class="hljs-attr-slc">content</strong><strong class="hljs-slc">: </strong><strong class="hljs-title-slc">ElementRef</strong><strong class="hljs-slc"> | </strong><strong class="hljs-literal-slc">undefined</strong><strong class="hljs-slc">;</strong></span>
  <span class="hljs-title">constructor</span>() { }
  <span class="hljs-title">ngOnInit</span>() {
  }
  <span class="code-highlight"><strong class="hljs-title-slc">ngAfterViewInit</strong><strong class="hljs-slc">() {</strong></span>
<span class="code-highlight"><strong class="hljs-slc">    </strong><strong class="hljs-keyword-slc">const</strong><strong class="hljs-slc"> viewer = </strong><strong class="hljs-keyword-slc">new</strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc">Viewer</strong><strong class="hljs-slc">(</strong><strong class="hljs-variable-slc">this</strong><strong class="hljs-slc">.</strong><strong class="hljs-property-slc">content</strong><strong class="hljs-slc">?.</strong><strong class="hljs-property-slc">nativeElement</strong><strong class="hljs-slc">);</strong></span>
<span class="code-highlight"><strong class="hljs-slc">  }</strong></span>
}
</code></pre>
    <p class="normal">We<a id="_idIndexMarker358"/> create a new <code class="inlineCode">Viewer</code> object inside the <code class="inlineCode">ngAfterViewInit</code> method of the component. The <code class="inlineCode">ngAfterViewInit</code> method is called when the view of the component has finished loading, and it is defined in the <code class="inlineCode">AfterViewInit</code> interface. The constructor of the <code class="inlineCode">Viewer</code> class accepts as a parameter the native HTML element on which we want to create the viewer. In our case, we want to attach it to the map container element that we created earlier. Thus, we use the <code class="inlineCode">@ViewChild</code> decorator to reference that element by passing the template reference variable name as a parameter.</p>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="6">Run the application using <code class="inlineCode">ionic serve</code> and click on the <strong class="screenText">View gallery</strong> option from the main menu. You should see the following output:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18465_06_13.png" alt="Figure 6.21 – View gallery page"/></figure>
    <p class="packt_figref">Figure 6.13 – View gallery page</p>
    <p class="normal">We have now<a id="_idIndexMarker359"/> successfully configured the CesiumJS library in our application. In the next section, we will see how to benefit from it and display our photos on the 3D globe of the CesiumJS viewer.</p>
    <h2 id="_idParaDest-114" class="heading-2">Displaying photos on the viewer</h2>
    <p class="normal">The <a id="_idIndexMarker360"/>next thing we need to do for our application to be ready is display our photos on the map. We will get all the photos from Firebase and add them to the viewer in the specified locations. Let’s see how we can accomplish that:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Create a new Angular service using the following command of the Ionic CLI:
        <pre class="programlisting con"><code class="hljs-con">ionic generate service cesium
</code></pre>
      </li>
      <li class="numberedList">Open the <code class="inlineCode">cesium.service.ts</code> file and add the following <code class="inlineCode">import</code> statements:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">import</span> { <span class="hljs-title">Firestore</span>, collection, getDocs } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/fire/firestore'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title">Cartesian3</span>, <span class="hljs-title">Color</span>, <span class="hljs-title">PinBuilder</span>, <span class="hljs-title">Viewer</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'cesium'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title">Observable</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'rxjs'</span>;
<span class="hljs-keyword">import</span> { map } <span class="hljs-keyword">from</span> <span class="hljs-string">'rxjs/operators'</span>;
</code></pre>
      </li>
      <li class="numberedList">Inject the <code class="inlineCode">Firestore</code> service in the <code class="inlineCode">constructor</code> of the <code class="inlineCode">CesiumService</code> class and create a <code class="inlineCode">viewer</code> property, which we will use to store our <code class="inlineCode">Viewer</code> object:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title">CesiumService</span> {
  <span class="code-highlight"><strong class="hljs-keyword-slc">private</strong><strong class="hljs-slc"> </strong><strong class="hljs-attr-slc">viewer</strong><strong class="hljs-slc">: </strong><strong class="hljs-title-slc">Viewer</strong><strong class="hljs-slc"> | </strong><strong class="hljs-literal-slc">undefined</strong><strong class="hljs-slc">;</strong></span>
  <span class="hljs-title">constructor</span>(<span class="code-highlight"><strong class="hljs-keyword-slc">private</strong><strong class="hljs-params-slc"> firestore: Firestore</strong></span>) { }
}
</code></pre>
      </li>
      <li class="numberedList">Create a <code class="inlineCode">register</code> method to set the <code class="inlineCode">viewer</code> property:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-title">register</span>(<span class="hljs-params">viewer: Viewer</span>) {
  <span class="hljs-variable">this</span>.<span class="hljs-property">viewer</span> = viewer;
}
</code></pre>
      </li>
      <li class="numberedList">Create a method to get the <code class="inlineCode">photos</code> collection from Cloud Firestore:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> <span class="hljs-title">getPhotos</span>() {
  <span class="hljs-keyword">const</span> photoCollection = <span class="hljs-title">collection</span>(<span class="hljs-variable">this</span>.<span class="hljs-property">firestore</span>, <span class="hljs-string">'photos'</span>);
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-title">getDocs</span>(photoCollection);
}
</code></pre>
    <p class="normal">In the preceding method, we call the <code class="inlineCode">getDocs</code> method to get the data of the <code class="inlineCode">photos</code> collection.</p>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="6">Create <a id="_idIndexMarker361"/>the following method for adding all the photos to the viewer:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">async</span> <span class="hljs-title">addPhotos</span>() {
  <span class="hljs-keyword">const</span> pinBuilder = <span class="hljs-keyword">new</span> <span class="hljs-title">PinBuilder</span>();
  <span class="hljs-keyword">const</span> photos = <span class="hljs-keyword">await</span> <span class="hljs-variable">this</span>.<span class="hljs-title">getPhotos</span>();
  photos.<span class="hljs-title">forEach</span>(<span class="hljs-params">photo</span><span class="hljs-function"> =&gt;</span> {
    <span class="hljs-keyword">const</span> entity = {
      <span class="hljs-attr">position</span>: <span class="hljs-title">Cartesian3</span>.<span class="hljs-title">fromDegrees</span>(photo.<span class="hljs-title">get</span>(<span class="hljs-string">'lng'</span>), photo.<span class="hljs-title">get</span>(<span class="hljs-string">'lat'</span>)),
      <span class="hljs-attr">billboard</span>: {
        <span class="hljs-attr">image</span>: pinBuilder.<span class="hljs-title">fromColor</span>(<span class="hljs-title">Color</span>.<span class="hljs-title">fromCssColorString</span>(<span class="hljs-string">'#de6b45'</span>), <span class="hljs-number">48</span>).<span class="hljs-title">toDataURL</span>()
      },
      <span class="hljs-attr">description</span>: <span class="hljs-string">`&lt;img width="100%" style="margin:auto; display: block;" src="</span><span class="hljs-subst">${photo.get(</span><span class="hljs-string">'</span><span class="hljs-string">url'</span><span class="hljs-subst">)}</span><span class="hljs-string">" /&gt;`</span>
    };
    <span class="hljs-variable">this</span>.<span class="hljs-property">viewer</span>?.<span class="hljs-property">entities</span>.<span class="hljs-title">add</span>(entity);
  });
}
</code></pre>
    <p class="normal">The location of each photo on the viewer will be displayed as a <strong class="keyWord">pin</strong>. Thus, we need to initialize a <code class="inlineCode">PinBuilder</code> object first. The preceding method calls the <code class="inlineCode">getPhotos</code> method to get all photos from Cloud Firestore. For each photo, it creates an <code class="inlineCode">entity</code> object that contains the <code class="inlineCode">position</code>, which is the location of the photo in degrees, and a <code class="inlineCode">billboard</code> property that displays a pin of 48 pixels in size. It also defines a <code class="inlineCode">description</code> property that will show the actual image of the photo when we click on the pin.</p>
    <p class="normal">Each <code class="inlineCode">entity</code> object is added to the <code class="inlineCode">entities</code> collection of the viewer using its <code class="inlineCode">add</code> method.</p>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="7">The description of each photo is displayed inside an <strong class="keyWord">info box</strong>. Open the <code class="inlineCode">global.scss</code> file that contains the global styles of the application and add the following CSS styles for the info box:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-selector-class">.cesium-infoBox</span>, <span class="hljs-selector-class">.cesium-infoBox-iframe</span> {
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span> <span class="hljs-meta">!important</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
}
</code></pre>
      </li>
      <li class="numberedList">Now, let’s <a id="_idIndexMarker362"/>use <code class="inlineCode">CesiumService</code> from our page. Open the <code class="inlineCode">view.page.ts</code> file and inject the <code class="inlineCode">CesiumService</code> class into the <code class="inlineCode">constructor</code> of the <code class="inlineCode">ViewPage</code> class:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">import</span> { <span class="hljs-title">AfterViewInit</span>, <span class="hljs-title">Component</span>, <span class="hljs-title">ElementRef</span>, <span class="hljs-title">OnInit</span>, <span class="hljs-title">ViewChild</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title">CommonModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/common'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title">FormsModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/forms'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title">IonicModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ionic/angular'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title">Viewer</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'cesium'</span>;
<span class="code-highlight"><strong class="hljs-keyword-slc">import</strong><strong class="hljs-slc"> { </strong><strong class="hljs-title-slc">CesiumService</strong><strong class="hljs-slc"> } </strong><strong class="hljs-keyword-slc">from</strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc">'../cesium.service'</strong><strong class="hljs-slc">;</strong></span>
<span class="hljs-meta">@Component</span>({
  <span class="hljs-attr">selector</span>: <span class="hljs-string">'app-view'</span>,
  <span class="hljs-attr">templateUrl</span>: <span class="hljs-string">'./view.page.html'</span>,
  <span class="hljs-attr">styleUrls</span>: [<span class="hljs-string">'./view.page.scss'</span>],
  <span class="hljs-attr">standalone</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">imports</span>: [<span class="hljs-title">IonicModule</span>, <span class="hljs-title">CommonModule</span>, <span class="hljs-title">FormsModule</span>]
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ViewPage</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">OnInit</span>, <span class="hljs-title">AfterViewInit</span> {
  <span class="hljs-meta">@ViewChild</span>(<span class="hljs-string">'mapContainer'</span>) <span class="hljs-attr">content</span>: <span class="hljs-title">ElementRef</span> | <span class="hljs-literal">undefined</span>;
  <span class="hljs-title">constructor</span>(<span class="code-highlight"><strong class="hljs-keyword-slc">private</strong><strong class="hljs-params-slc"> cesiumService: CesiumService</strong></span>) { }
  <span class="hljs-title">ngOnInit</span>() {
  }
  <span class="hljs-title">ngAfterViewInit</span>() {
    <span class="hljs-keyword">const</span> viewer = <span class="hljs-keyword">new</span> <span class="hljs-title">Viewer</span>(<span class="hljs-variable">this</span>.<span class="hljs-property">content</span>?.<span class="hljs-property">nativeElement</span>);
  }
}
</code></pre>
      </li>
      <li class="numberedList">Modify the <code class="inlineCode">ngAfterViewInit</code> method to register the viewer and add the photos:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-title">ngAfterViewInit</span>() {
<span class="code-highlight"><strong class="hljs-slc">  </strong><strong class="hljs-variable-slc">this</strong><strong class="hljs-slc">.</strong><strong class="hljs-property-slc">cesiumService</strong><strong class="hljs-slc">.</strong><strong class="hljs-title-slc">register</strong><strong class="hljs-slc">(</strong><strong class="hljs-keyword-slc">new</strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc">Viewer</strong><strong class="hljs-slc">(</strong><strong class="hljs-variable-slc">this</strong><strong class="hljs-slc">.</strong><strong class="hljs-property-slc">content</strong><strong class="hljs-slc">?.</strong><strong class="hljs-property-slc">nativeElement</strong><strong class="hljs-slc">));</strong></span>
<span class="code-highlight"><strong class="hljs-slc">  </strong><strong class="hljs-variable-slc">this</strong><strong class="hljs-slc">.</strong><strong class="hljs-property-slc">cesiumService</strong><strong class="hljs-slc">.</strong><strong class="hljs-title-slc">addPhotos</strong><strong class="hljs-slc">();</strong></span>
}
</code></pre>
      </li>
    </ol>
    <p class="normal">We are now<a id="_idIndexMarker363"/> ready to view our photos on the map:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Run the application using the <code class="inlineCode">ionic serve</code> command.</li>
      <li class="numberedList">Use the application to take nice photos, preferably in different locations.</li>
      <li class="numberedList">Select the <strong class="screenText">View gallery</strong> option from the main menu, and you should get an output like the following:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18465_06_14.png" alt="Figure 6.22 – Photos on the map"/></figure>
    <p class="packt_figref">Figure 6.14 – Photos on the map</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="4">Click on <a id="_idIndexMarker364"/>one of the pins on the map, and you should see your photo:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18465_06_15.png" alt="Figure 6.23 – Photo display"/></figure>
    <p class="packt_figref">Figure 6.15 – Photo display</p>
    <p class="normal">We now have a<a id="_idIndexMarker365"/> complete mobile application for taking geotagged photos and displaying them on a map. We saw how to set up the CesiumJS library and get our photos from Cloud Firestore. The API of the CesiumJS viewer provided us with an easy way to visualize our photos on the map and interact with them.</p>
    <h1 id="_idParaDest-115" class="heading-1">Summary</h1>
    <p class="normal">In this chapter, we built a mobile application for taking photos, tagging them with the current location, and displaying them on a 3D map. Initially, we learned how to create a new mobile application using the Ionic framework. We built the application locally and integrated Capacitor to interact with the camera and the GPS device. The camera was used to take photos, and the GPS to mark them with the location.</p>
    <p class="normal">Later on, we used Firebase services to store our photo files and data in the cloud. Finally, we learned how to retrieve the stored photos from Firebase and display them on a 3D globe using the CesiumJS library.</p>
    <p class="normal">In the next chapter, we will investigate another way to prerender content in Angular. We will use server-side rendering techniques to create a GitHub portfolio website.</p>
    <h1 id="_idParaDest-116" class="heading-1">Practice questions</h1>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Which toolkit can we use to create a UI in a Capacitor application?</li>
      <li class="numberedList">Which method do we use to take photos with the camera in a Capacitor application?</li>
      <li class="numberedList">How do we read the current location in a Capacitor application?</li>
      <li class="numberedList">How do we add a menu toggle button with Ionic?</li>
      <li class="numberedList">Which Capacitor command do we use to sync the application bundle with native mobile projects?</li>
      <li class="numberedList">What is the difference between test and production modes in Cloud Firestore?</li>
      <li class="numberedList">How do we initialize an application with the AngularFire library?</li>
      <li class="numberedList">Which method do we use to fetch data from a Cloud Firestore collection?</li>
      <li class="numberedList">How do we create a pin using the CesiumJS library?</li>
      <li class="numberedList">How do we convert latitude and longitude to degrees using CesiumJS?</li>
    </ol>
    <h1 id="_idParaDest-117" class="heading-1">Further reading</h1>
    <ul>
      <li class="bulletList">Getting started with Capacitor: <a href="https://capacitorjs.com/docs/getting-started"><span class="url">https://capacitorjs.com/docs/getting-started</span></a></li>
      <li class="bulletList">Android getting started guide for Capacitor: <a href="https://capacitorjs.com/docs/android#getting-started"><span class="url">https://capacitorjs.com/docs/android#getting-started</span></a></li>
      <li class="bulletList">iOS getting started guide for Capacitor: <a href="https://capacitorjs.com/docs/ios#getting-started "><span class="url">https://capacitorjs.com/docs/ios#getting-started</span></a></li>
      <li class="bulletList">Angular development with Ionic: <a href="https://ionicframework.com/docs/angular/overview"><span class="url">https://ionicframework.com/docs/angular/overview</span></a></li>
      <li class="bulletList">AngularFire library documentation: <a href="https://firebaseopensource.com/projects/angular/angularfire2"><span class="url">https://firebaseopensource.com/projects/angular/angularfire2</span></a></li>
      <li class="bulletList">CesiumJS quick start guide: <a href="https://cesium.com/docs/tutorials/quick-start"><span class="url">https://cesium.com/docs/tutorials/quick-start</span></a></li>
      <li class="bulletList">CesiumJS and Angular article: <a href="https://cesium.com/blog/2018/03/12/cesium-and-angular"><span class="url">https://cesium.com/blog/2018/03/12/cesium-and-angular</span></a></li>
    </ul>
    <h1 id="_idParaDest-118" class="heading-1">Join our community on Discord</h1>
    <p class="normal">Join our community’s Discord space for discussions with the author and other readers:</p>
    <p class="normal"><a href="https://packt.link/AngularProjects3e"><span class="url">https://packt.link/AngularProjects3e</span></a></p>
    <p class="normal"><span class="url"><img src="../Images/QR_Code89405936498927781.png" alt=""/></span></p>
  </div>
</body></html>