<html><head></head><body>
<div class="Basic-Text-Frame" id="_idContainer119">
<h1 class="chapterNumber"><span class="koboSpan" id="kobo.1.1">6</span></h1>
<h1 class="chapterTitle" id="_idParaDest-200"><span class="koboSpan" id="kobo.2.1">Reactive State Management with NgRx</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.3.1">Angular and </span><strong class="keyWord"><span class="koboSpan" id="kobo.4.1">reactive programming</span></strong><span class="koboSpan" id="kobo.5.1"> are best buddies, and handling an app’s state reactively is one of the best things</span><a id="_idIndexMarker347"/><span class="koboSpan" id="kobo.6.1"> you can do with your app. </span><strong class="keyWord"><span class="koboSpan" id="kobo.7.1">NgRx</span></strong><span class="koboSpan" id="kobo.8.1"> (short for</span><strong class="keyWord"><span class="koboSpan" id="kobo.9.1"> Angular Reactive Extensions</span></strong><span class="koboSpan" id="kobo.10.1">) is a framework that provides a set of libraries as reactive extensions</span><a id="_idIndexMarker348"/><span class="koboSpan" id="kobo.11.1"> for Angular. </span><span class="koboSpan" id="kobo.11.2">In this chapter, you’ll learn how</span><a id="_idIndexMarker349"/><span class="koboSpan" id="kobo.12.1"> to use the NgRx ecosystem to manage your app’s state reactively, and you’ll also learn about a couple of cool things the NgRx ecosystem will help you with.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.13.1">Here are the recipes we’re going to cover in this chapter:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.14.1">Creating your first NgRx store with actions and reducers</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.15.1">Using NgRx Store Devtools to debug state changes</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.16.1">Using NgRx selectors to select and render state in components</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.17.1">Using NgRx effects to fetch data from API calls</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.18.1">Using NgRx Component Store to manage the state of a component</span></li>
</ul>
<h1 class="heading-1" id="_idParaDest-201"><span class="koboSpan" id="kobo.19.1">Technical requirements</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.20.1">For the recipes in this chapter, ensure your setup is complete as per the 'Technical Requirements' in the 'Angular-Cookbook-2E' GitHub repository. </span><span class="koboSpan" id="kobo.20.2">For setup details, visit: </span><a href="https://github.com/PacktPublishing/Angular-Cookbook-2E/tree/main/docs/technical-requirements.md"><span class="url"><span class="koboSpan" id="kobo.21.1">https://github.com/PacktPublishing/Angular-Cookbook-2E/tree/main/docs/technical-requirements.md</span></span></a><span class="koboSpan" id="kobo.22.1">. </span><span class="koboSpan" id="kobo.22.2">The starter code for this chapter is located at </span><a href="https://github.com/PacktPublishing/Angular-Cookbook-2E/tree/main/start/apps/chapter06"><span class="url"><span class="koboSpan" id="kobo.23.1">https://github.com/PacktPublishing/Angular-Cookbook-2E/tree/main/start/apps/chapter06</span></span></a><span class="koboSpan" id="kobo.24.1">.</span></p>
<h1 class="heading-1" id="_idParaDest-202"><span class="koboSpan" id="kobo.25.1">Creating your first NgRx store with actions and reducers</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.26.1">In this recipe, you’ll work your way through</span><a id="_idIndexMarker350"/><span class="koboSpan" id="kobo.27.1"> understanding NgRx’s basics by setting up your first NgRx store. </span><span class="koboSpan" id="kobo.27.2">You’ll also</span><a id="_idIndexMarker351"/><span class="koboSpan" id="kobo.28.1"> create some actions, along</span><a id="_idIndexMarker352"/><span class="koboSpan" id="kobo.29.1"> with a reducer, and to see</span><a id="_idIndexMarker353"/><span class="koboSpan" id="kobo.30.1"> the changes in the reducer, we’ll be putting in appropriate console logs.</span></p>
<h2 class="heading-2" id="_idParaDest-203"><span class="koboSpan" id="kobo.31.1">Getting ready</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.32.1">The app that we are going to work with resides in </span><code class="inlineCode"><span class="koboSpan" id="kobo.33.1">start/apps/chapter06/ngrx-actions-reducer</span></code><span class="koboSpan" id="kobo.34.1"> inside the cloned repository:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.35.1">Open the code repository in your code editor.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.36.1">Open the terminal, navigate to the code repository directory, and run the following command to serve the project:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.37.1">npm run serve ngrx-actions-reducer
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.38.1">This should open the app in a new browser tab. </span><span class="koboSpan" id="kobo.38.2">If you add a couple of items, you should see the following:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.39.1"><img alt="" role="presentation" src="../Images/B18469_06_01.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.40.1">Figure 6.1: ngrx-actions-reducers app running on http://localhost:4200</span></p></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.41.1">Now that we have the app running, we’ll move on to the steps for the recipe.</span></p>
<h2 class="heading-2" id="_idParaDest-204"><span class="koboSpan" id="kobo.42.1">How to do it…</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.43.1">We have an Angular application</span><a id="_idIndexMarker354"/><span class="koboSpan" id="kobo.44.1"> with a single page containing a bucket. </span><span class="koboSpan" id="kobo.44.2">You can</span><a id="_idIndexMarker355"/><span class="koboSpan" id="kobo.45.1"> add fruits to your bucket and remove items</span><a id="_idIndexMarker356"/><span class="koboSpan" id="kobo.46.1"> from the bucket. </span><span class="koboSpan" id="kobo.46.2">We already have </span><a id="_idIndexMarker357"/><span class="koboSpan" id="kobo.47.1">the </span><code class="inlineCode"><span class="koboSpan" id="kobo.48.1">@ngrx/store</span></code><span class="koboSpan" id="kobo.49.1"> package installed in the workspace, so you don’t have to install it. </span><span class="koboSpan" id="kobo.49.2">However, when you work on a standalone app (or on some of your own projects), you would start by adding NgRx and running the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.50.1">npm install @ngrx/store
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.51.1">Update the </span><code class="inlineCode"><span class="koboSpan" id="kobo.52.1">app.config.ts</span></code><span class="koboSpan" id="kobo.53.1"> file to provide the NgRx store as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.54.1">...
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.55.1">import</span></span><span class="koboSpan" id="kobo.56.1"> { provideStore } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.57.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.58.1">'@ngrx/store'</span></span><span class="koboSpan" id="kobo.59.1">;
...
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.60.1">import</span></span><span class="koboSpan" id="kobo.61.1"> { provideAnimations } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.62.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.63.1">'@angular/platform-browser/animations'</span></span><span class="koboSpan" id="kobo.64.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.65.1">import</span></span><span class="koboSpan" id="kobo.66.1"> { provideStore } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.67.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.68.1">'@ngrx/store'</span></span><span class="koboSpan" id="kobo.69.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.70.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.71.1">const</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.72.1">appConfig</span></span><span class="koboSpan" id="kobo.73.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.74.1">ApplicationConfig</span></span><span class="koboSpan" id="kobo.75.1"> = {
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.76.1">providers</span></span><span class="koboSpan" id="kobo.77.1">: [
    ...,
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.78.1">provideAnimations</span></span><span class="koboSpan" id="kobo.79.1">(),
    </span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.80.1">provideStore</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.81.1">({}),</span></strong></span><span class="koboSpan" id="kobo.82.1">
  ],
};
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.83.1">Notice that we’ve passed an empty object </span><code class="inlineCode"><span class="koboSpan" id="kobo.84.1">{}</span></code><span class="koboSpan" id="kobo.85.1"> to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.86.1">provideStore()</span></code><span class="koboSpan" id="kobo.87.1"> method; we’ll change that going forward.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.88.1">Now, we’ll create some actions. </span><span class="koboSpan" id="kobo.88.2">Create a folder named </span><code class="inlineCode"><span class="koboSpan" id="kobo.89.1">store</span></code><span class="koboSpan" id="kobo.90.1"> inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.91.1">app</span></code><span class="koboSpan" id="kobo.92.1"> folder. </span><span class="koboSpan" id="kobo.92.2">Then, create a file named </span><code class="inlineCode"><span class="koboSpan" id="kobo.93.1">bucket.actions.ts</span></code><span class="koboSpan" id="kobo.94.1"> inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.95.1">store</span></code><span class="koboSpan" id="kobo.96.1"> folder, and finally, add the following code to the newly created file:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.97.1">import</span></span><span class="koboSpan" id="kobo.98.1"> { createActionGroup, props } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.99.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.100.1">'@ngrx/store'</span></span><span class="koboSpan" id="kobo.101.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.102.1">import</span></span><span class="koboSpan" id="kobo.103.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.104.1">IFruit</span></span><span class="koboSpan" id="kobo.105.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.106.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.107.1">'../interfaces/fruit.interface'</span></span><span class="koboSpan" id="kobo.108.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.109.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.110.1">const</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.111.1">BucketActions</span></span><span class="koboSpan" id="kobo.112.1"> = </span><span class="hljs-title"><span class="koboSpan" id="kobo.113.1">createActionGroup</span></span><span class="koboSpan" id="kobo.114.1">({
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.115.1">source</span></span><span class="koboSpan" id="kobo.116.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.117.1">'Bucket'</span></span><span class="koboSpan" id="kobo.118.1">,
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.119.1">events</span></span><span class="koboSpan" id="kobo.120.1">: {
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.121.1">'Add Fruit'</span></span><span class="koboSpan" id="kobo.122.1">: props&lt;{ </span><span class="hljs-attr"><span class="koboSpan" id="kobo.123.1">fruit</span></span><span class="koboSpan" id="kobo.124.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.125.1">IFruit</span></span><span class="koboSpan" id="kobo.126.1"> }&gt;(),
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.127.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.128.1">Remove Fruit'</span></span><span class="koboSpan" id="kobo.129.1">: props&lt;{ </span><span class="hljs-attr"><span class="koboSpan" id="kobo.130.1">fruitId</span></span><span class="koboSpan" id="kobo.131.1">: </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.132.1">number</span></span><span class="koboSpan" id="kobo.133.1"> }&gt;(),
  },
});
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.134.1">Since we have the actions in place now, we must create a reducer.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.135.1">Create a new file inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.136.1">store</span></code><span class="koboSpan" id="kobo.137.1"> folder, name it </span><code class="inlineCode"><span class="koboSpan" id="kobo.138.1">bucket.reducer.ts</span></code><span class="koboSpan" id="kobo.139.1">, and add the following code to it to define the necessary imports and the initial state:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.140.1">import</span></span><span class="koboSpan" id="kobo.141.1"> { createReducer, on } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.142.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.143.1">'@ngrx/store'</span></span><span class="koboSpan" id="kobo.144.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.145.1">import</span></span><span class="koboSpan" id="kobo.146.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.147.1">IFruit</span></span><span class="koboSpan" id="kobo.148.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.149.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.150.1">'../interfaces/fruit.interface'</span></span><span class="koboSpan" id="kobo.151.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.152.1">import</span></span><span class="koboSpan" id="kobo.153.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.154.1">BucketActions</span></span><span class="koboSpan" id="kobo.155.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.156.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.157.1">'./bucket.actions'</span></span><span class="koboSpan" id="kobo.158.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.159.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.160.1">const</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.161.1">initialState</span></span><span class="koboSpan" id="kobo.162.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.163.1">ReadonlyArray</span></span><span class="koboSpan" id="kobo.164.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.165.1">IFruit</span></span><span class="koboSpan" id="kobo.166.1">&gt; = [];
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.167.1">Now we’ll</span><a id="_idIndexMarker358"/><span class="koboSpan" id="kobo.168.1"> define</span><a id="_idIndexMarker359"/><span class="koboSpan" id="kobo.169.1"> the reducer. </span><span class="koboSpan" id="kobo.169.2">Add</span><a id="_idIndexMarker360"/><span class="koboSpan" id="kobo.170.1"> the following code</span><a id="_idIndexMarker361"/><span class="koboSpan" id="kobo.171.1"> to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.172.1">bucket.reducer.ts</span></code><span class="koboSpan" id="kobo.173.1"> file:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.174.1">...
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.175.1">export</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.176.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.177.1"> bucketReducer = </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.178.1">createReducer</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.179.1">(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.180.1">initialState,</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.181.1">on</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.182.1">(</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.183.1">BucketActions</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.184.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.185.1">addFruit</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.186.1">, </span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.187.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.188.1">_state, { fruit }</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.189.1">) =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.190.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.191.1">console</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.192.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.193.1">log</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.194.1">({ fruit });</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.195.1">return</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.196.1"> [fruit, ..._state];</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.197.1">}),</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.198.1">on</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.199.1">(</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.200.1">BucketActions</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.201.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.202.1">removeFruit</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.203.1">, </span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.204.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.205.1">_state, { fruitId }</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.206.1">) =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.207.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.208.1">console</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.209.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.210.1">log</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.211.1">({ fruitId });</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.212.1">return</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.213.1"> _state.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.214.1">filter</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.215.1">(</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.216.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.217.1">fr</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.218.1">) =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.219.1"> fr.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.220.1">id</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.221.1"> === fruitId);</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.222.1">})</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.223.1">);</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.224.1">Next, we’ll update the </span><code class="inlineCode"><span class="koboSpan" id="kobo.225.1">app.config.ts</span></code><span class="koboSpan" id="kobo.226.1"> file to use the reducer we just created. </span><span class="koboSpan" id="kobo.226.2">Update the file as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.227.1">...
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.228.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.229.1"> { bucketReducer } </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.230.1">from</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.231.1">'./app/store/bucket.reducer'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.232.1">;</span></strong></span>
<span class="hljs-title"><span class="koboSpan" id="kobo.233.1">bootstrapApplication</span></span><span class="koboSpan" id="kobo.234.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.235.1">AppComponent</span></span><span class="koboSpan" id="kobo.236.1">, {
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.237.1">providers</span></span><span class="koboSpan" id="kobo.238.1">: [
    ...,
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.239.1">provideStore</span></span><span class="koboSpan" id="kobo.240.1">(</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.241.1">{</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.242.1">bucket</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.243.1">: bucketReducer,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.244.1">}</span></strong></span><span class="koboSpan" id="kobo.245.1">),
  ],
}).</span><span class="hljs-title"><span class="koboSpan" id="kobo.246.1">catch</span></span><span class="koboSpan" id="kobo.247.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.248.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.249.1">err</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.250.1">) =&gt;</span></span> <span class="hljs-variable"><span class="koboSpan" id="kobo.251.1">console</span></span><span class="koboSpan" id="kobo.252.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.253.1">error</span></span><span class="koboSpan" id="kobo.254.1">(err));
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.255.1">Now we will use the actions we created to see the console logs from the reducer functions. </span><span class="koboSpan" id="kobo.255.2">Update the </span><code class="inlineCode"><span class="koboSpan" id="kobo.256.1">bucket.component.ts</span></code><span class="koboSpan" id="kobo.257.1"> file to first use the NgRx store as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.258.1">...
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.259.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.260.1"> { </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.261.1">StoreModule</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.262.1">, </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.263.1">Store</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.264.1"> } </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.265.1">from</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.266.1">'@ngrx/store'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.267.1">;</span></strong></span>
<span class="hljs-meta"><span class="koboSpan" id="kobo.268.1">@Component</span></span><span class="koboSpan" id="kobo.269.1">({
  ...,
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.270.1">imports</span></span><span class="koboSpan" id="kobo.271.1">: [</span><span class="hljs-title"><span class="koboSpan" id="kobo.272.1">CommonModule</span></span><span class="koboSpan" id="kobo.273.1">, </span><span class="hljs-title"><span class="koboSpan" id="kobo.274.1">FormsModule</span></span><span class="koboSpan" id="kobo.275.1">, </span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.276.1">StoreModule</span></strong></span><span class="koboSpan" id="kobo.277.1">],
})
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.278.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.279.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.280.1">BucketComponent</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.281.1">implements</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.282.1">OnInit</span></span><span class="koboSpan" id="kobo.283.1"> {
  ...
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.284.1">fruits</span></span><span class="koboSpan" id="kobo.285.1">: </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.286.1">string</span></span><span class="koboSpan" id="kobo.287.1">[] = </span><span class="hljs-title"><span class="koboSpan" id="kobo.288.1">Object</span></span><span class="koboSpan" id="kobo.289.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.290.1">values</span></span><span class="koboSpan" id="kobo.291.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.292.1">Fruit</span></span><span class="koboSpan" id="kobo.293.1">);
  </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.294.1">store = </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.295.1">inject</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.296.1">(</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.297.1">Store</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.298.1">);</span></strong></span><span class="koboSpan" id="kobo.299.1">
  ...
</span><span class="koboSpan" id="kobo.299.2">}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.300.1">Let’s dispatch actions to the store</span><a id="_idIndexMarker362"/><span class="koboSpan" id="kobo.301.1"> for when we’re adding fruits to and removing</span><a id="_idIndexMarker363"/><span class="koboSpan" id="kobo.302.1"> fruits from the bucket. </span><span class="koboSpan" id="kobo.302.2">We’ll also modify</span><a id="_idIndexMarker364"/><span class="koboSpan" id="kobo.303.1"> the code a bit to avoid repetition. </span><span class="koboSpan" id="kobo.303.2">Update</span><a id="_idIndexMarker365"/><span class="koboSpan" id="kobo.304.1"> the </span><code class="inlineCode"><span class="koboSpan" id="kobo.305.1">bucket.component.ts</span></code><span class="koboSpan" id="kobo.306.1"> file as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.307.1">...
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.308.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.309.1"> { </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.310.1">BucketActions</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.311.1"> } </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.312.1">from</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.313.1">'../store/bucket.actions'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.314.1">;</span></strong></span><span class="koboSpan" id="kobo.315.1">
...
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.316.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.317.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.318.1">BucketComponent</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.319.1">implements</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.320.1">OnInit</span></span><span class="koboSpan" id="kobo.321.1"> {
  ...
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.322.1">addSelectedFruitToBucket</span></span><span class="koboSpan" id="kobo.323.1">() {
    </span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.324.1">const</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.325.1">newFruit</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.326.1">: </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.327.1">IFruit</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.328.1"> = {</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.329.1">id</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.330.1">: </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.331.1">Date</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.332.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.333.1">now</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.334.1">(),</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.335.1">name</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.336.1">: </span></strong><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.337.1">this</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.338.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.339.1">selectedFruit</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.340.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.341.1">};</span></strong></span>
<span class="code-highlight"><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.342.1">this</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.343.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.344.1">store</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.345.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.346.1">dispatch</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.347.1">(</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.348.1">BucketActions</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.349.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.350.1">addFruit</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.351.1">({</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.352.1">fruit</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.353.1">: newFruit,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.354.1">})</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.355.1">);</span></strong></span>
<span class="hljs-variable"><span class="koboSpan" id="kobo.356.1">this</span></span><span class="koboSpan" id="kobo.357.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.358.1">bucketService</span></span><span class="koboSpan" id="kobo.359.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.360.1">addItem</span></span><span class="koboSpan" id="kobo.361.1">(</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.362.1">newFruit</span></strong></span><span class="koboSpan" id="kobo.363.1">);
  }
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.364.1">deleteFromBucket</span></span><span class="koboSpan" id="kobo.365.1">(</span><span class="hljs-attr"><span class="koboSpan" id="kobo.366.1">fruit</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.367.1">: </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.368.1">IFruit</span></span><span class="koboSpan" id="kobo.369.1">) {
    </span><span class="code-highlight"><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.370.1">this</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.371.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.372.1">store</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.373.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.374.1">dispatch</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.375.1">(</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.376.1">BucketActions</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.377.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.378.1">removeFruit</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.379.1">({</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.380.1">fruitId</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.381.1">: fruit.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.382.1">id</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.383.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.384.1">})</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.385.1">);</span></strong></span>
<span class="hljs-variable"><span class="koboSpan" id="kobo.386.1">this</span></span><span class="koboSpan" id="kobo.387.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.388.1">bucketService</span></span><span class="koboSpan" id="kobo.389.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.390.1">removeItem</span></span><span class="koboSpan" id="kobo.391.1">(fruit);
  }
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.392.1">Now if you add or remove items from the bucket, you’re going to see the logs on the console, as follows in </span><em class="italic"><span class="koboSpan" id="kobo.393.1">Figure 6.2</span></em><span class="koboSpan" id="kobo.394.1">, which means our actions and reducer are working:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.395.1"><img alt="" role="presentation" src="../Images/B18469_06_02.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.396.1">Figure 6.2: Logs showing the actions for adding and removing items from a bucket</span></p>
<p class="normal"><span class="koboSpan" id="kobo.397.1">And that covers it all for this recipe! </span><span class="koboSpan" id="kobo.397.2">You are now able</span><a id="_idIndexMarker366"/><span class="koboSpan" id="kobo.398.1"> to integrate an NgRx store</span><a id="_idIndexMarker367"/><span class="koboSpan" id="kobo.399.1"> into an Angular app, create NgRx actions, and</span><a id="_idIndexMarker368"/><span class="koboSpan" id="kobo.400.1"> dispatch those actions. </span><span class="koboSpan" id="kobo.400.2">You’re also</span><a id="_idIndexMarker369"/><span class="koboSpan" id="kobo.401.1"> able to create a reducer, define its state, and listen to actions to act on them.</span></p>
<h2 class="heading-2" id="_idParaDest-205"><span class="koboSpan" id="kobo.402.1">See also</span></h2>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.403.1">NgRx store</span><a id="_idIndexMarker370"/><span class="koboSpan" id="kobo.404.1"> walkthrough tutorial (</span><a href="https://ngrx.io/guide/store/walkthrough"><span class="url"><span class="koboSpan" id="kobo.405.1">https://ngrx.io/guide/store/walkthrough</span></span></a><span class="koboSpan" id="kobo.406.1">)</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.407.1">NgRx reducers</span><a id="_idIndexMarker371"/><span class="koboSpan" id="kobo.408.1"> documentation (</span><a href="https://ngrx.io/guide/store/reducers"><span class="url"><span class="koboSpan" id="kobo.409.1">https://ngrx.io/guide/store/reducers</span></span></a><span class="koboSpan" id="kobo.410.1">)</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.411.1">NgRx actions</span><a id="_idIndexMarker372"/><span class="koboSpan" id="kobo.412.1"> documentation (</span><a href="https://ngrx.io/guide/store/actions"><span class="url"><span class="koboSpan" id="kobo.413.1">https://ngrx.io/guide/store/actions</span></span></a><span class="koboSpan" id="kobo.414.1">)</span></li>
</ul>
<h1 class="heading-1" id="_idParaDest-206"><span class="koboSpan" id="kobo.415.1">Using NgRx Store Devtools to debug state changes</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.416.1">In this recipe, you’ll learn</span><a id="_idIndexMarker373"/><span class="koboSpan" id="kobo.417.1"> how to use </span><code class="inlineCode"><span class="koboSpan" id="kobo.418.1">@ngrx/store-devtools</span></code><span class="koboSpan" id="kobo.419.1"> to debug</span><a id="_idIndexMarker374"/><span class="koboSpan" id="kobo.420.1"> your app’s state, the dispatched actions, and the difference in the state when the actions are dispatched. </span><span class="koboSpan" id="kobo.420.2">We’ll be using an existing app we’re familiar with to learn about the process.</span></p>
<h2 class="heading-2" id="_idParaDest-207"><span class="koboSpan" id="kobo.421.1">Getting ready</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.422.1">The app that we are going to work with resides in </span><code class="inlineCode"><span class="koboSpan" id="kobo.423.1">start/apps/chapter06/ngrx-devtools</span></code><span class="koboSpan" id="kobo.424.1"> inside the cloned repository:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.425.1">Open the code repository in your code editor.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.426.1">Open the terminal, navigate to the code repository directory, and run the following command to serve the project:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.427.1">npm run serve ngrx-devtools
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.428.1">This should open the app in a new browser tab. </span><span class="koboSpan" id="kobo.428.2">If you add a couple of items, you should see the following:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.429.1"><img alt="" role="presentation" src="../Images/B18469_06_03.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.430.1">Figure 6.3: Using the ngrx-devtools app running on http://localhost:4200</span></p></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.431.1">Now that we have the app set up, let’s see the steps of the recipe in the next section.</span></p>
<h2 class="heading-2" id="_idParaDest-208"><span class="koboSpan" id="kobo.432.1">How to do it…</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.433.1">We have an Angular app</span><a id="_idIndexMarker375"/><span class="koboSpan" id="kobo.434.1"> that already has the </span><code class="inlineCode"><span class="koboSpan" id="kobo.435.1">@ngrx/store</span></code><span class="koboSpan" id="kobo.436.1"> package</span><a id="_idIndexMarker376"/><span class="koboSpan" id="kobo.437.1"> integrated. </span><span class="koboSpan" id="kobo.437.2">We also have a reducer set up and some actions in place that are logged on the console as soon as you add or remove an item. </span><span class="koboSpan" id="kobo.437.3">We already have the </span><code class="inlineCode"><span class="koboSpan" id="kobo.438.1">@ngrx/store-devtools</span></code><span class="koboSpan" id="kobo.439.1"> package installed in the workspace, so you don’t have to install it. </span><span class="koboSpan" id="kobo.439.2">However, when you work on a standalone app (or on some of your own projects), you would start by adding NgRx store </span><code class="inlineCode"><span class="koboSpan" id="kobo.440.1">devtools</span></code><span class="koboSpan" id="kobo.441.1"> and running the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.442.1">npm install @ngrx/store-devtools
</span></code></pre>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.443.1">First, update your </span><code class="inlineCode"><span class="koboSpan" id="kobo.444.1">app.config.ts</span></code><span class="koboSpan" id="kobo.445.1"> file to include a </span><code class="inlineCode"><span class="koboSpan" id="kobo.446.1">StoreDevtoolsModule.instrument</span></code><span class="koboSpan" id="kobo.447.1"> entry, as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.448.1">...
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.449.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.450.1"> { provideStoreDevtools } </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.451.1">from</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.452.1">'@ngrx/store-devtools'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.453.1">;</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.454.1">import</span></span><span class="koboSpan" id="kobo.455.1"> { bucketReducer } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.456.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.457.1">'./app/store/bucket.reducer'</span></span><span class="koboSpan" id="kobo.458.1">;
</span><span class="hljs-title"><span class="koboSpan" id="kobo.459.1">bootstrapApplication</span></span><span class="koboSpan" id="kobo.460.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.461.1">AppComponent</span></span><span class="koboSpan" id="kobo.462.1">, {
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.463.1">providers</span></span><span class="koboSpan" id="kobo.464.1">: [
    ...,
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.465.1">provideStore</span></span><span class="koboSpan" id="kobo.466.1">({
      </span><span class="hljs-attr"><span class="koboSpan" id="kobo.467.1">bucket</span></span><span class="koboSpan" id="kobo.468.1">: bucketReducer,
    }),
    </span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.469.1">provideStoreDevtools</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.470.1">({</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.471.1">maxAge</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.472.1">: </span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.473.1">50</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.474.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.475.1">}),</span></strong></span><span class="koboSpan" id="kobo.476.1">
  ],
}).</span><span class="hljs-title"><span class="koboSpan" id="kobo.477.1">catch</span></span><span class="koboSpan" id="kobo.478.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.479.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.480.1">err</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.481.1">) =&gt;</span></span> <span class="hljs-variable"><span class="koboSpan" id="kobo.482.1">console</span></span><span class="koboSpan" id="kobo.483.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.484.1">error</span></span><span class="koboSpan" id="kobo.485.1">(err));
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.486.1">And now download the </span><strong class="screenText"><span class="koboSpan" id="kobo.487.1">Redux DevTools</span></strong><span class="koboSpan" id="kobo.488.1"> extension from </span><a href="https://github.com/zalmoxisus/redux-devtools-extension/"><span class="url"><span class="koboSpan" id="kobo.489.1">https://github.com/zalmoxisus/redux-devtools-extension/</span></span></a><span class="koboSpan" id="kobo.490.1"> for your browser and install it. </span><span class="koboSpan" id="kobo.490.2">I’ll be consistently using the Chrome browser in this book.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.491.1">Open </span><strong class="screenText"><span class="koboSpan" id="kobo.492.1">Chrome DevTools</span></strong><span class="koboSpan" id="kobo.493.1">. </span><span class="koboSpan" id="kobo.493.2">There should be a new tab named </span><strong class="screenText"><span class="koboSpan" id="kobo.494.1">Redux</span></strong><span class="koboSpan" id="kobo.495.1">. </span><span class="koboSpan" id="kobo.495.2">Tap it and refresh the page. </span><span class="koboSpan" id="kobo.495.3">You’ll see something like this:
    </span><figure class="mediaobject"><span class="koboSpan" id="kobo.496.1"><img alt="" role="presentation" src="../Images/B18469_06_04.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.497.1">Figure 6.4: Redux DevTools showing the initial Redux action dispatched</span></p></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="4"><span class="koboSpan" id="kobo.498.1">Remove all the fruits, add</span><a id="_idIndexMarker377"/><span class="koboSpan" id="kobo.499.1"> two cherries and </span><a id="_idIndexMarker378"/><span class="koboSpan" id="kobo.500.1">a banana to the bucket, and then remove the banana from the bucket. </span><span class="koboSpan" id="kobo.500.2">You should see all the relevant actions being dispatched along with the state as follows:
    </span><figure class="mediaobject"><span class="koboSpan" id="kobo.501.1"><img alt="" role="presentation" src="../Images/B18469_06_05.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.502.1">Figure 6.5: Redux DevTools showing bucket actions and state</span></p></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.503.1">Great! </span><span class="koboSpan" id="kobo.503.2">You’ve just learned how to use the Redux DevTools extension to see your NgRx state and the actions being dispatched.</span></p>
<h2 class="heading-2" id="_idParaDest-209"><span class="koboSpan" id="kobo.504.1">How it works…</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.505.1">It is important to understand that NgRx is a combination of Angular and RxJS, resulting in different patterns being implemented including Redux. </span><span class="koboSpan" id="kobo.505.2">By using the Store Devtools package and the Redux DevTools</span><a id="_idIndexMarker379"/><span class="koboSpan" id="kobo.506.1"> extension, we’re able to debug</span><a id="_idIndexMarker380"/><span class="koboSpan" id="kobo.507.1"> the app easily, which helps us find potential bugs, predict state changes, and be more transparent about what’s happening behind the scenes in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.508.1">@ngrx/store</span></code><span class="koboSpan" id="kobo.509.1"> package.</span></p>
<h2 class="heading-2" id="_idParaDest-210"><span class="koboSpan" id="kobo.510.1">There’s more…</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.511.1">You can also see the difference that an action caused within an app’s state, i.e., when we add an item to the bucket and we remove an item from the bucket. </span><span class="koboSpan" id="kobo.511.2">See </span><em class="italic"><span class="koboSpan" id="kobo.512.1">Figure 6.6</span></em><span class="koboSpan" id="kobo.513.1"> and </span><em class="italic"><span class="koboSpan" id="kobo.514.1">Figure 6.7</span></em><span class="koboSpan" id="kobo.515.1"> for each case respectively:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.516.1"><img alt="" role="presentation" src="../Images/B18469_06_06.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.517.1">Figure 6.6: Add Fruit action in Redux Devtools</span></p>
<p class="normal"><span class="koboSpan" id="kobo.518.1">Notice the green background around the bucket item in </span><em class="italic"><span class="koboSpan" id="kobo.519.1">Figure 6.6</span></em><span class="koboSpan" id="kobo.520.1">. </span><span class="koboSpan" id="kobo.520.2">This represents an addition to the state. </span><span class="koboSpan" id="kobo.520.3">You can see the </span><code class="inlineCode"><span class="koboSpan" id="kobo.521.1">ReemoveFruit</span></code><span class="koboSpan" id="kobo.522.1"> action in the following image:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.523.1"><img alt="" role="presentation" src="../Images/B18469_06_07.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.524.1">Figure 6.7: Remove Fruit action in Redux Devtools</span></p>
<p class="normal"><span class="koboSpan" id="kobo.525.1">Now notice the red background</span><a id="_idIndexMarker381"/><span class="koboSpan" id="kobo.526.1"> and a strikethrough</span><a id="_idIndexMarker382"/><span class="koboSpan" id="kobo.527.1"> of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.528.1">Diff</span></code><span class="koboSpan" id="kobo.529.1">. </span><span class="koboSpan" id="kobo.529.2">This represents removal from the state.</span></p>
<h2 class="heading-2" id="_idParaDest-211"><span class="koboSpan" id="kobo.530.1">See also</span></h2>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.531.1">NgRx Store Devtools</span><a id="_idIndexMarker383"/><span class="koboSpan" id="kobo.532.1"> documentation (</span><a href="https://ngrx.io/guide/store-devtools"><span class="url"><span class="koboSpan" id="kobo.533.1">https://ngrx.io/guide/store-devtools</span></span></a><span class="koboSpan" id="kobo.534.1">)</span></li>
</ul>
<h1 class="heading-1" id="_idParaDest-212"><span class="koboSpan" id="kobo.535.1">Using NgRx selectors to select and render state in components</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.536.1">In the previous recipes, we created</span><a id="_idIndexMarker384"/><span class="koboSpan" id="kobo.537.1"> some actions, a single</span><a id="_idIndexMarker385"/><span class="koboSpan" id="kobo.538.1"> reducer, and we integrated</span><a id="_idIndexMarker386"/><span class="koboSpan" id="kobo.539.1"> devtools to observe</span><a id="_idIndexMarker387"/><span class="koboSpan" id="kobo.540.1"> the state changes. </span><span class="koboSpan" id="kobo.540.2">However, our bucket application still renders the data using some variables in </span><code class="inlineCode"><span class="koboSpan" id="kobo.541.1">BucketService</span></code><span class="koboSpan" id="kobo.542.1">. </span><span class="koboSpan" id="kobo.542.2">In this recipe, we’re going all in with NgRx. </span><span class="koboSpan" id="kobo.542.3">We’re going to render the bucket items from the state as we already are saving them in the NgRx store.</span></p>
<h2 class="heading-2" id="_idParaDest-213"><span class="koboSpan" id="kobo.543.1">Getting ready</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.544.1">The app that we are going to work with resides in </span><code class="inlineCode"><span class="koboSpan" id="kobo.545.1">start/apps/chapter06/ngrx-selectors</span></code><span class="koboSpan" id="kobo.546.1"> inside the cloned repository:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.547.1">Open the code repository in your code editor.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.548.1">Open the terminal, navigate to the code repository directory, and run the following command to serve the project:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.549.1">npm run serve ngrx-selectors
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.550.1">This should open the app in a new browser tab, and you should see the following:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.551.1"><img alt="" role="presentation" src="../Images/B18469_06_08.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.552.1">Figure 6.8: Using the ngrx-selectors app running on http://localhost:4200</span></p> </li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.553.1">Now that we have the app</span><a id="_idIndexMarker388"/><span class="koboSpan" id="kobo.554.1"> running locally, let’s see the</span><a id="_idIndexMarker389"/><span class="koboSpan" id="kobo.555.1"> steps of the recipe</span><a id="_idIndexMarker390"/><span class="koboSpan" id="kobo.556.1"> in the next</span><a id="_idIndexMarker391"/><span class="koboSpan" id="kobo.557.1"> section.</span></p>
<h2 class="heading-2" id="_idParaDest-214"><span class="koboSpan" id="kobo.558.1">How to do it…</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.559.1">All we must do in this recipe is to work with NgRx selectors. </span><span class="koboSpan" id="kobo.559.2">The store, actions, and the reducer have already been set up. </span><em class="italic"><span class="koboSpan" id="kobo.560.1">Easy peasy</span></em><span class="koboSpan" id="kobo.561.1">! </span><span class="koboSpan" id="kobo.561.2">Let’s get started!</span></p>
<p class="normal"><span class="koboSpan" id="kobo.562.1">We’ll first show the fruits in our bucket on the </span><strong class="screenText"><span class="koboSpan" id="kobo.563.1">Home</span></strong><span class="koboSpan" id="kobo.564.1"> page and, to do that, we must create our first NgRx selector:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.565.1">Create a new file inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.566.1">store</span></code><span class="koboSpan" id="kobo.567.1"> folder. </span><span class="koboSpan" id="kobo.567.2">Name it </span><code class="inlineCode"><span class="koboSpan" id="kobo.568.1">bucket.selectors.ts</span></code><span class="koboSpan" id="kobo.569.1"> and add the following code to it:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.570.1">import</span></span><span class="koboSpan" id="kobo.571.1"> { createFeatureSelector } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.572.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.573.1">'@ngrx/store'</span></span><span class="koboSpan" id="kobo.574.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.575.1">import</span></span><span class="koboSpan" id="kobo.576.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.577.1">IFruit</span></span><span class="koboSpan" id="kobo.578.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.579.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.580.1">'../interfaces/fruit.interface'</span></span><span class="koboSpan" id="kobo.581.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.582.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.583.1">const</span></span><span class="koboSpan" id="kobo.584.1"> selectBucket =
createFeatureSelector&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.585.1">ReadonlyArray</span></span><span class="koboSpan" id="kobo.586.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.587.1">IFruit</span></span><span class="koboSpan" id="kobo.588.1">&gt;&gt;(</span><span class="hljs-string"><span class="koboSpan" id="kobo.589.1">'bucket'</span></span><span class="koboSpan" id="kobo.590.1">);
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.591.1">Now that we have the selector in place, let’s use it in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.592.1">BucketComponent</span></code><span class="koboSpan" id="kobo.593.1"> class.</span></p></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="2"><span class="koboSpan" id="kobo.594.1">Modify the </span><code class="inlineCode"><span class="koboSpan" id="kobo.595.1">bucket.component.ts</span></code><span class="koboSpan" id="kobo.596.1"> file as follows to reassign the </span><code class="inlineCode"><span class="koboSpan" id="kobo.597.1">$bucket</span></code><span class="koboSpan" id="kobo.598.1"> observable:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.599.1">...
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.600.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.601.1"> { selectBucket } </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.602.1">from</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.603.1">'../store/bucket.selectors'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.604.1">;</span></strong></span><span class="koboSpan" id="kobo.605.1">
      ...
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.606.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.607.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.608.1">BucketComponent</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.609.1">implements</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.610.1">OnInit</span></span><span class="koboSpan" id="kobo.611.1"> {
  ...
  </span><span class="koboSpan" id="kobo.611.2">store = </span><span class="hljs-title"><span class="koboSpan" id="kobo.612.1">inject</span></span><span class="koboSpan" id="kobo.613.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.614.1">Store</span></span><span class="koboSpan" id="kobo.615.1">);
  </span><span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.616.1">$bucket</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.617.1">: </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.618.1">Observable</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.619.1">&lt;</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.620.1">IFruit</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.621.1">[]&gt; = </span></strong><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.622.1">this</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.623.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.624.1">store</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.625.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.626.1">select</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.627.1">(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.628.1">selectBucket);</span></strong></span>
<span class="hljs-title"><span class="koboSpan" id="kobo.629.1">ngOnInit</span></span><span class="koboSpan" id="kobo.630.1">(): </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.631.1">void</span></span><span class="koboSpan" id="kobo.632.1"> {
    </span><span class="hljs-variable"><span class="koboSpan" id="kobo.633.1">this</span></span><span class="koboSpan" id="kobo.634.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.635.1">bucketService</span></span><span class="koboSpan" id="kobo.636.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.637.1">loadItems</span></span><span class="koboSpan" id="kobo.638.1">();
  }
  ...
</span><span class="koboSpan" id="kobo.638.2">}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.639.1">Refresh the app and try adding</span><a id="_idIndexMarker392"/><span class="koboSpan" id="kobo.640.1"> and removing items from the</span><a id="_idIndexMarker393"/><span class="koboSpan" id="kobo.641.1"> bucket. </span><span class="koboSpan" id="kobo.641.2">You</span><a id="_idIndexMarker394"/><span class="koboSpan" id="kobo.642.1"> can see that we still get the bucket items</span><a id="_idIndexMarker395"/><span class="koboSpan" id="kobo.643.1"> rendered. </span><span class="koboSpan" id="kobo.643.2">This time, it is from the NgRx store.</span></p> </li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="3"><span class="koboSpan" id="kobo.644.1">Now we can remove the extra code that was managing the state from </span><code class="inlineCode"><span class="koboSpan" id="kobo.645.1">BucketServic</span></code><span class="koboSpan" id="kobo.646.1">e. </span><span class="koboSpan" id="kobo.646.2">Update the </span><code class="inlineCode"><span class="koboSpan" id="kobo.647.1">BucketComponent</span></code><span class="koboSpan" id="kobo.648.1"> class in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.649.1">bucket.component.ts</span></code><span class="koboSpan" id="kobo.650.1"> file as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.651.1">//  remove the `implements onInit` below</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.652.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.653.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.654.1">BucketComponent</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.655.1">implements</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.656.1">OnInit</span></span><span class="koboSpan" id="kobo.657.1"> {
  </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.658.1">bucketService = </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.659.1">inject</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.660.1">(</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.661.1">BucketService</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.662.1">);</span></strong><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.663.1">// ← remove</span></strong></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.664.1">selectedFruit</span></span><span class="koboSpan" id="kobo.665.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.666.1">Fruit</span></span><span class="koboSpan" id="kobo.667.1"> = </span><span class="hljs-string"><span class="koboSpan" id="kobo.668.1">''</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.669.1">as</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.670.1">Fruit</span></span><span class="koboSpan" id="kobo.671.1">;
  ...
  </span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.672.1">ngOnInit</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.673.1">(): </span></strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.674.1">void</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.675.1"> {</span></strong><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.676.1">// ← remove this method</span></strong></span>
<span class="code-highlight"><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.677.1">this</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.678.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.679.1">bucketService</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.680.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.681.1">loadItems</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.682.1">();</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.683.1">}</span></strong></span>
<span class="hljs-title"><span class="koboSpan" id="kobo.684.1">addSelectedFruitToBucket</span></span><span class="koboSpan" id="kobo.685.1">() {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.686.1">const</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.687.1">newFruit</span></span><span class="koboSpan" id="kobo.688.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.689.1">IFruit</span></span><span class="koboSpan" id="kobo.690.1"> = {...};
    </span><span class="hljs-variable"><span class="koboSpan" id="kobo.691.1">this</span></span><span class="koboSpan" id="kobo.692.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.693.1">store</span></span><span class="koboSpan" id="kobo.694.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.695.1">dispatch</span></span><span class="koboSpan" id="kobo.696.1">(...);
    </span><span class="code-highlight"><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.697.1">this</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.698.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.699.1">bucketService</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.700.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.701.1">addItem</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.702.1">(newFruit);</span></strong><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.703.1">// ← remove</span></strong></span><span class="koboSpan" id="kobo.704.1">
  }
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.705.1">deleteFromBucket</span></span><span class="koboSpan" id="kobo.706.1">(</span><span class="hljs-attr"><span class="koboSpan" id="kobo.707.1">fruit</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.708.1">: </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.709.1">IFruit</span></span><span class="koboSpan" id="kobo.710.1">) {
    </span><span class="hljs-variable"><span class="koboSpan" id="kobo.711.1">this</span></span><span class="koboSpan" id="kobo.712.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.713.1">store</span></span><span class="koboSpan" id="kobo.714.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.715.1">dispatch</span></span><span class="koboSpan" id="kobo.716.1">(...);
    </span><span class="code-highlight"><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.717.1">this</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.718.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.719.1">bucketService</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.720.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.721.1">removeItem</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.722.1">(fruit);</span></strong><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.723.1">// ← remove</span></strong></span><span class="koboSpan" id="kobo.724.1">
  }
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.725.1">Once you’ve removed</span><a id="_idIndexMarker396"/><span class="koboSpan" id="kobo.726.1"> the code, make sure to remove</span><a id="_idIndexMarker397"/><span class="koboSpan" id="kobo.727.1"> unused </span><a id="_idIndexMarker398"/><span class="koboSpan" id="kobo.728.1">dependencies (imports) from the file as well. </span><span class="koboSpan" id="kobo.728.2">Try the app and you’ll see </span><a id="_idIndexMarker399"/><span class="koboSpan" id="kobo.729.1">it still works. </span><em class="italic"><span class="koboSpan" id="kobo.730.1">Yay!</span></em></p> </li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="4"><span class="koboSpan" id="kobo.731.1">Now we can update the </span><code class="inlineCode"><span class="koboSpan" id="kobo.732.1">bucket.service.ts</span></code><span class="koboSpan" id="kobo.733.1"> file to not keep the bucket items in </span><code class="inlineCode"><span class="koboSpan" id="kobo.734.1">BehaviorSubject</span></code><span class="koboSpan" id="kobo.735.1">. </span><span class="koboSpan" id="kobo.735.2">Update the file as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.736.1">...
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.737.1">import</span></span><span class="koboSpan" id="kobo.738.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.739.1">Injectable</span></span><span class="koboSpan" id="kobo.740.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.741.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.742.1">'@angular/core'</span></span><span class="koboSpan" id="kobo.743.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.744.1">import</span></span><span class="koboSpan" id="kobo.745.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.746.1">IFruit</span></span><span class="koboSpan" id="kobo.747.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.748.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.749.1">'../interfaces/fruit.interface'</span></span><span class="koboSpan" id="kobo.750.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.751.1">import</span></span><span class="koboSpan" id="kobo.752.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.753.1">IBucketService</span></span><span class="koboSpan" id="kobo.754.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.755.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.756.1">'../interfaces/bucket-service'</span></span><span class="koboSpan" id="kobo.757.1">;
</span><span class="hljs-meta"><span class="koboSpan" id="kobo.758.1">@Injectable</span></span><span class="koboSpan" id="kobo.759.1">({
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.760.1">providedIn</span></span><span class="koboSpan" id="kobo.761.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.762.1">'root'</span></span><span class="koboSpan" id="kobo.763.1">,
})
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.764.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.765.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.766.1">BucketService</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.767.1">implements</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.768.1">IBucketService</span></span><span class="koboSpan" id="kobo.769.1"> {
  </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.770.1">storeKey = </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.771.1">'bucket_ngrx-selectors'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.772.1">;</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.773.1">loadItems</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.774.1">() {</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.775.1">return</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.776.1">JSON</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.777.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.778.1">parse</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.779.1">(</span></strong><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.780.1">window</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.781.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.782.1">localStorage</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.783.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.784.1">getItem</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.785.1">(</span></strong></span>
<span class="code-highlight"><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.786.1">this</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.787.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.788.1">storeKey</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.789.1">) || </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.790.1">'[]'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.791.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.792.1">}</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.793.1">saveItems</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.794.1">(</span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.795.1">items</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.796.1">: </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.797.1">IFruit</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.798.1">[]</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.799.1">) {</span></strong></span>
<span class="code-highlight"><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.800.1">window</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.801.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.802.1">localStorage</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.803.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.804.1">setItem</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.805.1">(</span></strong></span>
<span class="code-highlight"><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.806.1">this</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.807.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.808.1">storeKey</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.809.1">, </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.810.1">JSON</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.811.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.812.1">stringify</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.813.1">(items));</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.814.1">r}</span></strong></span><span class="koboSpan" id="kobo.815.1">
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.816.1">Notice that we’ve removed the </span><code class="inlineCode"><span class="koboSpan" id="kobo.817.1">addItem</span></code><span class="koboSpan" id="kobo.818.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.819.1">removeItem</span></code><span class="koboSpan" id="kobo.820.1"> functions and added the </span><code class="inlineCode"><span class="koboSpan" id="kobo.821.1">saveItems</span></code><span class="koboSpan" id="kobo.822.1"> method.</span></p> </li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="5"><span class="koboSpan" id="kobo.823.1">You will see that TypeScript is angry. </span><span class="koboSpan" id="kobo.823.2">That’s because </span><code class="inlineCode"><span class="koboSpan" id="kobo.824.1">BucketService</span></code><span class="koboSpan" id="kobo.825.1"> doesn’t implement the </span><code class="inlineCode"><span class="koboSpan" id="kobo.826.1">IBucketService</span></code><span class="koboSpan" id="kobo.827.1"> interface anymore. </span><span class="koboSpan" id="kobo.827.2">Update the </span><code class="inlineCode"><span class="koboSpan" id="kobo.828.1">bucket-service.ts</span></code><span class="koboSpan" id="kobo.829.1"> file to update the interface as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.830.1">import</span></span><span class="koboSpan" id="kobo.831.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.832.1">IFruit</span></span><span class="koboSpan" id="kobo.833.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.834.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.835.1">'./fruit.interface'</span></span><span class="koboSpan" id="kobo.836.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.837.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.838.1">interface</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.839.1">IBucketService</span></span><span class="koboSpan" id="kobo.840.1"> {
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.841.1">loadItems</span></span><span class="koboSpan" id="kobo.842.1">(): </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.843.1">void</span></span><span class="koboSpan" id="kobo.844.1">;
  </span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.845.1">saveItems</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.846.1">(</span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.847.1">fruit</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.848.1">: </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.849.1">IFruit</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.850.1">[]): </span></strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.851.1">void</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.852.1">;</span></strong></span><span class="koboSpan" id="kobo.853.1">
}
</span></code></pre>
</li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.854.1">And that’s it! </span><span class="koboSpan" id="kobo.854.2">You’ve finished</span><a id="_idIndexMarker400"/><span class="koboSpan" id="kobo.855.1"> the recipe. </span><span class="koboSpan" id="kobo.855.2">You will notice that as soon </span><a id="_idIndexMarker401"/><span class="koboSpan" id="kobo.856.1">as we refresh the app, we lose</span><a id="_idIndexMarker402"/><span class="koboSpan" id="kobo.857.1"> the bucket</span><a id="_idIndexMarker403"/><span class="koboSpan" id="kobo.858.1"> items. </span><span class="koboSpan" id="kobo.858.2">But fear not – we’ll bring them back in the next recipe.</span></p>
<h2 class="heading-2" id="_idParaDest-215"><span class="koboSpan" id="kobo.859.1">How it works…</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.860.1">In this recipe, we already had actions and selectors set up. </span><span class="koboSpan" id="kobo.860.2">However, we were only dispatching actions to the store to add/remove items. </span><span class="koboSpan" id="kobo.860.3">The components were still using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.861.1">BucketService</span></code><span class="koboSpan" id="kobo.862.1"> and the Observable from it to manage the state and to render the items. </span><span class="koboSpan" id="kobo.862.2">Since we only wanted to work with NgRx for the entire process, we introduced a selector in our application to select the bucket items.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.863.1">Notice that we use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.864.1">createFeatureSelector</span></code><span class="koboSpan" id="kobo.865.1"> method from </span><code class="inlineCode"><span class="koboSpan" id="kobo.866.1">@ngrx/store</span></code><span class="koboSpan" id="kobo.867.1"> package. </span><span class="koboSpan" id="kobo.867.2">This allows us to select a feature from the application. </span><span class="koboSpan" id="kobo.867.3">For example, your application can have features like profile, users, events, and settings. </span><span class="koboSpan" id="kobo.867.4">And ideally, we create feature selectors to extract only the target feature’s data instead of the whole NgRx state object.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.868.1">Then we replace the </span><code class="inlineCode"><span class="koboSpan" id="kobo.869.1">$bucket</span></code><span class="koboSpan" id="kobo.870.1"> property in our </span><code class="inlineCode"><span class="koboSpan" id="kobo.871.1">BucketComponent</span></code><span class="koboSpan" id="kobo.872.1"> class using the selector </span><code class="inlineCode"><span class="koboSpan" id="kobo.873.1">selectBucket()</span></code><span class="koboSpan" id="kobo.874.1"> we just created. </span><span class="koboSpan" id="kobo.874.2">Notice that the selector returns a </span><code class="inlineCode"><span class="koboSpan" id="kobo.875.1">Readonly</span></code><span class="koboSpan" id="kobo.876.1"> array. </span><span class="koboSpan" id="kobo.876.2">This ensures we are not mutating the actual data and that is is read-only. </span><span class="koboSpan" id="kobo.876.3">Finally, we remove the unnecessary functions from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.877.1">BucketService</span></code><span class="koboSpan" id="kobo.878.1"> class and remove the usage of those functions from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.879.1">BucketComponent</span></code><span class="koboSpan" id="kobo.880.1"> class as well. </span></p>
<p class="normal"><span class="koboSpan" id="kobo.881.1">If you look at the app holistically now, we can add and remove items to the bucket using NgRx and can use selectors to render the items in the UI. </span><span class="koboSpan" id="kobo.881.2">However, as soon as you refresh the app, it all goes away since the data is not persistent; even though we have the functions to get and save items using </span><code class="inlineCode"><span class="koboSpan" id="kobo.882.1">LocalStorage</span></code><span class="koboSpan" id="kobo.883.1">. </span><span class="koboSpan" id="kobo.883.2">The ideal way of handling this would be to use NgRx effects. </span><span class="koboSpan" id="kobo.883.3">However, you are going to learn</span><a id="_idIndexMarker404"/><span class="koboSpan" id="kobo.884.1"> them in the next recipe. </span><span class="koboSpan" id="kobo.884.2">You can challenge yourself to come back to this recipe</span><a id="_idIndexMarker405"/><span class="koboSpan" id="kobo.885.1"> again to implement an effect </span><a id="_idIndexMarker406"/><span class="koboSpan" id="kobo.886.1">that saves the updated bucket</span><a id="_idIndexMarker407"/><span class="koboSpan" id="kobo.887.1"> list to storage.</span></p>
<h2 class="heading-2" id="_idParaDest-216"><span class="koboSpan" id="kobo.888.1">See also</span></h2>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.889.1">NgRx selectors</span><a id="_idIndexMarker408"/><span class="koboSpan" id="kobo.890.1"> documentation (</span><a href="https://ngrx.io/guide/store/selectors"><span class="url"><span class="koboSpan" id="kobo.891.1">https://ngrx.io/guide/store/selectors</span></span></a><span class="koboSpan" id="kobo.892.1">)</span></li>
</ul>
<h1 class="heading-1" id="_idParaDest-217"><span class="koboSpan" id="kobo.893.1">Using NgRx effects to fetch data from API calls</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.894.1">In this recipe, you’ll learn how</span><a id="_idIndexMarker409"/><span class="koboSpan" id="kobo.895.1"> to use NgRx effects using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.896.1">@ngrx/effects</span></code><span class="koboSpan" id="kobo.897.1"> package. </span><span class="koboSpan" id="kobo.897.2">We have</span><a id="_idIndexMarker410"/><span class="koboSpan" id="kobo.898.1"> an app that already has </span><code class="inlineCode"><span class="koboSpan" id="kobo.899.1">@ngrx/store</span></code><span class="koboSpan" id="kobo.900.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.901.1">@ngrx/store-devtools</span></code><span class="koboSpan" id="kobo.902.1"> installed. </span><span class="koboSpan" id="kobo.902.2">And we are able to add and remove items from the bucket. </span><span class="koboSpan" id="kobo.902.3">However, in this recipe, we’ll use a server to receive, store, add, and remove items from a bucket, i.e., the data will live in the NgRx store as well as on the backend.</span></p>
<h2 class="heading-2" id="_idParaDest-218"><span class="koboSpan" id="kobo.903.1">Getting ready</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.904.1">The app that we are going to work with resides in </span><code class="inlineCode"><span class="koboSpan" id="kobo.905.1">start/apps/chapter06/ngrx-effects</span></code><span class="koboSpan" id="kobo.906.1"> inside the cloned repository:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.907.1">Open the code repository in your code editor.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.908.1">Open the terminal, navigate to the code repository directory, and run the following command to serve the project with the backend app:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.909.1">npm run serve ngrx-effects with-server
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.910.1">This should open the app in a new browser tab, and you should see the following:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.911.1"><img alt="" role="presentation" src="../Images/B18469_06_09.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.912.1">Figure 6.9: ngrx-effects app running on http://localhost:4200</span></p></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.913.1">Now that we have the app running locally, let’s see the steps of the recipe in the next section.</span></p>
<h2 class="heading-2" id="_idParaDest-219"><span class="koboSpan" id="kobo.914.1">How to do it…</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.915.1">We have an Angular application</span><a id="_idIndexMarker411"/><span class="koboSpan" id="kobo.916.1"> having a single page containing</span><a id="_idIndexMarker412"/><span class="koboSpan" id="kobo.917.1"> a bucket. </span><span class="koboSpan" id="kobo.917.2">You can add fruits to your buckets and remove items from the bucket. </span><span class="koboSpan" id="kobo.917.3">We already have the </span><code class="inlineCode"><span class="koboSpan" id="kobo.918.1">@ngrx/store</span></code><span class="koboSpan" id="kobo.919.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.920.1">@ngrx/store-devtools</span></code><span class="koboSpan" id="kobo.921.1">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.922.1">@ngrx/effects</span></code><span class="koboSpan" id="kobo.923.1"> packages installed in the workspace, so you don’t have to install them. </span><span class="koboSpan" id="kobo.923.2">However, when you work on a standalone app (or on some of your own projects), you could add NgRx effects by running the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.924.1">npm install --save @ngrx/effects
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.925.1">Now let’s follow these steps:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.926.1">We’ll update the </span><code class="inlineCode"><span class="koboSpan" id="kobo.927.1">bucket.actions.ts</span></code><span class="koboSpan" id="kobo.928.1"> file to add some actions including the API call. </span><span class="koboSpan" id="kobo.928.2">Update the file as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.929.1">import</span></span><span class="koboSpan" id="kobo.930.1"> { createActionGroup, </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.931.1">props</span></strong></span><span class="koboSpan" id="kobo.932.1">, </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.933.1">emptyProps</span></strong></span><span class="koboSpan" id="kobo.934.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.935.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.936.1">'@ngrx/store'</span></span><span class="koboSpan" id="kobo.937.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.938.1">import</span></span><span class="koboSpan" id="kobo.939.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.940.1">IFruit</span></span><span class="koboSpan" id="kobo.941.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.942.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.943.1">'../interfaces/fruit.interface'</span></span><span class="koboSpan" id="kobo.944.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.945.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.946.1">const</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.947.1">BucketActions</span></span><span class="koboSpan" id="kobo.948.1"> = </span><span class="hljs-title"><span class="koboSpan" id="kobo.949.1">createActionGroup</span></span><span class="koboSpan" id="kobo.950.1">({
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.951.1">source</span></span><span class="koboSpan" id="kobo.952.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.953.1">'Bucket'</span></span><span class="koboSpan" id="kobo.954.1">,
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.955.1">events</span></span><span class="koboSpan" id="kobo.956.1">: {
    </span><span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.957.1">'Get Bucket'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.958.1">: </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.959.1">emptyProps</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.960.1">(),</span></strong></span>
<span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.961.1">'</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.962.1">Get Bucket Success'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.963.1">: props&lt;{ </span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.964.1">bucket</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.965.1">: </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.966.1">IFruit</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.967.1">[] }&gt;(),</span></strong></span>
<span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.968.1">'Get Bucket Failure'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.969.1">: props&lt;{ </span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.970.1">error</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.971.1">: </span></strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.972.1">string</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.973.1"> }&gt;(),</span></strong></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.974.1">'Add Fruit'</span></span><span class="koboSpan" id="kobo.975.1">: props&lt;{ </span><span class="hljs-attr"><span class="koboSpan" id="kobo.976.1">fruit</span></span><span class="koboSpan" id="kobo.977.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.978.1">IFruit</span></span><span class="koboSpan" id="kobo.979.1"> }&gt;(),
    </span><span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.980.1">'</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.981.1">Add Fruit Success'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.982.1">: props&lt;{ </span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.983.1">fruit</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.984.1">: </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.985.1">IFruit</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.986.1"> }&gt;(),</span></strong></span>
<span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.987.1">'Add Fruit Failure'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.988.1">: props&lt;{ </span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.989.1">error</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.990.1">: </span></strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.991.1">string</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.992.1"> }&gt;(),</span></strong></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.993.1">'Remove Fruit'</span></span><span class="koboSpan" id="kobo.994.1">: props&lt;{ </span><span class="hljs-attr"><span class="koboSpan" id="kobo.995.1">fruitId</span></span><span class="koboSpan" id="kobo.996.1">: </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.997.1">number</span></span><span class="koboSpan" id="kobo.998.1"> }&gt;(),
    </span><span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.999.1">'</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1000.1">Remove Fruit Success'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1001.1">: props&lt;{ </span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1002.1">fruitId</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1003.1">: </span></strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.1004.1">number</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1005.1"> }&gt;(),</span></strong></span>
<span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1006.1">'Remove Fruit Failure'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1007.1">: props&lt;{ </span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1008.1">error</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1009.1">: </span></strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.1010.1">string</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1011.1"> }&gt;(),</span></strong></span><span class="koboSpan" id="kobo.1012.1">
  },
});
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1013.1">Create a file in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1014.1">store</span></code><span class="koboSpan" id="kobo.1015.1"> folder named </span><code class="inlineCode"><span class="koboSpan" id="kobo.1016.1">bucket.effects.ts</span></code><span class="koboSpan" id="kobo.1017.1"> and add the following code to it:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1018.1">import</span></span><span class="koboSpan" id="kobo.1019.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.1020.1">Injectable</span></span><span class="koboSpan" id="kobo.1021.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1022.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1023.1">'@angular/core'</span></span><span class="koboSpan" id="kobo.1024.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1025.1">import</span></span><span class="koboSpan" id="kobo.1026.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.1027.1">Actions</span></span><span class="koboSpan" id="kobo.1028.1">, ofType, createEffect } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1029.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1030.1">'@ngrx/effects'</span></span><span class="koboSpan" id="kobo.1031.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1032.1">import</span></span><span class="koboSpan" id="kobo.1033.1"> { </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1034.1">of</span></span><span class="koboSpan" id="kobo.1035.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1036.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1037.1">'rxjs'</span></span><span class="koboSpan" id="kobo.1038.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1039.1">import</span></span><span class="koboSpan" id="kobo.1040.1"> { catchError, exhaustMap, map } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1041.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1042.1">'rxjs/operators'</span></span><span class="koboSpan" id="kobo.1043.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1044.1">import</span></span><span class="koboSpan" id="kobo.1045.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.1046.1">BucketService</span></span><span class="koboSpan" id="kobo.1047.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1048.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1049.1">'../bucket/bucket.service'</span></span><span class="koboSpan" id="kobo.1050.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1051.1">import</span></span><span class="koboSpan" id="kobo.1052.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.1053.1">BucketActions</span></span><span class="koboSpan" id="kobo.1054.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1055.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1056.1">'./bucket.actions'</span></span><span class="koboSpan" id="kobo.1057.1">;
</span><span class="hljs-meta"><span class="koboSpan" id="kobo.1058.1">@Injectable</span></span><span class="koboSpan" id="kobo.1059.1">()
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1060.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1061.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1062.1">BucketEffects</span></span><span class="koboSpan" id="kobo.1063.1"> {
  getBucket$ = </span><span class="hljs-title"><span class="koboSpan" id="kobo.1064.1">createEffect</span></span><span class="koboSpan" id="kobo.1065.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.1066.1">() =&gt;</span></span>
<span class="hljs-variable"><span class="koboSpan" id="kobo.1067.1">this</span></span><span class="koboSpan" id="kobo.1068.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1069.1">actions$</span></span><span class="koboSpan" id="kobo.1070.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1071.1">pipe</span></span><span class="koboSpan" id="kobo.1072.1">(
      </span><span class="hljs-title"><span class="koboSpan" id="kobo.1073.1">ofType</span></span><span class="koboSpan" id="kobo.1074.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.1075.1">BucketActions</span></span><span class="koboSpan" id="kobo.1076.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1077.1">getBucket</span></span><span class="koboSpan" id="kobo.1078.1">),
      </span><span class="hljs-title"><span class="koboSpan" id="kobo.1079.1">exhaustMap</span></span><span class="koboSpan" id="kobo.1080.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.1081.1">() =&gt;</span></span>
<span class="hljs-variable"><span class="koboSpan" id="kobo.1082.1">this</span></span><span class="koboSpan" id="kobo.1083.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1084.1">bucketService</span></span><span class="koboSpan" id="kobo.1085.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1086.1">getBucket</span></span><span class="koboSpan" id="kobo.1087.1">().</span><span class="hljs-title"><span class="koboSpan" id="kobo.1088.1">pipe</span></span><span class="koboSpan" id="kobo.1089.1">(
          </span><span class="hljs-title"><span class="koboSpan" id="kobo.1090.1">map</span></span><span class="koboSpan" id="kobo.1091.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.1092.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1093.1">{ bucket }</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1094.1">) =&gt;</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1095.1">BucketActions</span></span>
<span class="hljs-title"> </span><span class="koboSpan" id="kobo.1096.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1097.1">getBucketSuccess</span></span><span class="koboSpan" id="kobo.1098.1">({ bucket })),
          </span><span class="hljs-title"><span class="koboSpan" id="kobo.1099.1">catchError</span></span><span class="koboSpan" id="kobo.1100.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.1101.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1102.1">error</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1103.1">) =&gt;</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1104.1">of</span></span><span class="koboSpan" id="kobo.1105.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.1106.1">BucketActions</span></span>
<span class="hljs-title"> </span><span class="koboSpan" id="kobo.1107.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1108.1">getBucketFailure</span></span><span class="koboSpan" id="kobo.1109.1">({ error })))
        )
      )
    )
  );
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.1110.1">constructor</span></span><span class="koboSpan" id="kobo.1111.1">(
</span><span class="hljs-params"> </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1112.1">private</span></span><span class="hljs-params"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1113.1">actions$</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1114.1">: </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.1115.1">Actions</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1116.1">,</span></span>
<span class="hljs-params"> </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1117.1">private</span></span><span class="hljs-params"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1118.1">bucketService</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1119.1">: </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.1120.1">BucketService</span></span>
<span class="hljs-params"> </span><span class="koboSpan" id="kobo.1121.1">) {}
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1122.1">Now we can provide the</span><a id="_idIndexMarker413"/><span class="koboSpan" id="kobo.1123.1"> effects with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1124.1">BucketEffects</span></code><span class="koboSpan" id="kobo.1125.1"> class in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1126.1">app.config.ts</span></code><span class="koboSpan" id="kobo.1127.1"> file </span><a id="_idIndexMarker414"/><span class="koboSpan" id="kobo.1128.1">as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1129.1">...
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1130.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1131.1"> { provideEffects } </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1132.1">from</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1133.1">'@ngrx/effects'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1134.1">;</span></strong></span><span class="koboSpan" id="kobo.1135.1">
...
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1136.1">import</span></span><span class="koboSpan" id="kobo.1137.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.1138.1">BucketEffects</span></span><span class="koboSpan" id="kobo.1139.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1140.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1141.1">'./app/store/bucket.effects'</span></span><span class="koboSpan" id="kobo.1142.1">;
...
</span><span class="hljs-title"><span class="koboSpan" id="kobo.1143.1">bootstrapApplication</span></span><span class="koboSpan" id="kobo.1144.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.1145.1">AppComponent</span></span><span class="koboSpan" id="kobo.1146.1">, {
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1147.1">providers</span></span><span class="koboSpan" id="kobo.1148.1">: [
    ...,
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1149.1">provideHttpClient</span></span><span class="koboSpan" id="kobo.1150.1">(),
    </span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1151.1">provideEffects</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1152.1">([</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1153.1">BucketEffects</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1154.1">]),</span></strong></span><span class="koboSpan" id="kobo.1155.1">
  ],
}).</span><span class="hljs-title"><span class="koboSpan" id="kobo.1156.1">catch</span></span><span class="koboSpan" id="kobo.1157.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.1158.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1159.1">err</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1160.1">) =&gt;</span></span> <span class="hljs-variable"><span class="koboSpan" id="kobo.1161.1">console</span></span><span class="koboSpan" id="kobo.1162.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1163.1">error</span></span><span class="koboSpan" id="kobo.1164.1">(err));
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1165.1">We’ll now update the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1166.1">bucket.reducer.ts</span></code><span class="koboSpan" id="kobo.1167.1"> file to add or remove items from the state on the success events of the HTTP calls. </span><span class="koboSpan" id="kobo.1167.2">Also, to set the bucket items retrieved from the server on app start. </span><span class="koboSpan" id="kobo.1167.3">Update the file as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1168.1">...
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1169.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1170.1">const</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.1171.1">initialState</span></span><span class="koboSpan" id="kobo.1172.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.1173.1">ReadonlyArray</span></span><span class="koboSpan" id="kobo.1174.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.1175.1">IFruit</span></span><span class="koboSpan" id="kobo.1176.1">&gt; = [];
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1177.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1178.1">const</span></span><span class="koboSpan" id="kobo.1179.1"> bucketReducer = </span><span class="hljs-title"><span class="koboSpan" id="kobo.1180.1">createReducer</span></span><span class="koboSpan" id="kobo.1181.1">(
  initialState,
  </span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1182.1">on</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1183.1">(</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1184.1">BucketActions</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1185.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1186.1">getBucketSuccess</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1187.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1188.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1189.1">_state, { bucket }</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1190.1">) =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1191.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1192.1">return</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1193.1"> bucket;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1194.1">}),</span></strong></span>
<span class="hljs-title"><span class="koboSpan" id="kobo.1195.1">on</span></span><span class="koboSpan" id="kobo.1196.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.1197.1">BucketActions</span></span><span class="koboSpan" id="kobo.1198.1">.</span><span class="code-highlight"><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1199.1">addFruitSuccess</span></strong></span><span class="koboSpan" id="kobo.1200.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.1201.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1202.1">_state, { fruit }</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1203.1">) =&gt;</span></span><span class="koboSpan" id="kobo.1204.1"> {
    </span><span class="hljs-variable"><span class="koboSpan" id="kobo.1205.1">console</span></span><span class="koboSpan" id="kobo.1206.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1207.1">log</span></span><span class="koboSpan" id="kobo.1208.1">({ fruit });
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1209.1">return</span></span><span class="koboSpan" id="kobo.1210.1"> [fruit, ..._state];
  }),
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.1211.1">on</span></span><span class="koboSpan" id="kobo.1212.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.1213.1">BucketActions</span></span><span class="koboSpan" id="kobo.1214.1">.</span><span class="code-highlight"><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1215.1">removeFruitSuccess</span></strong></span><span class="koboSpan" id="kobo.1216.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.1217.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1218.1">_state, { fruitId }</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1219.1">) =&gt;</span></span><span class="koboSpan" id="kobo.1220.1"> {
    </span><span class="hljs-variable"><span class="koboSpan" id="kobo.1221.1">console</span></span><span class="koboSpan" id="kobo.1222.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1223.1">log</span></span><span class="koboSpan" id="kobo.1224.1">({ fruitId });
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1225.1">return</span></span><span class="koboSpan" id="kobo.1226.1"> _state.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1227.1">filter</span></span><span class="koboSpan" id="kobo.1228.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.1229.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1230.1">fr</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1231.1">) =&gt;</span></span><span class="koboSpan" id="kobo.1232.1"> fr.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1233.1">id</span></span><span class="koboSpan" id="kobo.1234.1"> !== fruitId);
  })
);
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1235.1">We’ll now dispatch</span><a id="_idIndexMarker415"/><span class="koboSpan" id="kobo.1236.1"> the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1237.1">getBucket</span></code><span class="koboSpan" id="kobo.1238.1"> action</span><a id="_idIndexMarker416"/><span class="koboSpan" id="kobo.1239.1"> from </span><code class="inlineCode"><span class="koboSpan" id="kobo.1240.1">bucket.componen.ts</span></code><span class="koboSpan" id="kobo.1241.1"> when the component is mounted. </span><span class="koboSpan" id="kobo.1241.2">Update </span><code class="inlineCode"><span class="koboSpan" id="kobo.1242.1">bucket.component.ts</span></code><span class="koboSpan" id="kobo.1243.1"> as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1244.1">import</span></span><span class="koboSpan" id="kobo.1245.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.1246.1">CommonModule</span></span><span class="koboSpan" id="kobo.1247.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1248.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1249.1">'@angular/common'</span></span><span class="koboSpan" id="kobo.1250.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1251.1">import</span></span><span class="koboSpan" id="kobo.1252.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.1253.1">Component</span></span><span class="koboSpan" id="kobo.1254.1">, inject, </span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1255.1">OnInit</span></strong></span><span class="koboSpan" id="kobo.1256.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1257.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1258.1">'@angular/core'</span></span><span class="koboSpan" id="kobo.1259.1">;
...
</span><span class="hljs-meta"><span class="koboSpan" id="kobo.1260.1">@Component</span></span><span class="koboSpan" id="kobo.1261.1">({...})
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1262.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1263.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1264.1">BucketComponent</span></span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1265.1">implements</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1266.1">OnInit</span></strong></span><span class="koboSpan" id="kobo.1267.1"> {
  ...
  </span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1268.1">ngOnInit</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1269.1">() {</span></strong></span>
<span class="code-highlight"><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.1270.1">this</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1271.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1272.1">store</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1273.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1274.1">dispatch</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1275.1">(</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1276.1">BucketActions</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1277.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1278.1">getBucket</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1279.1">());</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1280.1">}</span></strong></span><span class="koboSpan" id="kobo.1281.1">
  ...
</span><span class="koboSpan" id="kobo.1281.2">}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1282.1">Now that we have linked everything, refresh the app and you’ll see the bucket items from the server in the app. </span><span class="koboSpan" id="kobo.1282.2">You can see the actions in Redux Devtools as follows:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1283.1"><img alt="" role="presentation" src="../Images/B18469_06_10.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1284.1">Figure 6.10: Getting the bucket from the server using NgRx effects</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1285.1">You should also be able</span><a id="_idIndexMarker417"/><span class="koboSpan" id="kobo.1286.1"> to see the network</span><a id="_idIndexMarker418"/><span class="koboSpan" id="kobo.1287.1"> call (see </span><em class="italic"><span class="koboSpan" id="kobo.1288.1">Figure 6.10</span></em><span class="koboSpan" id="kobo.1289.1">) that occurred due to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1290.1">[Bucket] Get Bucket</span></code><span class="koboSpan" id="kobo.1291.1"> action in </span><em class="italic"><span class="koboSpan" id="kobo.1292.1">Figure 6.9</span></em><span class="koboSpan" id="kobo.1293.1">.</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1294.1"><img alt="" role="presentation" src="../Images/B18469_06_11.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1295.1">Figure 6.11: @ngrx/effects initiating network calls</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1296.1">If you try to add or remove items, you’ll see that they don’t work. </span><span class="koboSpan" id="kobo.1296.2">That’s because we changed our reducer to act when there’s an </span><code class="inlineCode"><span class="koboSpan" id="kobo.1297.1">addFruitSuccess</span></code><span class="koboSpan" id="kobo.1298.1"> or </span><code class="inlineCode"><span class="koboSpan" id="kobo.1299.1">removeFruitSuccess</span></code><span class="koboSpan" id="kobo.1300.1"> event in </span><em class="italic"><span class="koboSpan" id="kobo.1301.1">step 4</span></em><span class="koboSpan" id="kobo.1302.1">.</span></p> </li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="6"><span class="koboSpan" id="kobo.1303.1">Now we will add the effect for </span><code class="inlineCode"><span class="koboSpan" id="kobo.1304.1">addFruit</span></code><span class="koboSpan" id="kobo.1305.1"> in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1306.1">bucket.effects.ts</span></code><span class="koboSpan" id="kobo.1307.1">. </span><span class="koboSpan" id="kobo.1307.2">Update the file as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1308.1">...
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1309.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1310.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1311.1">BucketEffects</span></span><span class="koboSpan" id="kobo.1312.1"> {
  ...
  </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1313.1">addItem$ = </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1314.1">createEffect</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1315.1">(</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1316.1">() =&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.1317.1">this</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1318.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1319.1">actions$</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1320.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1321.1">pipe</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1322.1">(</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1323.1">ofType</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1324.1">(</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1325.1">BucketActions</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1326.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1327.1">addFruit</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1328.1">),</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1329.1">exhaustMap</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1330.1">(</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1331.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1332.1">action</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1333.1">) =&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.1334.1">this</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1335.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1336.1">bucketService</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1337.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1338.1">addItem</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1339.1">(action.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1340.1">fruit</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1341.1">).</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1342.1">pipe</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1343.1">(</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1344.1">map</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1345.1">(</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1346.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1347.1">{ fruit }</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1348.1">) =&gt;</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1349.1">BucketActions</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1350.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1351.1">addFruitSuccess</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1352.1">({ fruit })),</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1353.1">catchError</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1354.1">(</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1355.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1356.1">error</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1357.1">) =&gt;</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1358.1">of</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1359.1">(</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1360.1">BucketActions</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1361.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1362.1">addFruitFailure</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1363.1">({ error })))</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1364.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1365.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1366.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1367.1">);</span></strong></span><span class="koboSpan" id="kobo.1368.1">
  ...
</span><span class="koboSpan" id="kobo.1368.2">}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1369.1">Let’s add the effect</span><a id="_idIndexMarker419"/><span class="koboSpan" id="kobo.1370.1"> for </span><code class="inlineCode"><span class="koboSpan" id="kobo.1371.1">removeFruit</span></code><span class="koboSpan" id="kobo.1372.1"> as well, in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1373.1">bucket.effects.ts</span></code><span class="koboSpan" id="kobo.1374.1">. </span><span class="koboSpan" id="kobo.1374.2">Update</span><a id="_idIndexMarker420"/><span class="koboSpan" id="kobo.1375.1"> the file as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1376.1">...
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1377.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1378.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1379.1">BucketEffects</span></span><span class="koboSpan" id="kobo.1380.1"> {
  ...
  </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1381.1">removeItem$ = </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1382.1">createEffect</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1383.1">(</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1384.1">() =&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.1385.1">this</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1386.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1387.1">actions$</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1388.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1389.1">pipe</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1390.1">(</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1391.1">ofType</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1392.1">(</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1393.1">BucketActions</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1394.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1395.1">removeFruit</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1396.1">),</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1397.1">exhaustMap</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1398.1">(</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1399.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1400.1">action</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1401.1">) =&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.1402.1">this</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1403.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1404.1">bucketService</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1405.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1406.1">removeItem</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1407.1">(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1408.1">action.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1409.1">fruitId</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1410.1">).</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1411.1">pipe</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1412.1">(</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1413.1">map</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1414.1">(</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1415.1">() =&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1416.1">BucketActions</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1417.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1418.1">removeFruitSuccess</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1419.1">({ </span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1420.1">fruitId</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1421.1">:</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1422.1">action.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1423.1">fruitId</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1424.1"> })</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1425.1">),</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1426.1">catchError</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1427.1">(</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1428.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1429.1">error</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1430.1">) =&gt;</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1431.1">of</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1432.1">(</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1433.1">BucketActions</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1434.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1435.1">removeFruitFailure</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1436.1">({ error })))</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1437.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1438.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1439.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1440.1">);</span></strong></span><span class="koboSpan" id="kobo.1441.1">
  ...
</span><span class="koboSpan" id="kobo.1441.2">}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1442.1">If you refresh the app now, add an apple, and remove it, you should see the state in Redux Devtools, as shown in the following figure:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1443.1"><img alt="" role="presentation" src="../Images/B18469_06_12.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1444.1">Figure 6.12: NgRx effects getting a bucket and adding and removing items</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1445.1">Notice in </span><em class="italic"><span class="koboSpan" id="kobo.1446.1">Figure 6.11</span></em><span class="koboSpan" id="kobo.1447.1"> that the state shows 4 items, shown in the UI. </span><span class="koboSpan" id="kobo.1447.2">Also, notice the sequence of the actions dispatched. </span><span class="koboSpan" id="kobo.1447.3">Every API/HTTP action results in the following </span><code class="inlineCode"><span class="koboSpan" id="kobo.1448.1">Success</span></code><span class="koboSpan" id="kobo.1449.1"> action in this case.</span></p></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.1450.1">Great! </span><span class="koboSpan" id="kobo.1450.2">You now know</span><a id="_idIndexMarker421"/><span class="koboSpan" id="kobo.1451.1"> how to use NgRx effects in your</span><a id="_idIndexMarker422"/><span class="koboSpan" id="kobo.1452.1"> Angular apps. </span><span class="koboSpan" id="kobo.1452.2">See the next section to understand how NgRx effects work.</span></p>
<h2 class="heading-2" id="_idParaDest-220"><span class="koboSpan" id="kobo.1453.1">How it works…</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1454.1">In order for the NgRx effects to work, we needed to install the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1455.1">@ngrx/effects</span></code><span class="koboSpan" id="kobo.1456.1"> package, create an effect, and register it in an array of effects (root effects) in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1457.1">main.ts</span></code><span class="koboSpan" id="kobo.1458.1"> file. </span><span class="koboSpan" id="kobo.1458.2">An NgRx effect is essentially something that listens to an action, does something (we call this something a side-effect), and then returns an action as a result. </span><span class="koboSpan" id="kobo.1458.3">When an action is dispatched to the store from any component or even from another effect, the registered effect does the job you want it to do and is supposed to dispatch another action in return. </span><span class="koboSpan" id="kobo.1458.4">For HTTP calls, we usually have three actions—that is, the main action, and the following success and failure actions. </span><span class="koboSpan" id="kobo.1458.5">Ideally, on the success action (and perhaps on the failure action too), you would want to update some of your state variables. </span><span class="koboSpan" id="kobo.1458.6">In </span><em class="italic"><span class="koboSpan" id="kobo.1459.1">step 4</span></em><span class="koboSpan" id="kobo.1460.1">, inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1461.1">BucketEffects</span></code><span class="koboSpan" id="kobo.1462.1"> class, you’ll notice that we inject the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1463.1">Action</span></code><span class="koboSpan" id="kobo.1464.1"> service from NgRx and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1465.1">BucketService</span></code><span class="koboSpan" id="kobo.1466.1">. </span><span class="koboSpan" id="kobo.1466.2">Then we use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1467.1">createEffect</span></code><span class="koboSpan" id="kobo.1468.1"> function to create the effect. </span><span class="koboSpan" id="kobo.1468.2">The effect itself listens to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1469.1">Action</span></code><span class="koboSpan" id="kobo.1470.1"> stream for a particular event using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1471.1">ofType</span></code><span class="koboSpan" id="kobo.1472.1"> operator. </span><span class="koboSpan" id="kobo.1472.2">We then use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1473.1">exhaustMap</span></code><span class="koboSpan" id="kobo.1474.1"> operator to perform the HTTP call, which returns an observable. </span><span class="koboSpan" id="kobo.1474.2">Finally, we use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1475.1">map</span></code><span class="koboSpan" id="kobo.1476.1"> operator</span><a id="_idIndexMarker423"/><span class="koboSpan" id="kobo.1477.1"> to return the success action and the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1478.1">catchError</span></code><span class="koboSpan" id="kobo.1479.1"> operator to return</span><a id="_idIndexMarker424"/><span class="koboSpan" id="kobo.1480.1"> the failure action.</span></p>
<h2 class="heading-2" id="_idParaDest-221"><span class="koboSpan" id="kobo.1481.1">See also</span></h2>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.1482.1">NgRx effects</span><a id="_idIndexMarker425"/><span class="koboSpan" id="kobo.1483.1"> documentation (</span><a href="https://ngrx.io/guide/effects"><span class="url"><span class="koboSpan" id="kobo.1484.1">https://ngrx.io/guide/effects</span></span></a><span class="koboSpan" id="kobo.1485.1">)</span></li>
</ul>
<h1 class="heading-1" id="_idParaDest-222"><span class="koboSpan" id="kobo.1486.1">Using NgRx Component Store to manage the state of a component</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1487.1">In this recipe, you’ll learn how to use the </span><strong class="keyWord"><span class="koboSpan" id="kobo.1488.1">NgRx Component Store</span></strong><span class="koboSpan" id="kobo.1489.1"> and how to use it instead </span><a id="_idIndexMarker426"/><span class="koboSpan" id="kobo.1490.1">of the push-based </span><code class="inlineCode"><span class="koboSpan" id="kobo.1491.1">Subject/BehaviorSubject</span></code><span class="koboSpan" id="kobo.1492.1"> pattern</span><a id="_idIndexMarker427"/><span class="koboSpan" id="kobo.1493.1"> with services for maintaining a component’s state. </span><span class="koboSpan" id="kobo.1493.2">We’ll also see how this can facilitate cross-component communication using the </span><strong class="screenText"><span class="koboSpan" id="kobo.1494.1">Component Store</span></strong><span class="koboSpan" id="kobo.1495.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1496.1">Remember that </span><code class="inlineCode"><span class="koboSpan" id="kobo.1497.1">@ngrx/component-store</span></code><span class="koboSpan" id="kobo.1498.1"> is a standalone library and doesn’t correlate with Redux or </span><code class="inlineCode"><span class="koboSpan" id="kobo.1499.1">@ngrx/store</span></code><span class="koboSpan" id="kobo.1500.1">, and so on.</span></p>
<h2 class="heading-2" id="_idParaDest-223"><span class="koboSpan" id="kobo.1501.1">Getting ready</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1502.1">The app that we are going to work with resides in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1503.1">start/apps/chapter06/ngrx-component-store</span></code><span class="koboSpan" id="kobo.1504.1"> inside the cloned repository:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1505.1">Open the code repository in your code editor.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1506.1">Open the terminal, navigate to the code repository directory, and run the following command to serve the project with the backend app:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1507.1">npm run serve ngrx-component-store
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1508.1">This should open the app in a new browser tab, and you should see the following:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1509.1"><img alt="" role="presentation" src="../Images/B18469_06_13.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1510.1">Figure 6.13: ngrx-component-store app running on http://localhost:4200</span></p></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.1511.1">Now that we have the app</span><a id="_idIndexMarker428"/><span class="koboSpan" id="kobo.1512.1"> running locally, let’s see the steps </span><a id="_idIndexMarker429"/><span class="koboSpan" id="kobo.1513.1">of the recipe in the next section.</span></p>
<h2 class="heading-2" id="_idParaDest-224"><span class="koboSpan" id="kobo.1514.1">How to do it…</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1515.1">We have our favorite bucket app that we’ve used in a lot of recipes so far. </span><span class="koboSpan" id="kobo.1515.2">The state of the bucket right now is stored in the component itself. </span><span class="koboSpan" id="kobo.1515.3">This limits the state to being just in the component and we can’t use the bucket’s length in the top header. </span><span class="koboSpan" id="kobo.1515.4">One way could be using </span><code class="inlineCode"><span class="koboSpan" id="kobo.1516.1">BehaviorSubject</span></code><span class="koboSpan" id="kobo.1517.1"> for this. </span><span class="koboSpan" id="kobo.1517.2">But we’d rather use NgRx Component Store. </span><span class="koboSpan" id="kobo.1517.3">We already have </span><code class="inlineCode"><span class="koboSpan" id="kobo.1518.1">@ngrx/component-store</span></code><span class="koboSpan" id="kobo.1519.1"> package installed in the monorepository. </span><span class="koboSpan" id="kobo.1519.2">But if you’re working on a new project, you would install the package as follows:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1520.1">npm install @ngrx/component-store
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1521.1">We’re going to build our component store in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1522.1">BucketService</span></code><span class="koboSpan" id="kobo.1523.1">.</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1524.1">Let’s make it compatible with </span><code class="inlineCode"><span class="koboSpan" id="kobo.1525.1">ComponentStore</span></code><span class="koboSpan" id="kobo.1526.1">. </span><span class="koboSpan" id="kobo.1526.2">In order to do that, we’ll create an interface for the bucket state, extend </span><code class="inlineCode"><span class="koboSpan" id="kobo.1527.1">BucketService</span></code><span class="koboSpan" id="kobo.1528.1"> from </span><code class="inlineCode"><span class="koboSpan" id="kobo.1529.1">ComponentStore</span></code><span class="koboSpan" id="kobo.1530.1">, and initialize the service by calling the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1531.1">super</span></code><span class="koboSpan" id="kobo.1532.1"> method. </span><span class="koboSpan" id="kobo.1532.2">Update the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1533.1">bucket.service.ts</span></code><span class="koboSpan" id="kobo.1534.1"> file as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1535.1">...
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1536.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1537.1"> { </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1538.1">ComponentStore</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1539.1"> } </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1540.1">from</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1541.1">'@ngrx/component-store'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1542.1">;</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1543.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1544.1"> { </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1545.1">IFruit</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1546.1"> } </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1547.1">from</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1548.1">'../interfaces/fruit.interface'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1549.1">;</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1550.1">export</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1551.1">interface</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1552.1">BucketState</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1553.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1554.1">bucket</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1555.1">: </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1556.1">IFruit</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1557.1">[];</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1558.1">}</span></strong></span><span class="koboSpan" id="kobo.1559.1">
...
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1560.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1561.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1562.1">BucketService</span></span> <span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1563.1">extends</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1564.1">ComponentStore</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1565.1">&lt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1566.1">BucketState</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1567.1">&gt;</span></strong></span><span class="koboSpan" id="kobo.1568.1"> {
  storeKey = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1569.1">'bucket_ngrx-component-store'</span></span><span class="koboSpan" id="kobo.1570.1">;
  </span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1571.1">constructor</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1572.1">() {</span></strong></span>
<span class="code-highlight"><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.1573.1">super</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1574.1">({ </span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1575.1">bucket</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1576.1">: [] });</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1577.1">}</span></strong></span>
<span class="hljs-title"><span class="koboSpan" id="kobo.1578.1">loadItems</span></span><span class="koboSpan" id="kobo.1579.1">() {...}
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.1580.1">saveItems</span></span><span class="koboSpan" id="kobo.1581.1">(</span><span class="hljs-attr"><span class="koboSpan" id="kobo.1582.1">items</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1583.1">: </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.1584.1">IFruit</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1585.1">[]</span></span><span class="koboSpan" id="kobo.1586.1">) {...}
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1587.1">None of this will make sense until we actually show the data from </span><code class="inlineCode"><span class="koboSpan" id="kobo.1588.1">ComponentStore</span></code><span class="koboSpan" id="kobo.1589.1">. </span><span class="koboSpan" id="kobo.1589.2">Let’s work on that now.</span></p> </li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="2"><span class="koboSpan" id="kobo.1590.1">Let’s create</span><a id="_idIndexMarker430"/><span class="koboSpan" id="kobo.1591.1"> a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1592.1">bucket$</span></code><span class="koboSpan" id="kobo.1593.1"> observable</span><a id="_idIndexMarker431"/><span class="koboSpan" id="kobo.1594.1"> in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1595.1">BucketService</span></code><span class="koboSpan" id="kobo.1596.1"> as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1597.1">...
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1598.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1599.1"> { </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1600.1">Observable</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1601.1"> } </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1602.1">from</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1603.1">'rxjs/internal/Observable'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1604.1">;</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1605.1">import</span></span><span class="koboSpan" id="kobo.1606.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.1607.1">IFruit</span></span><span class="koboSpan" id="kobo.1608.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1609.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1610.1">'../interfaces/fruit.interface'</span></span><span class="koboSpan" id="kobo.1611.1">;
...
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1612.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1613.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1614.1">BucketService</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1615.1">extends</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1616.1">ComponentStore</span></span><span class="koboSpan" id="kobo.1617.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.1618.1">BucketState</span></span><span class="koboSpan" id="kobo.1619.1">&gt; {
  storeKey = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1620.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1621.1">bucket_ngrx-component-store'</span></span><span class="koboSpan" id="kobo.1622.1">;
  </span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1623.1">readonly</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1624.1">bucket$</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1625.1">: </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1626.1">Observable</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1627.1">&lt;</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1628.1">IFruit</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1629.1">[]&gt; = </span></strong><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.1630.1">this</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1631.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1632.1">select</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1633.1">(</span></strong></span>
<span class="code-highlight"><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1634.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1635.1">state</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1636.1">) =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1637.1"> state.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1638.1">bucket</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1639.1">);</span></strong></span><span class="koboSpan" id="kobo.1640.1">
  ...
</span><span class="koboSpan" id="kobo.1640.2">}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1641.1">First, let’s make sure that we can initialize the component store using the values from </span><code class="inlineCode"><span class="koboSpan" id="kobo.1642.1">localStorage</span></code><span class="koboSpan" id="kobo.1643.1">. </span><span class="koboSpan" id="kobo.1643.2">We’ll update the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1644.1">constructor</span></code><span class="koboSpan" id="kobo.1645.1"> method in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1646.1">bucket.service.ts</span></code><span class="koboSpan" id="kobo.1647.1"> file as follows to use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1648.1">loadItems</span></code><span class="koboSpan" id="kobo.1649.1"> method:
        </span><pre class="programlisting code"><code class="hljs-code"> <span class="hljs-title"><span class="koboSpan" id="kobo.1650.1">constructor</span></span><span class="koboSpan" id="kobo.1651.1">() {
    </span><span class="hljs-variable"><span class="koboSpan" id="kobo.1652.1">super</span></span><span class="koboSpan" id="kobo.1653.1">({ </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1654.1">bucket</span></span><span class="koboSpan" id="kobo.1655.1">: [] });
    </span><span class="code-highlight"><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.1656.1">this</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1657.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1658.1">setState</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1659.1">({</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1660.1">bucket</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1661.1">: </span></strong><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.1662.1">this</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1663.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1664.1">loadItems</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1665.1">(),</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1666.1">});</span></strong></span><span class="koboSpan" id="kobo.1667.1">
  }
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1668.1">Now we’ll add the methods for adding and removing fruit items to and from the bucket:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1669.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1670.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1671.1">BucketService</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1672.1">extends</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1673.1">ComponentStore</span></span><span class="koboSpan" id="kobo.1674.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.1675.1">BucketState</span></span><span class="koboSpan" id="kobo.1676.1">&gt; {
  ...
  </span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1677.1">readonly</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1678.1"> addItem = </span></strong><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.1679.1">this</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1680.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1681.1">updater</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1682.1">(</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1683.1">(</span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1684.1">state</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1685.1">: </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1686.1">BucketState</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1687.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1688.1">fruit</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1689.1">: </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1690.1">IFruit</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1691.1">) =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1692.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1693.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1694.1"> bucketUpdated = [fruit, ...state.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1695.1">bucket</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1696.1">];</span></strong></span>
<span class="code-highlight"><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.1697.1">this</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1698.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1699.1">saveItems</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1700.1">(bucketUpdated);</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1701.1">return</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1702.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1703.1">bucket</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1704.1">: bucketUpdated,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1705.1">};</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1706.1">});</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1707.1">readonly</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1708.1"> removeItem = </span></strong><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.1709.1">this</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1710.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1711.1">updater</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1712.1">(</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1713.1">(</span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1714.1">state</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1715.1">: </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1716.1">BucketState</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1717.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1718.1">fruitId</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1719.1">: </span></strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.1720.1">number</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1721.1">) =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1722.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1723.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1724.1"> bucketUpdated = state.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1725.1">bucket</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1726.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1727.1">filter</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1728.1">(</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1729.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1730.1">fr</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1731.1">) =&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1732.1">fr.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1733.1">id</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1734.1"> !== fruitId);</span></strong></span>
<span class="code-highlight"><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.1735.1">this</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1736.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1737.1">saveItems</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1738.1">(bucketUpdated);</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1739.1">return</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1740.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1741.1">bucket</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1742.1">: bucketUpdated,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1743.1">};</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1744.1">});</span></strong></span><span class="koboSpan" id="kobo.1745.1">
  ...
</span><span class="koboSpan" id="kobo.1745.2">}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1746.1">Now that we have the Component</span><a id="_idIndexMarker432"/><span class="koboSpan" id="kobo.1747.1"> Store set up, let’s use</span><a id="_idIndexMarker433"/><span class="koboSpan" id="kobo.1748.1"> it in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1749.1">bucket.component.ts</span></code><span class="koboSpan" id="kobo.1750.1"> file as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1751.1">...
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1752.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1753.1"> { </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1754.1">BucketService</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1755.1"> } </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1756.1">from</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1757.1">'</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1758.1">./bucket.service'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1759.1">;</span></strong></span>
<span class="hljs-meta"><span class="koboSpan" id="kobo.1760.1">@Component</span></span><span class="koboSpan" id="kobo.1761.1">({...})
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1762.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1763.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1764.1">BucketComponent</span></span><span class="koboSpan" id="kobo.1765.1"> {
  ...
  </span><span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1766.1">bucket</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1767.1">: </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1768.1">IFruit</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1769.1">[] = []; </span></strong><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1770.1">//← remove</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1771.1">store = </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1772.1">inject</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1773.1">(</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1774.1">BucketService</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1775.1">); </span></strong><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1776.1">//← add</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1777.1">bucket$ = </span></strong><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.1778.1">this</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1779.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1780.1">store</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1781.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1782.1">bucket$</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1783.1">; </span></strong><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1784.1">//← add</span></strong></span>
<span class="hljs-title"><span class="koboSpan" id="kobo.1785.1">addSelectedFruitToBucket</span></span><span class="koboSpan" id="kobo.1786.1">() {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1787.1">const</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.1788.1">newFruit</span></span><span class="koboSpan" id="kobo.1789.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.1790.1">IFruit</span></span><span class="koboSpan" id="kobo.1791.1"> = {
      </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1792.1">id</span></span><span class="koboSpan" id="kobo.1793.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.1794.1">Date</span></span><span class="koboSpan" id="kobo.1795.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1796.1">now</span></span><span class="koboSpan" id="kobo.1797.1">(),
      </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1798.1">name</span></span><span class="koboSpan" id="kobo.1799.1">: </span><span class="hljs-variable"><span class="koboSpan" id="kobo.1800.1">this</span></span><span class="koboSpan" id="kobo.1801.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1802.1">selectedFruit</span></span><span class="koboSpan" id="kobo.1803.1">,
    };
    </span><span class="code-highlight"><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.1804.1">this</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1805.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1806.1">store</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1807.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1808.1">addItem</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1809.1">(newFruit);</span></strong></span><span class="koboSpan" id="kobo.1810.1">
  }
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.1811.1">deleteFromBucket</span></span><span class="koboSpan" id="kobo.1812.1">(</span><span class="hljs-attr"><span class="koboSpan" id="kobo.1813.1">fruit</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1814.1">: </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.1815.1">IFruit</span></span><span class="koboSpan" id="kobo.1816.1">) {
    </span><span class="code-highlight"><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.1817.1">this</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1818.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1819.1">store</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1820.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1821.1">removeItem</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1822.1">(fruit.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1823.1">id</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1824.1">);</span></strong></span><span class="koboSpan" id="kobo.1825.1">
  }
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1826.1">We can now use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1827.1">bucket$</span></code><span class="koboSpan" id="kobo.1828.1"> observable</span><a id="_idIndexMarker434"/><span class="koboSpan" id="kobo.1829.1"> in the template. </span><span class="koboSpan" id="kobo.1829.2">Update</span><a id="_idIndexMarker435"/> <code class="inlineCode"><span class="koboSpan" id="kobo.1830.1">bucket.component.html</span></code><span class="koboSpan" id="kobo.1831.1"> as follows:
        </span><pre class="programlisting code"><code class="hljs-code"> <span class="hljs-tag"><span class="koboSpan" id="kobo.1832.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1833.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1834.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1835.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1836.1">"fruits"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1837.1"> *</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1838.1">ngIf</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1839.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1840.1">"</span></span><span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1841.1">bucket$ | async as bucket</span></strong></span><span class="hljs-string"><span class="koboSpan" id="kobo.1842.1">"</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1843.1">    [@</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1844.1">listItemAnimation</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1845.1">]=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1846.1">"bucket.length"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1847.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1848.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1849.1">ng-container</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1850.1"> *</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1851.1">ngIf</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1852.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1853.1">"bucket.length &gt; 0; else</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.1854.1">      bucketEmptyMessage"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1855.1">&gt;</span></span><span class="koboSpan" id="kobo.1856.1">
    ...
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1857.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1858.1">ng-container</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1859.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1860.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1861.1">ng-template</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1862.1"> #</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1863.1">bucketEmptyMessage</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1864.1">&gt;</span></span><span class="koboSpan" id="kobo.1865.1">...</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1866.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1867.1">ng-template</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1868.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1869.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1870.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1871.1">&gt;</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1872.1">With this change, you should see the app working. </span><span class="koboSpan" id="kobo.1872.2">If you now try to add or remove items, you should be able to see them being reflected in the app. </span><span class="koboSpan" id="kobo.1872.3">And this is all being done using Component Store now.</span></p> </li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="7"><span class="koboSpan" id="kobo.1873.1">The next thing we need to do is to use the bucket’s length in the application’s header. </span><span class="koboSpan" id="kobo.1873.2">Let’s create a new state selector in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1874.1">bucket.service.ts</span></code><span class="koboSpan" id="kobo.1875.1"> file as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1876.1">...
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1877.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1878.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1879.1">BucketService</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1880.1">extends</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1881.1">ComponentStore</span></span><span class="koboSpan" id="kobo.1882.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.1883.1">BucketState</span></span><span class="koboSpan" id="kobo.1884.1">&gt; {
  storeKey = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1885.1">'bucket_ngrx-component-store'</span></span><span class="koboSpan" id="kobo.1886.1">;
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1887.1">readonly</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.1888.1">bucket$</span></span><span class="koboSpan" id="kobo.1889.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.1890.1">Observable</span></span><span class="koboSpan" id="kobo.1891.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.1892.1">IFruit</span></span><span class="koboSpan" id="kobo.1893.1">[]&gt; =
    </span><span class="hljs-variable"><span class="koboSpan" id="kobo.1894.1">this</span></span><span class="koboSpan" id="kobo.1895.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1896.1">select</span></span><span class="koboSpan" id="kobo.1897.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.1898.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1899.1">state</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1900.1">) =&gt;</span></span><span class="koboSpan" id="kobo.1901.1"> state.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1902.1">bucket</span></span><span class="koboSpan" id="kobo.1903.1">);
  </span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1904.1">readonly</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1905.1">bucketLength$</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1906.1">: </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1907.1">Observable</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1908.1">&lt;</span></strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.1909.1">number</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1910.1">&gt; =</span></strong></span>
<span class="code-highlight"><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.1911.1">this</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1912.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1913.1">select</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1914.1">(</span></strong></span>
<span class="code-highlight"><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1915.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1916.1">state</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1917.1">) =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1918.1"> state.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1919.1">bucket</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1920.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1921.1">length</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1922.1">);</span></strong></span><span class="koboSpan" id="kobo.1923.1">
  ...
</span><span class="koboSpan" id="kobo.1923.2">}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1924.1">And we can now use the component store in the app’s header. </span><span class="koboSpan" id="kobo.1924.2">First, let’s import the store in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1925.1">app.component.ts</span></code><span class="koboSpan" id="kobo.1926.1"> as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1927.1">...
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1928.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1929.1"> { </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1930.1">BucketService</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1931.1"> } </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1932.1">from</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1933.1">'./bucket/bucket.service'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1934.1">;</span></strong></span><span class="koboSpan" id="kobo.1935.1">
...
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1936.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1937.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1938.1">AppComponent</span></span><span class="koboSpan" id="kobo.1939.1"> {
  </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1940.1">store = </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1941.1">inject</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1942.1">(</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1943.1">BucketService</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1944.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1945.1">bucketLength$ = </span></strong><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.1946.1">this</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1947.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1948.1">store</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1949.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1950.1">bucketLength$</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1951.1">;</span></strong></span><span class="koboSpan" id="kobo.1952.1">
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1953.1">We can now use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1954.1">bucketLength$</span></code><span class="koboSpan" id="kobo.1955.1"> observable in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1956.1">app.component.html</span></code><span class="koboSpan" id="kobo.1957.1"> as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag"><span class="koboSpan" id="kobo.1958.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1959.1">span</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1960.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1961.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1962.1">"mr-4"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1963.1">&gt;</span></span><span class="koboSpan" id="kobo.1964.1">{{</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1965.1">bucketLength$ | async</span></strong></span><span class="koboSpan" id="kobo.1966.1">}} items</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1967.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1968.1">span</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1969.1">&gt;</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1970.1">And voila! </span><span class="koboSpan" id="kobo.1970.2">If you add and remove items from the bucket, you should be able to see the bucket’s length in the header as well:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1971.1"><img alt="" role="presentation" src="../Images/B18469_06_14.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1972.1">Figure 6.14: Bucket length in header via Component Store</span></p> </li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.1973.1">Congratulations! </span><span class="koboSpan" id="kobo.1973.2">You finished </span><a id="_idIndexMarker436"/><span class="koboSpan" id="kobo.1974.1">the recipe. </span><span class="koboSpan" id="kobo.1974.2">See the next</span><a id="_idIndexMarker437"/><span class="koboSpan" id="kobo.1975.1"> section to understand how it works.</span></p>
<h2 class="heading-2" id="_idParaDest-225"><span class="koboSpan" id="kobo.1976.1">How it works…</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1977.1">As mentioned earlier, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1978.1">@ngrx/component-store</span></code><span class="koboSpan" id="kobo.1979.1"> is a standalone package that can easily be installed in your Angular apps without having to use </span><code class="inlineCode"><span class="koboSpan" id="kobo.1980.1">@ngrx/store</span></code><span class="koboSpan" id="kobo.1981.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1982.1">@ngrx/effects</span></code><span class="koboSpan" id="kobo.1983.1"> and so on. </span><span class="koboSpan" id="kobo.1983.2">It is supposed to replace the usage of </span><code class="inlineCode"><span class="koboSpan" id="kobo.1984.1">BehaviorSubject</span></code><span class="koboSpan" id="kobo.1985.1"> in Angular services, and that’s what we did in this recipe. </span><span class="koboSpan" id="kobo.1985.2">We covered how to initialize </span><code class="inlineCode"><span class="koboSpan" id="kobo.1986.1">ComponentStore</span></code><span class="koboSpan" id="kobo.1987.1"> and how to set the initial state using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1988.1">setState</span></code><span class="koboSpan" id="kobo.1989.1"> method when we already had the values without accessing the state, and we learned how to create updater methods that can be used to update the state, as they can access</span><a id="_idIndexMarker438"/><span class="koboSpan" id="kobo.1990.1"> the state and allow us to even pass arguments for our</span><a id="_idIndexMarker439"/><span class="koboSpan" id="kobo.1991.1"> own use cases.</span></p>
<h2 class="heading-2" id="_idParaDest-226"><span class="koboSpan" id="kobo.1992.1">See also</span></h2>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1993.1">@ngrx/component-store</span></code> <a id="_idIndexMarker440"/><span class="koboSpan" id="kobo.1994.1">documentation (</span><a href="https://ngrx.io/guide/component-store"><span class="url"><span class="koboSpan" id="kobo.1995.1">https://ngrx.io/guide/component-store</span></span></a><span class="koboSpan" id="kobo.1996.1">)</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1997.1">Effects</span><a id="_idIndexMarker441"/><span class="koboSpan" id="kobo.1998.1"> in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1999.1">@ngrx/component-store</span></code><span class="koboSpan" id="kobo.2000.1"> documentation (</span><a href="https://ngrx.io/guide/component-store/effect"><span class="url"><span class="koboSpan" id="kobo.2001.1">https://ngrx.io/guide/component-store/effect</span></span></a><span class="koboSpan" id="kobo.2002.1">)</span></li>
</ul>
<h1 class="heading-1"><span class="koboSpan" id="kobo.2003.1">Learn more on Discord</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.2004.1">To join the Discord community for this book – where you can share feedback, ask questions to the author, and learn about new releases – follow the QR code below:</span></p>
<p class="normal"><a href="Chapter_6.xhtml"><span class="url"><span class="koboSpan" id="kobo.2005.1">https://packt.link/AngularCookbook2e</span></span></a></p>
<p class="normal"><span class="koboSpan" id="kobo.2006.1"><img alt="" role="presentation" src="../Images/QR_Code1388317275422265.png"/></span></p>
</div>
</body></html>