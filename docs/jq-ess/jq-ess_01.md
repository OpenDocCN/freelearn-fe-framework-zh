# 第一章：逐步学习 jQuery

jQuery 无疑是互联网上最受欢迎的 JavaScript 库。根据[`builtwith.com`](http://builtwith.com)的数据，它被超过 87%的使用 JavaScript 库的网站使用。这是惊人的渗透率。很难相信 jQuery 自 2006 年以来一直存在。

在本章中，我们将开始让您熟悉 jQuery。我们将涉及以下主题：

+   为什么会创建 jQuery？

+   jQuery 的主要组成部分

+   为什么 jQuery 存在两个维护版本？

+   什么是内容交付网络？

# jQuery 出现之前的生活

2006 年也许并不久远，但它在互联网年代几乎就是一个世纪。如果你不同意，那么想想当时你用的是什么样的手机，如果你有的话。那个时候，最受欢迎的四款浏览器是 Internet Explorer、Firefox、Safari 和 Opera。Chrome 呢？那时还没有，直到 2008 年末才出现。在超过 80%的用户中使用的 Internet Explorer 是迄今最受欢迎的浏览器。

当时，微软似乎并不太关心是否符合标准。为什么要这样做呢？他们占据 80%以上的市场份额。如果一个网站必须选择，他们通常会选择与 IE 合作。但变革的风声已经如潮，80%可能看起来像是一个无法逾越的领先优势，但两年前，这个数字是超过 90%。由 Firefox 等其他浏览器领导的其他浏览器正在慢慢地削弱这一领先优势。许多人，包括开发者，正在转向其他浏览器，他们希望能在上面运行的网站。

不幸的是，编写 Web 应用程序现在很困难，过去更糟。JavaScript 不是最友好的编程语言。但 JavaScript 并不是问题，问题是浏览器。相同的代码在不同的浏览器上运行得不同。在一个上，它完美运行；在另一个上，它崩溃，令用户感到沮丧。

要理解浏览器实现的差异如何会导致开发者额外的工作量，让我们来看一下实现 JavaScript Ajax 调用。在 2006 年，**W3C**（**万维网联盟**）的标准并没有涵盖到`XMLHttpRequest`对象，这个对象是所有 Ajax 请求的核心。微软在 1999 年就用 Internet Explorer 5 实现了这项技术。不幸的是，他们选择将其实现为一个 ActiveX 控件。ActiveX 是微软的专有技术，其他浏览器无法以相同的方式实现它。Mozilla、Safari 和 Opera 选择将其实现为一个对象附加到全局窗口。因此，为了在所有浏览器上添加可以工作的 Ajax 网站，开发者必须编写、测试和维护两倍多的代码：一套是为 IE 设计的，另一套是为其他浏览器设计的。

你在想浏览器是否是 IE，然后做一些不同的事情有多难吗？嗯，你是对的，检测代码运行的浏览器并不难，但要可靠地做到这一点却很难，因为浏览器可以撒谎。根据 W3C 标准，检测浏览器的方法很简单：

```js
window.navigator.appName
```

这个属性应该返回浏览器的名称，但是如果你在 Chrome、Safari 或 Internet Explorer 上尝试它，它们都会返回相同的值，“Netscape”。怎么回事？正如我已经说过的，浏览器可以撒谎。

### 提示

**下载示例代码**

你可以从[`www.packtpub.com`](http://www.packtpub.com)的你的账户中下载示例代码文件，获取你购买的所有 Packt Publishing 图书。如果你在其他地方购买了本书，你可以访问[`www.packtpub.com/support`](http://www.packtpub.com/support)并注册，以直接通过电子邮件接收文件。

在 90 年代，网站开始检测访问它们的浏览器。那时，实际上只有三种浏览器：网景导航器（Netscape Navigator）、微软的 Internet Explorer 以及开创浏览器时代的浏览器，NCSA Mosaic。Mosaic 由伊利诺伊大学厄巴纳-香槟分校的国家超级计算应用中心创建。在那个时候，浏览器霸权的真正战斗在微软和网景之间展开。公司们通过为其浏览器添加新功能来进行竞争。

网景为其浏览器添加的功能之一是框架元素。它非常受欢迎。当时许多网站只有在浏览器为网景导航器时才使用框架元素。他们通过`window.navigator.appName`或`window.navigator.userAgent`来检查是否为网景。导航器的代号是 Mozilla，它包含在用户代理字符串中。后来，当微软向 IE 添加了框架元素时，网站继续不向 IE 提供基于框架的内容，因为他们只通过名称而不是通过特性检测来识别浏览器。所以，IE 开始撒谎。它从`window.navigator.appName`返回网景，并在用户代理中包含 Mozilla。现在，出于历史兼容性考虑，许多其他浏览器也在撒谎。

处理浏览器兼容性问题有两种方法。第一种方法是我们已经展示过的：浏览器检测。浏览器检测比你想象的要困难，它可能会产生意想不到的副作用，就像网站尽管 IE 支持框架，但仍然无法向其提供框架一样。第二种技术是特性检测，也称为属性嗅探。在使用某个特性之前，你应该确保浏览器支持它。虽然这通常是更难编写的代码，但对用户来说更有益。如果一个浏览器版本不支持某个特性，那么下一个版本可能会支持。特性检测是 jQuery 中使用的方法。

### 提示

**最佳实践**

使用功能检测，而不是浏览器检测。如果您需要编写代码来自己检测一个功能，而不是使用 jQuery 或其他第三方解决方案，比如 Modernizr，始终使用功能检测，绝不使用浏览器检测。

# 为什么创建了 jQuery？

创建 jQuery 的一个主要原因之一是为了让开发人员摆脱不得不检查整个浏览器上以不同方式实现的无数功能。事实上，jQuery 的座右铭是“写得更少，做得更多”。jQuery 的目标之一是让开发人员摆脱编写管道代码，而集中精力添加功能到他们的网站上。

# jQuery 的主要组成部分

第一次查看 jQuery API 页面，[`api.jquery.com`](http://api.jquery.com)，可能会令人心烦意乱。它列出了 300 多种不同的方法。不要惊慌；这里有一个方法来处理这种疯狂。大多数 API 方法可以分为几个类别。

## DOM 选择

这些是给 jQuery 起名字的方法。它们帮助在**文档对象模型**（**DOM**）中找到您正在查找的元素或元素。如果您了解浏览器 JavaScript，您可能在想什么是大不了的呢？一直都可以查询 DOM。有 `document.getElementById`、`document.getElementsByClassName` 等等。但是 jQuery 的接口比任何这些方法都要干净得多。jQuery 使用 CSS 风格的选择器来解析 DOM，并且一致地返回一个 jQuery 对象作为零个或多个元素的数组。

文档方法根据您调用的方法返回不同的内容。如果调用 `document.getElementById`，它将返回一个元素对象，如果找不到该元素，则返回 null。对于 `document.getElementsByClassName`，它返回 `HTMLCollection`，一个类似数组的对象。

## DOM 操作

一旦您找到了一个元素，通常都希望以某种方式修改它。jQuery 有一套广泛的操作方法。内置的文档方法无法比拟。jQuery 的方法允许您删除或替换标记。您还可以在旧标记之前、之后或周围插入新的标记。

## 事件

能够处理事件对于创建动态网站至关重要。虽然现代浏览器基本上都遵循标准，但几年前情况并非如此。jQuery 使得可以从同一代码库支持现代和旧的浏览器。

## 表单

互联网上有很多网站都有一个或多个论坛，用于将用户信息发送回 Web 服务器。这些方法使得将信息发送回服务器变得更加容易。

## CSS 和动画

CSS 方法是便利方法，有助于处理类和元素的位置和尺寸。与内置的 JavaScript 方法不同，它们不仅仅是简单地读取类属性的字符串；它们允许您添加、删除、切换和检查类的存在。

动画方法简单易行，但可以为您的网站增添光彩。您不再需要接受一个出现或消失的标记；现在，它可以淡入淡出，甚至滑入滑出。如果您有兴趣，还可以使用 jQuery 的效果框架来创建自己的自定义动画效果。

## Ajax

正如我们已经讨论过的那样，Ajax 是 jQuery 的主要特性之一。即使您不需要支持旧版浏览器，jQuery 的 Ajax 方法也比浏览器的方法更清晰。它们还内置了对异步成功和错误函数的支持，甚至返回一个 JavaScript promise 对象。

## 辅助功能

最后，主要的 jQuery 方法组是关于辅助函数的，例如 `.each()`，用于对集合进行迭代。jQuery 还添加了用于确定 JavaScript 对象类型的方法，并且提供了语言中奇怪缺失的功能。此外，它还添加了其他不容易归类的方法。

# 为什么会有两个维护版本的 jQuery？

几乎经过了 7 年的开发，jQuery 开始显露其陈旧之态。1.8 版本是一个重大发布版本，包括对 Sizzle 选择器引擎的重写和对动画的改进，但还需要更多。接口存在一些不一致性，有许多已弃用的方法，以及需要彻底清理的大量代码。因此，1.9 版本的发布包括了 jQuery 和 jQuery 迁移插件。

jQuery 开发团队认为 1.9 版是如此重大的变化，以至于他们创建了 jQuery 迁移插件来帮助缓解过渡。迁移插件包括了所有已弃用的方法，听起来很奇怪，但在其开发版本中，它会在控制台记录使用已弃用的方法。这使开发人员可以得到一个可工作的站点以及一个了解需要修复的内容的方法。生产版本不会进行任何额外的记录。

几个月后，2.0 版本发布了，并带来了一个朋友。开发团队继续解决平台的重量和速度问题，决定不再支持 Internet Explorer 9 以下的所有版本。jQuery 中的大量代码是专门针对旧版本 Internet Explorer 中的怪异行为编写的。差异是显著的。jQuery 1.10 的最小化版本为 93 KB，而 jQuery 2.0 的最小化版本为 83 KB，大小减少了近 11%。

因此，目前和可预见的未来，将会有两个版本的 jQuery：支持大多数浏览器的 1.x 版本，包括 Internet Explorer 的 6、7 和 8 版本。2.x 版本支持所有现代浏览器，包括 IE 9 及更高版本。重要的是要注意，这两个版本具有相同的 API，尽管它们的内部不同。

# 精简版和非精简版之间的区别

对于每个 jQuery 的分支，都有两个版本：压缩和非压缩。非压缩版本仅用于开发。它允许你在调试时轻松步进 jQuery 代码，并提供更有意义的堆栈跟踪。压缩版本应该用于生产。它经过压缩，删除了所有不必要的空白和 JavaScript 变量和内部方法的重命名。压缩减少了文件的下载时间。jQuery 2.1.1 的开发版本为 247 KB，而生产版本仅为 84 KB。

如果有必要调试压缩版本的 jQuery，可以下载源映射文件。源映射允许您访问原始调试信息，并受到所有现代浏览器的支持，包括 IE。

# 什么是内容传送网络？

网站加载速度越快，就越能鼓励游客以后返回。加快页面加载速度的另一种方法就是使用**内容传送网络**，或**CDN**。CDN 的魔力有两个方面。首先，CDN 通常位于边缘服务器上，这意味着它们不是在单个物理位置托管，而是分布在互联网的多个位置。这意味着它们可以更快地被找到和下载。其次，浏览器通常会在用户的机器上缓存静态文件，加载本地文件比从互联网下载快得多。许多大大小小的公司都使用 CDNs。因此，有可能其中一家公司正在使用你网站所需的相同副本的 jQuery，并已经在用户的机器上本地缓存。因此，当你的网站需要它时，它已经存在，你的网站免费获得了良好的性能提升。

# 总结

现代浏览器比它们几乎被遗忘的祖先功能更强大。一位新的 web 开发人员会很容易想知道为什么 jQuery 存在。在本章中，我们通过看看 jQuery 出现的原因来探讨它的存在的原因，以及在 jQuery 出现之前 web 开发的情况。然后，我们将 jQuery 的 API 分解成易于理解的主要组件。我们了解了为什么 jQuery 有两个维护的版本，以及每个版本为什么有两个不同的形式。在下一章中，我们将开始深入研究 API，学习如何编写选择器和过滤器。
