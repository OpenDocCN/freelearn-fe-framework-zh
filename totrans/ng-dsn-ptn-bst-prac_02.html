<html><head></head><body>
<div id="_idContainer023">
<h1 class="chapter-number" id="_idParaDest-45"><a id="_idTextAnchor081"/><a id="_idTextAnchor082"/><span class="koboSpan" id="kobo.1.1">2</span></h1>
<h1 id="_idParaDest-46"><a id="_idTextAnchor083"/><span class="koboSpan" id="kobo.2.1">Organizing Your Application</span></h1>
<p><span class="koboSpan" id="kobo.3.1">A messed-up project is a bug’s nest waiting to spoil your user experience. </span><span class="koboSpan" id="kobo.3.2">In addition to quality, good organization of your project from the beginning will give your team productivity and, in the case of Angular, potential improvement in the performance of </span><span class="No-Break"><span class="koboSpan" id="kobo.4.1">your application.</span></span></p>
<p><span class="koboSpan" id="kobo.5.1">In this chapter, you will learn about the function of Angular modules, the difference between these and JavaScript modules, and how to use them in the best way for </span><span class="No-Break"><span class="koboSpan" id="kobo.6.1">your project.</span></span></p>
<p><span class="koboSpan" id="kobo.7.1">You will learn about the single module app anti-pattern and how and why to avoid it. </span><span class="koboSpan" id="kobo.7.2">You will also use Angular modules to optimize the import of common components to your application using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.8.1">SharedModule</span></strong><span class="koboSpan" id="kobo.9.1"> pattern. </span><span class="koboSpan" id="kobo.9.2">Finally, you will understand how to use lazy loading to optimize your </span><span class="No-Break"><span class="koboSpan" id="kobo.10.1">application’s performance.</span></span></p>
<p><span class="koboSpan" id="kobo.11.1">In this chapter, we’re going to cover the </span><span class="No-Break"><span class="koboSpan" id="kobo.12.1">following topics:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.13.1">Organizing the application with </span><span class="No-Break"><span class="koboSpan" id="kobo.14.1">Angular modules</span></span></li>
<li><span class="koboSpan" id="kobo.15.1">The first </span><span class="No-Break"><span class="koboSpan" id="kobo.16.1">module: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.17.1">AppModule</span></strong></span></li>
<li><span class="koboSpan" id="kobo.18.1">Avoiding anti-pattern: single </span><span class="No-Break"><span class="koboSpan" id="kobo.19.1">module app</span></span></li>
<li><span class="koboSpan" id="kobo.20.1">Optimizing the usage of common modules: the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.21.1">SharedModule</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.22.1"> pattern</span></span></li>
<li><span class="koboSpan" id="kobo.23.1">Improving the size of your app: </span><span class="No-Break"><span class="koboSpan" id="kobo.24.1">lazy loading</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.25.1">By the end of this chapter, you will be able to organize your Angular application into functional and </span><span class="No-Break"><span class="koboSpan" id="kobo.26.1">optimized modules.</span></span></p>
<h1 id="_idParaDest-47"><a id="_idTextAnchor084"/><span class="koboSpan" id="kobo.27.1">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.28.1">To follow the instructions in this chapter, you’ll need </span><span class="No-Break"><span class="koboSpan" id="kobo.29.1">the following:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.30.1">Visual Studio </span><span class="No-Break"><span class="koboSpan" id="kobo.31.1">Code (</span></span><a href="https://code.visualstudio.com/Download"><span class="No-Break"><span class="koboSpan" id="kobo.32.1">https://code.visualstudio.com/Download</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.33.1">)</span></span></li>
<li><span class="koboSpan" id="kobo.34.1">Node.js 18 or </span><span class="No-Break"><span class="koboSpan" id="kobo.35.1">higher (</span></span><a href="https://nodejs.org/en/download/"><span class="No-Break"><span class="koboSpan" id="kobo.36.1">https://nodejs.org/en/download/</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.37.1">)</span></span></li>
</ul>
<p><a id="_idTextAnchor085"/><span class="koboSpan" id="kobo.38.1">The code files for this chapter are available </span><span class="No-Break"><span class="koboSpan" id="kobo.39.1">at </span></span><a href="https://github.com/PacktPublishing/Angular-Design-Patterns-and-Best-Practices/tree/main/ch2"><span class="No-Break"><span class="koboSpan" id="kobo.40.1">https://github.com/PacktPublishing/Angular-Design-Patterns-and-Best-Practices/tree/main/ch2</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.41.1">.</span></span></p>
<h1 id="_idParaDest-48"><a id="_idTextAnchor086"/><span class="koboSpan" id="kobo.42.1">Organizing the application with Angular modules</span></h1>
<p><span class="koboSpan" id="kobo.43.1">The basis for </span><a id="_idIndexMarker086"/><span class="koboSpan" id="kobo.44.1">organizing the components of an application using the framework is the Angular modules, more recognized </span><a id="_idIndexMarker087"/><span class="koboSpan" id="kobo.45.1">in the documentation and the community by the </span><span class="No-Break"><span class="koboSpan" id="kobo.46.1">name </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.47.1">NgModules</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.48.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.49.1">An Angular module</span><a id="_idIndexMarker088"/><span class="koboSpan" id="kobo.50.1"> is a TypeScript class marked with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.51.1">@NgModule</span></strong><span class="koboSpan" id="kobo.52.1"> decorator that contains metadata, as in </span><span class="No-Break"><span class="koboSpan" id="kobo.53.1">this example:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.54.1">
import { NgModule } from '@angular/core';
@NgModule({
 declarations: [SimulationComponent],
 providers:[],
 imports: [
   CommonModule,
   SharedModule,
   MatCardModule,
   MatButtonModule,
   MatSelectModule,
   MatRadioModule,ReactiveFormsModule,
 ],
 exports: [SimulationComponent],
})
export class SimulationModule </span><a id="_idTextAnchor087"/><span class="koboSpan" id="kobo.55.1">{}</span></pre> <p><span class="koboSpan" id="kobo.56.1">Let’s detail each of these types of metadata in the </span><span class="No-Break"><span class="koboSpan" id="kobo.57.1">following subsection</span><a id="_idTextAnchor088"/><span class="koboSpan" id="kobo.58.1">s.</span></span></p>
<h2 id="_idParaDest-49"><a id="_idTextAnchor089"/><span class="koboSpan" id="kobo.59.1">declarations</span></h2>
<p><span class="koboSpan" id="kobo.60.1">This </span><a id="_idIndexMarker089"/><span class="koboSpan" id="kobo.61.1">metadata contains an array of components, directives, and pipes that make up the module. </span><span class="koboSpan" id="kobo.61.2">These components must belong to only one module, otherwise, the Angular compiler will throw an error, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.62.1">Figure 2</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.63.1">.1</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.64.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer018">
<span class="koboSpan" id="kobo.65.1"><img alt="Figure 2.1 – Error message when declaring a component in more than one modu﻿le" src="image/B19562_02_1.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.66.1">Figure 2.1 – Error message when declaring a component in more than one modu</span><a id="_idTextAnchor090"/><span class="koboSpan" id="kobo.67.1">le</span></p>
<h2 id="_idParaDest-50"><a id="_idTextAnchor091"/><span class="koboSpan" id="kobo.68.1">providers</span></h2>
<p><span class="koboSpan" id="kobo.69.1">In this attribute, we</span><a id="_idIndexMarker090"/><span class="koboSpan" id="kobo.70.1"> can register the classes we want to inject using Angular’s dependency injector system, normally used for services (which will be detailed in </span><a href="B19562_05.xhtml#_idTextAnchor163"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.71.1">Chapter 5</span></em></span></a><span class="koboSpan" id="kobo.72.1">, </span><em class="italic"><span class="koboSpan" id="kobo.73.1">Angular Services and the </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.74.1">Singleton Patte</span><a id="_idTextAnchor092"/><span class="koboSpan" id="kobo.75.1">rn</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.76.1">.</span></span></p>
<h2 id="_idParaDest-51"><a id="_idTextAnchor093"/><span class="koboSpan" id="kobo.77.1">imports</span></h2>
<p><span class="koboSpan" id="kobo.78.1">In this metadata, we</span><a id="_idIndexMarker091"/><span class="koboSpan" id="kobo.79.1"> inform the modules that we want to import and use their components and services. </span><span class="koboSpan" id="kobo.79.2">For example, if we want to use Angular’s HTTP request services, we must declare the </span><strong class="source-inline"><span class="koboSpan" id="kobo.80.1">HttpClientModule</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.81.1">module here.</span></span></p>
<p><span class="koboSpan" id="kobo.82.1">It is important to know that, here, we should not import components or services, </span><span class="No-Break"><span class="koboSpan" id="kobo.83.1">only Ngmodu</span><a id="_idTextAnchor094"/><span class="koboSpan" id="kobo.84.1">les.</span></span></p>
<h2 id="_idParaDest-52"><a id="_idTextAnchor095"/><span class="koboSpan" id="kobo.85.1">exports</span></h2>
<p><span class="koboSpan" id="kobo.86.1">By default, all</span><a id="_idIndexMarker092"/><span class="koboSpan" id="kobo.87.1"> items in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.88.1">declarations</span></strong><span class="koboSpan" id="kobo.89.1"> attribute are private. </span><span class="koboSpan" id="kobo.89.2">This means that if a module contains the </span><strong class="source-inline"><span class="koboSpan" id="kobo.90.1">StateSelectorComponent</span></strong><span class="koboSpan" id="kobo.91.1"> component and another module, for example, importing the module to use this component will cause the following error </span><span class="No-Break"><span class="koboSpan" id="kobo.92.1">to occur:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer019">
<span class="koboSpan" id="kobo.93.1"><img alt="Figure 2.2 – Error message when using a component not exported correctly" src="image/B19562_02_2.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.94.1">Figure 2.2 – Error message when using a component not exported correctly</span></p>
<p><span class="koboSpan" id="kobo.95.1">To inform </span><a id="_idIndexMarker093"/><span class="koboSpan" id="kobo.96.1">Angular that the component can be used, it is necessary to declare it in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.97.1">exports</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.98.1"> metadata.</span></span></p>
<p><span class="koboSpan" id="kobo.99.1">Unlike the </span><strong class="source-inline"><span class="koboSpan" id="kobo.100.1">imports</span></strong><span class="koboSpan" id="kobo.101.1"> metadata, here, you can declare components, pipes, directives, and other modules (as we’ll see in the </span><em class="italic"><span class="koboSpan" id="kobo.102.1">Optimizing the usage of common modules – the SharedModule </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.103.1">pattern</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.104.1"> sect</span><a id="_idTextAnchor096"/><span class="koboSpan" id="kobo.105.1">ion).</span></span></p>
<p><span class="koboSpan" id="kobo.106.1">Now that we know how to declare a module, let’s study the module that is generated when creating an </span><span class="No-Break"><span class="koboSpan" id="kobo.107.1">Angular project.</span></span></p>
<h1 id="_idParaDest-53"><a id="_idTextAnchor097"/><span class="koboSpan" id="kobo.108.1">The first module – AppModule</span></h1>
<p><span class="koboSpan" id="kobo.109.1">The </span><a id="_idIndexMarker094"/><span class="koboSpan" id="kobo.110.1">modules in Angular are so important to the framework that when you start a project, it automatically creates a module </span><span class="No-Break"><span class="koboSpan" id="kobo.111.1">called </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.112.1">AppModule</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.113.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.114.1">This module contains all the parameters we studied in the previous section (</span><strong class="source-inline"><span class="koboSpan" id="kobo.115.1">declarations</span></strong><span class="koboSpan" id="kobo.116.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.117.1">providers</span></strong><span class="koboSpan" id="kobo.118.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.119.1">imports</span></strong><span class="koboSpan" id="kobo.120.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.121.1">exports</span></strong><span class="koboSpan" id="kobo.122.1">), plus one additional parameter: </span><strong class="source-inline"><span class="koboSpan" id="kobo.123.1">bootstrap</span></strong><span class="koboSpan" id="kobo.124.1">. </span><span class="koboSpan" id="kobo.124.2">This module contains the first component to be injected into the application’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.125.1">index.html</span></strong><span class="koboSpan" id="kobo.126.1"> file and will be the root of your Angular application’s </span><span class="No-Break"><span class="koboSpan" id="kobo.127.1">component tree.</span></span></p>
<p><span class="koboSpan" id="kobo.128.1">You may be wondering which </span><strong class="source-inline"><span class="koboSpan" id="kobo.129.1">index.html</span></strong><span class="koboSpan" id="kobo.130.1"> file and which tree </span><span class="No-Break"><span class="koboSpan" id="kobo.131.1">this is.</span></span></p>
<p><span class="koboSpan" id="kobo.132.1">As we</span><a id="_idIndexMarker095"/><span class="koboSpan" id="kobo.133.1"> described in </span><a href="B19562_01.xhtml#_idTextAnchor017"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.134.1">Chapter 1</span></em></span></a><span class="koboSpan" id="kobo.135.1">, </span><em class="italic"><span class="koboSpan" id="kobo.136.1">Starting Projects the Right Way</span></em><span class="koboSpan" id="kobo.137.1">, Angular is a framework for </span><strong class="bold"><span class="koboSpan" id="kobo.138.1">single-page applications</span></strong><span class="koboSpan" id="kobo.139.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.140.1">SPAs</span></strong><span class="koboSpan" id="kobo.141.1">), and the </span><strong class="source-inline"><span class="koboSpan" id="kobo.142.1">index.html</span></strong><span class="koboSpan" id="kobo.143.1"> file is in fact the only </span><em class="italic"><span class="koboSpan" id="kobo.144.1">page</span></em><span class="koboSpan" id="kobo.145.1"> delivered by the web server to </span><span class="No-Break"><span class="koboSpan" id="kobo.146.1">its user.</span></span></p>
<p><span class="koboSpan" id="kobo.147.1">All interfaces rendered by the </span><a id="_idIndexMarker096"/><span class="koboSpan" id="kobo.148.1">Angular engine (called </span><strong class="bold"><span class="koboSpan" id="kobo.149.1">Ivy</span></strong><span class="koboSpan" id="kobo.150.1">) are built from this </span><strong class="source-inline"><span class="koboSpan" id="kobo.151.1">index.html</span></strong><span class="koboSpan" id="kobo.152.1"> file and the first component is described in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.153.1">bootstrap</span></strong><span class="koboSpan" id="kobo.154.1"> metadata. </span><span class="koboSpan" id="kobo.154.2">This rendering obeys a data structure of the logical tree type, and the root of this tree is this </span><span class="No-Break"><span class="koboSpan" id="kobo.155.1">first co</span><a id="_idTextAnchor098"/><span class="koboSpan" id="kobo.156.1">mponent.</span></span></p>
<h2 id="_idParaDest-54"><a id="_idTextAnchor099"/><span class="koboSpan" id="kobo.157.1">What is the difference between Angular and JavaScript modules?</span></h2>
<p><span class="koboSpan" id="kobo.158.1">Almost all </span><a id="_idIndexMarker097"/><span class="koboSpan" id="kobo.159.1">programming languages offer a way for their developers to organize functions, classes, and variables in one or more files, allowing greater maintainability and separation </span><span class="No-Break"><span class="koboSpan" id="kobo.160.1">of concerns.</span></span></p>
<p><span class="koboSpan" id="kobo.161.1">In</span><a id="_idIndexMarker098"/><span class="koboSpan" id="kobo.162.1"> JavaScript, sometime after its creation and several proposals, the concept of language modules was consolidated. </span><span class="koboSpan" id="kobo.162.2">The best way to explain this concept is to demonstrate it with an example. </span><span class="koboSpan" id="kobo.162.3">First, we create a </span><strong class="source-inline"><span class="koboSpan" id="kobo.163.1">sum.mjs</span></strong><span class="koboSpan" id="kobo.164.1"> file – the </span><strong class="source-inline"><span class="koboSpan" id="kobo.165.1">sum</span></strong><span class="koboSpan" id="kobo.166.1"> function that receives two numbers and returns their sum. </span><span class="koboSpan" id="kobo.166.2">The important thing here is that we use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.167.1">export</span></strong><span class="koboSpan" id="kobo.168.1"> keyword to indicate that we want to use it in a scope outside of its </span><span class="No-Break"><span class="koboSpan" id="kobo.169.1">source file:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.170.1">
export function sum(numberA,numberB){
  return numberA + numberB;
}</span></pre> <p><span class="koboSpan" id="kobo.171.1"> In the </span><strong class="source-inline"><span class="koboSpan" id="kobo.172.1">index.mjs</span></strong><span class="koboSpan" id="kobo.173.1"> file, we will use the created function and, for that, we make the declaration in the first line of the file. </span><span class="koboSpan" id="kobo.173.2">Using the reserved word </span><strong class="source-inline"><span class="koboSpan" id="kobo.174.1">import</span></strong><span class="koboSpan" id="kobo.175.1">, we indicate which function and which file it </span><span class="No-Break"><span class="koboSpan" id="kobo.176.1">is from:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.177.1">
import {sum} from './sum.mjs';
const numberA = 5;
const numberB = 10;
console.log(sum(numberA,numberB));</span></pre> <p><span class="koboSpan" id="kobo.178.1">You may be wondering why the </span><strong class="source-inline"><span class="koboSpan" id="kobo.179.1">.mjs</span></strong><span class="koboSpan" id="kobo.180.1"> extension is used. </span><span class="koboSpan" id="kobo.180.2">It’s because, in the example, we are using Node.js to execute, and this type of module – </span><strong class="bold"><span class="koboSpan" id="kobo.181.1">ECMAScript modules</span></strong><span class="koboSpan" id="kobo.182.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.183.1">ESM</span></strong><span class="koboSpan" id="kobo.184.1">), as the </span><a id="_idIndexMarker099"/><span class="koboSpan" id="kobo.185.1">official name of the Javascript language is ECMAScript – was introduced in </span><span class="No-Break"><span class="koboSpan" id="kobo.186.1">version 14.</span></span></p>
<p><span class="koboSpan" id="kobo.187.1">Angular, as</span><a id="_idIndexMarker100"/><span class="koboSpan" id="kobo.188.1"> well as all other SPA frameworks, uses JavaScript modules in its development, and we can notice in any Angular component or service that we export the classes and import using </span><span class="No-Break"><span class="koboSpan" id="kobo.189.1">the ESM:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.190.1">
import { Component } from '@angular/core';
@Component({
  selector: 'app-home',
  templateUrl: './home.component.html',
  styleUrls: ['./home.component.css']
})
export class HomeComponent {</span></pre> <p><span class="koboSpan" id="kobo.191.1">In the preceding </span><a id="_idIndexMarker101"/><span class="koboSpan" id="kobo.192.1">code snippet, we are importing the </span><strong class="source-inline"><span class="koboSpan" id="kobo.193.1">Component</span></strong><span class="koboSpan" id="kobo.194.1"> decorator from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.195.1">@angular/core</span></strong><span class="koboSpan" id="kobo.196.1"> library and exporting the </span><strong class="source-inline"><span class="koboSpan" id="kobo.197.1">HomeComponent</span></strong><span class="koboSpan" id="kobo.198.1"> class to use in other parts of</span><a id="_idTextAnchor100"/> <span class="No-Break"><span class="koboSpan" id="kobo.199.1">our project.</span></span></p>
<h2 id="_idParaDest-55"><a id="_idTextAnchor101"/><span class="koboSpan" id="kobo.200.1">Modules type</span></h2>
<p><span class="koboSpan" id="kobo.201.1">Now that</span><a id="_idIndexMarker102"/><span class="koboSpan" id="kobo.202.1"> we understand and have reinforced the concept of modules in the Angular framework, let’s divide our application and make better use of this feature. </span><span class="koboSpan" id="kobo.202.2">There is no fixed rule for organizing the modules of an application, but the Angular team and the community suggest the separation of modules based on the grouping of functionalities with </span><span class="No-Break"><span class="koboSpan" id="kobo.203.1">common characteristics.</span></span></p>
<p><span class="koboSpan" id="kobo.204.1">Based on this thought, we can have the following types of </span><span class="No-Break"><span class="koboSpan" id="kobo.205.1">Angular modules:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.206.1">Business </span><span class="No-Break"><span class="koboSpan" id="kobo.207.1">domain modules</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.208.1">Com</span><a id="_idTextAnchor102"/><span class="koboSpan" id="kobo.209.1">ponent modules</span></span></li>
</ul>
<h3><span class="koboSpan" id="kobo.210.1">Business domain modules</span></h3>
<p><span class="koboSpan" id="kobo.211.1">An application will serve one or more user workflows. </span><span class="koboSpan" id="kobo.211.2">This type of module aims to group these flows </span><a id="_idIndexMarker103"/><span class="koboSpan" id="kobo.212.1">based on the affinity of the interfaces that compose them. </span><span class="koboSpan" id="kobo.212.2">For example, in an application for resource management, we can have the accounting module and the </span><span class="No-Break"><span class="koboSpan" id="kobo.213.1">inventory module.</span></span></p>
<p><span class="koboSpan" id="kobo.214.1">In the </span><a id="_idIndexMarker104"/><span class="koboSpan" id="kobo.215.1">application available in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.216.1">ch2</span></strong><span class="koboSpan" id="kobo.217.1"> folder, there is the </span><em class="italic"><span class="koboSpan" id="kobo.218.1">talktalk</span></em><span class="koboSpan" id="kobo.219.1"> application that we will use in this and other chapters to put our knowledge into practice. </span><span class="koboSpan" id="kobo.219.2">In the project folder, let’s create the </span><strong class="source-inline"><span class="koboSpan" id="kobo.220.1">home</span></strong><span class="koboSpan" id="kobo.221.1"> module with the </span><span class="No-Break"><span class="koboSpan" id="kobo.222.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.223.1">
ng g m home</span></pre> <p><span class="koboSpan" id="kobo.224.1">In this command, we use the Angular CLI, </span><strong class="source-inline"><span class="koboSpan" id="kobo.225.1">ng</span></strong><span class="koboSpan" id="kobo.226.1">, and the abbreviations </span><strong class="source-inline"><span class="koboSpan" id="kobo.227.1">g</span></strong><span class="koboSpan" id="kobo.228.1"> for </span><strong class="bold"><span class="koboSpan" id="kobo.229.1">generate</span></strong><span class="koboSpan" id="kobo.230.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.231.1">m</span></strong><span class="koboSpan" id="kobo.232.1"> for </span><strong class="bold"><span class="koboSpan" id="kobo.233.1">module</span></strong><span class="koboSpan" id="kobo.234.1">. </span><span class="koboSpan" id="kobo.234.2">Then we give the name of the </span><span class="No-Break"><span class="koboSpan" id="kobo.235.1">module, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.236.1">home</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.237.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.238.1">Let’s create the </span><strong class="source-inline"><span class="koboSpan" id="kobo.239.1">Page</span></strong><span class="koboSpan" id="kobo.240.1"> component that will represent the application’s home page and, since we are using Angular material, we will use the Angular CLI to generate a page with a side menu using the </span><span class="No-Break"><span class="koboSpan" id="kobo.241.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.242.1">
ng generate @angular/material:navigation home/home</span></pre> <p><span class="koboSpan" id="kobo.243.1">The Angular CLI, besides creating the component, also edited the </span><strong class="source-inline"><span class="koboSpan" id="kobo.244.1">home.module.ts</span></strong><span class="koboSpan" id="kobo.245.1"> file by adding it to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.246.1">declarations</span></strong><span class="koboSpan" id="kobo.247.1"> attribute. </span><span class="koboSpan" id="kobo.247.2">Change this file as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.248.1">following example:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.249.1">
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { HomeComponent } from './home/home.component';
import { LayoutModule } from '@angular/cdk/layout';
import { MatToolbarModule } from '@angular/material/toolbar';
import { MatButtonModule } from '@angular/material/button';
import { MatSidenavModule } from '@angular/material/sidenav';
import { MatIconModule } from '@angular/material/icon';
import { MatListModule } from '@angular/material/list';
@NgModule({
 declarations: [HomeComponent],
 imports: [
   CommonModule,
   LayoutModule,
   MatToolbarModule,
   MatButtonModule,
   MatSidenavModule,
   MatIconModule,
   MatListModule,
 ],
 exports: [HomeComponent],
})
export class HomeModule {}</span></pre> <p><span class="koboSpan" id="kobo.250.1">In </span><a id="_idIndexMarker105"/><span class="koboSpan" id="kobo.251.1">this module, we will export the </span><strong class="source-inline"><span class="koboSpan" id="kobo.252.1">HomeComponent</span></strong><span class="koboSpan" id="kobo.253.1"> component</span><a id="_idIndexMarker106"/><span class="koboSpan" id="kobo.254.1"> to use in the application’s route. </span><span class="koboSpan" id="kobo.254.2">In the </span><strong class="source-inline"><span class="koboSpan" id="kobo.255.1">app.module.ts</span></strong><span class="koboSpan" id="kobo.256.1"> file, import the module </span><span class="No-Break"><span class="koboSpan" id="kobo.257.1">as follows:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.258.1">
import { NgModule } from '@angular/core';
import { BrowserModule } from '@angular/platform-browser';
import { AppRoutingModule } from './app-routing.module';
import { AppComponent } from './app.component';
import { BrowserAnimationsModule } from '@angular/platform-browser/animations';
import { HomeModule } from './home/home.module';
@NgModule({
 declarations: [
   AppComponent
 ],
 imports: [
   BrowserModule,
   AppRoutingModule,
   BrowserAnimationsModule,
   HomeModule
 ],
 providers: [],
 bootstrap: [AppComponent]
})
export class AppModule { }</span></pre> <p><span class="koboSpan" id="kobo.259.1">With the </span><a id="_idIndexMarker107"/><span class="koboSpan" id="kobo.260.1">module in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.261.1">import</span></strong><span class="koboSpan" id="kobo.262.1"> attribute </span><a id="_idIndexMarker108"/><span class="koboSpan" id="kobo.263.1">of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.264.1">NgModule</span></strong><span class="koboSpan" id="kobo.265.1"> metadata, we can change the route in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.266.1">app-routing.module.ts</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.267.1"> file:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.268.1">
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';
import { HomeComponent } from './home/home/home.component';
const routes: Routes = [
  { path: '', pathMatch: 'full', redirectTo: 'home' },
  {
    path: 'home',
    component: HomeComponent
  },
];
@NgModule({
 imports: [RouterModule.forRoot(routes)],
 exports: [RouterModule],
})
export class AppRoutingModule {}</span></pre> <p><span class="koboSpan" id="kobo.269.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.270.1">routes</span></strong><span class="koboSpan" id="kobo.271.1"> component</span><a id="_idIndexMarker109"/><span class="koboSpan" id="kobo.272.1"> is also </span><strong class="source-inline"><span class="koboSpan" id="kobo.273.1">NgModule</span></strong><span class="koboSpan" id="kobo.274.1">, however, it is</span><a id="_idIndexMarker110"/><span class="koboSpan" id="kobo.275.1"> specialized in organizing routes, and imports and exports only </span><strong class="source-inline"><span class="koboSpan" id="kobo.276.1">RouterModule</span></strong><span class="koboSpan" id="kobo.277.1"> from Angular. </span><span class="koboSpan" id="kobo.277.2">Here, in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.278.1">routes</span></strong><span class="koboSpan" id="kobo.279.1"> array, we create the direction </span><span class="No-Break"><span class="koboSpan" id="kobo.280.1">for </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.281.1">HomeComponent</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.282.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.283.1">Running the </span><strong class="source-inline"><span class="koboSpan" id="kobo.284.1">ng serve --o</span></strong><span class="koboSpan" id="kobo.285.1"> command, we get the application’s </span><span class="No-Break"><span class="koboSpan" id="kobo.286.1">home page:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer020">
<span class="koboSpan" id="kobo.287.1"><img alt="Figure 2.3 – talktalk sample a﻿pplication menu page" src="image/B19562_02_3.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.288.1">Figure 2.3 – talktalk sample a</span><a id="_idTextAnchor103"/><span class="koboSpan" id="kobo.289.1">pplication menu page</span></p>
<h3><span class="koboSpan" id="kobo.290.1">Component modules</span></h3>
<p><span class="koboSpan" id="kobo.291.1">The</span><a id="_idIndexMarker111"/><span class="koboSpan" id="kobo.292.1"> purpose of this module is to group directive </span><a id="_idIndexMarker112"/><span class="koboSpan" id="kobo.293.1">components and pipes that will be reused by business domain components and even other components. </span><span class="koboSpan" id="kobo.293.2">Even using a component library such as Angular Material, your system will need custom components according to the business rules of your </span><span class="No-Break"><span class="koboSpan" id="kobo.294.1">business domain.</span></span></p>
<p><span class="koboSpan" id="kobo.295.1">This type of component </span><a id="_idIndexMarker113"/><span class="koboSpan" id="kobo.296.1">has components, directives, and pipes</span><a id="_idIndexMarker114"/><span class="koboSpan" id="kobo.297.1"> declared in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.298.1">declaration</span></strong><span class="koboSpan" id="kobo.299.1"> attribute and exported in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.300.1">exports</span></strong><span class="koboSpan" id="kobo.301.1"> attribute, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.302.1">following example:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.303.1">
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { StatesSelectorComponent } from './states-selector/states-selector.component';
import { MatSelectModule } from '@angular/material/select';
@NgModule({
 declarations: [StatesSelectorComponent],
 imports: [CommonModule, MatSelectModule],
 exports: [StatesSelectorComponent],
})
export class ComponentsModule {}</span></pre> <p><span class="koboSpan" id="kobo.304.1">Separating the project into business domain modules and components will organize your code and improve its maintainability. </span><span class="koboSpan" id="kobo.304.2">Let’s analyze a common anti-pattern</span><a id="_idTextAnchor104"/><span class="koboSpan" id="kobo.305.1"> in </span><span class="No-Break"><span class="koboSpan" id="kobo.306.1">Angular applications.</span></span></p>
<h1 id="_idParaDest-56"><a id="_idTextAnchor105"/><span class="koboSpan" id="kobo.307.1">Avoiding anti-pattern – single module app</span></h1>
<p><span class="koboSpan" id="kobo.308.1">When</span><a id="_idIndexMarker115"/><span class="koboSpan" id="kobo.309.1"> we are </span><a id="_idIndexMarker116"/><span class="koboSpan" id="kobo.310.1">starting to study and develop with Angular, it is very common not to pay much attention to the organization and use of the application modules. </span><span class="koboSpan" id="kobo.310.2">As we studied at the beginning of this chapter, NgModules are so fundamental to Angular that as soon as we start a project, the Angular CLI creates the first module for the </span><span class="No-Break"><span class="koboSpan" id="kobo.311.1">project, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.312.1">AppModule</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.313.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.314.1">In theory, only this module is necessary for your application to work. </span><span class="koboSpan" id="kobo.314.2">From there, we can declare all the components and directives, and import all the libraries that the project might need, as we </span><a id="_idIndexMarker117"/><span class="koboSpan" id="kobo.315.1">can see </span><a id="_idIndexMarker118"/><span class="koboSpan" id="kobo.316.1">in the </span><span class="No-Break"><span class="koboSpan" id="kobo.317.1">following example:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.318.1">
import { NgModule } from '@angular/core';
. </span><span class="koboSpan" id="kobo.318.2">. </span><span class="koboSpan" id="kobo.318.3">.
</span><span class="koboSpan" id="kobo.318.4">@NgModule({
 declarations: [
   AppComponent,
   StatesSelectorComponent,
   HomeComponent,
   SimulationComponent
 ],
 imports: [
   BrowserModule,AppRoutingModule,
   BrowserAnimationsModule,HttpClientModule,
   ReactiveFormsModule,LayoutModule,
   MatToolbarModule,MatButtonModule,
   MatSidenavModule,MatIconModule,
   MatListModule,
 ],
 bootstrap: [AppComponent]
})
export class AppModule { }</span></pre> <p><span class="koboSpan" id="kobo.319.1">This approach has some problems and is an anti-pattern that we’ll call a </span><span class="No-Break"><span class="koboSpan" id="kobo.320.1">single-module app.</span></span></p>
<p><span class="koboSpan" id="kobo.321.1">The problems we have here are </span><span class="No-Break"><span class="koboSpan" id="kobo.322.1">as follows:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.323.1">Disorganized folder structure</span></strong><span class="koboSpan" id="kobo.324.1">: The team will soon not know which components belong to which area of the project. </span><span class="koboSpan" id="kobo.324.2">As the project grows, this file will get bigger and </span><span class="No-Break"><span class="koboSpan" id="kobo.325.1">more confusing.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.326.1">Bundle size and build time</span></strong><span class="koboSpan" id="kobo.327.1">: Angular has several build and bundle optimizations that depend on the definition of application modules. </span><span class="koboSpan" id="kobo.327.2">Staying in just one module, these optimizations are not </span><span class="No-Break"><span class="koboSpan" id="kobo.328.1">very effective.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.329.1">Component maintainability and update issues</span></strong><span class="koboSpan" id="kobo.330.1">: As this file grows, the team will have difficulties deprecating no longer used components or updating those components where the Angular CLI is unable to </span><span class="No-Break"><span class="koboSpan" id="kobo.331.1">update automatically.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.332.1">The </span><a id="_idIndexMarker119"/><span class="koboSpan" id="kobo.333.1">solution</span><a id="_idIndexMarker120"/><span class="koboSpan" id="kobo.334.1"> to this anti-pattern is to apply what we learned in this chapter: separating modules into business domain (or feature) and </span><span class="No-Break"><span class="koboSpan" id="kobo.335.1">component modules.</span></span></p>
<p><span class="koboSpan" id="kobo.336.1">We can use </span><strong class="source-inline"><span class="koboSpan" id="kobo.337.1">NgModel</span></strong><span class="koboSpan" id="kobo.338.1"> to reduce the repetition of importing common components in the application, as we will see in the next section </span><a id="_idTextAnchor106"/><span class="koboSpan" id="kobo.339.1">about the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.340.1">SharedModule</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.341.1"> pattern.</span></span></p>
<h1 id="_idParaDest-57"><a id="_idTextAnchor107"/><span class="koboSpan" id="kobo.342.1">Optimizing the usage of common modules – the SharedModule pattern</span></h1>
<p><span class="koboSpan" id="kobo.343.1">If we look at Angular projects, we</span><a id="_idIndexMarker121"/><span class="koboSpan" id="kobo.344.1"> will see patterns of use of </span><a id="_idIndexMarker122"/><span class="koboSpan" id="kobo.345.1">modules such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.346.1">HttpModule</span></strong><span class="koboSpan" id="kobo.347.1">, as in the </span><span class="No-Break"><span class="koboSpan" id="kobo.348.1">following example:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.349.1">
import { NgModule } from '@angular/core';
import { CommonModule } from '@angular/common';
import { HomeComponent } from './home/home.component';
import { LayoutModule } from '@angular/cdk/layout';
import { MatToolbarModule } from '@angular/material/toolbar';
import { MatButtonModule } from '@angular/material/button';
import { MatSidenavModule } from '@angular/material/sidenav';
import { MatIconModule } from '@angular/material/icon';
import { MatListModule } from '@angular/material/list';
@NgModule({
 declarations: [HomeComponent],
 imports: [
   CommonModule,
   LayoutModule,
   MatToolbarModule,
   MatButtonModule,
   MatSidenavModule,
   MatIconModule,
   MatListModule,
 ],
 exports: [HomeComponent],
})
export class HomeModule {}</span></pre> <p><span class="koboSpan" id="kobo.350.1">To avoid code </span><a id="_idIndexMarker123"/><span class="koboSpan" id="kobo.351.1">duplication and also make it easier for new team members, don’t forget </span><a id="_idIndexMarker124"/><span class="koboSpan" id="kobo.352.1">to add an important module to the project; we can create the </span><strong class="source-inline"><span class="koboSpan" id="kobo.353.1">SharedModule</span></strong><span class="koboSpan" id="kobo.354.1"> call to centralize the common dependencies of an </span><span class="No-Break"><span class="koboSpan" id="kobo.355.1">Angular project.</span></span></p>
<p><span class="koboSpan" id="kobo.356.1">Let’s do this in our project using the </span><span class="No-Break"><span class="koboSpan" id="kobo.357.1">Angular CLI:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.358.1">
ng generate module shared</span></pre> <p><span class="koboSpan" id="kobo.359.1">In the newly generated file, we will place the Angular </span><span class="No-Break"><span class="koboSpan" id="kobo.360.1">Material dependencies:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.361.1">
import { NgModule } from '@angular/core';
...
</span><span class="koboSpan" id="kobo.361.2">@NgModule({
 imports: [
   CommonModule,
   LayoutModule,
   MatToolbarModule,
   MatButtonModule,
   MatSidenavModule,
   MatIconModule,
   MatListModule,
 ],
 exports: [
   CommonModule,
   LayoutModule,
   MatToolbarModule,
   MatButtonModule,
   MatSidenavModule,
   MatIconModule,
   MatListModule,
 ]
})
export class SharedModule { }</span></pre> <p><span class="koboSpan" id="kobo.362.1">In this module, we </span><a id="_idIndexMarker125"/><span class="koboSpan" id="kobo.363.1">are importing Angular Material’s dependencies </span><a id="_idIndexMarker126"/><span class="koboSpan" id="kobo.364.1">and exporting the same dependencies, without declaring any component, directive, </span><span class="No-Break"><span class="koboSpan" id="kobo.365.1">or pipe.</span></span></p>
<p><span class="koboSpan" id="kobo.366.1">In the </span><strong class="source-inline"><span class="koboSpan" id="kobo.367.1">home.module.ts</span></strong><span class="koboSpan" id="kobo.368.1"> file, we can refactor to </span><span class="No-Break"><span class="koboSpan" id="kobo.369.1">use </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.370.1">SharedModule</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.371.1">:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.372.1">
import { NgModule } from '@angular/core';
import { HomeComponent } from './home/home.component';
import { SharedModule } from '../shared/shared.module';
@NgModule({
 declarations: [HomeComponent],
 imports: [
   SharedModule
 ],
 exports: [HomeComponent],
})
export class HomeModule {}</span></pre> <p><span class="koboSpan" id="kobo.373.1">Notice how the</span><a id="_idIndexMarker127"/><span class="koboSpan" id="kobo.374.1"> file </span><a id="_idIndexMarker128"/><span class="koboSpan" id="kobo.375.1">has become much more succinct and easier to read </span><span class="No-Break"><span class="koboSpan" id="kobo.376.1">using </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.377.1">SharedModule</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.378.1">.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.379.1">Important</span></p>
<p class="callout"><span class="koboSpan" id="kobo.380.1">The modules present in </span><strong class="source-inline"><span class="koboSpan" id="kobo.381.1">SharedModule</span></strong><span class="koboSpan" id="kobo.382.1"> must be modules common to the majority of modules in your project, as this can increase the size of the module’s bundle. </span><span class="koboSpan" id="kobo.382.2">If the module needs some specific dependency, you must declare it in that dependency and not </span><span class="No-Break"><span class="koboSpan" id="kobo.383.1">in </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.384.1">SharedModule</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.385.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.386.1">In the next topic, we’ll see a feature that will improve your user’s experience and is based on o</span><a id="_idTextAnchor108"/><span class="koboSpan" id="kobo.387.1">rganizing the application </span><span class="No-Break"><span class="koboSpan" id="kobo.388.1">into modules.</span></span></p>
<h1 id="_idParaDest-58"><a id="_idTextAnchor109"/><span class="koboSpan" id="kobo.389.1">Improving the size of your app – lazy loading</span></h1>
<p><span class="koboSpan" id="kobo.390.1">A good strategy</span><a id="_idIndexMarker129"/><span class="koboSpan" id="kobo.391.1"> for separating modules from your Angular application </span><a id="_idIndexMarker130"/><span class="koboSpan" id="kobo.392.1">will increase your team’s productivity and improve code organization. </span><span class="koboSpan" id="kobo.392.2">But another advantage that will impact the quality for your user is the use of the lazy loading technique </span><span class="No-Break"><span class="koboSpan" id="kobo.393.1">for modules.</span></span></p>
<p><span class="koboSpan" id="kobo.394.1">If we run the </span><a id="_idIndexMarker131"/><span class="koboSpan" id="kobo.395.1">build process of the sample application using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.396.1">ng build</span></strong><span class="koboSpan" id="kobo.397.1"> command, we can see the </span><span class="No-Break"><span class="koboSpan" id="kobo.398.1">following message:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer021">
<span class="koboSpan" id="kobo.399.1"><img alt="Figure 2.4 – Sample application bundle size" src="image/B19562_02_4.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.400.1">Figure 2.4 – Sample application bundle size</span></p>
<p><span class="koboSpan" id="kobo.401.1">The size of our</span><a id="_idIndexMarker132"/><span class="koboSpan" id="kobo.402.1"> application’s initial bundle (the </span><strong class="source-inline"><span class="koboSpan" id="kobo.403.1">main.ts</span></strong><span class="koboSpan" id="kobo.404.1"> file) is 94.73 kB, which may seem small, but for the size of our application with few features, it is a </span><span class="No-Break"><span class="koboSpan" id="kobo.405.1">considerable size.</span></span></p>
<p><span class="koboSpan" id="kobo.406.1">As the project has more features, the tendency is for this initial bundle to increase considerably, harming our users’ experience as they will initially need to download a larger file. </span><span class="koboSpan" id="kobo.406.2">This problem particularly manifests itself in environments where the internet is not very good, such as </span><span class="No-Break"><span class="koboSpan" id="kobo.407.1">3G networks.</span></span></p>
<p><span class="koboSpan" id="kobo.408.1">To reduce this file and consequently improve our user experience, the ideal is to have smaller packages and for these packages to be loaded only when necessary – that is, in a </span><span class="No-Break"><span class="koboSpan" id="kobo.409.1">lazy way.</span></span></p>
<p><span class="koboSpan" id="kobo.410.1">We are going to refactor our project, and the first step we have already taken is to separate the functionalities into feature modules (in the </span><em class="italic"><span class="koboSpan" id="kobo.411.1">Avoiding anti-pattern – single module app</span></em><span class="koboSpan" id="kobo.412.1"> section, we explained the danger of not separating the application modules, and without a doubt, the size of the bundle is the most impactful for </span><span class="No-Break"><span class="koboSpan" id="kobo.413.1">the user).</span></span></p>
<p><span class="koboSpan" id="kobo.414.1">Now, let’s create a route file for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.415.1">Home</span></strong><span class="koboSpan" id="kobo.416.1"> module. </span><span class="koboSpan" id="kobo.416.2">As the module already exists, let’s manually create the </span><strong class="source-inline"><span class="koboSpan" id="kobo.417.1">home-routing.module.ts</span></strong><span class="koboSpan" id="kobo.418.1"> file in the same folder as the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.419.1">home.module.ts</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.420.1"> file.</span></span></p>
<p><span class="koboSpan" id="kobo.421.1">In this file, we </span><a id="_idIndexMarker133"/><span class="koboSpan" id="kobo.422.1">will add the </span><span class="No-Break"><span class="koboSpan" id="kobo.423.1">following code:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.424.1">
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';
import { HomeComponent } from './home/home.component';
const routes: Routes = [
  {
    path: '',
    component: HomeComponent,
  },
];
@NgModule({
 imports: [RouterModule.forChild(routes)],
 exports: [RouterModule],
})
export class HomeRoutingModule {}</span></pre> <p><span class="koboSpan" id="kobo.425.1">This route file is similar </span><a id="_idIndexMarker134"/><span class="koboSpan" id="kobo.426.1">to the application’s main route file, with the difference that </span><strong class="source-inline"><span class="koboSpan" id="kobo.427.1">@NgModule</span></strong><span class="koboSpan" id="kobo.428.1">’s import uses the </span><strong class="source-inline"><span class="koboSpan" id="kobo.429.1">forChild</span></strong><span class="koboSpan" id="kobo.430.1"> method instead of </span><strong class="source-inline"><span class="koboSpan" id="kobo.431.1">forRoot</span></strong><span class="koboSpan" id="kobo.432.1">. </span><span class="koboSpan" id="kobo.432.2">This is because this module is a subroute of the </span><span class="No-Break"><span class="koboSpan" id="kobo.433.1">main route.</span></span></p>
<p><span class="koboSpan" id="kobo.434.1">Another important detail to note is that the chosen path for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.435.1">HomeComponent</span></strong><span class="koboSpan" id="kobo.436.1"> component is empty. </span><span class="koboSpan" id="kobo.436.2">We can explain this because the main route file that defines the </span><strong class="source-inline"><span class="koboSpan" id="kobo.437.1">/home</span></strong><span class="koboSpan" id="kobo.438.1"> route and how this module represents the </span><strong class="source-inline"><span class="koboSpan" id="kobo.439.1">/home</span></strong><span class="koboSpan" id="kobo.440.1"> component is </span><span class="No-Break"><span class="koboSpan" id="kobo.441.1">already defined.</span></span></p>
<p><span class="koboSpan" id="kobo.442.1">In the </span><strong class="source-inline"><span class="koboSpan" id="kobo.443.1">home.module.ts</span></strong><span class="koboSpan" id="kobo.444.1"> file, let’s change it to import the </span><span class="No-Break"><span class="koboSpan" id="kobo.445.1">route file:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.446.1">
import { NgModule } from '@angular/core';
import { HomeComponent } from './home/home.component';
import { SharedModule } from '../shared/shared.module';
import { HomeRoutingModule } from './home-routing.module';
@NgModule({
 declarations: [HomeComponent],
 imports: [
   SharedModule,HomeRoutingModule
 ]
})
export class HomeModule {}</span></pre> <p><span class="koboSpan" id="kobo.447.1">In this file, we </span><a id="_idIndexMarker135"/><span class="koboSpan" id="kobo.448.1">also</span><a id="_idIndexMarker136"/><span class="koboSpan" id="kobo.449.1"> removed the export of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.450.1">HomeComponent</span></strong><span class="koboSpan" id="kobo.451.1"> component because the </span><strong class="source-inline"><span class="koboSpan" id="kobo.452.1">Home</span></strong><span class="koboSpan" id="kobo.453.1"> module route file will </span><span class="No-Break"><span class="koboSpan" id="kobo.454.1">load it.</span></span></p>
<p><span class="koboSpan" id="kobo.455.1">In the project’s main route file, </span><strong class="source-inline"><span class="koboSpan" id="kobo.456.1">app-routing.module.ts</span></strong><span class="koboSpan" id="kobo.457.1">, let’s refactor it </span><span class="No-Break"><span class="koboSpan" id="kobo.458.1">as follows:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.459.1">
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';
const routes: Routes = [
  { path: '', pathMatch: 'full', redirectTo: 'home' },
  {
    path: 'home',
    loadChildren: () =&gt;
      import('./home/home.module').then((file) =&gt; file.HomeModule),
  },
];
@NgModule({
 imports: [RouterModule.forRoot(routes)],
 exports: [RouterModule],
})
export class AppRoutingModule {}</span></pre> <p><span class="koboSpan" id="kobo.460.1">In this code, the </span><a id="_idIndexMarker137"/><span class="koboSpan" id="kobo.461.1">most important part is the </span><strong class="source-inline"><span class="koboSpan" id="kobo.462.1">loadChildren</span></strong><span class="koboSpan" id="kobo.463.1"> attribute. </span><span class="koboSpan" id="kobo.463.2">This is where we configure the lazy load, as we pass to Angular’s route mechanism a function that returns an </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.464.1">import</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.465.1"> promise.</span></span></p>
<p><span class="koboSpan" id="kobo.466.1">Note that</span><a id="_idIndexMarker138"/><span class="koboSpan" id="kobo.467.1"> the </span><strong class="source-inline"><span class="koboSpan" id="kobo.468.1">import</span></strong><span class="koboSpan" id="kobo.469.1"> function is not an Angular function, but a standard JavaScript function that allows dynamic loading of code. </span><span class="koboSpan" id="kobo.469.2">Angular’s route engine uses this language feature to bring </span><span class="No-Break"><span class="koboSpan" id="kobo.470.1">this functionality.</span></span></p>
<p><span class="koboSpan" id="kobo.471.1">Finally, in the main module, </span><strong class="source-inline"><span class="koboSpan" id="kobo.472.1">AppModule</span></strong><span class="koboSpan" id="kobo.473.1">, let’s remove the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.474.1">HomeModule</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.475.1"> import:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.476.1">
import { NgModule } from '@angular/core';
import { BrowserModule } from '@angular/platform-browser';
import { AppRoutingModule } from './app-routing.module';
import { AppComponent } from './app.component';
import { BrowserAnimationsModule } from '@angular/platform-browser/animations';
@NgModule({
 declarations: [
   AppComponent
 ],
 imports: [
   BrowserModule,
   AppRoutingModule,
   BrowserAnimationsModule
 ],
 providers: [],
 bootstrap: [AppComponent]
})
export class AppModule { }</span></pre> <p><span class="koboSpan" id="kobo.477.1">Running our </span><a id="_idIndexMarker139"/><span class="koboSpan" id="kobo.478.1">application with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.479.1">ng serve</span></strong><span class="koboSpan" id="kobo.480.1"> command, we didn’t notice any</span><a id="_idIndexMarker140"/><span class="koboSpan" id="kobo.481.1"> difference. </span><span class="koboSpan" id="kobo.481.2">However, when executing the </span><strong class="source-inline"><span class="koboSpan" id="kobo.482.1">ng build</span></strong><span class="koboSpan" id="kobo.483.1"> command, we can notice the </span><span class="No-Break"><span class="koboSpan" id="kobo.484.1">following diagnosis:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer022">
<span class="koboSpan" id="kobo.485.1"><img alt="Figure 2.5 – Application bundle size after refactoring with lazy loading" src="image/B19562_02_5.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.486.1">Figure 2.5 – Application bundle size after refactoring with lazy loading</span></p>
<p><span class="koboSpan" id="kobo.487.1">The Angular build process has separated the </span><strong class="source-inline"><span class="koboSpan" id="kobo.488.1">Home</span></strong><span class="koboSpan" id="kobo.489.1"> module into its own bundle and the </span><strong class="source-inline"><span class="koboSpan" id="kobo.490.1">main.ts</span></strong><span class="koboSpan" id="kobo.491.1"> bundle has been made smaller. </span><span class="koboSpan" id="kobo.491.2">The difference may seem small but note that, this way, our application can scale and grow in complexity and the initial bundle will remain small or grow </span><span class="No-Break"><span class="koboSpan" id="kobo.492.1">very little.</span></span></p>
<p><span class="koboSpan" id="kobo.493.1">The new features continue to exist and be loaded by the application, but the initial loading will be faster, and these new features will be downloaded on demand only when the user accesses the route they want, gi</span><a id="_idTextAnchor110"/><span class="koboSpan" id="kobo.494.1">ving a very positive fluidity </span><span class="No-Break"><span class="koboSpan" id="kobo.495.1">and responsiveness.</span></span></p>
<h1 id="_idParaDest-59"><a id="_idTextAnchor111"/><span class="koboSpan" id="kobo.496.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.497.1">In this chapter, we studied the Angular modules in detail and how we can use them for the organization and performance of our applications. </span><span class="koboSpan" id="kobo.497.2">We learned the difference between Angular modules and JavaScript modules, and we saw each attribute of a module definition and the types that we can create in the project. </span><span class="koboSpan" id="kobo.497.3">Finally, we learned how to avoid the single module app anti-pattern and how to create </span><span class="No-Break"><span class="koboSpan" id="kobo.498.1">the </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.499.1">SharedModule</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.500.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.501.1">We reiterated our example application to use lazy loading of bundles, which demonstrates that good module organization reflects performance and fluidity for our users. </span><span class="koboSpan" id="kobo.501.2">Now, you are able to organize your application in such a way that it can scale and increase in complexity and features without compromising the maintainability of </span><span class="No-Break"><span class="koboSpan" id="kobo.502.1">the project.</span></span></p>
<p><span class="koboSpan" id="kobo.503.1">In the next chapter, we will learn how to use TypeScript effectively and productively for our </span><span class="No-Break"><span class="koboSpan" id="kobo.504.1">Angular projects.</span></span></p>
</div>
</body></html>