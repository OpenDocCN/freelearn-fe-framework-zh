<html><head></head><body>
  <div class="Basic-Text-Frame" id="_idContainer267">
   <h1 class="chapterNumber">
    <span class="koboSpan" id="kobo.1.1">
     11
    </span>
   </h1>
   <h1 class="chapterTitle" id="_idParaDest-204">
    <span class="koboSpan" id="kobo.2.1">
     Handling Application Errors
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.3.1">
     Application errors are an integral part of the lifetime of a web application.
    </span>
    <span class="koboSpan" id="kobo.3.2">
     They can occur either during runtime or while developing the application.
    </span>
    <span class="koboSpan" id="kobo.3.3">
     Possible causes of a runtime error are an HTTP request that failed or an incomplete HTML form.
    </span>
    <span class="koboSpan" id="kobo.3.4">
     A web application must handle runtime errors and mitigate unwanted effects to ensure a smooth user experience.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.4.1">
     Development errors usually happen when we do not properly use a programming language or framework according to its semantics.
    </span>
    <span class="koboSpan" id="kobo.4.2">
     In this case, errors may override the compiler and surface in the application while running.
    </span>
    <span class="koboSpan" id="kobo.4.3">
     Development errors can be mitigated by following best practices and recommended coding techniques.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.5.1">
     In this chapter, we will learn how to handle different types of errors in an Angular application and understand errors from the framework itself.
    </span>
    <span class="koboSpan" id="kobo.5.2">
     We will explore the following concepts in more detail:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.6.1">
      Handling runtime errors
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.7.1">
      Demystifying framework errors
     </span>
    </li>
   </ul>
   <h1 class="heading-1" id="_idParaDest-205">
    <span class="koboSpan" id="kobo.8.1">
     Technical requirements
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.9.1">
     The code samples described in this chapter can be found in the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.10.1">
      ch11
     </span>
    </code>
    <span class="koboSpan" id="kobo.11.1">
     folder of the following GitHub repository:
    </span>
   </p>
   <p class="normal">
    <a href="https://www.github.com/PacktPublishing/Learning-Angular-Fifth-Edition ">
     <span class="url">
      <span class="koboSpan" id="kobo.12.1">
       https://www.github.com/PacktPublishing/Learning-Angular-Fifth-Edition
      </span>
     </span>
    </a>
   </p>
   <h1 class="heading-1" id="_idParaDest-206">
    <span class="koboSpan" id="kobo.13.1">
     Handling runtime errors
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.14.1">
     The most common runtime
    </span>
    <a id="_idIndexMarker680">
    </a>
    <span class="koboSpan" id="kobo.15.1">
     errors in an Angular application come from the interaction with an HTTP API.
    </span>
    <span class="koboSpan" id="kobo.15.2">
     Entering the wrong login credentials or sending data in the wrong format can result in an HTTP error.
    </span>
    <span class="koboSpan" id="kobo.15.3">
     An Angular application can handle HTTP errors in the following ways:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.16.1">
      Explicitly during the execution of a particular HTTP request
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.17.1">
      Globally in the global error handler of the application
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.18.1">
      Centrally using an HTTP interceptor
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.19.1">
     In the following section, we will explore how to handle an HTTP error in a specific HTTP request.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-207">
    <span class="koboSpan" id="kobo.20.1">
     Catching HTTP request errors
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.21.1">
     Handling errors in HTTP
    </span>
    <a id="_idIndexMarker681">
    </a>
    <span class="koboSpan" id="kobo.22.1">
     requests
    </span>
    <a id="_idIndexMarker682">
    </a>
    <span class="koboSpan" id="kobo.23.1">
     typically requires manually inspecting the information returned in the error response object.
    </span>
    <span class="koboSpan" id="kobo.23.2">
     RxJS provides the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.24.1">
      catchError
     </span>
    </code>
    <span class="koboSpan" id="kobo.25.1">
     operator to simplify that.
    </span>
    <span class="koboSpan" id="kobo.25.2">
     It can catch potential errors when initiating an HTTP request with the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.26.1">
      pipe
     </span>
    </code>
    <span class="koboSpan" id="kobo.27.1">
     operator.
    </span>
   </p>
   <div class="note">
    <p class="normal">
     <span class="koboSpan" id="kobo.28.1">
      You will need the source code of the Angular application we created in
     </span>
     <em class="chapterRef">
      <span class="koboSpan" id="kobo.29.1">
       Chapter 10
      </span>
     </em>
     <span class="koboSpan" id="kobo.30.1">
      ,
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.31.1">
       Collecting User Data with Forms
      </span>
     </em>
     <span class="koboSpan" id="kobo.32.1">
      , to follow along with the rest of the chapter.
     </span>
    </p>
   </div>
   <p class="normal">
    <span class="koboSpan" id="kobo.33.1">
     Letâ€™s see how we could use the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.34.1">
      catchError
     </span>
    </code>
    <span class="koboSpan" id="kobo.35.1">
     operator to catch HTTP errors while fetching the product list in our application:
    </span>
   </p>
   <ol>
    <li class="numberedList" value="1">
     <span class="koboSpan" id="kobo.36.1">
      Open the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.37.1">
       products.service.ts
      </span>
     </code>
     <span class="koboSpan" id="kobo.38.1">
      file and import the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.39.1">
       catchError
      </span>
     </code>
     <span class="koboSpan" id="kobo.40.1">
      and
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.41.1">
       throwError
      </span>
     </code>
     <span class="koboSpan" id="kobo.42.1">
      operators from the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.43.1">
       rxjs
      </span>
     </code>
     <span class="koboSpan" id="kobo.44.1">
      npm package:
     </span>
     <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.45.1">import</span></span><span class="koboSpan" id="kobo.46.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.47.1">Observable</span></span><span class="koboSpan" id="kobo.48.1">, map, </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.49.1">of</span></span><span class="koboSpan" id="kobo.50.1">, tap, </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.51.1">catchError, throwError</span></strong></span><span class="koboSpan" id="kobo.52.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.53.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.54.1">'rxjs'</span></span><span class="koboSpan" id="kobo.55.1">;
</span></code></pre>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.56.1">
      Import the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.57.1">
       HttpErrorResponse
      </span>
     </code>
     <span class="koboSpan" id="kobo.58.1">
      interface from the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.59.1">
       @angular/common/http
      </span>
     </code>
     <span class="koboSpan" id="kobo.60.1">
      namespace:
     </span>
     <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.61.1">import</span></span><span class="koboSpan" id="kobo.62.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.63.1">HttpClient</span></span><span class="koboSpan" id="kobo.64.1">, </span><span class="hljs-title"><span class="koboSpan" id="kobo.65.1">HttpParams</span></span><span class="koboSpan" id="kobo.66.1">, </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.67.1">HttpErrorResponse</span></strong></span><span class="koboSpan" id="kobo.68.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.69.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.70.1">'@angular/common/http'</span></span><span class="koboSpan" id="kobo.71.1">;
</span></code></pre>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.72.1">
      Modify the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.73.1">
       getProducts
      </span>
     </code>
     <span class="koboSpan" id="kobo.74.1">
      method accordingly:
     </span>
     <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.75.1">getProducts</span></span><span class="koboSpan" id="kobo.76.1">(limit?: </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.77.1">number</span></span><span class="koboSpan" id="kobo.78.1">): </span><span class="hljs-title"><span class="koboSpan" id="kobo.79.1">Observable</span></span><span class="koboSpan" id="kobo.80.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.81.1">Product</span></span><span class="koboSpan" id="kobo.82.1">[]&gt; {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.83.1">if</span></span><span class="koboSpan" id="kobo.84.1"> (</span><span class="hljs-variable"><span class="koboSpan" id="kobo.85.1">this</span></span><span class="koboSpan" id="kobo.86.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.87.1">products</span></span><span class="koboSpan" id="kobo.88.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.89.1">length</span></span><span class="koboSpan" id="kobo.90.1"> === </span><span class="hljs-number"><span class="koboSpan" id="kobo.91.1">0</span></span><span class="koboSpan" id="kobo.92.1">) {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.93.1">const</span></span><span class="koboSpan" id="kobo.94.1"> options = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.95.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.96.1">HttpParams</span></span><span class="koboSpan" id="kobo.97.1">().</span><span class="hljs-title"><span class="koboSpan" id="kobo.98.1">set</span></span><span class="koboSpan" id="kobo.99.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.100.1">'limit'</span></span><span class="koboSpan" id="kobo.101.1">, limit || </span><span class="hljs-number"><span class="koboSpan" id="kobo.102.1">10</span></span><span class="koboSpan" id="kobo.103.1">);
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.104.1">return</span></span> <span class="hljs-variable"><span class="koboSpan" id="kobo.105.1">this</span></span><span class="koboSpan" id="kobo.106.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.107.1">http</span></span><span class="koboSpan" id="kobo.108.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.109.1">get</span></span><span class="koboSpan" id="kobo.110.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.111.1">Product</span></span><span class="koboSpan" id="kobo.112.1">[]&gt;(</span><span class="hljs-variable"><span class="koboSpan" id="kobo.113.1">this</span></span><span class="koboSpan" id="kobo.114.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.115.1">productsUrl</span></span><span class="koboSpan" id="kobo.116.1">, {
      </span><span class="hljs-attr"><span class="koboSpan" id="kobo.117.1">params</span></span><span class="koboSpan" id="kobo.118.1">: options
    }).</span><span class="hljs-title"><span class="koboSpan" id="kobo.119.1">pipe</span></span><span class="koboSpan" id="kobo.120.1">(
      </span><span class="hljs-title"><span class="koboSpan" id="kobo.121.1">map</span></span><span class="koboSpan" id="kobo.122.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.123.1">products</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.124.1"> =&gt;</span></span><span class="koboSpan" id="kobo.125.1"> {
        </span><span class="hljs-variable"><span class="koboSpan" id="kobo.126.1">this</span></span><span class="koboSpan" id="kobo.127.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.128.1">products</span></span><span class="koboSpan" id="kobo.129.1"> = products;
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.130.1">return</span></span><span class="koboSpan" id="kobo.131.1"> products;
      }),
      </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.132.1">catchError((error: HttpErrorResponse) =&gt; {</span></strong></span>
        <span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.133.1">console.error(error);</span></strong></span>
        <span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.134.1">return throwError(() =&gt; error);</span></strong></span>
      <span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.135.1">})</span></strong></span><span class="koboSpan" id="kobo.136.1">
    );
  }
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.137.1">return</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.138.1">of</span></span><span class="koboSpan" id="kobo.139.1">(</span><span class="hljs-variable"><span class="koboSpan" id="kobo.140.1">this</span></span><span class="koboSpan" id="kobo.141.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.142.1">products</span></span><span class="koboSpan" id="kobo.143.1">);
}
</span></code></pre>
    </li>
   </ol>
   <p class="normal-one">
    <span class="koboSpan" id="kobo.144.1">
     The signature of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.145.1">
      catchError
     </span>
    </code>
    <span class="koboSpan" id="kobo.146.1">
     operator contains the actual
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.147.1">
      HttpErrorResponse
     </span>
    </code>
    <span class="koboSpan" id="kobo.148.1">
     object that is returned from the server.
    </span>
    <span class="koboSpan" id="kobo.148.2">
     After catching the error, we use the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.149.1">
      throwError
     </span>
    </code>
    <span class="koboSpan" id="kobo.150.1">
     operator, which re-throws the error as an observable.
    </span>
   </p>
   <div class="packt_tip-one">
    <p class="normal">
     <span class="koboSpan" id="kobo.151.1">
      Alternatively, we could have used the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.152.1">
       throw
      </span>
     </code>
     <span class="koboSpan" id="kobo.153.1">
      keyword from the standard web API methods to throw the error.
     </span>
     <span class="koboSpan" id="kobo.153.2">
      However the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.154.1">
       throwError
      </span>
     </code>
     <span class="koboSpan" id="kobo.155.1">
      method is, most of the time, overkill.
     </span>
     <span class="koboSpan" id="kobo.155.2">
      Please use it accordingly.
     </span>
    </p>
   </div>
   <p class="normal-one">
    <span class="koboSpan" id="kobo.156.1">
     This way, we
    </span>
    <a id="_idIndexMarker683">
    </a>
    <span class="koboSpan" id="kobo.157.1">
     ensure
    </span>
    <a id="_idIndexMarker684">
    </a>
    <span class="koboSpan" id="kobo.158.1">
     that the application execution will continue and complete without causing a potential memory leak.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.159.1">
     In a real-world scenario, we would probably create a helper method to log the error in a more solid tracking system and return something meaningful according to the cause of the error:
    </span>
   </p>
   <ol>
    <li class="numberedList" value="1">
     <span class="koboSpan" id="kobo.160.1">
      In the same file,
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.161.1">
       products.service.ts
      </span>
     </code>
     <span class="koboSpan" id="kobo.162.1">
      , import the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.163.1">
       HttpStatusCode
      </span>
     </code>
     <span class="koboSpan" id="kobo.164.1">
      enumeration from the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.165.1">
       @angular/common/http
      </span>
     </code>
     <span class="koboSpan" id="kobo.166.1">
      namespace:
     </span>
     <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.167.1">import</span></span><span class="koboSpan" id="kobo.168.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.169.1">HttpClient</span></span><span class="koboSpan" id="kobo.170.1">, </span><span class="hljs-title"><span class="koboSpan" id="kobo.171.1">HttpParams</span></span><span class="koboSpan" id="kobo.172.1">, </span><span class="hljs-title"><span class="koboSpan" id="kobo.173.1">HttpErrorResponse</span></span><span class="koboSpan" id="kobo.174.1">, </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.175.1">HttpStatusCode</span></strong></span><span class="koboSpan" id="kobo.176.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.177.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.178.1">'@angular/common/http'</span></span><span class="koboSpan" id="kobo.179.1">;
</span></code></pre>
    </li>
   </ol>
   <p class="normal-one">
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.180.1">
      HttpStatusCode
     </span>
    </code>
    <span class="koboSpan" id="kobo.181.1">
     is an enumeration that contains a list of all HTTP response status codes.
    </span>
   </p>
   <ol>
    <li class="numberedList" value="2">
     <span class="koboSpan" id="kobo.182.1">
      Create the following method in the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.183.1">
       ProductsService
      </span>
     </code>
     <span class="koboSpan" id="kobo.184.1">
      class:
     </span>
     <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.185.1">private</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.186.1">handleError</span></span><span class="koboSpan" id="kobo.187.1">(</span><span class="hljs-attr"><span class="koboSpan" id="kobo.188.1">error</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.189.1">: </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.190.1">HttpErrorResponse</span></span><span class="koboSpan" id="kobo.191.1">) {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.192.1">let</span></span><span class="koboSpan" id="kobo.193.1"> message = </span><span class="hljs-string"><span class="koboSpan" id="kobo.194.1">''</span></span><span class="koboSpan" id="kobo.195.1">;
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.196.1">switch</span></span><span class="koboSpan" id="kobo.197.1">(error.</span><span class="hljs-property"><span class="koboSpan" id="kobo.198.1">status</span></span><span class="koboSpan" id="kobo.199.1">) {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.200.1">case</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.201.1">HttpStatusCode</span></span><span class="koboSpan" id="kobo.202.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.203.1">InternalServerError</span></span><span class="koboSpan" id="kobo.204.1">:
      message = </span><span class="hljs-string"><span class="koboSpan" id="kobo.205.1">'Server error'</span></span><span class="koboSpan" id="kobo.206.1">;
      </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.207.1">break</span></span><span class="koboSpan" id="kobo.208.1">;
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.209.1">case</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.210.1">HttpStatusCode</span></span><span class="koboSpan" id="kobo.211.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.212.1">BadRequest</span></span><span class="koboSpan" id="kobo.213.1">:
      message = </span><span class="hljs-string"><span class="koboSpan" id="kobo.214.1">'Request error'</span></span><span class="koboSpan" id="kobo.215.1">;
      </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.216.1">break</span></span><span class="koboSpan" id="kobo.217.1">;
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.218.1">default</span></span><span class="koboSpan" id="kobo.219.1">:
      message = </span><span class="hljs-string"><span class="koboSpan" id="kobo.220.1">'Unknown error'</span></span><span class="koboSpan" id="kobo.221.1">;
  }
  
  </span><span class="hljs-variable"><span class="koboSpan" id="kobo.222.1">console</span></span><span class="koboSpan" id="kobo.223.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.224.1">error</span></span><span class="koboSpan" id="kobo.225.1">(message, error.</span><span class="hljs-property"><span class="koboSpan" id="kobo.226.1">error</span></span><span class="koboSpan" id="kobo.227.1">);
  
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.228.1">return</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.229.1">throwError</span></span><span class="koboSpan" id="kobo.230.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.231.1">() =&gt;</span></span><span class="koboSpan" id="kobo.232.1"> error);
}
</span></code></pre>
    </li>
   </ol>
   <p class="normal-one">
    <span class="koboSpan" id="kobo.233.1">
     The preceding
    </span>
    <a id="_idIndexMarker685">
    </a>
    <span class="koboSpan" id="kobo.234.1">
     method
    </span>
    <a id="_idIndexMarker686">
    </a>
    <span class="koboSpan" id="kobo.235.1">
     logs a different message in the browser console according to the error status.
    </span>
    <span class="koboSpan" id="kobo.235.2">
     It uses a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.236.1">
      switch
     </span>
    </code>
    <span class="koboSpan" id="kobo.237.1">
     statement to differentiate between internal server errors and bad requests.
    </span>
    <span class="koboSpan" id="kobo.237.2">
     For any other errors, it falls back to the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.238.1">
      default
     </span>
    </code>
    <span class="koboSpan" id="kobo.239.1">
     statement, which logs a generic message in the console.
    </span>
   </p>
   <ol>
    <li class="numberedList" value="3">
     <span class="koboSpan" id="kobo.240.1">
      Refactor the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.241.1">
       getProducts
      </span>
     </code>
     <span class="koboSpan" id="kobo.242.1">
      method to use the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.243.1">
       handleError
      </span>
     </code>
     <span class="koboSpan" id="kobo.244.1">
      method to catch errors:
     </span>
     <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.245.1">getProducts</span></span><span class="koboSpan" id="kobo.246.1">(limit?: </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.247.1">number</span></span><span class="koboSpan" id="kobo.248.1">): </span><span class="hljs-title"><span class="koboSpan" id="kobo.249.1">Observable</span></span><span class="koboSpan" id="kobo.250.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.251.1">Product</span></span><span class="koboSpan" id="kobo.252.1">[]&gt; {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.253.1">if</span></span><span class="koboSpan" id="kobo.254.1"> (</span><span class="hljs-variable"><span class="koboSpan" id="kobo.255.1">this</span></span><span class="koboSpan" id="kobo.256.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.257.1">products</span></span><span class="koboSpan" id="kobo.258.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.259.1">length</span></span><span class="koboSpan" id="kobo.260.1"> === </span><span class="hljs-number"><span class="koboSpan" id="kobo.261.1">0</span></span><span class="koboSpan" id="kobo.262.1">) {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.263.1">const</span></span><span class="koboSpan" id="kobo.264.1"> options = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.265.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.266.1">HttpParams</span></span><span class="koboSpan" id="kobo.267.1">().</span><span class="hljs-title"><span class="koboSpan" id="kobo.268.1">set</span></span><span class="koboSpan" id="kobo.269.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.270.1">'limit'</span></span><span class="koboSpan" id="kobo.271.1">, limit || </span><span class="hljs-number"><span class="koboSpan" id="kobo.272.1">10</span></span><span class="koboSpan" id="kobo.273.1">);
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.274.1">return</span></span> <span class="hljs-variable"><span class="koboSpan" id="kobo.275.1">this</span></span><span class="koboSpan" id="kobo.276.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.277.1">http</span></span><span class="koboSpan" id="kobo.278.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.279.1">get</span></span><span class="koboSpan" id="kobo.280.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.281.1">Product</span></span><span class="koboSpan" id="kobo.282.1">[]&gt;(</span><span class="hljs-variable"><span class="koboSpan" id="kobo.283.1">this</span></span><span class="koboSpan" id="kobo.284.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.285.1">productsUrl</span></span><span class="koboSpan" id="kobo.286.1">, {
      </span><span class="hljs-attr"><span class="koboSpan" id="kobo.287.1">params</span></span><span class="koboSpan" id="kobo.288.1">: options
    }).</span><span class="hljs-title"><span class="koboSpan" id="kobo.289.1">pipe</span></span><span class="koboSpan" id="kobo.290.1">(
      </span><span class="hljs-title"><span class="koboSpan" id="kobo.291.1">map</span></span><span class="koboSpan" id="kobo.292.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.293.1">products</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.294.1"> =&gt;</span></span><span class="koboSpan" id="kobo.295.1"> {
        </span><span class="hljs-variable"><span class="koboSpan" id="kobo.296.1">this</span></span><span class="koboSpan" id="kobo.297.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.298.1">products</span></span><span class="koboSpan" id="kobo.299.1"> = products;
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.300.1">return</span></span><span class="koboSpan" id="kobo.301.1"> products;
      }),
      </span><span class="hljs-title"><span class="koboSpan" id="kobo.302.1">catchError</span></span><span class="koboSpan" id="kobo.303.1">(</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.304.1">this.handleError</span></strong></span><span class="koboSpan" id="kobo.305.1">)
    );
  }
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.306.1">return</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.307.1">of</span></span><span class="koboSpan" id="kobo.308.1">(</span><span class="hljs-variable"><span class="koboSpan" id="kobo.309.1">this</span></span><span class="koboSpan" id="kobo.310.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.311.1">products</span></span><span class="koboSpan" id="kobo.312.1">);
}
</span></code></pre>
    </li>
   </ol>
   <p class="normal">
    <span class="koboSpan" id="kobo.313.1">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.314.1">
      handleError
     </span>
    </code>
    <span class="koboSpan" id="kobo.315.1">
     method currently manages HTTP errors originating only from the HTTP response.
    </span>
    <span class="koboSpan" id="kobo.315.2">
     However, other errors can occur in an Angular application from the client side, such as a request that did not reach the server due to a network error or an exception thrown in
    </span>
    <a id="_idIndexMarker687">
    </a>
    <span class="koboSpan" id="kobo.316.1">
     an RxJS
    </span>
    <a id="_idIndexMarker688">
    </a>
    <span class="koboSpan" id="kobo.317.1">
     operator.
    </span>
    <span class="koboSpan" id="kobo.317.2">
     To handle any of the previous errors, we should add a new
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.318.1">
      case
     </span>
    </code>
    <span class="koboSpan" id="kobo.319.1">
     statement in the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.320.1">
      handleError
     </span>
    </code>
    <span class="koboSpan" id="kobo.321.1">
     method:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.322.1">private</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.323.1">handleError</span></span><span class="koboSpan" id="kobo.324.1">(</span><span class="hljs-attr"><span class="koboSpan" id="kobo.325.1">error</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.326.1">: </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.327.1">HttpErrorResponse</span></span><span class="koboSpan" id="kobo.328.1">) {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.329.1">let</span></span><span class="koboSpan" id="kobo.330.1"> message = </span><span class="hljs-string"><span class="koboSpan" id="kobo.331.1">''</span></span><span class="koboSpan" id="kobo.332.1">;
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.333.1">switch</span></span><span class="koboSpan" id="kobo.334.1">(error.</span><span class="hljs-property"><span class="koboSpan" id="kobo.335.1">status</span></span><span class="koboSpan" id="kobo.336.1">) {
    </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.337.1">case 0:</span></strong></span>
      <span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.338.1">message = 'Client error';</span></strong></span>
      <span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.339.1">break;</span></strong></span>
    <span class="hljs-keyword"><span class="koboSpan" id="kobo.340.1">case</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.341.1">HttpStatusCode</span></span><span class="koboSpan" id="kobo.342.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.343.1">InternalServerError</span></span><span class="koboSpan" id="kobo.344.1">:
      message = </span><span class="hljs-string"><span class="koboSpan" id="kobo.345.1">'Server error'</span></span><span class="koboSpan" id="kobo.346.1">;
      </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.347.1">break</span></span><span class="koboSpan" id="kobo.348.1">;
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.349.1">case</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.350.1">HttpStatusCode</span></span><span class="koboSpan" id="kobo.351.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.352.1">BadRequest</span></span><span class="koboSpan" id="kobo.353.1">:
      message = </span><span class="hljs-string"><span class="koboSpan" id="kobo.354.1">'Request error'</span></span><span class="koboSpan" id="kobo.355.1">;
      </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.356.1">break</span></span><span class="koboSpan" id="kobo.357.1">;
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.358.1">default</span></span><span class="koboSpan" id="kobo.359.1">:
      message = </span><span class="hljs-string"><span class="koboSpan" id="kobo.360.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.361.1">Unknown error'</span></span><span class="koboSpan" id="kobo.362.1">;
  }
  
  </span><span class="hljs-variable"><span class="koboSpan" id="kobo.363.1">console</span></span><span class="koboSpan" id="kobo.364.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.365.1">error</span></span><span class="koboSpan" id="kobo.366.1">(message, error.</span><span class="hljs-property"><span class="koboSpan" id="kobo.367.1">error</span></span><span class="koboSpan" id="kobo.368.1">);
  
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.369.1">return</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.370.1">throwError</span></span><span class="koboSpan" id="kobo.371.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.372.1">() =&gt;</span></span><span class="koboSpan" id="kobo.373.1"> error);
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.374.1">
     In the preceding snippet, an error with a status of
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.375.1">
      0
     </span>
    </code>
    <span class="koboSpan" id="kobo.376.1">
     indicates that it is an error that occurred on the client side of the application.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.377.1">
     Error handling in HTTP requests could be combined with a mechanism that retries a given HTTP call a specific amount of times before handling the error.
    </span>
    <span class="koboSpan" id="kobo.377.2">
     There is an RxJS operator for nearly everything, even one for retrying HTTP requests.
    </span>
    <span class="koboSpan" id="kobo.377.3">
     It accepts the number of retries where the particular request has to be executed until it completes successfully:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.378.1">getProducts</span></span><span class="koboSpan" id="kobo.379.1">(limit?: </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.380.1">number</span></span><span class="koboSpan" id="kobo.381.1">): </span><span class="hljs-title"><span class="koboSpan" id="kobo.382.1">Observable</span></span><span class="koboSpan" id="kobo.383.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.384.1">Product</span></span><span class="koboSpan" id="kobo.385.1">[]&gt; {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.386.1">if</span></span><span class="koboSpan" id="kobo.387.1"> (</span><span class="hljs-variable"><span class="koboSpan" id="kobo.388.1">this</span></span><span class="koboSpan" id="kobo.389.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.390.1">products</span></span><span class="koboSpan" id="kobo.391.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.392.1">length</span></span><span class="koboSpan" id="kobo.393.1"> === </span><span class="hljs-number"><span class="koboSpan" id="kobo.394.1">0</span></span><span class="koboSpan" id="kobo.395.1">) {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.396.1">const</span></span><span class="koboSpan" id="kobo.397.1"> options = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.398.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.399.1">HttpParams</span></span><span class="koboSpan" id="kobo.400.1">().</span><span class="hljs-title"><span class="koboSpan" id="kobo.401.1">set</span></span><span class="koboSpan" id="kobo.402.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.403.1">'limit'</span></span><span class="koboSpan" id="kobo.404.1">, limit || </span><span class="hljs-number"><span class="koboSpan" id="kobo.405.1">10</span></span><span class="koboSpan" id="kobo.406.1">);
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.407.1">return</span></span> <span class="hljs-variable"><span class="koboSpan" id="kobo.408.1">this</span></span><span class="koboSpan" id="kobo.409.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.410.1">http</span></span><span class="koboSpan" id="kobo.411.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.412.1">get</span></span><span class="koboSpan" id="kobo.413.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.414.1">Product</span></span><span class="koboSpan" id="kobo.415.1">[]&gt;(</span><span class="hljs-variable"><span class="koboSpan" id="kobo.416.1">this</span></span><span class="koboSpan" id="kobo.417.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.418.1">productsUrl</span></span><span class="koboSpan" id="kobo.419.1">, {
      </span><span class="hljs-attr"><span class="koboSpan" id="kobo.420.1">params</span></span><span class="koboSpan" id="kobo.421.1">: options
    }).</span><span class="hljs-title"><span class="koboSpan" id="kobo.422.1">pipe</span></span><span class="koboSpan" id="kobo.423.1">(
      </span><span class="hljs-title"><span class="koboSpan" id="kobo.424.1">map</span></span><span class="koboSpan" id="kobo.425.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.426.1">products</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.427.1"> =&gt;</span></span><span class="koboSpan" id="kobo.428.1"> {
        </span><span class="hljs-variable"><span class="koboSpan" id="kobo.429.1">this</span></span><span class="koboSpan" id="kobo.430.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.431.1">products</span></span><span class="koboSpan" id="kobo.432.1"> = products;
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.433.1">return</span></span><span class="koboSpan" id="kobo.434.1"> products;
      }),
      </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.435.1">retry(2)</span></strong></span><span class="koboSpan" id="kobo.436.1">,
      </span><span class="hljs-title"><span class="koboSpan" id="kobo.437.1">catchError</span></span><span class="koboSpan" id="kobo.438.1">(</span><span class="hljs-variable"><span class="koboSpan" id="kobo.439.1">this</span></span><span class="koboSpan" id="kobo.440.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.441.1">handleError</span></span><span class="koboSpan" id="kobo.442.1">)
    );
  }
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.443.1">return</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.444.1">of</span></span><span class="koboSpan" id="kobo.445.1">(</span><span class="hljs-variable"><span class="koboSpan" id="kobo.446.1">this</span></span><span class="koboSpan" id="kobo.447.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.448.1">products</span></span><span class="koboSpan" id="kobo.449.1">);
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.450.1">
     We learned that we use the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.451.1">
      catchError
     </span>
    </code>
    <span class="koboSpan" id="kobo.452.1">
     RxJS operator to capture errors.
    </span>
    <span class="koboSpan" id="kobo.452.2">
     The way we handle it depends on the scenario.
    </span>
    <span class="koboSpan" id="kobo.452.3">
     In our case, we created a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.453.1">
      handleError
     </span>
    </code>
    <span class="koboSpan" id="kobo.454.1">
     method for all HTTP calls in a service.
    </span>
    <span class="koboSpan" id="kobo.454.2">
     In a real-world scenario, we would follow the same approach of error handling in other Angular services of an application.
    </span>
    <span class="koboSpan" id="kobo.454.3">
     Creating one method for each service would not be convenient and does not scale well.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.455.1">
     Alternatively, we
    </span>
    <a id="_idIndexMarker689">
    </a>
    <span class="koboSpan" id="kobo.456.1">
     could utilize the
    </span>
    <a id="_idIndexMarker690">
    </a>
    <span class="koboSpan" id="kobo.457.1">
     global error handler that Angular provides to handle errors in a central place.
    </span>
    <span class="koboSpan" id="kobo.457.2">
     We will learn how to create a global error handler in the next section.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-208">
    <span class="koboSpan" id="kobo.458.1">
     Creating a global error handler
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.459.1">
     The Angular framework
    </span>
    <a id="_idIndexMarker691">
    </a>
    <span class="koboSpan" id="kobo.460.1">
     provides
    </span>
    <a id="_idIndexMarker692">
    </a>
    <span class="koboSpan" id="kobo.461.1">
     the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.462.1">
      ErrorHandler
     </span>
    </code>
    <span class="koboSpan" id="kobo.463.1">
     class for handling errors globally in an Angular application.
    </span>
    <span class="koboSpan" id="kobo.463.2">
     The default implementation of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.464.1">
      ErrorHandler
     </span>
    </code>
    <span class="koboSpan" id="kobo.465.1">
     class prints error messages in the browser console window.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.466.1">
     To create a custom error handler for our application, we need to sub-class the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.467.1">
      ErrorHandler
     </span>
    </code>
    <span class="koboSpan" id="kobo.468.1">
     class and provide our tailored implementation for error logging:
    </span>
   </p>
   <ol>
    <li class="numberedList" value="1">
     <span class="koboSpan" id="kobo.469.1">
      Create a file named
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.470.1">
       app-error-handler.ts
      </span>
     </code>
     <span class="koboSpan" id="kobo.471.1">
      in the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.472.1">
       src\app
      </span>
     </code>
     <span class="koboSpan" id="kobo.473.1">
      folder of the Angular CLI workspace.
     </span>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.474.1">
      Open the file and add the following
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.475.1">
       import
      </span>
     </code>
     <span class="koboSpan" id="kobo.476.1">
      statements:
     </span>
     <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.477.1">import</span></span><span class="koboSpan" id="kobo.478.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.479.1">HttpErrorResponse</span></span><span class="koboSpan" id="kobo.480.1">, </span><span class="hljs-title"><span class="koboSpan" id="kobo.481.1">HttpStatusCode</span></span><span class="koboSpan" id="kobo.482.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.483.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.484.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.485.1">@angular/common/http'</span></span><span class="koboSpan" id="kobo.486.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.487.1">import</span></span><span class="koboSpan" id="kobo.488.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.489.1">ErrorHandler</span></span><span class="koboSpan" id="kobo.490.1">, </span><span class="hljs-title"><span class="koboSpan" id="kobo.491.1">Injectable</span></span><span class="koboSpan" id="kobo.492.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.493.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.494.1">'@angular/core'</span></span><span class="koboSpan" id="kobo.495.1">;
</span></code></pre>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.496.1">
      Create a TypeScript class that implements the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.497.1">
       ErrorHandler
      </span>
     </code>
     <span class="koboSpan" id="kobo.498.1">
      interface:
     </span>
     <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-meta"><span class="koboSpan" id="kobo.499.1">@Injectable</span></span><span class="koboSpan" id="kobo.500.1">()
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.501.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.502.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.503.1">AppErrorHandler</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.504.1">implements</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.505.1">ErrorHandler</span></span><span class="koboSpan" id="kobo.506.1"> {}
</span></code></pre>
    </li>
   </ol>
   <p class="normal-one">
    <span class="koboSpan" id="kobo.507.1">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.508.1">
      AppErrorHandler
     </span>
    </code>
    <span class="koboSpan" id="kobo.509.1">
     class must be decorated with the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.510.1">
      @Injectable()
     </span>
    </code>
    <span class="koboSpan" id="kobo.511.1">
     decorator because we will provide it later in the application configuration file.
    </span>
   </p>
   <ol>
    <li class="numberedList" value="4">
     <span class="koboSpan" id="kobo.512.1">
      Implement
     </span>
     <a id="_idIndexMarker693">
     </a>
     <span class="koboSpan" id="kobo.513.1">
      the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.514.1">
       handleError
      </span>
     </code>
     <span class="koboSpan" id="kobo.515.1">
      method
     </span>
     <a id="_idIndexMarker694">
     </a>
     <span class="koboSpan" id="kobo.516.1">
      from the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.517.1">
       ErrorHandler
      </span>
     </code>
     <span class="koboSpan" id="kobo.518.1">
      interface as follows:
     </span>
     <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.519.1">handleError</span></span><span class="koboSpan" id="kobo.520.1">(</span><span class="hljs-attr"><span class="koboSpan" id="kobo.521.1">error</span></span><span class="koboSpan" id="kobo.522.1">: </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.523.1">any</span></span><span class="koboSpan" id="kobo.524.1">): </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.525.1">void</span></span><span class="koboSpan" id="kobo.526.1"> {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.527.1">const</span></span><span class="koboSpan" id="kobo.528.1"> err = error.</span><span class="hljs-property"><span class="koboSpan" id="kobo.529.1">rejection</span></span><span class="koboSpan" id="kobo.530.1"> || error;
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.531.1">let</span></span><span class="koboSpan" id="kobo.532.1"> message = </span><span class="hljs-string"><span class="koboSpan" id="kobo.533.1">''</span></span><span class="koboSpan" id="kobo.534.1">;
  
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.535.1">if</span></span><span class="koboSpan" id="kobo.536.1"> (err </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.537.1">instanceof</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.538.1">HttpErrorResponse</span></span><span class="koboSpan" id="kobo.539.1">) {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.540.1">switch</span></span><span class="koboSpan" id="kobo.541.1">(err.</span><span class="hljs-property"><span class="koboSpan" id="kobo.542.1">status</span></span><span class="koboSpan" id="kobo.543.1">) {
      </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.544.1">case</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.545.1">0</span></span><span class="koboSpan" id="kobo.546.1">:
        message = </span><span class="hljs-string"><span class="koboSpan" id="kobo.547.1">'Client error'</span></span><span class="koboSpan" id="kobo.548.1">;
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.549.1">break</span></span><span class="koboSpan" id="kobo.550.1">;
      </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.551.1">case</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.552.1">HttpStatusCode</span></span><span class="koboSpan" id="kobo.553.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.554.1">InternalServerError</span></span><span class="koboSpan" id="kobo.555.1">:
        message = </span><span class="hljs-string"><span class="koboSpan" id="kobo.556.1">'Server error'</span></span><span class="koboSpan" id="kobo.557.1">;
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.558.1">break</span></span><span class="koboSpan" id="kobo.559.1">;
      </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.560.1">case</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.561.1">HttpStatusCode</span></span><span class="koboSpan" id="kobo.562.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.563.1">BadRequest</span></span><span class="koboSpan" id="kobo.564.1">:
        message = </span><span class="hljs-string"><span class="koboSpan" id="kobo.565.1">'Request error'</span></span><span class="koboSpan" id="kobo.566.1">;
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.567.1">break</span></span><span class="koboSpan" id="kobo.568.1">;
      </span><span class="hljs-attr"><span class="koboSpan" id="kobo.569.1">default</span></span><span class="koboSpan" id="kobo.570.1">:
        message = </span><span class="hljs-string"><span class="koboSpan" id="kobo.571.1">'Unknown error'</span></span><span class="koboSpan" id="kobo.572.1">;
    }
  } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.573.1">else</span></span><span class="koboSpan" id="kobo.574.1"> {
    message = </span><span class="hljs-string"><span class="koboSpan" id="kobo.575.1">'Application error'</span></span><span class="koboSpan" id="kobo.576.1">;
  }
  </span><span class="hljs-variable"><span class="koboSpan" id="kobo.577.1">console</span></span><span class="koboSpan" id="kobo.578.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.579.1">error</span></span><span class="koboSpan" id="kobo.580.1">(message, err);
}
</span></code></pre>
    </li>
   </ol>
   <p class="normal-one">
    <span class="koboSpan" id="kobo.581.1">
     In the preceding method, we check if the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.582.1">
      error
     </span>
    </code>
    <span class="koboSpan" id="kobo.583.1">
     object contains a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.584.1">
      rejection
     </span>
    </code>
    <span class="koboSpan" id="kobo.585.1">
     property.
    </span>
    <span class="koboSpan" id="kobo.585.2">
     Errors originating
    </span>
    <a id="_idIndexMarker695">
    </a>
    <span class="koboSpan" id="kobo.586.1">
     from the
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.587.1">
      Zone.js
     </span>
    </strong>
    <span class="koboSpan" id="kobo.588.1">
     library, which is responsible for the change detection in Angular, encapsulate the actual error inside that property.
    </span>
   </p>
   <p class="normal-one">
    <span class="koboSpan" id="kobo.589.1">
     After extracting the error in the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.590.1">
      err
     </span>
    </code>
    <span class="koboSpan" id="kobo.591.1">
     variable, we check to see if it is an HTTP error using the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.592.1">
      HttpErrorResponse
     </span>
    </code>
    <span class="koboSpan" id="kobo.593.1">
     type.
    </span>
    <span class="koboSpan" id="kobo.593.2">
     This check will eventually catch any errors from HTTP calls using the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.594.1">
      throwError
     </span>
    </code>
    <span class="koboSpan" id="kobo.595.1">
     RxJS operator.
    </span>
    <span class="koboSpan" id="kobo.595.2">
     All other errors are treated as application errors that occur on the client side.
    </span>
   </p>
   <ol>
    <li class="numberedList" value="5">
     <span class="koboSpan" id="kobo.596.1">
      Open the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.597.1">
       app.config.ts
      </span>
     </code>
     <span class="koboSpan" id="kobo.598.1">
      file and import the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.599.1">
       ErrorHandler
      </span>
     </code>
     <span class="koboSpan" id="kobo.600.1">
      class from the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.601.1">
       @angular/core
      </span>
     </code>
     <span class="koboSpan" id="kobo.602.1">
      npm package:
     </span>
     <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.603.1">import</span></span><span class="koboSpan" id="kobo.604.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.605.1">ApplicationConfig</span></span><span class="koboSpan" id="kobo.606.1">, </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.607.1">ErrorHandler</span></strong></span><span class="koboSpan" id="kobo.608.1">, provideZoneChangeDetection } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.609.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.610.1">'@angular/core'</span></span><span class="koboSpan" id="kobo.611.1">;
</span></code></pre>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.612.1">
      Import the
     </span>
     <a id="_idIndexMarker696">
     </a>
     <span class="koboSpan" id="kobo.613.1">
      custom
     </span>
     <a id="_idIndexMarker697">
     </a>
     <span class="koboSpan" id="kobo.614.1">
      error handler we created in the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.615.1">
       app-error-handler.ts
      </span>
     </code>
     <span class="koboSpan" id="kobo.616.1">
      file:
     </span>
     <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.617.1">import</span></span><span class="koboSpan" id="kobo.618.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.619.1">AppErrorHandler</span></span><span class="koboSpan" id="kobo.620.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.621.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.622.1">'./app-error-handler'</span></span><span class="koboSpan" id="kobo.623.1">;
</span></code></pre>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.624.1">
      Register the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.625.1">
       AppErrorHandler
      </span>
     </code>
     <span class="koboSpan" id="kobo.626.1">
      class as the global error handler of the application by adding it to the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.627.1">
       providers
      </span>
     </code>
     <span class="koboSpan" id="kobo.628.1">
      array of the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.629.1">
       appConfig
      </span>
     </code>
     <span class="koboSpan" id="kobo.630.1">
      variable:
     </span>
     <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.631.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.632.1">const</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.633.1">appConfig</span></span><span class="koboSpan" id="kobo.634.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.635.1">ApplicationConfig</span></span><span class="koboSpan" id="kobo.636.1"> = {
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.637.1">providers</span></span><span class="koboSpan" id="kobo.638.1">: [
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.639.1">provideZoneChangeDetection</span></span><span class="koboSpan" id="kobo.640.1">({ </span><span class="hljs-attr"><span class="koboSpan" id="kobo.641.1">eventCoalescing</span></span><span class="koboSpan" id="kobo.642.1">: </span><span class="hljs-literal"><span class="koboSpan" id="kobo.643.1">true</span></span><span class="koboSpan" id="kobo.644.1"> }),
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.645.1">provideRouter</span></span><span class="koboSpan" id="kobo.646.1">(routes),
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.647.1">provideHttpClient</span></span><span class="koboSpan" id="kobo.648.1">(),
    { </span><span class="hljs-attr"><span class="koboSpan" id="kobo.649.1">provide</span></span><span class="koboSpan" id="kobo.650.1">: </span><span class="hljs-variable"><span class="koboSpan" id="kobo.651.1">APP_SETTINGS</span></span><span class="koboSpan" id="kobo.652.1">, </span><span class="hljs-attr"><span class="koboSpan" id="kobo.653.1">useValue</span></span><span class="koboSpan" id="kobo.654.1">: appSettings },
    </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.655.1">{ provide: ErrorHandler, useClass: AppErrorHandler }</span></strong></span><span class="koboSpan" id="kobo.656.1">
  ]
};
</span></code></pre>
    </li>
   </ol>
   <p class="normal">
    <span class="koboSpan" id="kobo.657.1">
     To investigate the behavior of the global application error handler, execute the following steps:
    </span>
   </p>
   <ol>
    <li class="numberedList" value="1">
     <span class="koboSpan" id="kobo.658.1">
      Run the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.659.1">
       ng serve
      </span>
     </code>
     <span class="koboSpan" id="kobo.660.1">
      command to start the application.
     </span>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.661.1">
      Disconnect your computer from the internet.
     </span>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.662.1">
      Navigate to
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.663.1">
       http://localhost:4200
      </span>
     </code>
     <span class="koboSpan" id="kobo.664.1">
      .
     </span>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.665.1">
      Open the browser developer tools and inspect the output of the console window:
     </span>
    </li>
   </ol>
   <figure class="mediaobject">
    <span class="koboSpan" id="kobo.666.1">
     <img alt="img" src="../Images/B21418_11_01.png"/>
    </span>
   </figure>
   <p class="packt_figref">
    <span class="koboSpan" id="kobo.667.1">
     Figure 11.1: Application error
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.668.1">
     One of the
    </span>
    <a id="_idIndexMarker698">
    </a>
    <span class="koboSpan" id="kobo.669.1">
     most common HTTP
    </span>
    <a id="_idIndexMarker699">
    </a>
    <span class="koboSpan" id="kobo.670.1">
     errors in a web enterprise application is the
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.671.1">
      401 Unauthorized
     </span>
    </strong>
    <span class="koboSpan" id="kobo.672.1">
     response error.
    </span>
    <span class="koboSpan" id="kobo.672.2">
     We will learn how to handle this specific error in the following section.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-209">
    <span class="koboSpan" id="kobo.673.1">
     Responding to the 401 Unauthorized error
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.674.1">
     The 401 Unauthorized
    </span>
    <a id="_idIndexMarker700">
    </a>
    <span class="koboSpan" id="kobo.675.1">
     error in
    </span>
    <a id="_idIndexMarker701">
    </a>
    <span class="koboSpan" id="kobo.676.1">
     an Angular application can occur in the following cases:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.677.1">
      The user does not provide the correct credentials while logging in to the application
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.678.1">
      The authentication token provided when the user logged in to the application has expired
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.679.1">
     A good place to handle the 401 Unauthorized error is inside an HTTP interceptor responsible for authentication.
    </span>
    <span class="koboSpan" id="kobo.679.2">
     In
    </span>
    <em class="chapterRef">
     <span class="koboSpan" id="kobo.680.1">
      Chapter 8
     </span>
    </em>
    <span class="koboSpan" id="kobo.681.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.682.1">
      Communicating with Data Services over HTTP
     </span>
    </em>
    <span class="koboSpan" id="kobo.683.1">
     , we learned how to create an authentication interceptor for passing the authorization token to every HTTP request.
    </span>
    <span class="koboSpan" id="kobo.683.2">
     To handle the 401 Unauthorized error, the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.684.1">
      auth.interceptor.ts
     </span>
    </code>
    <span class="koboSpan" id="kobo.685.1">
     file could be modified as follows:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.686.1">import</span></span><span class="koboSpan" id="kobo.687.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.688.1">HttpErrorResponse</span></span><span class="koboSpan" id="kobo.689.1">, </span><span class="hljs-title"><span class="koboSpan" id="kobo.690.1">HttpInterceptorFn</span></span><span class="koboSpan" id="kobo.691.1">, </span><span class="hljs-title"><span class="koboSpan" id="kobo.692.1">HttpStatusCode</span></span><span class="koboSpan" id="kobo.693.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.694.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.695.1">'@angular/common/http'</span></span><span class="koboSpan" id="kobo.696.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.697.1">import</span></span><span class="koboSpan" id="kobo.698.1"> { inject } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.699.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.700.1">'@angular/core'</span></span><span class="koboSpan" id="kobo.701.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.702.1">import</span></span><span class="koboSpan" id="kobo.703.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.704.1">AuthService</span></span><span class="koboSpan" id="kobo.705.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.706.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.707.1">'./auth.service'</span></span><span class="koboSpan" id="kobo.708.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.709.1">import</span></span><span class="koboSpan" id="kobo.710.1"> { catchError, </span><span class="hljs-variable"><span class="koboSpan" id="kobo.711.1">EMPTY</span></span><span class="koboSpan" id="kobo.712.1">, throwError } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.713.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.714.1">'rxjs'</span></span><span class="koboSpan" id="kobo.715.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.716.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.717.1">const</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.718.1">authInterceptor</span></span><span class="koboSpan" id="kobo.719.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.720.1">HttpInterceptorFn</span></span><span class="koboSpan" id="kobo.721.1"> = </span><span class="hljs-function"><span class="koboSpan" id="kobo.722.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.723.1">req, next</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.724.1">) =&gt;</span></span><span class="koboSpan" id="kobo.725.1"> {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.726.1">const</span></span><span class="koboSpan" id="kobo.727.1"> authService = </span><span class="hljs-title"><span class="koboSpan" id="kobo.728.1">inject</span></span><span class="koboSpan" id="kobo.729.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.730.1">AuthService</span></span><span class="koboSpan" id="kobo.731.1">);
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.732.1">const</span></span><span class="koboSpan" id="kobo.733.1"> authReq = req.</span><span class="hljs-title"><span class="koboSpan" id="kobo.734.1">clone</span></span><span class="koboSpan" id="kobo.735.1">({
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.736.1">setHeaders</span></span><span class="koboSpan" id="kobo.737.1">: { </span><span class="hljs-title"><span class="koboSpan" id="kobo.738.1">Authorization</span></span><span class="koboSpan" id="kobo.739.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.740.1">'myToken'</span></span><span class="koboSpan" id="kobo.741.1"> }
  });
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.742.1">return</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.743.1">next</span></span><span class="koboSpan" id="kobo.744.1">(authReq).</span><span class="hljs-title"><span class="koboSpan" id="kobo.745.1">pipe</span></span><span class="koboSpan" id="kobo.746.1">(
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.747.1">catchError</span></span><span class="koboSpan" id="kobo.748.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.749.1">(</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.750.1">error</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.751.1">: </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.752.1">HttpErrorResponse</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.753.1">) =&gt;</span></span><span class="koboSpan" id="kobo.754.1"> {
      </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.755.1">if</span></span><span class="koboSpan" id="kobo.756.1"> (error.</span><span class="hljs-property"><span class="koboSpan" id="kobo.757.1">status</span></span><span class="koboSpan" id="kobo.758.1"> === </span><span class="hljs-title"><span class="koboSpan" id="kobo.759.1">HttpStatusCode</span></span><span class="koboSpan" id="kobo.760.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.761.1">Unauthorized</span></span><span class="koboSpan" id="kobo.762.1">) {
        authService.</span><span class="hljs-title"><span class="koboSpan" id="kobo.763.1">logout</span></span><span class="koboSpan" id="kobo.764.1">();
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.765.1">return</span></span> <span class="hljs-variable"><span class="koboSpan" id="kobo.766.1">EMPTY</span></span><span class="koboSpan" id="kobo.767.1">;
      } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.768.1">else</span></span><span class="koboSpan" id="kobo.769.1"> {
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.770.1">return</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.771.1">throwError</span></span><span class="koboSpan" id="kobo.772.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.773.1">() =&gt;</span></span><span class="koboSpan" id="kobo.774.1"> error);
      }
    })
  );
};
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.775.1">
     The interceptor will call the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.776.1">
      logout
     </span>
    </code>
    <span class="koboSpan" id="kobo.777.1">
     method of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.778.1">
      AuthService
     </span>
    </code>
    <span class="koboSpan" id="kobo.779.1">
     class when a 401 Unauthorized error occurs and return an
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.780.1">
      EMPTY
     </span>
    </code>
    <span class="koboSpan" id="kobo.781.1">
     observable to stop emitting data.
    </span>
    <span class="koboSpan" id="kobo.781.2">
     It will use the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.782.1">
      throwError
     </span>
    </code>
    <span class="koboSpan" id="kobo.783.1">
     operator to bubble the error to the global error handler in all other errors.
    </span>
    <span class="koboSpan" id="kobo.783.2">
     As we have already seen, the global error handler will examine the returned error and take action according to the status code.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.784.1">
     As we saw in the
    </span>
    <a id="_idIndexMarker702">
    </a>
    <span class="koboSpan" id="kobo.785.1">
     global
    </span>
    <a id="_idIndexMarker703">
    </a>
    <span class="koboSpan" id="kobo.786.1">
     error handler we created in the previous section, some errors are unrelated to the interaction with the HTTP client.
    </span>
    <span class="koboSpan" id="kobo.786.2">
     There are application errors that occur on the client side, and we will learn how to understand them in the following section.
    </span>
   </p>
   <h1 class="heading-1" id="_idParaDest-210">
    <span class="koboSpan" id="kobo.787.1">
     Demystifying framework errors
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.788.1">
     Application errors that
    </span>
    <a id="_idIndexMarker704">
    </a>
    <span class="koboSpan" id="kobo.789.1">
     originate on the client side in an Angular application can have many causes.
    </span>
    <span class="koboSpan" id="kobo.789.2">
     One of them is the interaction of our source code with the Angular framework.
    </span>
    <span class="koboSpan" id="kobo.789.3">
     Developers like to try new things and approaches while building applications.
    </span>
    <span class="koboSpan" id="kobo.789.4">
     Sometimes, things will go well but, other times, they may cause errors in an application.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.790.1">
     The Angular framework provides a mechanism for reporting some of these common errors with the following format:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.791.1">NGWXYZ: {Error message}.&lt;Link&gt;
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.792.1">
     Letâ€™s analyze the preceding error format:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.793.1">
       NG
      </span>
     </code>
     <span class="koboSpan" id="kobo.794.1">
      : Indicates that it is an Angular error to differentiate between other errors originating from TypeScript and the browser
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.795.1">
       W
      </span>
     </code>
     <span class="koboSpan" id="kobo.796.1">
      : A single-digit number that indicates the type of the error.
     </span>
     <span class="koboSpan" id="kobo.796.2">
      0 represents a runtime error, and all other numbers from 1 to 9 represent a compiler error
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.797.1">
       X
      </span>
     </code>
     <span class="koboSpan" id="kobo.798.1">
      : A single-digit number that indicates the category of the framework runtime area, such as change detection, dependency injection, and template
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.799.1">
       YZ
      </span>
     </code>
     <span class="koboSpan" id="kobo.800.1">
      : A two-digit code used to index the specific error
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.801.1">
       {Error message}
      </span>
     </code>
     <span class="koboSpan" id="kobo.802.1">
      : The actual error message
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.803.1">
       &lt;Link&gt;
      </span>
     </code>
     <span class="koboSpan" id="kobo.804.1">
      : A link to the Angular documentation that provides more information about the specified error
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.805.1">
     Error messages that
    </span>
    <a id="_idIndexMarker705">
    </a>
    <span class="koboSpan" id="kobo.806.1">
     conform to the preceding format are displayed in the browser console as they happen.
    </span>
    <span class="koboSpan" id="kobo.806.2">
     Letâ€™s see an error example using the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.807.1">
      ExpressionChangedAfterChecked
     </span>
    </code>
    <span class="koboSpan" id="kobo.808.1">
     error, the most famous error in Angular applications:
    </span>
   </p>
   <ol>
    <li class="numberedList" value="1">
     <span class="koboSpan" id="kobo.809.1">
      Open the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.810.1">
       app.component.ts
      </span>
     </code>
     <span class="koboSpan" id="kobo.811.1">
      file and import the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.812.1">
       AfterViewInit
      </span>
     </code>
     <span class="koboSpan" id="kobo.813.1">
      artifact from the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.814.1">
       @angular/core
      </span>
     </code>
     <span class="koboSpan" id="kobo.815.1">
      npm package:
     </span>
     <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.816.1">import</span></span><span class="koboSpan" id="kobo.817.1"> { </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.818.1">AfterViewInit</span></strong></span><span class="koboSpan" id="kobo.819.1">, </span><span class="hljs-title"><span class="koboSpan" id="kobo.820.1">Component</span></span><span class="koboSpan" id="kobo.821.1">, inject } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.822.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.823.1">'@angular/core'</span></span><span class="koboSpan" id="kobo.824.1">;
</span></code></pre>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.825.1">
      Add the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.826.1">
       AfterViewInit
      </span>
     </code>
     <span class="koboSpan" id="kobo.827.1">
      in the list of implemented interfaces:
     </span>
     <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.828.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.829.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.830.1">AppComponent</span></span> <span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.831.1">implements AfterViewInit</span></strong></span>
</code></pre>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.832.1">
      Create the following
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.833.1">
       title
      </span>
     </code>
     <span class="koboSpan" id="kobo.834.1">
      property in the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.835.1">
       AppComponent
      </span>
     </code>
     <span class="koboSpan" id="kobo.836.1">
      class:
     </span>
     <pre class="programlisting code-one"><code class="hljs-code"><span class="koboSpan" id="kobo.837.1">title = </span><span class="hljs-string"><span class="koboSpan" id="kobo.838.1">''</span></span><span class="koboSpan" id="kobo.839.1">;
</span></code></pre>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.840.1">
      Implement the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.841.1">
       ngAfterViewInit
      </span>
     </code>
     <span class="koboSpan" id="kobo.842.1">
      method and change the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.843.1">
       title
      </span>
     </code>
     <span class="koboSpan" id="kobo.844.1">
      property inside the method body:
     </span>
     <pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.845.1">ngAfterViewInit</span></span><span class="koboSpan" id="kobo.846.1">(): </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.847.1">void</span></span><span class="koboSpan" id="kobo.848.1"> {
  </span><span class="hljs-variable"><span class="koboSpan" id="kobo.849.1">this</span></span><span class="koboSpan" id="kobo.850.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.851.1">title</span></span><span class="koboSpan" id="kobo.852.1"> = </span><span class="hljs-variable"><span class="koboSpan" id="kobo.853.1">this</span></span><span class="koboSpan" id="kobo.854.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.855.1">settings</span></span><span class="koboSpan" id="kobo.856.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.857.1">title</span></span><span class="koboSpan" id="kobo.858.1">;
}
</span></code></pre>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.859.1">
      Open the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.860.1">
       app.component.html
      </span>
     </code>
     <span class="koboSpan" id="kobo.861.1">
      file and bind the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.862.1">
       title
      </span>
     </code>
     <span class="koboSpan" id="kobo.863.1">
      property to the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.864.1">
       &lt;h2&gt;
      </span>
     </code>
     <span class="koboSpan" id="kobo.865.1">
      HTML element:
     </span>
     <pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-tag"><span class="koboSpan" id="kobo.866.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.867.1">h2</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.868.1">&gt;</span></span><span class="koboSpan" id="kobo.869.1">{{ </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.870.1">title</span></strong></span><span class="koboSpan" id="kobo.871.1"> }}</span><span class="hljs-tag"><span class="koboSpan" id="kobo.872.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.873.1">h2</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.874.1">&gt;</span></span>
</code></pre>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.875.1">
      Run the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.876.1">
       ng serve
      </span>
     </code>
     <span class="koboSpan" id="kobo.877.1">
      command and navigate to
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.878.1">
       http://localhost:4200
      </span>
     </code>
     <span class="koboSpan" id="kobo.879.1">
      .
     </span>
    </li>
   </ol>
   <p class="normal-one">
    <span class="koboSpan" id="kobo.880.1">
     Initially, everything looks to work correctly.
    </span>
    <span class="koboSpan" id="kobo.880.2">
     The value of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.881.1">
      title
     </span>
    </code>
    <span class="koboSpan" id="kobo.882.1">
     property is displayed on the page correctly.
    </span>
   </p>
   <ol>
    <li class="numberedList" value="7">
     <span class="koboSpan" id="kobo.883.1">
      Open the browser developer tools and inspect the console window:
     </span>
     <pre class="programlisting con-one"><code class="hljs-con"><span class="koboSpan" id="kobo.884.1">Application error RuntimeError: NG0100: ExpressionChangedAfterItHasBeenCheckedError: Expression has changed after it was checked. </span><span class="koboSpan" id="kobo.884.2">Previous value: ''. </span><span class="koboSpan" id="kobo.884.3">Current value: 'My e-shop'. </span><span class="koboSpan" id="kobo.884.4">Expression location: _AppComponent component. </span><span class="koboSpan" id="kobo.884.5">Find more at https://angular.dev/errors/NG0100
</span></code></pre>
    </li>
   </ol>
   <p class="normal-one">
    <span class="koboSpan" id="kobo.885.1">
     The preceding message indicates that changing the value of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.886.1">
      title
     </span>
    </code>
    <span class="koboSpan" id="kobo.887.1">
     property caused the error.
    </span>
   </p>
   <ol>
    <li class="numberedList" value="8">
     <span class="koboSpan" id="kobo.888.1">
      Clicking on the
     </span>
     <a href="https://angular.dev/errors/NG0100">
      <span class="url">
       <span class="koboSpan" id="kobo.889.1">
        https://angular.dev/errors/NG0100
       </span>
      </span>
     </a>
     <span class="koboSpan" id="kobo.890.1">
      link will redirect us to the appropriate error guide in the Angular documentation for more information.
     </span>
     <span class="koboSpan" id="kobo.890.2">
      The error guide explains the specific error and describes how to fix the problem in our application code.
     </span>
    </li>
   </ol>
   <p class="normal">
    <span class="koboSpan" id="kobo.891.1">
     When we understand
    </span>
    <a id="_idIndexMarker706">
    </a>
    <span class="koboSpan" id="kobo.892.1">
     the error messages that originate from the Angular framework, we can fix them easily.
    </span>
   </p>
   <h1 class="heading-1" id="_idParaDest-211">
    <span class="koboSpan" id="kobo.893.1">
     Summary
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.894.1">
     Handling errors during runtime or development is crucial for every Angular application.
    </span>
    <span class="koboSpan" id="kobo.894.2">
     In this chapter, we learned how to handle errors that occur during the runtime of an Angular application, such as HTTP or client-side errors.
    </span>
    <span class="koboSpan" id="kobo.894.3">
     We also learned how to understand and fix application errors thrown by the Angular framework.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.895.1">
     In the next chapter, we will learn how to skin our application to look more beautiful with the help of Angular Material.
    </span>
    <span class="koboSpan" id="kobo.895.2">
     Angular Material has many components and styles that are ready for you to use in your projects.
    </span>
    <span class="koboSpan" id="kobo.895.3">
     So, letâ€™s give your Angular project the love it deserves.
    </span>
   </p>
  </div>
 </body></html>