<html><head></head><body><div class="chapter" title="Chapter&#xA0;8.&#xA0;Releasing the Application"><div class="titlepage"><div><div><h1 class="title"><a id="ch08"/>Chapter 8. Releasing the Application</h1></div></div></div><p>The first version of our application is complete, which means that we are ready to go through the process of creating the production builds. In this chapter, we will start by showing you how to generate and run the application off of a static JavaScript bundle. Then, in preparation for the App Store, we will use Xcode to build our iOS release. Lastly, for Android we will walk through the set of command-line tools and scripts provided by React Native to build the final APK.</p><p>In this chapter, we will cover the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Generating the static bundle for iOS</li><li class="listitem" style="list-style-type: disc">Using the <code class="literal">static bundle</code> in place of <code class="literal">react-native start</code></li><li class="listitem" style="list-style-type: disc">Building a release in Xcode</li><li class="listitem" style="list-style-type: disc">Signing and building the Android release APK</li></ul></div><div class="section" title="Generating the static bundle in iOS"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec35"/>Generating the static bundle in iOS</h1></div></div></div><p>So far, we<a id="id200" class="indexterm"/> have been serving the application's static bundle (where all of our JavaScript code lives) from a node server started by either Xcode or a terminal using <code class="literal">react-native start</code>. Before we create releases for iOS and Android, we need to generate the static JS bundle that our application will load. We will begin by creating the release in iOS; for Android, skip to the <code class="literal">generating the Android APK</code> section.</p><p>Once again, we are going to use the <code class="literal">react-native-cli</code> and execute the <code class="literal">bundle</code> command. The <code class="literal">bundle</code> command requires three flags: <code class="literal">c</code>, <code class="literal">platform</code>, and <code class="literal">bundle-output</code>. The <code class="literal">entry-file</code> specifies the path to the root component, the platform is either iOS or Android, and <code class="literal">bundle-output</code> is the path to place the generated bundle.</p><p>From the terminal in the root directory, run <code class="literal">react-native bundle</code> with an <code class="literal">entry-file</code> of <code class="literal">index.ios.js</code>, platform <code class="literal">iOS</code>, and point the path of the <code class="literal">bundle-output</code> to <code class="literal">ios/main.jsbundle</code>:</p><div class="informalexample"><pre class="programlisting">$ react-native bundle --entry-file index.ios.js --platform ios --bundle-output ios/main.jsbundle
bundle: Created ReactPackager
bundle: Closing client
bundle: start
bundle: finish
bundle: Writing bundle output to: ios/main.jsbundle
bundle: Done writing bundle output</pre></div><p>Assets <a id="id201" class="indexterm"/>destination folder is not set, skipping...</p><p>More details about <code class="literal">react-native bundle</code> for iOS can be found in the React Native documentation at <a class="ulink" href="https://facebook.github.io/react-native/docs/running-on-device-ios.html#using-offline-bundle">https://facebook.github.io/react-native/docs/running-on-device-ios.html#using-offline-bundle</a>.</p></div></div>
<div class="section" title="Testing the static bundle in iOS"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec36"/>Testing the static bundle in iOS</h1></div></div></div><p>First, we <a id="id202" class="indexterm"/>need to test that the static bundle can be loaded by our iOS application in the simulator. Open <code class="literal">AppDelegate.m</code> in Xcode and take a look at the following code and comments:</p><div class="informalexample"><pre class="programlisting">   * Loading JavaScript code - uncomment the one you want.
   *
   * OPTION 1
   * Load from development server. Start the server from the repository root:
   *
   * $ npm start
   *
   * To run on device, change `localhost` to the IP address of your computer
   * (you can get this by typing `ifconfig` into the terminal and selecting the
   * `inet` value under `en0:`) and make sure your computer and iOS device are
   * on the same Wi-Fi network.
   */

  jsCodeLocation = [NSURL URLWithString:@"http://localhost:8081/index.ios.bundle?platform=ios&amp;dev=true"];

  /**
   * OPTION 2
   * Load from pre-bundled file on disk. To re-generate the static bundle
   * from the root of your project directory, run
   *
   * $ react-native bundle --minify
   *
   * see http://facebook.github.io/react-native/docs/runningondevice.html
   */

//   jsCodeLocation = [[NSBundle mainBundle] URLForResource:@"main" withExtension:@"jsbundle"];</pre></div><p>The <a id="id203" class="indexterm"/>various methods of loading the JavaScript bundle are outlined here. We are interested in <code class="literal">OPTION 2</code>, loading a pre-bundled file from the disk. Comment out the <code class="literal">jsCodeLocation</code> statement from <code class="literal">OPTION 1</code> and uncomment the second in <code class="literal">OPTION 2</code>:</p><div class="informalexample"><pre class="programlisting">// jsCodeLocation = [NSURL URLWithString:@"http://localhost:8081/index.ios.bundle?platform=ios&amp;dev=true"];
...

jsCodeLocation = [[NSBundle mainBundle] URLForResource:@"main" withExtension:@"jsbundle"];</pre></div><p>Make sure that no <code class="literal">react-native start</code> terminal sessions are running, then build and run the application from Xcode (<span class="emphasis"><em>Cmd</em></span> + <span class="emphasis"><em>R</em></span>). You should be at the top of the simulator to indicate that it is loading from a pre-bundled file:</p><div class="mediaobject"><img src="graphics/B05162_08_01.jpg" alt="Testing the static bundle in iOS"/></div></div>
<div class="section" title="Creating an iOS release in Xcode"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec37"/>Creating an iOS release in Xcode</h1></div></div></div><p>In order <a id="id204" class="indexterm"/>to submit to the AppStore, we need to build our <a id="id205" class="indexterm"/>application for distribution. Luckily, the Xcode project we initially created with <code class="literal">react-native init</code> has some of this preconfigured for us. First, we want to change our <span class="strong"><strong>Build Configuration</strong></span> to <span class="strong"><strong>disable</strong></span> features, such as the developer menu that we get while we are debugging.</p><p>Let's configure the iOS release:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">In Xcode, navigate to <span class="strong"><strong>Product</strong></span> | <span class="strong"><strong>Scheme</strong></span> | <span class="strong"><strong>Edit Scheme…</strong></span> and select <span class="strong"><strong>Run</strong></span>, and under the <span class="strong"><strong>Info</strong></span> tab change <span class="strong"><strong>Build Configuration</strong></span> from <span class="strong"><strong>Debug</strong></span> to <span class="strong"><strong>Release</strong></span>:<div class="mediaobject"><img src="graphics/B05162_08_02.jpg" alt="Creating an iOS release in Xcode"/></div></li><li class="listitem">Target<a id="id206" class="indexterm"/> the <span class="strong"><strong>iOS Device</strong></span><a id="id207" class="indexterm"/> instead of the simulator:<div class="mediaobject"><img src="graphics/B05162_08_03.jpg" alt="Creating an iOS release in Xcode"/></div></li><li class="listitem">Finally, run <a id="id208" class="indexterm"/>the build from <span class="strong"><strong>Product</strong></span> | <span class="strong"><strong>Archive</strong></span>. The <a id="id209" class="indexterm"/><span class="strong"><strong>Organizer</strong></span> window will open a list of archives for your project. You can return to this screen later by selecting <span class="strong"><strong>Window</strong></span> | <span class="strong"><strong>Organizer</strong></span> from the top menu:<div class="mediaobject"><img src="graphics/B05162_08_04.jpg" alt="Creating an iOS release in Xcode"/></div></li><li class="listitem">In the<a id="id210" class="indexterm"/> future, when<a id="id211" class="indexterm"/> you create multiple releases, you should increase the version number found in <span class="strong"><strong>Targets</strong></span> | <span class="strong"><strong>ReactNotes</strong></span> | <span class="strong"><strong>General</strong></span>. For the purposes of our first release, this can be disregarded:<div class="mediaobject"><img src="graphics/B05162_08_05.jpg" alt="Creating an iOS release in Xcode"/></div><p>Once <a id="id212" class="indexterm"/>your build has been archived, it is ready to be submitted to the Apple App Store. This <a id="id213" class="indexterm"/>book doesn't cover the application to the App Store but the next steps will be available on the <a id="id214" class="indexterm"/>Apple developer website at <a class="ulink" href="https://developer.apple.com">https://developer.apple.com</a>.</p></li></ol></div></div>
<div class="section" title="Generating the Android APK"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec38"/>Generating the Android APK</h1></div></div></div><p>Building the <a id="id215" class="indexterm"/>
<span class="strong"><strong>Android Application Package</strong></span> (<span class="strong"><strong>APK</strong></span>) is a bit more cryptic than releasing for iOS. There are a few steps that we need to follow before we generate the static bundle, like we did in iOS:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">First, we need to generate a key that we can use to sign our application using <code class="literal">keytool</code>. Navigate to the <code class="literal">android/app</code> folder in a terminal and run this command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ keytool -genkey -v -keystore my-release-key.keystore -alias my-key-alias -keyalg RSA -keysize 2048 -validity 10000</strong></span>
<span class="strong"><strong>[Storing my-release-key.keystore]</strong></span>
</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note16"/>Note</h3><p>Note that this is a private file and should never be shared with anyone. Keep it somewhere safe!</p></div></div></li><li class="listitem">Next we<a id="id216" class="indexterm"/> have a few configuration files to update. Up a level in the <code class="literal">android/ directory</code> open <code class="literal">gradle.properties</code> and add these four lines, replacing <code class="literal">YOUR_KEY_PASSWORD</code> with the password you used for <code class="literal">keytool</code>:<div class="informalexample"><pre class="programlisting">MYAPP_RELEASE_STORE_FILE=my-release-key.keystore MYAPP_RELEASE_KEY_ALIAS=my-key-alias MYAPP_RELEASE_STORE_PASSWORD=YOUR_KEY_PASSWORD
MYAPP_RELEASE_KEY_PASSWORD= YOUR_KEY_PASSWORD</pre></div></li><li class="listitem">Add the following in <code class="literal">android/app/build.gradle</code>:<div class="informalexample"><pre class="programlisting">android {
    ...

    signingConfigs {
        release {
            storeFile file(MYAPP_RELEASE_STORE_FILE)
            storePassword MYAPP_RELEASE_STORE_PASSWORD
            keyAlias MYAPP_RELEASE_KEY_ALIAS
            keyPassword MYAPP_RELEASE_KEY_PASSWORD
        }
    }
    buildTypes {
        release {
            ...
            signingConfig signingConfigs.release
        }
    }
}</pre></div></li><li class="listitem">Now, we can generate the static bundle for Android. Create a new directory <code class="literal">android/app/src/main/assets/</code> and run this modified form of the <code class="literal">react-native bundle</code> command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>react-native bundle --platform android --dev false --entry-file index.android.js --bundle-output android/app/src/main/assets/index.android.bundle --assets-dest android/app/src/main/res/</strong></span>
</pre></div><p>This gives the following output:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ react-native bundle --platform android --dev false --entry-file index.android.js --bundle-output android/app/src/main/assets/index.android.bundle --assets-dest android/app/src/main/res/</strong></span>
<span class="strong"><strong>Building package...</strong></span>
<span class="strong"><strong>transforming [========================================] 100% 326/326</strong></span>
<span class="strong"><strong>Build complete</strong></span>
<span class="strong"><strong>Successfully saved bundle to android/app/src/main/assets/index.android.bundle</strong></span>
</pre></div></li><li class="listitem">Build <a id="id217" class="indexterm"/>the final APK in the <code class="literal">android/ directory</code> using the <code class="literal">gradle</code> command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>./gradlew assembleRelease</strong></span>
</pre></div><p>If you have set up the key signing correctly, you can test your release in the simulator or on a device with the following:</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>./gradlew installRelease</strong></span>
</pre></div></li><li class="listitem">With this, we have our final release APK (that can be found in <code class="literal">android/app/build/outputs/apk/app-release.apk</code>). Check out the launch checklist on Android developers for more information on the Play Store submission process at <a class="ulink" href="https://developer.android.com/distribute/tools/launch-checklist.html">https://developer.android.com/distribute/tools/launch-checklist.html</a>.</li></ol></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch08lvl1sec39"/>Summary</h1></div></div></div><p>In this chapter, you learned how to build a release of our application in preparation for submitting it to the App Store or Google Play Store. iOS had a pre-configuration scheme in Xcode to disable the developer features. We then created an archive by targeting the iOS device. On Android, we created a private release key with <span class="strong"><strong>keytool</strong></span> and built the release APK using the command line and <code class="literal">gradle</code>. It is important to follow up and test that both of these release builds work before submission, to decrease the likelihood of rejection.</p><p>We hope that this book gave you the fundamentals you need to start creating mobile apps with React Native. Although React and React Native are still very early in terms of development, you can expect the core concepts discussed in this book to stay relevant for some time to come. When Android finally reaches feature parity with iOS, the doors will open for a lot more rapid development between the two platforms. Good luck, and we can't wait to see your apps out there on the App and Google Play Stores!</p></div></body></html>