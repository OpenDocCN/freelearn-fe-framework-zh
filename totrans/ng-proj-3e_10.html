<html><head></head><body>
  <div id="_idContainer201" class="Basic-Text-Frame">
    <h1 class="chapterNumber">10</h1>
    <h1 id="_idParaDest-166" class="chapterTitle">Customizing Angular CLI Commands Using Schematics</h1>
    <p class="normal">The Angular CLI is a powerful tool and the de facto solution for working with Angular applications. It eliminates most of the boilerplate code and configuration from the developer and allows them to focus on the fun stuff, which is building awesome Angular applications. Apart from enhancing the Angular development experience, it can be easily customized to the needs of each developer.</p>
    <p class="normal">The Angular CLI contains a set of useful commands for building, bundling, and testing Angular applications. It also provides a collection of special commands, called <strong class="keyWord">schematics</strong>, that generate <a id="_idIndexMarker553"/>various Angular artifacts such as components, modules, and services. Schematics expose a public API that developers can use to create their own Angular CLI commands or extend the existing ones.</p>
    <p class="normal">In this chapter, we will cover the following details about schematics:</p>
    <ul>
      <li class="bulletList">Installing the <strong class="keyWord">Schematics CLI</strong></li>
      <li class="bulletList">Creating a <strong class="keyWord">Tailwind CSS</strong> component</li>
      <li class="bulletList">Creating an HTTP service</li>
    </ul>
    <h1 id="_idParaDest-167" class="heading-1">Essential background theory and context</h1>
    <p class="normal">Angular schematics are libraries that can<a id="_idIndexMarker554"/> be installed using <code class="inlineCode">npm</code>. They are used in various situations, including creating components that share a standard user interface or enforcing conventions and coding guidelines inside an organization. A schematic can be used as a standalone or as a companion for an existing Angular library.</p>
    <p class="normal">Angular schematics are<a id="_idIndexMarker555"/> packaged into collections and reside in the <code class="inlineCode">@schematics/angular</code> npm package. When we use the Angular CLI to run the <code class="inlineCode">ng add</code> or the <code class="inlineCode">ng build</code> command, it runs the appropriate schematic from that package. The Angular CLI currently supports the following types of schematics:</p>
    <ul>
      <li class="bulletList"><strong class="keyWord">Add</strong>: Installs an<a id="_idIndexMarker556"/> Angular library in an Angular CLI workspace using the <code class="inlineCode">ng add</code> command.</li>
      <li class="bulletList"><strong class="keyWord">Update</strong>: Updates<a id="_idIndexMarker557"/> an Angular library using the <code class="inlineCode">ng update</code> command.</li>
      <li class="bulletList"><strong class="keyWord">Generate</strong>: Generates <a id="_idIndexMarker558"/>Angular artifacts in an Angular CLI workspace using the <code class="inlineCode">ng generate</code> command.</li>
    </ul>
    <p class="normal">In this project, we will focus on generating schematics, but the same rules apply to all the other commands.</p>
    <h1 id="_idParaDest-168" class="heading-1">Project overview</h1>
    <p class="normal">In this project, we will learn how to use<a id="_idIndexMarker559"/> the Schematics API to build custom Angular CLI generation schematics for creating components, services, and directives. First, we will build a schematic for creating an Angular component that uses the Tailwind CSS framework in its template. Then, we will create a schematic to generate an Angular service that injects the built-in HTTP client by default and creates one method for each HTTP request in a CRUD operation. The following diagram describes an architectural overview of the project:</p>
    <figure class="mediaobject"><img src="../Images/B18465_10_01.png" alt="Εικόνα που περιέχει διάγραμμα  Περιγραφή που δημιουργήθηκε αυτόματα"/></figure>
    <p class="packt_figref">Figure 10.1 – Project architecture</p>
    <p class="normal">Build<a id="_idIndexMarker560"/> time: 1 hour</p>
    <h1 id="_idParaDest-169" class="heading-1">Getting started</h1>
    <p class="normal">The following prerequisites and software tools are required to complete this project:</p>
    <ul>
      <li class="bulletList">Angular CLI: A command-line interface for Angular, which you can find at <a href="https://angular.io/cli"><span class="url">https://angular.io/cli</span></a>.</li>
      <li class="bulletList">GitHub material: The code for this chapter can be found in the <code class="inlineCode">Chapter10</code> folder at <a href="https://github.com/PacktPublishing/Angular-Projects-Third-Edition"><span class="url">https://github.com/PacktPublishing/Angular-Projects-Third-Edition</span></a>.</li>
    </ul>
    <h1 id="_idParaDest-170" class="heading-1">Installing the Schematics CLI</h1>
    <p class="normal">The Schematics <a id="_idIndexMarker561"/>CLI is a command-line interface that we can use to interact with the Schematics API. To install it, run the following <code class="inlineCode">npm</code> command:</p>
    <pre class="programlisting con"><code class="hljs-con">npm install -g @angular-devkit/schematics-cli
</code></pre>
    <p class="normal">The preceding command will install the <code class="inlineCode">@angular-devkit/schematics-cli</code> npm package globally on our<a id="_idIndexMarker562"/> system. We can then use the <code class="inlineCode">schematics</code> executable to create a new collection for the schematics:</p>
    <pre class="programlisting con"><code class="hljs-con">schematics blank my-schematics
</code></pre>
    <p class="normal">The previous command will generate a schematics project called <code class="inlineCode">my-schematics</code>. It contains a schematic with the same name by default inside the <code class="inlineCode">src</code> folder. A schematic includes the following files:</p>
    <ul>
      <li class="bulletList"><code class="inlineCode">collection.json</code>: A JSON schema that describes the schematics that belong to the <code class="inlineCode">my-schematics</code> collection.</li>
      <li class="bulletList"><code class="inlineCode">my-schematics\index.ts</code>: The main entry point of the schematic.</li>
      <li class="bulletList"><code class="inlineCode">my-schematics\index_spec.ts</code>: The unit test file of the main entry point of the schematic.</li>
    </ul>
    <p class="normal">The JSON schema file of the collection contains one entry for each schematic associated with that collection:</p>
    <pre class="programlisting code"><code class="hljs-code"><code class="inlineCode">collection.json</code>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"$schema"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"../node_modules/@angular-devkit/schematics/collection-schema.json"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"schematics"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"my-schematics"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"A blank schematic."</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"factory"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"</span><span class="hljs-string">./my-schematics/index#mySchematics"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
    <p class="normal">Each schematic in the collection contains a short description, as indicated by the <code class="inlineCode">description</code> property, and a <code class="inlineCode">factory</code> property that points to the main entry point of the schematic using a special syntax. It contains the filename <code class="inlineCode">./my-schematics/index</code>, followed by the <code class="inlineCode">#</code> character, and the name of the function exported by that file, named <code class="inlineCode">mySchematics</code>.</p>
    <p class="normal">The main entry point of a schematic contains a rule factory method that is exported by default and returns a <code class="inlineCode">Rule</code> object, as described in the <code class="inlineCode">index.ts</code> file:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title">mySchematics</span>(<span class="hljs-params">_options: </span><span class="hljs-built_in">any</span>): <span class="hljs-title">Rule</span> {
  <span class="hljs-keyword">return</span> <span class="hljs-function">(</span><span class="hljs-params">tree: Tree, _context: SchematicContext</span><span class="hljs-function">) =&gt;</span> {
    <span class="hljs-keyword">return</span> tree;
  };
}
</code></pre>
    <p class="normal">A schematic does not interact directly with the filesystem. Instead, it creates a virtual filesystem represented by a <code class="inlineCode">Tree</code> object. The virtual filesystem contains a <em class="italic">staging</em> area where all transformations from schematics happen. This area aims to make sure that any transformations that are not valid will not propagate to the actual filesystem. As soon as the schematic is<a id="_idIndexMarker563"/> valid to execute, the virtual filesystem will apply the changes to the real one. All transformations of a schematic operate in a <code class="inlineCode">SchematicContext</code> object.</p>
    <p class="normal">In the following section, we will learn how to use the Schematics CLI and create a component generation schematic.</p>
    <h1 id="_idParaDest-171" class="heading-1">Creating a Tailwind CSS component</h1>
    <p class="normal">Tailwind is a very popular<a id="_idIndexMarker564"/> CSS framework that enforces a utility-first core principle. It contains classes and styles that can be used in Angular applications to create easily composable user interfaces.</p>
    <p class="normal">We will use the Schematics API of the Angular CLI to build a generation schematic for Angular components. The schematic will generate a new Angular component styled with a Tailwind container layout.</p>
    <div class="note">
      <p class="normal">The schematic we will build does not need Tailwind CSS installed by default. However, the application in which we will use the schematic does require it.</p>
    </div>
    <p class="normal">Let’s see how we can accomplish that:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Execute the following command to add a new schematic to our collection:
        <pre class="programlisting con"><code class="hljs-con">schematics blank tailwind-container
</code></pre>
    <p class="normal">The preceding command will update the <code class="inlineCode">collection.json</code> file to contain a new entry for the <code class="inlineCode">tailwind-container</code> schematic. It will also create a <code class="inlineCode">tailwind-container</code> folder in the <code class="inlineCode">src</code> folder of our workspace.</p>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="2">Create a <code class="inlineCode">schema.json</code> file inside the <code class="inlineCode">tailwind-container</code> folder and add the following content:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"$schema"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"http://json-schema.org/schema"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"$id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"TailwindContainerSchema"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"My Tailwind Container Schema"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"object"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"properties"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"The name of the component."</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"string"</span>
    <span class="hljs-punctuation">},</span>
    <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"string"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"format"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"path"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"The path to create the component."</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"</span><span class="hljs-attr">visible"</span><span class="hljs-punctuation">:</span> <span class="hljs-keyword">false</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">},</span>
  <span class="hljs-attr">"required"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"name"</span><span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
    <p class="normal">Each schematic can have a JSON schema file that defines the options available when running the schematic. Since we want to create a component <a id="_idIndexMarker565"/>generation schematic, we need a <code class="inlineCode">name</code> and a <code class="inlineCode">path</code> property for our component. </p>
    <p class="numberedList">Each property has associated metadata, such as the <code class="inlineCode">type</code> and the <code class="inlineCode">description</code>. The name of the component is required when invoking the schematic, as indicated by the <code class="inlineCode">required</code> array property.</p>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="3">Open the <code class="inlineCode">collection.json</code> file and set the properties of the <code class="inlineCode">tailwind-container</code> schematic as follows:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-attr">"tailwind-container"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"</span><span class="code-highlight"><strong class="hljs-string-slc">Generate a Tailwind container component.</strong></span><span class="hljs-string">"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"factory"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./tailwind-container/index#tailwindContainer"</span><span class="hljs-punctuation">,</span>
  <span class="code-highlight"><strong class="hljs-attr-slc">"schema"</strong><strong class="hljs-punctuation-slc">:</strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc">"./tailwind-container/schema.json"</strong></span>
<span class="hljs-punctuation">}</span>
</code></pre>
    <p class="normal">In the preceding file, we set a proper description for our schematic. We also add the <code class="inlineCode">schema</code> property, which points to the absolute path of the <code class="inlineCode">schema.json</code> file we created in the previous step.</p>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="4">Create a <code class="inlineCode">schema.ts</code> file inside the <code class="inlineCode">tailwind-container</code> folder and add the following content:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">Schema</span> {
    <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-attr">path</span>: <span class="hljs-built_in">string</span>;
}
</code></pre>
    <p class="normal">The preceding file defines the <code class="inlineCode">Schema</code> interface with mapping properties to those described in the <code class="inlineCode">schema.json</code> file.</p>
      </li>
    </ol>
    <p class="normal">We have now created all the<a id="_idIndexMarker566"/> underlying infrastructure we will use to create our schematic. Let’s see how to write the actual code that will run our schematic:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Create a folder named <code class="inlineCode">files</code> inside the <code class="inlineCode">tailwind-container</code> folder.</li>
      <li class="numberedList">Create a file called <code class="inlineCode">__name@dasherize__.component.html.template</code> inside the <code class="inlineCode">files</code> folder and add the following contents:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag">&lt;</span><span class="hljs-name">div</span><span class="hljs-tag"> </span><span class="hljs-attr">class</span><span class="hljs-tag">=</span><span class="hljs-string">"container mx-auto"</span><span class="hljs-tag">&gt;&lt;/</span><span class="hljs-name">div</span><span class="hljs-tag">&gt;</span>
</code></pre>
    <p class="normal">The preceding file denotes the component template that our schematic will generate. The <code class="inlineCode">__name</code> prefix will be replaced by the name of the component that we will pass as an option in the schematic. The <code class="inlineCode">@dasherize__</code> syntax indicates that the name will be separated with dashes and converted in to lowercase if passed in camel case.</p>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="3">Create a file called <code class="inlineCode">__name@dasherize__.component.ts.template</code> and add the following contents:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">import</span> { <span class="hljs-title">Component</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'</span><span class="hljs-string">@angular/core'</span>;
<span class="hljs-meta">@Component</span>({
    <span class="hljs-attr">selector</span>: <span class="hljs-string">'my-&lt;%= dasherize(name) %&gt;'</span>,
    <span class="hljs-attr">templateUrl</span>: <span class="hljs-string">'./&lt;%= dasherize(name) %&gt;.component.html'</span>
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title">My</span>&lt;%= <span class="hljs-title">classify</span>(name) %&gt;<span class="hljs-title">Component</span> {}
</code></pre>
    <p class="normal">The preceding file contains the TypeScript class of the component that will be generated. The <code class="inlineCode">selector</code> and the <code class="inlineCode">templateUrl</code> properties of the <code class="inlineCode">@Component</code> decorator are built using the <code class="inlineCode">dasherize</code> method and the <code class="inlineCode">name</code> of the component. The class name contains a different method called <code class="inlineCode">classify</code>, which takes the <code class="inlineCode">name</code> of the component as a parameter and converts it in to title case.</p>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="4">Open the <code class="inlineCode">index.ts</code> file of the <code class="inlineCode">tailwind-container</code> folder, set the option type to <code class="inlineCode">Schema</code>, and remove the <code class="inlineCode">return</code> statement. The resulting file should be the following:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">import</span> { <span class="hljs-title">Rule</span>, <span class="hljs-title">SchematicContext</span>, <span class="hljs-title">Tree</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular-devkit/schematics'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title">Schema</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./schema'</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title">tailwindContainer</span>(<span class="hljs-params">_options: Schema</span>): <span class="hljs-title">Rule</span> {
  <span class="hljs-keyword">return</span> <span class="hljs-function">(</span><span class="hljs-params">_tree: Tree, _context: SchematicContext</span><span class="hljs-function">) =&gt;</span> {
  };
}
</code></pre>
      </li>
      <li class="numberedList">Modify the <code class="inlineCode">import</code> statements <a id="_idIndexMarker567"/>at the top of the file as follows:
        <pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-keyword-slc">import</strong><strong class="hljs-slc"> { normalize, strings } </strong><strong class="hljs-keyword-slc">from</strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc">'@angular-devkit/core'</strong><strong class="hljs-slc">;</strong></span>
<span class="hljs-keyword">import</span> { <span class="code-highlight"><strong class="hljs-slc">apply, applyTemplates, chain, mergeWith, move</strong></span>, <span class="hljs-title">Rule</span>, <span class="hljs-title">SchematicContext</span>, <span class="hljs-title">Tree</span>, <span class="code-highlight"><strong class="hljs-slc">url</strong></span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular-devkit/schematics'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title">Schema</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./schema'</span>;
</code></pre>
      </li>
      <li class="numberedList">Insert the following code into the <code class="inlineCode">tailwindContainer</code> function:
        <pre class="programlisting code"><code class="hljs-code">_options.<span class="hljs-property">path</span> = _options.<span class="hljs-property">path</span> ?? <span class="hljs-title">normalize</span>(<span class="hljs-string">'src/app/'</span> + _options.<span class="hljs-property">name</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>);
    <span class="hljs-keyword">const</span> templateSource = <span class="hljs-title">apply</span>(<span class="hljs-title">url</span>(<span class="hljs-string">'./files'</span>), [
      <span class="hljs-title">applyTemplates</span>({
        <span class="hljs-attr">classify</span>: strings.<span class="hljs-property">classify</span>,
        <span class="hljs-attr">dasherize</span>: strings.<span class="hljs-property">dasherize</span>,
        <span class="hljs-attr">name</span>: _options.<span class="hljs-property">name</span>
      }),
      <span class="hljs-title">move</span>(<span class="hljs-title">normalize</span>(_options.<span class="hljs-property">path</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>))
    ]);
</code></pre>
    <p class="normal">In the preceding code, first, we set the <code class="inlineCode">path</code> property of the component in case one is not passed in the schematic. By default, we create a folder inside the <code class="inlineCode">src\app</code> folder with the same name as the component. We then use the <code class="inlineCode">apply</code> method to read the template files from the <code class="inlineCode">files</code> folder and pass the <code class="inlineCode">dasherize</code>, <code class="inlineCode">classify</code>, and <code class="inlineCode">name</code> properties using the <code class="inlineCode">applyTemplates</code> function. Finally, we call the <code class="inlineCode">move</code> method to create the generated component files in the provided path.</p>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="7">Add the following statement to the end of the factory function:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">return</span> <span class="hljs-title">chain</span>([
  <span class="hljs-title">mergeWith</span>(templateSource)
]);
</code></pre>
    <p class="normal">In the preceding <a id="_idIndexMarker568"/>snippet, we call the <code class="inlineCode">chain</code> method to execute our schematic, passing the result of the <code class="inlineCode">mergeWith</code> function, which uses the <code class="inlineCode">templateSource</code> variable we created in the previous step.</p>
      </li>
    </ol>
    <p class="normal">Now we can go ahead and test our new component schematic:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Execute the following <code class="inlineCode">npm</code> command to build the schematic:
        <pre class="programlisting con"><code class="hljs-con">npm run build
</code></pre>
    <p class="normal">The preceding command will invoke the TypeScript compiler and transpile the TypeScript source files into JavaScript. It will generate the JavaScript output files into the same folders, side by side, as the TypeScript ones.</p>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="2">Run the following command to install the schematics library into our global npm cache:
        <pre class="programlisting con"><code class="hljs-con">npm link
</code></pre>
    <p class="normal">The preceding command will allow us to install the schematic without querying the public npm registry.</p>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="3">Execute the following Angular CLI command in a folder of your choice outside the workspace to scaffold a new Angular application with the default options:
        <pre class="programlisting con"><code class="hljs-con">ng new my-app --defaults
</code></pre>
      </li>
      <li class="numberedList">Navigate to the <code class="inlineCode">my-app</code> folder and run the following command to install our schematics:
        <pre class="programlisting con"><code class="hljs-con">npm link my-schematics
</code></pre>
    <p class="normal">The previous <code class="inlineCode">npm</code> command will install the <code class="inlineCode">my-schematics</code> library in the current Angular CLI workspace.</p>
    <div class="packt_tip">
      <p class="normal">The <code class="inlineCode">npm link</code> command is like running <code class="inlineCode">npm install my-schematics</code>, except that it downloads the npm package from the global npm cache of our machine and does not add it to the <code class="inlineCode">package.json</code> file.</p>
    </div>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="5">Use the <code class="inlineCode">generate</code> command of the Angular CLI to create a <code class="inlineCode">dashboard</code> component:
        <pre class="programlisting con"><code class="hljs-con">ng generate my-schematics:tailwind-container --name=dashboard
</code></pre>
    <p class="normal">In the <a id="_idIndexMarker569"/>preceding command, we use our custom schematic by passing the name of our collection, <code class="inlineCode">my-schematics</code>, followed by the specific schematic name, <code class="inlineCode">tailwind-container</code>, separated by a colon. We also pass a name for our component using the <code class="inlineCode">--name</code> option of the schematic.</p>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="6">We can verify that our schematic worked correctly by observing the output in the terminal or opening our component with VS Code:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18465_10_02.png" alt="Figure 10.1 – Generate Angular component"/></figure>
    <p class="packt_figref">Figure 10.2 – Generate Angular component</p>
    <p class="normal">We have successfully created a new schematic to craft custom Angular components according to our needs. The schematic that we built generates a new Angular component from scratch. The Angular CLI is so extensible that we can hook into the execution of built-in Angular schematics and modify them accordingly.</p>
    <p class="normal">In the following section, we will investigate this by building a schematic for Angular HTTP services.</p>
    <h1 id="_idParaDest-172" class="heading-1">Creating an HTTP service</h1>
    <p class="normal">We will create a<a id="_idIndexMarker570"/> schematic for our schematics library that scaffolds an Angular service. It will generate a service that imports the built-in HTTP client. It will also contain one method for each HTTP request involved in a CRUD operation.</p>
    <p class="normal">The generation schematic we will build will not stand on its own. Instead, we will combine it with the existing generation schematic of the Angular CLI for services. Thus, we do not need a separate JSON schema.</p>
    <p class="normal">Let’s get started by creating the schematic:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Execute the following command to add a new schematic to our collection:
        <pre class="programlisting con"><code class="hljs-con">schematics blank crud-service
</code></pre>
      </li>
      <li class="numberedList">Run the following command to install the <code class="inlineCode">@schematics/angular</code> npm package:
        <pre class="programlisting con"><code class="hljs-con">npm install @schematics/angular
</code></pre>
      </li>
      <li class="numberedList">Open the <code class="inlineCode">collection.json</code> file and modify the <code class="inlineCode">crud-service</code> schematic:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-attr">"crud-service"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"</span><span class="code-highlight"><strong class="hljs-string-slc">Generate a CRUD HTTP service.</strong></span><span class="hljs-string">"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"factory"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./crud-service/index#crudService"</span><span class="hljs-punctuation">,</span>
  <span class="code-highlight"><strong class="hljs-attr-slc">"schema"</strong><strong class="hljs-punctuation-slc">:</strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc">"../node_modules/@schematics/angular/service/schema.json"</strong></span>
<span class="hljs-punctuation">}</span>
</code></pre>
    <p class="normal">We set a short description for the schematic and add a <code class="inlineCode">schema</code> property pointing to the<a id="_idIndexMarker571"/> original <code class="inlineCode">schema.json</code> file of Angular services.</p>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="4">Create a folder named <code class="inlineCode">files</code> inside the <code class="inlineCode">crud-service</code> folder of the workspace.</li>
      <li class="numberedList">Create a file named <code class="inlineCode">__name@dasherize__.service.ts.template</code> inside the <code class="inlineCode">files</code> folder and add the following code:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">import</span> { <span class="hljs-title">Injectable</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title">HttpClient</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/common/http'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title">Observable</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'rxjs'</span>;
<span class="hljs-meta">@Injectable</span>({
  <span class="hljs-attr">providedIn</span>: <span class="hljs-string">'root'</span>
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> &lt;%= <span class="hljs-title">classify</span>(name) %&gt;<span class="hljs-title">Service</span> {
  <span class="hljs-title">constructor</span>(<span class="hljs-keyword">private</span><span class="hljs-params"> http: HttpClient</span>) { }
}
</code></pre>
    <p class="normal">The preceding file is the template of the Angular service file that our schematic will generate. It injects the <code class="inlineCode">HttpClient</code> service into the <code class="inlineCode">constructor</code> of the class by default.</p>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="6">Define a <a id="_idIndexMarker572"/>service property that will represent the URL of the API with which we want to communicate:
        <pre class="programlisting code"><code class="hljs-code">apiUrl = <span class="hljs-string">'</span><span class="hljs-string">/api'</span>;
</code></pre>
      </li>
      <li class="numberedList">Add the following methods for each HTTP request of a CRUD operation:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-title">create</span>(<span class="hljs-params">obj</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-variable">this</span>.<span class="hljs-property">http</span>.<span class="hljs-title">post</span>(<span class="hljs-variable">this</span>.<span class="hljs-property">apiUrl</span>, obj);
}
<span class="hljs-title">read</span>() {
  <span class="hljs-keyword">return</span> <span class="hljs-variable">this</span>.<span class="hljs-property">http</span>.<span class="hljs-title">get</span>(<span class="hljs-variable">this</span>.<span class="hljs-property">apiUrl</span>);
}
<span class="hljs-title">update</span>(<span class="hljs-params">obj</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-variable">this</span>.<span class="hljs-property">http</span>.<span class="hljs-title">put</span>(<span class="hljs-variable">this</span>.<span class="hljs-property">apiUrl</span>, obj);
}
<span class="hljs-title">delete</span>(<span class="hljs-params">id</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-variable">this</span>.<span class="hljs-property">http</span>.<span class="hljs-title">delete</span>(<span class="hljs-variable">this</span>.<span class="hljs-property">apiUrl</span> + id);
}
</code></pre>
      </li>
    </ol>
    <p class="normal">Creating all the methods beforehand eliminates much of the boilerplate code. The developer that uses the schematic will only need to modify these methods and add the actual implementation for each one.</p>
    <p class="normal">We have almost finished our schematic except for creating the factory function that will invoke the generation of the service:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Open the <code class="inlineCode">index.ts</code> file of the <code class="inlineCode">crud-service</code> folder and modify the <code class="inlineCode">import</code> statements as follows:
        <pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-keyword-slc">import</strong><strong class="hljs-slc"> { normalize, strings } </strong><strong class="hljs-keyword-slc">from</strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc">'@angular-devkit/core'</strong><strong class="hljs-slc">;</strong></span>
<span class="hljs-keyword">import</span> { <span class="code-highlight"><strong class="hljs-slc">apply, applyTemplates, chain, externalSchematic, </strong><strong class="hljs-title-slc">MergeStrategy</strong><strong class="hljs-slc">, mergeWith, move</strong></span>, <span class="hljs-title">Rule</span>, <span class="hljs-title">SchematicContext</span>, <span class="hljs-title">Tree</span>, <span class="code-highlight"><strong class="hljs-slc">url</strong></span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular-devkit/schematics'</span>;
</code></pre>
      </li>
      <li class="numberedList">Rename the <code class="inlineCode">tree</code> parameter and remove it from the <code class="inlineCode">return</code> statement because we will not use it. The resulting factory function should look like the following:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title">crudService</span>(<span class="hljs-params">_options: </span><span class="hljs-built_in">any</span>): <span class="hljs-title">Rule</span> {
  <span class="hljs-keyword">return</span> <span class="hljs-function">(</span><span class="hljs-params">_tree: Tree, _context: SchematicContext</span><span class="hljs-function">) =&gt;</span> {};
}
</code></pre>
      </li>
      <li class="numberedList">Add the following snippet to the <code class="inlineCode">crudService</code> function:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">const</span> templateSource = <span class="hljs-title">apply</span>(<span class="hljs-title">url</span>(<span class="hljs-string">'./files'</span>), [
  <span class="hljs-title">applyTemplates</span>({
    ..._options,
    <span class="hljs-attr">classify</span>: strings.<span class="hljs-property">classify</span>,
    <span class="hljs-attr">dasherize</span>: strings.<span class="hljs-property">dasherize</span>
  }),
  <span class="hljs-title">move</span>(<span class="hljs-title">normalize</span>(_options.<span class="hljs-property">path</span> ?? <span class="hljs-title">normalize</span>(<span class="hljs-string">'src/app/'</span>)))
]);
</code></pre>
    <p class="normal">The previous snippet looks identical to the one we used for our component schematic. The <a id="_idIndexMarker573"/>main differences are that the default path is the <code class="inlineCode">src\app</code> folder and that we pass all available options using the <code class="inlineCode">_options</code> parameter to the schematic.</p>
    <div class="note">
      <p class="normal">Knowing which options will be<a id="_idIndexMarker574"/> used to generate the Angular service beforehand is impossible. Thus, we use the <strong class="keyWord">spread</strong> operator to pass all available options to the <code class="inlineCode">templateSource</code> method. That is also why the <code class="inlineCode">_options</code> parameter is of type <code class="inlineCode">any</code>.</p>
    </div>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="4">Add the following <code class="inlineCode">return</code> statement to the end of the function:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">return</span> <span class="hljs-title">chain</span>([
  <span class="hljs-title">externalSchematic</span>(<span class="hljs-string">'@schematics/angular'</span>, <span class="hljs-string">'service'</span>, _options),
  <span class="hljs-title">mergeWith</span>(templateSource, <span class="hljs-title">MergeStrategy</span>.<span class="hljs-property">Overwrite</span>)
]);
</code></pre>
    <p class="normal">In the preceding statement, we use the <code class="inlineCode">externalSchematic</code> method to call the built-in generation schematic for creating Angular services. Then, we merge the result from executing that schematic with our <code class="inlineCode">templateSource</code> variable. We also define the strategy of the merge operation using <code class="inlineCode">MergeStrategy.Overwrite</code> so that any changes made by our schematic will overwrite the default ones.</p>
      </li>
    </ol>
    <p class="normal">Our schematic for creating CRUD services is now complete. Let’s use it in our sample application:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Execute the following command to build the schematics library:
        <pre class="programlisting con"><code class="hljs-con">npm run build
</code></pre>
    <div class="packt_tip">
      <p class="normal">We do not need to link the schematics library again. Our application will be automatically updated as soon as we make a new build of our schematics.</p>
    </div>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="2">Navigate to<a id="_idIndexMarker575"/> the <code class="inlineCode">my-app</code> folder in which our application resides.</li>
      <li class="numberedList">Execute the following command to generate an Angular service using our new schematic:
        <pre class="programlisting con"><code class="hljs-con">ng generate my-schematics:crud-service --name=customers
</code></pre>
    <p class="normal">We use the <code class="inlineCode">generate</code> command of the Angular CLI, passing the name of our schematics collection again but targeting the <code class="inlineCode">crud-service</code> schematic this time.</p>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="4">The new Angular service is created in the <code class="inlineCode">src\app</code> folder, as indicated by the output in the terminal window:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18465_10_03.png" alt="Figure 10.2 – Generating an Angular service"/></figure>
    <p class="packt_figref">Figure 10.3 – Generating an Angular service</p>
    <p class="normal">Notice that the schematic has generated a unit test file for us automatically. How is this possible? Recall that we merged our schematic with the built-in generation schematic of the Angular CLI. So, whatever the default schematic does, it reflects directly on the execution of the custom schematic.</p>
    <p class="normal">We have just added a new helpful command to our schematics collection. We can generate an Angular service that interacts with HTTP endpoints. Moreover, we have added the fundamental methods needed for communicating with the endpoint.</p>
    <h1 id="_idParaDest-173" class="heading-1">Summary</h1>
    <p class="normal">In this project, we used the Schematics API of the Angular CLI to create custom schematics for our needs. We built a schematic for generating Angular components that contain Tailwind CSS styles in their templates. We also built another schematic that creates an Angular service to interact with the built-in HTTP client. The service includes all the necessary artifacts for working with an HTTP CRUD application.</p>
    <p class="normal">The Angular CLI is a flexible and extensible tool that enhances the development experience dramatically. The imagination of each developer is all that limits what can be done with such an asset in their toolchain. The CLI and the Angular framework allow developers to create excellent web applications.</p>
    <p class="normal">As we have learned throughout this book, the popularity of the Angular framework in the web developer world is so great that it is straightforward to integrate it today with any technology and create fast and scalable Angular applications. So, we encourage you to get the latest version of Angular and create amazing applications today.</p>
    <h1 id="_idParaDest-174" class="heading-1">Exercise</h1>
    <p class="normal">Use the Schematics CLI to create an Angular schematic for generating an Angular directive. The directive should inject the <code class="inlineCode">ElementRef</code> and <code class="inlineCode">Renderer2</code> services from the <code class="inlineCode">@angular/core</code> npm package in to the constructor of the TypeScript class.</p>
    <div class="packt_tip">
      <p class="normal">You should follow the same approach as we did for the component schematic in the <em class="italic">Creating a Tailwind CSS component</em> section.</p>
    </div>
    <p class="normal">You can find the solution in the <code class="inlineCode">Chapter10</code> folder of the <code class="inlineCode">exercise</code> branch in the GitHub repository for this chapter.</p>
    <h1 id="_idParaDest-175" class="heading-1">Further reading</h1>
    <ul>
      <li class="bulletList">Schematics overview: <a href="https://angular.io/guide/schematics"><span class="url">https://angular.io/guide/schematics</span></a></li>
      <li class="bulletList">Authoring schematics: <a href="https://angular.io/guide/schematics-authoring"><span class="url">https://angular.io/guide/schematics-authoring</span></a></li>
      <li class="bulletList">Schematics for libraries: <a href="https://angular.io/guide/schematics-for-libraries"><span class="url">https://angular.io/guide/schematics-for-libraries</span></a></li>
      <li class="bulletList">Angular CLI built-in schematics: <a href="https://github.com/angular/angular-cli/tree/master/packages/schematics/angular"><span class="url">https://github.com/angular/angular-cli/tree/master/packages/schematics/angular</span></a></li>
    </ul>
  </div>
</body></html>