<html><head></head><body>
<div id="sbo-rt-content"><div id="_idContainer004">
<h1 id="_idParaDest-7"><a id="_idTextAnchor005"/>Preface</h1>
<p>This is a book about dogma. <em class="italic">My</em> dogma. It is a set of principles, practices, and rituals that I have found to be extremely beneficial when building React applications. I try to apply these ideas in my daily work, and I believe in them so much that I take every opportunity to teach others about them. That’s why I’ve written this book: to show you the ideas that have helped me be successful in my own career. </p>
<p>As with any dogma, you are free to make your own mind up about it. There are people who will dislike everything about this book. There are those who will love everything about this book. Yet more people will absorb some things and forget others. All of these are fine. The only thing I ask is that you maintain an open mind while you follow along and prepare to have your own dogmas challenged. </p>
<p><strong class="bold">Test-driven development</strong> (<strong class="bold">TDD</strong>) did not originate in the JavaScript community. However, it is perfectly possible to test-drive JavaScript code. And although TDD is not common in the React community, there’s no reason why it shouldn’t be. In fact, React as a user interface platform is a good fit for TDD because of its elegant model of functional components and state. </p>
<p>So, what is TDD, and why should you use it? TDD is a process for writing software that involves writing tests, or specifications, before writing any code. Its practitioners follow it because they believe that it helps them build and design higher-quality software with longer lifespans, at a lower cost. They believe it offers a mechanism for communicating about design and specification that <em class="italic">also</em> doubles up as a rock-solid regression suite. There isn’t much empirical data available that <em class="italic">proves</em> any of that to be true, so the best you can do is try it out yourself and make your own mind up. </p>
<p>Perhaps most importantly for me, I find that TDD removes the <em class="italic">fear</em> of making changes to my software and makes my working days much less stressful than they used to be. I don’t worry about introducing bugs or regressions into my work because the tests protect me from that. </p>
<p>TDD is often taught with toy examples: to-do lists, temperature converters, tic-tac-toe, and so on. This book teaches two real-world applications. Often, the tests get hairy. We will hit many challenging scenarios and come up with solutions for all of them. There are over 500 tests contained in this book, and each one will teach you something. </p>
<p>Before we begin, a few words of advice.</p>
<p>This is a book about <strong class="bold">first principles</strong>. I believe that learning TDD is about understanding the process in exceptional detail. For that reason, we will <em class="italic">not</em> use React Testing Library. Instead, we will build our own test helpers. I am not suggesting that you should avoid these tools in your daily work – I use them myself – but I am suggesting that going without them while you learn is a worthwhile adventure. The benefit of doing so is a deeper understanding and awareness of what those testing libraries are doing for you.</p>
<p>The JavaScript and React landscape changes at such a pace that I can’t claim that this book will remain current for very long. That is another reason why I use a first-principles approach. My hope is that when things <em class="italic">do</em> change, you’ll still be able to use this book and apply what you’ve learned to those new scenarios. </p>
<p>Another theme in this book is <strong class="bold">systematic refactoring</strong>, which can come across as rather laborious but is a cornerstone of TDD and other good design practices. I have provided many examples of that within these pages, but for brevity, I sometimes jump straight to a final, refactored solution. For example, I sometimes choose to extract methods <em class="italic">before</em> they are written, whereas, in the real world, I would usually write methods inline and only extract when the containing method (or test) becomes too long. </p>
<p>Yet another theme is that of <strong class="bold">cheating</strong>, which you won’t find mentioned in many TDD books. It’s an acknowledgment that the TDD workflow is a scaffold around which you can build your own rules. Once you’ve learned and practiced the strict version of TDD for a while, you can learn what cheats you can use to cut corners. What tests won’t provide much value in the long run? How can you speed up repetitive tests? So, a <strong class="bold">cheat </strong>is almost like saying you cut a corner in a way that wouldn’t be obvious to an observer if they came to look at your code tomorrow. Maybe, for example, you implement three tests at once, rather than one at a time.</p>
<p>In this second edition of the book, I have doubled down on teaching TDD over React features. Beyond updating the code samples to work with React 18, there are few usages of new React features. Instead, the tests have been vastly improved; they are simpler, smaller, and utilize custom Jest matchers (which are themselves test-driven). Readers of the first edition will notice that I’ve changed my approach to component mocks; this edition relies on module mocks via the <strong class="source-inline">jest.mock</strong> function. The book no longer teaches shallow rendering. There are other smaller changes too, such as the avoidance of the <strong class="source-inline">ReactTestUtils.Simulate</strong> module. Chapter organization has been improved too, with some of the earlier chapters split up and streamlined. I hope you’ll agree that this edition is leaps and bounds better than the first.</p>
<h1 id="_idParaDest-8"><a id="_idTextAnchor006"/>Who this book is for</h1>
<p>If you’re a React programmer, this book is for you. I aim to show you how TDD can improve your work. </p>
<p>If you’re already knowledgeable about TDD, I hope there’s still a lot you can learn from comparing your own process with mine. </p>
<p>If you don’t already know React, you will benefit from spending some time running through the <em class="italic">Getting Started</em> guide on the React website. That being said, TDD is a wonderful platform for explaining new technologies, and it’s entirely plausible that you’ll be able to pick up React simply by following this book. </p>
<h1 id="_idParaDest-9"><a id="_idTextAnchor007"/>What this book covers</h1>
<p><a href="B18423_01.xhtml#_idTextAnchor017"><em class="italic">Chapter 1</em></a>, <em class="italic">First Steps with Test-Driven Development</em>, introduces Jest and the TDD cycle.</p>
<p><a href="B18423_02.xhtml#_idTextAnchor038"><em class="italic">Chapter 2</em></a>, <em class="italic">Rendering Lists and Detail Views</em>, uses the TDD cycle to build a simple page displaying customer information.</p>
<p><a href="B18423_03.xhtml#_idTextAnchor053"><em class="italic">Chapter 3</em></a>, <em class="italic">Refactoring the Test Suite</em>, introduces some of the basic ways in which you can simplify tests.</p>
<p><a href="B18423_04.xhtml#_idTextAnchor062"><em class="italic">Chapter 4</em></a>, <em class="italic">Test-Driving Data Input with React</em>, covers using React component state to manage the display and saving of text input fields. </p>
<p><a href="B18423_05.xhtml#_idTextAnchor079"><em class="italic">Chapter 5</em></a>, <em class="italic">Adding Complex Form Interactions</em>, looks at a more complex form setup with dropdowns and radio buttons.</p>
<p><a href="B18423_06.xhtml#_idTextAnchor099"><em class="italic">Chapter 6</em></a>, <em class="italic">Exploring Test Doubles</em>, introduces various types of test doubles that are necessary for testing collaborating objects, and how to use them to test-drive form submission.</p>
<p><a href="B18423_07.xhtml#_idTextAnchor125"><em class="italic">Chapter 7</em></a>, <em class="italic">Testing useEffect and Mocking Components</em>, looks at using test doubles to fetch data when components are mounted, and how to use module mocks to block that behavior when testing parent components. </p>
<p><a href="B18423_08.xhtml#_idTextAnchor147"><em class="italic">Chapter 8</em></a>, <em class="italic">Building an Application Component</em>, ties everything together with a “root” component that threads together a user journey. </p>
<p><a href="B18423_09.xhtml#_idTextAnchor159"><em class="italic">Chapter 9</em></a>, <em class="italic">Form Validation</em>, continues with form building by adding client- and server-side validation and adding an indicator to show that data is being submitted. </p>
<p><a href="B18423_10.xhtml#_idTextAnchor183"><em class="italic">Chapter 10</em></a>, <em class="italic">Filtering and Searching Data</em>, shows how to build a search component with some complex interaction requirements, in addition to complex fetch request requirements.</p>
<p><a href="B18423_11.xhtml#_idTextAnchor207"><em class="italic">Chapter 11</em></a>, <em class="italic">Test-Driving React Router</em>, introduces the React Router library to simplify navigation within our user journeys.</p>
<p><a href="B18423_12.xhtml#_idTextAnchor231"><em class="italic">Chapter 12</em></a>, <em class="italic">Test-Driving Redux</em>, introduces Redux into our application.</p>
<p><a href="B18423_13.xhtml#_idTextAnchor258"><em class="italic">Chapter 13</em></a>, <em class="italic">Test-Driving GraphQL</em>, introduces the Relay library to communicate with a GraphQL endpoint that’s provided by our application backend. </p>
<p><a href="B18423_14.xhtml#_idTextAnchor277"><em class="italic">Chapter 14</em></a>, <em class="italic">Building a Logo Interpreter</em>, introduces a fun application that we will begin to explore by building out features across both React components and Redux middleware: undo/redo, persisting state across browser sessions with the <strong class="source-inline">LocalStorage</strong> API, and programmatically managing field focus. </p>
<p><a href="B18423_15.xhtml#_idTextAnchor306"><em class="italic">Chapter 15</em></a>, <em class="italic">Adding Animation</em>, covers adding animations to our application using the browser <strong class="source-inline">requestAnimationFrame</strong> API, all with a test-driven approach. </p>
<p><a href="B18423_16.xhtml#_idTextAnchor322"><em class="italic">Chapter 16</em></a>, <em class="italic">Working with WebSockets</em>, adds support for WebSocket communication with our application backend. </p>
<p><a href="B18423_17.xhtml#_idTextAnchor344"><em class="italic">Chapter 17</em></a>, <em class="italic">Writing Your First Cucumber Test</em>, introduces Cucumber and Puppeteer, which we will use to build BDD tests for existing functionality. </p>
<p><a href="B18423_18.xhtml#_idTextAnchor355"><em class="italic">Chapter 18</em></a>, <em class="italic">Adding Features Guided by Cucumber Tests</em>, integrates acceptance testing into our development process by first building BDD tests with Cucumber, before dropping down to unit tests. </p>
<p><a href="B18423_19.xhtml#_idTextAnchor375"><em class="italic">Chapter 19</em></a>, <em class="italic">Understanding TDD in the Wider Testing Landscape</em>, finishes the book by looking at how what you’ve learned fits in with other test and quality practices. </p>
<h1 id="_idParaDest-10"><a id="_idTextAnchor008"/>To get the most out of this book</h1>
<p>There are two ways to read this book. </p>
<p>The first is to use it as a reference when you are faced with specific testing challenges. Use the index to find what you’re after and move to that page. </p>
<p>The second, and the one I’d recommend starting with, is to follow the walk-throughs step by step, building your own code base as you go along. The companion GitHub repository has a directory for each chapter (such as <strong class="source-inline">Chapter01</strong>) and then, within that, three directories:</p>
<ul>
<li><strong class="source-inline">Start</strong>, which is the starting point for the chapter, and you should start here if you’re following along.</li>
<li><strong class="source-inline">Exercises</strong>, which is the point at the end of the chapter where the exercises begin. You should start here if you’re attempting the exercises in each chapter. (Note that not every chapter has exercises.)</li>
<li><strong class="source-inline">Complete</strong>, which contains completed solutions to all the exercises.</li>
</ul>
<p>You will need to be at least a little proficient with <strong class="bold">Git</strong>; a basic understanding of the <strong class="source-inline">branch</strong>, <strong class="source-inline">checkout</strong>, <strong class="source-inline">clone</strong>, <strong class="source-inline">commit</strong>, <strong class="source-inline">diff</strong>, and <strong class="source-inline">merge</strong> commands should be sufficient.</p>
<p>Take a look at the <strong class="source-inline">README.md</strong> file in the GitHub repository for more information and instructions on working with the code base.</p>
<p><strong class="bold">If you are using the digital version of this book, we advise you to type the code yourself or access the code from the book’s GitHub repository (a link is available in the next section). Doing so will help you avoid any potential errors related to the copying and pasting of code.</strong></p>
<h1 id="_idParaDest-11"><a id="_idTextAnchor009"/>Download the example code files</h1>
<p>You can download the example code files for this book from GitHub at <a href="http://github.com/packtPublishing/Mastering-React-Test-Driven-Development-Second-Edition/">http://github.com/packtPublishing/Mastering-React-Test-Driven-Development-Second-Edition/</a>. If there’s an update to the code, it will be updated in the GitHub repository.</p>
<p>We also have other code bundles from our rich catalog of books and videos available at <a href="https://github.com/PacktPublishing/">https://github.com/PacktPublishing/</a>. Check them out!</p>
<h1 id="_idParaDest-12"><a id="_idTextAnchor010"/>Download the color images</h1>
<p>We also provide a PDF file that has color images of the screenshots and diagrams used in this book. You can download it here: <a href="https://packt.link/5dqQx">https://packt.link/5dqQx</a>.</p>
<h1 id="_idParaDest-13"><a id="_idTextAnchor011"/>Conventions used</h1>
<p>There are a number of text conventions used throughout this book.</p>
<p><strong class="source-inline">Code in text</strong>: Indicates code words in text, database table names, folder names, filenames, file extensions, pathnames, dummy URLs, user input, and Twitter handles. Here is an example: “In the first test, change the word <strong class="source-inline">appendChild</strong> to <strong class="source-inline">replaceChildren</strong>.”</p>
<p><strong class="bold">Bold</strong>: Indicates a new term, an important word, or words that you see onscreen. For instance, words in menus or dialog boxes appear in <strong class="bold">bold</strong>. Here is an example: “The presenter clicks the <strong class="bold">Start sharing</strong> button.”</p>
<p class="callout-heading">Tips or important notes</p>
<p class="callout">Appear like this.</p>
<h2 id="_idParaDest-14"><a id="_idTextAnchor012"/>Code snippet conventions</h2>
<p>A block of code is set as follows:</p>
<pre class="source-code">
it("renders the customer first name", () =&gt; {  const customer = { firstName: "Ashley" };  render(&lt;Appointment customer={customer} /&gt;);  expect(document.body.textContent).toContain("Ashley");});</pre>
<p>There are two important things to know about the code snippets that appear in this book. </p>
<p>The first is that some code samples show modifications to existing sections of code. When this happens, the changed lines appear in <strong class="bold">bold</strong>, and the other lines are simply there to provide context:</p>
<pre class="source-code">
export const Appointment = (<strong class="bold">{ customer }</strong>) =&gt; (  &lt;div&gt;<strong class="bold">{customer.firstName}</strong>&lt;/div&gt;);</pre>
<p>The second is that, often, some code samples will skip lines in order to keep the context clear. When this occurs, you’ll see this marked by a line with three dots: </p>
<pre class="source-code">
if (!anyErrors(validationResult)) {
  ...
}<strong class="bold"> else {</strong>
<strong class="bold">  setValidationErrors(validationResult); </strong>
<strong class="bold">}</strong> </pre>
<p>Sometimes, this happens for function parameters too: </p>
<pre class="source-code">
if (!anyErrors(validationResult)) {
  setSubmitting(true);
  const result = await window.fetch(...);
<strong class="bold">  setSubmitting(false); </strong>
  ... 
}</pre>
<p>Any command-line input or output is written as follows: </p>
<p class="source-code">npx relay-compiler</p>
<h2 id="_idParaDest-15"><a id="_idTextAnchor013"/>JavaScript conventions</h2>
<p>The book almost exclusively uses arrow functions for defining functions. The only exceptions are when we write generator functions, which must use the standard function’s syntax. If you’re not familiar with arrow functions, they look like this, which defines a single-argument function named <strong class="source-inline">inc</strong>: </p>
<pre class="source-code">
const inc = arg =&gt; arg + 1;</pre>
<p>They can appear on one line or be broken into two: </p>
<pre class="source-code">
const inc = arg =&gt;
  arg + 1;</pre>
<p>Functions that have more than one argument have the arguments wrapped in brackets: </p>
<pre class="source-code">
const add = (a, b) =&gt; a + b;</pre>
<p>If a function has multiple statements, then the body is wrapped in curly braces:</p>
<pre class="source-code">
const dailyTimeSlots = (salonOpensAt, salonClosesAt) =&gt; {
  ...
  return timeIncrements(totalSlots, startTime, increment);};</pre>
<p>If the function returns an object, then that object must be wrapped in brackets so that the runtime doesn’t think it’s executing a block: </p>
<pre class="source-code">
setAppointment(appointment =&gt; ({  ...appointment,  [name]: value }); </pre>
<p>This book makes liberal use of destructuring techniques to keep the code base as concise as possible. As an example, object destructuring generally happens for function parameters: </p>
<pre class="source-code">
const handleSelectBoxChange = (
  { target: { value, name } }
) =&gt; {
  ...
}; </pre>
<p>This is equivalent to saying this: </p>
<pre class="source-code">
const handleSelectBoxChange = (event) =&gt; {
  const target = event.target;
  const value = target.value;
  const name = target.name;
  ...
}; </pre>
<p>Return values can also be destructured in the same way: </p>
<pre class="source-code">
const [customer, setCustomer] = useState({});</pre>
<p>This is equivalent to the following: </p>
<pre class="source-code">
const customerState = useState({});
const customer = customerState[0];
const setCustomer = customerState[1];</pre>
<h1 id="_idParaDest-16"><a id="_idTextAnchor014"/>Get in touch</h1>
<p>Feedback from our readers is always welcome.</p>
<p><strong class="bold">General feedback</strong>: If you have questions about any aspect of this book, email us at <a href="mailto:customercare@packtpub.com">customercare@packtpub.com</a> and mention the book title in the subject of your message.</p>
<p><strong class="bold">Errata</strong>: Although we have taken every care to ensure the accuracy of our content, mistakes do happen. If you have found a mistake in this book, we would be grateful if you would report this to us. Please visit <a href="http://www.packtpub.com/support/errata">www.packtpub.com/support/errata</a> and fill in the form.</p>
<p><strong class="bold">Piracy</strong>: If you come across any illegal copies of our works in any form on the internet, we would be grateful if you would provide us with the location address or website name. Please contact us at <a href="mailto:copyright@packt.com">copyright@packt.com</a> with a link to the material.</p>
<p><strong class="bold">If you are interested in becoming an author</strong>: If there is a topic that you have expertise in and you are interested in either writing or contributing to a book, please visit <a href="http://authors.packtpub.com">authors.packtpub.com</a>.</p>
<h1 id="_idParaDest-17"><a id="_idTextAnchor015"/>Share Your Thoughts</h1>
<p>Once you’ve read <em class="italic">Mastering React Test-Driven Development</em>, we’d love to hear your thoughts! Please <a href="https://packt.link/r/1803247126">click here to go straight to the Amazon review page</a> for this book and share your feedback.</p>
<p>Your review is important to us and the tech community and will help us make sure we’re delivering excellent quality content.</p>
</div>
</div>

<div id="sbo-rt-content"><div class="Content" id="_idContainer005">
<h1 id="_idParaDest-18"><a id="_idTextAnchor016"/>Part 1 – Exploring the TDD Workflow</h1>
<p><em class="italic">Part 1</em> introduces all of the basic techniques you’ll need to test-drive React applications. As you build more of the application, you will create a set of library functions that help to simplify and accelerate your testing. The goal is to give you both theoretical and practical advice that will help you apply the test-driven development workflow to your daily work.</p>
<p>This part includes the following chapters:</p>
<ul>
<li><a href="B18423_01.xhtml#_idTextAnchor017"><em class="italic">Chapter 1</em></a>, <em class="italic">First Steps with Test-Driven Development</em></li>
<li><a href="B18423_02.xhtml#_idTextAnchor038"><em class="italic">Chapter 2</em></a>, <em class="italic">Rendering Lists and Detail Views</em></li>
<li><a href="B18423_03.xhtml#_idTextAnchor053"><em class="italic">Chapter 3</em></a>, <em class="italic">Refactoring the Test Suite</em></li>
<li><a href="B18423_04.xhtml#_idTextAnchor062"><em class="italic">Chapter 4</em></a>, <em class="italic">Test-Driving Data Input</em></li>
<li><a href="B18423_05.xhtml#_idTextAnchor079"><em class="italic">Chapter 5</em></a>, <em class="italic">Adding Complex Form Interactions</em></li>
<li><a href="B18423_06.xhtml#_idTextAnchor099"><em class="italic">Chapter 6</em></a>, <em class="italic">Exploring Test Doubles</em></li>
<li><a href="B18423_07.xhtml#_idTextAnchor125"><em class="italic">Chapter 7</em></a>, <em class="italic">Testing useEffect and Mocking Components</em></li>
<li><a href="B18423_08.xhtml#_idTextAnchor147"><em class="italic">Chapter 8</em></a>, <em class="italic">Building an Application Component</em></li>
</ul>
</div>
</div></body></html>