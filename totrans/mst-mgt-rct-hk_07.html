<html><head></head><body>
		<div id="_idContainer014">
			<h1 id="_idParaDest-73"><em class="italic"><a id="_idTextAnchor073"/><span class="koboSpan" id="kobo.1.1">Chapter 5</span></em><span class="koboSpan" id="kobo.2.1">: Sharing Component State with Context and Subscription</span></h1>
			<p><span class="koboSpan" id="kobo.3.1">In the previous two chapters, we learned how to use Context and Subscription for a global state. </span><span class="koboSpan" id="kobo.3.2">Each has different benefits: Context allows us to provide different values for different subtrees, while Subscriptions prevent extra re-renders.</span></p>
			<p><span class="koboSpan" id="kobo.4.1">In this chapter, we will learn a new approach: combining React Context and Subscriptions. </span><span class="koboSpan" id="kobo.4.2">The combination will give us the benefits of each, which means:</span></p>
			<ul>
				<li><span class="koboSpan" id="kobo.5.1">Context can provide a global state to a subtree and the Context provider can be nested. </span><span class="koboSpan" id="kobo.5.2">Context allows us to control a global state in the React component lifecycle like the </span><strong class="source-inline"><span class="koboSpan" id="kobo.6.1">useState</span></strong><span class="koboSpan" id="kobo.7.1"> hook.</span></li>
				<li><span class="koboSpan" id="kobo.8.1">On the other hand, Subscriptions allow us to control re-renders, which is not possible with a single Context.</span></li>
			</ul>
			<p><span class="koboSpan" id="kobo.9.1">Having the benefits of both can be a good solution for larger apps – because, as mentioned, this means we can have different values in different subtrees, and we can also avoid extra re-renders.</span></p>
			<p><span class="koboSpan" id="kobo.10.1">This approach is useful for mid to large apps. </span><span class="koboSpan" id="kobo.10.2">In such apps, having different values in different subtrees can happen, and we can avoid extra re-renders, which can be very important for our apps.</span></p>
			<p><span class="koboSpan" id="kobo.11.1">In this chapter, we will cover the following topics:</span></p>
			<ul>
				<li><span class="koboSpan" id="kobo.12.1">Exploring the limitations of module state</span></li>
				<li><span class="koboSpan" id="kobo.13.1">Understanding when to use Context</span></li>
				<li><span class="koboSpan" id="kobo.14.1">Implementing the Context and Subscription pattern</span></li>
			</ul>
			<h1 id="_idParaDest-74"><a id="_idTextAnchor074"/><span class="koboSpan" id="kobo.15.1">Technical requirements</span></h1>
			<p><span class="koboSpan" id="kobo.16.1">You are expected to have moderate knowledge of React, including React Hooks. </span><span class="koboSpan" id="kobo.16.2">Refer to the official site, </span><a href="https://reactjs.org"><span class="koboSpan" id="kobo.17.1">https://reactjs.org</span></a><span class="koboSpan" id="kobo.18.1">, to learn more.</span></p>
			<p><span class="koboSpan" id="kobo.19.1">In some code, we use TypeScript (</span><a href="https://www.typescriptlang.org"><span class="koboSpan" id="kobo.20.1">https://www.typescriptlang.org</span></a><span class="koboSpan" id="kobo.21.1">), and you should have basic knowledge of it.</span></p>
			<p><span class="koboSpan" id="kobo.22.1">The code in this chapter is available on GitHub: </span><a href="https://github.com/PacktPublishing/Micro-State-Management-with-React-Hooks/tree/main/chapter_05"><span class="koboSpan" id="kobo.23.1">https://github.com/PacktPublishing/Micro-State-Management-with-React-Hooks/tree/main/chapter_05</span></a><span class="koboSpan" id="kobo.24.1">.</span></p>
			<p><span class="koboSpan" id="kobo.25.1">To run code snippets, you need a React environment, for example, Create React App (</span><a href="https://create-react-app.dev"><span class="koboSpan" id="kobo.26.1">https://create-react-app.dev</span></a><span class="koboSpan" id="kobo.27.1">) or CodeSandbox (</span><a href="https://codesandbox.io"><span class="koboSpan" id="kobo.28.1">https://codesandbox.io</span></a><span class="koboSpan" id="kobo.29.1">).</span></p>
			<h1 id="_idParaDest-75"><a id="_idTextAnchor075"/><span class="koboSpan" id="kobo.30.1">Exploring the limitations of module state</span></h1>
			<p><span class="koboSpan" id="kobo.31.1">Because </span><a id="_idIndexMarker207"/><span class="koboSpan" id="kobo.32.1">module state resides outside React components, there's a limitation: the module state defined globally is a singleton, and you can't have different states for different component trees or subtrees.</span></p>
			<p><span class="koboSpan" id="kobo.33.1">Let's revisit our </span><strong class="source-inline"><span class="koboSpan" id="kobo.34.1">createStore</span></strong><span class="koboSpan" id="kobo.35.1"> implementation from </span><a href="B17780_04_Final_VK_ePub.xhtml#_idTextAnchor066"><em class="italic"><span class="koboSpan" id="kobo.36.1">Chapter 4</span></em></a><span class="koboSpan" id="kobo.37.1">, </span><em class="italic"><span class="koboSpan" id="kobo.38.1">Sharing Module State with Subscription</span></em><span class="koboSpan" id="kobo.39.1">:</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.40.1">const createStore = (initialState) =&gt; {</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.41.1">  let state = initialState;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.42.1">  const callbacks = new Set();</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.43.1">  const getState = () =&gt; state;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.44.1">  const setState = (nextState) =&gt; {</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.45.1">    state = typeof nextState === 'function'</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.46.1">      ? </span><span class="koboSpan" id="kobo.46.2">nextState(state) : nextState;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.47.1">    callbacks.forEach((callback) =&gt; callback());</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.48.1">  };</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.49.1">  const subscribe =(callback) =&gt; {</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.50.1">    callbacks.add(callback);</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.51.1">    return () =&gt; { callbacks.delete(callback); };</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.52.1">  };</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.53.1">  return { getState, setState, subscribe };</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.54.1">};</span></p>
			<p><span class="koboSpan" id="kobo.55.1">Using this </span><strong class="source-inline"><span class="koboSpan" id="kobo.56.1">createStore</span></strong><span class="koboSpan" id="kobo.57.1">, let's define a new </span><strong class="source-inline"><span class="koboSpan" id="kobo.58.1">store</span></strong><span class="koboSpan" id="kobo.59.1">. </span><span class="koboSpan" id="kobo.59.2">We define a </span><strong class="source-inline"><span class="koboSpan" id="kobo.60.1">store</span></strong><span class="koboSpan" id="kobo.61.1"> with a property </span><strong class="source-inline"><span class="koboSpan" id="kobo.62.1">count</span></strong><span class="koboSpan" id="kobo.63.1">:</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.64.1">const store = createStore({ count: 0 });</span></p>
			<p><span class="koboSpan" id="kobo.65.1">Note that this </span><strong class="source-inline"><span class="koboSpan" id="kobo.66.1">store</span></strong><span class="koboSpan" id="kobo.67.1"> is defined outside the React component.</span></p>
			<p><span class="koboSpan" id="kobo.68.1">To </span><a id="_idIndexMarker208"/><span class="koboSpan" id="kobo.69.1">use </span><strong class="source-inline"><span class="koboSpan" id="kobo.70.1">store</span></strong><span class="koboSpan" id="kobo.71.1"> in a React component, we use </span><strong class="source-inline"><span class="koboSpan" id="kobo.72.1">useStore</span></strong><span class="koboSpan" id="kobo.73.1">. </span><span class="koboSpan" id="kobo.73.2">The following is an example with two components that show the shared count from the same </span><strong class="source-inline"><span class="koboSpan" id="kobo.74.1">store</span></strong><span class="koboSpan" id="kobo.75.1"> variable. </span><span class="koboSpan" id="kobo.75.2">We use </span><strong class="source-inline"><span class="koboSpan" id="kobo.76.1">useStore</span></strong><span class="koboSpan" id="kobo.77.1">, which was defined in </span><a href="B17780_04_Final_VK_ePub.xhtml#_idTextAnchor066"><em class="italic"><span class="koboSpan" id="kobo.78.1">Chapter 4</span></em></a><span class="koboSpan" id="kobo.79.1">, </span><em class="italic"><span class="koboSpan" id="kobo.80.1">Sharing Module State with Subscription</span></em><span class="koboSpan" id="kobo.81.1">:</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.82.1">const Counter = () =&gt; {</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.83.1">  const [state, setState] = useStore(store);</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.84.1">  const inc = () =&gt; {</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.85.1">    setState((prev) =&gt; ({                       </span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.86.1">      ...prev,</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.87.1">      count: prev.count + 1,                   </span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.88.1">    }));                    </span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.89.1">  };              </span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.90.1">  return (                       </span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.91.1">    &lt;div&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.92.1">      {state.count} &lt;button onClick={inc}&gt;+1&lt;/button&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.93.1">    &lt;/div&gt;                                 </span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.94.1">  );               </span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.95.1">};</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.96.1">const Component = () =&gt; (</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.97.1">  &lt;&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.98.1">    &lt;Counter /&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.99.1">    &lt;Counter /&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.100.1">  &lt;/&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.101.1">);</span></p>
			<p><span class="koboSpan" id="kobo.102.1">We have the component </span><strong class="source-inline"><span class="koboSpan" id="kobo.103.1">Counter</span></strong><span class="koboSpan" id="kobo.104.1">, which is to show the </span><strong class="source-inline"><span class="koboSpan" id="kobo.105.1">count</span></strong><span class="koboSpan" id="kobo.106.1"> number in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.107.1">store</span></strong><span class="koboSpan" id="kobo.108.1"> object, and a </span><strong class="source-inline"><span class="koboSpan" id="kobo.109.1">button</span></strong><span class="koboSpan" id="kobo.110.1"> to update the </span><strong class="source-inline"><span class="koboSpan" id="kobo.111.1">count</span></strong><span class="koboSpan" id="kobo.112.1"> value. </span><span class="koboSpan" id="kobo.112.2">Because this </span><strong class="source-inline"><span class="koboSpan" id="kobo.113.1">Counter</span></strong><span class="koboSpan" id="kobo.114.1"> component is reusable, </span><strong class="source-inline"><span class="koboSpan" id="kobo.115.1">Component</span></strong><span class="koboSpan" id="kobo.116.1"> can have two </span><strong class="source-inline"><span class="koboSpan" id="kobo.117.1">Counter</span></strong><span class="koboSpan" id="kobo.118.1"> instances. </span><span class="koboSpan" id="kobo.118.2">This will show a pair of two counters sharing the same state.</span></p>
			<p><span class="koboSpan" id="kobo.119.1">Now, suppose</span><a id="_idIndexMarker209"/><span class="koboSpan" id="kobo.120.1"> we want to show another pair of counters. </span><span class="koboSpan" id="kobo.120.2">We would like to have two new components in </span><strong class="source-inline"><span class="koboSpan" id="kobo.121.1">Component</span></strong><span class="koboSpan" id="kobo.122.1">, but the new pair should show different counters from the first set.</span></p>
			<p><span class="koboSpan" id="kobo.123.1">Let's create a new </span><strong class="source-inline"><span class="koboSpan" id="kobo.124.1">count</span></strong><span class="koboSpan" id="kobo.125.1"> value. </span><span class="koboSpan" id="kobo.125.2">We could add a new property to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.126.1">store</span></strong><span class="koboSpan" id="kobo.127.1"> object we already defined, but we assume there are other properties and want to isolate stores. </span><span class="koboSpan" id="kobo.127.2">Therefore, we create </span><strong class="source-inline"><span class="koboSpan" id="kobo.128.1">store2</span></strong><span class="koboSpan" id="kobo.129.1">:</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.130.1">const store2 = createStore({ count: 0 })</span></p>
			<p><span class="koboSpan" id="kobo.131.1">Because </span><strong class="source-inline"><span class="koboSpan" id="kobo.132.1">createStore</span></strong><span class="koboSpan" id="kobo.133.1"> is reusable, creating a new </span><strong class="source-inline"><span class="koboSpan" id="kobo.134.1">store2</span></strong><span class="koboSpan" id="kobo.135.1"> object is straightforward.</span></p>
			<p><span class="koboSpan" id="kobo.136.1">We then need to create components to use </span><strong class="source-inline"><span class="koboSpan" id="kobo.137.1">store2</span></strong><span class="koboSpan" id="kobo.138.1">:</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.139.1">const Counter2 = () =&gt; {</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.140.1">  const [state, setState] = useStore(store2);</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.141.1">  const inc = () =&gt; {</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.142.1">    setState((prev) =&gt; ({                       </span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.143.1">      ...prev,</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.144.1">      count: prev.count + 1,                   </span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.145.1">    }));                    </span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.146.1">  };              </span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.147.1">  return (                       </span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.148.1">    &lt;div&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.149.1">      {state.count} &lt;button onClick={inc}&gt;+1&lt;/button&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.150.1">    &lt;/div&gt;                                 </span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.151.1">  );               </span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.152.1">};</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.153.1">const Component2 = () =&gt; (</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.154.1">  &lt;&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.155.1">    &lt;Counter2 /&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.156.1">    &lt;Counter2 /&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.157.1">  &lt;/&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.158.1">);</span></p>
			<p><span class="koboSpan" id="kobo.159.1">You may </span><a id="_idIndexMarker210"/><span class="koboSpan" id="kobo.160.1">notice the similarity between </span><strong class="source-inline"><span class="koboSpan" id="kobo.161.1">Counter</span></strong><span class="koboSpan" id="kobo.162.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.163.1">Counter2</span></strong><span class="koboSpan" id="kobo.164.1"> – that they are both 14 lines of code, and the only difference is the </span><strong class="source-inline"><span class="koboSpan" id="kobo.165.1">store</span></strong><span class="koboSpan" id="kobo.166.1"> variable they are referencing – </span><strong class="source-inline"><span class="koboSpan" id="kobo.167.1">store</span></strong><span class="koboSpan" id="kobo.168.1"> for </span><strong class="source-inline"><span class="koboSpan" id="kobo.169.1">Counter</span></strong><span class="koboSpan" id="kobo.170.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.171.1">store2</span></strong><span class="koboSpan" id="kobo.172.1"> for </span><strong class="source-inline"><span class="koboSpan" id="kobo.173.1">Counter2</span></strong><span class="koboSpan" id="kobo.174.1">. </span><span class="koboSpan" id="kobo.174.2">We would need </span><strong class="source-inline"><span class="koboSpan" id="kobo.175.1">Counter3</span></strong><span class="koboSpan" id="kobo.176.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.177.1">Counter4</span></strong><span class="koboSpan" id="kobo.178.1"> to support more stores. </span><span class="koboSpan" id="kobo.178.2">Ideally, </span><strong class="source-inline"><span class="koboSpan" id="kobo.179.1">Counter</span></strong><span class="koboSpan" id="kobo.180.1"> should be reusable. </span><span class="koboSpan" id="kobo.180.2">But, as module state is defined outside React, it's not possible. </span><span class="koboSpan" id="kobo.180.3">This is the limitation of module state.</span></p>
			<p class="callout-heading"><span class="koboSpan" id="kobo.181.1">Important Note</span></p>
			<p class="callout"><span class="koboSpan" id="kobo.182.1">You may notice we can make the </span><strong class="source-inline"><span class="koboSpan" id="kobo.183.1">Counter</span></strong><span class="koboSpan" id="kobo.184.1"> component reusable if we put </span><strong class="source-inline"><span class="koboSpan" id="kobo.185.1">store</span></strong><span class="koboSpan" id="kobo.186.1"> in </span><strong class="source-inline"><span class="koboSpan" id="kobo.187.1">props</span></strong><span class="koboSpan" id="kobo.188.1">. </span><span class="koboSpan" id="kobo.188.2">However, that will require prop drilling when components are deeply nested, and the primary reason for introducing module state is to avoid prop drilling.</span></p>
			<p><span class="koboSpan" id="kobo.189.1">It would be nice to reuse the </span><strong class="source-inline"><span class="koboSpan" id="kobo.190.1">Counter</span></strong><span class="koboSpan" id="kobo.191.1"> component for different stores. </span><span class="koboSpan" id="kobo.191.2">The pseudocode would be as follows:</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.192.1">const Component = () =&gt; (</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.193.1">  &lt;StoreProvider&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.194.1">    &lt;Counter /&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.195.1">    &lt;Counter /&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.196.1">  &lt;/StoreProvider&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.197.1">);</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.198.1">const Component2 = () =&gt; (</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.199.1">  &lt;Store2Provider&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.200.1">    &lt;Counter /&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.201.1">    &lt;Counter /&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.202.1">  &lt;/Store2Provider&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.203.1">);</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.204.1">const Component3 = () =&gt; (</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.205.1">  &lt;Store3Provider&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.206.1">    &lt;Counter /&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.207.1">    &lt;Counter /&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.208.1">  &lt;/Store3Provider&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.209.1">);</span></p>
			<p><span class="koboSpan" id="kobo.210.1">If you look at </span><a id="_idIndexMarker211"/><span class="koboSpan" id="kobo.211.1">the code, you will notice that </span><strong class="source-inline"><span class="koboSpan" id="kobo.212.1">Component</span></strong><span class="koboSpan" id="kobo.213.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.214.1">Component2</span></strong><span class="koboSpan" id="kobo.215.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.216.1">Component3</span></strong><span class="koboSpan" id="kobo.217.1"> are mostly the same. </span><span class="koboSpan" id="kobo.217.2">The only difference is the </span><strong class="source-inline"><span class="koboSpan" id="kobo.218.1">Provider</span></strong><span class="koboSpan" id="kobo.219.1"> components. </span><span class="koboSpan" id="kobo.219.2">This is exactly where React Context fits in. </span><span class="koboSpan" id="kobo.219.3">We will discuss this in more detail in the </span><em class="italic"><span class="koboSpan" id="kobo.220.1">Implementing the Context and Subscription pattern</span></em><span class="koboSpan" id="kobo.221.1"> section.</span></p>
			<p><span class="koboSpan" id="kobo.222.1">Now you understand the limitation of module state and the ideal patterns for multiple stores. </span><span class="koboSpan" id="kobo.222.2">Next up, we'll recap React Context and explore the usage of Context.</span></p>
			<h1 id="_idParaDest-76"><a id="_idTextAnchor076"/><span class="koboSpan" id="kobo.223.1">Understanding when to use Context</span></h1>
			<p><span class="koboSpan" id="kobo.224.1">Before diving into learning the way to combine Context and Subscription, let's recap how</span><a id="_idIndexMarker212"/><span class="koboSpan" id="kobo.225.1"> Context works.</span></p>
			<p><span class="koboSpan" id="kobo.226.1">The following is a simple Context example with a theme. </span><span class="koboSpan" id="kobo.226.2">So, we specify a default value for </span><strong class="source-inline"><span class="koboSpan" id="kobo.227.1">createContext</span></strong><span class="koboSpan" id="kobo.228.1">:</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.229.1">const ThemeContext = createContext("light");</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.230.1">const Component = () =&gt; {</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.231.1">  const theme = useContext(ThemeContext);</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.232.1">  return &lt;div&gt;Theme: {theme}&lt;/div&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.233.1">};</span></p>
			<p><span class="koboSpan" id="kobo.234.1">What </span><strong class="source-inline"><span class="koboSpan" id="kobo.235.1">useContext(ThemeContext)</span></strong><span class="koboSpan" id="kobo.236.1"> returns depends on the Context in the component tree.</span></p>
			<p><span class="koboSpan" id="kobo.237.1">To change the Context value, we use a </span><strong class="source-inline"><span class="koboSpan" id="kobo.238.1">Provider</span></strong><span class="koboSpan" id="kobo.239.1"> component in Context as follows:</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.240.1">&lt;ThemeContext.Provider value="dark"&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.241.1">  &lt;Component /&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.242.1">&lt;/ThemeContext.Provider&gt;</span></p>
			<p><span class="koboSpan" id="kobo.243.1">In this case, </span><strong class="source-inline"><span class="koboSpan" id="kobo.244.1">Component</span></strong><span class="koboSpan" id="kobo.245.1"> will show the theme as </span><strong class="source-inline"><span class="koboSpan" id="kobo.246.1">dark</span></strong><span class="koboSpan" id="kobo.247.1">.</span></p>
			<p><span class="koboSpan" id="kobo.248.1">The provider can be nested. </span><span class="koboSpan" id="kobo.248.2">It will use the value from the innermost provider:</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.249.1">&lt;ThemeContext.Provider value="this value is not used"&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.250.1">  &lt;ThemeContext.Provider value="this value is not used"&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.251.1">    &lt;ThemeContext.Provider value="this is the value used"&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.252.1">      &lt;Component /&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.253.1">    &lt;/ThemeContext.Provider&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.254.1">  &lt;/ThemeContext.Provider&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.255.1">&lt;/ThemeContext.Provider&gt;</span></p>
			<p><span class="koboSpan" id="kobo.256.1">If there are </span><a id="_idIndexMarker213"/><span class="koboSpan" id="kobo.257.1">no providers in the component tree, it will use the default value.</span></p>
			<p><span class="koboSpan" id="kobo.258.1">For example, here, we assume </span><strong class="source-inline"><span class="koboSpan" id="kobo.259.1">Root</span></strong><span class="koboSpan" id="kobo.260.1"> is a component at the root:</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.261.1">const Root = () =&gt; (</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.262.1">  &lt;&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.263.1">    &lt;Component /&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.264.1">  &lt;/&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.265.1">);</span></p>
			<p><span class="koboSpan" id="kobo.266.1">In this case, </span><strong class="source-inline"><span class="koboSpan" id="kobo.267.1">Component</span></strong><span class="koboSpan" id="kobo.268.1"> will show the theme as </span><strong class="source-inline"><span class="koboSpan" id="kobo.269.1">light</span></strong><span class="koboSpan" id="kobo.270.1">.</span></p>
			<p><span class="koboSpan" id="kobo.271.1">Let's see an example that has a provider to provide the same default value at the root:</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.272.1">const Root = () =&gt; (</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.273.1">  &lt;ThemeContext.Provider value="light"&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.274.1">    &lt;Component /&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.275.1">  &lt;/ThemeContext.Provider&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.276.1">);</span></p>
			<p><span class="koboSpan" id="kobo.277.1">In this case too, </span><strong class="source-inline"><span class="koboSpan" id="kobo.278.1">Component</span></strong><span class="koboSpan" id="kobo.279.1"> will show the theme as </span><strong class="source-inline"><span class="koboSpan" id="kobo.280.1">light</span></strong><span class="koboSpan" id="kobo.281.1">. </span></p>
			<p><span class="koboSpan" id="kobo.282.1">So, let's discuss when to use Context. </span><span class="koboSpan" id="kobo.282.2">To do this, think of our example: what is the difference between</span><a id="_idIndexMarker214"/><span class="koboSpan" id="kobo.283.1"> this example with a provider and the previous example without a provider? </span><span class="koboSpan" id="kobo.283.2">We can say that there is no difference. </span><span class="koboSpan" id="kobo.283.3">Using the default value gives the same result.</span></p>
			<p><span class="koboSpan" id="kobo.284.1">Having a proper default value for Context is important. </span><span class="koboSpan" id="kobo.284.2">The Context provider can be seen as a method to override the default Context value or a value provided by the parent provider if it exists. </span></p>
			<p><span class="koboSpan" id="kobo.285.1">In the case of </span><strong class="source-inline"><span class="koboSpan" id="kobo.286.1">ThemeContext</span></strong><span class="koboSpan" id="kobo.287.1">, if we have the proper default value, then what's the point of using a provider? </span><span class="koboSpan" id="kobo.287.2">It will be required to provide a different value for a subtree of the entire component tree. </span><span class="koboSpan" id="kobo.287.3">Otherwise, we can just use the default value from </span><strong class="source-inline"><span class="koboSpan" id="kobo.288.1">Context</span></strong><span class="koboSpan" id="kobo.289.1">.</span></p>
			<p><span class="koboSpan" id="kobo.290.1">For a global </span><a id="_idIndexMarker215"/><span class="koboSpan" id="kobo.291.1">state with Context, you may only use one provider at the root. </span><span class="koboSpan" id="kobo.291.2">This is a valid use case, but this use case can be covered by module state with Subscription, which we learned about in </span><a href="B17780_04_Final_VK_ePub.xhtml#_idTextAnchor066"><em class="italic"><span class="koboSpan" id="kobo.292.1">Chapter 4</span></em></a><span class="koboSpan" id="kobo.293.1">, </span><em class="italic"><span class="koboSpan" id="kobo.294.1">Sharing Module State with Subscription</span></em><span class="koboSpan" id="kobo.295.1">. </span><span class="koboSpan" id="kobo.295.2">Given that module state covers the use case with one Context provider at the root, Context for a global state is only required if we need to provide different values for different subtrees.</span></p>
			<p><span class="koboSpan" id="kobo.296.1">In this section, we revisited React Context and learned when to use it. </span><span class="koboSpan" id="kobo.296.2">Next up, we will learn how to combine Context and Subscription.</span></p>
			<h1 id="_idParaDest-77"><a id="_idTextAnchor077"/><span class="koboSpan" id="kobo.297.1">Implementing the Context and Subscription pattern</span></h1>
			<p><span class="koboSpan" id="kobo.298.1">As </span><a id="_idIndexMarker216"/><span class="koboSpan" id="kobo.299.1">we learned, using one Context to propagate a global state value has a limitation: it causes extra re-renders.</span></p>
			<p><span class="koboSpan" id="kobo.300.1">Module state with Subscription doesn't have such a limitation, but there is another: it only provides a single value for the entire component tree.</span></p>
			<p><span class="koboSpan" id="kobo.301.1">We would like to combine Context and Subscription to overcome both limitations. </span><span class="koboSpan" id="kobo.301.2">Let's implement this feature. </span><span class="koboSpan" id="kobo.301.3">We'll start with </span><strong class="source-inline"><span class="koboSpan" id="kobo.302.1">createStore</span></strong><span class="koboSpan" id="kobo.303.1">. </span><span class="koboSpan" id="kobo.303.2">This is exactly the same implementation we developed in </span><a href="B17780_04_Final_VK_ePub.xhtml#_idTextAnchor066"><em class="italic"><span class="koboSpan" id="kobo.304.1">Chapter 4</span></em></a><span class="koboSpan" id="kobo.305.1">, </span><em class="italic"><span class="koboSpan" id="kobo.306.1">Sharing Module State with Subscription</span></em><span class="koboSpan" id="kobo.307.1">:</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.308.1">type Store&lt;T&gt; = {</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.309.1">  getState: () =&gt; T;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.310.1">  setState: (action: T | ((prev: T) =&gt; T)) =&gt; void;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.311.1">  subscribe: (callback: () =&gt; void) =&gt; () =&gt; void;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.312.1">};</span></p>
			<p class="source-code"> </p>
			<p class="source-code"><span class="koboSpan" id="kobo.313.1">const createStore = &lt;T extends unknown&gt;(</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.314.1">  initialState: T</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.315.1">): Store&lt;T&gt; =&gt; {</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.316.1">  let state = initialState;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.317.1">  const callbacks = new Set&lt;() =&gt; void&gt;();</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.318.1">  const getState = () =&gt; state;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.319.1">  const setState = (nextState: T | ((prev: T) =&gt; T)) =&gt; {</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.320.1">    state =</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.321.1">      typeof nextState === "function"</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.322.1">        ? </span><span class="koboSpan" id="kobo.322.2">(nextState as (prev: T) =&gt; T)(state)</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.323.1">        : nextState;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.324.1">    callbacks.forEach((callback) =&gt; callback());</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.325.1">  };</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.326.1">  const subscribe = (callback: () =&gt; void) =&gt; {</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.327.1">    callbacks.add(callback);</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.328.1">    return () =&gt; {</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.329.1">      callbacks.delete(callback);</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.330.1">    };</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.331.1">  };</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.332.1">  return { getState, setState, subscribe };</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.333.1">};</span></p>
			<p><span class="koboSpan" id="kobo.334.1">In </span><a href="B17780_04_Final_VK_ePub.xhtml#_idTextAnchor066"><em class="italic"><span class="koboSpan" id="kobo.335.1">Chapter 4</span></em></a><span class="koboSpan" id="kobo.336.1">, </span><em class="italic"><span class="koboSpan" id="kobo.337.1">Sharing Module State with Subscription</span></em><span class="koboSpan" id="kobo.338.1">, we used </span><strong class="source-inline"><span class="koboSpan" id="kobo.339.1">createStore</span></strong><span class="koboSpan" id="kobo.340.1"> for module state. </span><span class="koboSpan" id="kobo.340.2">This time, we'll use </span><strong class="source-inline"><span class="koboSpan" id="kobo.341.1">createStore</span></strong><span class="koboSpan" id="kobo.342.1"> for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.343.1">Context</span></strong><span class="koboSpan" id="kobo.344.1"> value.</span></p>
			<p><span class="koboSpan" id="kobo.345.1">The following</span><a id="_idIndexMarker217"/><span class="koboSpan" id="kobo.346.1"> is the code to create a Context. </span><span class="koboSpan" id="kobo.346.2">The default value is passed to </span><strong class="source-inline"><span class="koboSpan" id="kobo.347.1">createContext</span></strong><span class="koboSpan" id="kobo.348.1">, which we refer to as a default store:</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.349.1">type State = { count: number; text?: string };</span></p>
			<p class="source-code"> </p>
			<p class="source-code"><span class="koboSpan" id="kobo.350.1">const StoreContext = createContext&lt;Store&lt;State&gt;&gt;(</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.351.1">  createStore&lt;State&gt;({ count: 0, text: "hello" })</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.352.1">);</span></p>
			<p><span class="koboSpan" id="kobo.353.1">In this case, the default store has a state with two properties: </span><strong class="source-inline"><span class="koboSpan" id="kobo.354.1">count</span></strong><span class="koboSpan" id="kobo.355.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.356.1">text</span></strong><span class="koboSpan" id="kobo.357.1">.</span></p>
			<p><span class="koboSpan" id="kobo.358.1">To </span><a id="_idIndexMarker218"/><span class="koboSpan" id="kobo.359.1">provide different stores for subtrees, we implement </span><strong class="source-inline"><span class="koboSpan" id="kobo.360.1">StoreProvider</span></strong><span class="koboSpan" id="kobo.361.1">, which is a tiny wrapper around </span><strong class="source-inline"><span class="koboSpan" id="kobo.362.1">StoreContext.Provider</span></strong><span class="koboSpan" id="kobo.363.1">:</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.364.1">const StoreProvider = ({</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.365.1">  initialState,</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.366.1">  children,</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.367.1">}: {</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.368.1">  initialState: State;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.369.1">  children: ReactNode;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.370.1">}) =&gt; {</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.371.1">  const storeRef = useRef&lt;Store&lt;State&gt;&gt;();</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.372.1">  if (!storeRef.current) {</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.373.1">    storeRef.current = createStore(initialState);</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.374.1">  }</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.375.1">  return (</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.376.1">    &lt;StoreContext.Provider value={storeRef.current}&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.377.1">      {children}</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.378.1">    &lt;/StoreContext.Provider&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.379.1">  );</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.380.1">};</span></p>
			<p><strong class="source-inline"><span class="koboSpan" id="kobo.381.1">useRef</span></strong><span class="koboSpan" id="kobo.382.1"> is used to make sure that the store object is initialized only once at the first render.</span></p>
			<p><span class="koboSpan" id="kobo.383.1">To use a</span><a id="_idIndexMarker219"/><span class="koboSpan" id="kobo.384.1"> store object, we implement a hook called </span><strong class="source-inline"><span class="koboSpan" id="kobo.385.1">useSelector</span></strong><span class="koboSpan" id="kobo.386.1">. </span><span class="koboSpan" id="kobo.386.2">Unlike </span><strong class="source-inline"><span class="koboSpan" id="kobo.387.1">useStoreSelector</span></strong><span class="koboSpan" id="kobo.388.1">, defined in the </span><em class="italic"><span class="koboSpan" id="kobo.389.1">Working with a selector and useSubscription</span></em><span class="koboSpan" id="kobo.390.1"> section in </span><a href="B17780_04_Final_VK_ePub.xhtml#_idTextAnchor066"><em class="italic"><span class="koboSpan" id="kobo.391.1">Chapter 4</span></em></a><span class="koboSpan" id="kobo.392.1">, </span><em class="italic"><span class="koboSpan" id="kobo.393.1">Sharing Module State with Subscription</span></em><span class="koboSpan" id="kobo.394.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.395.1">useSelector</span></strong><span class="koboSpan" id="kobo.396.1"> doesn't take a </span><strong class="source-inline"><span class="koboSpan" id="kobo.397.1">store</span></strong><span class="koboSpan" id="kobo.398.1"> object in its arguments. </span><span class="koboSpan" id="kobo.398.2">It takes a </span><strong class="source-inline"><span class="koboSpan" id="kobo.399.1">store</span></strong><span class="koboSpan" id="kobo.400.1"> object from </span><strong class="source-inline"><span class="koboSpan" id="kobo.401.1">StoreContext</span></strong><span class="koboSpan" id="kobo.402.1"> instead:</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.403.1">const useSelector = &lt;S extends unknown&gt;(</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.404.1">  selector: (state: State) =&gt; S</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.405.1">) =&gt; {</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.406.1">  const store = useContext(StoreContext);</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.407.1">  return useSubscription(</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.408.1">    useMemo(</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.409.1">      () =&gt; ({</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.410.1">        getCurrentValue: () =&gt; selector(store.getState()),</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.411.1">        subscribe: store.subscribe,</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.412.1">      }),</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.413.1">      [store, selector]</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.414.1">    )</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.415.1">  );</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.416.1">};</span></p>
			<p><span class="koboSpan" id="kobo.417.1">Using </span><strong class="source-inline"><span class="koboSpan" id="kobo.418.1">useContext</span></strong><span class="koboSpan" id="kobo.419.1"> together with </span><strong class="source-inline"><span class="koboSpan" id="kobo.420.1">useSubscription</span></strong><span class="koboSpan" id="kobo.421.1"> is the key point of this pattern. </span><span class="koboSpan" id="kobo.421.2">This combination allows us the benefits of both Context and Subscription.</span></p>
			<p><span class="koboSpan" id="kobo.422.1">Unlike module state, we need to provide a way to update the state with Context. </span><strong class="source-inline"><span class="koboSpan" id="kobo.423.1">useSetState</span></strong><span class="koboSpan" id="kobo.424.1"> is a simple hook to return the </span><strong class="source-inline"><span class="koboSpan" id="kobo.425.1">setState</span></strong><span class="koboSpan" id="kobo.426.1"> function in </span><strong class="source-inline"><span class="koboSpan" id="kobo.427.1">store</span></strong><span class="koboSpan" id="kobo.428.1">:</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.429.1">const useSetState = () =&gt; {</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.430.1">  const store = useContext(StoreContext);</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.431.1">  return store.setState;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.432.1">};</span></p>
			<p><span class="koboSpan" id="kobo.433.1">Now, let's use</span><a id="_idIndexMarker220"/><span class="koboSpan" id="kobo.434.1"> what we have implemented. </span><span class="koboSpan" id="kobo.434.2">The following is a component that shows </span><strong class="source-inline"><span class="koboSpan" id="kobo.435.1">count</span></strong><span class="koboSpan" id="kobo.436.1"> in </span><strong class="source-inline"><span class="koboSpan" id="kobo.437.1">store</span></strong><span class="koboSpan" id="kobo.438.1">, along with </span><strong class="source-inline"><span class="koboSpan" id="kobo.439.1">button</span></strong><span class="koboSpan" id="kobo.440.1"> to increment </span><strong class="source-inline"><span class="koboSpan" id="kobo.441.1">count</span></strong><span class="koboSpan" id="kobo.442.1">. </span><span class="koboSpan" id="kobo.442.2">We define </span><strong class="source-inline"><span class="koboSpan" id="kobo.443.1">selectCount</span></strong><span class="koboSpan" id="kobo.444.1"> outside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.445.1">Component</span></strong><span class="koboSpan" id="kobo.446.1">, otherwise, we would need to wrap the function with </span><strong class="source-inline"><span class="koboSpan" id="kobo.447.1">useCallback</span></strong><span class="koboSpan" id="kobo.448.1">, which introduces extra work:</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.449.1">const selectCount = (state: State) =&gt; state.count;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.450.1">const Component = () =&gt; {</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.451.1">  const count = useSelector(selectCount);</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.452.1">  const setState = useSetState();</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.453.1">  const inc = () =&gt; {</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.454.1">    setState((prev) =&gt; ({</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.455.1">      ...prev,</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.456.1">      count: prev.count + 1,</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.457.1">    }));</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.458.1">  };</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.459.1">  return (</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.460.1">    &lt;div&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.461.1">      count: {count} &lt;button onClick={inc}&gt;+1&lt;/button&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.462.1">    &lt;/div&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.463.1">  );</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.464.1">};</span></p>
			<p><span class="koboSpan" id="kobo.465.1">It's important to note here that this </span><strong class="source-inline"><span class="koboSpan" id="kobo.466.1">Component</span></strong><span class="koboSpan" id="kobo.467.1"> component is not tied to any specific store object. </span><span class="koboSpan" id="kobo.467.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.468.1">Component</span></strong><span class="koboSpan" id="kobo.469.1"> component can be used for different stores.</span></p>
			<p><span class="koboSpan" id="kobo.470.1">We can also have </span><strong class="source-inline"><span class="koboSpan" id="kobo.471.1">Component</span></strong><span class="koboSpan" id="kobo.472.1"> in various places:</span></p>
			<ul>
				<li><span class="koboSpan" id="kobo.473.1">Outside any providers</span></li>
				<li><span class="koboSpan" id="kobo.474.1">Inside the first provider</span></li>
				<li><span class="koboSpan" id="kobo.475.1">Inside the second provider</span></li>
			</ul>
			<p><span class="koboSpan" id="kobo.476.1">The</span><a id="_idIndexMarker221"/><span class="koboSpan" id="kobo.477.1"> following </span><strong class="source-inline"><span class="koboSpan" id="kobo.478.1">App</span></strong><span class="koboSpan" id="kobo.479.1"> component includes the </span><strong class="source-inline"><span class="koboSpan" id="kobo.480.1">Component</span></strong><span class="koboSpan" id="kobo.481.1"> components in three places: 1) outside of </span><strong class="source-inline"><span class="koboSpan" id="kobo.482.1">StoreProvider</span></strong><span class="koboSpan" id="kobo.483.1">, 2) inside the first </span><strong class="source-inline"><span class="koboSpan" id="kobo.484.1">StoreProvider</span></strong><span class="koboSpan" id="kobo.485.1"> component, and 3) inside the second nested </span><strong class="source-inline"><span class="koboSpan" id="kobo.486.1">StoreProvider</span></strong><span class="koboSpan" id="kobo.487.1"> component. </span><span class="koboSpan" id="kobo.487.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.488.1">Component</span></strong><span class="koboSpan" id="kobo.489.1"> components in different </span><strong class="source-inline"><span class="koboSpan" id="kobo.490.1">StoreProvider</span></strong><span class="koboSpan" id="kobo.491.1"> components share different </span><strong class="source-inline"><span class="koboSpan" id="kobo.492.1">count</span></strong><span class="koboSpan" id="kobo.493.1"> values:</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.494.1">const App = () =&gt; (</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.495.1">  &lt;&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.496.1">    &lt;h1&gt;Using default store&lt;/h1&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.497.1">    &lt;Component /&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.498.1">    &lt;Component /&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.499.1">    &lt;StoreProvider initialState={{ count: 10 }}&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.500.1">      &lt;h1&gt;Using store provider&lt;/h1&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.501.1">      &lt;Component /&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.502.1">      &lt;Component /&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.503.1">      &lt;StoreProvider initialState={{ count: 20 }}&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.504.1">        &lt;h1&gt;Using inner store provider&lt;/h1&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.505.1">        &lt;Component /&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.506.1">        &lt;Component /&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.507.1">      &lt;/StoreProvider&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.508.1">    &lt;/StoreProvider&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.509.1">  &lt;/&gt;</span></p>
			<p class="source-code"><span class="koboSpan" id="kobo.510.1">);</span></p>
			<p><span class="koboSpan" id="kobo.511.1">Each </span><strong class="source-inline"><span class="koboSpan" id="kobo.512.1">Component</span></strong><span class="koboSpan" id="kobo.513.1"> component using the same </span><strong class="source-inline"><span class="koboSpan" id="kobo.514.1">store</span></strong><span class="koboSpan" id="kobo.515.1"> object will share the </span><strong class="source-inline"><span class="koboSpan" id="kobo.516.1">store</span></strong><span class="koboSpan" id="kobo.517.1"> object and show the same </span><strong class="source-inline"><span class="koboSpan" id="kobo.518.1">count</span></strong><span class="koboSpan" id="kobo.519.1"> value. </span><span class="koboSpan" id="kobo.519.2">In this case, the components in different component </span><a id="_idIndexMarker222"/><span class="koboSpan" id="kobo.520.1">tree levels use a different </span><strong class="source-inline"><span class="koboSpan" id="kobo.521.1">store</span></strong><span class="koboSpan" id="kobo.522.1">, hence the components show a different </span><strong class="source-inline"><span class="koboSpan" id="kobo.523.1">count</span></strong><span class="koboSpan" id="kobo.524.1"> value in various places. </span><span class="koboSpan" id="kobo.524.2">When you run this app, you will see something like the following: </span></p>
			<div>
				<div id="_idContainer013" class="IMG---Figure">
					<span class="koboSpan" id="kobo.525.1"><img src="image/Figure_5.1_B17780.jpg" alt="Figure 5.1 – Screenshot of the running app  "/></span>
				</div>
			</div>
			<p class="figure-caption"><span class="koboSpan" id="kobo.526.1">Figure 5.1 – Screenshot of the running app </span></p>
			<p><span class="koboSpan" id="kobo.527.1">If you click the </span><strong class="bold"><span class="koboSpan" id="kobo.528.1">+1</span></strong><span class="koboSpan" id="kobo.529.1"> button in </span><strong class="bold"><span class="koboSpan" id="kobo.530.1">Using default store</span></strong><span class="koboSpan" id="kobo.531.1">, you will see two counts in </span><strong class="bold"><span class="koboSpan" id="kobo.532.1">Using default store</span></strong><span class="koboSpan" id="kobo.533.1"> are updated together. </span><span class="koboSpan" id="kobo.533.2">If you click the </span><strong class="bold"><span class="koboSpan" id="kobo.534.1">+1</span></strong><span class="koboSpan" id="kobo.535.1"> button in </span><strong class="bold"><span class="koboSpan" id="kobo.536.1">Using store provider</span></strong><span class="koboSpan" id="kobo.537.1">, you will see two counts in </span><strong class="bold"><span class="koboSpan" id="kobo.538.1">Using store provider</span></strong><span class="koboSpan" id="kobo.539.1"> are updated together. </span><span class="koboSpan" id="kobo.539.2">The same applies to </span><strong class="bold"><span class="koboSpan" id="kobo.540.1">Using inner store provider</span></strong><span class="koboSpan" id="kobo.541.1">.</span></p>
			<p><span class="koboSpan" id="kobo.542.1">In this section, we learned how to implement a global state with Context and Subscription, taking advantage of the related benefits. </span><span class="koboSpan" id="kobo.542.2">We can isolate state in a subtree thanks to Context, and we can avoid extra re-renders thanks to Subscription.</span></p>
			<h1 id="_idParaDest-78"><a id="_idTextAnchor078"/><span class="koboSpan" id="kobo.543.1">Summary</span></h1>
			<p><span class="koboSpan" id="kobo.544.1">In this chapter, we learned a new approach: combining React Context and Subscription. </span><span class="koboSpan" id="kobo.544.2">It provides the benefits of both: providing isolated values in subtrees and avoiding extra re-renders. </span><span class="koboSpan" id="kobo.544.3">This approach is useful for mid to large apps. </span><span class="koboSpan" id="kobo.544.4">In such apps, having different values in different subtrees can happen, and we can avoid extra re-renders, which can be very important for our apps.</span></p>
			<p><span class="koboSpan" id="kobo.545.1">Starting from the next chapter, we will dive into various global state libraries. </span><span class="koboSpan" id="kobo.545.2">We will learn how those libraries are based on what we have learned so far.</span></p>
		</div>
	</body></html>