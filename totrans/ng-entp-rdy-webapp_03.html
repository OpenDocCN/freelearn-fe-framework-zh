<html><head></head><body>
  <div id="_idContainer132">
    <h1 class="chapterNumber">3</h1>
    <h1 class="chapterTitle" id="_idParaDest-88">Creating a Basic Angular App</h1>
    <p class="normal">In this chapter, we'll design and build a simple Local Weather app using Angular and a third-party web API with an iterative development methodology. We'll focus on delivering value first while learning about the nuances and optimal ways of using Angular, TypeScript, Visual Studio (VS) Code, Reactive Programming, and RxJS. Before we dive into coding, we need to build a roadmap of features, create a mock-up of the application we intend to build, and diagram the high-level architecture of our app.</p>
    <p class="normal">You'll be introduced to Angular fundamentals to build a simple web app and become familiar with the new Angular platform and full-stack architecture.</p>
    <p class="normal">In this chapter, you are going to learn the following:</p>
    <ul>
      <li class="list">Planning out your roadmap using GitHub projects</li>
      <li class="list">Using a Kanban board to enable collaboration and effortless information radiation</li>
      <li class="list">Crafting a new UI element to display current weather information using Angular components and TypeScript interfaces</li>
      <li class="list">Using Angular services and <code class="Code-In-Text--PACKT-">HttpClient</code> to retrieve data from <code class="Code-In-Text--PACKT-">OpenWeatherMap</code> APIs</li>
      <li class="list">Leveraging observable streams to transform data using RxJS</li>
      <li class="list">Null guarding in Angular</li>
    </ul>
    <p class="normal">The most up-to-date versions of the sample code for the book are on GitHub at the repository linked below. The repository contains the final and completed state of the code. You can verify your progress at the end of this chapter by looking for the end-of-chapter snapshot of code under the <code class="Code-In-Text--PACKT-">projects</code> folder.</p>
    <p class="normal">For <em class="italics">Chapter 3</em>:</p>
    <ol>
      <li class="list">Clone the repository <a href="https://github.com/duluca/local-weather-app"><span class="url">https://github.com/duluca/local-weather-app</span></a>.</li>
      <li class="list">Execute <code class="Code-In-Text--PACKT-">npm install</code> on the root folder to install dependencies.</li>
      <li class="list">The code sample for this chapter is under the sub-folder:
        <pre class="programlisting"><code class="hljs">projects/ch3
</code></pre>
      </li>
      <li class="list" value="4">To run the Angular app for this chapter, execute:
        <pre class="programlisting"><code class="hljs nginx"><span class="hljs-attribute">npx</span> ng serve ch3
</code></pre>
      </li>
    </ol>
    <div class="note">
      <p class="Information-Box--PACKT-">Beware that the source code in the book or on GitHub may not always match the code generated by Angular CLI. There may also be slight differences in implementation between the code in the book and what's on GitHub because the ecosystem is ever-evolving. It is natural for the sample code to change over time. Also, on GitHub, expect to find corrections, fixes to support newer versions of libraries, or side-by-side implementations of multiple techniques for the reader to observe. The reader is only expected to implement the ideal solution recommended in the book. If you find errors or have questions, please create an issue or submit a pull request on GitHub for the benefit of all readers.</p>
    </div>
    <p class="normal"/>
    <div class="packt_tip">
      <p>You can read more about updating Angular in <em class="italics">Appendix C</em>, <em class="italics">Keeping Angular and Tools Evergreen</em>. You can find this appendix online from <a href="https://static.packt-cdn.com/downloads/9781838648800_Appendix_C_Keeping_Angular_and_Tools_Evergreen."><span class="url">https://static.packt-cdn.com/downloads/9781838648800_Appendix_C_Keeping_Angular_and_Tools_Evergreen.pdf</span></a> or at <a href="https://expertlysimple.io/stay-evergreen"><span class="url">https://expertlysimple.io/stay-evergreen</span></a>.</p>
    </div>
    <p class="normal">Let's start by creating a high-level plan to understand what to implement before you start coding.</p>
    <h1 class="title" id="_idParaDest-89">Planning using Kanban and GitHub projects</h1>
    <p class="normal">Having a roadmap before getting on the road is critical in ensuring that you reach your destination. Similarly, building a rough plan of action before you start coding is very important in <a id="_idIndexMarker204"/>ensuring project success. Building <a id="_idIndexMarker205"/>a plan early on enables your colleagues or clients to be aware of what you're planning to accomplish. However, any initial plan is guaranteed to change over time.</p>
    <p class="normal">Agile software development aims to account for the change of priorities and features over time. Kanban<a id="_idIndexMarker206"/> and Scrum are the two most popular <a id="_idIndexMarker207"/>methodologies that you can use to manage your project. Each methodology has a concept of a backlog and lists that capture planned, in progress, and completed work. A backlog, which contains a prioritized list of tasks, establishes a shared understanding of what needs to be worked on next. Lists that capture the status of each task act as information radiators, where stakeholders can get updates without interrupting your workflow. Whether you're building an app for yourself or someone else, keeping a live backlog and tracking the progress of tasks pays dividends and keeps the focus on the goal you're trying to achieve.</p>
    <p class="normal">In implementing the Local Weather app, we are going to leverage a GitHub project to act as a Kanban board. In an enterprise, you can use ticketing systems or tools that can keep a backlog, implement the Scrum methodology, and display Kanban boards. In GitHub, issues represent your backlog. You can leverage the built-in <strong class="screen-text">Projects</strong> tab to define a scope of work that represents a release or a sprint to establish a Kanban board. A GitHub project directly integrates with your GitHub repository's issues and keeps track of the status of issues via labels. This way, you can keep using the tool of your choice to interact with your repository and still, effortlessly, radiate information. In the next section, you are going to set up a project to achieve this goal.</p>
    <h2 class="title" id="_idParaDest-90">Setting up a GitHub project</h2>
    <p class="normal">Let's set <a id="_idIndexMarker208"/>up a GitHub project:</p>
    <ol>
      <li class="list" value="1">Navigate to your GitHub repository in your browser.</li>
      <li class="list">Switch over to the <strong class="screen-text">Projects</strong> tab.</li>
      <li class="list">Click on <strong class="screen-text">Create a new project</strong>, as shown in the screenshot that follows:<figure class="mediaobject"><img alt="" src="../Images/B14094_03_01.png"/></figure>
        <p class="packt_figref">Figure 3.1: Creating a new project in GitHub</p>
      </li>
      <li class="list">Provide a <a id="_idIndexMarker209"/>name in the <strong class="screen-text">Project board name</strong> box.</li>
      <li class="list">Select a <strong class="screen-text">Project template</strong>, such as <strong class="screen-text">Automated Kanban</strong>.</li>
      <li class="list">Later in the book, we'll enable GitHub flow for your GitHub projects. With GitHub flow, changes <a id="_idIndexMarker210"/>to your repository are processed through <strong class="bold">Pull Requests</strong> (<strong class="bold">PR</strong>). In the future, you may want to select the <strong class="screen-text">Automated Kanban with reviews</strong> template, which automatically keeps track of the status of a PR, radiating more detailed information about the inner workings of the software development process.</li>
      <li class="list" value="7">Click on <strong class="screen-text">Create project</strong>.</li>
    </ol>
    <p class="normal">Observe your Kanban board, which should appear as follows:</p>
    <figure class="mediaobject"><img alt="" src="../Images/B14094_03_02.png"/></figure>
    <p class="packt_figref">Figure 3.2: The Kanban board for your project</p>
    <p class="normal">If you have existing issues on your repository, you may be prompted to add cards to your board. You can safely ignore this for now and return to it with the <strong class="screen-text">+ Add cards</strong> button. You are also presented with several <strong class="screen-text">To do</strong> cards. Feel free to review and dismiss these cards to clear out your board.</p>
    <p class="normal">If you would <a id="_idIndexMarker211"/>like to keep track of every release or sprint, you can create a new project for each one. Creating new projects helps keep track of percentage completion for a given release or sprint, at the cost of introducing additional management overhead.</p>
    <p class="normal">Next, we are going to configure the project as a Kanban board instead of a GitHub Project, which is a lightweight methodology to organize your work you might choose over other methodologies like Scrum.</p>
    <h2 class="title" id="_idParaDest-91">Configuring a Kanban board</h2>
    <p class="normal">Kanban does <a id="_idIndexMarker212"/>not define formal iterations or releases of your work. If you would like to have a low-overhead process, where you only work with a single project, you can do this by introducing a Backlog column to your project.</p>
    <p class="normal">Now let's add a Backlog column:</p>
    <ol>
      <li class="list" value="1">Click on <strong class="screen-text">+ Add column</strong>.</li>
      <li class="list">For <strong class="screen-text">Column name</strong> enter <code class="Code-In-Text--PACKT-">Backlog</code>.</li>
      <li class="list">For <strong class="screen-text">Preset</strong> select <strong class="screen-text">To do</strong>.</li>
      <li class="list">Under <strong class="screen-text">Move issues here when…</strong>, select <strong class="screen-text">Newly added</strong>, as shown here:<figure class="mediaobject"><img alt="A screenshot of a social media post  Description automatically generated" src="../Images/B14094_03_03.png"/></figure>
        <p class="packt_figref">Figure 3.3: Where to select "Newly added"</p>
      </li>
      <li class="list">Click on <strong class="screen-text">Create column</strong>.</li>
      <li class="list" value="6">Drag the column to become the leftmost column.</li>
    </ol>
    <p class="normal">With this setup, new issues are added to the <strong class="screen-text">Backlog</strong>, allowing you to manually maintain <a id="_idIndexMarker213"/>the items you intend to work on in the <strong class="screen-text">To do</strong> column.</p>
    <h2 class="title" id="_idParaDest-92">Creating a backlog for the Local Weather app</h2>
    <p class="normal">Let's create a backlog of issues to keep track of your progress as you implement the design of <a id="_idIndexMarker214"/>your application. When creating issues, you should focus on delivering functional iterations that bring some value to the user. </p>
    <p class="normal">The technical <a id="_idIndexMarker215"/>hurdles you must clear to achieve those results are of no interest to your users or clients.</p>
    <p class="normal">Here are <a id="_idIndexMarker216"/>the features we plan to build in our first release:</p>
    <ul>
      <li class="list">Display current location weather information for the current day</li>
      <li class="list">Display forecast information for the current location</li>
      <li class="list">Add city search capability so that users can see weather information for other cities</li>
      <li class="list">Add a preferences pane to store the default city for the user</li>
      <li class="list">Improve the UX of the app with Angular Material</li>
    </ul>
    <p class="normal">Let's also add some features that we won't implement in this book as a way to demonstrate how a backlog can capture your ideas:</p>
    <ul>
      <li class="list">Add authentication so that users can retrieve data from any browser</li>
      <li class="list">Add HTML5 Geolocation support</li>
      <li class="list">Use <code class="Code-In-Text--PACKT-">localStorage</code> to cache user preferences</li>
    </ul>
    <p class="normal">Feel free to add other features you can think of to your backlog.</p>
    <p class="normal">Begin by creating the preceding features as issues on GitHub. Make sure to assign each new issue to the project you created earlier in the chapter. Once created, move the preceding defined features to the <strong class="screen-text">To do</strong> column. When you begin working on a task, move the card into the <strong class="screen-text">In progress</strong> column and when it's completed, move it to the <strong class="screen-text">Don</strong>e column. The following is what the board looks like as we plan to begin working on the first feature – <em class="italics">Display Current Location weather information for the current day</em>:</p>
    <figure class="mediaobject"><img alt="" src="../Images/B14094_03_04.png"/></figure>
    <p class="packt_figref">Figure 3.4: A snapshot of the initial state of the board on GitHub</p>
    <div class="packt_tip">
      <p>Note that I also added an issue to <strong class="screen-text">Create a mock-up for the app</strong> and moved it to <strong class="screen-text">Done</strong>, which is something I'll cover in the next section. Also, GitHub might automatically move a card from one state to another as you open and close them.</p>
    </div>
    <p class="normal">Ultimately, GitHub projects provide an easy-to-use GUI so that non-technical people can easily interact with GitHub issues. By allowing non-technical people to participate in the development process on GitHub, you unlock the benefits of GitHub becoming the single source of <a id="_idIndexMarker217"/>information for your entire project. Questions, answers, and discussions about features and issues are all tracked as part of <a id="_idIndexMarker218"/>GitHub issues, instead of being lost in emails. You can also store wiki-type documentation on GitHub. So, by centralizing all project-related information, data, conversations, and artifacts on GitHub, you are greatly simplifying the potentially complicated interaction of multiple systems that require continued <a id="_idIndexMarker219"/>maintenance at a high cost. For private repositories and on-premise enterprise installations, GitHub has a very reasonable cost. If you're sticking with open source, as we are in this chapter, all these tools are free.</p>
    <div class="packt_tip">
      <p>As a bonus, I created a rudimentary wiki page on my repository at <a href="https://github.com/duluca/local-weather-app/wiki"><span class="url">https://github.com/duluca/local-weather-app/wiki</span></a>. Note that you can't upload images to <code class="Code-In-Text--PACKT-">README.md</code> or wiki pages. To get around this limitation, you can create a new issue, upload an image in a comment, and copy and paste the URL for it to embed images to <code class="Code-In-Text--PACKT-">README.md</code> or wiki pages. In the sample wiki, I followed this technique to embed the wireframe design into the page.</p>
    </div>
    <p class="normal">With a roadmap in place, you're now ready to create a mock-up of your application.</p>
    <h2 class="title" id="_idParaDest-93">Wireframe design</h2>
    <p class="normal">There are <a id="_idIndexMarker220"/>some great tools out there to do rough-looking mock-ups to demonstrate your idea with surprising amounts of rich functionality. If you <a id="_idIndexMarker221"/>have a dedicated UX designer, such tools are great for creating quasi prototypes. However, as a full-stack developer, I find the best tool <a id="_idIndexMarker222"/>out there to be pen and paper. This way, you don't have to learn <strong class="bold">yet another tool</strong> (<strong class="bold">YAT</strong>), and it is a far better alternative to having no design at all. Putting things on paper saves you from costly coding detours down the line and if you can validate your wireframe design with users ahead of time, even better. My app <a id="_idIndexMarker223"/>is called LocalCast Weather, but get creative and pick your own name. Behold, the wireframe design for your weather app:</p>
    <figure class="mediaobject"><img alt="" src="../Images/B14094_03_05.png"/> </figure>
    <p class="packt_figref">Figure 3.5: Hand-drawn wireframe for LocalCast. (Tip: I did use a ruler!)</p>
    <p class="normal">The wireframe shouldn't be anything fancy. I recommend starting with a hand-drawn design, which is very quick to do and carries over the rough outlines effectively.</p>
    <p class="normal">There are great wireframing tools out there. I suggest and use a couple of them throughout this book, however, in the first days of your project, every hour matters.</p>
    <p class="normal">Granted, this kind of rough design may never leave the boundaries of your team, but please know that nothing beats getting that instantaneous feedback and collaboration by putting your ideas down on paper or a whiteboard.</p>
    <h2 class="title" id="_idParaDest-94">High-level architecture</h2>
    <p class="normal">No matter how small or large your project is, it is critical to start with a sound architecture <a id="_idIndexMarker224"/>that can scale if duty calls. Most of the time, you can't accurately predict the size of your project ahead of time. Sticking to the architectural fundamentals discussed in <em class="italics">Chapter 1</em>, <em class="italics">Introduction to Angular and Its Concepts</em>, results in an architecture that is not overly burdensome, so you can quickly execute a simple app idea. The key is to ensure proper decoupling from the get-go.</p>
    <p class="normal">In my view, there are two types of decoupling. One is soft-decoupling, where a "Gentlemen's Agreement" is made not to mix concerns and you try and not mess up the code base. This can apply to the code you write, all the way to infrastructure-level interactions. If you maintain your frontend code under the same code structure as your backend code, and if you let your REST server serve up your frontend application, then you are only practicing soft-decoupling.</p>
    <p class="normal">You should instead practice hard-decoupling, which means frontend code lives in a separate repository, never calls the database directly, and is hosted on its web server altogether. This way, you can be sure that, at all times, your REST APIs or your frontend code is entirely replaceable and independent of other code. Practicing hard-decoupling has monetary and security benefits as well. The serving and scaling needs of your frontend application are guaranteed to be different from your backend, so you can optimize your host environment appropriately and save money. If you whitelist access to your REST APIs to only the calls originating from your frontend servers, you will vastly improve your security. Consider the following high-level architecture diagram for our LocalCast Weather app:</p>
    <figure class="mediaobject"><img alt="" src="../Images/B14094_03_06.png"/></figure>
    <p class="packt_figref">Figure 3.6: LocalCast high-level architecture</p>
    <p class="normal">The high-level architecture shows that our Angular web application is completely decoupled <a id="_idIndexMarker225"/>from any backend. It is hosted on its web server, can communicate with a web API such as <strong class="bold">OpenWeatherMap</strong>, or optionally <a id="_idIndexMarker226"/>be paired with a backend infrastructure to unlock rich and customized features that a web API alone can't provide, such as storing per-user preferences or complementing the OpenWeatherMap API's dataset with our own.</p>
    <p class="normal">Regardless of your backend technology, I recommend that your frontend always resides in its repository, and is served using its web server that does not depend on your API server.</p>
    <div class="note">
      <p class="Information-Box--PACKT-">In <em class="italics">Chapter 10</em>, <em class="italics">RESTful APIs and Full-Stack Implementation</em>, you'll deep-dive into learning how a MEAN stack application, using MongoDB, Express, Angular, and Node, comes together in practice.</p>
    </div>
    <p class="normal">Now that we have our features, wireframe designs, and high-level architecture in place, we can start implementing our app.</p>
    <h1 class="title" id="_idParaDest-95">Crafting UI elements using components and interfaces</h1>
    <p class="normal">In <em class="italics">Chapter 2</em>, <em class="italics">Setting Up Your Development Environment</em>, you should have created an Angular application. We'll use that as our starting point. If you haven't done so, please go back to <em class="italics">Chapter 2, Setting Up Your Development Environment</em>, and create your project.</p>
    <p class="normal">In this section, you'll leverage Angular components, interfaces, and services to build the current weather <a id="_idIndexMarker227"/>feature in a decoupled, cohesive, and encapsulated manner.</p>
    <p class="normal">The landing page of an Angular app, by default, resides in <code class="Code-In-Text--PACKT-">app.component.html</code>. So, start by editing the template of <code class="Code-In-Text--PACKT-">AppComponent</code> with basic HTML, laying out the initial landing experience for the application.</p>
    <div class="packt_tip">
      <p>We are now beginning the development of Feature 1: <strong class="bold">Display Current Location weather information for the current day</strong> so you can move the card in the Github project to the <strong class="screen-text">In progress</strong> column.</p>
    </div>
    <ol>
      <li class="list" value="1">Delete any existing code in the template file <code class="Code-In-Text--PACKT-">app.component.html</code></li>
      <li class="list">Add a header as an <code class="Code-In-Text--PACKT-">h1</code> tag, followed by the tagline of our app as a <code class="Code-In-Text--PACKT-">div</code>, and placeholders for where we may want to display the current weather, demonstrated as shown in the following code block:
        <pre class="programlisting"><code class="hljs xml"><strong>src/app/app.component.html</strong>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"text-align:center"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>
    LocalCast Weather
  <span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Your city, your forecast, right now!<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>Current Weather<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>current weather<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
      </li>
      <li class="list">Remove the unused <code class="Code-In-Text--PACKT-">title</code> property from the <code class="Code-In-Text--PACKT-">component</code> class, so it's empty
        <pre class="programlisting"><code class="hljs coffeescript"><strong>src/app/app.component.ts</strong>
<span class="hljs-keyword">import</span> { Component } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>
@Component({
  selector: <span class="hljs-string">'app-root'</span>,
  templateUrl: <span class="hljs-string">'./app.component.html'</span>,
  styleUrls: [<span class="hljs-string">'./app.component.css'</span>],
})
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AppComponent</span> {}</span>
</code></pre>
      </li>
      <li class="list">In the terminal, execute <code class="Code-In-Text--PACKT-">npm start</code></li>
      <li class="list" value="5">Navigate to <code class="Code-In-Text--PACKT-">http://localhost:5000</code> on your browser</li>
    </ol>
    <p class="normal">You should now be able to observe the changes you're making in real time in the browser.</p>
    <div class="packt_tip">
      <p>Note that you should use the integrated terminal within VS Code to run commands, so you don't have to jump around different windows. Use [<kbd class="Key--PACKT-">CTRL</kbd>+<kbd class="Key--PACKT-">`</kbd>] on Windows or [<kbd class="Key--PACKT-">^</kbd>+<kbd class="Key--PACKT-">`</kbd>] on Mac to bring the terminal up. In case you're not familiar, <kbd class="Key--PACKT-">`</kbd> is a backtick and is usually on the same key as <kbd class="Key--PACKT-">~</kbd> (tilde).</p>
    </div>
    <h2 class="title" id="_idParaDest-96">Adding an Angular component</h2>
    <p class="normal">We need <a id="_idIndexMarker228"/>to display the current weather information, where <code class="Code-In-Text--PACKT-">&lt;div&gt;current weather&lt;/div&gt;</code> is located. To achieve this, we need to build a component that is responsible for displaying the weather data.</p>
    <p class="normal">The reason behind creating a separate component is an architectural best practice that is codified <a id="_idIndexMarker229"/>in the <strong class="bold">Model-View-ViewModel</strong> (<strong class="bold">MVVM</strong>) design pattern. You may <a id="_idIndexMarker230"/>have heard of the <strong class="bold">Model-View-Controller</strong> (<strong class="bold">MVC</strong>) pattern before. The vast majority of web-based code written circa 2005-2015 was written following the MVC pattern. MVVM differs from the MVC pattern in meaningful ways, as I explained in my 2013 article on DevPro:</p>
    <blockquote class="packt_quote">An effective implementation of MVVM inherently enforces proper separation of concerns. Business logic is clearly separated from presentation logic. So, when a View is developed, it stays developed, because fixing a bug in one View's functionality doesn't impact other views. On the flip side, if [you use] visual inheritance effectively and [create] reusable user controls, fixing a bug in one place can fix issues throughout the application.</blockquote>
    <p class="normal">Angular provides a practical implementation of MVVM:</p>
    <blockquote class="packt_quote">ViewModels neatly encapsulate any presentation logic and allow for simpler View code by acting as a specialized version of the model. The relationship between a View and ViewModel is straightforward, allowing more natural ways to wrap UI behavior in reusable user controls.</blockquote>
    <p class="normal">You can <a id="_idIndexMarker231"/>read more about the architectural nuance, with illustrations, at <a href="http://bit.ly/MVVMvsMVC"><span class="url">http://bit.ly/MVVMvsMVC</span></a>.</p>
    <p class="normal">Next, you create your very first Angular component, which includes the View and the ViewModel, using the Angular CLI's <code class="Code-In-Text--PACKT-">ng generate</code> command:</p>
    <ol>
      <li class="list" value="1">In the terminal, execute <code class="Code-In-Text--PACKT-">npx ng generate component current-weather</code>
        <div class="packt_tip">
          <p>Ensure that you are executing <code class="Code-In-Text--PACKT-">ng</code> commands under the <code class="Code-In-Text--PACKT-">local-weather-app</code> folder, and not under the parent folder where you initialized the project. Also, note that <code class="Code-In-Text--PACKT-">npx ng generate component current-weather</code> can be rewritten as <code class="Code-In-Text--PACKT-">ng g c current-weather</code>. This book utilizes the shorthand format going forward and expects you to prepend <code class="Code-In-Text--PACKT-">npx</code>, if necessary.</p>
        </div>
      </li>
      <li class="list">Observe <a id="_idIndexMarker232"/>the new files created in your <code class="Code-In-Text--PACKT-">app</code> folder:
        <pre class="programlisting"><code class="hljs stylus"><strong>src/app</strong>
├── app<span class="hljs-selector-class">.component</span><span class="hljs-selector-class">.css</span>
├── app<span class="hljs-selector-class">.component</span><span class="hljs-selector-class">.html</span>
├── app<span class="hljs-selector-class">.component</span><span class="hljs-selector-class">.spec</span><span class="hljs-selector-class">.ts</span>
├── app<span class="hljs-selector-class">.component</span><span class="hljs-selector-class">.ts</span>
├── app<span class="hljs-selector-class">.module</span><span class="hljs-selector-class">.ts</span>
├── current-weather
  ├── current-weather<span class="hljs-selector-class">.component</span><span class="hljs-selector-class">.css</span>
  ├── current-weather<span class="hljs-selector-class">.component</span><span class="hljs-selector-class">.html</span>
  ├── current-weather<span class="hljs-selector-class">.component</span><span class="hljs-selector-class">.spec</span><span class="hljs-selector-class">.ts</span>
  └── current-weather<span class="hljs-selector-class">.component</span><span class="hljs-selector-class">.ts</span>
</code></pre>
        <p class="Bullet-Without-Bullet-Within-Bullet--PACKT-">A generated component has four parts:</p>
        <ul>
          <li class="Bullet-Within-Bullet--PACKT-"><code class="Code-In-Text--PACKT-">current-weather.component.css</code> contains any CSS that is specific to the component and is an optional file.</li>
          <li class="Bullet-Within-Bullet--PACKT-"><code class="Code-In-Text--PACKT-">current-weather.component.html</code> contains the HTML template that defines the look of the component and rendering of the bindings and can be considered the View, in combination with any CSS styles used.</li>
          <li class="Bullet-Within-Bullet--PACKT-"><code class="Code-In-Text--PACKT-">current-weather.component.spec.ts</code> contains Jasmine-based unit tests that you can extend to test your component functionality.</li>
          <li class="Bullet-Within-Bullet-End--PACKT-"><code class="Code-In-Text--PACKT-">current-weather.component.ts</code> contains the <code class="Code-In-Text--PACKT-">@Component</code> decorator above the class definition and is the glue that ties together the CSS, HTML, and JavaScript code. The class itself can be considered the ViewModel, pulling data from services and performing any necessary transformations to expose sensible bindings for the View, shown as follows:</li>
        </ul>
        <pre class="programlisting"><code class="hljs typescript"><strong>src/app/current-weather/current-weather.component.ts</strong>
<span class="hljs-keyword">import</span> { Component, OnInit } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>
<span class="hljs-meta">@Component</span>({
  selector: <span class="hljs-string">'app-current-weather'</span>,
  templateUrl: <span class="hljs-string">'./current-weather.component.html'</span>,
  styleUrls: [<span class="hljs-string">'./current-weather.component.css'</span>],
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> CurrentWeatherComponent <span class="hljs-keyword">implements</span> OnInit {
  <span class="hljs-keyword">constructor</span>(<span class="hljs-params"/>) {}
  ngOnInit() {}
}
</code></pre>
        <p class="Bullet-Without-Bullet-Within-Bullet--PACKT-">If the component you're planning to write is a simple one, you can write it using inline styles and an inline template to simplify the structure of your code. If we were to rewrite the component above using inline templates and styles, it would look like the following example:</p>
        <pre class="programlisting"><code class="hljs typescript"><strong>example</strong>
<span class="hljs-keyword">import</span> { Component, OnInit } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>
<span class="hljs-meta">@Component</span>({
  selector: <span class="hljs-string">'app-current-weather'</span>, 
  template: <span class="hljs-string">`
  &lt;p&gt;
    current-weather works!
  &lt;/p&gt;
  `</span>,
  styles: []
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> CurrentWeatherComponent <span class="hljs-keyword">implements</span> OnInit {
  <span class="hljs-keyword">constructor</span>(<span class="hljs-params"/>) {}
  ngOnInit() {}
}
</code></pre>
        <p class="Bullet-Without-Bullet-Within-Bullet--PACKT-">However, we won't be inlining this template. So, keep your generated code as-is.</p>
        <div class="packt_tip">
          <p>Note that the template is surrounded by the backtick character, <kbd class="Key--PACKT-">`</kbd>, instead of a single-quote character. The backtick character defines a template literal, which allows newlines to be defined without having to concatenate strings with a plus operator. You can <a id="_idIndexMarker233"/>read more about template literals at <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals"><span class="url">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals</span></a>.</p>
        </div>
        <p class="Bullet-Without-Bullet-Within-Bullet--PACKT-">When you <a id="_idIndexMarker234"/>executed the <code class="Code-In-Text--PACKT-">generate</code> command, in addition to creating the component, the command also added the new component you created in the app's root module, <code class="Code-In-Text--PACKT-">app.module.ts</code>, avoiding the otherwise tedious task of wiring up components together:</p>
        <pre class="programlisting"><code class="hljs coffeescript"><strong>src/app/app.<span class="hljs-built_in">module</span>.ts</strong>
...
<span class="hljs-keyword">import</span> { 
  CurrentWeatherComponent 
} <span class="hljs-keyword">from</span> <span class="hljs-string">'./current-weather/ current-weather.component'</span>
...
@NgModule({
declarations: [
    AppComponent, 
    CurrentWeatherComponent
  ],
...
</code></pre>
        <div class="note">
          <p class="Information-Box--PACKT-">The bootstrap process of Angular is, admittedly, a bit convoluted. This is the chief reason the Angular CLI exists. <code class="Code-In-Text--PACKT-">index.html</code> contains an element named <code class="Code-In-Text--PACKT-">&lt;app-root&gt;</code>. When Angular begins execution, it first loads <code class="Code-In-Text--PACKT-">main.ts</code>, which configures the framework for browser use and loads the app module. The app module then loads all its dependencies and renders within the aforementioned <code class="Code-In-Text--PACKT-">&lt;app-root&gt;</code> element. In <em class="italics">Chapter 7</em>, <em class="italics">Creating a Router-First Line-of-Business App</em>, when we build a line-of-business app, we create feature modules to take advantage of the scalability features of Angular.</p>
        </div>
        <p class="Bullet-Without-Bullet-Within-Bullet--PACKT-">Now, we need to display our new component on the initial <code class="Code-In-Text--PACKT-">AppComponent</code> template, so it is visible to the end user.</p>
      </li>
      <li class="list">Add the <code class="Code-In-Text--PACKT-">CurrentWeatherComponent</code> to <code class="Code-In-Text--PACKT-">AppComponent</code> by replacing <code class="Code-In-Text--PACKT-">&lt;div&gt;current weather&lt;/div&gt;</code> with <code class="Code-In-Text--PACKT-">&lt;app-current-weather&gt;&lt;/app-current-weather&gt;</code>:
        <pre class="programlisting"><code class="hljs xml"><strong>src/app/app.component.html</strong>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"text-align:center"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>
    LocalCast Weather
  <span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Your city, your forecast, right now!<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>Current Weather<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">app-current-weather</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">app-current-weather</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
      </li>
      <li class="list">If <a id="_idIndexMarker235"/>everything worked correctly, you should see this:</li>
    </ol>
    <figure class="mediaobject"><img alt="" src="../Images/B14094_03_07.png"/></figure>
    <p class="packt_figref">Figure 3.7: Initial render of your Local Weather app</p>
    <div class="packt_tip">
      <p>Note the icon and name in the tab of the browser window. As a web development norm, in the <code class="Code-In-Text--PACKT-">index.html</code> file, update the <code class="Code-In-Text--PACKT-">&lt;title&gt;</code> tag and the <code class="Code-In-Text--PACKT-">favicon.ico</code> file with the name and icon of your application to customize the browser tab information. If your favicon doesn't update, append the <code class="Code-In-Text--PACKT-">href</code> attribute with a unique version number, such as <code class="Code-In-Text--PACKT-">href="favicon.ico?v=2"</code>. As a result, your app will start to look like a real web app, instead of a CLI-generated starter project.</p>
    </div>
    <p class="normal">Now that <a id="_idIndexMarker236"/>you have seen an Angular component in action, let's cover some basics of what is going on under the covers.</p>
    <h2 class="title" id="_idParaDest-97">Demystifying Angular components</h2>
    <p class="normal">As discussed in <em class="italics">Chapter 1</em>, <em class="italics">Introduction to Angular and Its Concepts</em>, an Angular component is implemented as an ES2015 class, which allows us to leverage OOP concepts. Classes are traditionally <a id="_idIndexMarker237"/>present in strongly-typed languages, so it is excellent that JavaScript implements classes as a dynamically typed language. Classes allow us to group (encapsulate) functionality and behavior in self-contained units (objects). We can define the behavior in very generalized and abstract ways and implement an inheritance hierarchy to share and morph behavior into differing implementations.</p>
    <p class="normal">Considering the <code class="Code-In-Text--PACKT-">CurrentWeatherComponent</code> class that follows, I can highlight some benefits of classes:</p>
    <pre class="programlisting"><code class="hljs typescript"><span class="hljs-meta">@Component</span>(...)
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> CurrentWeatherComponent <span class="hljs-keyword">implements</span> OnInit {
  <span class="hljs-keyword">constructor</span>(<span class="hljs-params"/>) {}
  ngOnInit() {}
}
</code></pre>
    <p class="normal">Unlike a function, you can't directly use code within a class. It must be instantiated as an object with the new keyword. This means that we can have multiple instances of any given class and each object can maintain its internal state. In this case, Angular instantiates a component for us behind the scenes. A <code class="Code-In-Text--PACKT-">constructor</code> of a class is executed at the time of its instantiation. You can put any code that initializes other classes or variables inside a constructor. However, you shouldn't make an HTTP call or attempt to access DOM elements from a constructor. This is where the <code class="Code-In-Text--PACKT-">OnInit</code> life cycle hook comes into play.</p>
    <p class="normal">As Angular is initializing <code class="Code-In-Text--PACKT-">CurrentWeatherComponent</code> as an object, it is also going through the entire graph of modules, components, services, and other dependencies to ensure all interdependent code is loaded into memory. During this time, Angular can't yet guarantee the availability of HTTP or DOM access. After all classes are instantiated, Angular goes through the classes that are decorated with <code class="Code-In-Text--PACKT-">@Component</code>, implements the <code class="Code-In-Text--PACKT-">OnInit</code> interface, and calls the <code class="Code-In-Text--PACKT-">ngOnInit</code> function within our class. This is why we need to put any code that needs HTTP or DOM access during the first load of our component into <code class="Code-In-Text--PACKT-">ngOnInit</code>.</p>
    <p class="normal">Classes can <a id="_idIndexMarker238"/>have properties, variables, and functions. From an Angular template, you can access any property, variable, or function inside of an expression. The syntax of an expression looks like <code class="Code-In-Text--PACKT-">{{ expression }}, [target]="expression", (event)="expression"</code> or <code class="Code-In-Text--PACKT-">*ngIf="expression"</code>.</p>
    <p class="normal">Now you have a good understanding of how the code, or the ViewModel, behind the template, the View, is instantiated and how you can access that code from the template. In the next section, we'll build an interface, which is a contract that defines the shape of an object.</p>
    <h2 class="title" id="_idParaDest-98">Defining your model using interfaces</h2>
    <p class="normal">Now that <a id="_idIndexMarker239"/>your View and ViewModel are in place, you need to define your model. If you look back on the design, you'll see that the component needs to display:</p>
    <ul>
      <li class="list">City and country</li>
      <li class="list">Current date</li>
      <li class="list">Current image</li>
      <li class="list">Current temperature</li>
      <li class="list">Current weather description</li>
    </ul>
    <p class="normal">You first need to create an interface that represents this data structure. We are creating an interface instead of a class because an interface is an abstraction that does not contain any implementation. When creating touchpoints or passing data between various components, we can ensure a decoupled design if we rely on an abstract definition over an object that may implement unpredictable custom behavior, leading to bugs.</p>
    <p class="normal">Start by creating the interface:</p>
    <ol>
      <li class="list" value="1">In the terminal, execute <code class="Code-In-Text--PACKT-">npx ng generate interface ICurrentWeather</code></li>
      <li class="list">Observe a newly generated file named <code class="Code-In-Text--PACKT-">icurrent-weather.ts</code> with an empty interface definition that looks like this:
        <pre class="programlisting"><code class="hljs routeros"><strong>src/app/icurrent-weather.ts</strong>
<span class="hljs-builtin-name">export</span><span class="hljs-built_in"> interface </span>ICurrentWeather {
}
</code></pre>
        <p class="Bullet-Without-Bullet-Within-Bullet--PACKT-">This is not an ideal setup, since we may add numerous interfaces to our app, and it can get tedious tracking down various interfaces. Over time, as you add concrete implementations of these interfaces as classes, it makes sense to put classes and their interfaces in their files.</p>
        <div class="packt_tip">
          <p>Why not just call the interface <code class="Code-In-Text--PACKT-">CurrentWeather</code>? This is because, later on, we may create a class to implement some interesting behavior for <code class="Code-In-Text--PACKT-">CurrentWeather</code>. Interfaces establish a contract, establishing the list of available properties on any class or interface that implements or extends the interface. It is always important to be aware of when you're using a class versus an interface. If you follow the best practice of always starting your interface names with a capital <code class="Code-In-Text--PACKT-">I</code>, you will always be conscious of what type of object you are passing around. Hence, the interface is named <code class="Code-In-Text--PACKT-">ICurrentWeather</code>.</p>
        </div>
      </li>
      <li class="list">Rename <code class="Code-In-Text--PACKT-">icurrent-weather.ts</code> to <code class="Code-In-Text--PACKT-">interfaces.ts</code></li>
      <li class="list">Also, implement <a id="_idIndexMarker240"/>the interface as follows:
        <pre class="programlisting"><code class="hljs routeros"><strong>src/app/interfaces.ts</strong>
<span class="hljs-builtin-name">export</span><span class="hljs-built_in"> interface </span>ICurrentWeather {
  city: string
  country: string 
  date: Date 
  image: string
  temperature: number 
  description: string
}
</code></pre>
        <p class="Bullet-Without-Bullet-Within-Bullet--PACKT-">This interface and its eventual concrete representation as a class is the Model in MVVM. So far, I have highlighted how various parts of Angular fit the MVVM pattern; going forward, I'll refer to these parts by their actual names.</p>
        <p class="Bullet-Without-Bullet-Within-Bullet--PACKT-">Now, we can import the interface into the component and start wiring up the bindings in the template of <code class="Code-In-Text--PACKT-">CurrentWeatherComponent</code>.</p>
      </li>
      <li class="list">Import <code class="Code-In-Text--PACKT-">ICurrentWeather</code></li>
      <li class="list">Switch back to <code class="Code-In-Text--PACKT-">templateUrl</code> and <code class="Code-In-Text--PACKT-">styleUrls</code></li>
      <li class="list" value="7">Define a local variable called <code class="Code-In-Text--PACKT-">current</code> with type <code class="Code-In-Text--PACKT-">ICurrentWeather</code>:
        <pre class="programlisting"><code class="hljs typescript"><strong>src/app/current-weather/current-weather.component.ts</strong>
<span class="hljs-keyword">import</span> { Component, OnInit } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span> 
<span class="hljs-keyword">import</span> { ICurrentWeather } <span class="hljs-keyword">from</span> <span class="hljs-string">'../interfaces'</span>
<span class="hljs-meta">@Component</span>({
  selector: <span class="hljs-string">'app-current-weather'</span>,
  templateUrl: <span class="hljs-string">'./current-weather.component.html'</span>,
  styleUrls: [<span class="hljs-string">'./current-weather.component.css'</span>],
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> CurrentWeatherComponent <span class="hljs-keyword">implements</span> OnInit {
  current: ICurrentWeather
  <span class="hljs-keyword">constructor</span>(<span class="hljs-params"/>) {}
  ngOnInit() {}
}
</code></pre>
      
      <div class="packt_tip">
        <p>If you just type <code class="Code-In-Text--PACKT-">current:ICurrentWeather</code>, you can use the Auto Fixer in VS Code to automatically insert the <code class="Code-In-Text--PACKT-">import</code> statement.</p>
      </div>
      <p class="Bullet-Without-Bullet-Within-Bullet--PACKT-">In the constructor, you need to temporarily populate the <code class="Code-In-Text--PACKT-">current</code> property with dummy data to test your bindings.</p></li>
      <li class="list" value="8">Implement <a id="_idIndexMarker241"/>dummy data as a JSON object and declare its adherence to <code class="Code-In-Text--PACKT-">ICurrentWeather</code> using the <code class="Code-In-Text--PACKT-">as</code> operator:
        <pre class="programlisting"><code class="hljs delphi"><strong>src/app/current-weather/current-weather.component.ts</strong>
...
<span class="hljs-function"><span class="hljs-keyword">constructor</span><span class="hljs-params">()</span> <span class="hljs-comment">{ 
  this.current = {
    city: 'Bethesda', 
    country: 'US', 
    date: new Date(),
    image: 'assets/img/sunny.svg', 
    temperature: 72,
    description: 'sunny',
  }</span> <span class="hljs-title">as</span> <span class="hljs-title">ICurrentWeather</span>
}
...
</span></code></pre>
        <div class="packt_tip">
          <p>In the <code class="Code-In-Text--PACKT-">src/assets</code> folder, create a subfolder named <code class="Code-In-Text--PACKT-">img</code> and place an image of your choice to reference in your dummy data.</p>
        </div>
        <p class="Bullet-Without-Bullet-Within-Bullet--PACKT-">You may forget the exact properties in the interface you created. You can get a quick peek at them by holding <kbd class="Key--PACKT-">Ctrl</kbd> + hovering over the interface name with your mouse, as shown:</p>
        <figure class="mediaobject"><img alt="" src="../Images/B14094_03_08.png"/></figure>
        <p class="packt_figref">Figure 3.8: <kbd class="Key--PACKT-">Ctrl</kbd> + hover over the interface</p>
        <p class="Bullet-Without-Bullet-Within-Bullet--PACKT-">Now, update the template to wire up your bindings with a basic HTML-based layout.</p>
      </li>
      <li class="list">Begin <a id="_idIndexMarker242"/>implementing the template:
        <pre class="programlisting"><code class="hljs dts"><strong>src<span class="hljs-meta-keyword">/app/</span>current-weather/current-weather.component.html</strong>
<span class="hljs-params">&lt;div&gt;</span>
  ...
<span class="hljs-params">&lt;/div&gt;</span>
</code></pre>
      </li>
      <li class="list">Within the parent <code class="Code-In-Text--PACKT-">div</code>, define another <code class="Code-In-Text--PACKT-">div</code> to display the city and country information using binding:
        <pre class="programlisting"><code class="hljs django"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span></span><span class="hljs-template-variable">{{current.city}}</span><span class="xml">, </span><span class="hljs-template-variable">{{current.country}}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
  ...
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</span></code></pre>
        <p class="Bullet-Without-Bullet-Within-Bullet--PACKT-">Note that within the <code class="Code-In-Text--PACKT-">span</code>, you can use static text to position the two properties. In this case, the <code class="Code-In-Text--PACKT-">city</code> and <code class="Code-In-Text--PACKT-">country</code> are separated by a comma, followed by a space.</p>
      </li>
      <li class="list">Below <code class="Code-In-Text--PACKT-">city</code> and <code class="Code-In-Text--PACKT-">country</code>, display the <code class="Code-In-Text--PACKT-">date</code> using binding and a <code class="Code-In-Text--PACKT-">DatePipe</code> to define a display format for the property:
        <pre class="programlisting"><code class="hljs twig"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span></span><span class="hljs-template-variable">{{current.<span class="hljs-name">date</span> | <span class="hljs-name">date</span>:'fullDate'}}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
</span></code></pre>
        <p class="Bullet-Without-Bullet-Within-Bullet--PACKT-">To change the display formatting of <code class="Code-In-Text--PACKT-">current.date</code>, we used the <code class="Code-In-Text--PACKT-">DatePipe</code> above, passing in <code class="Code-In-Text--PACKT-">'fullDate'</code> as the format option. In Angular, various out-of-the-box and custom pipe <code class="Code-In-Text--PACKT-">|</code> operators can be used to change the appearance of data without actually changing the underlying data. This is a very powerful, convenient, and flexible system to share such user interface logic without writing repetitive boilerplate code. </p>
        <p class="Bullet-Without-Bullet-Within-Bullet--PACKT-">In the preceding example, we could pass in <code class="Code-In-Text--PACKT-">'shortDate'</code> if we wanted to represent the current date in a more compact form. For more information on various <code class="Code-In-Text--PACKT-">DatePipe</code> options, refer to the documentation at <a href="https://angular.io/api/common/DatePipe"><span class="url">https://angular.io/api/common/DatePipe</span></a>.</p>
      </li>
      <li class="list">Define <a id="_idIndexMarker243"/>another <code class="Code-In-Text--PACKT-">div</code> to display the temperature information, formatting the value using <code class="Code-In-Text--PACKT-">DecimalPipe</code> and bind an image of the current weather to an <code class="Code-In-Text--PACKT-">img</code> tag:
        <pre class="programlisting"><code class="hljs xquery"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
  </span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> [<span class="hljs-attr">src</span>]=<span class="hljs-string">'current.image'</span>&gt;</span>
  </span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span></span><span class="xquery">{{current.temperature |<span class="hljs-built_in"> number</span>:<span class="hljs-string">'1.0-0'</span>}</span><span class="xml">}˚F<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span><span class="xml">
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><span class="xml">
</span></code></pre>
        <p class="Bullet-Without-Bullet-Within-Bullet--PACKT-">We bind the image property to the <code class="Code-In-Text--PACKT-">img</code> tag's <code class="Code-In-Text--PACKT-">src</code> attribute using the square bracket syntax. Next, we format <code class="Code-In-Text--PACKT-">current.temperature</code> so that no fractional values are shown, using <code class="Code-In-Text--PACKT-">DecimalPipe</code>. The documentation is at <a href="https://angular.io/api/common/DecimalPipe"><span class="url">https://angular.io/api/common/DecimalPipe</span></a>.</p>
        <div class="packt_tip">
          <p>Note that you can render ˚C and ˚F using their respective HTML codes: <code class="Code-In-Text--PACKT-">&amp;#8451;</code> for ˚C and <code class="Code-In-Text--PACKT-">&amp;#8457</code>; for ˚F.</p>
        </div>
      </li>
      <li class="list">Create a final <code class="Code-In-Text--PACKT-">div</code> to display the description property:
        <pre class="programlisting"><code class="hljs django"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
  </span><span class="hljs-template-variable">{{current.description}}</span><span class="xml">
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</span></code></pre>
      </li>
      <li class="list">Your final template should look as follows:
        <pre class="programlisting"><code class="hljs twig"><strong><span class="xml">src/app/current-weather/current-weather.component.html</span></strong><span class="xml">
<span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span></span><span class="hljs-template-variable">{{current.city}}</span><span class="xml">, </span><span class="hljs-template-variable">{{current.country}}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span></span><span class="hljs-template-variable">{{current.<span class="hljs-name">date</span> | <span class="hljs-name">date</span>:'fullDate'}}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">img</span> [<span class="hljs-attr">src</span>]=<span class="hljs-string">'current.image'</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span></span><span class="hljs-template-variable">{{current.temperature | number:'1.0-0'}}</span><span class="xml">˚F<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    </span><span class="hljs-template-variable">{{current.description}}</span><span class="xml">
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</span></code></pre>
      </li>
      <li class="list" value="15">If everything <a id="_idIndexMarker244"/>worked correctly, your app should be looking similar to this screenshot:</li>
    </ol>
    <figure class="mediaobject"><img alt="" src="../Images/B14094_03_09.png"/></figure>
    <p class="packt_figref">Figure 3.9: App after wiring up bindings with dummy data</p>
    <p class="normal">Congratulations – you have successfully wired up your first component!</p>
    <p class="normal">Now let's update the app so that we can pull live weather data from a Web API.</p>
    <h1 class="title" id="_idParaDest-99">Using Angular Services and HttpClient to retrieve data</h1>
    <p class="normal">Now you <a id="_idIndexMarker245"/>need to connect your <code class="Code-In-Text--PACKT-">CurrentWeather</code> component to the <code class="Code-In-Text--PACKT-">OpenWeatherMap</code> APIs to pull live weather data. However, we don't want to <a id="_idIndexMarker246"/>insert this code directly into our component. If we did this, we would have to update the component if the API changed. Now imagine an app with dozens or hundreds of views and imagine how this would create a significant maintainability challenge.</p>
    <p class="normal">Instead, we'll leverage an Angular service, a singleton class, which can provide the current weather information to our component and abstract away the source of the data. The abstraction <a id="_idIndexMarker247"/>decouples the UI from the Web API. Leveraging <a id="_idIndexMarker248"/>this separation of concerns, in the future, we could enhance our service to pull from multiple APIs or a local cache to load weather information without having to change the UI code.</p>
    <p class="normal">In the upcoming sections, we'll go over the following steps to accomplish this goal:</p>
    <ol>
      <li class="list" value="1">Creating a new Angular service</li>
      <li class="list">Importing <code class="Code-In-Text--PACKT-">HttpClientModule</code> and injecting it into the service</li>
      <li class="list">Discovering the <code class="Code-In-Text--PACKT-">OpenWeatherMap</code> API</li>
      <li class="list">Creating a new interface that conforms to the shape of the API</li>
      <li class="list">Writing a <code class="Code-In-Text--PACKT-">get</code> request</li>
      <li class="list">Injecting the new service into the <code class="Code-In-Text--PACKT-">CurrentWeather</code> component</li>
      <li class="list">Calling the service from the <code class="Code-In-Text--PACKT-">ngOnInit</code> function of the <code class="Code-In-Text--PACKT-">CurrentWeather</code> component</li>
    </ol>
    <ol>
      <li class="list" value="8">Finally, mapping the API data to the local <code class="Code-In-Text--PACKT-">ICurrentWeather</code> type using RxJS functions so that your component can consume it</li>
    </ol>
    <h2 class="title" id="_idParaDest-100">Creating a new Angular service</h2>
    <p class="normal">Any code that goes outside of the boundaries of a component should exist in a service; this includes <a id="_idIndexMarker249"/>inter-component communication (unless there's a parent-child relationship), API calls of any kind, and any code that caches or retrieves data from a cookie or the browser's <code class="Code-In-Text--PACKT-">localStorage</code>. This is a critical architectural pattern that keeps your application maintainable in the long term. I expand upon this idea in my DevPro MVVM article at link <a href="https://www.itprotoday.com/microsoft-visualstudio/mvvm-and-net-great-combo-web-application-developme"><span class="url">https://www.itprotoday.com/microsoft-visualstudio/mvvm-and-net-great-combo-web-application-development</span></a>.</p>
    <p class="normal">To create an Angular service, use the Angular CLI:</p>
    <ol>
      <li class="list" value="1">In the terminal, execute <code class="Code-In-Text--PACKT-">npx ng g s weather --flat false</code></li>
    </ol>
    <ol>
      <li class="list" value="2">Observe the new <code class="Code-In-Text--PACKT-">weather</code> folder that's created:
        <pre class="programlisting"><code class="hljs stylus"><strong>src/app</strong>
...
└── weather
├── weather<span class="hljs-selector-class">.service</span><span class="hljs-selector-class">.spec</span><span class="hljs-selector-class">.ts</span>
└── weather<span class="hljs-selector-class">.service</span><span class="hljs-selector-class">.ts</span>
</code></pre>
      </li>
    </ol>
    <p class="normal">A CLI-generated service has two parts:</p>
    <ul>
      <li class="list"><code class="Code-In-Text--PACKT-">weather.service.spec.ts</code> contains Jasmine-based unit tests that you can extend to test your service's functionality.</li>
      <li class="list"><code class="Code-In-Text--PACKT-">weather.service.ts</code> contains the <code class="Code-In-Text--PACKT-">@Injectable</code> decorator above the class definition, which makes it possible to inject this service into other components, leveraging Angular's provider system. This ensures that our service is a singleton, meaning it is instantiated once, no matter how many times it is injected elsewhere.</li>
    </ul>
    <p class="normal">The service <a id="_idIndexMarker250"/>is generated as shown here:</p>
    <pre class="programlisting"><code class="hljs typescript"><strong>src/app/weather/weather.service.ts</strong>
<span class="hljs-keyword">import</span> { Injectable } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>
<span class="hljs-meta">@Injectable</span>({
  providedIn: <span class="hljs-string">'root'</span>,
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> WeatherService {
  <span class="hljs-keyword">constructor</span>(<span class="hljs-params"/>) {}
}
</code></pre>
    <div class="packt_tip">
      <p>Note that the <code class="Code-In-Text--PACKT-">providedIn</code> property ensures that the root module provides the weather service in <code class="Code-In-Text--PACKT-">app.module.ts</code>.</p>
    </div>
    <p class="normal">Next, let's see the dependency injection mechanism in Angular, which allows services and modules to be used by other services, components, or modules without the developer having to manage the instantiation of the shared objects.</p>
    <h2 class="title" id="_idParaDest-101">Injecting dependencies</h2>
    <p class="normal">To make <a id="_idIndexMarker251"/>API calls, you need to leverage the <code class="Code-In-Text--PACKT-">HttpClient</code> module in Angular. The official documentation (<a href="https://angular.io/guide/http"><span class="url">https://angular.io/guide/http</span></a>) explains the benefits of this module succinctly:</p>
    <blockquote class="packt_quote">"With HttpClient, @angular/common/http provides a simplified API for HTTP functionality for use with Angular applications, building on top of the XMLHttpRequest interface exposed by browsers. Additional benefits of HttpClient include testability support, strong typing of request and response objects, request and response interceptor support, and better error handling via APIs based on Observables."</blockquote>
    <p class="normal">Let's start <a id="_idIndexMarker252"/>by importing the <code class="Code-In-Text--PACKT-">HttpClientModule</code> into our app so we can inject the <code class="Code-In-Text--PACKT-">HttpClient</code> provided by the module into the <code class="Code-In-Text--PACKT-">WeatherService</code>:</p>
    <ol>
      <li class="list" value="1">Add <code class="Code-In-Text--PACKT-">HttpClientModule</code> to <code class="Code-In-Text--PACKT-">app.module.ts</code>, as follows:
        <pre class="programlisting"><code class="hljs lasso"><strong>src/app/app.module.ts</strong>
<span class="hljs-params">...</span> 
<span class="hljs-keyword">import</span> { HttpClientModule } from <span class="hljs-string">'@angular/common/http'</span> 
<span class="hljs-params">...</span> 
@NgModule({ 
  <span class="hljs-params">...</span> 
  imports: <span class="hljs-meta">[</span><span class="hljs-params">...</span>, HttpClientModule<span class="hljs-meta">]</span>
  ...
}) 
</code></pre>
      </li>
      <li class="list">Inject <code class="Code-In-Text--PACKT-">HttpClient</code>, provided by the <code class="Code-In-Text--PACKT-">HttpClientModule</code> in the <code class="Code-In-Text--PACKT-">WeatherService</code>, as follows:
        <pre class="programlisting"><code class="hljs typescript"><strong>src/app/weather/weather.service.ts</strong>
<span class="hljs-keyword">import</span> { HttpClient } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/common/http'</span>
<span class="hljs-keyword">import</span> { Injectable } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>
<span class="hljs-meta">@Injectable</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> WeatherService {
  <span class="hljs-keyword">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> httpClient: HttpClient</span>) {}
}
</code></pre>
      </li>
    </ol>
    <p class="normal">Now, <code class="Code-In-Text--PACKT-">httpClient</code> is ready for use in your service.</p>
    <h2 class="title" id="_idParaDest-102">Discovering OpenWeatherMap APIs</h2>
    <p class="normal">Since <code class="Code-In-Text--PACKT-">httpClient</code> is strongly typed, we need to create a new interface that conforms to the shape <a id="_idIndexMarker253"/>of the API we'll call. To be able to do this, you need to familiarize yourself with the Current Weather Data API:</p>
    <ol>
      <li class="list" value="1">Read the documentation by navigating to <a href="http://openweathermap.org/current"><span class="url">http://openweathermap.org/current</span></a>:<figure class="mediaobject"><img alt="" src="../Images/B14094_03_10.png"/></figure>
        <p class="packt_figref">Figure 3.10: OpenWeatherMap Current Weather Data API documentation</p>
        <p class="Bullet-Without-Bullet-Within-Bullet--PACKT-">You need to use the API named <strong class="screen-text">By city name</strong>, which allows you to get current weather data by providing the city name as a parameter so that our web request looks as follows:</p>
        <pre class="programlisting"><code class="hljs haskell"><span class="hljs-title">api</span>.openweathermap.org/<span class="hljs-class"><span class="hljs-keyword">data</span>/2.5/weather?q={<span class="hljs-title">city</span> <span class="hljs-title">name</span>},{<span class="hljs-title">country</span> <span class="hljs-title">code</span>}</span>
</code></pre>
      </li>
      <li class="list">On the <a id="_idIndexMarker254"/>documentation page, click on the link under <strong class="screen-text">Example of API calls</strong>, and you will see a sample response like the following:
        <pre class="programlisting"><code class="hljs yaml"><strong><span class="hljs-string">http://samples.openweathermap.org/data/2.5/weather?q=London,uk&amp;appid=b1b15e88fa797225412429c1c50c122a1</span></strong>
<span class="hljs-string">{</span>
  <span class="hljs-attr">"coord":</span> <span class="hljs-string">{</span> 
    <span class="hljs-attr">"lon":</span> <span class="hljs-number">-0.13</span><span class="hljs-string">,</span>
    <span class="hljs-attr">"lat":</span> <span class="hljs-number">51.51</span>
  <span class="hljs-string">},</span>
  <span class="hljs-attr">"weather":</span> <span class="hljs-string">[</span>
    <span class="hljs-string">{</span>
      <span class="hljs-attr">"id":</span> <span class="hljs-number">300</span><span class="hljs-string">,</span>
      <span class="hljs-attr">"main":</span> <span class="hljs-string">"Drizzle"</span><span class="hljs-string">,</span>
      <span class="hljs-attr">"description":</span> <span class="hljs-string">"light intensity drizzle"</span><span class="hljs-string">,</span>
      <span class="hljs-attr">"icon":</span> <span class="hljs-string">"09d"</span>
    <span class="hljs-string">}</span>
  <span class="hljs-string">],</span>
  <span class="hljs-attr">"base":</span> <span class="hljs-string">"stations"</span><span class="hljs-string">,</span>
  <span class="hljs-attr">"main":</span> <span class="hljs-string">{</span>
    <span class="hljs-attr">"temp":</span> <span class="hljs-number">280.32</span><span class="hljs-string">,</span>
    <span class="hljs-attr">"pressure":</span> <span class="hljs-number">1012</span><span class="hljs-string">,</span>
    <span class="hljs-attr">"humidity":</span> <span class="hljs-number">81</span><span class="hljs-string">,</span>
    <span class="hljs-attr">"temp_min":</span> <span class="hljs-number">279.15</span><span class="hljs-string">,</span>
    <span class="hljs-attr">"temp_max":</span> <span class="hljs-number">281.15</span>
  <span class="hljs-string">},</span>
  <span class="hljs-attr">"visibility":</span> <span class="hljs-number">10000</span><span class="hljs-string">,</span>
  <span class="hljs-attr">"wind":</span> <span class="hljs-string">{</span>
    <span class="hljs-attr">"speed":</span> <span class="hljs-number">4.1</span><span class="hljs-string">,</span>
    <span class="hljs-attr">"deg":</span> <span class="hljs-number">80</span>
  <span class="hljs-string">},</span>
  <span class="hljs-attr">"clouds":</span> <span class="hljs-string">{</span>
  <span class="hljs-attr">"all":</span> <span class="hljs-number">90</span>
  <span class="hljs-string">},</span>
  <span class="hljs-attr">"dt":</span> <span class="hljs-number">1485789600</span><span class="hljs-string">,</span>
  <span class="hljs-attr">"sys":</span> <span class="hljs-string">{</span>
    <span class="hljs-attr">"type":</span> <span class="hljs-number">1</span><span class="hljs-string">,</span>
    <span class="hljs-attr">"id":</span> <span class="hljs-number">5091</span><span class="hljs-string">,</span>
    <span class="hljs-attr">"message":</span> <span class="hljs-number">0.0103</span><span class="hljs-string">,</span>
    <span class="hljs-attr">"country":</span> <span class="hljs-string">"GB"</span><span class="hljs-string">,</span>
    <span class="hljs-attr">"sunrise":</span> <span class="hljs-number">1485762037</span><span class="hljs-string">,</span>
    <span class="hljs-attr">"sunset":</span> <span class="hljs-number">1485794875</span>
  <span class="hljs-string">},</span>
  <span class="hljs-attr">"id":</span> <span class="hljs-number">2643743</span><span class="hljs-string">,</span>
  <span class="hljs-attr">"name":</span> <span class="hljs-string">"London"</span><span class="hljs-string">,</span>
  <span class="hljs-attr">"cod":</span> <span class="hljs-number">200</span>
<span class="hljs-string">}</span>
</code></pre>
        <p class="Bullet-Without-Bullet-Within-Bullet--PACKT-">Given the existing <code class="Code-In-Text--PACKT-">ICurrentWeather</code> interface that you have already created, this response contains more information than you need. You need to <a id="_idIndexMarker255"/>write a new interface that conforms to the shape of this response, but only specify the pieces of data you intend to use. This interface only exists in the <code class="Code-In-Text--PACKT-">WeatherService</code> and we won't export it since the other parts of the application don't need to know about this type.</p>
      </li>
      <li class="list">Create a new interface named <code class="Code-In-Text--PACKT-">ICurrentWeatherData</code> in <code class="Code-In-Text--PACKT-">weather.service.ts</code> between the <code class="Code-In-Text--PACKT-">import</code> and <code class="Code-In-Text--PACKT-">@Injectable</code> statements</li>
      <li class="list" value="4">The new <a id="_idIndexMarker256"/>interface should like this:
        <pre class="programlisting"><code class="hljs dts"><strong>src<span class="hljs-meta-keyword">/app/</span>weather/weather.service.ts</strong>
interface <span class="hljs-class">ICurrentWeatherData </span>{ 
<span class="hljs-symbol">  weather:</span> [{
<span class="hljs-symbol">    description:</span> string,
<span class="hljs-symbol">    icon:</span> string
  }],
<span class="hljs-symbol">  main:</span> {
<span class="hljs-symbol">    temp:</span> number
  },
<span class="hljs-symbol">  sys:</span> {
<span class="hljs-symbol">    country:</span> string
  },
<span class="hljs-symbol">  dt:</span> number,
<span class="hljs-symbol">  name:</span> string
}
</code></pre>
      </li>
    </ol>
    <div class="packt_tip">
      <p>With the <code class="Code-In-Text--PACKT-">ICurrentWeatherData</code> interface, we are defining new anonymous types by adding children objects to the interface with varying structures. Each of these objects can be individually extracted out and defined as their own named interface. Especially note that <code class="Code-In-Text--PACKT-">weather</code> is an array of the anonymous type that has the <code class="Code-In-Text--PACKT-">description</code> and <code class="Code-In-Text--PACKT-">icon</code> properties.</p>
    </div>
    <p class="normal">Next, let's learn how you can introduce environment variables into your Angular application, so the test and production versions of your app can rely on different values.</p>
    <h2 class="title" id="_idParaDest-103">Storing environment variables</h2>
    <p class="normal">It's easy to miss, but the sample URL in the previous sections—<code class="Code-In-Text--PACKT-">http://samples.openweathermap.org/data/2.5/weather?q=London,uk&amp;appid=b1b15e88fa797225412429c1c50c122a1</code>—contains a required <code class="Code-In-Text--PACKT-">appid</code> parameter. You must store <a id="_idIndexMarker257"/>this key in your Angular app. You can store it in the weather service, but in reality, applications need to be able to target different sets of resources as they move from development to testing, staging, and production environments. Out of the box, Angular provides two environments: one <code class="Code-In-Text--PACKT-">prod</code> and the other one as the default.</p>
    <p class="normal">Before you can continue, you need to sign up for a free <code class="Code-In-Text--PACKT-">OpenWeatherMap</code> account and retrieve your <code class="Code-In-Text--PACKT-">appid</code>. You can read the documentation for <code class="Code-In-Text--PACKT-">appid</code> at <a href="http://openweathermap.org/appid"><span class="url">http://openweathermap.org/appid</span></a> for more detailed information.</p>
    <ol>
      <li class="list" value="1">Copy your <code class="Code-In-Text--PACKT-">appid</code>, which is a long string of characters and numbers</li>
      <li class="list">Store your <code class="Code-In-Text--PACKT-">appid</code> in <code class="Code-In-Text--PACKT-">environment.ts</code></li>
      <li class="list" value="3">Configure <code class="Code-In-Text--PACKT-">baseUrl</code> for later use:
        <pre class="programlisting"><code class="hljs dart"><strong>src/environments/environment.ts</strong>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> environment = {
  production: <span class="hljs-keyword">false</span>,
  appId: <span class="hljs-string">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>,
  baseUrl: <span class="hljs-string">'http://'</span>,
}
</code></pre>
      </li>
    </ol>
    <div class="packt_tip">
      <p>In code, we use a camel-case <code class="Code-In-Text--PACKT-">appId</code> to keep our coding style consistent.</p>
      <p>Since URL parameters are case-insensitive, <code class="Code-In-Text--PACKT-">appId</code> works as well as <code class="Code-In-Text--PACKT-">appid</code>.</p>
    </div>
    <p class="normal">Next, let's <a id="_idIndexMarker258"/>implement an HTTP GET to get the current weather data.</p>
    <h2 class="title" id="_idParaDest-104">Implementing an HTTP GET operation</h2>
    <p class="normal">Now, we can <a id="_idIndexMarker259"/>implement the GET call in the <code class="Code-In-Text--PACKT-">WeatherService</code> class:</p>
    <ol>
      <li class="list" value="1">Add a new function to the <code class="Code-In-Text--PACKT-">WeatherService</code> class named <code class="Code-In-Text--PACKT-">getCurrentWeather</code></li>
      <li class="list">Import the <code class="Code-In-Text--PACKT-">environment</code> object</li>
      <li class="list">Implement the <code class="Code-In-Text--PACKT-">httpClient.get</code> function</li>
      <li class="list">Return the results of the HTTP call:
        <pre class="programlisting"><code class="hljs typescript"><strong>src/app/weather/weather.service.ts</strong>
<span class="hljs-keyword">import</span> { HttpClient } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/common/http'</span>
<span class="hljs-keyword">import</span> { environment } <span class="hljs-keyword">from</span> <span class="hljs-string">'../../environments/environment'</span>
...
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> WeatherService {
  <span class="hljs-keyword">constructor</span>(<span class="hljs-params">
    <span class="hljs-keyword">private</span> httpClient: HttpClient
  </span>) { }
getCurrentWeather(city: <span class="hljs-built_in">string</span>, country: <span class="hljs-built_in">string</span>) { 
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.httpClient
    .get&lt;ICurrentWeatherData&gt;(
    <span class="hljs-string">`<span class="hljs-subst">${environment.baseUrl}</span>api.openweathermap.org/data/2.5/weather?`</span> +
        <span class="hljs-string">`q=<span class="hljs-subst">${city}</span>,<span class="hljs-subst">${country}</span>&amp;appid=<span class="hljs-subst">${environment.appId}</span>`</span>
    )
  }
}
</code></pre>
        <div class="packt_tip">
          <p>Note the use of ES2015's String Interpolation feature. Instead of building your string by appending variables to one another like <code class="Code-In-Text--PACKT-">environment.baseUrl + 'api.openweathermap.org/data/2.5/weather?q=' + city + ',' + country + '&amp;appid=' + environment.appId</code>, you can use the backtick syntax to wrap <code class="Code-In-Text--PACKT-">`your string`</code>. Inside the backticks, you can have newlines and directly embed variables in the flow of your string by wrapping them with the <code class="Code-In-Text--PACKT-">${dollarbracket}</code> syntax. However, when you introduce a newline in your code, it is interpreted as a literal newline <code class="Code-In-Text--PACKT-">\n</code>. To break up the string in your code, you can add a backslash <code class="Code-In-Text--PACKT-">\</code>, but then the next line of your code can have no indentation. It is easier to just concatenate multiple templates, as shown in the preceding code sample.</p>
        </div>
        <p class="Bullet-Without-Bullet-Within-Bullet--PACKT-">Using a long and complicated string is an error-prone process. Instead, we can use the <code class="Code-In-Text--PACKT-">HttpParams</code> object to build the URL programmatically.</p>
      </li>
      <li class="list">Leverage <code class="Code-In-Text--PACKT-">HttpParams</code> to <a id="_idIndexMarker260"/>simplify the URL:
        <pre class="programlisting"><code class="hljs typescript"><strong>src/app/weather/weather.service.ts</strong>
<span class="hljs-keyword">import</span> { HttpClient, HttpParams } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/common/http'</span>
<span class="hljs-keyword">import</span> { environment } <span class="hljs-keyword">from</span> <span class="hljs-string">'../../environments/environment'</span>
...
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> WeatherService {
  <span class="hljs-keyword">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> httpClient: HttpClient</span>) { }
  getCurrentWeather(city: <span class="hljs-built_in">string</span>, country: <span class="hljs-built_in">string</span>) {
    <span class="hljs-keyword">const</span> uriParams = <span class="hljs-keyword">new</span> HttpParams()
      .set(<span class="hljs-string">'q'</span>, <span class="hljs-string">`<span class="hljs-subst">${city}</span>,<span class="hljs-subst">${country}</span>`</span>)
      .set(<span class="hljs-string">'appid'</span>, environment.appId)
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.httpClient
      .get&lt;ICurrentWeatherData&gt;(
    <span class="hljs-string">`<span class="hljs-subst">${environment.baseUrl}</span>api.openweathermap.org/data/2.5/weather`</span>,
        { params: uriParams }
      )
  }
}
</code></pre>
      </li>
    </ol>
    <p class="normal">Now let's <a id="_idIndexMarker261"/>connect the dots so that we can get the current weather data from the CurrentWeather component leveraging the Weather service.</p>
    <h2 class="title" id="_idParaDest-105">Retrieving service data from a component</h2>
    <p class="normal">To be able <a id="_idIndexMarker262"/>to use the <code class="Code-In-Text--PACKT-">getCurrentWeather</code> function in the <code class="Code-In-Text--PACKT-">CurrentWeather</code> component, you need to inject the service into the component:</p>
    <ol>
      <li class="list" value="1">Inject the <code class="Code-In-Text--PACKT-">WeatherService</code> into the constructor of the <code class="Code-In-Text--PACKT-">CurrentWeatherComponent</code> class</li>
      <li class="list">Remove the existing code that created the dummy data in the constructor:
        <pre class="programlisting"><code class="hljs delphi"><strong>src/app/current-weather/current-weather.component.ts</strong>
<span class="hljs-function"><span class="hljs-keyword">constructor</span><span class="hljs-params">(<span class="hljs-keyword">private</span> weatherService: WeatherService)</span> <span class="hljs-comment">{ }</span>
</span></code></pre>
        <div class="packt_tip">
          <p>Note the use of TypeScript generics with the <code class="Code-In-Text--PACKT-">get</code> function using the caret syntax, like <code class="Code-In-Text--PACKT-">&lt;TypeName&gt;</code>. Using generics is a development-time quality-of-life feature. By providing the type information to the function, input and/or return variable types of that function display as you write your code and are validated during development and also at compile time.</p>
        </div>
      </li>
      <li class="list">Call the <code class="Code-In-Text--PACKT-">getCurrentWeather</code> function inside the <code class="Code-In-Text--PACKT-">ngOnInit</code> function:
        <pre class="programlisting"><code class="hljs stylus"><strong>src/app/current-weather/current-weather<span class="hljs-selector-class">.component</span><span class="hljs-selector-class">.ts</span></strong>
<span class="hljs-function"><span class="hljs-title">ngOnInit</span><span class="hljs-params">()</span></span> { 
  this<span class="hljs-selector-class">.weatherService</span>.getCurrentWeather(<span class="hljs-string">'Bethesda'</span>, <span class="hljs-string">'US'</span>)
    .subscribe((data) =&gt; this<span class="hljs-selector-class">.current</span> = data)
}
</code></pre>
      </li>
    </ol>
    <p class="normal">Fair warning: do not expect this code to be working just yet, because <code class="Code-In-Text--PACKT-">data</code> is of type <code class="Code-In-Text--PACKT-">ICurrentWeatherData</code> and <code class="Code-In-Text--PACKT-">current</code> is of type <code class="Code-In-Text--PACKT-">ICurrentWeather</code>. You can observe the error, which should say "<code class="Code-In-Text--PACKT-">error TS2322: Type 'Observable&lt;ICurrentWeatherData&gt;' is not assignable to type 'Observable&lt;ICurrentWeather&gt;'</code>." Let's look at what's goes in the next segment.</p>
    <div class="note">
      <p class="Information-Box--PACKT-">Angular components have a rich collection of life cycle hooks that allow you to inject your custom behavior when a component is being rendered, refreshed, or destroyed. <code class="Code-In-Text--PACKT-">ngOnInit()</code> is the most common life cycle hook you're going to use. It is only called once, when a component is first instantiated or visited. This is where you want to perform your service calls. For a deeper understanding of component life cycle hooks, check out the documentation at <a href="https://angular.io/guide/lifecycle-hooks"><span class="url">https://angular.io/guide/lifecycle-hooks</span></a>.</p>
    </div>
    <div class="packt_tip">
      <p>Note that <a id="_idIndexMarker263"/>the anonymous function you have passed to subscribe is an ES2015 arrow function. If you're not familiar with arrow functions, it may be confusing at first. Arrow functions are quite elegant and simple. Consider the following arrow function:</p>
      <pre class="programlisting"><code class="hljs kotlin">(<span class="hljs-keyword">data</span>) =&gt; { <span class="hljs-keyword">this</span>.current = <span class="hljs-keyword">data</span> }
</code></pre>
      <p>You can rewrite it simply as:</p>
      <pre class="programlisting"><code class="hljs actionscript"><span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data)</span> </span>{ <span class="hljs-keyword">this</span>.current = data }
</code></pre>
      <p>There's a special condition—when you write an arrow function that transforms a piece of data, such as:</p>
      <pre class="programlisting"><code class="hljs haskell">(<span class="hljs-class"><span class="hljs-keyword">data</span>) =&gt; { <span class="hljs-title">data</span>.<span class="hljs-title">main</span>.<span class="hljs-title">temp</span> }</span>
</code></pre>
      <p>This function effectively takes <code class="Code-In-Text--PACKT-">ICurrentWeatherData</code> as an input and returns the <code class="Code-In-Text--PACKT-">temp</code> property. The return statement is implicit. If you rewrite it as a regular function, it looks as follows:</p>
      <pre class="programlisting"><code class="hljs fortran"><span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data)</span></span> { <span class="hljs-keyword">return</span> <span class="hljs-keyword">data</span>.main.temp }
</code></pre>
    </div>
    <p class="normal">When the <code class="Code-In-Text--PACKT-">CurrentWeather</code> component loads, <code class="Code-In-Text--PACKT-">ngOnInit</code> fires once, which calls the <code class="Code-In-Text--PACKT-">getCurrentWeather</code> function, which returns an object with the type <code class="Code-In-Text--PACKT-">Observable&lt;ICurrentWeatherData&gt;</code>.</p>
    <p class="normal">An Observable <em class="italics">is the most basic building block of RxJS</em> and represents an event emitter, which emits any data received over time with the type of <code class="Code-In-Text--PACKT-">ICurrentWeatherData</code> as described in the official documentation.</p>
    <p class="normal">The Observable object by itself is benign and won't send a request over the network unless it is being listened to. You can read more about Observables at <a href="https://reactivex.io/rxjs/class/es6/Observable.js~Observable.html"><span class="url">https://reactivex.io/rxjs/class/es6/Observable.js~Observable.html</span></a>.</p>
    <p class="normal">By calling <code class="Code-In-Text--PACKT-">.subscribe</code> on the Observable, you're essentially attaching a listener to the emitter. You've implemented an anonymous function within the <code class="Code-In-Text--PACKT-">subscribe</code> method, which gets executed whenever a new piece of data is received and an event is emitted. The anonymous function takes a data object as a parameter, and the specific implementation, in this case, assigns the piece of data to the local variable named <code class="Code-In-Text--PACKT-">current</code>. Whenever <code class="Code-In-Text--PACKT-">current</code> is updated, the template bindings you implemented earlier pull in the new data and render it on the View. Even though <code class="Code-In-Text--PACKT-">ngOnInit</code> executes only once, the subscription to the Observable persists. So, whenever there's new data, the current variable updates and the View rerenders to display the latest data.</p>
    <p class="normal">The root <a id="_idIndexMarker264"/>cause of the error at hand is that the data that is being emitted is of type <code class="Code-In-Text--PACKT-">ICurrentWeatherData</code>; however, our component only understands data that is shaped as described by the <code class="Code-In-Text--PACKT-">ICurrentWeather</code> interface. In the next section, you'll need to dig deeper into RxJS to understand how best to accomplish that task.</p>
    <div class="packt_tip">
      <p>Beware, VS Code and the CLI sometimes stop working. As previously noted, as you code, the <code class="Code-In-Text--PACKT-">npm start</code> command is running in the integrated terminal of VS Code. The Angular CLI, in combination with the Angular Language Service plugin, continuously watches for code changes and transpiles your TypeScript code to JavaScript so that you can observe your changes with live-reloading in the browser. The great thing is that when you make coding errors, in addition to the red underlining in VS Code, you also see some red text in the terminal, or even the browser, because the transpilation has failed. In most cases, when correcting the error, the red underlining goes away and the Angular CLI automatically re-transpiles your code and everything works. However, in specific scenarios, note that VS Code fails to pick typing changes in the IDE so that you won't get autocompletion help, or the CLI tool may get stuck with a message saying <strong class="bold">webpack:</strong> <strong class="bold">Failed to compile</strong>.</p>
      <p>You have two main strategies to recover from such conditions:</p>
      <ul>
        <li class="Bullet-Within-Tip--PACKT-">Click on the terminal and hit <kbd class="Key--PACKT-">Ctrl</kbd> + <kbd class="Key--PACKT-">C</kbd> to stop running the CLI task and restart by executing <code class="Code-In-Text--PACKT-">npm start</code>.</li>
        <li class="Bullet-Within-Tip-End--PACKT-">If that doesn't work, quit VS Code with <kbd class="Key--PACKT-">Alt</kbd> + <kbd class="Key--PACKT-">F4</kbd> for Windows or <kbd class="Key--PACKT-"><img alt="" src="../Images/B14094_02_0012.png"/></kbd> + <kbd class="Key--PACKT-">Q</kbd> for macOS and restart it. Given Angular and VS Code's monthly release cycles, I'm confident that in time the tooling will only improve.</li>
      </ul>
    </div>
    <p class="normal">Let's resolve the type mismatch issue by transforming the shape of the data.</p>
    <h1 class="title" id="_idParaDest-106">Transforming data using RxJS</h1>
    <p class="normal">We are <a id="_idIndexMarker265"/>going to use an RxJS reactive pipe (or data stream) to reshape the structure of data coming from the external API to fit the shape of the data we expect within our Angular app. If we don't do this, then our code will fail due to a type mismatch error.</p>
    <p class="normal">Refer to <em class="italics">Chapter 1</em>, <em class="italics">Introduction to Angular and Its Concepts</em>, to get a deeper understanding <a id="_idIndexMarker266"/>of RxJS and reactive programming.</p>
    <h2 class="title" id="_idParaDest-107">Implementing Reactive transformations</h2>
    <p class="normal">To avoid <a id="_idIndexMarker267"/>future mistakes such as returning an unintended type of data from your service, you need to update the <code class="Code-In-Text--PACKT-">getCurrentWeather</code> function to define the return type as <code class="Code-In-Text--PACKT-">Observable&lt;ICurrentWeather&gt;</code> and import the <code class="Code-In-Text--PACKT-">Observable</code> type, as shown:</p>
    <pre class="programlisting"><code class="hljs moonscript"><strong>src/app/weather/weather.service.ts</strong>
<span class="hljs-keyword">import</span> { Observable } <span class="hljs-keyword">from</span> <span class="hljs-string">'rxjs'</span>
<span class="hljs-keyword">import</span> { ICurrentWeather } <span class="hljs-keyword">from</span> <span class="hljs-string">'../interfaces'</span>
...
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WeatherService</span> {</span>
  ...
  getCurrentWeather(<span class="hljs-name">city</span>: <span class="hljs-built_in">string</span>, <span class="hljs-name">country</span>: <span class="hljs-built_in">string</span>): 
    Observable&lt;ICurrentWeather&gt; {
  }
  ...
}
</code></pre>
    <p class="normal">Now, VS Code lets you know that the type <code class="Code-In-Text--PACKT-">Observable&lt;ICurrentWeatherData&gt;</code> is not assignable to the type <code class="Code-In-Text--PACKT-">Observable&lt;ICurrentWeather&gt;</code>:</p>
    <ol>
      <li class="list" value="1">Write a transformation function named <code class="Code-In-Text--PACKT-">transformToICurrentWeather</code> that can convert <code class="Code-In-Text--PACKT-">ICurrentWeatherData</code> to <code class="Code-In-Text--PACKT-">ICurrentWeather</code></li>
      <li class="list">Also, write a helper function named <code class="Code-In-Text--PACKT-">convertKelvinToFahrenheit</code> that converts the API-provided Kelvin temperature to Fahrenheit:
        <pre class="programlisting"><code class="hljs kotlin"><strong>src/app/weather/weather.service.ts</strong>
export <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WeatherService</span> </span>{
...
  <span class="hljs-keyword">private</span> transformToICurrentWeather(<span class="hljs-keyword">data</span>: ICurrentWeatherData): ICurrentWeather {
    <span class="hljs-keyword">return</span> {
      city: <span class="hljs-keyword">data</span>.name,
      country: <span class="hljs-keyword">data</span>.sys.country,
      date: <span class="hljs-keyword">data</span>.dt * <span class="hljs-number">1000</span>,
      image:
`http:<span class="hljs-comment">//openweathermap.org/img/w/${data.weather[0].icon}.png`, </span>
      temperature: <span class="hljs-keyword">this</span>.convertKelvinToFahrenheit(<span class="hljs-keyword">data</span>.main.temp), 
      description: <span class="hljs-keyword">data</span>.weather[<span class="hljs-number">0</span>].description,
    }
  }
  <span class="hljs-keyword">private</span> convertKelvinToFahrenheit(kelvin: number): number
  { 
    <span class="hljs-keyword">return</span> kelvin * <span class="hljs-number">9</span> / <span class="hljs-number">5</span> - <span class="hljs-number">459.67</span>
  }
}
</code></pre>
        <div class="note">
          <p class="Information-Box--PACKT-">Note that you need to be converting the icon property to an image URL at this stage. Doing this in the service helps preserve encapsulation; binding the icon value to <a id="_idIndexMarker268"/>the URL in the View template breaks the <strong class="bold">Separation of Concerns</strong> (<strong class="bold">SoC</strong>) principle. If you wish to create truly modular, reusable, and maintainable components, you must remain vigilant and strict in terms of enforcing SoC. The documentation for Weather Icons and details of how the URL should be formed, including all the available icons, can be found at <a href="http://openweathermap.org/weather-conditions"><span class="url">http://openweathermap.org/weather-conditions</span></a>.</p>
        </div>
        <div class="packt_tip">
          <p>On a separate note, the argument could be made that Kelvin to Fahrenheit conversion is <a id="_idIndexMarker269"/>a View concern, but we have implemented it in the service. This argument holds water, especially considering that we have a planned feature to be able to toggle between Celsius and Fahrenheit. A counter-argument would be that, at this time, we only need to display temperatures in Fahrenheit and it is part of the job of the weather service to be able to convert the units. This argument makes sense as well. The ultimate implementation is to write a custom Angular pipe and apply it in the template. A pipe can easily bind with the planned toggle button as well.</p>
          <p>However, at this time, we only need to display temperatures in Fahrenheit, and I would err on the side of <em class="italics">not</em> over-engineering a solution.</p>
        </div>
      </li>
      <li class="list">Update <code class="Code-In-Text--PACKT-">ICurrentWeather.date</code> to the <code class="Code-In-Text--PACKT-">number</code> type<div class="packt_tip">
          <p>While writing the transformation function, note that the API returns the date as a number. This number represents the amount of time in seconds since the Unix epoch (timestamp), which is January 1, 1970 00:00:00 UTC. However, <code class="Code-In-Text--PACKT-">ICurrentWeather</code> expects a <code class="Code-In-Text--PACKT-">Date</code> object. It is easy enough to convert the timestamp by passing it into the constructor of the <code class="Code-In-Text--PACKT-">Date</code> object like a new <code class="Code-In-Text--PACKT-">Date(data.dt)</code>. This is fine, but also unnecessary since Angular's <code class="Code-In-Text--PACKT-">DatePipe</code> can directly work with the timestamp. In the name of relentless simplicity and maximally leveraging the functionality of the frameworks we use, we update <code class="Code-In-Text--PACKT-">ICurrentWeather</code> to use number. There's also a performance and memory benefit to this approach if you're transforming massive amounts of data, but that concern is not applicable here. There's one caveat—JavaScript's timestamp is in milliseconds, but the server value is in seconds, so a simple multiplication during the transformation is still required.</p>
        </div>
      </li>
      <li class="list">Import <a id="_idIndexMarker270"/>the RxJS <code class="Code-In-Text--PACKT-">map</code> operator right below the other <code class="Code-In-Text--PACKT-">import</code> statements:
        <pre class="programlisting"><code class="hljs livescript"><strong>src/app/weather/weather.service.ts</strong>
<span class="hljs-keyword">import</span> { <span class="hljs-keyword">map</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'rxjs/operators'</span>
</code></pre>
        <div class="note">
          <p class="Information-Box--PACKT-">It may seem odd to have to manually import the <code class="Code-In-Text--PACKT-">map</code> operator. RxJS is a capable framework with a wide API surface. An <code class="Code-In-Text--PACKT-">Observable</code> alone has over 200 methods attached to it. Including all of these methods by default creates development time issues with too many functions to choose from and also negatively impacts the size of the final deliverable, including app performance and memory use. You must add each operator you intend to use individually.</p>
        </div>
      </li>
      <li class="list">Apply the <code class="Code-In-Text--PACKT-">map</code> function to the data stream returned by the <code class="Code-In-Text--PACKT-">httpClient.get</code> method through a <code class="Code-In-Text--PACKT-">pipe</code></li>
      <li class="list">Pass the data object into the <code class="Code-In-Text--PACKT-">transformToICurrentWeather</code> function:
        <pre class="programlisting"><code class="hljs kotlin"><strong>src/app/weather/weather.service.ts</strong>
...
<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.httpClient
  .<span class="hljs-keyword">get</span>&lt;ICurrentWeatherData&gt;(
    `${environment.baseUrl}api.openweathermap.org/<span class="hljs-keyword">data</span>/<span class="hljs-number">2.5</span>/weather`,
    { params: uriParams }
  )
  .pipe(map(<span class="hljs-keyword">data</span> =&gt; <span class="hljs-keyword">this</span>.transformToICurrentWeather(<span class="hljs-keyword">data</span>)))
...
</code></pre>
        <p class="Bullet-Without-Bullet-Within-Bullet--PACKT-">Now incoming data can be transformed as it flows through the stream, ensuring that the <code class="Code-In-Text--PACKT-">OpenWeatherMap</code> Current Weather API data is in the correct shape so that the <code class="Code-In-Text--PACKT-">CurrentWeather</code> component can consume it.</p>
      </li>
      <li class="list">Ensure that your app compiles successfully</li>
      <li class="list">Inspect <a id="_idIndexMarker271"/>the results in the browser:
      <figure class="mediaobject"><img alt="" src="../Images/B14094_03_11.png"/></figure>
      <p class="packt_figref">Figure 3.11: Displaying live data from OpenWeatherMap</p>
      <p class="Bullet-Without-Bullet-Within-Bullet--PACKT-">You should see that your app is able to pull live data from <code class="Code-In-Text--PACKT-">OpenWeatherMap</code> and correctly transform server data into the format you expect.</p>
      <div class="packt_tip">
        <p>You have completed the development of Feature 1: <strong class="bold">Display Current Location weather information for the current day</strong>. Commit your code!</p>
      </div></li>
      <li class="list" value="9">Finally, we can move this task to the <strong class="screen-text">Done</strong> column:
      <figure class="mediaobject"><img alt="" src="../Images/B14094_03_12.png"/></figure>
      <p class="packt_figref">Figure 3.12: GitHub project Kanban board status</p></li>
    </ol>
    <p class="normal">Great work! You're now familiar with the fundamental architecture of Angular. You also started <a id="_idIndexMarker272"/>implementing code in the reactive paradigm by leveraging RxJS.</p>
    <p class="normal">Now let's increase the resiliency of our app by guarding against null or undefined values that can break your application code.</p>
    <h1 class="title" id="_idParaDest-108">Null guarding in Angular</h1>
    <p class="normal">In JavaScript, the <code class="Code-In-Text--PACKT-">undefined</code> and <code class="Code-In-Text--PACKT-">null</code> values are a persistent issue that must be proactively <a id="_idIndexMarker273"/>dealt with every step of the way. This is especially critical when dealing with external APIs and other libraries. If we don't deal with <code class="Code-In-Text--PACKT-">undefined</code> and <code class="Code-In-Text--PACKT-">null</code> values, then your app may present badly rendered views, console errors, issues with business logic, or even a crash of your entire app. </p>
    <p class="normal">There are multiple strategies to guard against null values in Angular:</p>
    <ul>
      <li class="list">Property initialization</li>
      <li class="list">The safe navigation operator, <code class="Code-In-Text--PACKT-">?.</code></li>
      <li class="list">Null guarding with <code class="Code-In-Text--PACKT-">*ngIf</code></li>
    </ul>
    <p class="normal">You may use one or more of these strategies. However, in the next few sections I demonstrate why the <code class="Code-In-Text--PACKT-">*ngIf</code> strategy is the optimal one to use. </p>
    <p class="normal">To simulate the scenario of getting an empty response from the server, go ahead and comment out the <code class="Code-In-Text--PACKT-">getCurrentWeather</code> call in <code class="Code-In-Text--PACKT-">ngOnInit</code> of <code class="Code-In-Text--PACKT-">CurrentWeatherComponent</code>:</p>
    <pre class="programlisting"><code class="hljs stylus"><strong>src/app/current-weather/current-weather<span class="hljs-selector-class">.component</span><span class="hljs-selector-class">.ts</span></strong>
<span class="hljs-function"><span class="hljs-title">ngOnInit</span><span class="hljs-params">()</span></span>: void {
    <span class="hljs-comment">// this.weatherService</span>
    <span class="hljs-comment">//   .getCurrentWeather('Bethesda', 'US')</span>
    <span class="hljs-comment">//   .subscribe(data =&gt; (this.current = data))</span>
}
</code></pre>
    <p class="normal">Let's start with implementing the property initialization strategy to guard against null values.</p>
    <h2 class="title" id="_idParaDest-109">Property initialization</h2>
    <p class="normal">In statically-typed <a id="_idIndexMarker274"/>languages such as Java, it is drilled into you that proper variable initialization/instantiation is the key to error-free operation. So, let's try that in <code class="Code-In-Text--PACKT-">CurrentWeatherComponent</code> by initializing <code class="Code-In-Text--PACKT-">current</code> with default values:</p>
    <pre class="programlisting"><code class="hljs delphi"><strong>src/app/current-weather/current-weather.component.ts</strong>
<span class="hljs-function"><span class="hljs-keyword">constructor</span><span class="hljs-params">(<span class="hljs-keyword">private</span> weatherService: WeatherService)</span> <span class="hljs-comment">{ 
  this.current = {
    city: '',
    country: '', 
    date: 0, 
    image: '',
    temperature: 0, 
    description: '',
  }</span>
}
</span></code></pre>
    <p class="normal">The outcome of these changes reduces the number of console errors from two to zero. However, the app itself is not in a presentable state, as you can see here:</p>
    <figure class="mediaobject"><img alt="" src="../Images/B14094_03_13.png"/></figure>
    <p class="packt_figref">Figure 3.13: Results of property initialization</p>
    <p class="normal">To make this <a id="_idIndexMarker275"/>View presentable to the user, we have to code with default values on every property on the template. So, by fixing the null guarding issue with initialization, we created a default value handling issue. Both the initialization and the default value handling are <em class="italics">O(n)</em> scale tasks for developers. At its best, this strategy is annoying to implement and at its worst, highly ineffective and error-prone, requiring, at a minimum, <em class="italics">O(2n)</em> effort per property.</p>
    <p class="normal">Next, let's learn about Angular's safe navigation operator, which comes in handy when dealing with objects that are external to our application when we can't control which properties may be null or undefined.</p>
    <h2 class="title" id="_idParaDest-110">The safe navigation operator</h2>
    <p class="normal">Angular implements the safe navigation operation, <code class="Code-In-Text--PACKT-">?.</code>, to prevent unintended traversals of undefined <a id="_idIndexMarker276"/>objects. So, instead of writing initialization code and having to deal with template values, we can just update the template.</p>
    <p class="normal">Remove the property initialization code from the constructor and instead update the template as shown:</p>
    <pre class="programlisting"><code class="hljs twig"><strong><span class="xml">src/app/current-weather/current-weather.component.html</span></strong><span class="xml">
<span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span></span><span class="hljs-template-variable">{{current?.city}}</span><span class="xml">, </span><span class="hljs-template-variable">{{current?.country}}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span></span><span class="hljs-template-variable">{{current?.<span class="hljs-name">date</span> | <span class="hljs-name">date</span>:'fullDate'}}</span><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">img</span> [<span class="hljs-attr">src</span>]=<span class="hljs-string">'current?.image'</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span></span><span class="hljs-template-variable">{{current?.temperature}}</span><span class="xml">℉<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    </span><span class="hljs-template-variable">{{current?.description}}</span><span class="xml">
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</span></code></pre>
    <p class="normal">This time, we didn't have to make up defaults, and we let Angular deal with displaying undefined <a id="_idIndexMarker277"/> bindings. The app itself is in somewhat better shape. There's no more confusing data being displayed; however, it still is not in a presentable state, as shown here:</p>
    <figure class="mediaobject"><img alt="" src="../Images/B14094_03_14.png"/></figure>
    <p class="packt_figref">Figure 3.14: Results of using the safe navigation operator</p>
    <p class="normal">You can probably imagine ways in which the safe navigation operator could come in handy, in far more complicated scenarios. However, when deployed at scale, this type of coding still requires, at a minimum, <em class="italics">O(n)</em> level of effort to implement.</p>
    <p class="normal">When presenting data to the user, we don't want to present empty values. The easiest way to clean up the UI would be to leverage the <code class="Code-In-Text--PACKT-">ngIf</code> directive to hide the entire <code class="Code-In-Text--PACKT-">div</code>.</p>
    <h2 class="title" id="_idParaDest-111">Null guarding with *ngIf</h2>
    <p class="normal">The ideal <a id="_idIndexMarker278"/>strategy is to use <code class="Code-In-Text--PACKT-">*ngIf</code>, which is a structural directive, meaning Angular stops traversing DOM tree elements beyond a falsy statement.</p>
    <p class="normal">In the <code class="Code-In-Text--PACKT-">CurrentWeather</code> component, we can easily check to see whether the <code class="Code-In-Text--PACKT-">current</code> variable is null or undefined before attempting to render the template:</p>
    <ol>
      <li class="list" value="1">Undo the implementation of the safe navigation operators from the previous section</li>
      <li class="list">Update the topmost <code class="Code-In-Text--PACKT-">div</code> element with <code class="Code-In-Text--PACKT-">*ngIf</code> to check whether <code class="Code-In-Text--PACKT-">current</code> is an object, as shown:
        <pre class="programlisting"><code class="hljs gams"><strong>src/app/current-weather/current-weather.component.html</strong>
&lt;<span class="hljs-built-in">div</span> *ngIf=<span class="hljs-string">"!current"</span>&gt;
  <span class="hljs-keyword">no</span> data
&lt;/<span class="hljs-built-in">div</span>&gt;
&lt;<span class="hljs-built-in">div</span> *ngIf=<span class="hljs-string">"current"</span>&gt;
...
&lt;/<span class="hljs-built-in">div</span>&gt;
</code></pre>
        <p class="Bullet-Without-Bullet-Within-Bullet--PACKT-">Now observe the console log and that no errors are being reported. You should always ensure that your Angular application reports zero console errors. If you're still seeing errors in the console log, ensure that you have correctly reverted the <code class="Code-In-Text--PACKT-">OpenWeather</code> URL to its correct state or kill and restart your <code class="Code-In-Text--PACKT-">npm start</code> process. I highly recommend that you resolve any console errors before moving on.</p>
      </li>
      <li class="list">Observe that the UI will now show that there's no data:<figure class="mediaobject"><img alt="" src="../Images/B14094_03_15.png"/></figure>
        <p class="packt_figref">Figure 3.15: Results of using null guarding with *ngIf</p>
      </li>
      <li class="list">Re-enable the <code class="Code-In-Text--PACKT-">getCurrentWeather</code> call in <code class="Code-In-Text--PACKT-">ngOnInit</code> of <code class="Code-In-Text--PACKT-">CurrentWeatherComponent</code>:
        <pre class="programlisting"><code class="hljs stylus"><strong>src/app/current-weather/current-weather<span class="hljs-selector-class">.component</span><span class="hljs-selector-class">.ts</span></strong>
<span class="hljs-function"><span class="hljs-title">ngOnInit</span><span class="hljs-params">()</span></span>: void {
  this<span class="hljs-selector-class">.weatherService</span>
      .getCurrentWeather(<span class="hljs-string">'Bethesda'</span>, <span class="hljs-string">'US'</span>)
      .subscribe(data =&gt; (this<span class="hljs-selector-class">.current</span> = data))
}
</code></pre>
      </li>
      <li class="list">Commit your changes.</li>
    </ol>
    <p class="normal">With null guarding, you can ensure that your UI always looks professional.</p>
    <h1 class="title" id="_idParaDest-112">Summary</h1>
    <p class="normal">Congratulations! In this chapter, you created your first Angular application with a flexible architecture while avoiding over-engineering. This was possible because we first built a roadmap and codified it in a Kanban board that is visible to your peers and colleagues. We stayed focused on implementing the first feature we put in progress and didn't deviate from the plan.</p>
    <p class="normal">You learned how to avoid coding mistakes by proactively declaring the input and return types of functions and working with generic functions. You used the date and decimal pipes to ensure that data is formatted as desired while keeping formatting-related concerns mostly in the template, where this kind of logic belongs.</p>
    <p class="normal">Finally, you used interfaces to communicate between components and services without leaking the external data structure to internal components. By applying all these techniques in combination, which Angular, RxJS, and TypeScript allowed us to do, you ensured proper separation of concerns and encapsulation. As a result, the <code class="Code-In-Text--PACKT-">CurrentWeather</code> component is now truly reusable and composable; this is not an easy feat to achieve.</p>
    <p class="normal">If you don't ship it, it never happened. In the next chapter, we'll prepare this Angular app for a production release by troubleshooting application errors, ensuring automated unit and e2e tests pass, and containerizing the Angular app with Docker so that it can be published on the web.</p>
    <h1 class="title" id="_idParaDest-113">Further reading</h1>
    <ul>
      <li class="list"><em class="italics">The Back of the Napkin: Solving Problems and Selling Ideas with Pictures</em>, Dan Roam, 2008.</li>
      <li class="list"><em class="italics">Visual Thinking: Empowering People and Organizations through Visual Collaboration</em>, Williemien Brand, 2017.</li>
      <li class="list"><em class="italics">The Project Cartoon</em>, <a href="http://projectcartoon.com"><span class="url">http://projectcartoon.com</span></a>.</li>
      <li class="list"><em class="italics">Project management, made simple</em>, GitHub, <a href="https://github.com/features/project-management"><span class="url">https://github.com/features/project-management</span></a>.</li>
      <li class="list"><em class="italics">Creating a project board</em>, GitHub, <a href="https://help.github.com/en/articles/creating-a-project-board"><span class="url">https://help.github.com/en/articles/creating-a-project-board</span></a>.</li>
    </ul>
    <h1 class="title" id="_idParaDest-114">Questions</h1>
    <p class="normal">Answer the following questions as best as you can to ensure that you've understood the key concepts from this chapter without Googling. Do you need help answering the questions? See <em class="italics">Appendix D</em>, <em class="italics">Self-Assessment Answers</em> online at <a href="https://static.packt-cdn.com/downloads/9781838648800_Appendix_D_Self-Assessment_Answers.pdf"><span class="url">https://static.packt-cdn.com/downloads/9781838648800_Appendix_D_Self-Assessment_Answers.pdf</span></a> or visit <a href="https://expertlysimple.io/angular-self-assessment"><span class="url">https://expertlysimple.io/angular-self-assessment</span></a>.</p>
    <ol>
      <li class="list">I introduced the concept of a Kanban board. What is it, and what role does a Kanban board play in our software application development?</li>
      <li class="list">What were the different Angular components we generated using the Angular CLI tool to build out our Local Weather app after we initially created it, and what function and role do each of them serve?</li>
      <li class="list">What are the different ways of binding data in Angular?</li>
      <li class="list">Why do we need services in Angular?</li>
      <li class="list">What is an observable in RxJS?</li>
      <li class="list">What is the easiest way to present a clean UI if the data behind your template is falsy?</li>
    </ol>
  </div>
</body></html>