<html><head></head><body>
        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Creating a Chat Component</h1>
                
            
            <article>
                
<p class="calibre2">In this chapter, we will create our chat application in the existing application and take a look at real-time message updates using the Firebase database. We will explain the chat feature in this and the next chapter.</p>
<p class="calibre2">Since we have already created components in the preceding chapter, we will design a more complex component involving multiple components, in this chapter. As per the general rule, we will create this as a module, so we will have the main component as a chat component, and this will contain a message list component, form component, and message component. We will explore more ways of data binding while implementing the chat feature. We will write more complex SCSS in this chapter. We believe that, if<span> you follow this chapter properly, most of the Angular stuff will be clearer to you, and you'll be able to build a more complex component yourself.</span></p>
<p class="calibre2">In this chapter,<span> we will cover the </span>following topics:</p>
<ul class="calibre7">
<li class="calibre8">Creating a chat module </li>
<li class="calibre8">Creating a color variable</li>
<li class="calibre8">Creating a chat component</li>
<li class="calibre8">Creating a chat message list component</li>
<li class="calibre8">Creating a mixin for the message view</li>
<li class="calibre8">Creating a chat message component</li>
<li class="calibre8">Creating a chat message form component</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Creating a chat module</h1>
                
            
            <article>
                
<p class="calibre2">The first step in creating a module is to define the routes and include them in the chat module. In the chat routing module, we create chat routes and configure them in RouterModules.</p>
<p class="calibre2"><span>The following is the complete <kbd class="calibre11">chat-routing.module.ts</kbd> file</span><span>:</span></p>
<pre class="calibre17"><span>import </span>{NgModule} from <span>'@angular/core'</span>;<br class="title-page-name"/><span>import </span>{RouterModule, Routes} from <span>'@angular/router'</span>;<br class="title-page-name"/><span>import </span>{ChatComponent} from <span>'./chat.component'</span>;<br class="title-page-name"/><br class="title-page-name"/><span>export const </span>ROUTES: Routes = [<br class="title-page-name"/>  {path: <span>'app-friends-chat/:id'</span>, component: ChatComponent}<br class="title-page-name"/>];<br class="title-page-name"/><br class="title-page-name"/><span>/**<br class="title-page-name"/></span><span> * Chat Routing Module<br class="title-page-name"/></span><span> */<br class="title-page-name"/></span>@NgModule({<br class="title-page-name"/>  imports: [<br class="title-page-name"/>    RouterModule.forChild(ROUTES)<br class="title-page-name"/>  ],<br class="title-page-name"/>  exports: [<br class="title-page-name"/>    RouterModule<br class="title-page-name"/>  ]<br class="title-page-name"/>})<br class="title-page-name"/><span>export class </span>ChatRoutingModule { }</pre>
<p class="calibre2">The chat module contains a declaration of all the components, modules, and services. In chat features, we have the following four components:</p>
<ul class="calibre7">
<li class="calibre8"><strong class="calibre1">Chat component</strong>: This is the main component, and it encapsulates the message list and message form components.</li>
<li class="calibre8"><strong class="calibre1">Chat message list component</strong>: This is a message list, which displays the messages in the list. It calls the message component for populating the message in the textbox.</li>
<li class="calibre8"><strong class="calibre1">Chat message form component</strong>: This is a form that takes a message as user input and adds the message in the Firebase database.</li>
<li class="calibre8"><strong class="calibre1">Chat message component</strong>: This component displays the user-typed message and the date when the message was posted.</li>
</ul>
<p class="calibre2"><span>The following is the complete <kbd class="calibre11">chat.module.ts</kbd> </span><span>as of now:</span></p>
<pre class="calibre17"><span>import </span>{NgModule} <span>from </span><span>'@angular/core'</span>;<br class="title-page-name"/><span>import </span>{CommonModule} <span>from </span><span>'@angular/common'</span>;<br class="title-page-name"/><span>import </span>{FormsModule} <span>from </span><span>'@angular/forms'</span>;<br class="title-page-name"/><span>import </span>{BrowserModule} <span>from </span><span>'@angular/platform-browser'</span>;<br class="title-page-name"/><span>import </span>{UserService} <span>from </span><span>'../services/user.service'</span>;<br class="title-page-name"/><span>import </span>{ChatMessageComponent} <span>from </span><span>'./chat-message/chat-message.component'</span>;<br class="title-page-name"/><span>import </span>{ChatMessageListComponent} <span>from </span><span>'./chat-message-list/chat-message-list.component'</span>;<br class="title-page-name"/><span>import </span>{ChatMessageFormComponent} <span>from </span><span>'./chat-message-form/chat-message-form.component'</span>;<br class="title-page-name"/><span>import </span>{ChatComponent} <span>from </span><span>'./chat.component'</span>;<br class="title-page-name"/><span>import </span>{ChatRoutingModule} <span>from </span><span>'./chat-routing.module'</span>;<br class="title-page-name"/><br class="title-page-name"/><span>/**<br class="title-page-name"/></span><span> * Chat Module<br class="title-page-name"/></span><span> */<br class="title-page-name"/></span>@<span>NgModule</span>({<br class="title-page-name"/>    <span>imports</span>: [<br class="title-page-name"/>        CommonModule,<br class="title-page-name"/>        BrowserModule,<br class="title-page-name"/>        FormsModule,<br class="title-page-name"/>        ChatRoutingModule<br class="title-page-name"/>    ],<br class="title-page-name"/>    <span>declarations</span>: [<br class="title-page-name"/>        ChatMessageComponent,<br class="title-page-name"/>        ChatMessageListComponent,<br class="title-page-name"/>        ChatMessageFormComponent,<br class="title-page-name"/>        ChatComponent<br class="title-page-name"/>    ],<br class="title-page-name"/>    <span>providers</span>: [<br class="title-page-name"/>        UserService<br class="title-page-name"/>    ]<br class="title-page-name"/>})<br class="title-page-name"/><span>export class </span>ChatModule {<br class="title-page-name"/>}</pre>
<p class="calibre2">Finally, we will include the chat module in the app module, as shown in the following code; h<span>ere's the modified <kbd class="calibre11">app.module.ts</kbd> </span><span>as of now:</span></p>
<pre class="calibre17">...<br class="title-page-name"/>@<span>NgModule</span>({<br class="title-page-name"/>   <span>declarations</span>: [<br class="title-page-name"/>      ...<br class="title-page-name"/>   ],<br class="title-page-name"/>   <span>imports</span>: [<br class="title-page-name"/>      ...<br class="title-page-name"/>      ChatModule,<br class="title-page-name"/>   ],<br class="title-page-name"/>   <span>providers</span>: [<br class="title-page-name"/>      ...<br class="title-page-name"/>   ],<br class="title-page-name"/>   <span>bootstrap</span>: [AppComponent]<br class="title-page-name"/>})<br class="title-page-name"/><span>export class </span>AppModule {<br class="title-page-name"/>}</pre>
<p class="calibre2">Presently, our chat module is part of the main app module. Now, we will implement the components.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Creating a color variable</h1>
                
            
            <article>
                
<p class="calibre2">In this section, we discuss variable support in SCSS. In CSS, we need to declare the color code for each property, and we don't have any mechanism to reuse the same color code in another CSS property:</p>
<pre class="calibre17"><span>#messages </span>{<br class="title-page-name"/>    <span>background-color</span>: <span>#F2F2F2 !important</span>;<br class="title-page-name"/>}</pre>
<p class="calibre2">In our application, we use variables and partials to reuse the same color across the whole application. We declare all colors in a color file using variables as shown in the subsequent code. This file is known as a partial in SCSS and normally declared with an underscore.</p>
<p class="calibre2"><span>The following is the complete <kbd class="calibre11">_colors.scss</kbd> </span><span>as of now:</span></p>
<pre class="calibre17"><span>$mercury_solid</span>:  <span>#e5e5e5</span>;<br class="title-page-name"/><span>$sushi</span>: <span>#8BC34A</span>;<br class="title-page-name"/><span>$concrete_solid</span>: <span>#F2F2F2</span>;<br class="title-page-name"/><span>$iron</span>: <span>#E1E2E3</span>;<br class="title-page-name"/><span>$pickled_bluewood</span>: <span>#2d384a</span>;</pre>
<p class="calibre2">First, we import partials into another SCSS file and then use the variables to access the color. In the following example, we use the <kbd class="calibre11">$concrete_solid</kbd> <span>variable </span>to reuse the color:</p>
<pre class="calibre17"><span>@import </span><span>"../../shared/colors"</span>;<br class="title-page-name"/><br class="title-page-name"/>.<span>chat-message-list-main-container </span>{<br class="title-page-name"/><br class="title-page-name"/>    <span>#messages </span>{<br class="title-page-name"/>        <span>background-color</span>: <span>$concrete_solid </span><span>!important</span>;<br class="title-page-name"/>    }<br class="title-page-name"/>}</pre>
<p class="calibre2">SCSS variables help us to centralize all the colors in a single file so that, when we change the color combination in one file, this reflects in our entire application.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Creating a chat component</h1>
                
            
            <article>
                
<p class="calibre2">Chat component is the main container, and it contains a message list component and message form component.</p>
<p class="calibre2">It uses Bootstrap component to create a message list column view.</p>
<pre class="calibre17"><span>div </span><span>class=</span><span>"chat-main-container"</span><span>&gt;</span><br class="title-page-name"/>    <span>&lt;</span><span>div </span><span>class=</span><span>"main_container"</span><span>&gt;</span><br class="title-page-name"/>        <span>&lt;</span><span>div </span><span>class=</span><span>"col-md-8 col-md-offset-2"</span><span>&gt;</span><br class="title-page-name"/>            ...<br class="title-page-name"/>        <span>&lt;/</span><span>div</span><span>&gt;</span><br class="title-page-name"/>    <span>&lt;/</span><span>div</span><span>&gt;</span><br class="title-page-name"/><span>&lt;/</span><span>div</span><span>&gt;</span></pre>
<p class="calibre2"> Chat template encapsulates the chat message list and chat message form references.</p>
<p class="calibre2"><span>The following is the complete <kbd class="calibre11">chat.component.html</kbd> </span><span>as of now:</span></p>
<pre class="calibre17"><span>div </span><span>class=</span><span>"chat-main-container"</span><span>&gt;</span><br class="title-page-name"/>    <span>&lt;</span><span>div </span><span>class=</span><span>"main_container"</span><span>&gt;</span><br class="title-page-name"/>        <span>&lt;</span><span>div </span><span>class=</span><span>"col-md-8 col-md-offset-2"</span><span>&gt;</span><br class="title-page-name"/>            <span>&lt;</span><span>app-chat-message-list </span><span>[friendUid]=</span><span>"</span><span>uid</span><span>"</span><span>&gt;<br class="title-page-name"/>            &lt;/</span><span>app-chat-message-list</span><span>&gt;</span><br class="title-page-name"/>            <span>&lt;</span><span>app-chat-message-form </span><span>[friendUid]=</span><span>"</span><span>uid</span><span>"</span><span>&gt;<br class="title-page-name"/>            &lt;/</span><span>app-chat-message-form</span><span>&gt;</span><br class="title-page-name"/>        <span>&lt;/</span><span>div</span><span>&gt;</span><br class="title-page-name"/>    <span>&lt;/</span><span>div</span><span>&gt;</span><br class="title-page-name"/><span>&lt;/</span><span>div</span><span>&gt;</span></pre>
<p class="calibre2">We align the main container to the middle of the page using <kbd class="calibre11">margin-top</kbd> and <kbd class="calibre11">margin-left</kbd>, as shown in the following<span> complete <kbd class="calibre11">chat.component.scss</kbd> </span><span>as of now:</span></p>
<pre class="calibre17">.<span>chat-main-container </span>{<br class="title-page-name"/>    <span>margin-top</span>: <span>10</span><span>px</span>;<br class="title-page-name"/>    <span>margin-left</span>: <span>80</span><span>px</span>;<br class="title-page-name"/><br class="title-page-name"/>    <span>p </span>{<br class="title-page-name"/>        <span>font-size</span>: <span>10</span><span>px</span>;<br class="title-page-name"/>    }<br class="title-page-name"/><br class="title-page-name"/>}</pre>
<p class="calibre2">Chat component declares the template, style sheet, and selector. <span>Here's the complete <kbd class="calibre11">chat.component.ts</kbd> </span><span>as of now:</span></p>
<pre class="calibre17"><span>import </span>{Component} <span>from </span><span>'@angular/core'</span>;<br class="title-page-name"/><br class="title-page-name"/>@<span>Component</span>({<br class="title-page-name"/>    <span>selector</span>: <span>'app-friends-chat'</span>,<br class="title-page-name"/>    <span>styleUrls</span>: [<span>'chat.component.scss'</span>],<br class="title-page-name"/>    <span>templateUrl</span>: <span>'chat.component.html'</span>,<br class="title-page-name"/>})<br class="title-page-name"/><span>export class </span>ChatComponent {<br class="title-page-name"/>}</pre>
<p class="calibre2">Chat component provides the layout for other child components.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Creating a chat message list component</h1>
                
            
            <article>
                
<p class="calibre2">The chat message list component displays the message text in a list layout. It calls the message component to populate the message text data and time.</p>
<p class="calibre2">First, we create the list in container <kbd class="calibre11">div</kbd> and tag the message list <kbd class="calibre11">div</kbd> with <kbd class="calibre11">#scrollContainer</kbd>, as this helps scroll the list to the bottom of the chat window when a new message arrives. We read this tag in the component using the <kbd class="calibre11">@ViewChild</kbd> annotation:</p>
<pre class="calibre17"><span>&lt;</span><span>div </span><span>class=</span><span>"chat-message-list-main-container"</span><span>&gt;</span><br class="title-page-name"/>    <span>&lt;</span><span>div </span><span>#scrollContainer class=</span><span>"message-list-container" <br class="title-page-name"/></span><span>     id=</span><span>"messages"</span><span>&gt;</span><br class="title-page-name"/>    ...    <br class="title-page-name"/><span>    &lt;/</span><span>div</span><span>&gt;</span><br class="title-page-name"/><span>&lt;/</span><span>div</span><span>&gt;</span></pre>
<p class="calibre2">Finally, we include the chat message selector and loop the messages. The following is<span> the complete <kbd class="calibre11">chat-message-list.component.html</kbd> </span><span>as of now:</span></p>
<pre class="calibre17"><span>&lt;</span><span>div </span><span>class=</span><span>"chat-message-list-main-container"</span><span>&gt;</span><br class="title-page-name"/>    <span>&lt;</span><span>div </span><span>#scrollContainer class=</span><span>"message-list-container" </span><span>id=</span><span>"messages"</span><span>&gt;</span><br class="title-page-name"/>        <span>&lt;</span><span>app-chat-message </span><span>*ngFor=</span><span>"let </span><span>message</span><span> of </span><span>messages</span><span>;" <br class="title-page-name"/></span><span>         [message]=</span><span>"</span><span>message</span><span>"</span><span>&gt;</span><br class="title-page-name"/>        <span>&lt;/</span><span>app-chat-message</span><span>&gt;</span><br class="title-page-name"/>    <span>&lt;/</span><span>div</span><span>&gt;</span><br class="title-page-name"/><span>&lt;/</span><span>div</span><span>&gt;</span></pre>
<p class="calibre2">In the following HTML <kbd class="calibre11">div</kbd> tag, we include two selectors in our template—we add a class selector and an ID selector:</p>
<pre class="calibre17"><span>&lt;</span><span>div </span><span>#scrollContainer class=</span><span>"message-list-container" </span><span>id=</span><span>"messages"</span><span>&gt;&lt;/div&gt;</span></pre>
<p class="calibre2">We read the ID selector using a hash followed by name of the selector in the SCSS file to style <kbd class="calibre11">background-color</kbd>:</p>
<pre class="calibre17"><span>#messages </span>{<br class="title-page-name"/>    <span>background-color</span>: <span>$concrete_solid </span><span>!important</span>;<br class="title-page-name"/>}</pre>
<p class="calibre2">We use the <kbd class="calibre11">box-shadow</kbd> and <kbd class="calibre11">border-radius</kbd> properties to give elevated looks for our list container:</p>
<pre class="calibre17">.<span>message-list-container </span>{<br class="title-page-name"/>        ...<br class="title-page-name"/>        <span>box-shadow</span>: <span>inset </span><span>0 3</span><span>px </span><span>6</span><span>px </span><span>rgba</span>(<span>0</span>, <span>0</span>, <span>0</span>, <span>.05</span>);<br class="title-page-name"/>        <span>border-radius</span>: <span>8</span><span>px</span>;<br class="title-page-name"/>    }</pre>
<p class="calibre2"><span>Here's the complete <kbd class="calibre11">chat-message-list.component.scss</kbd> </span><span>as of now:</span></p>
<pre class="calibre17">.<span>chat-message-list-main-container </span>{<br class="title-page-name"/><br class="title-page-name"/>    <span>#messages </span>{<br class="title-page-name"/>        <span>background-color</span>: <span>#F2F2F2 !important</span>;<br class="title-page-name"/>    }<br class="title-page-name"/><br class="title-page-name"/>    .<span>message-list-container </span>{<br class="title-page-name"/>        <span>position</span>: <span>relative</span>;<br class="title-page-name"/>        <span>padding</span>: <span>15</span><span>px </span><span>15</span><span>px </span><span>15</span><span>px</span>;<br class="title-page-name"/>        <span>border-color</span>: <span>#e5e5e5 #eee #eee</span>;<br class="title-page-name"/>        <span>border-style</span>: <span>solid</span>;<br class="title-page-name"/>        <span>border-width</span>: <span>1</span><span>px </span><span>0</span>;<br class="title-page-name"/>        <span>background-color</span>: <span>#E1E2E3</span>;<br class="title-page-name"/>        <span>box-shadow</span>: <span>inset </span><span>0 3</span><span>px </span><span>6</span><span>px </span><span>rgba</span>(<span>0</span>, <span>0</span>, <span>0</span>, <span>.05</span>);<br class="title-page-name"/>        <span>height</span>: <span>60</span><span>vh</span>;<br class="title-page-name"/>        <span>overflow-y</span>: <span>scroll</span>;<br class="title-page-name"/>        <span>background-color</span>: <span>#2d384a !important</span>;<br class="title-page-name"/>        <span>border-radius</span>: <span>8</span><span>px</span>;<br class="title-page-name"/>    }<br class="title-page-name"/><br class="title-page-name"/>    <span>p </span>{<br class="title-page-name"/>        <span>font-size</span>: <span>10</span><span>px</span>;<br class="title-page-name"/>    }<br class="title-page-name"/><br class="title-page-name"/>}</pre>
<p class="calibre2">In the chat message list component, we use <kbd class="calibre11">@ViewChild</kbd> to read the scroll container, as follows:</p>
<pre class="calibre17">@<span>ViewChild</span>(<span>'scrollContainer'</span>) <span>private </span><span>scrollContainer</span>: ElementRef</pre>
<p class="calibre2">We then implement <kbd class="calibre11">AfterViewChecked</kbd> in our component to handle the bottom scroll.</p>
<div class="packt_infobox">The life cycle method is called whenever the view of the component is checked  during change detection.</div>
<pre class="calibre17">interface AfterViewChecked{<br class="title-page-name"/>    ngAfterViewChecked: void<br class="title-page-name"/>}</pre>
<p class="calibre2">We override the life cycle method and, after each new message, we scroll the message list to the bottom of the last message. Also, we detect component changes using the <kbd class="calibre11">ChangeDetectorRef</kbd> class. This is required, as w<span>e need to force Angular to check for changes to the component because the scroll event runs outside Angular's zone:</span></p>
<pre class="calibre17"><span>ngAfterViewChecked</span>() {<br class="title-page-name"/>        <span>this</span>.<span>scrollToBottom</span>();<br class="title-page-name"/>        <span>this</span>.cdRef.<span>detectChanges</span>();<br class="title-page-name"/>    }<br class="title-page-name"/><br class="title-page-name"/>    <span>scrollToBottom</span>(): <span>void </span>{<br class="title-page-name"/>        <span>try </span>{<br class="title-page-name"/>            <span>this</span>.<span>scrollContainer</span>.<span>nativeElement</span>.<span>scrollTop </span>=   <br class="title-page-name"/><span>            this</span>.<span>scrollContainer</span>.<span>nativeElement</span>.<span>scrollHeight</span>;<br class="title-page-name"/>        } <span>catch</span>(err) {<br class="title-page-name"/>            <span>console</span>.<span>log</span>(<span>"Error"</span>);<br class="title-page-name"/>        }<br class="title-page-name"/>    }</pre>
<p class="calibre2"><span>Here's the complete <kbd class="calibre11">chat-message-list.component.ts</kbd> </span><span>as of now:</span></p>
<pre class="calibre17"><span>import </span>{AfterViewChecked, ChangeDetectorRef, Component, ElementRef, Input, OnInit, ViewChild} <span>from </span><span>'@angular/core'</span>;<br class="title-page-name"/><br class="title-page-name"/>@<span>Component</span>({<br class="title-page-name"/>    <span>selector</span>: <span>'app-chat-message-list'</span>,<br class="title-page-name"/>    <span>styleUrls</span>: [<span>'chat-message-list.component.scss'</span>],<br class="title-page-name"/>    <span>templateUrl</span>: <span>'chat-message-list.component.html'<br class="title-page-name"/></span>})<br class="title-page-name"/><span>export class </span>ChatMessageListComponent <span>implements </span>OnInit , AfterViewChecked{<br class="title-page-name"/>    @<span>ViewChild</span>(<span>'scrollContainer'</span>) <span>private </span><span>scrollContainer</span>: ElementRef;<br class="title-page-name"/><br class="title-page-name"/>    <span>constructor</span>(<span>private </span>messageService: MessagingService,<br class="title-page-name"/>                <span>private </span>userService: UserService,<br class="title-page-name"/>                <span>private </span>cdRef: ChangeDetectorRef) {<br class="title-page-name"/>    }<br class="title-page-name"/><br class="title-page-name"/>    <span>ngAfterViewChecked</span>() {<br class="title-page-name"/>        <span>this</span>.<span>scrollToBottom</span>();<br class="title-page-name"/>        <span>this</span>.cdRef.<span>detectChanges</span>();<br class="title-page-name"/>    }<br class="title-page-name"/><br class="title-page-name"/>    <span>scrollToBottom</span>(): <span>void </span>{<br class="title-page-name"/>        <span>try </span>{<br class="title-page-name"/>            <span>this</span>.<span>scrollContainer</span>.<span>nativeElement</span>.<span>scrollTop </span>= <br class="title-page-name"/><span>            this</span>.<span>scrollContainer</span>.<span>nativeElement</span>.<span>scrollHeight</span>;<br class="title-page-name"/>        } <span>catch</span>(err) {<br class="title-page-name"/>            <span>console</span>.<span>log</span>(<span>"Error"</span>);<br class="title-page-name"/>        }<br class="title-page-name"/>    }<br class="title-page-name"/><br class="title-page-name"/>}</pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Creating a mixin for the message view</h1>
                
            
            <article>
                
<p class="calibre2">In this section, we will cover SCSS mixins. This feature provides the flexibility to group the CSS properties, and we can reuse this mixin across our application. Just like the class method, we can also provide parameters to make the mixin more flexible.</p>
<p class="calibre2">We will use this mixin in our application to a add message pointer to our chat features. We will declare mixin by prefixing the method name with the <kbd class="calibre11">@mixin</kbd> keyword and add parameters such as <kbd class="calibre11">$rotate</kbd> and <kbd class="calibre11">$skew</kbd>.</p>
<p class="calibre2"><span>We created mixins for our chat messages in <kbd class="calibre11">_shared.scss</kbd></span><span>:</span></p>
<pre class="calibre17"><span>@mixin </span><span>message-pointer</span>(<span>$rotate </span>, <span>$skew</span>) {<br class="title-page-name"/>    <span>transform</span>: <span>rotate</span>(<span>$rotate</span>) <span>skew</span>(<span>$skew</span>);<br class="title-page-name"/>    <span>-moz-transform</span>: <span>rotate</span>(<span>$rotate</span>) <span>skew</span>(<span>$skew</span>);<br class="title-page-name"/>    <span>-ms-transform</span>: <span>rotate</span>(<span>$rotate</span>) <span>skew</span>(<span>$skew</span>);<br class="title-page-name"/>    <span>-o-transform</span>: <span>rotate</span>(<span>$rotate</span>) <span>skew</span>(<span>$skew</span>);<br class="title-page-name"/>    <span>-webkit-transform</span>: <span>rotate</span>(<span>$rotate</span>) <span>skew</span>(<span>$skew</span>);<br class="title-page-name"/>}</pre>
<p class="calibre2">We use this mixin in our message SCSS. First, we need to import the shared SCSS file in our message file and then we use <kbd class="calibre11">@include</kbd> to call the mixin with the parameters.</p>
<p class="calibre2">The following is the sample <kbd class="calibre11">chat-message.component.scss</kbd>:</p>
<pre class="calibre17"><span>@import </span><span>"../../shared/shared"</span>;<br class="title-page-name"/><br class="title-page-name"/>.<span>chat-message-main-container </span>{<br class="title-page-name"/><br class="title-page-name"/>    .<span>message-bubble</span>::<span>before </span>{<br class="title-page-name"/>        ...<br class="title-page-name"/>        <span>@include message-pointer</span>(<span>29</span><span>deg </span>, -<span>35</span><span>deg</span>);<br class="title-page-name"/>        ...<br class="title-page-name"/>    }<br class="title-page-name"/><br class="title-page-name"/>}</pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Creating a chat message component</h1>
                
            
            <article>
                
<p class="calibre2">The message component is the message text container. It displays the message and time. A typical chat has a bubble view layout. We design this view for our chat features. We declare the following three class variables, which we use in the SCSS file:</p>
<ul class="calibre7">
<li class="calibre8"><kbd class="calibre11">message-bubble</kbd>: This selector gives the message bubble view layout</li>
<li class="calibre8"><kbd class="calibre11">class.sender</kbd>: This aligns all the messages from the sender on the left side of the container</li>
<li class="calibre8"><kbd class="calibre11">class.receiver</kbd>: <span>This aligns all the messages from the receiver on the right side of the container</span></li>
</ul>
<p class="calibre2"><span>Here's the complete <kbd class="calibre11">chat-message.component.html</kbd> </span><span>as of now:</span></p>
<pre class="calibre17"><span>&lt;</span><span>div </span><span>class=</span><span>"chat-message-main-container"</span><span>&gt;</span><br class="title-page-name"/>    <span>&lt;</span><span>div </span><span>class=</span><span>"message-bubble" </span><span>[class.receiver]=</span><span>"</span><span>isReceiver</span><span>(</span><span>message</span><span>)" <br class="title-page-name"/></span><span>    [class.sender]=</span><span>"</span><span>isSender</span><span>(</span><span>message</span><span>)"</span><span>&gt;</span><br class="title-page-name"/>        <span>&lt;</span><span>p</span><span>&gt;</span>{{ <span>message</span>.message }}<span>&lt;/</span><span>p</span><span>&gt;</span><br class="title-page-name"/>        <span>&lt;</span><span>div </span><span>class=</span><span>"timestamp"</span><span>&gt;</span><br class="title-page-name"/>            {{ <span>message</span>.timestamp | <span>date</span>:"MM/dd/yy hh:mm a" }}<br class="title-page-name"/>        <span>&lt;/</span><span>div</span><span>&gt;</span><br class="title-page-name"/>    <span>&lt;/</span><span>div</span><span>&gt;</span><br class="title-page-name"/><span>&lt;/</span><span>div</span><span>&gt;</span></pre>
<p class="calibre2">We use a class selector and provide a style to the message box. This consists of the following two major parts:</p>
<ul class="calibre7">
<li class="calibre8"><strong class="calibre1">Message box</strong>: This gives the shadow effect to the view</li>
<li class="calibre8"><strong class="calibre1">Message pointer</strong>: This gives a pointer to the message box</li>
</ul>
<p class="calibre2"><span>Here's the complete <kbd class="calibre11">chat-message.component.scss</kbd> </span><span>as of now:</span></p>
<pre class="calibre17"><span>@import </span><span>"../../shared/shared"</span>;<br class="title-page-name"/><br class="title-page-name"/>.<span>chat-message-main-container </span>{<br class="title-page-name"/><br class="title-page-name"/>    .<span>message-bubble </span>{<br class="title-page-name"/>        <span>background-color</span>: <span>#ffffff</span>;<br class="title-page-name"/>        <span>border-radius</span>: <span>5</span><span>px</span>;<br class="title-page-name"/>        <span>box-shadow</span>: <span>0 0 6</span><span>px </span><span>#B2B2B2</span>;<br class="title-page-name"/>        <span>display</span>: <span>inline-block</span>;<br class="title-page-name"/>        <span>padding</span>: <span>10</span><span>px </span><span>18</span><span>px</span>;<br class="title-page-name"/>        <span>position</span>: <span>relative</span>;<br class="title-page-name"/>        <span>vertical-align</span>: <span>top</span>;<br class="title-page-name"/>        <span>width</span>: <span>400</span><span>px</span>;<br class="title-page-name"/>    }<br class="title-page-name"/><br class="title-page-name"/>    .<span>message-bubble</span>::<span>before </span>{<br class="title-page-name"/>        <span>background-color</span>: <span>#ffffff</span>;<br class="title-page-name"/>        <span>content</span>: <span>"\00a0"</span>;<br class="title-page-name"/>        <span>display</span>: <span>block</span>;<br class="title-page-name"/>        <span>height</span>: <span>16</span><span>px</span>;<br class="title-page-name"/>        <span>position</span>: <span>absolute</span>;<br class="title-page-name"/>        <span>top</span>: <span>11</span><span>px</span>;<br class="title-page-name"/>        <span>@include message-pointer</span>(<span>29</span><span>deg </span>, -<span>35</span><span>deg</span>);<br class="title-page-name"/>        <span>width</span>: <span>20</span><span>px</span>;<br class="title-page-name"/>    }<br class="title-page-name"/><br class="title-page-name"/>    .<span>sender </span>{<br class="title-page-name"/>        <span>display</span>: <span>inherit</span>;<br class="title-page-name"/>        <span>margin</span>: <span>5</span><span>px </span><span>45</span><span>px </span><span>5</span><span>px </span><span>20</span><span>px</span>;<br class="title-page-name"/>    }<br class="title-page-name"/><br class="title-page-name"/>    .<span>sender</span>::<span>before </span>{<br class="title-page-name"/>        <span>box-shadow</span>: -<span>2</span><span>px </span><span>2</span><span>px </span><span>2</span><span>px </span><span>0 </span><span>rgba</span>(<span>178</span>, <span>178</span>, <span>178</span>, <span>.4</span>);<br class="title-page-name"/>        <span>left</span>: -<span>9</span><span>px</span>;<br class="title-page-name"/>    }<br class="title-page-name"/><br class="title-page-name"/>    .<span>receiver </span>{<br class="title-page-name"/>        <span>display</span>: <span>inherit</span>;<br class="title-page-name"/>        <span>margin</span>: <span>5</span><span>px </span><span>20</span><span>px </span><span>5</span><span>px </span><span>170</span><span>px</span>;<br class="title-page-name"/>    }<br class="title-page-name"/><br class="title-page-name"/>    .<span>receiver</span>::<span>before </span>{<br class="title-page-name"/>        <span>box-shadow</span>: <span>2</span><span>px </span>-<span>2</span><span>px </span><span>2</span><span>px </span><span>0 </span><span>rgba</span>(<span>178</span>, <span>178</span>, <span>178</span>, <span>.4</span>);<br class="title-page-name"/>        <span>right</span>: -<span>9</span><span>px</span>;<br class="title-page-name"/>    }<br class="title-page-name"/><br class="title-page-name"/>}</pre>
<p class="calibre2">The message box looks as follows:</p>
<div class="cdpaligncenter"><img src="../images/00029.jpeg" class="calibre53"/></div>
<p class="calibre2">Finally, we write the event method in our component. We retrieve the UID from the saved user in our service and write the logic to recognize the receiver and sender using the UID.</p>
<p class="calibre2"><span>Here's the complete <kbd class="calibre11">chat-message.component.ts</kbd> </span><span>as of now:</span></p>
<pre class="calibre17"><span>import </span>{ChangeDetectionStrategy, Component, Input, OnInit} <span>from </span><span>'@angular/core'</span>;<br class="title-page-name"/><span>import </span>{UserService} <span>from </span><span>'../../services/user.service'</span>;<br class="title-page-name"/><span>import </span>{Message} <span>from </span><span>'../../services/message'</span>;<br class="title-page-name"/><br class="title-page-name"/>@<span>Component</span>({<br class="title-page-name"/>  <span>selector</span>: <span>'app-chat-message'</span>,<br class="title-page-name"/>  <span>styleUrls</span>: [<span>'chat-message.component.scss'</span>],<br class="title-page-name"/>  <span>templateUrl</span>: <span>'chat-message.component.html'</span>,<br class="title-page-name"/>  <span>changeDetection</span>: ChangeDetectionStrategy.<span>OnPush<br class="title-page-name"/></span>})<br class="title-page-name"/><span>export class </span>ChatMessageComponent <span>implements </span>OnInit {<br class="title-page-name"/><br class="title-page-name"/>  @<span>Input</span>() <span>message</span>: Message;<br class="title-page-name"/><br class="title-page-name"/>  <span>uid</span>: <span>string</span>;<br class="title-page-name"/><br class="title-page-name"/>  <span>constructor</span>(<span>private </span>userService: UserService) {<br class="title-page-name"/>  }<br class="title-page-name"/><br class="title-page-name"/>  <span>ngOnInit</span>() {<br class="title-page-name"/>    <span>this</span>.<span>uid </span>= <span>this</span>.userService.<span>getSavedUser</span>().<span>getValue</span>().<span>uid</span>;<br class="title-page-name"/>  }<br class="title-page-name"/><br class="title-page-name"/>  <span>isReceiver</span>(message: Message) {<br class="title-page-name"/>    <span>return this</span>.<span>uid </span>=== message.<span>receiverUid</span>;<br class="title-page-name"/>  }<br class="title-page-name"/><br class="title-page-name"/>  <span>isSender</span>(message: Message) {<br class="title-page-name"/>    <span>return this</span>.<span>uid </span>=== message.<span>senderUid</span>;<br class="title-page-name"/>  }<br class="title-page-name"/><br class="title-page-name"/>}</pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Creating a chat message form component</h1>
                
            
            <article>
                
<p class="calibre2">In the chat message form component, we implement the message form to send the message to Firebase and update the list with a new message.</p>
<p class="calibre2">For these actions, we will require the following two elements:</p>
<ul class="calibre7">
<li class="calibre8"><strong class="calibre1">Input with a text area</strong>: The input text allows a user to type their message. We use <kbd class="calibre11">(key.enter)</kbd> in the input text to handle the keyboard's <em class="calibre16">Enter</em> key, and this calls the <kbd class="calibre11">sendMessage()</kbd> method.</li>
<li class="calibre8"><strong class="calibre1">Send button</strong>: This calls the <kbd class="calibre11"><span><span>sendMessage()</span></span></kbd> method and updates the Firebase database.</li>
</ul>
<p class="calibre2"><span>Here's the complete <kbd class="calibre11">chat-message-form.component.html</kbd> </span><span>as of now:</span></p>
<pre class="calibre17"><span>&lt;</span><span>div </span><span>class=</span><span>"chat-message-form-main-container"</span><span>&gt;</span><br class="title-page-name"/>    <span>&lt;</span><span>div </span><span>class=</span><span>"chat-message-form-container"</span><span>&gt;</span><br class="title-page-name"/>        <span>&lt;</span><span>input </span><span>type=</span><span>"textarea" </span><span>placeholder=</span><span>"Type a message" <br class="title-page-name"/></span><span>         class=</span><span>"message-text" </span><span>[(ngModel)]=</span><span>"</span><span>newMessage</span><span>" <br class="title-page-name"/></span><span>         (keyup.enter)=</span><span>"</span><span>sendMessage</span><span>()"</span><span>&gt;</span><br class="title-page-name"/>        <span>&lt;</span><span>button </span><span>(click)=</span><span>"</span><span>sendMessage</span><span>()" <br class="title-page-name"/></span><span>         class=</span><span>"btn btn-outline-success my-2 my-sm-0" <br class="title-page-name"/></span><span>         type=</span><span>"submit"</span><span>&gt;</span>SEND<span>&lt;/</span><span>button</span><span>&gt;</span><br class="title-page-name"/>    <span>&lt;/</span><span>div</span><span>&gt;</span><br class="title-page-name"/><span>&lt;/</span><span>div</span><span>&gt;</span></pre>
<p class="calibre2">We use the <kbd class="calibre11">chat-message-form-container</kbd> class selector to style the border with <kbd class="calibre11">border-radius</kbd> and the <kbd class="calibre11">message-text</kbd> to style input text-related properties.</p>
<p class="calibre2"><span>Here's the complete <kbd class="calibre11">chat-message-form.component.scss</kbd> file </span><span>as of now:</span></p>
<pre class="calibre17"><span>@import </span><span>"../../shared/colors"</span>;<br class="title-page-name"/><br class="title-page-name"/>.<span>chat-message-form-main-container </span>{<br class="title-page-name"/><br class="title-page-name"/>    .<span>chat-message-form-container </span>{<br class="title-page-name"/>        <span>padding</span>: <span>9</span><span>px </span><span>50</span><span>px</span>;<br class="title-page-name"/>        <span>margin-bottom</span>: <span>14</span><span>px</span>;<br class="title-page-name"/>        <span>background-color</span>: <span>#f7f7f9</span>;<br class="title-page-name"/>        <span>border</span>: <span>1</span><span>px solid </span><span>#e1e1e8</span>;<br class="title-page-name"/>        <span>border-radius</span>: <span>4</span><span>px</span>;<br class="title-page-name"/><br class="title-page-name"/>        .<span>message-text </span>{<br class="title-page-name"/>            <span>display</span>: <span>block</span>;<br class="title-page-name"/>            <span>padding</span>: <span>9.5</span><span>px</span>;<br class="title-page-name"/>            <span>margin</span>: <span>0 0 10</span><span>px</span>;<br class="title-page-name"/>            <span>font-size</span>: <span>13</span><span>px</span>;<br class="title-page-name"/>            <span>line-height</span>: <span>1.42857143</span>;<br class="title-page-name"/>            <span>color</span>: <span>#333</span>;<br class="title-page-name"/>            <span>word-break</span>: <span>break-all</span>;<br class="title-page-name"/>            <span>word-wrap</span>: <span>break-word</span>;<br class="title-page-name"/>            <span>background-color</span>: <span>#ffffff</span>;<br class="title-page-name"/>            <span>border</span>: <span>1</span><span>px solid </span><span>$sushi</span>;<br class="title-page-name"/>            <span>border-radius</span>: <span>4</span><span>px</span>;<br class="title-page-name"/>            <span>width</span>: <span>100</span>%;<br class="title-page-name"/>        }<br class="title-page-name"/>    }<br class="title-page-name"/>}</pre>
<p class="calibre2">In the chat message form component, we retrieve the UID from the user object saved in the user service.</p>
<p class="calibre2"><span>The following is the complete <kbd class="calibre11">chat-message-form.component.ts</kbd> file </span><span>as of now:</span></p>
<pre class="calibre17"><span>import </span>{ Component, OnInit, Input } <span>from </span><span>'@angular/core'</span>;<br class="title-page-name"/><span>import </span>{ Observable } <span>from </span><span>'rxjs/Observable'</span>;<br class="title-page-name"/><span>import </span>{MessagingService} <span>from </span><span>'../../services/messaging.service'</span>;<br class="title-page-name"/><span>import </span>{Message} <span>from </span><span>'../../services/message'</span>;<br class="title-page-name"/><span>import </span>{UserService} <span>from </span><span>'../../services/user.service'</span>;<br class="title-page-name"/><br class="title-page-name"/>@<span>Component</span>({<br class="title-page-name"/>  <span>selector</span>: <span>'chat-message-form'</span>,<br class="title-page-name"/>    <span>styleUrls</span>: [<span>'chat-message-form.component.scss'</span>],<br class="title-page-name"/>    <span>templateUrl</span>: <span>'chat-message-form.component.html'<br class="title-page-name"/></span>})<br class="title-page-name"/><span>export class </span>ChatMessageFormComponent <span>implements </span>OnInit {<br class="title-page-name"/><br class="title-page-name"/>  <span>uid</span>: <span>string</span>;<br class="title-page-name"/><br class="title-page-name"/>  <span>newMessage</span>: <span>string</span>;<br class="title-page-name"/><br class="title-page-name"/>  <span>constructor</span>(<span>private </span>messageService: MessagingService,<br class="title-page-name"/>              <span>private </span>userService: UserService) { }<br class="title-page-name"/><br class="title-page-name"/>  <span>ngOnInit</span>() {<br class="title-page-name"/>      <span>this</span>.<span>uid </span>= <span>this</span>.userService.<span>getSavedUser</span>().<span>getValue</span>().<span>getUid</span>();<br class="title-page-name"/>  }<br class="title-page-name"/><br class="title-page-name"/>   <span>sendMessage</span>() {<br class="title-page-name"/>  }<br class="title-page-name"/><br class="title-page-name"/>}</pre>
<p class="calibre2">Finally, our chat feature will look as follows:</p>
<div class="cdpaligncenter"><img src="../images/00030.jpeg" class="calibre54"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Summary</h1>
                
            
            <article>
                
<p class="calibre2">In this chapter, we designed a more complex UI component using multiple components. We implemented a chat module and integrated it with the main application. We covered new SCSS features such as variables, partials, and mixins. This really helped us to modularize our code and showed how reusability can be achieved in SCSS. We divided a big chat component into smaller components and then integrated these small components.</p>
<p class="calibre2">In the next chapter, we will integrate our component with the services. We will design our Firebase database for our chat application. Then, we will subscribe the real-time database and get instant updates.</p>


            </article>

            
        </section>
    </body></html>