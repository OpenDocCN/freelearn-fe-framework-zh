- en: '*Chapter 8*: Web Analytics and Performance Monitoring'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '*第8章*：网站分析和性能监控'
- en: In this chapter, we will investigate ways in which we can monitor the behavior
    of our application and the users who visit it. We will learn how page analytics
    can be a valuable tool in helping create better user experiences. We will learn
    how to use two different tools to gather these page insights, depending on what
    we require. We will learn what is required of us legally when using these tools.
    We will also implement plugins that allow us to debug errors that our users encounter
    when using our site.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将探讨我们可以监控我们应用程序和访问它的用户行为的方法。我们将学习页面分析如何成为帮助创造更好用户体验的有价值工具。我们将学习如何使用两种不同的工具来收集这些页面洞察，具体取决于我们的需求。我们将学习在使用这些工具时我们在法律上需要做什么。我们还将实现插件，使我们能够调试用户在使用我们的网站时遇到的错误。
- en: By the end of this chapter, you should feel confident that you can gather different
    types of analytics and use them to inform yourself (or the site owner) about how
    code changes have affected the user experience.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 到本章结束时，你应该有信心能够收集不同类型的分析，并使用它们来了解自己（或网站所有者）关于代码更改如何影响用户体验的信息。
- en: 'In this chapter, we will cover the following topics:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将涵盖以下主题：
- en: Introducing website analytics
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 介绍网站分析
- en: Implementing page analytics
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 实现页面分析
- en: Monitoring the performance of your site
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 监控您网站的性能
- en: Technical requirements
  id: totrans-7
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: To complete this chapter, you will need to have completed [*Chapter 7*](B15983_07_ePub_RK.xhtml#_idTextAnchor105),
    *Testing and Auditing Your Site*.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 要完成本章，您需要完成[*第7章*](B15983_07_ePub_RK.xhtml#_idTextAnchor105)，*测试和审计您的网站*。
- en: The code for this chapter can be found at [https://github.com/PacktPublishing/Elevating-React-Web-Development-with-Gatsby-4/tree/main/Chapter08](https://github.com/PacktPublishing/Elevating-React-Web-Development-with-Gatsby-4/tree/main/Chapter08).
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 本章的代码可以在[https://github.com/PacktPublishing/Elevating-React-Web-Development-with-Gatsby-4/tree/main/Chapter08](https://github.com/PacktPublishing/Elevating-React-Web-Development-with-Gatsby-4/tree/main/Chapter08)找到。
- en: Introducing website analytics
  id: totrans-10
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 介绍网站分析
- en: 'Website analytics is the act of collecting, aggregating, analyzing, and reporting
    a website''s data. Let''s break website analytics down into two categories:'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 网站分析是收集、汇总、分析和报告网站数据的行为。让我们将网站分析分为两个类别：
- en: '**Page analytics**: Analytics we gather about how users interact with our website.
    This could be page views, click rates, or bounce rates, for example.'
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**页面分析**：我们收集的有关用户如何与我们的网站互动的分析。例如，这可能包括页面浏览量、点击率或跳出率。'
- en: '**Performance Monitoring**: Analytics we gather on how our code performs for
    our users. This is primarily used for logging errors in our JavaScript that our
    users encounter.'
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**性能监控**：我们收集的关于我们的代码如何为用户表现的分析。这主要用于记录用户遇到的JavaScript错误。'
- en: Regardless of the category, they all work in a similar way. First, an inserted
    `script` tag loads a small amount of JavaScript into the page. This code is run
    in the web browser of anyone visiting the site. In most cases, the code drops
    a small text file with small pieces of data known as cookies onto the users' browsers.
    This data is used to identify the user session. This is sent back to the analytics
    tool, along with request information, to identify the user and the event that
    is being tracked.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 无论类别如何，它们都以类似的方式工作。首先，插入的`script`标签将一小部分JavaScript加载到页面中。这段代码在访问网站的任何人的网络浏览器中运行。在大多数情况下，代码会在用户的浏览器上留下一个包含少量数据的文本文件，这些数据被称为cookies。这些数据用于识别用户会话。这些数据连同请求信息一起发送回分析工具，以识别用户和正在跟踪的事件。
- en: You've collected all this data – now what? By looking at aggregated users' data,
    we can gain insights into how our users are behaving. This information is the
    most powerful ally you can have when you're trying to improve your user experience.
    You can use these reports to identify trends in the kind of content your users
    like or pages where users most often leave your application, for example.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 您已经收集了所有这些数据——接下来是什么？通过查看汇总的用户数据，我们可以深入了解用户的行为。当您试图改善用户体验时，这些信息是您最强大的盟友。您可以使用这些报告来识别用户喜欢的内容类型趋势或用户最常离开您的应用程序的页面等。
- en: Now, let's take a moment to talk about privacy concerns when gathering user
    data.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们花点时间来谈谈收集用户数据时的隐私问题。
- en: Privacy
  id: totrans-17
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 隐私
- en: Regardless of what data you intend on collecting, it is always important to
    consider the privacy of your users. A published and publicly accessible privacy
    policy is a legal requirement if you intend to store, transfer, or handle a user's
    personal information. It is also the case that the popular analytics providers,
    including *Google Analytics*, specify in their terms of service that if you are
    using their service, you must publish a privacy policy. If you do not, you are
    in breach of your contract with them and are using the tool illegally.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 无论你打算收集什么数据，考虑用户的隐私总是很重要的。如果你打算存储、转移或处理用户的个人信息，公开并可供公众访问的隐私政策是一项法律要求。同样，流行的分析服务提供商，包括
    *Google Analytics*，在其服务条款中规定，如果你使用他们的服务，你必须发布隐私政策。如果不这样做，你就违反了与他们的合同，并且非法使用工具。
- en: In addition to a privacy policy, it is also a good idea to have a cookies policy,
    if your website has visitors from Europe. As of 2018, the European Union state
    that you are required to get "clear, informed consent" from your users to use
    cookies. This normally takes the form of a banner that you display to users on
    their first visit to your site.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 除了隐私政策之外，如果你的网站有来自欧洲的访客，拥有一个cookie政策也是一个好主意。截至2018年，欧盟规定你必须从用户那里获得“明确、知情”的同意才能使用cookie。这通常以横幅的形式出现，你在用户首次访问你的网站时向他们展示。
- en: Now that we understand what website analytics is, let's turn our attention to
    how we can implement the first type of them – page analytics.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 既然我们已经了解了网站分析是什么，让我们转向如何实现它们的第一种类型——页面分析。
- en: Implementing page analytics
  id: totrans-21
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 实现页面分析
- en: 'There is a multitude of tools you can use to perform page analytics. In this
    book, we are going to look at the following two:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 你可以使用许多工具来执行页面分析。在这本书中，我们将探讨以下两个：
- en: Google Analytics
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Google Analytics
- en: Fathom Analytics
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Fathom Analytics
- en: '**Google Analytics** is the world''s leader in page analytics. More than half
    of all websites on the web use this tool. One of the reasons for its popularity
    is its age as it has been around since 2005\. When it was launched, there wasn''t
    much competition in the analytics space. Another reason for its popularity is
    that it''s free. It''s important to remember that if you are using a free tool
    or site, it is often the case that your data is the product. If you are concerned
    about your privacy and that of your site visitors, then perhaps Fathom Analytics
    is a better choice.'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: '**Google Analytics** 是页面分析的世界领导者。超过一半的网站都在使用这个工具。其受欢迎的原因之一是其历史，它自2005年以来一直存在。当它推出时，分析领域几乎没有竞争。另一个原因是它是免费的。重要的是要记住，如果你使用的是免费工具或网站，你的数据往往是产品。如果你对你的隐私以及网站访客的隐私感到担忧，那么Fathom
    Analytics可能是一个更好的选择。'
- en: Unlike Google, **Fathom Analytics** does not track personal data. For example,
    when a page view is logged, it only tells you it was visited, but not by who specifically.
    Fathom's script is cookie-free, which means that you do not need a cookie policy
    or cookie consent banner. As Fathom is determined to collect as little personal
    information as possible, your privacy policy can also be considerably shorter.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 与Google不同，**Fathom Analytics** 不跟踪个人数据。例如，当页面访问被记录时，它只会告诉你有人访问了，但不会告诉你具体是谁。Fathom的脚本不使用cookie，这意味着你不需要cookie政策或cookie同意横幅。由于Fathom致力于尽可能少地收集个人信息，你的隐私政策也可以相对简短。
- en: Important Note
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: Only implement one of the page analytics tools mentioned in this section. Having
    multiple scripts that accomplish the same thing is only going to make your page
    heavier.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 只需实现本节中提到的页面分析工具之一。拥有多个执行相同任务的脚本只会使你的页面更重。
- en: We will discuss how to implement both page analytics tools in the following
    sections. Let's start with Google Analytics.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在以下章节中讨论如何实现两种页面分析工具。让我们从Google Analytics开始。
- en: Adding Google Analytics
  id: totrans-30
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 添加Google Analytics
- en: 'To start tracking data within our Gatsby site, we will need to obtain a measurement
    ID from Google Analytics. Let''s do this by following these steps:'
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 要开始跟踪我们Gatsby网站内的数据，我们需要从Google Analytics获取一个测量ID。让我们按照以下步骤进行：
- en: Navigate to [https://analytics.google.com/analytics/web/?authuser=0#/provision/create](https://analytics.google.com/analytics/web/?authuser=0#/provision/create)
    from your browser.
  id: totrans-32
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从你的浏览器导航到 [https://analytics.google.com/analytics/web/?authuser=0#/provision/create](https://analytics.google.com/analytics/web/?authuser=0#/provision/create)。
- en: Give your account an **Account name** and enter your **Account Data Sharing
    Settings** preferences:![Figure 8.1 – Google Analytics account setup
  id: totrans-33
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为您的账户提供一个 **账户名称** 并输入您的 **账户数据共享设置** 偏好：![图 8.1 – Google Analytics 账户设置
- en: '](img/Figure_8.01_B15983.jpg)'
  id: totrans-34
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '](img/Figure_8.01_B15983.jpg)'
- en: Figure 8.1 – Google Analytics account setup
  id: totrans-35
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 8.1 – Google Analytics 账户设置
- en: The name is specific to a project, so call it something relevant. Pay attention
    to the data sharing options – only ever share with Google what you're comfortable
    sharing.
  id: totrans-36
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 名称是特定于项目的，所以给它取一个相关的名字。注意数据共享选项 – 只分享你感到舒适分享给 Google 的信息。
- en: Set up a property by entering a **Property name**, **Reporting time zone** (region),
    and **Currency**:![Figure 8.2 – Google Analytics property setup
  id: totrans-37
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过输入 **属性名称**、**报告时区**（区域）和 **货币** 来设置一个属性：![图 8.2 – Google Analytics 属性设置
- en: '](img/Figure_8.02_B15983.jpg)'
  id: totrans-38
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '](img/Figure_8.02_B15983.jpg)'
- en: Figure 8.2 – Google Analytics property setup
  id: totrans-39
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 8.2 – Google Analytics 属性设置
- en: This property is specific to your website or app. In our case, this will be
    used to reference analytics from our Gatsby site, so a name such as **personal-website**
    or **my-website** would be appropriate.
  id: totrans-40
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 此属性特定于你的网站或应用程序。在我们的例子中，这将用于引用 Gatsby 网站的分析，所以像 **personal-website** 或 **my-website**
    这样的名字是合适的。
- en: Fill out the business information that Google requires and submit the form.
    You will then be presented with the following screen:![Figure 8.3 – Google Analytics
    dashboard
  id: totrans-41
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 填写 Google 所需的商业信息并提交表格。然后，你将看到以下屏幕：![图 8.3 – Google Analytics 仪表板
- en: '](img/Figure_8.03_B15983.jpg)'
  id: totrans-42
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '](img/Figure_8.03_B15983.jpg)'
- en: Figure 8.3 – Google Analytics dashboard
  id: totrans-43
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 8.3 – Google Analytics 仪表板
- en: This is your first look at the Google Analytics dashboard. Before we can start
    leveraging its power, we will need to set up our first data stream.
  id: totrans-44
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 这是您第一次看到 Google Analytics 仪表板。在我们能够开始利用其功能之前，我们需要设置我们的第一个数据流。
- en: Select **Web** under the **Choose a platform** heading. This will open the following
    screen:![Figure 8.4 – Google Analytics web stream setup
  id: totrans-45
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在 **选择平台** 下选择 **Web**。这将打开以下屏幕：![图 8.4 – Google Analytics 网站流设置
- en: '](img/Figure_8.04_B15983.jpg)'
  id: totrans-46
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '](img/Figure_8.04_B15983.jpg)'
- en: Figure 8.4 – Google Analytics web stream setup
  id: totrans-47
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 8.4 – Google Analytics 网站流设置
- en: Enter your website address under **URL** and **name** your web stream. Finally,
    submit the form by clicking **Create stream**. This will bring up the details
    of our newly created stream.
  id: totrans-48
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在 **URL** 下输入你的网站地址，并为你的网站流 **命名**。最后，通过点击 **创建流** 提交表格。这将显示我们新创建的流的详细信息。
- en: Make a note of the stream's measurement ID.
  id: totrans-49
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 记录流量的测量 ID。
- en: 'Now that we have obtained the measurement ID, let''s turn our attention to
    our Gatsby site repository and use it to start gathering site statistics:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经获得了测量 ID，让我们将注意力转向我们的 Gatsby 网站仓库，并使用它开始收集网站统计信息：
- en: 'Install the necessary dependencies:'
  id: totrans-51
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装必要的依赖项：
- en: '[PRE0]'
  id: totrans-52
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Include the `gatsby-plugin-google-gtag` plugin in your `gatsby-config.js` file:'
  id: totrans-53
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在你的 `gatsby-config.js` 文件中包含 `gatsby-plugin-google-gtag` 插件：
- en: '[PRE1]'
  id: totrans-54
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'By including this plugin in your configuration, Gatsby will append the required
    Google Analytics script to the body of your application. The plugin comes with
    plenty of options, all of which can be found here: [https://www.npmjs.com/package/gatsby-plugin-google-gtag](https://www.npmjs.com/package/gatsby-plugin-google-gtag).'
  id: totrans-55
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 通过在你的配置中包含此插件，Gatsby 将将所需的 Google Analytics 脚本附加到你的应用程序的主体中。该插件提供了许多选项，所有这些选项都可以在这里找到：[https://www.npmjs.com/package/gatsby-plugin-google-gtag](https://www.npmjs.com/package/gatsby-plugin-google-gtag)。
- en: It's important to draw attention to the `anonymize_ip` gtag configuration option.
    Anonymizing the IP is a legal requirement in some countries, such as Germany.
    Without any additional configuration, the plugin will automatically send a page
    view event whenever your site's route changes.
  id: totrans-56
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 重要的是要注意 `anonymize_ip` gtag 配置选项。在某些国家，如德国，匿名化 IP 是法律要求。在不进行任何额外配置的情况下，插件将自动发送页面浏览事件，每当你的网站路由发生变化时。
- en: This is a great start, but you will most likely also want to track other events
    on your site. Let's look at how we can track custom events and outbound links.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 这是一个很好的开始，但你很可能会还想跟踪你网站上其他的事件。让我们看看我们如何跟踪自定义事件和外部链接。
- en: Custom events
  id: totrans-58
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 自定义事件
- en: There are plenty more ways to track user engagement than just page views. Websites
    today are becoming more and more interactive, so being able to track interaction
    can be very useful. We can achieve this within Google Analytics by using custom
    events. Let's look at an example of using a button click.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 除了页面浏览量之外，还有许多其他方式可以跟踪用户参与度。今天的网站越来越互动，因此能够跟踪交互非常有用。我们可以通过使用自定义事件在 Google Analytics
    中实现这一点。让我们看看使用按钮点击的例子。
- en: 'Let''s assume we have a simple button component:'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 假设我们有一个简单的按钮组件：
- en: '[PRE2]'
  id: totrans-61
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'To track a click of this button, we can utilize the `gtag` function, which
    is exposed in the window via the plugin:'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 要跟踪这个按钮的点击，我们可以利用 `gtag` 函数，该函数通过插件暴露在窗口中：
- en: '[PRE3]'
  id: totrans-63
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: In the previous code block, you can see that within `onClick`, we call a `track`
    function. This function calls the `window.gtag` function conditionally, if `window`
    is defined. We need to perform this check as the function does not work when it's
    rendered on the server side.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的代码块中，您可以看到在 `onClick` 中，我们调用了一个 `track` 函数。这个函数有条件地调用 `window.gtag` 函数，如果
    `window` 被定义。我们需要执行这个检查，因为这个函数在服务器端渲染时不起作用。
- en: Important Note
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 重要提示
- en: This plugin is for production use only. This means that any events that take
    place while you are working on the project in development will not be tracked.
    To test that the plugin is working correctly, you will need to build and serve
    the site.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 此插件仅用于生产使用。这意味着在您在开发项目中工作时发生的任何事件都不会被跟踪。为了测试插件是否正常工作，您需要构建并托管网站。
- en: Now that we understand how custom events work, let's look at how we can track
    people leaving our site via outbound links.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经了解了自定义事件是如何工作的，让我们看看我们如何跟踪通过外部链接离开我们网站的人。
- en: Outbound links
  id: totrans-68
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 外部链接
- en: 'It can be useful to understand where and when users navigate away from your
    site. Perhaps you reference another developer''s site within a blog post and users
    leave to visit that site? To track this kind of outbound traffic, the `gatsby-plugin-google-gtag`
    plugin contains a ready-made component – `OutboundLink`. Let''s see how we can
    use it:'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 了解用户何时以及从哪里离开您的网站可能很有用。也许您在博客文章中引用了另一位开发者的网站，用户离开去访问那个网站？为了跟踪这种外部流量，`gatsby-plugin-google-gtag`
    插件包含一个现成的组件 – `OutboundLink`。让我们看看我们如何使用它：
- en: '[PRE4]'
  id: totrans-70
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: As you should be able to see in this example, we can use the `OutboundLink`
    component as a direct drop-in replacement for an `a` tag. As its name suggests,
    you should only use this component for outbound links. If the link is internal,
    you should be using Gatsby's `Link` component.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 正如您在这个示例中应该能看到的那样，我们可以使用 `OutboundLink` 组件作为 `a` 标签的直接替换。正如其名称所暗示的，您应该只为此组件使用外部链接。如果链接是内部链接，您应该使用
    Gatsby 的 `Link` 组件。
- en: Google Analytics is a great way to track your site's page analytics, but there
    is also a multitude of other tools you can use for this purpose. Let's look at
    an alternative – Fathom Analytics.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: Google Analytics 是跟踪您网站页面分析的一个很好的方式，但还有许多其他工具您可以用来实现这个目的。让我们看看一个替代方案 – Fathom
    Analytics。
- en: Using Fathom Analytics
  id: totrans-73
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用 Fathom 分析
- en: 'Fathom Analytics is marketed as a privacy-focused alternative to Google. Google
    Analytics collects an abundance of data when users browse your site, but Fathom
    suggests that the information that is acquired is too much. Fathom collects only
    what they need to create their one-page stats dashboard. Unlike Google, Fathom
    is not free and starts at $14 per month. To start tracking data within our Gatsby
    site, we will need to obtain a site ID from Fathom Analytics. Let''s do this now
    by following these steps:'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: Fathom Analytics 被宣传为 Google 的隐私关注替代品。当用户浏览您的网站时，Google Analytics 会收集大量数据，但
    Fathom 建议获得的信息太多。Fathom 只收集他们创建单页统计仪表板所需的信息。与 Google 不同，Fathom 不是免费的，起价为每月 $14。为了在我们的
    Gatsby 网站中开始跟踪数据，我们需要从 Fathom Analytics 获得一个网站 ID。让我们现在按照以下步骤进行：
- en: Navigate to [https://usefathom.com](https://usefathom.com) from your browser
    and create an account. You will need to sign up with a credit card, but you will
    receive a 7-day free trial.
  id: totrans-75
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用浏览器导航到 [https://usefathom.com](https://usefathom.com) 并创建一个账户。您需要使用信用卡注册，但您将获得
    7 天的免费试用。
- en: Upon account creation, you should be prompted to create a new site:![Figure
    8.5 – Fathom dashboard
  id: totrans-76
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在创建账户后，您应该会被提示创建一个新的网站：![Figure 8.5 – Fathom 仪表板
- en: '](img/Figure_8.05_B15983.jpg)'
  id: totrans-77
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '![Figure 8.05_B15983.jpg](img/Figure_8.05_B15983.jpg)'
- en: Figure 8.5 – Fathom dashboard
  id: totrans-78
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: Figure 8.5 – Fathom 仪表板
- en: Give your site an appropriate name. A name such as **personal-website** would
    be appropriate. Click **Create site**.
  id: totrans-79
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 给您的网站起一个合适的名字。例如，**personal-website** 就是一个合适的选择。点击 **创建网站**。
- en: 'Upon submission, you will be presented with your **Site ID** and embeddable
    code for a multitude of frameworks, including Gatsby:'
  id: totrans-80
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 提交后，您将获得您的 **网站 ID** 和适用于多种框架的嵌入代码，包括 Gatsby：
- en: '![Figure 8.6 – Fathom embed code'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 8.6 – Fathom 嵌入代码](img/Figure_8.06_B15983.jpg)'
- en: '](img/Figure_8.06_B15983.jpg)'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 8.6 – Fathom 嵌入代码](img/Figure_8.06_B15983.jpg)'
- en: Figure 8.6 – Fathom embed code
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 图 8.6 – Fathom 嵌入代码
- en: I suggest that you *do not* follow the instructions they provide you with for
    Gatsby. Why? Because their instructions suggest modifying the component that Gatsby
    uses to server render `head` and other parts of the HTML outside of Gatsby. There
    is no guarantee that Gatsby will keep this file consistent between versions, so
    meddling with it might make upgrading it difficult later down the line. Instead,
    simply make a note of your **Site ID**. Then, minimize your browser.
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 我建议您 **不要** 遵循他们为 Gatsby 提供的说明。为什么？因为他们的说明建议修改 Gatsby 用于服务器端渲染 `head` 和其他 HTML
    部分的组件，而 Gatsby 无法保证在不同版本之间保持此文件的一致性，因此干预可能会在以后升级时造成困难。相反，只需记下您的 **网站 ID**。然后，最小化浏览器。
- en: 'Now that we have retrieved our **Site ID**, let''s turn our attention to our
    Gatsby site repository and start populating that Fathom dashboard with statistics:'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经检索到我们的 **网站 ID**，让我们将注意力转向我们的 Gatsby 网站存储库，并开始用统计数据填充 Fathom 仪表板：
- en: 'Install the necessary dependencies:'
  id: totrans-86
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装必要的依赖项：
- en: '[PRE5]'
  id: totrans-87
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Include the `gatsby-plugin-fathom` plugin in your `gatsby-config.js` file:'
  id: totrans-88
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在您的 `gatsby-config.js` 文件中包含 `gatsby-plugin-fathom` 插件：
- en: '[PRE6]'
  id: totrans-89
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE6]'
- en: Replace `FATHOM_SITE_ID` with the **Site ID** property that you retrieved via
    Fathom's website.
  id: totrans-90
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将 `FATHOM_SITE_ID` 替换为您通过 Fathom 网站检索到的 **网站 ID** 属性。
- en: Build and serve your Gatsby site. `gatsby-plugin-fathom` is production-only,
    so we need to create and serve a production build to validate that it is working.
  id: totrans-91
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 构建并托管您的 Gatsby 网站。`gatsby-plugin-fathom` 仅用于生产环境，因此我们需要创建并托管一个生产版本以验证其是否正常工作。
- en: Once your site has loaded, navigate to it. Once it has been rendered, return
    to Fathom and click **Verify site code**. It should inform you that fathom is
    all hooked up!
  id: totrans-92
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 当您的网站加载完成后，导航到它。一旦渲染完成，返回 Fathom 并点击 **验证网站代码**。它应该会通知您 fathom 已经全部连接好了！
- en: Now, let's investigate how we can track more than page views.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，让我们调查如何跟踪比页面视图更多的内容。
- en: Custom events (goals)
  id: totrans-94
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 自定义事件（目标）
- en: Like Google Analytics, Fathom also allow you to track custom events. Fathom
    refers to these events as "goals." To learn how we can track a goal, let's look
    at an example of using a button click.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 与 Google Analytics 类似，Fathom 也允许您跟踪自定义事件。Fathom 将这些事件称为“目标”。要了解我们如何跟踪一个目标，让我们看看使用按钮点击的示例。
- en: 'First, we need to create an event via Fathom:'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们需要通过 Fathom 创建一个事件：
- en: Navigate to your Fathom analytics dashboard. Under the **Events** section, click
    **Add event**.
  id: totrans-97
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导航到您的 Fathom 分析仪表板。在 **事件** 部分下，点击 **添加事件**。
- en: Give your event a name and click **Create event**. Note your event code.
  id: totrans-98
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 给您的活动起一个名字，然后点击 **创建事件**。注意您的事件代码。
- en: 'Now that we have an event code, let''s use it! Let''s assume we have a simple
    button component:'
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们有了事件代码，让我们来使用它！假设我们有一个简单的按钮组件：
- en: '[PRE7]'
  id: totrans-100
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'To track a click of this button, we can utilize the `useGoal` function, which
    is exposed via the plugin:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 要跟踪此按钮的点击，我们可以利用通过插件公开的 `useGoal` 函数：
- en: '[PRE8]'
  id: totrans-102
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: The `useGoal` hook exposes a function with a single argument, which is the value
    of your goal. Perhaps this is the purchase button, and you would like to log your
    revenue on your dashboard. If your goal has no value, set this parameter to `0`.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: '`useGoal` 钩子公开了一个接受单个参数的函数，该参数是您目标的价值。也许这是一个购买按钮，您希望在仪表板上记录您的收入。如果您的目标没有价值，将此参数设置为
    `0`。'
- en: Now that we understand how to track page analytics, let's look at how we can
    monitor our application for errors in production through application monitoring.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经了解了如何跟踪页面分析，让我们看看如何通过应用程序监控在生产中监控我们的应用程序的错误。
- en: Monitoring the performance of your site
  id: totrans-105
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 监控您网站的性能
- en: One of the hardest things to debug is user errors in production that you cannot
    seem to replicate on your machine. Without logs, this can be an impossible task.
    Luckily, some tools are dedicated to monitoring errors within your application
    and alert you when things do go wrong. One of the most popular tools out there
    for this purpose is Sentry.io.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 在生产环境中调试最困难的事情之一是您似乎无法在您的机器上复制的用户错误。没有日志，这可能是一项不可能的任务。幸运的是，有些工具专门用于监控应用程序中的错误，并在事情出错时提醒您。用于此目的最受欢迎的工具之一是
    Sentry.io。
- en: Using Sentry.io analytics
  id: totrans-107
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用 Sentry.io 分析
- en: 'Sentry.io is a full-stack error tracking system that supports a variety of
    desktop, browser, and server applications – including GatsbyJS! Sentry works by
    integrating with our site''s logging infrastructure directly. Let''s learn how
    we can implement Sentry so that we can monitor it for production errors:'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: Sentry.io 是一个全栈错误跟踪系统，支持各种桌面、浏览器和服务器应用程序——包括 GatsbyJS！Sentry 通过直接集成到我们网站的日志基础设施来工作。让我们学习如何实现
    Sentry，以便我们可以监控生产中的错误：
- en: Navigate to [https://sentry.io/signup/](https://sentry.io/signup/) from your
    browser and create an account.
  id: totrans-109
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过浏览器导航到 [https://sentry.io/signup/](https://sentry.io/signup/) 并创建一个账户。
- en: Once you've logged in, create a new project by navigating to **Projects** and
    clicking **Create Project**.
  id: totrans-110
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 登录后，通过导航到**项目**并点击**创建项目**来创建一个新项目。
- en: 'Fill in the new project user interface, like so:'
  id: totrans-111
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 填写新项目用户界面，如下所示：
- en: '![Figure 8.7 – Sentry initialization'
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: '![图 8.7 – Sentry 初始化'
- en: '](img/Figure_8.07_B15983.jpg)'
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: '![图片](img/Figure_8.07_B15983.jpg)'
- en: Figure 8.7 – Sentry initialization
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 图 8.7 – Sentry 初始化
- en: Choose Gatsby as your platform. As your site is presumably going to be small
    at launch, I would suggest setting your default alert settings to **Alert me on
    every new issue**. Finally, give your project a name. Then, click **Create Project**.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 选择 Gatsby 作为您的平台。由于您的网站在发布时可能规模较小，我建议将默认警报设置设置为**在每一个新问题上提醒我**。最后，为您的项目命名。然后，点击**创建项目**。
- en: 'Sentry, then, gives you a great step-by-step guide on how to set up Sentry
    within your Gatsby project. Let''s reiterate these steps here:'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，Sentry 会为您提供一个很好的分步指南，说明如何在 Gatsby 项目中设置 Sentry。让我们在这里重申这些步骤：
- en: 'Install the necessary dependencies:'
  id: totrans-117
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 安装必要的依赖项：
- en: '[PRE9]'
  id: totrans-118
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'Include the `@sentry/gatsby` plugin in your `gatsby-config.js` file:'
  id: totrans-119
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在您的 `gatsby-config.js` 文件中包含 `@sentry/gatsby` 插件：
- en: '[PRE10]'
  id: totrans-120
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE10]'
- en: '`sampleRate` is the rate of error events that are sent. Sentry suggests `0.7`
    as the default value, which means that 70% of error events will be sent.'
  id: totrans-121
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '`sampleRate` 是发送错误事件的速率。Sentry 建议使用 `0.7` 作为默认值，这意味着 70% 的错误事件将被发送。'
- en: 'A complete list of plugin options can be found here: [https://docs.sentry.io/platforms/javascript/guides/gatsby/configuration/options/](https://docs.sentry.io/platforms/javascript/guides/gatsby/configuration/options/).'
  id: totrans-122
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 完整的插件选项列表可以在此处找到：[https://docs.sentry.io/platforms/javascript/guides/gatsby/configuration/options/](https://docs.sentry.io/platforms/javascript/guides/gatsby/configuration/options/)。
- en: These few lines of code are all that is needed to have Sentry start tracking
    errors and the performance of your site in production. You can rest easy knowing
    that if your site visitors encounter errors, you will know about them instantly.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 这几行代码就足以让 Sentry 开始跟踪生产中网站的错误和性能。您可以放心，如果您的网站访客遇到错误，您将立即知道。
- en: Summary
  id: totrans-124
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter, we learned about website analytics and how useful they can
    be to make our application perform at its best. We learned about the different
    types of data we can collect and the regulations we should follow when collecting
    a user's data. We implemented page analytics in two different ways – one by providing
    you with an abundance of data and the other by taking a more privacy-focused stance.
    Finally, we also implemented application monitoring using Sentry.io. You should
    now feel confident collecting website analytics.
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们学习了网站分析以及它们如何有助于使我们的应用程序发挥最佳性能。我们学习了我们可以收集的不同类型的数据以及我们在收集用户数据时应遵守的法规。我们以两种不同的方式实现了页面分析——一种是通过提供大量数据，另一种是采取更注重隐私的立场。最后，我们还使用
    Sentry.io 实现了应用程序监控。现在，您应该有信心收集网站分析。
- en: In the next chapter, we will finally bring together everything we have learned
    in the last eight chapters and deploy our website.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将最终将我们在前八章中学到的所有内容结合起来，并部署我们的网站。
