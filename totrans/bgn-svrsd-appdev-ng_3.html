<html><head></head><body><div class="chapter" title="Chapter&#xA0;3.&#xA0;Server-Side Rendering"><div class="titlepage"><div><div><h1 class="title"><a id="ch03"/>Chapter 3. Server-Side Rendering</h1></div></div></div><p>How does a normal app render?</p><p>Let's first<a class="indexterm" id="id112"/> take a look at how a normal Angular application without server-side rendering behaves.</p><p>When we start our server in development mode, using <code class="literal">ng serve,</code> and we use the<a class="indexterm" id="id113"/> <span class="strong"><strong>View Source</strong></span> option in our browser to check the source, we see that the only thing that gets rendered is the output from our <code class="literal">src/index.html</code> file, with a few scripts appended at the bottom.</p><p>These scripts will be downloaded by the browser and after they have been downloaded and executed, the application will display:</p><div class="mediaobject"><img alt="Server-Side Rendering" src="graphics/2.1.jpg"/></div><p>While this <a class="indexterm" id="id114"/>works in some situations, in others this can become problematic. If the user of your app is on a slow connection or slow device, it will take time to load and parse the scripts, and during that waiting time, the user sees a blank page.</p><p>Another issue is that most search engines and social media sites will only read the initial <span class="emphasis"><em>payload</em></span> of our website and will not download and execute our client-side JavaScript files.</p><p>These are the things that will be fixed in this lesson. After we have added server-side rendering, we will add support for dynamic metadata and page titles. This makes sure that any server-side rendered page has proper metadata, which will make these social pages rich in content and will make sure that search engines can index the pages properly.</p><p>To get the <a class="indexterm" id="id115"/>actual loading times, use the status bar of the <span class="strong"><strong>Network</strong></span> tab in Chrome Developer Tools.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note07"/>Note</h3><p>One way to experience a slow connection on a normal Chrome browser is to open Chrome Developer Tools, go to the <span class="strong"><strong>Network</strong></span> tab, and change the network speed from <span class="strong"><strong>Online</strong></span> to <span class="strong"><strong>Slow 3G</strong></span>. When you load the page served by the server, you will get an idea of how long it takes for a slow connection to load the application:</p><div class="mediaobject"><img alt="Server-Side Rendering" src="graphics/3.21.jpg"/></div></div></div><div class="section" title="Lesson Objectives"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl4sec03"/>Lesson Objectives</h1></div></div></div><p>In this lesson, you will:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Add server-side rendering to the application that we built in the previous lesson</li><li class="listitem" style="list-style-type: disc">Add Angular Universal to our application and configure a second app in our Angular CLI config</li><li class="listitem" style="list-style-type: disc">Implement a web server to host our app</li><li class="listitem" style="list-style-type: disc">Add dynamic metadata to our application</li></ul></div></div></div>
<div class="section" title="Generating the Server App"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec21"/>Generating the Server App</h1></div></div></div><p>Since <a class="indexterm" id="id116"/>Angular CLI version 1.6, there has been a generator for adding support for Angular Universal. It does this by adding a second app to the Angular CLI config, <code class="literal">.angular-cli.json</code>.</p><p>We will refer to this new app as our <span class="emphasis"><em>server app</em></span>, and the one we worked with in the previous lesson will be called our <span class="emphasis"><em>browser app</em></span>.</p><p>So, what are the differences between the browser and server apps?</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Both load another platform which behaves differently.</li><li class="listitem" style="list-style-type: disc">The browser app uses code splitting, which builds the app in various smaller files. This improves load times in the browser. The server builds the app without code splitting as there are no benefits to do this on the server.</li><li class="listitem" style="list-style-type: disc">The browser app loads a greater number of polyfills. These are small JavaScript libraries that add functionality to the browser, if the browser does not support them yet. This is not needed for the server.</li></ul></div><p>Let's explore in <a class="indexterm" id="id117"/>some more detail what happens when we run the generator:</p><div class="mediaobject"><img alt="Generating the Server App" src="graphics/2.3.jpg"/></div><p>Running this generator will change a few things in the current app:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">It will add a second app to the <code class="literal">apps</code> array in <code class="literal">.angular-cli.json.</code></li><li class="listitem" style="list-style-type: disc">It will add a dependency for the <code class="literal">@angular/platform-server</code> package.</li><li class="listitem" style="list-style-type: disc">It will update <code class="literal">AppModule</code> and change the <code class="literal">BrowserModule</code> import.</li><li class="listitem" style="list-style-type: disc">It will change the way the browser app gets bootstrapped in <code class="literal">src/main.ts.</code></li></ul></div><p>Additionally, it creates some new files:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">It generates a new file <code class="literal">src/app/app.server.module.ts</code> with the <code class="literal">AppServerModule</code></li><li class="listitem" style="list-style-type: disc">The <code class="literal">src/main.server.ts</code> file is created, which exports the <code class="literal">AppServerModule</code></li><li class="listitem" style="list-style-type: disc">A TypeScript config file for the server app is generated in <code class="literal">src/tsconfig.server.json</code></li></ul></div><p>As stated<a class="indexterm" id="id118"/> above, we have new dependencies in <code class="literal">package.json</code>. This means we need to run <code class="literal">npm install</code> to make sure the dependencies get installed.</p><div class="section" title="Generating the Angular Universal Application"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec41"/>Generating the Angular Universal Application</h2></div></div></div><p>We will create the server app and install the missing dependencies:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the terminal in the project directory.</li><li class="listitem">Run the generator to add the Universal app. The command is as follows:<div class="informalexample"><pre class="programlisting">ng generate universal server</pre></div></li><li class="listitem">Install the dependencies that were added to <code class="literal">package.json</code>:<div class="informalexample"><pre class="programlisting">npm install</pre></div></li></ol></div></div><div class="section" title="Making Our Apps Consistent"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec42"/>Making Our Apps Consistent</h2></div></div></div><p>We will make some small changes to both the browser app and the server app so that they are more consistent:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the terminal in the project directory.</li><li class="listitem">Run the following command to update the <code class="literal">outDir</code> of the server app:<div class="informalexample"><pre class="programlisting">ng set apps.1.outDir=dist/server</pre></div></li><li class="listitem">Run the following command to update the <code class="literal">outDir</code> of the browser app:<div class="informalexample"><pre class="programlisting">ng set apps.0.outDir=dist/browser</pre></div></li><li class="listitem">Run the following command to update the <code class="literal">name</code> of the browser app:<div class="informalexample"><pre class="programlisting">ng set apps.0.name=browser</pre></div></li><li class="listitem">Run the <a class="indexterm" id="id119"/>following command to update the <code class="literal">platform</code> of the browser app:<div class="informalexample"><pre class="programlisting">ng set apps.0.platform=browser</pre></div><div class="mediaobject"><img alt="Making Our Apps Consistent" src="graphics/2.4.jpg"/></div></li></ol></div><p>The changes will be reflected in <code class="literal">.angular-cli.json</code>:</p><div class="mediaobject"><img alt="Making Our Apps Consistent" src="graphics/2.5.jpg"/></div><p>We've <a class="indexterm" id="id120"/>now installed the required dependencies.</p><p>In this section, we have created a new server app in addition to the browser app we already had. Let's move on to adding support for Angular Universal in our application.</p></div></div>
<div class="section" title="Adding Dependencies for the Server App"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec22"/>Adding Dependencies for the Server App</h1></div></div></div><p>In <a class="indexterm" id="id121"/>order to get our server app working correctly, we need to make sure we load two of Angular's dependencies: <code class="literal">zone.js</code> and <code class="literal">reflect-metadata</code>.</p><p>Our browser app loads these dependencies using <code class="literal">polyfills.ts</code>, and for the server app, we will add them to <code class="literal">src/main.server.ts</code>.</p><p>Another dependency that we need to add is the <code class="literal">ModuleMapLoaderModule</code>. This is a third-party module that is needed to make Angular Universal apps work with lazy loading.</p><p>We will import two dependencies in <code class="literal">src/main.server.ts</code> so that they are imported when the <code class="literal">AppServerModule</code> is loaded.</p><p>Additionally, we will enable production mode, just like it's done for the browser app in <code class="literal">src/main.ts</code>:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the newly created file <code class="literal">src/main.server.ts</code>.</li><li class="listitem">Add the imports at the top of the file:<div class="informalexample"><pre class="programlisting">import 'zone.js/dist/zone-node';
import 'reflect-metadata';

import { enableProdMode } from '@angular/core';
import { environment } from './environments/environment';</pre></div></li><li class="listitem">Conditionally enable production mode, depending on the environment:<div class="informalexample"><pre class="programlisting">if (environment.production) {
  enableProdMode();
}</pre></div></li></ol></div><p>Let's <a class="indexterm" id="id122"/>move on to adding this new application to our Angular CLI configuration!</p><div class="section" title="Adding the Server App to Our Angular CLI Configuration"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec43"/>Adding the Server App to Our Angular CLI Configuration</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open a terminal inside the project directory.</li><li class="listitem">Run the following command to install the dependency:<div class="informalexample"><pre class="programlisting">npm install --save @nguniversal/module-map-ngfactory-loader</pre></div></li><li class="listitem">Open the <code class="literal">src/app/app.server.module.ts</code> file in your editor.</li><li class="listitem">Add <a class="indexterm" id="id123"/>the following <code class="literal">import</code> at the top of the file:<div class="informalexample"><pre class="programlisting">import { ModuleMapLoaderModule } from '@nguniversal/module-map-ngfactory-loader';</pre></div></li><li class="listitem">Add a reference to the imported module to the <code class="literal">imports</code> array:<div class="informalexample"><pre class="programlisting">imports: [
  ...
  ModuleMapLoaderModule,
],</pre></div></li></ol></div><p>In this section, we added the required dependencies and added the server app to our configuration. In the next section, let's explore run scripts and add them to our application.</p></div></div>
<div class="section" title="Adding Run Scripts to package.json"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec23"/>Adding Run Scripts to package.json</h1></div></div></div><p>Now that we have added a second application to our Angular CLI config, we need to make sure we can easily build both applications without having to memorize the exact commands.</p><p>In order to<a class="indexterm" id="id124"/> do so, we will leverage the so-called npm scripts. These scripts are used to define operations that can be performed <a class="indexterm" id="id125"/>on our application. Examples of these operations are building the application, running tests, and deploying the application to a staging or production environment.</p><p>We can define our npm scripts in the <code class="literal">scripts</code> section of the <code class="literal">package.json</code> file in the root of our project.</p><p>Here, we will add three scripts called <code class="literal">build</code>, <code class="literal">build:browser</code>, and <code class="literal">build:server</code>, where the first script will invoke the other two.</p><p>This gives us the flexibility to run the two commands at once, or run them independently if we like.</p><p>To get an idea of how these scripts work, consider the following flow:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">The <code class="literal">npm run build</code> command will first run <code class="literal">npm run build:browser</code>.</li><li class="listitem">When that command is finished, it will run <code class="literal">npm run build:server</code>.</li></ol></div><p>The order in which we run the <code class="literal">build:browser</code> and <code class="literal">build:server</code> scripts is irrelevant; the scripts are fully independent.</p><div class="section" title="Adding npm Scripts"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec44"/>Adding npm Scripts</h2></div></div></div><p>We will add some npm scripts to our <code class="literal">package.json</code> so we can easily create builds for our application:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the <code class="literal">package.json</code> file from the root of our project in the editor.</li><li class="listitem">Locate the <code class="literal">scripts</code> object and remove the existing <code class="literal">build</code> property.</li><li class="listitem">Add the following keys to the <code class="literal">scripts</code> object:<div class="informalexample"><pre class="programlisting">"build": "npm run build:browser &amp;&amp; npm run build:server",
"build:browser": "ng build --prod --app browser",
"build:server": "ng build --prod --app server --output-hashing=false",</pre></div></li></ol></div></div><div class="section" title="Testing the Builds of Both Apps"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec45"/>Testing the Builds of Both Apps</h2></div></div></div><p>We will test the builds of both the browser and server applications:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open a terminal inside the project directory.</li><li class="listitem">Run the following command to build the browser application:<div class="informalexample"><pre class="programlisting">$ npm run build:browser</pre></div><div class="mediaobject"><img alt="Testing the Builds of Both Apps" src="graphics/2.6.jpg"/></div></li><li class="listitem">Run the following command <a class="indexterm" id="id126"/>to build the server application:<div class="informalexample"><pre class="programlisting">$ npm run build:server</pre></div><div class="mediaobject"><img alt="Testing the Builds of Both Apps" src="graphics/2.7.jpg"/></div></li></ol></div><p>If both commands execute without<a class="indexterm" id="id127"/> any error messages, we can continue with our next step, which is implementing a small web server to host our application.</p></div></div>
<div class="section" title="Implementing a Web Server"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec24"/>Implementing a Web Server</h1></div></div></div><p>Now that <a class="indexterm" id="id128"/>both our applications can be built, we can move on to creating a simple server to host our applications.</p><p>In order to do this, we will create a simple Node.js server based on Express.js.</p><p>We will define our server in a TypeScript file called <code class="literal">server.ts</code> and run this file using the <code class="literal">ts-node</code> binary that we will install.</p><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note08"/>Note</h3><p>The current implementation of Angular Universal depends on Node.js as it is implemented in JavaScript.</p><p>It is possible to run Angular Universal apps using other servers, such as ASP.NET, although under the hood the ASP.NET server will invoke a Node.js process to handle the Angular Universal part.</p><p>An example repository of how to run Angular Universal can be found here: <a class="ulink" href="https://github.com/MarkPieszak/aspnetcore-angular2-universal">https://github.com/MarkPieszak/aspnetcore-angular2-universal</a>.</p></div></div><div class="section" title="Installing Server Dependencies"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec46"/>Installing Server Dependencies</h2></div></div></div><p>We will install the <code class="literal">ts-node</code> binary that we will use to execute our server file. Additionally, we will install the rendering engine that will be used by Express.js to load our Angular Universal app:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open a terminal inside the project directory.</li><li class="listitem">Run the following <a class="indexterm" id="id129"/>command to install <code class="literal">ts-node</code>:<div class="informalexample"><pre class="programlisting">npm install --save ts-node @nguniversal/express-engine</pre></div><div class="mediaobject"><img alt="Installing Server Dependencies" src="graphics/2.8.jpg"/></div></li></ol></div></div><div class="section" title="Creating the server.ts File"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec47"/>Creating the server.ts File</h2></div></div></div><p>We will implement our <code class="literal">server.ts</code> file.</p><p>In this file, we will define our Express.js server and configure it so it can render and serve our server app:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">In your editor, create a new file called <code class="literal">server.ts</code> in the project root.</li><li class="listitem">Add the following <code class="literal">import</code> statements at the top of the file:<div class="informalexample"><pre class="programlisting">import * as express from 'express';
import { join } from 'path';
import { ngExpressEngine } from '@nguniversal/express-engine';
import { provideModuleMap } from '@nguniversal/module-map-ngfactory-loader';</pre></div></li><li class="listitem">Define <a class="indexterm" id="id130"/>the constants that we will use in the server:<div class="informalexample"><pre class="programlisting">const PORT = process.env.PORT || 8080;
const staticRoot = join(process.cwd(), 'dist', 'browser');
const { AppServerModuleNgFactory, LAZY_MODULE_MAP } = require('./dist/server/main.bundle');
const app = express();</pre></div></li><li class="listitem">Define the <code class="literal">html</code> view engine. This will let Express.js know which function it uses to render HTML files:<div class="informalexample"><pre class="programlisting">app.engine('html', ngExpressEngine({
  bootstrap: AppServerModuleNgFactory,
  providers: [
    provideModuleMap(LAZY_MODULE_MAP)
  ]
}));</pre></div></li><li class="listitem">Define the rest of the Express.js defaults. We set our default view engine to <code class="literal">html</code>, the engine we defined in the previous step. Next, we set the root directory for our views to reference our <code class="literal">staticRoot</code>:<div class="informalexample"><pre class="programlisting">app.set('view engine', 'html');
app.set('views', staticRoot);</pre></div></li><li class="listitem">With the following Express.js defaults, we define that we want to statically serve all other files than of type <code class="literal">html</code>, and that the default route (<code class="literal">*</code>) is to render the <code class="literal">index.html</code> file:<div class="informalexample"><pre class="programlisting">app.get('*.*', express.static(staticRoot));
app.get('*', (req, res) =&gt; res.render('index', { req }));</pre></div></li><li class="listitem">Start the <a class="indexterm" id="id131"/>server and log a message with the host and port:<div class="informalexample"><pre class="programlisting">app.listen(PORT, () =&gt; console.log(`Server listening on http://localhost:${PORT}`));</pre></div></li></ol></div></div><div class="section" title="Adding the npm Script to package.json"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec48"/>Adding the npm Script to package.json</h2></div></div></div><p>We will update <code class="literal">package.json</code> and add a script to start our server:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the <code class="literal">package.json</code> file in the root of our project in the editor.</li><li class="listitem">Locate the <code class="literal">scripts</code> object and remove the existing <code class="literal">start</code> property.</li><li class="listitem">Add the following key to the <code class="literal">scripts</code> object:<div class="informalexample"><pre class="programlisting">"start": "ts-node ./server",</pre></div></li></ol></div></div><div class="section" title="Starting the Server"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec49"/>Starting the Server</h2></div></div></div><p>We <a class="indexterm" id="id132"/>will build and start our app, and test whether it works!</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Run the complete build using the following command:<div class="informalexample"><pre class="programlisting">$ npm run build</pre></div></li><li class="listitem">Start the Node.js server using the following command:<div class="informalexample"><pre class="programlisting">$ npm start</pre></div><div class="mediaobject"><img alt="Starting the Server" src="graphics/2.9.jpg"/></div></li><li class="listitem">Navigate <a class="indexterm" id="id133"/>to the server-side rendered build at: <code class="literal">http://localhost:8080</code>.</li><li class="listitem">Verify that the application works.</li><li class="listitem">From the Chrome menu, go to <span class="strong"><strong>View</strong></span> | <span class="strong"><strong>Developer Tools</strong></span> | <span class="strong"><strong>View Source</strong></span> and verify that the application output gets rendered.</li></ol></div><p>In this section, we ran our app on a server built using Express.js. The next step is to add dynamic metadata, which will help our app become more SEO-friendly.</p></div></div>
<div class="section" title="Adding Dynamic Metadata"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec25"/>Adding Dynamic Metadata</h1></div></div></div><p>Now<a class="indexterm" id="id134"/> that our pages can be rendered using server-side rendering, we can introduce new functionality to enhance the appearance of our app.</p><p>At the moment, our <a class="indexterm" id="id135"/>app will still only display the default title set in <code class="literal">src/index.html</code> and we won't have any other HTML meta tags added.</p><p>To enhance the SEO friendliness of our page, and to make sure there is valuable information in our social preview, we want to address this.</p><p>Luckily, Angular comes with the <code class="literal">Meta</code> and <code class="literal">Title</code> classes, which allow us to add dynamic titles and metadata to our pages.</p><p>When combined with server-side rendering, the metadata and page title will make sure that the pages that are indexed by the search engine have the proper meta tags set in the document header, and thus increase findability.</p><p>In this section, we will add a service that allows us to define this data, and we will update our container components to call in that service after the data is loaded from our resolvers.</p><div class="section" title="Creating the UiService"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec50"/>Creating the UiService</h2></div></div></div><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open a<a class="indexterm" id="id136"/> terminal inside the project directory.</li><li class="listitem">Run the following command to generate the <code class="literal">UiService</code> and register it in the <code class="literal">UiModule</code>:<div class="informalexample"><pre class="programlisting">ng g s ui/services/ui --module ui/ui</pre></div><div class="mediaobject"><img alt="Creating the UiService" src="graphics/2.10.jpg"/></div></li><li class="listitem">Open the <code class="literal">src/app/ui/services/ui.service.ts</code> file in your editor.</li><li class="listitem">Add the<a class="indexterm" id="id137"/> following lines to the class definition:<div class="informalexample"><pre class="programlisting">private appColor = '#C3002F';
private appImage = '/assets/logo.svg';
private appTitle = 'Angular Social';
private appDescription = 'Angular Social is a Social Networking App built in Angular';</pre></div></li><li class="listitem">Import <code class="literal">Title</code> and <code class="literal">Meta</code> from <code class="literal">@angular/platform-browser</code>:<div class="informalexample"><pre class="programlisting">import { Meta, Title } from '@angular/platform-browser';</pre></div></li><li class="listitem">Inject <code class="literal">private title: Title</code> and <code class="literal">private meta: Meta</code> in the constructor:<div class="informalexample"><pre class="programlisting">constructor(private titleService: Title, private metaService: Meta){}</pre></div></li><li class="listitem">Add a class method called <code class="literal">setMetaData</code> that takes in a property <code class="literal">config</code>:<div class="informalexample"><pre class="programlisting">public setMetaData(config) {}</pre></div></li><li class="listitem">Add the <a class="indexterm" id="id138"/>following code to the body of the <code class="literal">setMetaData</code> property:<div class="informalexample"><pre class="programlisting">// Get the description of the config, or use the default App Description
const description = config.description || this.appDescription
// Get the title of the config and append the App Title, or just use the App Title
const title = config.title ? `${config.title} - ${this.appTitle}` : this.appTitle;

// Set the Application Title
this.titleService.setTitle(title);

// Add the Application Meta tags
this.metaService.addTags([
   { name: 'description', content: description },
   { name: 'theme-color', content: this.appColor },
   { name: 'twitter:card', content: 'summary' },
   { name: 'twitter:image', content: this.appImage },
   { name: 'twitter:title', content: title },
   { name: 'twitter:description', content: description },
   { name: 'apple-mobile-web-app-capable', content: 'yes' },
   { name: 'apple-mobile-web-app-status-bar-style', content: 'black-translucent' },
   { name: 'apple-mobile-web-app-title', content: title },
   { name: 'apple-touch-startup-image', content: this.appImage },
   { property: 'og:title', content: title },
   { property: 'og:description', content: description },
   { property: 'og:image', content: this.appImage },
]);</pre></div></li></ol></div><p>Our <code class="literal">UiService</code> is now <a class="indexterm" id="id139"/>ready to be used. We will start by adding it to the components in our next section.</p></div><div class="section" title="Adding Metadata to PostsComponent and ProfileComponent"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec51"/>Adding Metadata to PostsComponent and ProfileComponent</h2></div></div></div><p>We will add the metadata to the <code class="literal">PostsComponent</code>:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the <code class="literal">src/app/posts/container/posts/posts.component.ts</code> file in your editor.</li><li class="listitem">Import the <code class="literal">UiService</code> and the <code class="literal">map</code> operator from <code class="literal">rxjs</code>:<div class="informalexample"><pre class="programlisting">import { UiService } from '../../../ui/services/ui.service';</pre></div></li><li class="listitem">Inside the constructor, inject <code class="literal">private uiService: UiService</code>:<div class="informalexample"><pre class="programlisting">constructor(private route: ActivatedRoute, private uiService: UiService) { }</pre></div></li><li class="listitem">Add a class method called <code class="literal">setMetadata()</code> that accepts a <code class="literal">posts</code> property:<div class="informalexample"><pre class="programlisting">setMetaData(posts) {}</pre></div></li><li class="listitem">Add the following to the <code class="literal">setMetaData</code> method. In this method, we will construct the dynamic metadata that we will pass to our <code class="literal">setMetaData</code> method in the <code class="literal">UiService</code>:<div class="informalexample"><pre class="programlisting">const { itemsPerPage, itemsTotal } = posts['counters']
const description = `Showing ${itemsPerPage} from ${itemsTotal} posts`
const title = 'Posts List'

this.uiService.setMetaData({ description, title })
return posts;</pre></div></li><li class="listitem">Update the first <code class="literal">map</code> statement in the <code class="literal">ngOnInit</code> method to the following code. This will pass the data we get from the API through the method we defined above:<div class="informalexample"><pre class="programlisting">.map(data =&gt; this.setMetaData(data['posts']))</pre></div></li></ol></div><p>Now we will add the metadata to the <code class="literal">ProfileComponent</code>:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Open the <code class="literal">src/app/posts/container/profile/profile.component.ts</code> file in your editor.</li><li class="listitem">Import the <code class="literal">UiService</code> and the <code class="literal">map</code> operator from <code class="literal">rxjs</code>:<div class="informalexample"><pre class="programlisting">import { UiService } from '../../../ui/services/ui.service';</pre></div></li><li class="listitem">Inside the constructor, inject <code class="literal">private uiService: UiService</code>:<div class="informalexample"><pre class="programlisting">constructor(private route: ActivatedRoute, private uiService: UiService) { }</pre></div></li><li class="listitem">Add a class method called <code class="literal">setMetadata()</code> that accepts a property <code class="literal">profile</code>:<div class="informalexample"><pre class="programlisting">setMetaData(profile) {}</pre></div></li><li class="listitem">Add the <a class="indexterm" id="id140"/>following to the <code class="literal">setMetaData</code> method. In this method, we will construct the dynamic metadata that we will pass to our <code class="literal">setMetaData</code> method in the <code class="literal">UiService</code>:<div class="informalexample"><pre class="programlisting">const { fullName, posts } = profile;
const description = `${fullName} posted ${posts.length} posts.`;
const title = `Posts by ${fullName}`;
this.uiService.setMetaData({ description, title });
return profile;</pre></div></li><li class="listitem">Update the <code class="literal">ngOnInit</code> method to the following code. This will pass the data we get from the API through the method we defined above:<div class="informalexample"><pre class="programlisting">this.route.data
   .map(data =&gt; this.setMetaData(data['profile']))
   .subscribe((result: any) =&gt; this.profile = result)</pre></div></li></ol></div><p>When <a class="indexterm" id="id141"/>you now browse through the application, you should see the title of the page update, depending on the page you are visiting.</p><p>You can use the <span class="strong"><strong>Element Inspector</strong></span> in Chrome Developer Tools to verify that the metadata is being added to the rendered components:</p><div class="mediaobject"><img alt="Adding Metadata to PostsComponent and ProfileComponent" src="graphics/2.11.jpg"/></div><p>In this section, we have added metadata to our <code class="literal">PostsComponent</code> and <code class="literal">ProfileComponent</code>. We also created a UiService that allows us to define this data.</p></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec26"/>Summary</h1></div></div></div><p>In this lesson, we have added server-side rendering to our application. We started by generating the server app and adding its dependencies. We then added scripts to our <code class="literal">package.json</code> file, before implementing a web server in Express.js. Lastly, we saw how to add dynamic metadata to our pages.</p><p>In the next lesson, we'll configure service workers for our application.</p></div></body></html>