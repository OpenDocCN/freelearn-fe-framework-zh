<html><head></head><body>
<div id="_idContainer052">
<h1 class="chapterNumber"><a id="_idTextAnchor048"/><span class="koboSpan" id="kobo.1.1">2</span></h1>
<h1 class="chapterTitle" id="_idParaDest-47"><a id="_idTextAnchor049"/><span class="koboSpan" id="kobo.2.1">Using the State Hook</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.3.1">After learning about the principles of React and giving an introduction to Hooks, we are now going to learn about the State Hook in depth. </span><span class="koboSpan" id="kobo.3.2">We will start by learning how the State Hook works internally by reimplementing it ourselves. </span><span class="koboSpan" id="kobo.3.3">Doing so will teach us about the limitations of Hooks and why they exist. </span><span class="koboSpan" id="kobo.3.4">Then, we will learn about possible alternative Hook APIs and their associated problems. </span><span class="koboSpan" id="kobo.3.5">Finally, we will learn how to solve the common problems that result from the limitations of Hooks. </span><span class="koboSpan" id="kobo.3.6">By the end of this chapter, you will know how to use the State Hook to implement stateful function components in React.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.4.1">In this chapter, we are going to cover the following main topics:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.5.1">Reimplementing the State Hook</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.6.1">Potential alternative Hook APIs</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.7.1">Solving common problems with Hooks</span></li>
</ul>
<h1 class="heading-1" id="_idParaDest-48"><a id="_idTextAnchor050"/><span class="koboSpan" id="kobo.8.1">Technical requirements</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.9.1">A fairly recent version of Node.js should already be installed. </span><span class="koboSpan" id="kobo.9.2">The </span><strong class="keyWord"><span class="koboSpan" id="kobo.10.1">Node Package Manager</span></strong><span class="koboSpan" id="kobo.11.1"> (</span><code class="inlineCode"><span class="koboSpan" id="kobo.12.1">npm</span></code><span class="koboSpan" id="kobo.13.1">) also needs to be installed (it should come with Node.js). </span><span class="koboSpan" id="kobo.13.2">For more information on how to install Node.js, please check out the official website: </span><a href="https://nodejs.org/"><span class="url"><span class="koboSpan" id="kobo.14.1">https://nodejs.org/</span></span></a><span class="koboSpan" id="kobo.15.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.16.1">We are going to use </span><strong class="keyWord"><span class="koboSpan" id="kobo.17.1">Visual Studio Code</span></strong><span class="koboSpan" id="kobo.18.1"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.19.1">VS Code</span></strong><span class="koboSpan" id="kobo.20.1">) for the guides in this book, but everything should work similarly in any other editor. </span><span class="koboSpan" id="kobo.20.2">For more information on how to install VS Code, please refer to the official website: </span><a href="https://code.visualstudio.com"><span class="url"><span class="koboSpan" id="kobo.21.1">https://code.visualstudio.com</span></span></a><span class="koboSpan" id="kobo.22.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.23.1">In this book, we use the following versions:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.24.1">Node.js v22.14.0</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.25.1">npm</span></code><span class="koboSpan" id="kobo.26.1"> v10.9.2</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.27.1">VS Code v1.97.2</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.28.1">While installing a newer version should not be an issue, please note that certain steps might work differently on a newer version. </span><span class="koboSpan" id="kobo.28.2">If you are having an issue with the code and steps provided in this book, please try using the mentioned versions.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.29.1">You can find the code for this chapter on GitHub: </span><a href="https://github.com/PacktPublishing/Learn-React-Hooks-Second-Edition/tree/main/Chapter02"><span class="url"><span class="koboSpan" id="kobo.30.1">https://github.com/PacktPublishing/Learn-React-Hooks-Second-Edition/tree/main/Chapter02</span></span></a><span class="koboSpan" id="kobo.31.1">.</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.32.1">It is highly recommended that you write the code on your own. </span><span class="koboSpan" id="kobo.32.2">Do not simply run the code examples that are provided with the book. </span><span class="koboSpan" id="kobo.32.3">It is important to write the code yourself to be able to learn and understand it properly. </span><span class="koboSpan" id="kobo.32.4">However, if you run into any issues, you can always refer to the code example.</span></p>
</div>
<h1 class="heading-1" id="_idParaDest-49"><a id="_idTextAnchor051"/><span class="koboSpan" id="kobo.33.1">Reimplementing the State Hook</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.34.1">In order </span><a id="_idIndexMarker073"/><span class="koboSpan" id="kobo.35.1">to get a better understanding of how Hooks work internally in React, we are going to reimplement the </span><code class="inlineCode"><span class="koboSpan" id="kobo.36.1">useState</span></code><span class="koboSpan" id="kobo.37.1"> function from scratch. </span><span class="koboSpan" id="kobo.37.2">However, we are not going to implement it as an actual React Hook but as a simple JavaScript functionâ€”just to get an idea of what Hooks are actually doing.</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.38.1">This reimplementation is not exactly how React Hooks work internally. </span><span class="koboSpan" id="kobo.38.2">The actual implementation is similar, and thus, has similar constraints. </span><span class="koboSpan" id="kobo.38.3">However, the real implementation is more extensive than what we will be implementing here.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.39.1">We are now going to start reimplementing the State Hook:</span></p>
<ol>
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.40.1">Copy the </span><code class="inlineCode"><span class="koboSpan" id="kobo.41.1">Chapter01_3</span></code><span class="koboSpan" id="kobo.42.1"> folder to a new </span><code class="inlineCode"><span class="koboSpan" id="kobo.43.1">Chapter02_1</span></code><span class="koboSpan" id="kobo.44.1"> folder by executing the following command:
        </span><pre class="programlisting con-one"><code class="hljs-con"><span class="koboSpan" id="kobo.45.1">$ cp -R Chapter01_3 Chapter02_1
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.46.1">Open the new </span><code class="inlineCode"><span class="koboSpan" id="kobo.47.1">Chapter02_1</span></code><span class="koboSpan" id="kobo.48.1"> folder in VS Code.</span></li>
</ol>
<p class="normal-one"><span class="koboSpan" id="kobo.49.1">First, we need to define a function to (re)render the app, which we can use to simulate React rerendering when the Hook state changes. </span><span class="koboSpan" id="kobo.49.2">If we used actual React Hooks, this would be dealt with internally.</span></p>
<ol>
<li class="numberedList" value="3"><span class="koboSpan" id="kobo.50.1">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.51.1">src/main.jsx</span></code><span class="koboSpan" id="kobo.52.1"> and </span><em class="italic"><span class="koboSpan" id="kobo.53.1">remove</span></em><span class="koboSpan" id="kobo.54.1"> the following code:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.55.1">createRoot</span></span><span class="koboSpan" id="kobo.56.1">(</span><span class="hljs-variable"><span class="koboSpan" id="kobo.57.1">document</span></span><span class="koboSpan" id="kobo.58.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.59.1">getElementById</span></span><span class="koboSpan" id="kobo.60.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.61.1">'root'</span></span><span class="koboSpan" id="kobo.62.1">)).</span><span class="hljs-title"><span class="koboSpan" id="kobo.63.1">render</span></span><span class="koboSpan" id="kobo.64.1">(
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.65.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.66.1">StrictMode</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.67.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.68.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.69.1">App</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.70.1"> /&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.71.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.72.1">StrictMode</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.73.1">&gt;</span></span><span class="koboSpan" id="kobo.74.1">,
)
</span></code></pre>
</li>
</ol>
<p class="normal-one"><em class="italic"><span class="koboSpan" id="kobo.75.1">Replace</span></em><span class="koboSpan" id="kobo.76.1"> it with the following:</span></p>
<pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.77.1">const</span></span><span class="koboSpan" id="kobo.78.1"> root = </span><span class="hljs-title"><span class="koboSpan" id="kobo.79.1">createRoot</span></span><span class="koboSpan" id="kobo.80.1">(</span><span class="hljs-variable"><span class="koboSpan" id="kobo.81.1">document</span></span><span class="koboSpan" id="kobo.82.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.83.1">getElementById</span></span><span class="koboSpan" id="kobo.84.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.85.1">'root'</span></span><span class="koboSpan" id="kobo.86.1">))
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.87.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.88.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.89.1">renderApp</span></span><span class="koboSpan" id="kobo.90.1">() {
  root.</span><span class="hljs-title"><span class="koboSpan" id="kobo.91.1">render</span></span><span class="koboSpan" id="kobo.92.1">(
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.93.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.94.1">StrictMode</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.95.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.96.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.97.1">App</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.98.1"> /&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.99.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.100.1">StrictMode</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.101.1">&gt;</span></span><span class="koboSpan" id="kobo.102.1">,
  )
}
</span><span class="hljs-title"><span class="koboSpan" id="kobo.103.1">renderApp</span></span><span class="koboSpan" id="kobo.104.1">()
</span></code></pre>
<p class="normal-one"><span class="koboSpan" id="kobo.105.1">In this code snippet, we first create a </span><code class="inlineCode"><span class="koboSpan" id="kobo.106.1">root</span></code><span class="koboSpan" id="kobo.107.1"> for our React application to be rendered in. </span><span class="koboSpan" id="kobo.107.2">Then, we define a function to render the app into the </span><code class="inlineCode"><span class="koboSpan" id="kobo.108.1">root</span></code><span class="koboSpan" id="kobo.109.1">. </span><span class="koboSpan" id="kobo.109.2">Finally, we call the </span><code class="inlineCode"><span class="koboSpan" id="kobo.110.1">renderApp()</span></code><span class="koboSpan" id="kobo.111.1"> function to initially render the app.</span></p>
<ol>
<li class="numberedList" value="4"><span class="koboSpan" id="kobo.112.1">Now, open </span><a id="_idIndexMarker074"/><span class="koboSpan" id="kobo.113.1">the </span><code class="inlineCode"><span class="koboSpan" id="kobo.114.1">src/App.jsx</span></code><span class="koboSpan" id="kobo.115.1"> file and </span><em class="italic"><span class="koboSpan" id="kobo.116.1">remove</span></em><span class="koboSpan" id="kobo.117.1"> the following line:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.118.1">import</span></span><span class="koboSpan" id="kobo.119.1"> { useState } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.120.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.121.1">'react'</span></span>
</code></pre>
</li>
</ol>
<p class="normal-one"><em class="italic"><span class="koboSpan" id="kobo.122.1">Replace</span></em><span class="koboSpan" id="kobo.123.1"> it with the following line:</span></p>
<pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.124.1">import</span></span><span class="koboSpan" id="kobo.125.1"> { renderApp } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.126.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.127.1">'./main.jsx'</span></span>
</code></pre>
<ol>
<li class="numberedList" value="5"><span class="koboSpan" id="kobo.128.1">Now, we define our own </span><code class="inlineCode"><span class="koboSpan" id="kobo.129.1">useState</span></code><span class="koboSpan" id="kobo.130.1"> function. </span><span class="koboSpan" id="kobo.130.2">As we already know, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.131.1">useState</span></code><span class="koboSpan" id="kobo.132.1"> function takes </span><code class="inlineCode"><span class="koboSpan" id="kobo.133.1">initialState</span></code><span class="koboSpan" id="kobo.134.1"> as an argument:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.135.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.136.1">useState</span></span><span class="koboSpan" id="kobo.137.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.138.1">initialState</span></span><span class="koboSpan" id="kobo.139.1">) {
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.140.1">Then, we define a value, where we will store our state. </span><span class="koboSpan" id="kobo.140.2">At first, this value will be set to </span><code class="inlineCode"><span class="koboSpan" id="kobo.141.1">initialState</span></code><span class="koboSpan" id="kobo.142.1">:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.143.1">let</span></span><span class="koboSpan" id="kobo.144.1"> value = initialState
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.145.1">Next, we define the </span><code class="inlineCode"><span class="koboSpan" id="kobo.146.1">setState</span></code><span class="koboSpan" id="kobo.147.1"> function, where we will set the new value, and force the rerendering of our app:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.148.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.149.1">setState</span></span><span class="koboSpan" id="kobo.150.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.151.1">nextValue</span></span><span class="koboSpan" id="kobo.152.1">) {
    value = nextValue
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.153.1">renderApp</span></span><span class="koboSpan" id="kobo.154.1">()
  }
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.155.1">Finally, we return the </span><code class="inlineCode"><span class="koboSpan" id="kobo.156.1">value</span></code><span class="koboSpan" id="kobo.157.1"> and the </span><code class="inlineCode"><span class="koboSpan" id="kobo.158.1">setState</span></code><span class="koboSpan" id="kobo.159.1"> function as an array:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.160.1">return</span></span><span class="koboSpan" id="kobo.161.1"> [value, setState]
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.162.1">Start the </span><code class="inlineCode"><span class="koboSpan" id="kobo.163.1">dev</span></code><span class="koboSpan" id="kobo.164.1"> server (keep it running) and then open the link in your browser:
        </span><pre class="programlisting con-one"><code class="hljs-con"><span class="koboSpan" id="kobo.165.1">$ npm run dev
</span></code></pre>
</li>
</ol>
<p class="normal-one"><span class="koboSpan" id="kobo.166.1">If you try to enter text into the input field now, you will notice that when the component rerenders, the state gets reset, so it is not possible to enter any text in the field. </span><span class="koboSpan" id="kobo.166.2">We are going to solve this problem in the next section.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.167.1">The reason that we use an array and not an object is that we usually want to rename the </span><code class="inlineCode"><span class="koboSpan" id="kobo.168.1">value</span></code><span class="koboSpan" id="kobo.169.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.170.1">setState</span></code><span class="koboSpan" id="kobo.171.1"> variables. </span><span class="koboSpan" id="kobo.171.2">Using an array makes it easy to rename the variables through destructuring. </span><span class="koboSpan" id="kobo.171.3">For example, if we want to have state for </span><code class="inlineCode"><span class="koboSpan" id="kobo.172.1">username</span></code><span class="koboSpan" id="kobo.173.1">, we could do the following:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.174.1">const</span></span><span class="koboSpan" id="kobo.175.1"> [username, setUsername] = </span><span class="hljs-title"><span class="koboSpan" id="kobo.176.1">useState</span></span><span class="koboSpan" id="kobo.177.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.178.1">''</span></span><span class="koboSpan" id="kobo.179.1">)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.180.1">While renaming in destructuring is possible with objects too, it would be more verbose:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.181.1">const</span></span><span class="koboSpan" id="kobo.182.1"> { </span><span class="hljs-attr"><span class="koboSpan" id="kobo.183.1">state</span></span><span class="koboSpan" id="kobo.184.1">: username, </span><span class="hljs-attr"><span class="koboSpan" id="kobo.185.1">setState</span></span><span class="koboSpan" id="kobo.186.1">: setUsername } = </span><span class="hljs-title"><span class="koboSpan" id="kobo.187.1">useState</span></span><span class="koboSpan" id="kobo.188.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.189.1">''</span></span><span class="koboSpan" id="kobo.190.1">)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.191.1">As we can see, Hooks are simple JavaScript functions that deal with side effects, such as setting a stateful value.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.192.1">Our Hook function </span><a id="_idIndexMarker075"/><span class="koboSpan" id="kobo.193.1">uses a </span><strong class="keyWord"><span class="koboSpan" id="kobo.194.1">closure</span></strong><span class="koboSpan" id="kobo.195.1"> to </span><a id="_idIndexMarker076"/><span class="koboSpan" id="kobo.196.1">store the current value. </span><span class="koboSpan" id="kobo.196.2">The closure is an environment where variables exist and are stored. </span><span class="koboSpan" id="kobo.196.3">In our case, the function provides the closure, and the </span><code class="inlineCode"><span class="koboSpan" id="kobo.197.1">value</span></code><span class="koboSpan" id="kobo.198.1"> variable is stored within that closure. </span><span class="koboSpan" id="kobo.198.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.199.1">setState</span></code><span class="koboSpan" id="kobo.200.1"> function is also defined within the same closure, which is why we can access the </span><code class="inlineCode"><span class="koboSpan" id="kobo.201.1">value</span></code><span class="koboSpan" id="kobo.202.1"> variable within that function. </span><span class="koboSpan" id="kobo.202.2">Outside of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.203.1">useState</span></code><span class="koboSpan" id="kobo.204.1"> function, we cannot directly access the </span><code class="inlineCode"><span class="koboSpan" id="kobo.205.1">value</span></code><span class="koboSpan" id="kobo.206.1"> variable unless we return it from the function.</span></p>
<h2 class="heading-2" id="_idParaDest-50"><a id="_idTextAnchor052"/><span class="koboSpan" id="kobo.207.1">Resolving issues with our simple Hook implementation</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.208.1">The issue of not being </span><a id="_idIndexMarker077"/><span class="koboSpan" id="kobo.209.1">able to enter any text into the input field is due to the reinitialization of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.210.1">value</span></code><span class="koboSpan" id="kobo.211.1"> variable every time the component gets rendered because we call </span><code class="inlineCode"><span class="koboSpan" id="kobo.212.1">useState</span></code><span class="koboSpan" id="kobo.213.1"> each time we render the component.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.214.1">In the following section, we are going to solve this problem by using a global variable and then turning the simple value into an array, allowing us to define multiple Hooks.</span></p>
<h3 class="heading-3" id="_idParaDest-51"><a id="_idTextAnchor053"/><span class="koboSpan" id="kobo.215.1">Using a global variable</span></h3>
<p class="normal"><span class="koboSpan" id="kobo.216.1">As we have</span><a id="_idIndexMarker078"/><span class="koboSpan" id="kobo.217.1"> learned, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.218.1">value</span></code><span class="koboSpan" id="kobo.219.1"> is stored within the closure that is defined by the </span><code class="inlineCode"><span class="koboSpan" id="kobo.220.1">useState</span></code><span class="koboSpan" id="kobo.221.1"> function. </span><span class="koboSpan" id="kobo.221.2">Every time the component rerenders, the closure gets reinitialized, which means that the </span><code class="inlineCode"><span class="koboSpan" id="kobo.222.1">value</span></code><span class="koboSpan" id="kobo.223.1"> variable will be set to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.224.1">initialState</span></code><span class="koboSpan" id="kobo.225.1"> again. </span><span class="koboSpan" id="kobo.225.2">To solve this, we need to store the </span><code class="inlineCode"><span class="koboSpan" id="kobo.226.1">value</span></code><span class="koboSpan" id="kobo.227.1"> in a global variable, outside of the function. </span><span class="koboSpan" id="kobo.227.2">That way, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.228.1">value</span></code><span class="koboSpan" id="kobo.229.1"> variable will be in the closure outside of the function, which means that when the function gets called again, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.230.1">value</span></code><span class="koboSpan" id="kobo.231.1"> will not be reinitialized.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.232.1">We can define the global variable as follows:</span></p>
<ol>
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.233.1">First, edit </span><code class="inlineCode"><span class="koboSpan" id="kobo.234.1">src/App.jsx</span></code><span class="koboSpan" id="kobo.235.1"> and add the following line above the </span><code class="inlineCode"><span class="koboSpan" id="kobo.236.1">useState</span></code><span class="koboSpan" id="kobo.237.1"> function definition:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.238.1">let</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.239.1"> value</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.240.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.241.1">useState</span></span><span class="koboSpan" id="kobo.242.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.243.1">initialState</span></span><span class="koboSpan" id="kobo.244.1">) {
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.245.1">Then, </span><em class="italic"><span class="koboSpan" id="kobo.246.1">remove</span></em><span class="koboSpan" id="kobo.247.1"> the following first line in the function definition:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.248.1">let</span></span><span class="koboSpan" id="kobo.249.1"> value = initialState
</span></code></pre>
</li>
</ol>
<p class="normal-one"><em class="italic"><span class="koboSpan" id="kobo.250.1">Replace</span></em><span class="koboSpan" id="kobo.251.1"> it with the following code snippet:</span></p>
<pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.252.1">if</span></span><span class="koboSpan" id="kobo.253.1"> (value === </span><span class="hljs-literal"><span class="koboSpan" id="kobo.254.1">undefined</span></span><span class="koboSpan" id="kobo.255.1">) {
    value = initialState
  }
</span></code></pre>
<ol>
<li class="numberedList" value="3"><span class="koboSpan" id="kobo.256.1">Try entering some text into the input field again; you will see that our Hook function works now!</span></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.257.1">Now, our </span><code class="inlineCode"><span class="koboSpan" id="kobo.258.1">useState</span></code><span class="koboSpan" id="kobo.259.1"> function uses the global </span><code class="inlineCode"><span class="koboSpan" id="kobo.260.1">value</span></code><span class="koboSpan" id="kobo.261.1"> variable instead of defining the </span><code class="inlineCode"><span class="koboSpan" id="kobo.262.1">value</span></code><span class="koboSpan" id="kobo.263.1"> variable within its closure, so it will not get reinitialized when the function gets called again. </span><span class="koboSpan" id="kobo.263.2">While our Hook function currently works fine, if we wanted to add another Hook, we would run into another problem: all Hooks write to the same global </span><code class="inlineCode"><span class="koboSpan" id="kobo.264.1">value</span></code><span class="koboSpan" id="kobo.265.1"> variable! </span><span class="koboSpan" id="kobo.265.2">Letâ€™s take a closer look at this problem by adding a second Hook to our component.</span></p>
<h3 class="heading-3" id="_idParaDest-52"><a id="_idTextAnchor054"/><span class="koboSpan" id="kobo.266.1">Defining multiple Hooks</span></h3>
<p class="normal"><span class="koboSpan" id="kobo.267.1">Letâ€™s say we want to create a second</span><a id="_idIndexMarker079"/><span class="koboSpan" id="kobo.268.1"> field for the last name of the user. </span><span class="koboSpan" id="kobo.268.2">We can achieve it by following these steps:</span></p>
<ol>
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.269.1">Edit </span><code class="inlineCode"><span class="koboSpan" id="kobo.270.1">src/App.jsx</span></code><span class="koboSpan" id="kobo.271.1"> and start by defining a new Hook at the beginning of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.272.1">App</span></code><span class="koboSpan" id="kobo.273.1"> component, after the current Hook:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.274.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.275.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.276.1">App</span></span><span class="koboSpan" id="kobo.277.1">() {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.278.1">const</span></span><span class="koboSpan" id="kobo.279.1"> [name, setName] = </span><span class="hljs-title"><span class="koboSpan" id="kobo.280.1">useState</span></span><span class="koboSpan" id="kobo.281.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.282.1">''</span></span><span class="koboSpan" id="kobo.283.1">)
</span><code class="codeHighlighted" style="font-weight: bold;"> </code><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.284.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.285.1"> [lastName, setLastName] = </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.286.1">useState</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.287.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.288.1">''</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.289.1">)</span></strong></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.290.1">Then, define a function to handle changing the last name:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.291.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.292.1">handleLastNameChange</span></span><span class="koboSpan" id="kobo.293.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.294.1">evt</span></span><span class="koboSpan" id="kobo.295.1">) {
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.296.1">setLastName</span></span><span class="koboSpan" id="kobo.297.1">(evt.</span><span class="hljs-property"><span class="koboSpan" id="kobo.298.1">target</span></span><span class="koboSpan" id="kobo.299.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.300.1">value</span></span><span class="koboSpan" id="kobo.301.1">)
  }
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.302.1">Next, show the </span><code class="inlineCode"><span class="koboSpan" id="kobo.303.1">lastName</span></code><span class="koboSpan" id="kobo.304.1"> value after the first name:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.305.1">return</span></span><span class="koboSpan" id="kobo.306.1"> (
    &lt;div&gt;
      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.307.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.308.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.309.1">&gt;</span></span><span class="koboSpan" id="kobo.310.1">My name is: {name} </span><span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.311.1">{lastName}</span></strong></span><span class="hljs-tag"><span class="koboSpan" id="kobo.312.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.313.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.314.1">&gt;</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.315.1">Finally, add another </span><code class="inlineCode"><span class="koboSpan" id="kobo.316.1">input</span></code><span class="koboSpan" id="kobo.317.1"> field for the last name:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="koboSpan" id="kobo.318.1">      &lt;</span><span class="hljs-name"><span class="koboSpan" id="kobo.319.1">input</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.320.1">type</span></span><span class="koboSpan" id="kobo.321.1">=</span><span class="hljs-string"><span class="koboSpan" id="kobo.322.1">'text'</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.323.1">value</span></span><span class="koboSpan" id="kobo.324.1">=</span><span class="hljs-string"><span class="koboSpan" id="kobo.325.1">{name}</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.326.1">onChange</span></span><span class="koboSpan" id="kobo.327.1">=</span><span class="hljs-string"><span class="koboSpan" id="kobo.328.1">{handleChange}</span></span><span class="koboSpan" id="kobo.329.1"> /&gt;
      </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.330.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.331.1">input</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.332.1">type</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.333.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.334.1">'text'</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.335.1">value</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.336.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.337.1">{lastName}</span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.338.1">onChange</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.339.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.340.1">{handleLastNameChange}</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.341.1"> /&gt;</span></strong></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.342.1">Try entering the</span><a id="_idIndexMarker080"/><span class="koboSpan" id="kobo.343.1"> first name and last name now.</span></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.344.1">You will notice that our reimplemented Hook function uses the same value for both states, so we are always changing both fields at once. </span><span class="koboSpan" id="kobo.344.2">Letâ€™s attempt to fix that now.</span></p>
<h3 class="heading-3" id="_idParaDest-53"><a id="_idTextAnchor055"/><span class="koboSpan" id="kobo.345.1">Adding support for multiple Hooks</span></h3>
<p class="normal"><span class="koboSpan" id="kobo.346.1">To add support for</span><a id="_idIndexMarker081"/><span class="koboSpan" id="kobo.347.1"> multiple Hooks, we need to store an array of Hook values instead of a single global variable. </span><span class="koboSpan" id="kobo.347.2">We are now going to refactor the </span><code class="inlineCode"><span class="koboSpan" id="kobo.348.1">value</span></code><span class="koboSpan" id="kobo.349.1"> variable to a </span><code class="inlineCode"><span class="koboSpan" id="kobo.350.1">values</span></code><span class="koboSpan" id="kobo.351.1"> array with the following steps:</span></p>
<ol>
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.352.1">Edit </span><code class="inlineCode"><span class="koboSpan" id="kobo.353.1">src/App.jsx</span></code><span class="koboSpan" id="kobo.354.1"> and </span><em class="italic"><span class="koboSpan" id="kobo.355.1">remove</span></em><span class="koboSpan" id="kobo.356.1"> the following line of code:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.357.1">let</span></span><span class="koboSpan" id="kobo.358.1"> value
</span></code></pre>
</li>
</ol>
<p class="normal-one"><em class="italic"><span class="koboSpan" id="kobo.359.1">Replace</span></em><span class="koboSpan" id="kobo.360.1"> it with the following code snippet:</span></p>
<pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.361.1">let</span></span><span class="koboSpan" id="kobo.362.1"> values = []
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.363.1">let</span></span><span class="koboSpan" id="kobo.364.1"> currentHook = </span><span class="hljs-number"><span class="koboSpan" id="kobo.365.1">0</span></span>
</code></pre>
<ol>
<li class="numberedList" value="2"><span class="koboSpan" id="kobo.366.1">Then, edit the first line of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.367.1">useState</span></code><span class="koboSpan" id="kobo.368.1"> function, where we now initialize the value at the </span><code class="inlineCode"><span class="koboSpan" id="kobo.369.1">currentHook</span></code><span class="koboSpan" id="kobo.370.1"> index of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.371.1">values</span></code><span class="koboSpan" id="kobo.372.1"> array:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.373.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.374.1">useState</span></span><span class="koboSpan" id="kobo.375.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.376.1">initialState</span></span><span class="koboSpan" id="kobo.377.1">) {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.378.1">if</span></span><span class="koboSpan" id="kobo.379.1"> (</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.380.1">values[currentHook]</span></strong></span><span class="koboSpan" id="kobo.381.1"> === </span><span class="hljs-literal"><span class="koboSpan" id="kobo.382.1">undefined</span></span><span class="koboSpan" id="kobo.383.1">) {
    </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.384.1">values[currentHook]</span></strong></span><span class="koboSpan" id="kobo.385.1"> = initialState
  }
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.386.1">We also need to </span><a id="_idIndexMarker082"/><span class="koboSpan" id="kobo.387.1">update the setter function so that only the corresponding state value is updated. </span><span class="koboSpan" id="kobo.387.2">Here, we need to first store the </span><code class="inlineCode"><span class="koboSpan" id="kobo.388.1">currentHook</span></code><span class="koboSpan" id="kobo.389.1"> value in a separate </span><code class="inlineCode"><span class="koboSpan" id="kobo.390.1">hookIndex</span></code><span class="koboSpan" id="kobo.391.1"> variable, because the </span><code class="inlineCode"><span class="koboSpan" id="kobo.392.1">currentHook</span></code><span class="koboSpan" id="kobo.393.1"> value will change later. </span><span class="koboSpan" id="kobo.393.2">This ensures that a copy of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.394.1">currentHook</span></code><span class="koboSpan" id="kobo.395.1"> variable is created within the closure of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.396.1">useState</span></code><span class="koboSpan" id="kobo.397.1"> function. </span><span class="koboSpan" id="kobo.397.2">Otherwise, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.398.1">useState</span></code><span class="koboSpan" id="kobo.399.1"> function would access the </span><code class="inlineCode"><span class="koboSpan" id="kobo.400.1">currentHook</span></code><span class="koboSpan" id="kobo.401.1"> variable from the outer closure, which gets modified with each call to </span><code class="inlineCode"><span class="koboSpan" id="kobo.402.1">useState</span></code><span class="koboSpan" id="kobo.403.1">:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.404.1">let</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.405.1"> hookIndex = currentHook</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.406.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.407.1">setState</span></span><span class="koboSpan" id="kobo.408.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.409.1">nextValue</span></span><span class="koboSpan" id="kobo.410.1">) {
    </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.411.1">values[hookIndex]</span></strong></span><span class="koboSpan" id="kobo.412.1"> = nextValue
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.413.1">renderApp</span></span><span class="koboSpan" id="kobo.414.1">()
  }
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.415.1">Edit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.416.1">return</span></code><span class="koboSpan" id="kobo.417.1"> statement of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.418.1">useState</span></code><span class="koboSpan" id="kobo.419.1"> function as follows:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.420.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.421.1"> value = values[currentHook++]</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.422.1">return</span></span><span class="koboSpan" id="kobo.423.1"> [</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.424.1">value</span></strong></span><span class="koboSpan" id="kobo.425.1">, setState]
}
</span></code></pre>
</li>
</ol>
<p class="normal-one"><span class="koboSpan" id="kobo.426.1">Using </span><code class="inlineCode"><span class="koboSpan" id="kobo.427.1">values[currentHook++]</span></code><span class="koboSpan" id="kobo.428.1">, we pass the current value of </span><code class="inlineCode"><span class="koboSpan" id="kobo.429.1">currentHook</span></code><span class="koboSpan" id="kobo.430.1"> as an index to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.431.1">values</span></code><span class="koboSpan" id="kobo.432.1"> array and then increase the </span><code class="inlineCode"><span class="koboSpan" id="kobo.433.1">currentHook</span></code><span class="koboSpan" id="kobo.434.1"> value by one. </span><span class="koboSpan" id="kobo.434.2">This means that </span><code class="inlineCode"><span class="koboSpan" id="kobo.435.1">currentHook</span></code><span class="koboSpan" id="kobo.436.1"> will be increased after returning from the function.</span></p>
<div class="note-one">
<p class="normal"><span class="koboSpan" id="kobo.437.1">If we wanted to first increment a value and then use it, we could use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.438.1">arr[++indexToBeIncremented]</span></code><span class="koboSpan" id="kobo.439.1"> syntax, which first increments and then passes the result to the array.</span></p>
</div>
<ol>
<li class="numberedList" value="5"><span class="koboSpan" id="kobo.440.1">We still need to reset the </span><code class="inlineCode"><span class="koboSpan" id="kobo.441.1">currentHook</span></code><span class="koboSpan" id="kobo.442.1"> counter when we start rendering our component. </span><span class="koboSpan" id="kobo.442.2">Add the following line right after the component definition:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.443.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.444.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.445.1">App</span></span><span class="koboSpan" id="kobo.446.1">() {
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.447.1">  currentHook = </span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.448.1">0</span></strong></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.449.1">Try entering the first name and last name again.</span></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.450.1">Finally, our simple </span><a id="_idIndexMarker083"/><span class="koboSpan" id="kobo.451.1">reimplementation of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.452.1">useState</span></code><span class="koboSpan" id="kobo.453.1"> Hook works! </span><span class="koboSpan" id="kobo.453.2">The following screenshot highlights this:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.454.1"><img alt="Figure 2.1 â€“ Our custom Hook reimplementation works!" src="../Images/B31327_02_01.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.455.1">Figure 2.1 â€“ Our custom Hook reimplementation works!</span></p>
<p class="normal"><span class="koboSpan" id="kobo.456.1">As we can see, using a global array to store our Hook values solved the problems that we had when defining multiple Hooks.</span></p>
<div class="note">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.457.1">Example code</span></strong></p>
<p class="normal"><span class="koboSpan" id="kobo.458.1">The example code for this section can be found in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.459.1">Chapter02/Chapter02_1</span></code><span class="koboSpan" id="kobo.460.1"> folder. </span><span class="koboSpan" id="kobo.460.2">Check the </span><code class="inlineCode"><span class="koboSpan" id="kobo.461.1">README.md</span></code><span class="koboSpan" id="kobo.462.1"> file inside the folder for instructions on how to set up and run the example.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.463.1">After resolving the problems we had with our custom Hook implementation, letâ€™s find out more about the limitations of Hooks in general.</span></p>
<h2 class="heading-2" id="_idParaDest-54"><a id="_idTextAnchor056"/><span class="koboSpan" id="kobo.464.1">Can we define conditional Hooks?</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.465.1">What if we wanted to add a checkbox</span><a id="_idIndexMarker084"/><span class="koboSpan" id="kobo.466.1"> that toggles the use of the first name field? </span><span class="koboSpan" id="kobo.466.2">Letâ€™s find out by implementing such a checkbox:</span></p>
<ol>
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.467.1">Copy the </span><code class="inlineCode"><span class="koboSpan" id="kobo.468.1">Chapter02_1</span></code><span class="koboSpan" id="kobo.469.1"> folder to a new </span><code class="inlineCode"><span class="koboSpan" id="kobo.470.1">Chapter02_2</span></code><span class="koboSpan" id="kobo.471.1"> folder, as follows:
        </span><pre class="programlisting con-one"><code class="hljs-con"><span class="koboSpan" id="kobo.472.1">$ cp -R Chapter02_1 Chapter02_2
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.473.1">Open the new </span><code class="inlineCode"><span class="koboSpan" id="kobo.474.1">Chapter02_2</span></code><span class="koboSpan" id="kobo.475.1"> folder in VS Code.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.476.1">Edit </span><code class="inlineCode"><span class="koboSpan" id="kobo.477.1">src/App.jsx</span></code><span class="koboSpan" id="kobo.478.1"> and add a new Hook to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.479.1">App</span></code><span class="koboSpan" id="kobo.480.1"> component, which will store the state of the checkbox:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.481.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.482.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.483.1">App</span></span><span class="koboSpan" id="kobo.484.1">() {
  currentHook = </span><span class="hljs-number"><span class="koboSpan" id="kobo.485.1">0</span></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.486.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.487.1"> [enableFirstName, setEnableFirstName] = </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.488.1">useState</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.489.1">(</span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.490.1">false</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.491.1">)</span></strong></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.492.1">Then, adjust the Hook for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.493.1">name</span></code><span class="koboSpan" id="kobo.494.1"> state to only be used when the first name is enabled:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.495.1">// eslint-disable-next-line react-hooks/rules-of-hooks</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.496.1">const</span></span><span class="koboSpan" id="kobo.497.1"> [name, setName] = </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.498.1">enableFirstName ?</span></strong></span> <span class="hljs-title"><span class="koboSpan" id="kobo.499.1">useState</span></span><span class="koboSpan" id="kobo.500.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.501.1">''</span></span><span class="koboSpan" id="kobo.502.1">)</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.503.1"> : [</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.504.1">''</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.505.1">, </span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.506.1">() =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.507.1"> {}]</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.508.1">const</span></span><span class="koboSpan" id="kobo.509.1"> [lastName, setLastName] = </span><span class="hljs-title"><span class="koboSpan" id="kobo.510.1">useState</span></span><span class="koboSpan" id="kobo.511.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.512.1">''</span></span><span class="koboSpan" id="kobo.513.1">)
</span></code></pre>
</li>
</ol>
<p class="normal-one"><span class="koboSpan" id="kobo.514.1">We need to disable ESLint for this line; otherwise, it will yell at us, telling us that Hooks cannot be used conditionally. </span><span class="koboSpan" id="kobo.514.2">For the purposes of this demonstration, I want to show what happens when you ignore this warning, though.</span></p>
<p class="normal-one"><span class="koboSpan" id="kobo.515.1">We also define a fallback to an empty string (</span><code class="inlineCode"><span class="koboSpan" id="kobo.516.1">''</span></code><span class="koboSpan" id="kobo.517.1">) and a function that does nothing (</span><code class="inlineCode"><span class="koboSpan" id="kobo.518.1">() =&gt; {}</span></code><span class="koboSpan" id="kobo.519.1">) when the Hook is not defined.</span></p>
<ol>
<li class="numberedList" value="5"><span class="koboSpan" id="kobo.520.1">Next, define a </span><a id="_idIndexMarker085"/><span class="koboSpan" id="kobo.521.1">handler function for changing the checkbox state:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.522.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.523.1">handleEnableChange</span></span><span class="koboSpan" id="kobo.524.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.525.1">evt</span></span><span class="koboSpan" id="kobo.526.1">) {
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.527.1">setEnableFirstName</span></span><span class="koboSpan" id="kobo.528.1">(evt.</span><span class="hljs-property"><span class="koboSpan" id="kobo.529.1">target</span></span><span class="koboSpan" id="kobo.530.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.531.1">checked</span></span><span class="koboSpan" id="kobo.532.1">)
  }
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.533.1">Finally, render the checkbox:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.534.1">return</span></span><span class="koboSpan" id="kobo.535.1"> (
    &lt;div&gt;
      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.536.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.537.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.538.1">&gt;</span></span><span class="koboSpan" id="kobo.539.1">
        My name is: {name} {lastName}
      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.540.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.541.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.542.1">&gt;</span></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.543.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.544.1">input</span></strong></span>
<span class="code-highlight"><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.545.1">type</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.546.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.547.1">'checkbox'</span></strong></span>
<span class="code-highlight"><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.548.1">value</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.549.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.550.1">{enableFirstName}</span></strong></span>
<span class="code-highlight"><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.551.1">onChange</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.552.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.553.1">{handleEnableChange}</span></strong></span>
<span class="code-highlight"><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.554.1">      /&gt;</span></strong></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.555.1">Start the </span><code class="inlineCode"><span class="koboSpan" id="kobo.556.1">dev</span></code><span class="koboSpan" id="kobo.557.1"> server and then open the link in your browser:
        </span><pre class="programlisting con-one"><code class="hljs-con"><span class="koboSpan" id="kobo.558.1">$ npm run dev
</span></code></pre>
</li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.559.1">Here, we either use the </span><a id="_idIndexMarker086"/><span class="koboSpan" id="kobo.560.1">Hook or, if the first name is disabled, we return the initial state and an empty setter function, so that editing the input field will not work.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.561.1">If we now try out this code, we are going to notice that editing the last name still works, but editing the first name does not work, which is what we wanted. </span><span class="koboSpan" id="kobo.561.2">As we can see in the following screenshot, only editing the last name works now:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.562.1"><img alt="Figure 2.2 â€“ State of the app before checking the checkbox" src="../Images/B31327_02_02.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.563.1">Figure 2.2 â€“ State of the app before checking the checkbox</span></p>
<p class="normal"><span class="koboSpan" id="kobo.564.1">When we click the checkbox, something strange happens:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.565.1">The checkbox gets checked</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.566.1">The first name input field gets enabled</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.567.1">The value of the last name field is now the value of the first name field</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.568.1">We can see the result of clicking the checkbox in the following screenshot:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.569.1"><img alt="Figure 2.3 â€“ State of the app after clicking the checkbox" src="../Images/B31327_02_03.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.570.1">Figure 2.3 â€“ State of the app after clicking the checkbox</span></p>
<p class="normal"><span class="koboSpan" id="kobo.571.1">We can see that the last </span><a id="_idIndexMarker087"/><span class="koboSpan" id="kobo.572.1">name state is now in the first name field. </span><span class="koboSpan" id="kobo.572.2">The value gets swapped because the order of Hooks matters. </span><span class="koboSpan" id="kobo.572.3">As we know from our implementation, we use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.573.1">currentHook</span></code><span class="koboSpan" id="kobo.574.1"> index to find out where the state of each Hook is stored. </span><span class="koboSpan" id="kobo.574.2">However, when we insert an additional Hook in between two existing Hooks, the order gets messed up.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.575.1">Before checking the checkbox, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.576.1">values</span></code><span class="koboSpan" id="kobo.577.1"> array was as follows:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.578.1">[false, '']</span></code></li>
<li class="bulletList"><span class="koboSpan" id="kobo.579.1">Hook order: </span><code class="inlineCode"><span class="koboSpan" id="kobo.580.1">enableFirstName</span></code><span class="koboSpan" id="kobo.581.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.582.1">lastName</span></code></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.583.1">Then, we entered some text in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.584.1">lastName</span></code><span class="koboSpan" id="kobo.585.1"> field:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.586.1">[false, 'Hook']</span></code></li>
<li class="bulletList"><span class="koboSpan" id="kobo.587.1">Hook order: </span><code class="inlineCode"><span class="koboSpan" id="kobo.588.1">enableFirstName</span></code><span class="koboSpan" id="kobo.589.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.590.1">lastName</span></code></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.591.1">Next, we clicked the checkbox, which activated another Hook:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.592.1">[true, 'Hook', '']</span></code></li>
<li class="bulletList"><span class="koboSpan" id="kobo.593.1">Hook order: </span><code class="inlineCode"><span class="koboSpan" id="kobo.594.1">enableFirstName</span></code><span class="koboSpan" id="kobo.595.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.596.1">name</span></code><span class="koboSpan" id="kobo.597.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.598.1">lastName</span></code></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.599.1">As we can see, inserting a new Hook in between two existing Hooks makes the </span><code class="inlineCode"><span class="koboSpan" id="kobo.600.1">name</span></code><span class="koboSpan" id="kobo.601.1"> Hook </span><em class="italic"><span class="koboSpan" id="kobo.602.1">steal</span></em><span class="koboSpan" id="kobo.603.1"> the state from the next Hook (</span><code class="inlineCode"><span class="koboSpan" id="kobo.604.1">lastName</span></code><span class="koboSpan" id="kobo.605.1">) because it now has the same index that the </span><code class="inlineCode"><span class="koboSpan" id="kobo.606.1">lastName</span></code><span class="koboSpan" id="kobo.607.1"> Hook previously had. </span><span class="koboSpan" id="kobo.607.2">Now, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.608.1">lastName</span></code><span class="koboSpan" id="kobo.609.1"> Hook does not have a value, which causes it to set the initial value (an empty string). </span></p>
<p class="normal"><span class="koboSpan" id="kobo.610.1">As a result, toggling the checkbox puts the value of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.611.1">lastName</span></code><span class="koboSpan" id="kobo.612.1"> field into the </span><code class="inlineCode"><span class="koboSpan" id="kobo.613.1">name</span></code><span class="koboSpan" id="kobo.614.1"> field and leaves the </span><code class="inlineCode"><span class="koboSpan" id="kobo.615.1">lastName</span></code><span class="koboSpan" id="kobo.616.1"> field empty.</span></p>
<div class="note">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.617.1">Example code</span></strong></p>
<p class="normal"><span class="koboSpan" id="kobo.618.1">The example code for this section can be found in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.619.1">Chapter02/Chapter02_2</span></code><span class="koboSpan" id="kobo.620.1"> folder. </span><span class="koboSpan" id="kobo.620.2">Check the </span><code class="inlineCode"><span class="koboSpan" id="kobo.621.1">README.md</span></code><span class="koboSpan" id="kobo.622.1"> file inside the folder for instructions on how to set up and run the example.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.623.1">After learning that </span><a id="_idIndexMarker088"/><span class="koboSpan" id="kobo.624.1">Hooks always need to be called in the same order, letâ€™s compare our custom Hook implementation to real React Hooks.</span></p>
<h2 class="heading-2" id="_idParaDest-55"><a id="_idTextAnchor057"/><span class="koboSpan" id="kobo.625.1">Comparing our reimplementation to real Hooks</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.626.1">Our simple Hook implementation already gives us an idea of how Hooks work internally. </span><span class="koboSpan" id="kobo.626.2">However, in reality, Hooks do not use global variables. </span><span class="koboSpan" id="kobo.626.3">Instead, they store state within the React component. </span><span class="koboSpan" id="kobo.626.4">They also deal with the Hook counter internally, so we do not need to manually reset the count in function components. </span><span class="koboSpan" id="kobo.626.5">Additionally, real Hooks automatically trigger rerenders of components when the state changes. </span><span class="koboSpan" id="kobo.626.6">To be able to do this, however, Hooks need to be called from a React function component. </span><span class="koboSpan" id="kobo.626.7">React Hooks cannot be called outside of React or inside React class components.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.627.1">By reimplementing</span><a id="_idIndexMarker089"/><span class="koboSpan" id="kobo.628.1"> the </span><code class="inlineCode"><span class="koboSpan" id="kobo.629.1">useState</span></code><span class="koboSpan" id="kobo.630.1"> Hook, we have learned the following:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.631.1">Hooks are functions that access React features</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.632.1">Hooks deal with side effects that persist across rerenders</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.633.1">The order of Hook definitions matters</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.634.1">The final point is especially important because it means that we cannot conditionally define Hooks. </span><span class="koboSpan" id="kobo.634.2">We should always have all Hook definitions at the beginning of a function component and never nest them within </span><code class="inlineCode"><span class="koboSpan" id="kobo.635.1">if</span></code><span class="koboSpan" id="kobo.636.1"> statements, ternaries, or similar constructs.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.637.1">So, we have also learned the following:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.638.1">React Hooks need to be called inside React function components or other Hooks</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.639.1">React Hooks cannot be defined conditionally or in loops</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.640.1">There are some additional limitations</span><a id="_idIndexMarker090"/><span class="koboSpan" id="kobo.641.1"> of React Hooks, resulting from the limitations we have learned about:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.642.1">React Hooks cannot be defined after a conditional </span><code class="inlineCode"><span class="koboSpan" id="kobo.643.1">return</span></code><span class="koboSpan" id="kobo.644.1"> statement</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.645.1">React Hooks cannot be defined in event handlers</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.646.1">React Hooks cannot be defined inside </span><code class="inlineCode"><span class="koboSpan" id="kobo.647.1">try</span></code><span class="koboSpan" id="kobo.648.1">/</span><code class="inlineCode"><span class="koboSpan" id="kobo.649.1">catch</span></code><span class="koboSpan" id="kobo.650.1">/</span><code class="inlineCode"><span class="koboSpan" id="kobo.651.1">finally</span></code><span class="koboSpan" id="kobo.652.1"> blocks</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.653.1">React Hooks cannot be defined in the functions passed to </span><code class="inlineCode"><span class="koboSpan" id="kobo.654.1">useMemo</span></code><span class="koboSpan" id="kobo.655.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.656.1">useReducer</span></code><span class="koboSpan" id="kobo.657.1">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.658.1">useEffect</span></code><span class="koboSpan" id="kobo.659.1"> (we will learn more about these three Hooks throughout the book, but just keep this limitation in mind for now)</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.660.1">We are now going to look at alternative Hook APIs that would allow conditional Hooks, but they come with their own downsides.</span></p>
<h1 class="heading-1" id="_idParaDest-56"><a id="_idTextAnchor058"/><span class="koboSpan" id="kobo.661.1">Potential alternative Hook APIs</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.662.1">Sometimes, it would be nice to define </span><a id="_idIndexMarker091"/><span class="koboSpan" id="kobo.663.1">Hooks conditionally or in loops, but why did the React team decide to implement Hooks like this? </span><span class="koboSpan" id="kobo.663.2">What are the alternatives? </span><span class="koboSpan" id="kobo.663.3">Letâ€™s go through some of them to get a feeling for the trade-offs involved in making this decision.</span></p>
<h2 class="heading-2" id="_idParaDest-57"><a id="_idTextAnchor059"/><span class="koboSpan" id="kobo.664.1">Named Hooks</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.665.1">We could give each Hook a name, and </span><a id="_idIndexMarker092"/><span class="koboSpan" id="kobo.666.1">then store the Hooks in an object instead of an array. </span><span class="koboSpan" id="kobo.666.2">However, this would not make such a nice API, and we would also always have to think of unique names for Hooks:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.667.1">// </span></span><span class="hljs-doctag"><span class="koboSpan" id="kobo.668.1">NOTE:</span></span><span class="hljs-comment"><span class="koboSpan" id="kobo.669.1"> Not the actual React Hook API</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.670.1">const</span></span><span class="koboSpan" id="kobo.671.1"> [name, setName] = </span><span class="hljs-title"><span class="koboSpan" id="kobo.672.1">useState</span></span><span class="koboSpan" id="kobo.673.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.674.1">'nameHook'</span></span><span class="koboSpan" id="kobo.675.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.676.1">''</span></span><span class="koboSpan" id="kobo.677.1">)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.678.1">Additionally, there are unresolved questions: What would happen when a conditional is set to </span><code class="inlineCode"><span class="koboSpan" id="kobo.679.1">false</span></code><span class="koboSpan" id="kobo.680.1"> or an item is removed from a loop? </span><span class="koboSpan" id="kobo.680.2">Would we clear the Hook state? </span><span class="koboSpan" id="kobo.680.3">If we do not clear the Hook state, we might be causing memory leaks. </span><span class="koboSpan" id="kobo.680.4">If we do clear it, we might be unintentionally discarding user input.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.681.1">Even if we solved these problems, there would still be the problem of name collisions. </span><span class="koboSpan" id="kobo.681.2">If we, for example, create a Hook and call it </span><code class="inlineCode"><span class="koboSpan" id="kobo.682.1">nameHook</span></code><span class="koboSpan" id="kobo.683.1">, then we cannot call any other Hook </span><code class="inlineCode"><span class="koboSpan" id="kobo.684.1">nameHook</span></code><span class="koboSpan" id="kobo.685.1"> in our component anymore, or we will cause a name collision. </span><span class="koboSpan" id="kobo.685.2">This is even the case for Hook names from libraries, so we need to make sure to avoid name collisions with Hooks defined by libraries as well!</span></p>
<h2 class="heading-2" id="_idParaDest-58"><a id="_idTextAnchor060"/><span class="koboSpan" id="kobo.686.1">Hook factories</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.687.1">Alternatively, we could create a</span><a id="_idIndexMarker093"/><span class="koboSpan" id="kobo.688.1"> Hook factory function, which uses </span><code class="inlineCode"><span class="koboSpan" id="kobo.689.1">Symbol</span></code><span class="koboSpan" id="kobo.690.1"> internally to give each Hook a unique key name:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.691.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.692.1">createUseState</span></span><span class="koboSpan" id="kobo.693.1">() {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.694.1">const</span></span><span class="koboSpan" id="kobo.695.1"> keyName = </span><span class="hljs-title"><span class="koboSpan" id="kobo.696.1">Symbol</span></span><span class="koboSpan" id="kobo.697.1">()
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.698.1">return</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.699.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.700.1">useState</span></span><span class="koboSpan" id="kobo.701.1">() {
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.702.1">// â€¦use unique key name to handle hook stateâ€¦</span></span><span class="koboSpan" id="kobo.703.1">
  }
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.704.1">Then, we could use the factory function as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.705.1">// </span></span><span class="hljs-doctag"><span class="koboSpan" id="kobo.706.1">NOTE:</span></span><span class="hljs-comment"><span class="koboSpan" id="kobo.707.1"> Not the actual React Hook API</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.708.1">const</span></span><span class="koboSpan" id="kobo.709.1"> useNameState = </span><span class="hljs-title"><span class="koboSpan" id="kobo.710.1">createUseState</span></span><span class="koboSpan" id="kobo.711.1">()
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.712.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.713.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.714.1">App</span></span><span class="koboSpan" id="kobo.715.1"> () {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.716.1">const</span></span><span class="koboSpan" id="kobo.717.1"> [name, setName] = </span><span class="hljs-title"><span class="koboSpan" id="kobo.718.1">useNameState</span></span><span class="koboSpan" id="kobo.719.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.720.1">''</span></span><span class="koboSpan" id="kobo.721.1">)
  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.722.1">// â€¦</span></span><span class="koboSpan" id="kobo.723.1">
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.724.1">However, this means that we will need to instantiate each Hook twice: once outside of the component, and once inside the function component. </span><span class="koboSpan" id="kobo.724.2">This creates more room for error. </span><span class="koboSpan" id="kobo.724.3">For example, if we create two Hooks and copy and paste the boilerplate code, then we might make a mistake in the name of our Hook resulting from the factory function, or we might make a mistake when using the Hook inside the component.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.725.1">This approach also makes it much harder to create custom Hooks, forcing us to write wrapper functions. </span><span class="koboSpan" id="kobo.725.2">Additionally, it is</span><a id="_idIndexMarker094"/><span class="koboSpan" id="kobo.726.1"> harder to debug these wrapped functions than it is to debug a simple function.</span></p>
<h2 class="heading-2" id="_idParaDest-59"><a id="_idTextAnchor061"/><span class="koboSpan" id="kobo.727.1">Other alternatives</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.728.1">There were many proposed alternative APIs for React Hooks, but each of them suffered from similar problems: either making the API harder to use, less flexible, harder to debug, or introducing the possibility of name collisions.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.729.1">In the end, the React team decided that the simplest API was to keep track of Hooks by counting the order in which they were called. </span><span class="koboSpan" id="kobo.729.2">This approach comes with its own downsides, such as not being able to call Hooks conditionally or in loops. </span><span class="koboSpan" id="kobo.729.3">However, this approach makes it very easy to create custom Hooks, and it is simple to use and debug. </span><span class="koboSpan" id="kobo.729.4">We also do not need to worry about naming Hooks, name collisions, or writing wrapper functions. </span><span class="koboSpan" id="kobo.729.5">The final approach for Hooks lets us use Hooks just like any other function!</span></p>
<p class="normal"><span class="koboSpan" id="kobo.730.1">Now that we have learned about</span><a id="_idIndexMarker095"/><span class="koboSpan" id="kobo.731.1"> the various proposals and the final Hook implementation, letâ€™s learn how to solve common problems resulting from the limitations of the chosen official API.</span></p>
<h1 class="heading-1" id="_idParaDest-60"><a id="_idTextAnchor062"/><span class="koboSpan" id="kobo.732.1">Solving common problems with Hooks</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.733.1">As we found out, implementing Hooks with the official API also has its own trade-offs and limitations. </span><span class="koboSpan" id="kobo.733.2">We are now going to learn how to overcome these common problems, which stem from the limitations of React Hooks.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.734.1">We will take a look at solutions that can be used to overcome these two problems:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.735.1">Solving conditional Hooks</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.736.1">Solving Hooks in loops</span></li>
</ul>
<h2 class="heading-2" id="_idParaDest-61"><a id="_idTextAnchor063"/><span class="koboSpan" id="kobo.737.1">Solving conditional Hooks</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.738.1">So, how do we implement</span><a id="_idIndexMarker096"/><span class="koboSpan" id="kobo.739.1"> conditional Hooks? </span><span class="koboSpan" id="kobo.739.2">Instead of making the Hook conditional, we can just always define the Hook and use it whenever we need it. </span><span class="koboSpan" id="kobo.739.3">If this is not an option, we need to split up our components, which is usually better anyway!</span></p>
<h3 class="heading-3" id="_idParaDest-62"><a id="_idTextAnchor064"/><span class="koboSpan" id="kobo.740.1">Always defining the Hook</span></h3>
<p class="normal"><span class="koboSpan" id="kobo.741.1">For simple cases, such as the first and last name example that we had previously, we can just always keep the Hook defined, as follows:</span></p>
<ol>
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.742.1">Copy the </span><code class="inlineCode"><span class="koboSpan" id="kobo.743.1">Chapter02_2</span></code><span class="koboSpan" id="kobo.744.1"> folder to a new </span><code class="inlineCode"><span class="koboSpan" id="kobo.745.1">Chapter02_3</span></code><span class="koboSpan" id="kobo.746.1"> folder, as follows:
        </span><pre class="programlisting con-one"><code class="hljs-con"><span class="koboSpan" id="kobo.747.1">$ cp -R Chapter02_2 Chapter02_3
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.748.1">Open the new </span><code class="inlineCode"><span class="koboSpan" id="kobo.749.1">Chapter02_3</span></code><span class="koboSpan" id="kobo.750.1"> folder in VS Code.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.751.1">Edit </span><code class="inlineCode"><span class="koboSpan" id="kobo.752.1">src/App.jsx</span></code><span class="koboSpan" id="kobo.753.1"> and </span><em class="italic"><span class="koboSpan" id="kobo.754.1">remove</span></em><span class="koboSpan" id="kobo.755.1"> the following two lines:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-comment"><span class="koboSpan" id="kobo.756.1">// eslint-disable-next-line react-hooks/rules-of-hooks</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.757.1">const</span></span><span class="koboSpan" id="kobo.758.1"> [name, setName] = enableFirstName ? </span><span class="hljs-title"><span class="koboSpan" id="kobo.759.1">useState</span></span><span class="koboSpan" id="kobo.760.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.761.1">''</span></span><span class="koboSpan" id="kobo.762.1">) : [</span><span class="hljs-string"><span class="koboSpan" id="kobo.763.1">''</span></span><span class="koboSpan" id="kobo.764.1">, () =&gt; {}]
</span></code></pre>
</li>
</ol>
<p class="normal-one"><em class="italic"><span class="koboSpan" id="kobo.765.1">Replace</span></em><span class="koboSpan" id="kobo.766.1"> them with the following:</span></p>
<pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.767.1">const</span></span><span class="koboSpan" id="kobo.768.1"> [name, setName] = </span><span class="hljs-title"><span class="koboSpan" id="kobo.769.1">useState</span></span><span class="koboSpan" id="kobo.770.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.771.1">''</span></span><span class="koboSpan" id="kobo.772.1">)
</span></code></pre>
<ol>
<li class="numberedList" value="4"><span class="koboSpan" id="kobo.773.1">Now, we need to move the conditional down to where the first name gets rendered instead:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.774.1">return</span></span><span class="koboSpan" id="kobo.775.1"> (
    &lt;div&gt;
      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.776.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.777.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.778.1">&gt;</span></span><span class="koboSpan" id="kobo.779.1">
        My name is: </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.780.1">{enableFirstName ? </span><span class="koboSpan" id="kobo.780.2">name : ''}</span></strong></span><span class="koboSpan" id="kobo.781.1"> {lastName}
      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.782.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.783.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.784.1">&gt;</span></span>
</code></pre>
</li>
</ol>
<div class="note-one">
<p class="normal"><span class="koboSpan" id="kobo.785.1">If you want to re-add the feature that the first name field cannot even be edited when it is not enabled, just add the following attribute to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.786.1">&lt;input&gt;</span></code><span class="koboSpan" id="kobo.787.1"> field: </span><code class="inlineCode"><span class="koboSpan" id="kobo.788.1">disabled={!enableFirstName}</span></code><span class="koboSpan" id="kobo.789.1">.</span></p>
</div>
<ol>
<li class="numberedList" value="5"><span class="koboSpan" id="kobo.790.1">Run the </span><code class="inlineCode"><span class="koboSpan" id="kobo.791.1">dev</span></code><span class="koboSpan" id="kobo.792.1"> server and then open the link in your browser:
        </span><pre class="programlisting con-one"><code class="hljs-con"><span class="koboSpan" id="kobo.793.1">$ npm run dev
</span></code></pre>
</li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.794.1">Now, our example works fine! </span><span class="koboSpan" id="kobo.794.2">Always defining the Hook is usually a good solution for simple cases. </span><span class="koboSpan" id="kobo.794.3">In more complex cases, it might not be feasible to always define the Hook. </span><span class="koboSpan" id="kobo.794.4">In that case, we would need to create a new component, define the Hook there, and then conditionally render the component.</span></p>
<div class="note">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.795.1">Example code</span></strong></p>
<p class="normal"><span class="koboSpan" id="kobo.796.1">The example code for this section can be found in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.797.1">Chapter02/Chapter02_3</span></code><span class="koboSpan" id="kobo.798.1"> folder. </span><span class="koboSpan" id="kobo.798.2">Check the </span><code class="inlineCode"><span class="koboSpan" id="kobo.799.1">README.md</span></code><span class="koboSpan" id="kobo.800.1"> file inside the folder for instructions on how to set up and run the example.</span></p>
</div>
<h3 class="heading-3" id="_idParaDest-63"><a id="_idTextAnchor065"/><span class="koboSpan" id="kobo.801.1">Splitting up components</span></h3>
<p class="normal"><span class="koboSpan" id="kobo.802.1">Another way to solve conditional Hooks is to split up one component into multiple components and then conditionally render the components. </span><span class="koboSpan" id="kobo.802.2">For example, letâ€™s say we want to fetch user information from a database after the user logs in.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.803.1">We cannot do the following, as </span><a id="_idIndexMarker097"/><span class="koboSpan" id="kobo.804.1">using an </span><code class="inlineCode"><span class="koboSpan" id="kobo.805.1">if</span></code><span class="koboSpan" id="kobo.806.1"> conditional could change the order of the Hooks:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.807.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.808.1">UserInfo</span></span><span class="koboSpan" id="kobo.809.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.810.1">{ username }</span></span><span class="koboSpan" id="kobo.811.1">) {
  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.812.1">// </span></span><span class="hljs-doctag"><span class="koboSpan" id="kobo.813.1">NOTE:</span></span><span class="hljs-comment"><span class="koboSpan" id="kobo.814.1"> Do NOT do this</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.815.1">if</span></span><span class="koboSpan" id="kobo.816.1"> (username) {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.817.1">const</span></span><span class="koboSpan" id="kobo.818.1"> info = </span><span class="hljs-title"><span class="koboSpan" id="kobo.819.1">useFetchUserInfo</span></span><span class="koboSpan" id="kobo.820.1">(username)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.821.1">return</span></span> <span class="hljs-tag"><span class="koboSpan" id="kobo.822.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.823.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.824.1">&gt;</span></span><span class="koboSpan" id="kobo.825.1">{info}</span><span class="hljs-tag"><span class="koboSpan" id="kobo.826.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.827.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.828.1">&gt;</span></span><span class="koboSpan" id="kobo.829.1">
  }
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.830.1">return</span></span> <span class="hljs-tag"><span class="koboSpan" id="kobo.831.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.832.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.833.1">&gt;</span></span><span class="koboSpan" id="kobo.834.1">Not logged in</span><span class="hljs-tag"><span class="koboSpan" id="kobo.835.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.836.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.837.1">&gt;</span></span><span class="koboSpan" id="kobo.838.1">
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.839.1">Instead, we have to create a separate component for when the user is logged in, as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.840.1">// </span></span><span class="hljs-doctag"><span class="koboSpan" id="kobo.841.1">NOTE:</span></span><span class="hljs-comment"><span class="koboSpan" id="kobo.842.1"> Do this instead</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.843.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.844.1">LoggedInUserInfo</span></span><span class="koboSpan" id="kobo.845.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.846.1">{ username }</span></span><span class="koboSpan" id="kobo.847.1">) {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.848.1">const</span></span><span class="koboSpan" id="kobo.849.1"> info = </span><span class="hljs-title"><span class="koboSpan" id="kobo.850.1">useFetchUserInfo</span></span><span class="koboSpan" id="kobo.851.1">(username)
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.852.1">return</span></span> <span class="hljs-tag"><span class="koboSpan" id="kobo.853.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.854.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.855.1">&gt;</span></span><span class="koboSpan" id="kobo.856.1">{info}</span><span class="hljs-tag"><span class="koboSpan" id="kobo.857.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.858.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.859.1">&gt;</span></span><span class="koboSpan" id="kobo.860.1">
}
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.861.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.862.1">UserInfo</span></span><span class="koboSpan" id="kobo.863.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.864.1">{ username }</span></span><span class="koboSpan" id="kobo.865.1">) {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.866.1">if</span></span><span class="koboSpan" id="kobo.867.1"> (username) {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.868.1">return</span></span> <span class="hljs-tag"><span class="koboSpan" id="kobo.869.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.870.1">LoggedInUserInfo</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.871.1">username</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.872.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.873.1">{username}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.874.1"> /&gt;</span></span><span class="koboSpan" id="kobo.875.1">
  }
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.876.1">return</span></span> <span class="hljs-tag"><span class="koboSpan" id="kobo.877.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.878.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.879.1">&gt;</span></span><span class="koboSpan" id="kobo.880.1">Not logged in</span><span class="hljs-tag"><span class="koboSpan" id="kobo.881.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.882.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.883.1">&gt;</span></span><span class="koboSpan" id="kobo.884.1">
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.885.1">Using two separate components for the non-logged-in and logged-in state makes sense anyway because we want to stick to the principle of having one functionality per component. </span><span class="koboSpan" id="kobo.885.2">Usually, not being able to</span><a id="_idIndexMarker098"/><span class="koboSpan" id="kobo.886.1"> have conditional Hooks is not much of a limitation if we stick to best practices.</span></p>
<h2 class="heading-2" id="_idParaDest-64"><a id="_idTextAnchor066"/><span class="koboSpan" id="kobo.887.1">Solving Hooks in loops</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.888.1">Sometimes, you may </span><a id="_idIndexMarker099"/><span class="koboSpan" id="kobo.889.1">have a case where you would want to define Hooks in loops â€“ for example, if you have a way to dynamically add new input fields and you need a State Hook for each of them.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.890.1">To solve problems where we would want to have Hooks in loops, we can either use a single State Hook containing an array or we can again split up our components. </span><span class="koboSpan" id="kobo.890.2">For example, letâ€™s say we want to display all the users that are online.</span></p>
<h3 class="heading-3" id="_idParaDest-65"><a id="_idTextAnchor067"/><span class="koboSpan" id="kobo.891.1">Using an array</span></h3>
<p class="normal"><span class="koboSpan" id="kobo.892.1">We could simply use an array that contains all users, as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.893.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.894.1">OnlineUsers</span></span><span class="koboSpan" id="kobo.895.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.896.1">{ users }</span></span><span class="koboSpan" id="kobo.897.1">) {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.898.1">const</span></span><span class="koboSpan" id="kobo.899.1"> [userInfos, setUserInfos] = </span><span class="hljs-title"><span class="koboSpan" id="kobo.900.1">useState</span></span><span class="koboSpan" id="kobo.901.1">([])
  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.902.1">// ... </span><span class="koboSpan" id="kobo.902.2">fetch &amp; keep userInfos up to date ...</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.903.1">return</span></span><span class="koboSpan" id="kobo.904.1"> (
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.905.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.906.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.907.1">&gt;</span></span><span class="koboSpan" id="kobo.908.1">
      {users.map((username) =&gt; {
        const user = userInfos.find((u) =&gt; u.username === username)
        return </span><span class="hljs-tag"><span class="koboSpan" id="kobo.909.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.910.1">UserInfo </span></span><span class="koboSpan" id="kobo.911.1">key={username}</span><span class="hljs-tag"><span class="koboSpan" id="kobo.912.1"> {</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.913.1">...user</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.914.1">} /&gt;</span></span><span class="koboSpan" id="kobo.915.1">
      })}
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.916.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.917.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.918.1">&gt;</span></span><span class="koboSpan" id="kobo.919.1">
  )
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.920.1">However, this might not always make sense. </span><span class="koboSpan" id="kobo.920.2">For example, we might not want to update the user state through the </span><code class="inlineCode"><span class="koboSpan" id="kobo.921.1">OnlineUsers</span></code><span class="koboSpan" id="kobo.922.1"> component because we would have to select the correct user state from the array and then modify the array. </span><span class="koboSpan" id="kobo.922.2">This might work but it is quite tedious.</span></p>
<h3 class="heading-3" id="_idParaDest-66"><a id="_idTextAnchor068"/><span class="koboSpan" id="kobo.923.1">Splitting up components</span></h3>
<p class="normal"><span class="koboSpan" id="kobo.924.1">A better solution would be to use the Hook in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.925.1">UserInfo</span></code><span class="koboSpan" id="kobo.926.1"> component instead. </span><span class="koboSpan" id="kobo.926.2">That way, we can keep the state for each user up to date, without having to deal with array logic:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.927.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.928.1">OnlineUsers</span></span><span class="koboSpan" id="kobo.929.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.930.1">{ users }</span></span><span class="koboSpan" id="kobo.931.1">) {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.932.1">return</span></span><span class="koboSpan" id="kobo.933.1"> (
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.934.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.935.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.936.1">&gt;</span></span><span class="koboSpan" id="kobo.937.1">
      {users.map((username) =&gt; (
        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.938.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.939.1">UserInfo</span></span><span class="koboSpan" id="kobo.940.1"> key={username}</span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.941.1">username</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.942.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.943.1">{username}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.944.1"> /&gt;</span></span><span class="koboSpan" id="kobo.945.1">
      ))}
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.946.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.947.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.948.1">&gt;</span></span><span class="koboSpan" id="kobo.949.1">
  )
}
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.950.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.951.1">UserInfo</span></span><span class="koboSpan" id="kobo.952.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.953.1">{ username }</span></span><span class="koboSpan" id="kobo.954.1">) {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.955.1">const</span></span><span class="koboSpan" id="kobo.956.1"> info = </span><span class="hljs-title"><span class="koboSpan" id="kobo.957.1">useFetchUserInfo</span></span><span class="koboSpan" id="kobo.958.1">(username)
  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.959.1">// ... </span><span class="koboSpan" id="kobo.959.2">keep user info up to date ...</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.960.1">return</span></span> <span class="hljs-tag"><span class="koboSpan" id="kobo.961.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.962.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.963.1">&gt;</span></span><span class="koboSpan" id="kobo.964.1">{info}</span><span class="hljs-tag"><span class="koboSpan" id="kobo.965.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.966.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.967.1">&gt;</span></span><span class="koboSpan" id="kobo.968.1">
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.969.1">As we can see, using </span><a id="_idIndexMarker100"/><span class="koboSpan" id="kobo.970.1">one component for each functionality keeps our code simple and concise, and also avoids the limitations of React Hooks.</span></p>
<h1 class="heading-1" id="_idParaDest-67"><a id="_idTextAnchor069"/><span class="koboSpan" id="kobo.971.1">Summary</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.972.1">In this chapter, we started out by reimplementing the </span><code class="inlineCode"><span class="koboSpan" id="kobo.973.1">useState</span></code><span class="koboSpan" id="kobo.974.1"> function, making use of global state and closures. </span><span class="koboSpan" id="kobo.974.2">We then learned that in order to support multiple Hooks, we need to keep track of them using an array. </span><span class="koboSpan" id="kobo.974.3">By using a state array, however, we were forced to keep the order of Hooks consistent across function calls. </span><span class="koboSpan" id="kobo.974.4">This limitation made conditional Hooks and Hooks in loops impossible. </span><span class="koboSpan" id="kobo.974.5">We then learned about potential alternatives to the Hook API, their trade-offs, and why the final API was chosen. </span><span class="koboSpan" id="kobo.974.6">Finally, we learned how to solve the common problems that stem from the limitations of Hooks. </span><span class="koboSpan" id="kobo.974.7">We now have a solid understanding of the inner workings and limitations of Hooks. </span><span class="koboSpan" id="kobo.974.8">Along the way, we also learned about the State Hook in depth.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.975.1">In the next chapter, we are going to create a blog application using the State Hook and learn how to combine multiple Hooks.</span></p>
<h1 class="heading-1" id="_idParaDest-68"><a id="_idTextAnchor070"/><span class="koboSpan" id="kobo.976.1">Questions</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.977.1">To recap what we have learned in this chapter, try to answer the following questions:</span></p>
<ol>
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.978.1">Which problems did we run into while developing our own reimplementation of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.979.1">useState</span></code><span class="koboSpan" id="kobo.980.1"> Hook? </span><span class="koboSpan" id="kobo.980.2">How did we solve these problems?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.981.1">Why are conditional Hooks not possible in the React implementation of Hooks?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.982.1">What do we need to watch out for when using Hooks?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.983.1">What are the common problems of alternative API ideas for Hooks?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.984.1">How do we implement conditional Hooks?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.985.1">How do we implement Hooks in loops?</span></li>
</ol>
<h1 class="heading-1" id="_idParaDest-69"><a id="_idTextAnchor071"/><span class="koboSpan" id="kobo.986.1">Further reading</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.987.1">If you are interested in more information about the concepts that we have learned in this chapter, take a look at the following links:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.988.1">More information on the flaws of alternative Hook APIs: </span><a href="https://overreacted.io/why-do-hooks-rely-on-call-order/"><span class="url"><span class="koboSpan" id="kobo.989.1">https://overreacted.io/why-do-hooks-rely-on-call-order/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.990.1">Official comment on alternative Hook APIs: </span><a href="https://github.com/reactjs/rfcs/pull/68#issuecomment-439314884"><span class="url"><span class="koboSpan" id="kobo.991.1">https://github.com/reactjs/rfcs/pull/68#issuecomment-439314884</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.992.1">Official documentation on the limitations and rules of Hooks: </span><a href="https://react.dev/reference/rules/rules-of-hooks"><span class="url"><span class="koboSpan" id="kobo.993.1">https://react.dev/reference/rules/rules-of-hooks</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.994.1">More information on how </span><code class="inlineCode"><span class="koboSpan" id="kobo.995.1">Symbol</span></code><span class="koboSpan" id="kobo.996.1"> works: </span><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol"><span class="url"><span class="koboSpan" id="kobo.997.1">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol</span></span></a></li>
</ul>
<h1 class="heading-1"><span class="koboSpan" id="kobo.998.1">Learn more on Discord</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.999.1">To join the Discord community for this book â€“ where you can share feedback, ask questions to the author, and learn about new releases â€“ follow the QR code below:</span></p>
<p class="normal"><a href="Chapter_02.xhtml"><span class="url"><span class="koboSpan" id="kobo.1000.1">https://packt.link/wnXT0</span></span></a></p>
<p class="normal"><span class="koboSpan" id="kobo.1001.1"><img alt="" src="../Images/image_%283%29.png"/></span></p>
</div>
</body></html>