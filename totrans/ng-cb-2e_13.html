<html><head></head><body>
<div class="Basic-Text-Frame" id="_idContainer312">
<h1 class="chapterNumber"><span class="koboSpan" id="kobo.1.1">13</span></h1>
<h1 class="chapterTitle" id="_idParaDest-447"><span class="koboSpan" id="kobo.2.1">Building PWAs with Angular</span></h1>
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.3.1">Progressive Web Apps</span></strong><span class="koboSpan" id="kobo.4.1"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.5.1">PWAs</span></strong><span class="koboSpan" id="kobo.6.1">) are far more than just web applications; they’re the</span><a id="_idIndexMarker1103"/><span class="koboSpan" id="kobo.7.1"> next evolution in web technology. </span><span class="koboSpan" id="kobo.7.2">Combining the best of web and mobile applications, PWAs provide an unparalleled user experience, even in less-than-ideal network conditions. </span><span class="koboSpan" id="kobo.7.3">But what makes them truly compelling is their graceful degradation — while they harness the full power of modern browsers, they also ensure a seamless, core experience in older browsers.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.8.1">In this chapter, we dive deep into the world of PWAs through the lens of Angular. </span><span class="koboSpan" id="kobo.8.2">Angular has built-in PWA support that makes it an ideal candidate for crafting resilient and performant web applications. </span><span class="koboSpan" id="kobo.8.3">You’ll learn how to make your apps installable, capable, fast, and reliable building them as progressive web apps. </span><span class="koboSpan" id="kobo.8.4">The following are the recipes we’re going to cover in this chapter:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.9.1">Converting an existing Angular app into a PWA with the Angular CLI</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.10.1">Modifying the theme color for your PWA</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.11.1">Using dark mode in your PWA</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.12.1">Providing a custom installable experience in your PWA</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.13.1">Precaching requests using an Angular service worker</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.14.1">Creating an app shell for your PWA</span></li>
</ul>
<h1 class="heading-1" id="_idParaDest-448"><span class="koboSpan" id="kobo.15.1">Technical requirements</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.16.1">For the recipes in this chapter, ensure your setup is complete as per the 'Technical Requirements' in the 'Angular-Cookbook-2E' GitHub repository. </span><span class="koboSpan" id="kobo.16.2">For setup details, visit: </span><a href="https://github.com/PacktPublishing/Angular-Cookbook-2E/tree/main/docs/technical-requirements.md"><span class="url"><span class="koboSpan" id="kobo.17.1">https://github.com/PacktPublishing/Angular-Cookbook-2E/tree/main/docs/technical-requirements.md</span></span></a><span class="koboSpan" id="kobo.18.1">. </span><span class="koboSpan" id="kobo.18.2">The starter code for this chapter is located at </span><a href="https://github.com/PacktPublishing/Angular-Cookbook-2E/tree/main/start/apps/chapter13"><span class="url"><span class="koboSpan" id="kobo.19.1">https://github.com/PacktPublishing/Angular-Cookbook-2E/tree/main/start/apps/chapter13</span></span></a><span class="koboSpan" id="kobo.20.1">.</span></p>
<h1 class="heading-1" id="_idParaDest-449"><span class="koboSpan" id="kobo.21.1">Converting an existing Angular app into a PWA with the Angular CLI</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.22.1">A </span><strong class="keyWord"><span class="koboSpan" id="kobo.23.1">PWA</span></strong><span class="koboSpan" id="kobo.24.1"> comprises several intriguing</span><a id="_idIndexMarker1104"/><span class="koboSpan" id="kobo.25.1"> components, with two standout features</span><a id="_idIndexMarker1105"/><span class="koboSpan" id="kobo.26.1"> being the service worker and the web manifest file. </span><span class="koboSpan" id="kobo.26.2">The service worker plays a vital role in caching static resources and handling caching requests. </span></p>
<p class="normal"><span class="koboSpan" id="kobo.27.1">Meanwhile, the web manifest file holds essential information such as app icons and the app’s theme color. </span><span class="koboSpan" id="kobo.27.2">In this guide, we’ll transform an existing Angular application into a PWA. </span><span class="koboSpan" id="kobo.27.3">These principles are also applicable if you were to start a new Angular app from scratch. </span><span class="koboSpan" id="kobo.27.4">Throughout this walkthrough, we’ll convert an existing Angular app, highlighting the changes made and showcasing the transformation process using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.28.1">@angular/pwa</span></code><span class="koboSpan" id="kobo.29.1"> package. </span><span class="koboSpan" id="kobo.29.2">This package not only enables PWA functionality but also facilitates effective static resource caching.</span></p>
<h2 class="heading-2" id="_idParaDest-450"><span class="koboSpan" id="kobo.30.1">Getting ready</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.31.1">The app that we are going to work with resides in </span><code class="inlineCode"><span class="koboSpan" id="kobo.32.1">start/apps/chapter13/ng-pwa-conversion</span></code><span class="koboSpan" id="kobo.33.1"> inside the cloned repository. </span><span class="koboSpan" id="kobo.33.2">This is not part of our NX workspace and is rather a </span><strong class="keyWord"><span class="koboSpan" id="kobo.34.1">standalone Angular</span></strong><span class="koboSpan" id="kobo.35.1"> app with its own </span><code class="inlineCode"><span class="koboSpan" id="kobo.36.1">package.json</span></code><span class="koboSpan" id="kobo.37.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.38.1">node_modules</span></code><span class="koboSpan" id="kobo.39.1">, etc. </span><span class="koboSpan" id="kobo.39.2">Perform the following steps to get started:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.40.1">Open the code repository in your code editor.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.41.1">Open the terminal and navigate to the cloned code repository folder.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.42.1">Navigate to </span><code class="inlineCode"><span class="koboSpan" id="kobo.43.1">start/apps/chapter13/ng-pwa-conversion</span></code><span class="koboSpan" id="kobo.44.1"> and run the following commands to serve the project:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.45.1">npm run build &amp;&amp; npx http-server dist/ng-pwa-conversion
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.46.1">Open a new tab in the browser and navigate to </span><code class="inlineCode"><span class="koboSpan" id="kobo.47.1">http://localhost:8080</span></code><span class="koboSpan" id="kobo.48.1">. </span><span class="koboSpan" id="kobo.48.2">You should see the following:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.49.1"><img alt="" role="presentation" src="../Images/B18469_13_01.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.50.1">Figure 13.1: ng-pwa-conversion app running on http://localhost:8080</span></p></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.51.1">Now that we have the app</span><a id="_idIndexMarker1106"/><span class="koboSpan" id="kobo.52.1"> running locally, let’s see</span><a id="_idIndexMarker1107"/><span class="koboSpan" id="kobo.53.1"> the steps of the recipe in the next section.</span></p>
<h2 class="heading-2" id="_idParaDest-451"><span class="koboSpan" id="kobo.54.1">How to do it…</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.55.1">The app we’re working with is a game built using the Angular CDK in </span><em class="chapterRef"><span class="koboSpan" id="kobo.56.1">Chapter 9</span></em><span class="koboSpan" id="kobo.57.1">, </span><em class="italic"><span class="koboSpan" id="kobo.58.1">Angular and the Angular CDK</span></em><span class="koboSpan" id="kobo.59.1">. </span><span class="koboSpan" id="kobo.59.2">You can enter your name, then guess the dice’s next value, and get a score leaderboard. </span><span class="koboSpan" id="kobo.59.3">The value of the leaderboard is persisted using the local storage. </span><span class="koboSpan" id="kobo.59.4">But the app is not a PWA yet. </span><span class="koboSpan" id="kobo.59.5">Let’s convert it into a PWA:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.60.1">First, let’s see if our application works offline at all, because that is one of the traits of PWAs. </span><span class="koboSpan" id="kobo.60.2">Open </span><strong class="screenText"><span class="koboSpan" id="kobo.61.1">Chrome Dev Tools</span></strong><span class="koboSpan" id="kobo.62.1"> for the app. </span><span class="koboSpan" id="kobo.62.2">Go to the </span><strong class="screenText"><span class="koboSpan" id="kobo.63.1">Network</span></strong><span class="koboSpan" id="kobo.64.1"> tab and change </span><strong class="screenText"><span class="koboSpan" id="kobo.65.1">Throttling</span></strong><span class="koboSpan" id="kobo.66.1"> to </span><strong class="screenText"><span class="koboSpan" id="kobo.67.1">Offline</span></strong><span class="koboSpan" id="kobo.68.1">, as follows:
    </span><figure class="mediaobject"><span class="koboSpan" id="kobo.69.1"><img alt="" role="presentation" src="../Images/B18469_13_02.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.70.1">Figure 13.2: Changing network throttling to Offline to see the offline experience</span></p></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="2"><span class="koboSpan" id="kobo.71.1">Make sure that the </span><strong class="screenText"><span class="koboSpan" id="kobo.72.1">Disable cache</span></strong><span class="koboSpan" id="kobo.73.1"> option is ticked too.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.74.1">Now stop the </span><code class="inlineCode"><span class="koboSpan" id="kobo.75.1">http</span></code><span class="koboSpan" id="kobo.76.1"> server by exiting the process from your terminal. </span><span class="koboSpan" id="kobo.76.2">Once done, refresh the app’s page. </span><span class="koboSpan" id="kobo.76.3">You should</span><a id="_idIndexMarker1108"/><span class="koboSpan" id="kobo.77.1"> see that the app</span><a id="_idIndexMarker1109"/><span class="koboSpan" id="kobo.78.1"> doesn’t work anymore, as shown in the following figure:
    </span><figure class="mediaobject"><span class="koboSpan" id="kobo.79.1"><img alt="" role="presentation" src="../Images/B18469_13_03.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.80.1">Figure 13.3: App not working offline</span></p></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="4"><span class="koboSpan" id="kobo.81.1">To convert this app into a PWA, open a new terminal window/tab and make sure you’re inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.82.1">start/apps/chapter13/ng-pwa-conversion</span></code><span class="koboSpan" id="kobo.83.1"> folder. </span><span class="koboSpan" id="kobo.83.2">Once inside, run the following command:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.84.1">ng add @angular/pwa
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.85.1">You should see a bunch of files created and updated as the process from the command finishes.</span></p></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="5"><span class="koboSpan" id="kobo.86.1">Now build and serve the app again by running </span><code class="inlineCode"><span class="koboSpan" id="kobo.87.1">npm run build &amp;&amp; npx http-server dist/ng-pwa-conversion</span></code><span class="koboSpan" id="kobo.88.1">. </span><span class="koboSpan" id="kobo.88.2">Once done, navigate to </span><code class="inlineCode"><span class="koboSpan" id="kobo.89.1">http://localhost:8080</span></code><span class="koboSpan" id="kobo.90.1">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.91.1">Now make sure you have turned off throttling by switching to the </span><strong class="screenText"><span class="koboSpan" id="kobo.92.1">Network</span></strong><span class="koboSpan" id="kobo.93.1"> tab and setting </span><strong class="screenText"><span class="koboSpan" id="kobo.94.1">No throttling</span></strong><span class="koboSpan" id="kobo.95.1"> as the selection option, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.96.1">Figure 13.4</span></em><span class="koboSpan" id="kobo.97.1">. </span><span class="koboSpan" id="kobo.97.2">Also, notice that the </span><strong class="screenText"><span class="koboSpan" id="kobo.98.1">Disable cache</span></strong><span class="koboSpan" id="kobo.99.1"> option is turned off:
    </span><figure class="mediaobject"><span class="koboSpan" id="kobo.100.1"><img alt="Figure 13.4 – Turning off network throttling " src="../Images/B18469_13_04.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.101.1">Figure 13.4: Turning off network throttling</span></p></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="7"><span class="koboSpan" id="kobo.102.1">Now refresh the app once. </span><span class="koboSpan" id="kobo.102.2">You</span><a id="_idIndexMarker1110"/><span class="koboSpan" id="kobo.103.1"> should see the app working</span><a id="_idIndexMarker1111"/><span class="koboSpan" id="kobo.104.1"> and the network logs showing that assets such as JavaScript files were loaded from the server, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.105.1">Figure 13.5</span></em><span class="koboSpan" id="kobo.106.1">:
    </span><figure class="mediaobject"><span class="koboSpan" id="kobo.107.1"><img alt="" role="presentation" src="../Images/B18469_13_05.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.108.1">Figure 13.5: Assets downloaded from the source (Angular server)</span></p></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="8"><span class="koboSpan" id="kobo.109.1">Now, refresh the app once again and you’ll see that the same assets are now downloaded from the cache using the service worker, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.110.1">Figure 13.6</span></em><span class="koboSpan" id="kobo.111.1">:
    </span><figure class="mediaobject"><span class="koboSpan" id="kobo.112.1"><img alt="" role="presentation" src="../Images/B18469_13_06.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.113.1">Figure 13.6: Assets downloaded from the cache using the service worker</span></p></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="9"><span class="koboSpan" id="kobo.114.1">Now is the moment we’ve been </span><a id="_idIndexMarker1112"/><span class="koboSpan" id="kobo.115.1">waiting for. </span><span class="koboSpan" id="kobo.115.2">Change</span><a id="_idIndexMarker1113"/><span class="koboSpan" id="kobo.116.1"> the network throttling back to </span><strong class="screenText"><span class="koboSpan" id="kobo.117.1">Offline</span></strong><span class="koboSpan" id="kobo.118.1"> to go into the </span><strong class="screenText"><span class="koboSpan" id="kobo.119.1">Offline</span></strong><span class="koboSpan" id="kobo.120.1"> mode and refresh the app. </span><span class="koboSpan" id="kobo.120.2">You should still see the app working in </span><strong class="screenText"><span class="koboSpan" id="kobo.121.1">Offline</span></strong><span class="koboSpan" id="kobo.122.1"> mode because of the service worker, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.123.1">Figure 13.7</span></em><span class="koboSpan" id="kobo.124.1">:
    </span><figure class="mediaobject"><span class="koboSpan" id="kobo.125.1"><img alt="" role="presentation" src="../Images/B18469_13_07.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.126.1">Figure 13.7: Angular app working offline as a PWA using a service worker</span></p></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="10"><span class="koboSpan" id="kobo.127.1">Now you can install this PWA on your machine. </span><span class="koboSpan" id="kobo.127.2">Since I’m using a MacBook, it is installed as a Mac app. </span><span class="koboSpan" id="kobo.127.3">If you’re using Chrome, the installation option should be around the address bar, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.128.1">Figure 13.8</span></em><span class="koboSpan" id="kobo.129.1">:
    </span><figure class="mediaobject"><span class="koboSpan" id="kobo.130.1"><img alt="" role="presentation" src="../Images/B18469_13_08.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.131.1">Figure 13.8: Installing the Angular PWA from Chrome</span></p>
<p class="normal"><span class="koboSpan" id="kobo.132.1">Kaboom! </span><span class="koboSpan" id="kobo.132.2">Just by using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.133.1">@angular/pwa</span></code><span class="koboSpan" id="kobo.134.1"> package, with zero configuration done ourselves, we converted</span><a id="_idIndexMarker1114"/><span class="koboSpan" id="kobo.135.1"> our existing Angular app</span><a id="_idIndexMarker1115"/><span class="koboSpan" id="kobo.136.1"> into a PWA. </span><span class="koboSpan" id="kobo.136.2">We are now able to run our application offline, and we can install it as a PWA on our devices. </span><span class="koboSpan" id="kobo.136.3">See </span><em class="italic"><span class="koboSpan" id="kobo.137.1">Figure 13.9</span></em><span class="koboSpan" id="kobo.138.1"> to see how the app looks—just like a native app on Mac OS X:</span></p></li>
</ol>
<figure class="mediaobject"><span class="koboSpan" id="kobo.139.1"><img alt="" role="presentation" src="../Images/B18469_13_09.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.140.1">Figure 13.9: How our Angular PWA looks as a native app on Mac OS X</span></p>
<p class="normal"><span class="koboSpan" id="kobo.141.1">Cool, </span><em class="italic"><span class="koboSpan" id="kobo.142.1">right?</span></em><span class="koboSpan" id="kobo.143.1"> Now that you know how to build a PWA with the Angular CLI, see the next section to understand how it works.</span></p>
<h2 class="heading-2" id="_idParaDest-452"><span class="koboSpan" id="kobo.144.1">How it works…</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.145.1">The Angular core team and the community have done an amazing job with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.146.1">@angular/pwa</span></code><span class="koboSpan" id="kobo.147.1"> package and, in general, with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.148.1">ng add</span></code><span class="koboSpan" id="kobo.149.1"> command, which allows us to add different packages to our applications using Angular schematics. </span><span class="koboSpan" id="kobo.149.2">In this recipe, when we run </span><code class="inlineCode"><span class="koboSpan" id="kobo.150.1">ng add @angular/pwa</span></code><span class="koboSpan" id="kobo.151.1">, it uses schematics to generate the app icons along with the web app manifest. </span><span class="koboSpan" id="kobo.151.2">If you look at the changed files, you can see the new files, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.152.1">Figure 13.10</span></em><span class="koboSpan" id="kobo.153.1">:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.154.1"><img alt="" role="presentation" src="../Images/B18469_13_10.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.155.1">Figure 13.10: Web manifest file and the app icon files</span></p>
<p class="normal"><span class="koboSpan" id="kobo.156.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.157.1">manifest.webmanifest</span></code><span class="koboSpan" id="kobo.158.1"> file is a file</span><a id="_idIndexMarker1116"/><span class="koboSpan" id="kobo.159.1"> that contains a JSON object. </span><span class="koboSpan" id="kobo.159.2">This object</span><a id="_idIndexMarker1117"/><span class="koboSpan" id="kobo.160.1"> defines the manifest for the PWA and contains some information. </span><span class="koboSpan" id="kobo.160.2">The information includes the name of the app, the short name, the theme color, and the configuration for different icons, for different devices. </span><span class="koboSpan" id="kobo.160.3">Imagine this PWA is installed on your Android phone. </span><span class="koboSpan" id="kobo.160.4">You need an icon in your home drawer to tap on to open the app. </span><span class="koboSpan" id="kobo.160.5">This file holds the information regarding which icon to use based on different device sizes.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.161.1">We also see the file </span><code class="inlineCode"><span class="koboSpan" id="kobo.162.1">ngsw-config.json</span></code><span class="koboSpan" id="kobo.163.1">, which contains the configuration for the service worker. </span><span class="koboSpan" id="kobo.163.2">Behind the scenes, while the </span><code class="inlineCode"><span class="koboSpan" id="kobo.164.1">ng add</span></code><span class="koboSpan" id="kobo.165.1"> command is running the schematics, it also installs the </span><code class="inlineCode"><span class="koboSpan" id="kobo.166.1">@angular/service-worker</span></code><span class="koboSpan" id="kobo.167.1"> package in our project. </span><span class="koboSpan" id="kobo.167.2">If you open the </span><code class="inlineCode"><span class="koboSpan" id="kobo.168.1">app.config.ts</span></code><span class="koboSpan" id="kobo.169.1"> file, you’ll see the code to register our service worker as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.170.1">...
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.171.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.172.1"> { provideServiceWorker } </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.173.1">from</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.174.1">'@angular/service-worker'</span></strong></span><span class="koboSpan" id="kobo.175.1">;
 
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.176.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.177.1">const</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.178.1">appConfig</span></span><span class="koboSpan" id="kobo.179.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.180.1">ApplicationConfig</span></span><span class="koboSpan" id="kobo.181.1"> = {
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.182.1">providers</span></span><span class="koboSpan" id="kobo.183.1">: [</span><span class="hljs-title"><span class="koboSpan" id="kobo.184.1">provideRouter</span></span><span class="koboSpan" id="kobo.185.1">(appRoutes,
</span><span class="hljs-attr"> </span> <span class="hljs-title"><span class="koboSpan" id="kobo.186.1">withEnabledBlockingInitialNavigation</span></span><span class="koboSpan" id="kobo.187.1">(), </span><span class="hljs-title"><span class="koboSpan" id="kobo.188.1">withHashLocation</span></span><span class="koboSpan" id="kobo.189.1">()),
    </span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.190.1">provideServiceWorker</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.191.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.192.1">'ngsw-worker.js'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.193.1">, {</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.194.1">enabled</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.195.1">: !</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.196.1">isDevMode</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.197.1">(),</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.198.1">registrationStrategy</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.199.1">: </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.200.1">'registerWhenStable:30000'</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.201.1">})</span></strong></span><span class="koboSpan" id="kobo.202.1">],
};
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.203.1">Let’s break down the code to understand</span><a id="_idIndexMarker1118"/><span class="koboSpan" id="kobo.204.1"> what’s happening here. </span><span class="koboSpan" id="kobo.204.2">We’re creating the configuration</span><a id="_idIndexMarker1119"/><span class="koboSpan" id="kobo.205.1"> for our standalone application here along with some providers. </span><span class="koboSpan" id="kobo.205.2">We have used the </span><code class="inlineCode"><span class="koboSpan" id="kobo.206.1">provideRouter</span></code><span class="koboSpan" id="kobo.207.1"> method to provide all the routes for the application already. </span><span class="koboSpan" id="kobo.207.2">In the recipe, we add the </span><code class="inlineCode"><span class="koboSpan" id="kobo.208.1">provideServiceWorker</span></code><span class="koboSpan" id="kobo.209.1"> method to register a new service worker for us. </span><span class="koboSpan" id="kobo.209.2">It takes two arguments:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.210.1">The first argument is the filename of the service worker script, </span><code class="inlineCode"><span class="koboSpan" id="kobo.211.1">'</span></code><code class="inlineCode"><span class="koboSpan" id="kobo.212.1">ngsw-worker.js'</span></code><span class="koboSpan" id="kobo.213.1">. </span><span class="koboSpan" id="kobo.213.2">This is the built-in Angular service worker that handles the caching and other offline behaviors.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.214.1">The second argument is a configuration object for the service worker. </span><span class="koboSpan" id="kobo.214.2">Let’s review the properties of this configuration object:</span><ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.215.1">enabled: !isDevMode()</span></code><span class="koboSpan" id="kobo.216.1"> tells the application to enable the service worker only when the application is not in development mode.</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.217.1">registrationStrategy:'registerWhenStable:3000'</span></code><span class="koboSpan" id="kobo.218.1"> specifies the strategy for registering the service worker. </span><span class="koboSpan" id="kobo.218.2">In this case, the service worker will be registered when the application is stable (no ongoing tasks) after 30 seconds.</span></li>
</ul>
</li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.219.1">The code registers a new service worker file named </span><code class="inlineCode"><span class="koboSpan" id="kobo.220.1">ngsw-worker.js</span></code><span class="koboSpan" id="kobo.221.1">. </span><span class="koboSpan" id="kobo.221.2">This file uses the configuration from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.222.1">ngsw-config.json</span></code><span class="koboSpan" id="kobo.223.1"> file to decide which resource to cache and using which strategies. </span><span class="koboSpan" id="kobo.223.2">This is linked in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.224.1">angular.json</span></code><span class="koboSpan" id="kobo.225.1"> file using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.226.1">ngswConfigPath</span></code><span class="koboSpan" id="kobo.227.1"> property. </span><span class="koboSpan" id="kobo.227.2">Note that the application we have is a standalone application. </span><span class="koboSpan" id="kobo.227.3">This means we don’t have an </span><code class="inlineCode"><span class="koboSpan" id="kobo.228.1">NgModule</span></code><span class="koboSpan" id="kobo.229.1"> for the application’s bootstrapping </span><a id="_idIndexMarker1120"/><span class="koboSpan" id="kobo.230.1">process. </span><span class="koboSpan" id="kobo.230.2">If this was rather a non-standalone application, we would</span><a id="_idIndexMarker1121"/><span class="koboSpan" id="kobo.231.1"> see the changes in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.232.1">app.module.ts</span></code><span class="koboSpan" id="kobo.233.1"> file.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.234.1">Now that you know how the recipe works, see the next section for further reading.</span></p>
<h2 class="heading-2" id="_idParaDest-453"><span class="koboSpan" id="kobo.235.1">See also</span></h2>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.236.1">Angular service</span><a id="_idIndexMarker1122"/><span class="koboSpan" id="kobo.237.1"> worker intro: </span><a href="https://angular.io/guide/service-worker-intro"><span class="url"><span class="koboSpan" id="kobo.238.1">https://angular.io/guide/service-worker-intro</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.239.1">What are</span><a id="_idIndexMarker1123"/><span class="koboSpan" id="kobo.240.1"> PWAs?: </span><a href="https://web.dev/what-are-pwas/"><span class="url"><span class="koboSpan" id="kobo.241.1">https://web.dev/what-are-pwas/</span></span></a></li>
</ul>
<h1 class="heading-1" id="_idParaDest-454"><span class="koboSpan" id="kobo.242.1">Modifying the theme color for your PWA</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.243.1">In the previous recipe, we learned how </span><a id="_idIndexMarker1124"/><span class="koboSpan" id="kobo.244.1">to convert an Angular app into a PWA. </span><span class="koboSpan" id="kobo.244.2">When</span><a id="_idIndexMarker1125"/><span class="koboSpan" id="kobo.245.1"> we do so, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.246.1">@angular/pwa</span></code><span class="koboSpan" id="kobo.247.1"> package creates the web app manifest file with the default theme color, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.248.1">Figure 13.9</span></em><span class="koboSpan" id="kobo.249.1">. </span><span class="koboSpan" id="kobo.249.2">However, almost every web app has its own branding and style. </span><span class="koboSpan" id="kobo.249.3">If you want to theme your PWA’s title bar according to your branding, this is the recipe for you. </span><span class="koboSpan" id="kobo.249.4">We’ll learn how to modify the web app manifest file to customize the PWA’s theme color.</span></p>
<h2 class="heading-2" id="_idParaDest-455"><span class="koboSpan" id="kobo.250.1">Getting ready</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.251.1">The app that we are going to work with resides in </span><code class="inlineCode"><span class="koboSpan" id="kobo.252.1">start/apps/chapter13/ng-pwa-theme-color</span></code><span class="koboSpan" id="kobo.253.1"> inside the cloned repository:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.254.1">Open the code repository in your code editor.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.255.1">Open the terminal, navigate to the cloned code repository folder, and run the following command (from the workspace’s root folder) to serve the project in production mode:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.256.1">npm run serve:static chapter13 ng-pwa-theme-color 5300
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.257.1">This should open the app in a new browser tab at </span><code class="inlineCode"><span class="koboSpan" id="kobo.258.1">https://localhost:5300</span></code><span class="koboSpan" id="kobo.259.1">.</span></p></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="3"><span class="koboSpan" id="kobo.260.1">Install the application as shown in </span><em class="italic"><span class="koboSpan" id="kobo.261.1">Figure 13.8</span></em><span class="koboSpan" id="kobo.262.1">.
    </span><p class="normal"><span class="koboSpan" id="kobo.263.1">This should open the app in a native OS window, and you should see the following:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.264.1"><img alt="" role="presentation" src="../Images/B18469_13_11.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.265.1">Figure 13.11: ng-pwa-theme-color app running as a PWA</span></p></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.266.1">Now that we have the app </span><a id="_idIndexMarker1126"/><span class="koboSpan" id="kobo.267.1">running, let’s see the steps of the recipe in the next</span><a id="_idIndexMarker1127"/><span class="koboSpan" id="kobo.268.1"> section.</span></p>
<h2 class="heading-2" id="_idParaDest-456"><span class="koboSpan" id="kobo.269.1">How to do it…</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.270.1">As you can see in </span><em class="italic"><span class="koboSpan" id="kobo.271.1">Figure 13.11</span></em><span class="koboSpan" id="kobo.272.1">, the header of the app has a bit of a different color than the app’s native header (or toolbar). </span><span class="koboSpan" id="kobo.272.2">Due to this difference, the app looks a bit weird. </span><span class="koboSpan" id="kobo.272.3">We’ll modify the web app manifest to update the theme color. </span><span class="koboSpan" id="kobo.272.4">Let’s get started:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.273.1">Open the </span><code class="inlineCode"><span class="koboSpan" id="kobo.274.1">src/manifest.webmanifest</span></code><span class="koboSpan" id="kobo.275.1"> file in your editor and change the theme color as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-punctuation"><span class="koboSpan" id="kobo.276.1">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.277.1">"name"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.278.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.279.1">"ng-pwa-theme-color"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.280.1">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.281.1">"short_name"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.282.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.283.1">"ng-pwa-theme-color"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.284.1">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.285.1">"theme_color"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.286.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.287.1">"#7E22CE"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.288.1">,</span></span><span class="koboSpan" id="kobo.289.1">
  ...
</span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.290.1">}</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.291.1">We also have </span><code class="inlineCode"><span class="koboSpan" id="kobo.292.1">theme-color</span></code><span class="koboSpan" id="kobo.293.1"> set in our </span><code class="inlineCode"><span class="koboSpan" id="kobo.294.1">index.html</span></code><span class="koboSpan" id="kobo.295.1"> file. </span><span class="koboSpan" id="kobo.295.2">By default, that has precedence over the web app</span><a id="_idIndexMarker1128"/><span class="koboSpan" id="kobo.296.1"> manifest file. </span><span class="koboSpan" id="kobo.296.2">Therefore, we need to update</span><a id="_idIndexMarker1129"/><span class="koboSpan" id="kobo.297.1"> it. </span><span class="koboSpan" id="kobo.297.2">Open the </span><code class="inlineCode"><span class="koboSpan" id="kobo.298.1">index.html</span></code><span class="koboSpan" id="kobo.299.1"> file and update it as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-meta"><span class="koboSpan" id="kobo.300.1">&lt;!DOCTYPE </span></span><span class="hljs-keyword"><span class="koboSpan" id="kobo.301.1">html</span></span><span class="hljs-meta"><span class="koboSpan" id="kobo.302.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.303.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.304.1">html</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.305.1">lang</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.306.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.307.1">"en"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.308.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.309.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.310.1">head</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.311.1">&gt;</span></span><span class="koboSpan" id="kobo.312.1">
    ...
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.313.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.314.1">link</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.315.1">rel</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.316.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.317.1">"manifest"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.318.1">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.319.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.320.1">"manifest.webmanifest"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.321.1">&gt;</span></span>
<span class="code-highlight"><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.322.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.323.1">meta</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.324.1">name</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.325.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.326.1">"theme-color"</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.327.1">content</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.328.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.329.1">"#7E22CE"</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.330.1">&gt;</span></strong></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.331.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.332.1">head</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.333.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.334.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.335.1">body</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.336.1">&gt;</span></span><span class="koboSpan" id="kobo.337.1">
    ...
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.338.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.339.1">body</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.340.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.341.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.342.1">html</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.343.1">&gt;</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.344.1">Open the PWA again and uninstall it, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.345.1">Figure 13.12</span></em><span class="koboSpan" id="kobo.346.1">. </span><span class="koboSpan" id="kobo.346.2">Make sure to check the box that says </span><strong class="screenText"><span class="koboSpan" id="kobo.347.1">Also clear data from Chrome (...)</span></strong><span class="koboSpan" id="kobo.348.1"> when prompted:
    </span><figure class="mediaobject"><span class="koboSpan" id="kobo.349.1"><img alt="" role="presentation" src="../Images/B18469_13_12.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.350.1">Figure 13.12: Uninstalling the ng-pwa-theme-color app</span></p></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="4"><span class="koboSpan" id="kobo.351.1">Now, build the app again using the following commands:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.352.1">npm run build ng-pwa-theme-color &amp;&amp; npm run serve:static chapter13 ng-pwa-theme-color 5300
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.353.1">Now go to </span><code class="inlineCode"><span class="koboSpan" id="kobo.354.1">http://localhost:5300</span></code><span class="koboSpan" id="kobo.355.1"> and install the app again as a PWA, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.356.1">Figure 13.8</span></em><span class="koboSpan" id="kobo.357.1">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.358.1">The PWA should already be opened. </span><span class="koboSpan" id="kobo.358.2">If not, open it from your applications and you should see the updated theme color, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.359.1">Figure 13.13</span></em><span class="koboSpan" id="kobo.360.1">:
    </span><figure class="mediaobject"><span class="koboSpan" id="kobo.361.1"><img alt="" role="presentation" src="../Images/B18469_13_13.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.362.1">Figure 13.13: PWA with the updated theme color</span></p></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.363.1">Awesomesauce! </span><span class="koboSpan" id="kobo.363.2">You’ve just learned</span><a id="_idIndexMarker1130"/><span class="koboSpan" id="kobo.364.1"> how to update the theme color for an Angular </span><a id="_idIndexMarker1131"/><span class="koboSpan" id="kobo.365.1">PWA. </span><span class="koboSpan" id="kobo.365.2">Now that you’ve finished the recipe, see the next section for further reading.</span></p>
<h2 class="heading-2" id="_idParaDest-457"><span class="koboSpan" id="kobo.366.1">See also</span></h2>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.367.1">Creating a PWA</span><a id="_idIndexMarker1132"/><span class="koboSpan" id="kobo.368.1"> with the Angular CLI: </span><a href="https://web.dev/creating-pwa-with-angular-cli/"><span class="url"><span class="koboSpan" id="kobo.369.1">https://web.dev/creating-pwa-with-angular-cli/</span></span></a></li>
</ul>
<h1 class="heading-1" id="_idParaDest-458"><span class="koboSpan" id="kobo.370.1">Using dark mode in your PWA</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.371.1">In the modern age of devices</span><a id="_idIndexMarker1133"/><span class="koboSpan" id="kobo.372.1"> and applications, the preferences of end users have evolved</span><a id="_idIndexMarker1134"/><span class="koboSpan" id="kobo.373.1"> a bit as well. </span><span class="koboSpan" id="kobo.373.2">With the increased usage of screens and devices, health is a major concern. </span><span class="koboSpan" id="kobo.373.3">Almost all screen devices now support dark mode. </span><span class="koboSpan" id="kobo.373.4">Considering this fact, if you’re building a web app, you might want to provide dark mode support for it. </span><span class="koboSpan" id="kobo.373.5">If it is a PWA that presents itself as a native app, the responsibility is much greater. </span><span class="koboSpan" id="kobo.373.6">In this recipe, you’ll learn how to provide dark mode for your Angular PWA. </span><span class="koboSpan" id="kobo.373.7">You’ll learn three different ways to implement styles for dark mode, including </span><code class="inlineCode"><span class="koboSpan" id="kobo.374.1">prefers-color-scheme</span></code><span class="koboSpan" id="kobo.375.1"> (which is the default/native CSS way) and two ways to implement it with Tailwind CSS.</span></p>
<h2 class="heading-2" id="_idParaDest-459"><span class="koboSpan" id="kobo.376.1">Getting ready</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.377.1">The app that we are going</span><a id="_idIndexMarker1135"/><span class="koboSpan" id="kobo.378.1"> to work with resides in </span><code class="inlineCode"><span class="koboSpan" id="kobo.379.1">start/apps/chapter13/ng-pwa-dark-mode</span></code><span class="koboSpan" id="kobo.380.1"> inside </span><a id="_idIndexMarker1136"/><span class="koboSpan" id="kobo.381.1">the cloned repository:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.382.1">Open the code repository in your code editor.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.383.1">Open the terminal, navigate to the cloned code repository folder, and run the following command (from the workspace’s root folder) to serve the project in production mode:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.384.1">npm run serve:static chapter13 ng-pwa-dark-mode 6400
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.385.1">This should open the app in a new browser tab at </span><code class="inlineCode"><span class="koboSpan" id="kobo.386.1">https://localhost:6400</span></code><span class="koboSpan" id="kobo.387.1">.</span></p></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="3"><span class="koboSpan" id="kobo.388.1">Install the application as shown in </span><em class="italic"><span class="koboSpan" id="kobo.389.1">Figure 13.8</span></em><span class="koboSpan" id="kobo.390.1">.
    </span><p class="normal"><span class="koboSpan" id="kobo.391.1">This should open the app in a native OS window, and you should see the following:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.392.1"><img alt="" role="presentation" src="../Images/B18469_13_14.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.393.1">Figure 13.14: ng-pwa-dark-mode app running on http://localhost:6400</span></p></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="4"><span class="koboSpan" id="kobo.394.1">Now make sure you have</span><a id="_idIndexMarker1137"/><span class="koboSpan" id="kobo.395.1"> the </span><strong class="screenText"><span class="koboSpan" id="kobo.396.1">Dark</span></strong><span class="koboSpan" id="kobo.397.1"> theme enabled on your machine. </span><span class="koboSpan" id="kobo.397.2">If you’re running</span><a id="_idIndexMarker1138"/><span class="koboSpan" id="kobo.398.1"> Mac OS X, you can open </span><strong class="screenText"><span class="koboSpan" id="kobo.399.1">Settings</span></strong><span class="koboSpan" id="kobo.400.1"> | </span><strong class="screenText"><span class="koboSpan" id="kobo.401.1">General</span></strong><span class="koboSpan" id="kobo.402.1"> and select the </span><strong class="screenText"><span class="koboSpan" id="kobo.403.1">Dark</span></strong><span class="koboSpan" id="kobo.404.1"> appearance, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.405.1">Figure 13.15</span></em><span class="koboSpan" id="kobo.406.1">:
    </span><figure class="mediaobject"><span class="koboSpan" id="kobo.407.1"><img alt="Figure 13.14 – Changing the system appearance to Dark mode in macOS X " src="../Images/B18469_13_15.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.408.1">Figure 13.15: Changing the system appearance to dark mode in Mac OS X</span></p></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.409.1">If you run the app now, you should be able to see that the app looks the same as shown in </span><em class="italic"><span class="koboSpan" id="kobo.410.1">Figure 13.4</span></em><span class="koboSpan" id="kobo.411.1">. </span><span class="koboSpan" id="kobo.411.2">However, for dark mode, we should not have a white background, etc.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.412.1">Now that we have the PWA running as a native app, and the </span><strong class="screenText"><span class="koboSpan" id="kobo.413.1">dark</span></strong><span class="koboSpan" id="kobo.414.1"> mode applied to the system, let’s see the steps of the recipe in the next section.</span></p>
<h2 class="heading-2" id="_idParaDest-460"><span class="koboSpan" id="kobo.415.1">How to do it…</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.416.1">As you can see, our Angular app</span><a id="_idIndexMarker1139"/><span class="koboSpan" id="kobo.417.1"> doesn’t have complete support for dark mode at the moment. </span><span class="koboSpan" id="kobo.417.2">That is, the UI</span><a id="_idIndexMarker1140"/><span class="koboSpan" id="kobo.418.1"> is still too bright and looks exactly the same as what we see in light mode. </span><span class="koboSpan" id="kobo.418.2">We’ll begin by serving the app in development mode and adding different colors for dark mode. </span><span class="koboSpan" id="kobo.418.3">Let’s get started:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.419.1">Serve the app in development mode by running the following command:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.420.1">npm run serve ng-pwa-dark-mode
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.421.1">This should serve the app in a new browser tab at </span><code class="inlineCode"><span class="koboSpan" id="kobo.422.1">http://localhost:4200</span></code><span class="koboSpan" id="kobo.423.1">.</span></p> </li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="2"><span class="koboSpan" id="kobo.424.1">Now, open the </span><code class="inlineCode"><span class="koboSpan" id="kobo.425.1">styles.scss</span></code><span class="koboSpan" id="kobo.426.1"> file to use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.427.1">prefers-color-scheme</span></code><span class="koboSpan" id="kobo.428.1"> media query. </span><span class="koboSpan" id="kobo.428.2">We’ll use a different value for our global CSS variables to create a different view for dark mode. </span><span class="koboSpan" id="kobo.428.3">Update the file as follows:
        </span><pre class="programlisting code"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.429.1">@media</span></span><span class="koboSpan" id="kobo.430.1"> (</span><span class="hljs-attribute"><span class="koboSpan" id="kobo.431.1">prefers-color-scheme</span></span><span class="koboSpan" id="kobo.432.1">: dark) {
  </span><span class="hljs-selector-tag"><span class="koboSpan" id="kobo.433.1">html</span></span><span class="koboSpan" id="kobo.434.1">, </span><span class="hljs-selector-tag"><span class="koboSpan" id="kobo.435.1">body</span></span><span class="koboSpan" id="kobo.436.1"> {
    </span><span class="hljs-attribute"><span class="koboSpan" id="kobo.437.1">background-color</span></span><span class="koboSpan" id="kobo.438.1">: </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.439.1">rgb</span></span><span class="koboSpan" id="kobo.440.1">(</span><span class="hljs-number"><span class="koboSpan" id="kobo.441.1">30</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.442.1">41</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.443.1">59</span></span><span class="koboSpan" id="kobo.444.1">);
  }
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.445.1">If you refresh the app again in the browser tab, you’ll see that the background has changed but the text is still dark and is not easily visible, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.446.1">Figure 13.16</span></em><span class="koboSpan" id="kobo.447.1">:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.448.1"><img alt="" role="presentation" src="../Images/B18469_13_16.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.449.1">Figure 13.16: Dark text and a dark background for dark mode</span></p>
<p class="normal"><span class="koboSpan" id="kobo.450.1">To fix the styles, we need to provide the styles for dark mode individually to the necessary elements.</span></p></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="3"><span class="koboSpan" id="kobo.451.1">Since we are using Tailwind</span><a id="_idIndexMarker1141"/><span class="koboSpan" id="kobo.452.1"> CSS, we are going to use the Tailwind way of applying</span><a id="_idIndexMarker1142"/><span class="koboSpan" id="kobo.453.1"> dark mode to the input label and the input element. </span><span class="koboSpan" id="kobo.453.2">Update </span><code class="inlineCode"><span class="koboSpan" id="kobo.454.1">src/app/game/game.component.html</span></code><span class="koboSpan" id="kobo.455.1"> as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag"><span class="koboSpan" id="kobo.456.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.457.1">app-game-stepper</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.458.1"> [</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.459.1">linear</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.460.1">]=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.461.1">"true"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.462.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.463.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.464.1">cdk-step...</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.465.1">&gt;</span></span><span class="koboSpan" id="kobo.466.1">
    ...
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.467.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.468.1">form</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.469.1">...</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.470.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.471.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.472.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.473.1">...</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.474.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.475.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.476.1">label</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.477.1">for</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.478.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.479.1">"nameInput" </span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.480.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.481.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.482.1">"form-label </span></span><span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.483.1">dark:text-white</span></strong></span><span class="hljs-string"><span class="koboSpan" id="kobo.484.1">"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.485.1">&gt;</span></span><span class="koboSpan" id="kobo.486.1">
  Player Name
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.487.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.488.1">label</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.489.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.490.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.491.1">input</span></span>
<span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.492.1">type</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.493.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.494.1">"text"</span></span>
<span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.495.1">formControlName</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.496.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.497.1">"name"</span></span>
<span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.498.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.499.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.500.1">"form-control dark:!text-white dark:placeholder:!text-           white"</span></span>
<span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.501.1">id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.502.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.503.1">"nameInput"</span></span>
<span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.504.1">placeholder</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.505.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.506.1">"Enter your name"</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.507.1">        /&gt;</span></span><span class="koboSpan" id="kobo.508.1">
        ...
</span><span class="hljs-tag"><span class="koboSpan" id="kobo.509.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.510.1">app-game-stepper</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.511.1">&gt;</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.512.1">Notice that for the input, we’re using an exclamation sign in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.513.1">dark:!text-white</span></code><span class="koboSpan" id="kobo.514.1"> statement. </span><span class="koboSpan" id="kobo.514.2">This is to mark the </span><code class="inlineCode"><span class="koboSpan" id="kobo.515.1">text-white Tailwind</span></code><span class="koboSpan" id="kobo.516.1"> CSS class as important which results in the relevant CSS style having the </span><code class="inlineCode"><span class="koboSpan" id="kobo.517.1">!</span></code><span class="koboSpan" id="kobo.518.1"> important statement.</span></p></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="4"><span class="koboSpan" id="kobo.519.1">Now let’s change the </span><code class="inlineCode"><span class="koboSpan" id="kobo.520.1">game-stepper.component.html</span></code><span class="koboSpan" id="kobo.521.1"> file to update</span><a id="_idIndexMarker1143"/><span class="koboSpan" id="kobo.522.1"> the style for the step heading</span><a id="_idIndexMarker1144"/><span class="koboSpan" id="kobo.523.1"> as well, as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag"><span class="koboSpan" id="kobo.524.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.525.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.526.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.527.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.528.1">"game-stepper"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.529.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.530.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.531.1">header</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.532.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.533.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.534.1">h3</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.535.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.536.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.537.1">"text-2xl </span></span><span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.538.1">dark:text-white</span></strong></span><span class="hljs-string"><span class="koboSpan" id="kobo.539.1">"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.540.1"> *</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.541.1">ngIf</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.542.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.543.1">"selected"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.544.1">&gt;</span></span><span class="koboSpan" id="kobo.545.1">
      ...
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.546.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.547.1">h3</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.548.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.549.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.550.1">header</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.551.1">&gt;</span></span><span class="koboSpan" id="kobo.552.1">
...
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.553.1">If you refresh the application, you should be able to see the heading in white, since we’re using dark mode on our device, as follows:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.554.1"><img alt="" role="presentation" src="../Images/B18469_13_17.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.555.1">Figure 13.17: Heading and input colors fixed for dark mode</span></p></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="5"><span class="koboSpan" id="kobo.556.1">Now let’s fix the numbered cards on the dice-rolling screen. </span><span class="koboSpan" id="kobo.556.2">You can see that in dark mode, the backgrounds on the cards are not visible, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.557.1">Figure 13.18</span></em><span class="koboSpan" id="kobo.558.1">:
    </span><figure class="mediaobject"><span class="koboSpan" id="kobo.559.1"><img alt="" role="presentation" src="../Images/B18469_13_18.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.560.1">Figure 13.18: Cards’ backgrounds not visible in dark mode</span></p></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="6"><span class="koboSpan" id="kobo.561.1">Let’s simulate the dark and light</span><a id="_idIndexMarker1145"/><span class="koboSpan" id="kobo.562.1"> modes using Chrome DevTools as it provides</span><a id="_idIndexMarker1146"/><span class="koboSpan" id="kobo.563.1"> a really nice way to do so. </span><span class="koboSpan" id="kobo.563.2">Open Chrome DevTools and then open the </span><strong class="screenText"><span class="koboSpan" id="kobo.564.1">Command</span></strong><span class="koboSpan" id="kobo.565.1"> menu. </span><span class="koboSpan" id="kobo.565.2">On macOS X, the keys are </span><em class="keystroke"><span class="koboSpan" id="kobo.566.1">Cmd + Shift + P</span></em><span class="koboSpan" id="kobo.567.1">. </span><span class="koboSpan" id="kobo.567.2">On Windows, they are </span><em class="keystroke"><span class="koboSpan" id="kobo.568.1">Ctrl + Shift + P</span></em><span class="koboSpan" id="kobo.569.1">. </span><span class="koboSpan" id="kobo.569.2">Then type </span><code class="inlineCode"><span class="koboSpan" id="kobo.570.1">Render</span></code><span class="koboSpan" id="kobo.571.1"> and select the </span><strong class="screenText"><span class="koboSpan" id="kobo.572.1">Show Rendering</span></strong><span class="koboSpan" id="kobo.573.1"> option, as we can see in </span><em class="italic"><span class="koboSpan" id="kobo.574.1">Figure 13.19</span></em><span class="koboSpan" id="kobo.575.1">:
    </span><figure class="mediaobject"><span class="koboSpan" id="kobo.576.1"><img alt="" role="presentation" src="../Images/B18469_13_19.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.577.1">Figure 13.19: Open the rendering view using the Show Rendering option</span></p></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="7"><span class="koboSpan" id="kobo.578.1">Now, in the </span><strong class="screenText"><span class="koboSpan" id="kobo.579.1">Rendering</span></strong><span class="koboSpan" id="kobo.580.1"> tab, toggle the </span><strong class="screenText"><span class="koboSpan" id="kobo.581.1">prefers-color-scheme</span></strong><span class="koboSpan" id="kobo.582.1"> emulation for light and dark modes, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.583.1">Figure 13.20</span></em><span class="koboSpan" id="kobo.584.1">:
    </span><figure class="mediaobject"><span class="koboSpan" id="kobo.585.1"><img alt="" role="presentation" src="../Images/B18469_13_20.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.586.1">Figure 13.20: Simulate prefers-color-scheme modes</span></p></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="8"><span class="koboSpan" id="kobo.587.1">Now let us update the numbered</span><a id="_idIndexMarker1147"/><span class="koboSpan" id="kobo.588.1"> cards’ backgrounds. </span><span class="koboSpan" id="kobo.588.2">Since the styles for these are being</span><a id="_idIndexMarker1148"/><span class="koboSpan" id="kobo.589.1"> applied from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.590.1">.scss</span></code><span class="koboSpan" id="kobo.591.1"> file, we’re going to use another technique of Tailwind CSS to apply the styles in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.592.1">.scss</span></code><span class="koboSpan" id="kobo.593.1"> file. </span><span class="koboSpan" id="kobo.593.2">Update </span><code class="inlineCode"><span class="koboSpan" id="kobo.594.1">value-guesser.component.scss</span></code><span class="koboSpan" id="kobo.595.1"> as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.596.1">...
</span><span class="hljs-selector-class"><span class="koboSpan" id="kobo.597.1">.values</span></span><span class="koboSpan" id="kobo.598.1"> {
  ...
  </span><span class="koboSpan" id="kobo.598.2">&amp;__value-box {
    </span><span class="hljs-attribute"><span class="koboSpan" id="kobo.599.1">width</span></span><span class="koboSpan" id="kobo.600.1">: </span><span class="hljs-number"><span class="koboSpan" id="kobo.601.1">5rem</span></span><span class="koboSpan" id="kobo.602.1">;
    </span><span class="hljs-attribute"><span class="koboSpan" id="kobo.603.1">height</span></span><span class="koboSpan" id="kobo.604.1">: </span><span class="hljs-number"><span class="koboSpan" id="kobo.605.1">5rem</span></span><span class="koboSpan" id="kobo.606.1">;
    </span><span class="hljs-attribute"><span class="koboSpan" id="kobo.607.1">color</span></span><span class="koboSpan" id="kobo.608.1">: </span><span class="hljs-number"><span class="koboSpan" id="kobo.609.1">#fff</span></span><span class="koboSpan" id="kobo.610.1">;
    </span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.611.1">@apply</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-attribute-slc"><span class="koboSpan" id="kobo.612.1">dark</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.613.1">:bg-slate-</span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.614.1">500</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.615.1">;</span></strong></span><span class="koboSpan" id="kobo.616.1">
    ...
  </span><span class="koboSpan" id="kobo.616.2">}
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.617.1">If you look at the dice-rolling view now, you should see the changed colors, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.618.1">Figure 13.21</span></em><span class="koboSpan" id="kobo.619.1">:
    </span><figure class="mediaobject"><span class="koboSpan" id="kobo.620.1"><img alt="" role="presentation" src="../Images/B18469_13_21.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.621.1">Figure 13.21: Cards’ backgrounds in dark mode</span></p></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="10"><span class="koboSpan" id="kobo.622.1">Now test both modes</span><a id="_idIndexMarker1149"/><span class="koboSpan" id="kobo.623.1"> using the Chrome</span><a id="_idIndexMarker1150"/><span class="koboSpan" id="kobo.624.1"> DevTools.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.625.1">Uninstall the existing PWA by opening it and then selecting the </span><strong class="screenText"><span class="koboSpan" id="kobo.626.1">Uninstall</span></strong><span class="koboSpan" id="kobo.627.1"> option from the </span><strong class="screenText"><span class="koboSpan" id="kobo.628.1">More</span></strong><span class="koboSpan" id="kobo.629.1"> menu, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.630.1">Figure 13.12</span></em><span class="koboSpan" id="kobo.631.1">. </span><span class="koboSpan" id="kobo.631.2">Make sure to check the box that says </span><strong class="screenText"><span class="koboSpan" id="kobo.632.1">Also clear data from Chrome (...)</span></strong><span class="koboSpan" id="kobo.633.1"> when prompted.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.634.1">Run the following command to serve the production app on the browser and then navigate to </span><code class="inlineCode"><span class="koboSpan" id="kobo.635.1">http://localhost:6400</span></code><span class="koboSpan" id="kobo.636.1">:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.637.1">npm run serve:static chapter13 ng-pwa-dark-mode 6400
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.638.1">You may need to clear your cache when this opens in the browser. </span><span class="koboSpan" id="kobo.638.2">You can press </span><em class="keystroke"><span class="koboSpan" id="kobo.639.1">Ctrl + Shift + R</span></em><span class="koboSpan" id="kobo.640.1"> on Windows and </span><em class="keystroke"><span class="koboSpan" id="kobo.641.1">Cmd + Shift + R</span></em><span class="koboSpan" id="kobo.642.1"> on Mac OS X to do a hard reload.</span></p> </li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="13"><span class="koboSpan" id="kobo.643.1">Wait for a few seconds for the </span><strong class="screenText"><span class="koboSpan" id="kobo.644.1">Install</span></strong><span class="koboSpan" id="kobo.645.1"> button to show up in the address bar. </span><span class="koboSpan" id="kobo.645.2">Then install the PWA like in </span><em class="italic"><span class="koboSpan" id="kobo.646.1">Figure 13.8</span></em><span class="koboSpan" id="kobo.647.1">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.648.1">As soon as you run the PWA now, you should see the dark mode view, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.649.1">Figure 13.22</span></em><span class="koboSpan" id="kobo.650.1">, if your system’s appearance is set to dark mode:
    </span><figure class="mediaobject"><span class="koboSpan" id="kobo.651.1"><img alt="" role="presentation" src="../Images/B18469_13_22.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.652.1">Figure 13.22: Our PWA supporting dark mode out of the box</span></p></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.653.1">Awesome! </span><span class="koboSpan" id="kobo.653.2">If you switch your system appearance from dark mode to light mode or vice versa, you should see the PWA reflecting the appropriate colors. </span><span class="koboSpan" id="kobo.653.3">You now know three ways to implement styles for dark mode, including the native CSS </span><a id="_idIndexMarker1151"/><span class="koboSpan" id="kobo.654.1">way and the Tailwind CSS </span><a id="_idIndexMarker1152"/><span class="koboSpan" id="kobo.655.1">way. </span><span class="koboSpan" id="kobo.655.2">Now that you know how to support dark mode in your PWA, refer to the next section to see links for further reading.</span></p>
<h2 class="heading-2" id="_idParaDest-461"><span class="koboSpan" id="kobo.656.1">See also</span></h2>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.657.1">Prefers</span><a id="_idIndexMarker1153"/><span class="koboSpan" id="kobo.658.1"> color scheme: </span><a href="https://web.dev/prefers-color-scheme/"><span class="url"><span class="koboSpan" id="kobo.659.1">https://web.dev/prefers-color-scheme/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.660.1">Using color</span><a id="_idIndexMarker1154"/><span class="koboSpan" id="kobo.661.1"> scheme with </span><code class="inlineCode"><span class="koboSpan" id="kobo.662.1">prefers-color-scheme</span></code><span class="koboSpan" id="kobo.663.1">: </span><a href="https://web.dev/color-scheme/"><span class="url"><span class="koboSpan" id="kobo.664.1">https://web.dev/color-scheme/</span></span></a></li>
</ul>
<h1 class="heading-1" id="_idParaDest-462"><span class="koboSpan" id="kobo.665.1">Providing a custom installable experience in your PWA</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.666.1">We know that PWAs</span><a id="_idIndexMarker1155"/><span class="koboSpan" id="kobo.667.1"> are installable. </span><span class="koboSpan" id="kobo.667.2">This means they can be installed </span><a id="_idIndexMarker1156"/><span class="koboSpan" id="kobo.668.1">on your devices like a native application. </span><span class="koboSpan" id="kobo.668.2">However, when you first open the app in the browser, it totally depends on the browser as to how it shows the </span><strong class="screenText"><span class="koboSpan" id="kobo.669.1">Install</span></strong><span class="koboSpan" id="kobo.670.1"> option; it varies from browser to browser. </span><span class="koboSpan" id="kobo.670.2">It also It also might not be clearly visible or clearly visible. </span><span class="koboSpan" id="kobo.670.3">Also, you might want to show the </span><strong class="screenText"><span class="koboSpan" id="kobo.671.1">Install</span></strong><span class="koboSpan" id="kobo.672.1"> prompt at some special point in the app instead of the app launch, Consider displaying the Install prompt at a specific, user-friendly point within the app, rather than right at the app’s launch, as this can be perceived as annoying by some users. </span><span class="koboSpan" id="kobo.672.2">Luckily, we have a way to provide our own custom dialog/prompt for the installation option for our PWAs. </span><span class="koboSpan" id="kobo.672.3">And that is what we’ll learn about in this recipe.</span></p>
<h2 class="heading-2" id="_idParaDest-463"><span class="koboSpan" id="kobo.673.1">Getting ready</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.674.1">The app that we are going to work</span><a id="_idIndexMarker1157"/><span class="koboSpan" id="kobo.675.1"> with resides in </span><code class="inlineCode"><span class="koboSpan" id="kobo.676.1">start/apps/chapter13/ng-pwa-cust-installation</span></code><span class="koboSpan" id="kobo.677.1"> inside the cloned</span><a id="_idIndexMarker1158"/><span class="koboSpan" id="kobo.678.1"> repository:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.679.1">Open the code repository in your code editor.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.680.1">Open the terminal, navigate to the cloned code repository folder, and run the following command (from the workspace’s root folder) to serve the project in production mode:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.681.1">npm run serve:static chapter13 ng-pwa-cust-installation 7000
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.682.1">This should open the app in a new browser tab at </span><code class="inlineCode"><span class="koboSpan" id="kobo.683.1">https://localhost:7000</span></code><span class="koboSpan" id="kobo.684.1">.</span></p> </li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="3"><span class="koboSpan" id="kobo.685.1">Install the application as shown in </span><em class="italic"><span class="koboSpan" id="kobo.686.1">Figure 13.8</span></em><span class="koboSpan" id="kobo.687.1">.
    </span><p class="normal"><span class="koboSpan" id="kobo.688.1">This should open the app in a native OS window, and you should see the following:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.689.1"><img alt="" role="presentation" src="../Images/B18469_13_23.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.690.1">Figure 13.23: ng-pwa-cust-installation running at http://localhost:7000</span></p></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.691.1">Now that we have the app running, let’s see the steps of the recipe in the next section.</span></p>
<h2 class="heading-2" id="_idParaDest-464"><span class="koboSpan" id="kobo.692.1">How to do it…</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.693.1">We have the Dice Guesser</span><a id="_idIndexMarker1159"/><span class="koboSpan" id="kobo.694.1"> application in which you roll the dice</span><a id="_idIndexMarker1160"/><span class="koboSpan" id="kobo.695.1"> and guess the output. </span><span class="koboSpan" id="kobo.695.2">For this recipe, we’ll prevent the default installation prompt and will show it only when the user has made a correct guess. </span><span class="koboSpan" id="kobo.695.3">Let’s begin:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.696.1">First, create a service that will show our custom installable prompt in the next steps. </span><span class="koboSpan" id="kobo.696.2">In the project root, run the following command:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.697.1">cd start &amp;&amp; nx g service services/installable-prompt --project ng-pwa-cust-installation
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.698.1">When asked, use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.699.1">@schematics/angular:service</span></code><span class="koboSpan" id="kobo.700.1"> schematics.</span></p></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="2"><span class="koboSpan" id="kobo.701.1">Next, open the created file, </span><code class="inlineCode"><span class="koboSpan" id="kobo.702.1">installable-prompt.service.ts</span></code><span class="koboSpan" id="kobo.703.1">, and update the code as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.704.1">import</span></span><span class="koboSpan" id="kobo.705.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.706.1">Injectable</span></span><span class="koboSpan" id="kobo.707.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.708.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.709.1">'@angular/core'</span></span><span class="koboSpan" id="kobo.710.1">;
 
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.711.1">declare</span></span> <span class="hljs-variable"><span class="koboSpan" id="kobo.712.1">global</span></span><span class="koboSpan" id="kobo.713.1"> {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.714.1">interface</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.715.1">WindowEventMap</span></span><span class="koboSpan" id="kobo.716.1"> {
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.717.1">beforeinstallprompt</span></span><span class="koboSpan" id="kobo.718.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.719.1">BeforeInstallPromptEvent</span></span><span class="koboSpan" id="kobo.720.1">;
  }
}
</span><span class="hljs-meta"><span class="koboSpan" id="kobo.721.1">@Injectable</span></span><span class="koboSpan" id="kobo.722.1">({
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.723.1">providedIn</span></span><span class="koboSpan" id="kobo.724.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.725.1">'root'</span></span><span class="koboSpan" id="kobo.726.1">
})
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.727.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.728.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.729.1">InstallablePromptService</span></span><span class="koboSpan" id="kobo.730.1"> {
  installPromptEvent!: </span><span class="hljs-title"><span class="koboSpan" id="kobo.731.1">BeforeInstallPromptEvent</span></span><span class="koboSpan" id="kobo.732.1">;
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.733.1">constructor</span></span><span class="koboSpan" id="kobo.734.1">() {
    </span><span class="hljs-variable"><span class="koboSpan" id="kobo.735.1">window</span></span><span class="koboSpan" id="kobo.736.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.737.1">addEventListener</span></span><span class="koboSpan" id="kobo.738.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.739.1">'beforeinstallprompt'</span></span><span class="koboSpan" id="kobo.740.1">,
      </span><span class="hljs-variable"><span class="koboSpan" id="kobo.741.1">this</span></span><span class="koboSpan" id="kobo.742.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.743.1">handleInstallPrompt</span></span><span class="koboSpan" id="kobo.744.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.745.1">bind</span></span><span class="koboSpan" id="kobo.746.1">(</span><span class="hljs-variable"><span class="koboSpan" id="kobo.747.1">this</span></span><span class="koboSpan" id="kobo.748.1">))
  }
 
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.749.1">handleInstallPrompt</span></span><span class="koboSpan" id="kobo.750.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.751.1">ev: BeforeInstallPromptEvent</span></span><span class="koboSpan" id="kobo.752.1">) {
    ev.</span><span class="hljs-title"><span class="koboSpan" id="kobo.753.1">preventDefault</span></span><span class="koboSpan" id="kobo.754.1">();
    </span><span class="hljs-variable"><span class="koboSpan" id="kobo.755.1">this</span></span><span class="koboSpan" id="kobo.756.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.757.1">installPromptEvent</span></span><span class="koboSpan" id="kobo.758.1"> = ev;
    </span><span class="hljs-variable"><span class="koboSpan" id="kobo.759.1">console</span></span><span class="koboSpan" id="kobo.760.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.761.1">log</span></span><span class="koboSpan" id="kobo.762.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.763.1">'before install prompt event fired'</span></span><span class="koboSpan" id="kobo.764.1">, ev);
    </span><span class="hljs-variable"><span class="koboSpan" id="kobo.765.1">window</span></span><span class="koboSpan" id="kobo.766.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.767.1">removeEventListener</span></span><span class="koboSpan" id="kobo.768.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.769.1">'beforeinstallprompt'</span></span><span class="koboSpan" id="kobo.770.1">,
      </span><span class="hljs-variable"><span class="koboSpan" id="kobo.771.1">this</span></span><span class="koboSpan" id="kobo.772.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.773.1">handleInstallPrompt</span></span><span class="koboSpan" id="kobo.774.1">)
  }
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.775.1">You will notice that TypeScript isn’t happy with our code.</span></p></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="3"><span class="koboSpan" id="kobo.776.1">In this step, we need to define</span><a id="_idIndexMarker1161"/><span class="koboSpan" id="kobo.777.1"> the </span><code class="inlineCode"><span class="koboSpan" id="kobo.778.1">BeforeInstallPrompt</span></code><span class="koboSpan" id="kobo.779.1"> event type. </span><span class="koboSpan" id="kobo.779.2">Let’s create a folder</span><a id="_idIndexMarker1162"/><span class="koboSpan" id="kobo.780.1"> named </span><code class="inlineCode"><span class="koboSpan" id="kobo.781.1">types</span></code><span class="koboSpan" id="kobo.782.1"> inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.783.1">src</span></code><span class="koboSpan" id="kobo.784.1"> folder. </span><span class="koboSpan" id="kobo.784.2">Create a file named </span><code class="inlineCode"><span class="koboSpan" id="kobo.785.1">installation-prompt.d.ts</span></code><span class="koboSpan" id="kobo.786.1"> and add the following code to it:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.787.1">interface</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.788.1">BeforeInstallPromptEvent</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.789.1">extends</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.790.1">Event</span></span><span class="koboSpan" id="kobo.791.1"> {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.792.1">readonly</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.793.1">platforms</span></span><span class="koboSpan" id="kobo.794.1">: </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.795.1">string</span></span><span class="koboSpan" id="kobo.796.1">[];
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.797.1">readonly</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.798.1">userChoice</span></span><span class="koboSpan" id="kobo.799.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.800.1">Promise</span></span><span class="koboSpan" id="kobo.801.1">&lt;{
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.802.1">outcome</span></span><span class="koboSpan" id="kobo.803.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.804.1">"accepted"</span></span><span class="koboSpan" id="kobo.805.1"> | </span><span class="hljs-string"><span class="koboSpan" id="kobo.806.1">"dismissed"</span></span><span class="koboSpan" id="kobo.807.1">;
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.808.1">platform</span></span><span class="koboSpan" id="kobo.809.1">: </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.810.1">string</span></span><span class="koboSpan" id="kobo.811.1">;
  }&gt;;
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.812.1">prompt</span></span><span class="koboSpan" id="kobo.813.1">(): </span><span class="hljs-title"><span class="koboSpan" id="kobo.814.1">Promise</span></span><span class="koboSpan" id="kobo.815.1">&lt;</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.816.1">void</span></span><span class="koboSpan" id="kobo.817.1">&gt;;
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.818.1">We must add the </span><code class="inlineCode"><span class="koboSpan" id="kobo.819.1">types</span></code><span class="koboSpan" id="kobo.820.1"> folder in </span><code class="inlineCode"><span class="koboSpan" id="kobo.821.1">tsconfig.json</span></code><span class="koboSpan" id="kobo.822.1"> so we can load the types. </span><span class="koboSpan" id="kobo.822.2">Update the </span><code class="inlineCode"><span class="koboSpan" id="kobo.823.1">tsconfig.json</span></code><span class="koboSpan" id="kobo.824.1"> file as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-punctuation"><span class="koboSpan" id="kobo.825.1">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.826.1">"compilerOptions"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.827.1">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.828.1">{</span></span><span class="koboSpan" id="kobo.829.1">
    ...</span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.830.1">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.831.1">"noFallthroughCasesInSwitch"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.832.1">:</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.833.1">true</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.834.1">,</span></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.835.1">"typeRoots"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.836.1">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.837.1">[</span></strong></span>
<span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.838.1">"./src/types"</span></strong></span>
<span class="code-highlight"><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.839.1">]</span></strong></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.840.1">},</span></span><span class="koboSpan" id="kobo.841.1">
  ...
</span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.842.1">}</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.843.1">Next, let’s build the custom installation banner we’ll show to the user to trigger the installation prompt. </span><span class="koboSpan" id="kobo.843.2">Update </span><code class="inlineCode"><span class="koboSpan" id="kobo.844.1">app.component.html</span></code><span class="koboSpan" id="kobo.845.1"> and add the following code AFTER the </span><code class="inlineCode"><span class="koboSpan" id="kobo.846.1">&lt;main&gt;</span></code><span class="koboSpan" id="kobo.847.1">, tag as shown here:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.848.1">...
</span><span class="hljs-tag"><span class="koboSpan" id="kobo.849.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.850.1">main</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.851.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.852.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.853.1">"content"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.854.1">role</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.855.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.856.1">"main"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.857.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.858.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.859.1">router-outlet</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.860.1">&gt;&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.861.1">router-outlet</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.862.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.863.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.864.1">main</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.865.1">&gt;</span></span>
<span class="code-highlight"><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.866.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.867.1">div</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.868.1">id</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.869.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.870.1">"installPrompt"</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.871.1">class</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.872.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.873.1">"fixed inset-x-0 bottom-10</span></strong></span>
<span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.874.1">p-4"</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.875.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.876.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.877.1">div</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.878.1">class</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.879.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.880.1">"rounded-lg bg-purple-600 px-4 py-3 text-</span></strong></span>
<span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.881.1">white shadow-lg"</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.882.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.883.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.884.1">p</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.885.1">class</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.886.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.887.1">"text-center text-sm font-medium"</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.888.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.889.1">Love the Dice Game?</span></strong></span>
<span class="code-highlight"><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.890.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.891.1">a</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.892.1">href</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.893.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.894.1">"#"</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.895.1">class</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.896.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.897.1">"inline-block underline"</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.898.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.899.1">Install it!</span></strong></span>
<span class="code-highlight"><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.900.1">&lt;/</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.901.1">a</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.902.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.903.1">&lt;/</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.904.1">p</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.905.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.906.1">&lt;/</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.907.1">div</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.908.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.909.1">&lt;/</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.910.1">div</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.911.1">&gt;</span></strong></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.912.1">Now run the application</span><a id="_idIndexMarker1163"/><span class="koboSpan" id="kobo.913.1"> again using the following command </span><a id="_idIndexMarker1164"/><span class="koboSpan" id="kobo.914.1">to see the installation prompt, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.915.1">Figure 13.24</span></em><span class="koboSpan" id="kobo.916.1">:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.917.1">npm run serve:static chapter13 ng-pwa-cust-installation 7000
</span></code></pre>
<figure class="mediaobject"><span class="koboSpan" id="kobo.918.1"><img alt="" role="presentation" src="../Images/B18469_13_24.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.919.1">Figure 13.24: Custom installation prompt being displayed in the PWA</span></p>
<p class="normal"><span class="koboSpan" id="kobo.920.1">Sometimes you will see cached versions of the application due to running multiple PWAs on the same port, for instance. </span><span class="koboSpan" id="kobo.920.2">In this case, open the Chrome DevTools, go to the </span><strong class="screenText"><span class="koboSpan" id="kobo.921.1">Application</span></strong><span class="koboSpan" id="kobo.922.1"> tab, click the </span><strong class="screenText"><span class="koboSpan" id="kobo.923.1">Service Workers</span></strong><span class="koboSpan" id="kobo.924.1"> option from the left menu, and check the </span><strong class="screenText"><span class="koboSpan" id="kobo.925.1">Bypass for network</span></strong><span class="koboSpan" id="kobo.926.1"> option.</span></p></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="7"><span class="koboSpan" id="kobo.927.1">We’re now going to create</span><a id="_idIndexMarker1165"/><span class="koboSpan" id="kobo.928.1"> a </span><code class="inlineCode"><span class="koboSpan" id="kobo.929.1">signal</span></code><span class="koboSpan" id="kobo.930.1"> inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.931.1">InstallablePromptService</span></code><span class="koboSpan" id="kobo.932.1"> class, based on which we’ll show or hide the custom installation</span><a id="_idIndexMarker1166"/><span class="koboSpan" id="kobo.933.1"> banner. </span><span class="koboSpan" id="kobo.933.2">Update the </span><code class="inlineCode"><span class="koboSpan" id="kobo.934.1">installable-prompt.service.ts</span></code><span class="koboSpan" id="kobo.935.1"> file as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.936.1">import</span></span><span class="koboSpan" id="kobo.937.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.938.1">Injectable</span></span><span class="koboSpan" id="kobo.939.1">, </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.940.1">signal </span></strong></span><span class="koboSpan" id="kobo.941.1">} </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.942.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.943.1">'@angular/core'</span></span><span class="koboSpan" id="kobo.944.1">;
...
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.945.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.946.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.947.1">InstallablePromptService</span></span><span class="koboSpan" id="kobo.948.1"> {
  installPromptEvent!: </span><span class="hljs-title"><span class="koboSpan" id="kobo.949.1">BeforeInstallPromptEvent</span></span><span class="koboSpan" id="kobo.950.1">;
  </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.951.1">isPromptBannerShown = </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.952.1">signal</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.953.1">(</span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.954.1">false</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.955.1">);</span></strong></span>
<span class="hljs-title"><span class="koboSpan" id="kobo.956.1">constructor</span></span><span class="koboSpan" id="kobo.957.1">() {
    ...
  </span><span class="koboSpan" id="kobo.957.2">}
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.958.1">Let’s import the </span><code class="inlineCode"><span class="koboSpan" id="kobo.959.1">InstallationPromptService</span></code><span class="koboSpan" id="kobo.960.1"> class in the app component so we can use it in the template for the custom installation banner. </span><span class="koboSpan" id="kobo.960.2">Update the </span><code class="inlineCode"><span class="koboSpan" id="kobo.961.1">app.component.ts</span></code><span class="koboSpan" id="kobo.962.1"> file as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.963.1">...
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.964.1">import</span></span><span class="koboSpan" id="kobo.965.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.966.1">Component</span></span><span class="koboSpan" id="kobo.967.1">, </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.968.1">inject </span></strong></span><span class="koboSpan" id="kobo.969.1">} </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.970.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.971.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.972.1">@angular/core'</span></span><span class="koboSpan" id="kobo.973.1">;
...
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.974.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.975.1"> { </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.976.1">InstallablePromptService</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.977.1"> } </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.978.1">from</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.979.1">'./services/installable-prompt.service'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.980.1">;</span></strong></span><span class="koboSpan" id="kobo.981.1">
 
...
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.982.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.983.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.984.1">AppComponent</span></span><span class="koboSpan" id="kobo.985.1"> {
  </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.986.1">promptService = </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.987.1">inject</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.988.1">(</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.989.1">InstallablePromptService</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.990.1">);</span></strong></span><span class="koboSpan" id="kobo.991.1">
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.992.1">Update the template now to use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.993.1">signal</span></code><span class="koboSpan" id="kobo.994.1"> from the injected </span><code class="inlineCode"><span class="koboSpan" id="kobo.995.1">InstallablePromptService</span></code><span class="koboSpan" id="kobo.996.1"> in the app component. </span><span class="koboSpan" id="kobo.996.2">Update the </span><code class="inlineCode"><span class="koboSpan" id="kobo.997.1">app.component.html</span></code><span class="koboSpan" id="kobo.998.1"> file as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.999.1">...
 
</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1000.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1001.1">main</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1002.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1003.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1004.1">"content"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1005.1">role</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1006.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1007.1">"main"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1008.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1009.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1010.1">router-outlet</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1011.1">&gt;&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1012.1">router-outlet</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1013.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1014.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1015.1">main</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1016.1">&gt;</span></span><span class="koboSpan" id="kobo.1017.1">
 @if(promptService.isPromptBannerShown()) {
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1018.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1019.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1020.1">id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1021.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1022.1">"installPrompt"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1023.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1024.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1025.1">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1026.1">fixed inset-x-0</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.1027.1">bottom-10 p-4"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1028.1">&gt;</span></span><span class="koboSpan" id="kobo.1029.1">
    ...
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1030.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1031.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1032.1">&gt;</span></span><span class="koboSpan" id="kobo.1033.1">
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1034.1">Restart the server by running </span><code class="inlineCode"><span class="koboSpan" id="kobo.1035.1">npm run serve:static chapter13 ng-pwa-cust-installation 7000</span></code><span class="koboSpan" id="kobo.1036.1"> and you’ll notice that the custom installation banner doesn’t show anymore. </span><span class="koboSpan" id="kobo.1036.2">That’s because now we have to flip the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1037.1">signal</span></code><span class="koboSpan" id="kobo.1038.1"> in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1039.1">InstallationPromptService</span></code><span class="koboSpan" id="kobo.1040.1"> class when the user guesses the score correctly.</span></p> </li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="10"><span class="koboSpan" id="kobo.1041.1">Uninstall the existing PWA</span><a id="_idIndexMarker1167"/><span class="koboSpan" id="kobo.1042.1"> by opening it and then selecting</span><a id="_idIndexMarker1168"/><span class="koboSpan" id="kobo.1043.1"> the </span><strong class="screenText"><span class="koboSpan" id="kobo.1044.1">Uninstall</span></strong><span class="koboSpan" id="kobo.1045.1"> option from the </span><strong class="screenText"><span class="koboSpan" id="kobo.1046.1">More</span></strong><span class="koboSpan" id="kobo.1047.1"> menu, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.1048.1">Figure 13.12</span></em><span class="koboSpan" id="kobo.1049.1">. </span><span class="koboSpan" id="kobo.1049.2">Make sure to check the box that says </span><strong class="screenText"><span class="koboSpan" id="kobo.1050.1">Also clear data from Chrome (...)</span></strong><span class="koboSpan" id="kobo.1051.1"> when prompted.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1052.1">Update the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1053.1">src/app/game/game.component.ts</span></code><span class="koboSpan" id="kobo.1054.1"> file to flip the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1055.1">signal</span></code><span class="koboSpan" id="kobo.1056.1">, as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1057.1">import</span></span><span class="koboSpan" id="kobo.1058.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.1059.1">InstallablePromptService</span></span><span class="koboSpan" id="kobo.1060.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1061.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1062.1">'../services/installable-prompt.service'</span></span><span class="koboSpan" id="kobo.1063.1">;
...
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1064.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1065.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1066.1">GameComponent</span></span><span class="koboSpan" id="kobo.1067.1"> {
  ...
  </span><span class="koboSpan" id="kobo.1067.2">leaderboardService = </span><span class="hljs-title"><span class="koboSpan" id="kobo.1068.1">inject</span></span><span class="koboSpan" id="kobo.1069.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.1070.1">LeaderboardService</span></span><span class="koboSpan" id="kobo.1071.1">);
  promptService = </span><span class="hljs-title"><span class="koboSpan" id="kobo.1072.1">inject</span></span><span class="koboSpan" id="kobo.1073.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.1074.1">InstallablePromptService</span></span><span class="koboSpan" id="kobo.1075.1">);
  ...
  
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.1076.1">showResult</span></span><span class="koboSpan" id="kobo.1077.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.1078.1">diceSide: IDiceSide</span></span><span class="koboSpan" id="kobo.1079.1">) {
    ...
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1080.1">if</span></span><span class="koboSpan" id="kobo.1081.1"> (!</span><span class="hljs-variable"><span class="koboSpan" id="kobo.1082.1">this</span></span><span class="koboSpan" id="kobo.1083.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1084.1">isCorrectGuess</span></span><span class="koboSpan" id="kobo.1085.1">) {
      </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1086.1">return</span></span><span class="koboSpan" id="kobo.1087.1">;
    }
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1088.1">if</span></span><span class="koboSpan" id="kobo.1089.1"> (</span><span class="hljs-variable"><span class="koboSpan" id="kobo.1090.1">this</span></span><span class="koboSpan" id="kobo.1091.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1092.1">promptService</span></span><span class="koboSpan" id="kobo.1093.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1094.1">installPromptEvent</span></span><span class="koboSpan" id="kobo.1095.1">) {
      </span><span class="hljs-variable"><span class="koboSpan" id="kobo.1096.1">this</span></span><span class="koboSpan" id="kobo.1097.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1098.1">promptService</span></span><span class="koboSpan" id="kobo.1099.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1100.1">isPromptBannerShown</span></span><span class="koboSpan" id="kobo.1101.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1102.1">set</span></span><span class="koboSpan" id="kobo.1103.1">(</span><span class="hljs-literal"><span class="koboSpan" id="kobo.1104.1">true</span></span><span class="koboSpan" id="kobo.1105.1">);
    }
    ...
  </span><span class="koboSpan" id="kobo.1105.2">}
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1106.1">If you now run the app again, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.1107.1">step 6</span></em><span class="koboSpan" id="kobo.1108.1">, and guess the dice rolls, and you guess the correct one, you should be able to see the custom installation banner, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.1109.1">Figure 13.25</span></em><span class="koboSpan" id="kobo.1110.1">:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1111.1"><img alt="" role="presentation" src="../Images/B18469_13_25.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1112.1">Figure 13.25: Custom installation banner being displayed after guessing</span></p> </li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="12"><span class="koboSpan" id="kobo.1113.1">Now we’ll implement </span><a id="_idIndexMarker1169"/><span class="koboSpan" id="kobo.1114.1">what happens when we click</span><a id="_idIndexMarker1170"/><span class="koboSpan" id="kobo.1115.1"> the </span><strong class="screenText"><span class="koboSpan" id="kobo.1116.1">Install it!</span></strong><span class="koboSpan" id="kobo.1117.1"> link from the custom installation banner. </span><span class="koboSpan" id="kobo.1117.2">Create a new method in the file </span><code class="inlineCode"><span class="koboSpan" id="kobo.1118.1">installable-prompt.service.ts</span></code><span class="koboSpan" id="kobo.1119.1"> as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1120.1">...
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1121.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1122.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1123.1">InstallablePromptService</span></span><span class="koboSpan" id="kobo.1124.1"> {
  ...
 
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.1125.1">handleInstallPrompt</span></span><span class="koboSpan" id="kobo.1126.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.1127.1">ev: BeforeInstallPromptEvent</span></span><span class="koboSpan" id="kobo.1128.1">) {...}
 
  </span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1129.1">async</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1130.1">showInstallPrompt</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1131.1">() {</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1132.1">if</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1133.1"> (!</span></strong><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.1134.1">this</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1135.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1136.1">installPromptEvent</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1137.1">) {</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1138.1">return</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1139.1">;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1140.1">}</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1141.1">await</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.1142.1">this</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1143.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1144.1">installPromptEvent</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1145.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1146.1">prompt</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1147.1">();</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1148.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1149.1"> { outcome } =</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1150.1">await</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.1151.1">this</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1152.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1153.1">installPromptEvent</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1154.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1155.1">userChoice</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1156.1">;</span></strong></span>
<span class="code-highlight"><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.1157.1">console</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1158.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1159.1">log</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1160.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1161.1">'The choice of user is '</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1162.1">, outcome);</span></strong></span>
<span class="code-highlight"><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.1163.1">this</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1164.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1165.1">isPromptBannerShown</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1166.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1167.1">set</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1168.1">(</span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.1169.1">false</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1170.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1171.1">}</span></strong></span><span class="koboSpan" id="kobo.1172.1">
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1173.1">We will now call this method</span><a id="_idIndexMarker1171"/><span class="koboSpan" id="kobo.1174.1"> from the custom installation banner</span><a id="_idIndexMarker1172"/><span class="koboSpan" id="kobo.1175.1"> to show the browser’s installation prompt. </span><span class="koboSpan" id="kobo.1175.2">Update the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1176.1">app.component.html</span></code><span class="koboSpan" id="kobo.1177.1"> file, as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1178.1">...
</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1179.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1180.1">main</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1181.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1182.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1183.1">"content"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1184.1">role</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1185.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1186.1">"main"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1187.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1188.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1189.1">router-outlet</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1190.1">&gt;&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1191.1">router-outlet</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1192.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1193.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1194.1">main</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1195.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1196.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1197.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1198.1">id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1199.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1200.1">"installPrompt"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1201.1"> *</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1202.1">ngIf</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1203.1">=</span></span>
<span class="hljs-tag"> </span><span class="hljs-string"><span class="koboSpan" id="kobo.1204.1">"promptService.isPromptBannerShown()"</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1205.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1206.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1207.1">"fixed inset-x-0 bottom-4 p-4"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1208.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1209.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1210.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1211.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1212.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1213.1">"rounded-lg bg-purple-600 </span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.1214.1">px-4 py-3 text-white shadow-lg"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1215.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1216.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1217.1">p</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1218.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1219.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1220.1">"text-center text-sm font-medium"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1221.1">&gt;</span></span><span class="koboSpan" id="kobo.1222.1">
      Love the Dice Game?
      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1223.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1224.1">a</span></span><span class="hljs-tag"> </span><span class="code-highlight"><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1225.1">(</span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1226.1">click</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1227.1">)=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1228.1">"promptService.showInstallPrompt()"</span></strong></span>
<span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1229.1">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1230.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1231.1">"#"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1232.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1233.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1234.1">"inline-block underline"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1235.1">&gt;</span></span><span class="koboSpan" id="kobo.1236.1">
        Install it!
      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1237.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1238.1">a</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1239.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1240.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1241.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1242.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1243.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1244.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1245.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1246.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1247.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1248.1">&gt;</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1249.1">Now, if you rerun the app in the browser and guess the dice’s next value, you can click on the </span><strong class="screenText"><span class="koboSpan" id="kobo.1250.1">Install it!</span></strong><span class="koboSpan" id="kobo.1251.1"> link to see the browser prompt, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.1252.1">Figure 13.26</span></em><span class="koboSpan" id="kobo.1253.1">:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1254.1"><img alt="" role="presentation" src="../Images/B18469_13_26.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1255.1">Figure 13.26: Browser installation prompt being displayed</span></p> </li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="14"><span class="koboSpan" id="kobo.1256.1">Finally, we don’t want</span><a id="_idIndexMarker1173"/><span class="koboSpan" id="kobo.1257.1"> to show the custom installation</span><a id="_idIndexMarker1174"/><span class="koboSpan" id="kobo.1258.1"> banner when the app is running as a PWA. </span><span class="koboSpan" id="kobo.1258.2">And right now, it does. </span><span class="koboSpan" id="kobo.1258.3">To fix that, we’ll add some styles to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1259.1">app.component.scss</span></code><span class="koboSpan" id="kobo.1260.1">, as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1261.1">@media</span></span><span class="koboSpan" id="kobo.1262.1"> all </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1263.1">and</span></span><span class="koboSpan" id="kobo.1264.1"> (</span><span class="hljs-attribute"><span class="koboSpan" id="kobo.1265.1">display-mode</span></span><span class="koboSpan" id="kobo.1266.1">: standalone) {
  </span><span class="hljs-selector-id"><span class="koboSpan" id="kobo.1267.1">#installPrompt</span></span><span class="koboSpan" id="kobo.1268.1"> {
    </span><span class="hljs-attribute"><span class="koboSpan" id="kobo.1269.1">display</span></span><span class="koboSpan" id="kobo.1270.1">: none </span><span class="hljs-meta"><span class="koboSpan" id="kobo.1271.1">!important</span></span><span class="koboSpan" id="kobo.1272.1">;
  }
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1273.1">If you install the PWA now and guess the dice’s next value correctly, you won’t see the custom installation banner anymore.</span></p> </li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.1274.1">Awesome! </span><span class="koboSpan" id="kobo.1274.2">You can now play around with the app by installing and uninstalling the PWA a few times and trying out all the combinations of the user choosing to install or not to install the app. </span><span class="koboSpan" id="kobo.1274.3">It’s all fun and games. </span><span class="koboSpan" id="kobo.1274.4">Now that you know how to implement a custom installation banner for an Angular PWA, move on to the next section to understand how it works.</span></p>
<h2 class="heading-2" id="_idParaDest-465"><span class="koboSpan" id="kobo.1275.1">How it works…</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1276.1">The heart of this recipe</span><a id="_idIndexMarker1175"/><span class="koboSpan" id="kobo.1277.1"> is the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1278.1">beforeinstallprompt</span></code><span class="koboSpan" id="kobo.1279.1"> event. </span><span class="koboSpan" id="kobo.1279.2">It is a standard browser</span><a id="_idIndexMarker1176"/><span class="koboSpan" id="kobo.1280.1"> event that is supported in the latest versions of Chrome, Firefox, Safari, Opera, UC Browser (Android version), and Samsung Internet, that is, almost all major browsers. </span><span class="koboSpan" id="kobo.1280.2">The event has a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1281.1">prompt</span></code><span class="koboSpan" id="kobo.1282.1"> method, which shows the browser’s default prompt on the device. </span><span class="koboSpan" id="kobo.1282.2">In the recipe, we create </span><code class="inlineCode"><span class="koboSpan" id="kobo.1283.1">InstallablePromptService</span></code><span class="koboSpan" id="kobo.1284.1"> and store the event in a property called </span><code class="inlineCode"><span class="koboSpan" id="kobo.1285.1">installPromptEvent</span></code><span class="koboSpan" id="kobo.1286.1">. </span><span class="koboSpan" id="kobo.1286.2">This is so we can use it later on demand when the user has guessed a correct dice-roll value. </span><span class="koboSpan" id="kobo.1286.3">Note that as soon as we receive the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1287.1">beforeinstallprompt</span></code><span class="koboSpan" id="kobo.1288.1"> event, we remove the event listener from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1289.1">window</span></code><span class="koboSpan" id="kobo.1290.1"> object, so we only save the event once. </span><span class="koboSpan" id="kobo.1290.2">That is when the app starts. </span><span class="koboSpan" id="kobo.1290.3">If the user chooses not to install the app, we don’t show the prompt again within the same session. </span><span class="koboSpan" id="kobo.1290.4">However, if the user refreshes the app, they will still get the prompt one time for the first correct guess. </span><span class="koboSpan" id="kobo.1290.5">We could go one step further to save this state in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1291.1">localStorage</span></code><span class="koboSpan" id="kobo.1292.1"> to avoid showing the prompt after the page refreshes, but that’s not part of this recipe.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1293.1">For the custom installation banner, we use a template based on Tailwind CSS. </span><span class="koboSpan" id="kobo.1293.2">Note that on the custom installation banner, we have a link. </span><span class="koboSpan" id="kobo.1293.3">When we click this link, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1294.1">showInstallPrompt</span></code><span class="koboSpan" id="kobo.1295.1"> method from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1296.1">InstallablePromptService</span></code><span class="koboSpan" id="kobo.1297.1"> class is called. </span><span class="koboSpan" id="kobo.1297.2">In that method, we use the event, that is, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1298.1">this.installPromptEvent</span></code><span class="koboSpan" id="kobo.1299.1"> property’s </span><code class="inlineCode"><span class="koboSpan" id="kobo.1300.1">prompt</span></code><span class="koboSpan" id="kobo.1301.1"> method to show the browser’s prompt. </span><span class="koboSpan" id="kobo.1301.2">Note that after we’ve displayed the browser’s prompt, we set the signal </span><code class="inlineCode"><span class="koboSpan" id="kobo.1302.1">isPromptBannerShown</span></code><span class="koboSpan" id="kobo.1303.1"> value to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1304.1">false</span></code><span class="koboSpan" id="kobo.1305.1">, so it hides the custom install banner. </span><span class="koboSpan" id="kobo.1305.2">This is also so we don’t show the prompt again in the same session until the user refreshes the page.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1306.1">Finally, we also use some CSS to not show the custom installation banner at all if the app is launched as a PWA. </span><span class="koboSpan" id="kobo.1306.2">This is important because if it is already a PWA, it doesn’t make sense to show an install prompt. </span><span class="koboSpan" id="kobo.1306.3">Therefore, we use an </span><code class="inlineCode"><span class="koboSpan" id="kobo.1307.1">@media</span></code><span class="koboSpan" id="kobo.1308.1"> query with </span><code class="inlineCode"><span class="koboSpan" id="kobo.1309.1">display-mode: standalone</span></code><span class="koboSpan" id="kobo.1310.1">, which checks if the app is running as a PWA. </span><span class="koboSpan" id="kobo.1310.2">In that CSS rule, we hide the custom installation banner.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1311.1">Now that you understand</span><a id="_idIndexMarker1177"/><span class="koboSpan" id="kobo.1312.1"> how it all works, refer to the next</span><a id="_idIndexMarker1178"/><span class="koboSpan" id="kobo.1313.1"> section to see links for further reading.</span></p>
<h2 class="heading-2" id="_idParaDest-466"><span class="koboSpan" id="kobo.1314.1">See also</span></h2>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.1315.1">How to provide your</span><a id="_idIndexMarker1179"/><span class="koboSpan" id="kobo.1316.1"> own app-install experience (</span><code class="inlineCode"><span class="koboSpan" id="kobo.1317.1">web.dev</span></code><span class="koboSpan" id="kobo.1318.1">): </span><a href="https://web.dev/customize-install/"><span class="url"><span class="koboSpan" id="kobo.1319.1">https://web.dev/customize-install/</span></span></a></li>
</ul>
<h1 class="heading-1" id="_idParaDest-467"><span class="koboSpan" id="kobo.1320.1">Precaching requests using an Angular service worker</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1321.1">With the addition of service workers</span><a id="_idIndexMarker1180"/><span class="koboSpan" id="kobo.1322.1"> in our previous recipes, we’ve seen</span><a id="_idIndexMarker1181"/><span class="koboSpan" id="kobo.1323.1"> that they already cache the assets and serve them using the service worker if we go into Offline mode. </span><span class="koboSpan" id="kobo.1323.2">But what about network requests? </span><span class="koboSpan" id="kobo.1323.3">If the user goes offline and refreshes the application right now, the network requests fail because they’re not cached with the service worker. </span><span class="koboSpan" id="kobo.1323.4">This results in a broken offline user experience. </span><span class="koboSpan" id="kobo.1323.5">In this recipe, we’ll configure the service worker to precache network requests, so the app works fluently in Offline mode as well.</span></p>
<h2 class="heading-2" id="_idParaDest-468"><span class="koboSpan" id="kobo.1324.1">Getting ready </span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1325.1">The app that we are going to work with resides in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1326.1">start/apps/chapter13/ng-pwa-precaching</span></code><span class="koboSpan" id="kobo.1327.1"> inside the cloned repository:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1328.1">Open the code repository in your code editor.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1329.1">Open the terminal, navigate to the cloned code repository folder, and run the following command (from the workspace’s root folder) to serve the project in production mode:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1330.1">npm run serve:static chapter13 ng-pwa-precaching 7600
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1331.1">This should open the app in a new browser tab at </span><code class="inlineCode"><span class="koboSpan" id="kobo.1332.1">https://localhost:7600</span></code><span class="koboSpan" id="kobo.1333.1">.</span></p></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="3"><span class="koboSpan" id="kobo.1334.1">Refresh the page once.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1335.1">Now, switch to Offline mode as shown in </span><em class="italic"><span class="koboSpan" id="kobo.1336.1">Figure 13.2</span></em><span class="koboSpan" id="kobo.1337.1">. </span><span class="koboSpan" id="kobo.1337.2">If you go to the </span><strong class="screenText"><span class="koboSpan" id="kobo.1338.1">Network</span></strong><span class="koboSpan" id="kobo.1339.1"> tab and filter the requests using the query results, you should see that the requests fail, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.1340.1">Figure 13.27</span></em><span class="koboSpan" id="kobo.1341.1">:
    </span><figure class="mediaobject"><span class="koboSpan" id="kobo.1342.1"><img alt="" role="presentation" src="../Images/B18469_13_27.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1343.1">Figure 13.27: Offline experience broken due to not caching the network requests</span></p></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.1344.1">Now that we see the network</span><a id="_idIndexMarker1182"/><span class="koboSpan" id="kobo.1345.1"> requests failing, let us see</span><a id="_idIndexMarker1183"/><span class="koboSpan" id="kobo.1346.1"> the steps of the recipe to fix this in the next section.</span></p>
<h2 class="heading-2" id="_idParaDest-469"><span class="koboSpan" id="kobo.1347.1">How to do it…</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1348.1">As you can see in </span><em class="italic"><span class="koboSpan" id="kobo.1349.1">Figure 13.27</span></em><span class="koboSpan" id="kobo.1350.1">, the app still loads. </span><span class="koboSpan" id="kobo.1350.2">We can see the header and the loader. </span><span class="koboSpan" id="kobo.1350.3">However, the API (fetch) calls do not work since we are simulating an offline network situation using Chrome DevTools. </span><span class="koboSpan" id="kobo.1350.4">This is because the service worker is not configured yet to cache the data request. </span><span class="koboSpan" id="kobo.1350.5">Let us get started with the recipe to fix this:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1351.1">To cache the network requests, open the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1352.1">ngsw-config.json</span></code><span class="koboSpan" id="kobo.1353.1"> file inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1354.1">start/apps/chapter13/ng-pwa-precaching</span></code><span class="koboSpan" id="kobo.1355.1"> folder and update it as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1356.1">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1357.1">"$schema"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1358.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1359.1">"../../../node_modules/@angular/service-worker/config/schema.json"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1360.1">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1361.1">"index"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1362.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1363.1">"/index.html"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1364.1">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1365.1">"assetGroups"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1366.1">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.1367.1">[</span></span><span class="koboSpan" id="kobo.1368.1">
    ...
  </span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1369.1">],</span></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1370.1">"dataGroups"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.1371.1">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.1372.1">[</span></strong></span>
<span class="code-highlight"><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.1373.1">{</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1374.1">"name"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.1375.1">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1376.1">"swapi.dev"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.1377.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1378.1">"urls"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.1379.1">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.1380.1">[</span></strong></span>
<span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1381.1">"https://swapi.dev/api/*"</span></strong></span>
<span class="code-highlight"><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.1382.1">],</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1383.1">"</span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1384.1">cacheConfig"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.1385.1">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.1386.1">{</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1387.1">"strategy"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.1388.1">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1389.1">"freshness"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.1390.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1391.1">"maxSize"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.1392.1">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.1393.1">100</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.1394.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1395.1">"</span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1396.1">maxAge"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.1397.1">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1398.1">"2d"</span></strong></span>
<span class="code-highlight"><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.1399.1">}</span></strong></span>
<span class="code-highlight"><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.1400.1">}</span></strong></span>
<span class="code-highlight"><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.1401.1">]</span></strong></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.1402.1">}</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1403.1">Let us test the application now. </span><span class="koboSpan" id="kobo.1403.2">Build and run the app in production mode using the following command:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1404.1">npm run serve:static chapter13 ng-pwa-precaching 7600
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1405.1">Now navigate to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1406.1">http://localhost:7600</span></code><span class="koboSpan" id="kobo.1407.1">. </span><span class="koboSpan" id="kobo.1407.2">Make sure </span><strong class="screenText"><span class="koboSpan" id="kobo.1408.1">Network throttling</span></strong><span class="koboSpan" id="kobo.1409.1"> is not enabled, that is, you are not in </span><strong class="screenText"><span class="koboSpan" id="kobo.1410.1">Offline</span></strong><span class="koboSpan" id="kobo.1411.1"> mode.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1412.1">Clear the app data using Chrome DevTools using the </span><strong class="screenText"><span class="koboSpan" id="kobo.1413.1">Application </span></strong><span class="koboSpan" id="kobo.1414.1">tab | the </span><strong class="screenText"><span class="koboSpan" id="kobo.1415.1">Storage</span></strong><span class="koboSpan" id="kobo.1416.1"> panel. </span><span class="koboSpan" id="kobo.1416.2">Or press </span><em class="keystroke"><span class="koboSpan" id="kobo.1417.1">Cmd + Shift + R</span></em><span class="koboSpan" id="kobo.1418.1"> (macOS X) or </span><em class="keystroke"><span class="koboSpan" id="kobo.1419.1">Ctrl + Shift + R</span></em><span class="koboSpan" id="kobo.1420.1"> (Windows) to do a hard reload.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1421.1">Refresh the app once</span><a id="_idIndexMarker1184"/><span class="koboSpan" id="kobo.1422.1"> more to let the service</span><a id="_idIndexMarker1185"/><span class="koboSpan" id="kobo.1423.1"> worker cache the API requests.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1424.1">In Chrome DevTools, go to the </span><strong class="screenText"><span class="koboSpan" id="kobo.1425.1">Network</span></strong><span class="koboSpan" id="kobo.1426.1"> tab and switch to Offline mode, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.1427.1">Figure 13.2</span></em><span class="koboSpan" id="kobo.1428.1">. </span><span class="koboSpan" id="kobo.1428.2">Refresh the app again. </span><span class="koboSpan" id="kobo.1428.3">You should see the data from Swapi despite being offline. </span><span class="koboSpan" id="kobo.1428.4">The network calls are served from the service worker, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.1429.1">Figure 13.28</span></em><span class="koboSpan" id="kobo.1430.1">:
    </span><figure class="mediaobject"><span class="koboSpan" id="kobo.1431.1"><img alt="" role="presentation" src="../Images/B18469_13_28.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1432.1">Figure 13.28: Network calls being cached by the service worker</span></p></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.1433.1">And boom! </span><span class="koboSpan" id="kobo.1433.2">You have just learned how to configure a service worker in an Angular app to cache network/data requests. </span><span class="koboSpan" id="kobo.1433.3">And you can install the PWA and use it even if you are offline. </span><span class="koboSpan" id="kobo.1433.4">Awesome, right?</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1434.1">Now that we have finished the recipe, let’s see how it all works in the next section.</span></p>
<h2 class="heading-2" id="_idParaDest-470"><span class="koboSpan" id="kobo.1435.1">How it works…</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1436.1">The heart of this recipe</span><a id="_idIndexMarker1186"/><span class="koboSpan" id="kobo.1437.1"> is the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1438.1">ngsw-config.json</span></code><span class="koboSpan" id="kobo.1439.1"> file. </span><span class="koboSpan" id="kobo.1439.2">This file is used by the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1440.1">@angular/service-worker</span></code><span class="koboSpan" id="kobo.1441.1"> package when generating</span><a id="_idIndexMarker1187"/><span class="koboSpan" id="kobo.1442.1"> the service worker file. </span><span class="koboSpan" id="kobo.1442.2">The file already contains a JSON object out of the box when we use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1443.1">@angular/pwa</span></code><span class="koboSpan" id="kobo.1444.1"> schematics by running </span><code class="inlineCode"><span class="koboSpan" id="kobo.1445.1">ng add @angular/pwa</span></code><span class="koboSpan" id="kobo.1446.1">. </span><span class="koboSpan" id="kobo.1446.2">This JSON contains a property called </span><code class="inlineCode"><span class="koboSpan" id="kobo.1447.1">assetGroups</span></code><span class="koboSpan" id="kobo.1448.1">, which configures the caching of the assets based on the provided configuration. </span><span class="koboSpan" id="kobo.1448.2">For this recipe, we wanted to cache network requests along with the assets. </span><span class="koboSpan" id="kobo.1448.3">Therefore, we added the new property </span><code class="inlineCode"><span class="koboSpan" id="kobo.1449.1">dataGroups</span></code><span class="koboSpan" id="kobo.1450.1"> in the JSON object. </span><span class="koboSpan" id="kobo.1450.2">Let us have a look at the configuration:</span></p>
<pre class="programlisting code"><code class="hljs-code"> <span class="hljs-attr"><span class="koboSpan" id="kobo.1451.1">"dataGroups"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1452.1">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.1453.1">[</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.1454.1">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1455.1">"name"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1456.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1457.1">"swapi.dev"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1458.1">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1459.1">"urls"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1460.1">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.1461.1">[</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.1462.1">"https://swapi.dev/api/*"</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.1463.1">],</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1464.1">"cacheConfig"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1465.1">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.1466.1">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1467.1">"strategy"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1468.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1469.1">"freshness"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1470.1">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1471.1">"maxSize"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1472.1">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.1473.1">100</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1474.1">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.1475.1">"maxAge"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.1476.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1477.1">"2d"</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.1478.1">}</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.1479.1">}</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.1480.1">]</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1481.1">As you can see, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1482.1">dataGroups</span></code><span class="koboSpan" id="kobo.1483.1"> is an array. </span><span class="koboSpan" id="kobo.1483.2">We can provide different configuration objects as elements to it. </span><span class="koboSpan" id="kobo.1483.3">Each configuration has a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1484.1">name</span></code><span class="koboSpan" id="kobo.1485.1">, an array of </span><code class="inlineCode"><span class="koboSpan" id="kobo.1486.1">urls</span></code><span class="koboSpan" id="kobo.1487.1">, and a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1488.1">cacheConfig</span></code><span class="koboSpan" id="kobo.1489.1"> that defines the caching strategy. </span><span class="koboSpan" id="kobo.1489.2">For our configuration, we use a wildcard with the API URL, that is, we use </span><code class="inlineCode"><span class="koboSpan" id="kobo.1490.1">urls</span></code><span class="koboSpan" id="kobo.1491.1">: ["</span><code class="inlineCode"><span class="koboSpan" id="kobo.1492.1">https://swapi.dev/api/*</span></code><span class="koboSpan" id="kobo.1493.1">"]. </span><span class="koboSpan" id="kobo.1493.2">For the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1494.1">cacheConfig</span></code><span class="koboSpan" id="kobo.1495.1">, we are using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1496.1">freshness</span></code><span class="koboSpan" id="kobo.1497.1"> strategy, which means the app will always fetch the data from its origin first. </span><span class="koboSpan" id="kobo.1497.2">If the network is unavailable, then it will use the response from the service worker cache. </span><span class="koboSpan" id="kobo.1497.3">An alternate strategy is </span><code class="inlineCode"><span class="koboSpan" id="kobo.1498.1">performance</span></code><span class="koboSpan" id="kobo.1499.1">, which first looks up the service worker for a cached response. </span><span class="koboSpan" id="kobo.1499.2">If there is nothing in the cache for the URL (or URLs), then it fetches the data from the actual origin. </span><span class="koboSpan" id="kobo.1499.3">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1500.1">maxSize</span></code><span class="koboSpan" id="kobo.1501.1"> property defines how many requests can be cached for the same pattern (or set of URLs). </span><span class="koboSpan" id="kobo.1501.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1502.1">maxAge</span></code><span class="koboSpan" id="kobo.1503.1"> property defines how long the cached</span><a id="_idIndexMarker1188"/><span class="koboSpan" id="kobo.1504.1"> data would live in the service </span><a id="_idIndexMarker1189"/><span class="koboSpan" id="kobo.1505.1">worker cache.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1506.1">Now that you know how the recipe works, see the next section for links to further reading.</span></p>
<h2 class="heading-2" id="_idParaDest-471"><span class="koboSpan" id="kobo.1507.1">See also</span></h2>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.1508.1">Angular service</span><a id="_idIndexMarker1190"/><span class="koboSpan" id="kobo.1509.1"> worker intro: </span><a href="https://angular.io/guide/service-worker-intro"><span class="url"><span class="koboSpan" id="kobo.1510.1">https://angular.io/guide/service-worker-intro</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1511.1">Angular service </span><a id="_idIndexMarker1191"/><span class="koboSpan" id="kobo.1512.1">worker config: </span><a href="https://angular.io/guide/service-worker-config"><span class="url"><span class="koboSpan" id="kobo.1513.1">https://angular.io/guide/service-worker-config</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1514.1">Creating an offline</span><a id="_idIndexMarker1192"/><span class="koboSpan" id="kobo.1515.1"> fallback page (</span><code class="inlineCode"><span class="koboSpan" id="kobo.1516.1">web.dev</span></code><span class="koboSpan" id="kobo.1517.1">): </span><a href="https://web.dev/offline-fallback-page/"><span class="url"><span class="koboSpan" id="kobo.1518.1">https://web.dev/offline-fallback-page/</span></span></a></li>
</ul>
<h1 class="heading-1" id="_idParaDest-472"><span class="koboSpan" id="kobo.1519.1">Creating an App Shell for your PWA</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1520.1">When it comes to building</span><a id="_idIndexMarker1193"/><span class="koboSpan" id="kobo.1521.1"> fast user experiences for web apps, one of the major challenges</span><a id="_idIndexMarker1194"/><span class="koboSpan" id="kobo.1522.1"> is minimizing the critical rendering path. </span><span class="koboSpan" id="kobo.1522.2">This includes loading the most critical resources for the target page, parsing, executing JavaScript, and so on. </span><span class="koboSpan" id="kobo.1522.3">With an App Shell, we can render a page, or a portion of the app, at build time rather than runtime. </span><span class="koboSpan" id="kobo.1522.4">This means the user will see the minimal pre-rendered content initially, until JavaScript and Angular kick in. </span><span class="koboSpan" id="kobo.1522.5">This means the browser does not have to work and wait a while for the first meaningful paint. </span><span class="koboSpan" id="kobo.1522.6">This not only provides a good user experience but also helps rank the website higher in search engines, i.e., results in better SEO. </span><span class="koboSpan" id="kobo.1522.7">In this recipe, you will create an App Shell for an Angular PWA.</span></p>
<h2 class="heading-2" id="_idParaDest-473"><span class="koboSpan" id="kobo.1523.1">Getting ready</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1524.1">The app that we are going to work with resides in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1525.1">start/apps/chapter13/ng-pwa-app-shell</span></code><span class="koboSpan" id="kobo.1526.1"> inside the cloned repository:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1527.1">Open the code repository in your code editor.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1528.1">Open the terminal, navigate to the cloned code repository folder, and run the following command (from the workspace’s root folder) to serve the project in production mode:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1529.1">npm run serve ng-pwa-app-shell
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1530.1">This should open the app</span><a id="_idIndexMarker1195"/><span class="koboSpan" id="kobo.1531.1"> in a new browser</span><a id="_idIndexMarker1196"/><span class="koboSpan" id="kobo.1532.1"> tab at </span><code class="inlineCode"><span class="koboSpan" id="kobo.1533.1">http://localhost:4200</span></code><span class="koboSpan" id="kobo.1534.1">, and you should see the following:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1535.1"><img alt="" role="presentation" src="../Images/B18469_13_29.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1536.1">Figure 13.29: ng-pwa-app-shell running on http://localhost:4200</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1537.1">Now we’ll disable JavaScript to simulate taking a lot of time to parse JavaScript, or to simulate that there’s no App Shell in place yet. </span><span class="koboSpan" id="kobo.1537.2">Now open Chrome DevTools. </span><span class="koboSpan" id="kobo.1537.3">Then open the command panel. </span><span class="koboSpan" id="kobo.1537.4">The shortcut for opening the command panel is </span><em class="keystroke"><span class="koboSpan" id="kobo.1538.1">Cmd + Shift + P</span></em><span class="koboSpan" id="kobo.1539.1"> on Mac OS X and </span><em class="keystroke"><span class="koboSpan" id="kobo.1540.1">Ctrl + Shift + P</span></em><span class="koboSpan" id="kobo.1541.1"> on Windows. </span><span class="koboSpan" id="kobo.1541.2">Type </span><strong class="screenText"><span class="koboSpan" id="kobo.1542.1">Disable JavaScript</span></strong><span class="koboSpan" id="kobo.1543.1">, select the option, and hit </span><em class="keystroke"><span class="koboSpan" id="kobo.1544.1">Enter</span></em><span class="koboSpan" id="kobo.1545.1">. </span><span class="koboSpan" id="kobo.1545.2">Refresh the page while Chrome DevTools is still open, and you should see a message as follows:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1546.1"><img alt="" role="presentation" src="../Images/B18469_13_30.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1547.1">Figure 13.30: No App Shell present in the app</span></p> </li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.1548.1">Now that we have checked for the absence of the App Shell, let’s see the steps of the recipe in the next section.</span></p>
<h2 class="heading-2" id="_idParaDest-474"><span class="koboSpan" id="kobo.1549.1">How to do it…</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1550.1">We have an Angular application</span><a id="_idIndexMarker1197"/><span class="koboSpan" id="kobo.1551.1"> that fetches some users</span><a id="_idIndexMarker1198"/><span class="koboSpan" id="kobo.1552.1"> from an API. </span><span class="koboSpan" id="kobo.1552.2">We will create an App Shell for this app so it can provide the first meaningful paint faster as a PWA. </span><span class="koboSpan" id="kobo.1552.3">Let’s get started:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1553.1">First, create the App Shell for the app by running the following command from the project root:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1554.1">cd start &amp;&amp; nx g app-shell --project=ng-pwa-app-shell
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1555.1">This adds some new files to our project but also updates </span><code class="inlineCode"><span class="koboSpan" id="kobo.1556.1">project.json</span></code><span class="koboSpan" id="kobo.1557.1">. </span><span class="koboSpan" id="kobo.1557.2">Since we’re using a unique folder structure for the recipes, you need to update the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1558.1">project.json</span></code><span class="koboSpan" id="kobo.1559.1"> file by replacing all the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1560.1">dist/ng-pwa-app-shell</span></code><span class="koboSpan" id="kobo.1561.1"> instances with </span><code class="inlineCode"><span class="koboSpan" id="kobo.1562.1">dist/apps/chapter13/ng-pwa-app-shell</span></code><span class="koboSpan" id="kobo.1563.1">.</span></p></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="2"><span class="koboSpan" id="kobo.1564.1">Update the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1565.1">src/app/app-shell/app-shell.component.ts</span></code><span class="koboSpan" id="kobo.1566.1"> file to import the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1567.1">UsersComponent</span></code><span class="koboSpan" id="kobo.1568.1"> class so we can render the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1569.1">users</span></code><span class="koboSpan" id="kobo.1570.1"> page in the App Shell. </span><span class="koboSpan" id="kobo.1570.2">The code should look as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1571.1">...
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1572.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1573.1"> { </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1574.1">UsersComponent</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1575.1"> } </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1576.1">from</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1577.1">'../users/users.component'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1578.1">;</span></strong></span>
<span class="hljs-meta"><span class="koboSpan" id="kobo.1579.1">@Component</span></span><span class="koboSpan" id="kobo.1580.1">({
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1581.1">selector</span></span><span class="koboSpan" id="kobo.1582.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.1583.1">'app-app-shell'</span></span><span class="koboSpan" id="kobo.1584.1">,
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1585.1">standalone</span></span><span class="koboSpan" id="kobo.1586.1">: </span><span class="hljs-literal"><span class="koboSpan" id="kobo.1587.1">true</span></span><span class="koboSpan" id="kobo.1588.1">,
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1589.1">imports</span></span><span class="koboSpan" id="kobo.1590.1">: [</span><span class="hljs-title"><span class="koboSpan" id="kobo.1591.1">CommonModule</span></span><span class="koboSpan" id="kobo.1592.1">, </span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1593.1">UsersComponent</span></strong></span><span class="koboSpan" id="kobo.1594.1">],
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1595.1">templateUrl</span></span><span class="koboSpan" id="kobo.1596.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.1597.1">'./app-shell.component.html'</span></span><span class="koboSpan" id="kobo.1598.1">,
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1599.1">styleUrls</span></span><span class="koboSpan" id="kobo.1600.1">: [</span><span class="hljs-string"><span class="koboSpan" id="kobo.1601.1">'./app-shell.component.css'</span></span><span class="koboSpan" id="kobo.1602.1">],
})
...
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1603.1">Now open the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1604.1">app-shell.component.html</span></code><span class="koboSpan" id="kobo.1605.1"> file and use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1606.1">&lt;app-users&gt;</span></code><span class="koboSpan" id="kobo.1607.1"> element so we render the whole </span><code class="inlineCode"><span class="koboSpan" id="kobo.1608.1">UsersComponent</span></code><span class="koboSpan" id="kobo.1609.1"> in the App Shell. </span><span class="koboSpan" id="kobo.1609.2">The code should look as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag"><span class="koboSpan" id="kobo.1610.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1611.1">app-users</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1612.1">&gt;&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1613.1">app-users</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1614.1">&gt;</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1615.1">Finally, update </span><code class="inlineCode"><span class="koboSpan" id="kobo.1616.1">users.component.ts </span></code><span class="koboSpan" id="kobo.1617.1">to show the skeleton</span><a id="_idIndexMarker1199"/><span class="koboSpan" id="kobo.1618.1"> loader when the App</span><a id="_idIndexMarker1200"/><span class="koboSpan" id="kobo.1619.1"> Shell is being generated. </span><span class="koboSpan" id="kobo.1619.2">Update the file as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1620.1">import</span></span><span class="koboSpan" id="kobo.1621.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.1622.1">Component</span></span><span class="koboSpan" id="kobo.1623.1">, inject, </span><span class="hljs-title"><span class="koboSpan" id="kobo.1624.1">OnInit</span></span><span class="koboSpan" id="kobo.1625.1">, </span><span class="code-highlight"><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.1626.1">PLATFORM_ID</span></strong></span><span class="koboSpan" id="kobo.1627.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1628.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1629.1">'@angular/core'</span></span><span class="koboSpan" id="kobo.1630.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1631.1">import</span></span><span class="koboSpan" id="kobo.1632.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.1633.1">CommonModule</span></span><span class="koboSpan" id="kobo.1634.1">, </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1635.1">isPlatformBrowser</span></strong></span><span class="koboSpan" id="kobo.1636.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1637.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1638.1">'@angular/common'</span></span><span class="koboSpan" id="kobo.1639.1">;
...
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1640.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1641.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1642.1">UsersComponent</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1643.1">implements</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1644.1">OnInit</span></span><span class="koboSpan" id="kobo.1645.1"> {
 ...
  </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1646.1">platformId = </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1647.1">inject</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1648.1">(</span></strong><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.1649.1">PLATFORM_ID</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1650.1">);</span></strong></span><span class="koboSpan" id="kobo.1651.1">
  isSearching = </span><span class="hljs-literal"><span class="koboSpan" id="kobo.1652.1">true</span></span><span class="koboSpan" id="kobo.1653.1">;
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.1654.1">ngOnInit</span></span><span class="koboSpan" id="kobo.1655.1">() {
    </span><span class="hljs-variable"><span class="koboSpan" id="kobo.1656.1">this</span></span><span class="koboSpan" id="kobo.1657.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1658.1">componentAlive</span></span><span class="koboSpan" id="kobo.1659.1"> = </span><span class="hljs-literal"><span class="koboSpan" id="kobo.1660.1">true</span></span><span class="koboSpan" id="kobo.1661.1">;
   ...
    </span><span class="hljs-variable"><span class="koboSpan" id="kobo.1662.1">this</span></span><span class="koboSpan" id="kobo.1663.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1664.1">searchForm</span></span><span class="koboSpan" id="kobo.1665.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1666.1">controls</span></span><span class="koboSpan" id="kobo.1667.1">[</span><span class="hljs-string"><span class="koboSpan" id="kobo.1668.1">'username'</span></span><span class="koboSpan" id="kobo.1669.1">].</span><span class="hljs-property"><span class="koboSpan" id="kobo.1670.1">valueChanges</span></span><span class="koboSpan" id="kobo.1671.1">
      .</span><span class="hljs-title"><span class="koboSpan" id="kobo.1672.1">pipe</span></span><span class="koboSpan" id="kobo.1673.1">(
        </span><span class="hljs-title"><span class="koboSpan" id="kobo.1674.1">startWith</span></span><span class="koboSpan" id="kobo.1675.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1676.1">''</span></span><span class="koboSpan" id="kobo.1677.1">),
        </span><span class="hljs-title"><span class="koboSpan" id="kobo.1678.1">tap</span></span><span class="koboSpan" id="kobo.1679.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.1680.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1681.1"> {
          </span><span class="hljs-variable"><span class="koboSpan" id="kobo.1682.1">this</span></span><span class="koboSpan" id="kobo.1683.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1684.1">isSearching</span></span><span class="koboSpan" id="kobo.1685.1"> = </span><span class="hljs-literal"><span class="koboSpan" id="kobo.1686.1">true</span></span><span class="koboSpan" id="kobo.1687.1">;
        }),
        </span><span class="hljs-title"><span class="koboSpan" id="kobo.1688.1">takeWhile</span></span><span class="koboSpan" id="kobo.1689.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.1690.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1691.1"> !!</span><span class="hljs-variable"><span class="koboSpan" id="kobo.1692.1">this</span></span><span class="koboSpan" id="kobo.1693.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1694.1">componentAlive</span></span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1695.1"> &amp;&amp; </span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1696.1">isPlatformBrowser</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1697.1">(</span></strong><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.1698.1">this</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1699.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1700.1">platformId</span></strong></span><span class="koboSpan" id="kobo.1701.1">)),
        </span><span class="hljs-title"><span class="koboSpan" id="kobo.1702.1">mergeMap</span></span><span class="koboSpan" id="kobo.1703.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.1704.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1705.1">query</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1706.1">) =&gt;</span></span> <span class="hljs-variable"><span class="koboSpan" id="kobo.1707.1">this</span></span><span class="koboSpan" id="kobo.1708.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1709.1">userService</span></span><span class="koboSpan" id="kobo.1710.1">
          .</span><span class="hljs-title"><span class="koboSpan" id="kobo.1711.1">searchUsers</span></span><span class="koboSpan" id="kobo.1712.1">(query))
      )
      .</span><span class="hljs-title"><span class="koboSpan" id="kobo.1713.1">subscribe</span></span><span class="koboSpan" id="kobo.1714.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.1715.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1716.1">users</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1717.1">) =&gt;</span></span><span class="koboSpan" id="kobo.1718.1"> {
        </span><span class="hljs-variable"><span class="koboSpan" id="kobo.1719.1">this</span></span><span class="koboSpan" id="kobo.1720.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1721.1">users</span></span><span class="koboSpan" id="kobo.1722.1"> = users;
        </span><span class="hljs-variable"><span class="koboSpan" id="kobo.1723.1">this</span></span><span class="koboSpan" id="kobo.1724.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1725.1">isSearching</span></span><span class="koboSpan" id="kobo.1726.1"> = </span><span class="hljs-literal"><span class="koboSpan" id="kobo.1727.1">false</span></span><span class="koboSpan" id="kobo.1728.1">;
      });
  }
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1729.1">Now that we have the code</span><a id="_idIndexMarker1201"/><span class="koboSpan" id="kobo.1730.1"> written for the App</span><a id="_idIndexMarker1202"/><span class="koboSpan" id="kobo.1731.1"> Shell, let’s create it. </span><span class="koboSpan" id="kobo.1731.2">Run the following command from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1732.1">workspace root</span></code><span class="koboSpan" id="kobo.1733.1"> to generate the App Shell in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1734.1">production</span></code><span class="koboSpan" id="kobo.1735.1"> mode:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1736.1">cd start &amp;&amp; nx run ng-pwa-app-shell:app-shell:production
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1737.1">Once the App Shell is generated in </span><em class="italic"><span class="koboSpan" id="kobo.1738.1">step 5</span></em><span class="koboSpan" id="kobo.1739.1">, run the following command from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1740.1">workspace root</span></code><span class="koboSpan" id="kobo.1741.1"> (not from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1742.1">start</span></code><span class="koboSpan" id="kobo.1743.1"> folder) to serve it using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1744.1">http-server</span></code><span class="koboSpan" id="kobo.1745.1"> package:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1746.1">npx http-server ./start/dist/apps/chapter13/ng-pwa-app-shell/browser -o -p 4200
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1747.1">Make sure that JavaScript is still turned off for the app. </span><span class="koboSpan" id="kobo.1747.2">If not, open Chrome DevTools and press </span><em class="keystroke"><span class="koboSpan" id="kobo.1748.1">Cmd + Shift + P</span></em><span class="koboSpan" id="kobo.1749.1"> for Mac OS X to open the command panel (</span><em class="keystroke"><span class="koboSpan" id="kobo.1750.1">Ctrl + Shift + P</span></em><span class="koboSpan" id="kobo.1751.1"> on Windows). </span><span class="koboSpan" id="kobo.1751.2">Then type </span><code class="inlineCode"><span class="koboSpan" id="kobo.1752.1">Disable Javascript</span></code><span class="koboSpan" id="kobo.1753.1"> and hit </span><em class="keystroke"><span class="koboSpan" id="kobo.1754.1">Enter</span></em><span class="koboSpan" id="kobo.1755.1">, selecting the option as shown in </span><em class="italic"><span class="koboSpan" id="kobo.1756.1">Figure 13.31</span></em><span class="koboSpan" id="kobo.1757.1">:
    </span><figure class="mediaobject"><span class="koboSpan" id="kobo.1758.1"><img alt="Figure 13.27 – Disable JavaScript using Chrome DevTools " src="../Images/B18469_13_31.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1759.1">Figure 13.31: Disable JavaScript using Chrome DevTools</span></p></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="8"><span class="koboSpan" id="kobo.1760.1">Refresh the app while JavaScript is disabled. </span><span class="koboSpan" id="kobo.1760.2">You should now see the app still showing the pre-rendered users page with the skeleton loaders, despite JavaScript being disabled, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.1761.1">Figure 13.32</span></em><span class="koboSpan" id="kobo.1762.1">. </span><span class="koboSpan" id="kobo.1762.2">Woohoo!
    </span><figure class="mediaobject"><span class="koboSpan" id="kobo.1763.1"><img alt="" role="presentation" src="../Images/B18469_13_32.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1764.1">Figure 13.32: App Shell showing the pre-rendered Users page</span></p></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="9"><span class="koboSpan" id="kobo.1765.1">To verify that we are pre-rendering</span><a id="_idIndexMarker1203"/><span class="koboSpan" id="kobo.1766.1"> the </span><strong class="screenText"><span class="koboSpan" id="kobo.1767.1">Users</span></strong><span class="koboSpan" id="kobo.1768.1"> page at build</span><a id="_idIndexMarker1204"/><span class="koboSpan" id="kobo.1769.1"> time, inspect the generated code at </span><code class="inlineCode"><span class="koboSpan" id="kobo.1770.1">&lt;workspace-root&gt;/start/dist/apps/chapter13/ng-pwa-app-shell/browser/index.html</span></code><span class="koboSpan" id="kobo.1771.1">. </span><span class="koboSpan" id="kobo.1771.2">You should see the entire rendered page inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1772.1">&lt;body&gt;</span></code><span class="koboSpan" id="kobo.1773.1"> tag.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1774.1">Create the production build with the App Shell and serve it on port </span><code class="inlineCode"><span class="koboSpan" id="kobo.1775.1">1020</span></code><span class="koboSpan" id="kobo.1776.1"> by running the following commands:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1777.1">cd start &amp;&amp; nx run ng-pwa-app-shell:app-shell:production
cd ..
</span><span class="koboSpan" id="kobo.1777.2">npx http-server ./start/dist/apps/chapter13/ng-pwa-app-shell/browser -o -p 1020
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1778.1">Navigate to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1779.1">http://localhost:1020</span></code><span class="koboSpan" id="kobo.1780.1"> in your browser</span><a id="_idIndexMarker1205"/><span class="koboSpan" id="kobo.1781.1"> and install the app</span><a id="_idIndexMarker1206"/><span class="koboSpan" id="kobo.1782.1"> as a PWA, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.1783.1">Figure 13.8</span></em><span class="koboSpan" id="kobo.1784.1">. </span><span class="koboSpan" id="kobo.1784.2">Once done, run the PWA and it should look as follows:
    </span><figure class="mediaobject"><span class="koboSpan" id="kobo.1785.1"><img alt="" role="presentation" src="../Images/B18469_13_33.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1786.1">Figure 13.33: ng-pwa-app-shell running as a PWA</span></p></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.1787.1">Great! </span><span class="koboSpan" id="kobo.1787.2">You now know how to create an App Shell for your Angular PWAs. </span><span class="koboSpan" id="kobo.1787.3">Now that you’ve finished the recipe, see the next section on how it works.</span></p>
<h2 class="heading-2" id="_idParaDest-475"><span class="koboSpan" id="kobo.1788.1">How it works…</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1789.1">The recipe begins with disabling JavaScript for our application. </span><span class="koboSpan" id="kobo.1789.2">This means when the app runs, we only show static HTML and CSS since there’s no JavaScript execution. </span><span class="koboSpan" id="kobo.1789.3">We see a message about JavaScript not being supported, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.1790.1">Figure 13.30</span></em><span class="koboSpan" id="kobo.1791.1">. </span><span class="koboSpan" id="kobo.1791.2">The code comes from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1792.1">src/index.html</span></code><span class="koboSpan" id="kobo.1793.1"> file having the following code inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1794.1">&lt;body&gt;</span></code><span class="koboSpan" id="kobo.1795.1"> element:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag"><span class="koboSpan" id="kobo.1796.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1797.1">noscript</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1798.1">&gt;</span></span><span class="koboSpan" id="kobo.1799.1">Please enable JavaScript to continue using this application.</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1800.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1801.1">noscript</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1802.1">&gt;</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1803.1">We then run the command </span><code class="inlineCode"><span class="koboSpan" id="kobo.1804.1">nx g app-shell--project=ng-pwa-app-shell</span></code><span class="koboSpan" id="kobo.1805.1">. </span><span class="koboSpan" id="kobo.1805.2">Since we are in an NX workspace, the command requires the right project. </span><span class="koboSpan" id="kobo.1805.3">If this were a regular Angular project, you could just</span><a id="_idIndexMarker1207"/><span class="koboSpan" id="kobo.1806.1"> run </span><code class="inlineCode"><span class="koboSpan" id="kobo.1807.1">ng generate app-shell</span></code><span class="koboSpan" id="kobo.1808.1"> and it would create</span><a id="_idIndexMarker1208"/><span class="koboSpan" id="kobo.1809.1"> the App Shell for you. </span><span class="koboSpan" id="kobo.1809.2">In either case, the command does the following things for us:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.1810.1">Creates a new component named </span><code class="inlineCode"><span class="koboSpan" id="kobo.1811.1">AppShellComponent</span></code><span class="koboSpan" id="kobo.1812.1"> and generates its relevant files.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1813.1">Installs the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1814.1">@angular/platform-server</span></code><span class="koboSpan" id="kobo.1815.1"> package in the project.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1816.1">Adds some new files, namely, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1817.1">main.server.ts</span></code><span class="koboSpan" id="kobo.1818.1">, to enable server-side rendering (build-time rendering for our App Shell, to be exact).</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1819.1">Most importantly, it updates the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1820.1">project.json</span></code><span class="koboSpan" id="kobo.1821.1"> (</span><code class="inlineCode"><span class="koboSpan" id="kobo.1822.1">angular.json</span></code><span class="koboSpan" id="kobo.1823.1"> for an Angular project not in the NX workspace) file to add a bunch of schematics for server-side rendering as well as for generating the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1824.1">app-shell</span></code><span class="koboSpan" id="kobo.1825.1">. </span><span class="koboSpan" id="kobo.1825.2">Notice that it overrides the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1826.1">build</span></code><span class="koboSpan" id="kobo.1827.1"> object (specifically the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1828.1">outputPath</span></code><span class="koboSpan" id="kobo.1829.1">) property to remove the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1830.1">apps</span></code><span class="koboSpan" id="kobo.1831.1"> folder and chapter name. </span><span class="koboSpan" id="kobo.1831.2">We don’t want that as we want the bundle to be generated in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1832.1">dist/apps/chapter13/&lt;project-name&gt;</span></code><span class="koboSpan" id="kobo.1833.1">, and that is why we updated it manually in the recipe. </span><span class="koboSpan" id="kobo.1833.2">Notice that it also adds a new </span><code class="inlineCode"><span class="koboSpan" id="kobo.1834.1">"server"</span></code><span class="koboSpan" id="kobo.1835.1"> object for SSR and an </span><code class="inlineCode"><span class="koboSpan" id="kobo.1836.1">"app-shell"</span></code><span class="koboSpan" id="kobo.1837.1"> object with configuration to generate the App Shell.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.1838.1">In the recipe, we create the App Shell, and then we import the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1839.1">UsersComponent</span></code><span class="koboSpan" id="kobo.1840.1"> class to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1841.1">AppShellComponent</span></code><span class="koboSpan" id="kobo.1842.1"> class’s </span><code class="inlineCode"><span class="koboSpan" id="kobo.1843.1">imports</span></code><span class="koboSpan" id="kobo.1844.1"> array. </span><span class="koboSpan" id="kobo.1844.2">Since </span><code class="inlineCode"><span class="koboSpan" id="kobo.1845.1">AppShellComponent</span></code><span class="koboSpan" id="kobo.1846.1"> is a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1847.1">standalone</span></code><span class="koboSpan" id="kobo.1848.1"> component (not part of any </span><code class="inlineCode"><span class="koboSpan" id="kobo.1849.1">NgModule</span></code><span class="koboSpan" id="kobo.1850.1">), and so is </span><code class="inlineCode"><span class="koboSpan" id="kobo.1851.1">UsersComponent</span></code><span class="koboSpan" id="kobo.1852.1">, we need to link them together via the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1853.1">imports </span></code><span class="koboSpan" id="kobo.1854.1">array in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1855.1">AppShellComponent</span></code><span class="koboSpan" id="kobo.1856.1">. </span><span class="koboSpan" id="kobo.1856.2">After importing the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1857.1">UsersComponent</span></code><span class="koboSpan" id="kobo.1858.1"> class, we update the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1859.1">app-shell.component.html</span></code><span class="koboSpan" id="kobo.1860.1"> (the App Shell template) to use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1861.1">&lt;app-users&gt;</span></code><span class="koboSpan" id="kobo.1862.1"> selector, which reflects the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1863.1">UsersComponent</span></code><span class="koboSpan" id="kobo.1864.1"> class. </span><span class="koboSpan" id="kobo.1864.2">That is the entire </span><strong class="screenText"><span class="koboSpan" id="kobo.1865.1">Users</span></strong><span class="koboSpan" id="kobo.1866.1"> page. </span><span class="koboSpan" id="kobo.1866.2">Finally, we make sure that we only render the skeleton elements when the Browser is being created (and the same for SSR). </span><span class="koboSpan" id="kobo.1866.3">Therefore, we use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1867.1">PLATFORM_ID</span></code><span class="koboSpan" id="kobo.1868.1"> token in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1869.1">users.component.ts</span></code><span class="koboSpan" id="kobo.1870.1"> file. </span><span class="koboSpan" id="kobo.1870.2">The token’s value contains the name of the platform our application is running on. </span><span class="koboSpan" id="kobo.1870.3">When the app shell is being generated, it is the server-side environment, and the value of </span><code class="inlineCode"><span class="koboSpan" id="kobo.1871.1">PLATFORM_ID</span></code><span class="koboSpan" id="kobo.1872.1"> is </span><code class="inlineCode"><span class="koboSpan" id="kobo.1873.1">"server"</span></code><span class="koboSpan" id="kobo.1874.1">. </span><span class="koboSpan" id="kobo.1874.2">Instead of comparing it with the string </span><code class="inlineCode"><span class="koboSpan" id="kobo.1875.1">"server"</span></code><span class="koboSpan" id="kobo.1876.1">, i.e., using the condition </span><code class="inlineCode"><span class="koboSpan" id="kobo.1877.1">this.platformId !== "server")</span></code><span class="koboSpan" id="kobo.1878.1">, we use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1879.1">isPlatformBrowser</span></code><span class="koboSpan" id="kobo.1880.1"> function from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1881.1">@angular/common</span></code><span class="koboSpan" id="kobo.1882.1"> package to only fetch the data if the platform is </span><code class="inlineCode"><span class="koboSpan" id="kobo.1883.1">browser</span></code><span class="koboSpan" id="kobo.1884.1"> (which is not the case when generating the app shell).</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1885.1">We then verify the App Shell in </span><em class="italic"><span class="koboSpan" id="kobo.1886.1">step 4</span></em><span class="koboSpan" id="kobo.1887.1"> and </span><em class="italic"><span class="koboSpan" id="kobo.1888.1">step 5</span></em><span class="koboSpan" id="kobo.1889.1">. </span><span class="koboSpan" id="kobo.1889.2">These commands generate an Angular build in production mode with the App Shell (non-minified code), and then serve the project on port </span><code class="inlineCode"><span class="koboSpan" id="kobo.1890.1">4200</span></code><span class="koboSpan" id="kobo.1891.1">, respectively. </span><span class="koboSpan" id="kobo.1891.2">Note that the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1892.1">ng-pwa-app-shell</span></code><span class="koboSpan" id="kobo.1893.1"> folder in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1894.1">start/dist/apps/chapter13/ng-pwa-app-shell</span></code><span class="koboSpan" id="kobo.1895.1"> folder has two folders inside, that is, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1896.1">browser</span></code><span class="koboSpan" id="kobo.1897.1"> folder and the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1898.1">server</span></code><span class="koboSpan" id="kobo.1899.1"> folder, and our </span><code class="inlineCode"><span class="koboSpan" id="kobo.1900.1">index.html</span></code><span class="koboSpan" id="kobo.1901.1"> resides in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1902.1">browser</span></code><span class="koboSpan" id="kobo.1903.1"> folder. </span><span class="koboSpan" id="kobo.1903.2">The code inside </span><code class="inlineCode"><span class="koboSpan" id="kobo.1904.1">index.html</span></code><span class="koboSpan" id="kobo.1905.1"> is pre-rendered at build time. </span><span class="koboSpan" id="kobo.1905.2">This means Angular opens the app and renders the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1906.1">UsersComponent</span></code><span class="koboSpan" id="kobo.1907.1">, including the search input and skeleton loaders, at build time. </span><span class="koboSpan" id="kobo.1907.2">So, as soon as the app opens, the content</span><a id="_idIndexMarker1209"/><span class="koboSpan" id="kobo.1908.1"> is pre-rendered. </span><span class="koboSpan" id="kobo.1908.2">Once we’re done</span><a id="_idIndexMarker1210"/><span class="koboSpan" id="kobo.1909.1"> with all these steps, we install the PWA to test it out.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1910.1">Now that you know how the recipe works, see the next section</span><a id="_idIndexMarker1211"/><span class="koboSpan" id="kobo.1911.1"> for links to further reading.</span></p>
<h2 class="heading-2" id="_idParaDest-476"><span class="koboSpan" id="kobo.1912.1">See also</span></h2>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.1913.1">Angular App</span><a id="_idIndexMarker1212"/><span class="koboSpan" id="kobo.1914.1"> Shell guide: </span><a href="https://angular.io/guide/app-shell"><span class="url"><span class="koboSpan" id="kobo.1915.1">https://angular.io/guide/app-shell</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1916.1">The App Shell</span><a id="_idIndexMarker1213"/><span class="koboSpan" id="kobo.1917.1"> model (web fundamentals by Google): </span><a href="https://developers.google.com/web/fundamentals/architecture/app-shell"><span class="url"><span class="koboSpan" id="kobo.1918.1">https://developers.google.com/web/fundamentals/architecture/app-shell</span></span></a></li>
<li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.1919.1">Critical Rendering Path</span></strong><span class="koboSpan" id="kobo.1920.1"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.1921.1">CRP</span></strong><span class="koboSpan" id="kobo.1922.1">): </span><a href="https://developer.mozilla.org/en-US/docs/Web/Performance/Critical_rendering_path"><span class="url"><span class="koboSpan" id="kobo.1923.1">https://developer.mozilla.org/en-US/docs/Web/Performance/Critical_rendering_path</span></span></a></li>
</ul>
<h1 class="heading-1"><span class="koboSpan" id="kobo.1924.1">Learn more on Discord</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1925.1">To join the Discord community for this book – where you can share feedback, ask questions to the author, and learn about new releases – follow the QR code below:</span></p>
<p class="normal"><a href="Chapter_13.xhtml"><span class="url"><span class="koboSpan" id="kobo.1926.1">https://packt.link/AngularCookbook2e</span></span></a></p>
<p class="normal"><span class="koboSpan" id="kobo.1927.1"><img alt="" role="presentation" src="../Images/QR_Code1388317275422265.png"/></span></p>
</div>
</body></html>