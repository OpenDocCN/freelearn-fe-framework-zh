<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Customization and Further Development</h1>
                </header>
            
            <article>
                
<p>In the previous chapter, we saw how to use the JHipster Domain Language to model and generate our domain model. We also learned about entity relationships and the <kbd>import-jdl</kbd> sub-generator. In this chapter, we will see how we can further customize and add business logic to the generated application to suit our needs. We will learn about:</p>
<ul>
<li>Live reload with Spring DevTools and BrowserSync</li>
<li><span>Customizing the angular frontend for an entity</span></li>
<li><span>Editing an entity created using the</span><span> </span><span>JHipster entity generator</span></li>
<li><span>Changing the look and feel of the application using a Bootstrap theme</span></li>
<li><span>Adding a new i18n language using the</span><span> </span><span>JHipster language generator</span></li>
<li>Customizing the generated REST API to add additional role-based authorization with Spring Security</li>
<li>Creating new Spring Data JPA queries and methods</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Live reload for development</h1>
                </header>
            
            <article>
                
<p>When developing an application, one of the most annoying and time-consuming parts is recompiling the code and restarting the servers to see the code changes we have made. Traditionally, JavaScript code used to be easier, as it didn't need any compilation and you could just refresh the browser and see the changes. However, even though current MVVM stacks make the client side more important than before, they also introduce side effects, such as transpiling of client-side code, and more. So, if you are refactoring a field for an entity, you would traditionally need to do the following tasks to see the changes in <span>your</span> browser:</p>
<ol>
<li>Compile the server-side Java code.</li>
<li>Apply the table changes to the database.</li>
<li>Recompile the client-side code.</li>
<li>Restart the application server.</li>
<li>Refresh the browser.</li>
</ol>
<p>This takes a lot of time, is frustrating to do for every small change, and results in you making more changes before checking them, hence affecting productivity.</p>
<p>What if I told you that you don't have to do any of these, and all of this could happen automatically as you save your changes using your IDE? That would be awesome, wouldn't it?</p>
<p>With JHipster you get exactly that. JHipster uses Spring Boot DevTools, webpack dev server, and BrowserSync to enable a nice live reload feature for the end-to-end code.</p>
<p>Let's take a quick look at the technologies used.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Spring Boot DevTools</h1>
                </header>
            
            <article>
                
<p>Spring Boot DevTools (<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/using-boot-devtools.html">https://docs.spring.io/spring-boot/docs/current/reference/html/using-boot-devtools.html</a>) enables Spring Boot applications to reload the embedded server when there is a change in the classpath. It states the following—<span><em>The aim of this module is to try and improve the development-time experience when working on Spring Boot applications</em>,</span> and it does exactly that. It uses a custom classloader to restart the application when a class is updated and recompiled, and since the server is hot reloaded it is much faster than a cold restart. </p>
<p>It isn't as cool as JRebel or similar technologies, which do instant reload, but it beats doing it manually and doesn't require any extra configuration to enable it.</p>
<p>JHipster DevTools is automatically enabled in the <kbd>dev</kbd> profile, <span>using an IDE that can automatically recompile classes on saving. The DevTools will ensure the application is reloaded and up to date. Since Liquibase is used, any schema updates using proper changelogs will also get updated. Make sure not to change existing changelogs as it will cause a checksum error. Application reloads can also be triggered by simply using the commands </span><kbd>mvnw compile</kbd><span> or </span><kbd>gradlew compileJava</kbd> depending on the build tool used.</p>
<div class="packt_infobox">If you choose a NoSQL DB, such as MongoDB, Cassandra, or Couchbase, JHipster provides database migration tools for those as well.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Webpack dev server and BrowserSync</h1>
                </header>
            
            <article>
                
<p>Webpack dev server (<a href="https://github.com/webpack/webpack-dev-server">https://github.com/webpack/webpack-dev-server</a>) provides a simple Express server using webpack dev middleware, and supports live reloads when assets change. W<span>ebpack dev middleware supports features such as hot module replacement and in memory file access.</span></p>
<div class="packt_tip packt_infobox">In Webpack Version 4 and above a new alternative called <span class="packt_screen">webpack-serve</span> (<a href="https://github.com/webpack-contrib/webpack-serve">https://github.com/webpack-contrib/webpack-serve</a>) is used instead of Webpack dev server. It uses native WebSocket support in newer browsers.</div>
<p><span>BrowserSync (<a href="https://browsersync.io/">https://browsersync.io/</a>) is a Node.js tool that helps in browser testing by synchronizing file changes and interactions of the web page across multiple browsers and devices. It provides features such as </span>auto-reload<span> on file changes, synchronized UI interactions, scrolling, and so on. JHipster integrates BrowserSync with Webpack dev server to provide a productive development setup. It makes testing a web page on different browsers and devices super easy. Changes to CSS are loaded without a browser refresh.</span></p>
<p>To use live reload on the client side you need to run <kbd>yarn start</kbd>, which will start the development server and open up a browser pointing to <kbd>http://localhost:9000</kbd>. Notice the port <kbd>9000</kbd>. BrowserSync will be using this port, while the application backend will be served at <kbd>8080</kbd>, which all requests will be proxied through via webpack dev middleware.</p>
<div class="packt_tip">Open another browser, for example, Firefox if BrowserSync has opened Chrome already or vice versa. Now place them side by side and play around with the application. You will see your actions are replicated, thanks to BrowserSync. Try changing some code and save the file to see live reload in action.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Setting up live reload for an application</h1>
                </header>
            
            <article>
                
<p>Let's start the perfect development setup for the application we created. In a terminal, start the server in dev mode by running <kbd>./gradlew</kbd> and in another terminal, start the client side development server by running <kbd>yarn start</kbd>.</p>
<p>Now when you make any changes on the server side simply run <kbd>./gradlew compileJava</kbd> or if you are using an IDE click on the compile button.</p>
<div class="packt_tip">With IntelliJ IDEA, files are automatically saved and so you can set up <em>Ctrl</em> + <em>S</em> to compile the classes giving you a nice workflow. In Eclipse, saving a class automatically compiles it.</div>
<p>When you make changes on the client side, simply save the file and webpack dev server and BrowserSync will do the rest.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Customizing the Angular frontend for an entity</h1>
                </header>
            
            <article>
                
<p>Now that we have our entity domain model created and working, let's make it more usable. The Product listing screen has a table view generated by JHipster; it is sufficient for simple CRUD operations but isn't the best-suited user experience for end users who want to browse our product listing. Let's see how we can easily change to something more appealing. We will also add a nice client-side filter option to filter the listing. We will be using both Angular and Bootstrap features for this.</p>
<p>First, let's find the source code that we would need to edit. In your favorite editor/IDE navigate to <kbd>src/main/webapp/app/entities/product</kbd>:</p>
<div class="CDPAlignCenter CDPAlign"><span class="packt_screen"><img height="546" src="assets/bca08683-2256-4fd8-8465-f61b3530b443.png" width="320"/> </span></div>
<p>Let's start by customizing the <kbd>product.component.html</kbd> file to update the UI view of the product listing. The HTML code currently renders a table view and uses some Angular directives to enhance the view with sorting and pagination. Let's first change the view from a table into a list, but first open the development web server from BrowserSync, if it's not already open, by navigating to <kbd>http://localhost:9000</kbd>. Log in and navigate to <span class="packt_screen">Entities</span> | <span class="packt_screen">Product Category</span> and create a category, then navigate to <span><span class="packt_screen">Entities</span></span> | <span><span class="packt_screen">Product</span></span> and create few new products so that we have something to list:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/5cf97e13-399a-4bb3-8b1e-2a78d11690e2.png"/></div>
<p>We can use the Bootstrap List group (<a href="https://getbootstrap.com/docs/4.0/components/list-group/">https://getbootstrap.com/docs/4.0/components/list-group/</a>) component for this purpose. Let's use the following snippet and change the view. Replace the <kbd>div</kbd> with <kbd>class="table-responsive"</kbd> <span>with the following code:</span></p>
<pre>&lt;div <strong>*ngIf="products"</strong>&gt;<br/>    &lt;div class="<em>list-group</em>"&gt;<br/>        &lt;a <strong>[routerLink]="['../product', product.id ]"</strong> <br/>           class="<em>list-group-item list-group-item-action</em> flex-column <br/>           align-items-start"<br/>           <strong>*ngFor="let product of products; trackBy: trackId"</strong>&gt;<br/>            &lt;div class="d-flex w-100 justify-content-between"&gt;<br/>                &lt;h5 class="mb-1"&gt;<strong>{{product.name}}</strong>&lt;/h5&gt;<br/>                &lt;small *ngIf="product.productCategory"&gt;<br/>                    &lt;a <strong>[routerLink]="['../product-category', <br/>                     product.productCategory?.id ]"</strong> &gt;<br/>                        <strong>{{product.productCategory?.id}}</strong><br/>                    &lt;/a&gt;<br/>                &lt;/small&gt;<br/>            &lt;/div&gt;<br/>            &lt;small class="mb-1"&gt;<strong>{{product.description}}</strong>&lt;/small&gt;<br/>            &lt;p class="mb-1"&gt;Price:<strong> {{product.price}}</strong>&lt;/p&gt;<br/>            &lt;small&gt;<br/>                Size: <br/>                &lt;span jhiTranslate="{{'storeApp.Size.' + <br/>                 product.size}}"&gt;<br/>                    <strong>{{product.size}}</strong><br/>                &lt;/span&gt;<br/>            &lt;/small&gt;<br/>        &lt;/a&gt;<br/>    &lt;/div&gt;<br/>&lt;/div&gt;</pre>
<p class="mce-root">As you can see, we are iterating the products using the Angular directive <kbd>*ngFor="let product of products; trackBy: trackId"</kbd> on the anchor element so that the element is created for each product in the list. We wrap this in a <kbd>*ngIf="products"</kbd> directive so that the view is rendered only when the product's object is defined. The <kbd>[routerLink]="['../product', product.id ]"</kbd> directive will create a href for the anchor using the Angular router so that we can navigate to the particular product route.  We then use properties from the product in template strings to be rendered using <kbd>{{product.name}}</kbd> syntax. As you save the code, you might notice that the view refreshes automatically, thanks to BrowserSync.</p>
<div class="packt_infobox">The <kbd>trackBy</kbd> function used in <kbd>ngFor</kbd> lets Angular decide which items are added or removed from a collection. This improves rendering performance as Angular can now figure out which items need to be added or removed from DOM exactly, without having to recreate the entire collection. Here, we provide <kbd>trackId</kbd> as the function to uniquely identify an item in the collection.</div>
<p class="mce-root">This will produce the following:</p>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="assets/a312031d-0b47-4d3d-8350-488708564282.png"/></div>
<p>While it's a good start, it's not enough. So, let's go in and make it better. Let's add the image to the listing first. Modify the code to add Bootstrap rows and columns, as shown in the following code, the original code rendering the content is moved into the second column and remains unchanged:</p>
<pre>&lt;div *ngIf="products"&gt;<br/>    &lt;div class="list-group"&gt;<br/>        &lt;a [routerLink]="['../product', product.id ]" class="list-group-item list-group-item-action flex-column align-items-start"<br/>            *ngFor="let product of products; trackBy: trackId"&gt;<br/>            &lt;div <strong>class="row"</strong>&gt;<br/>                &lt;div <strong>class="col-2 col-xs-12 justify-content-center"</strong>&gt;<br/>                    &lt;img <strong>[src]="'data:' + product.imageContentType + <br/>                    ';base64,' + product.image"</strong> <br/>                        style="max-height:150px;" alt="product image"/&gt;<br/>                &lt;/div&gt;<br/>                &lt;div <strong>class="col col-xs-12"</strong>&gt;<br/>                    &lt;div class="d-flex w-100 justify-content-between"&gt;<br/>                        ...<br/>                    &lt;/div&gt;<br/>                    &lt;small class="mb-1"&gt;{{product.description}}&lt;/small&gt;<br/>                    &lt;p class="mb-1"&gt;Price: {{product.price}}&lt;/p&gt;<br/>                    &lt;small&gt;<br/>                        ...<br/>                    &lt;/small&gt;<br/>                &lt;/div&gt;<br/>            &lt;/div&gt;<br/>        &lt;/a&gt;<br/>    &lt;/div&gt;<br/>&lt;/div&gt;</pre>
<p>Take a look at the code highlighted in bold. We added a Bootstrap row (<a href="https://getbootstrap.com/docs/4.0/layout/grid/">https://getbootstrap.com/docs/4.0/layout/grid/</a>) with two column divs, the first div takes up two columns in a 12 column grid specified by <kbd>col-2</kbd>, while we also say that when the display is <strong>xs</strong> (<strong>extra small</strong>) the <kbd>div</kbd> tag should take 12-columns using <kbd>col-xs-12</kbd>. The second <kbd>div</kbd> is kept responsive by specifying just <kbd>col</kbd> so it takes the remaining available columns after the first <kbd>div</kbd>, and when the display is extra small it takes up 12 columns as well. The image inside the first column <kbd>div</kbd> uses a data URL as <kbd>src</kbd> to render the image. Now we have an even better view:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/e0a5d8d9-4d36-460c-8eb5-b73798c4cdd7.png"/></div>
<p>We can polish it further. We can use the Angular currency pipe (<a href="https://angular.io/api/common/CurrencyPipe">https://angular.io/api/common/CurrencyPipe</a>) for the price and remove the redundant label for it by changing to <kbd>{{product.price | currency:'USD'}}</kbd>.  We can add a label for the category shown on the right-hand side of the list as well.</p>
<p>Finally, we can add the <span class="packt_screen">Edit</span> and <span class="packt_screen">Delete</span> buttons back, but we need to show them only for users who have the role <kbd>ADMIN</kbd> so that normal users will only be able to view the product listing. We can copy the HTML code for <kbd>edit</kbd> and <kbd>delete</kbd> buttons from the original table. The final code will be as follows:</p>
<pre>&lt;div *ngIf="products"&gt;<br/>    &lt;div class="list-group"&gt;<br/>        &lt;a [routerLink]="['../product', product.id ]" <br/>            class="list-group-item list-group-item-action flex-column <br/>            align-items-start"<br/>            *ngFor="let product of products; trackBy: trackId"&gt;<br/>            &lt;div class="row"&gt;<br/>                &lt;div class="col-2 col-xs-12 justify-content-center"&gt;<br/>                    &lt;img [src]="'data:' + product.imageContentType + <br/>                     ';base64,' + product.image" <br/>                        style="max-height:150px;" alt="product image"/&gt;<br/>                &lt;/div&gt;<br/>                &lt;div class="col col-xs-12"&gt;<br/>                    &lt;div class="d-flex w-100 justify-content-between"&gt;<br/>                        &lt;h5 class="mb-1"&gt;{{product.name}}&lt;/h5&gt;<br/>                        &lt;small *ngIf="product.productCategory"&gt;<br/>                            &lt;a [routerLink]="['../product-category', <br/>                                    product.productCategory?.id ]" &gt;<br/>                                Category: {{product.productCategory?.id}}<br/>                            &lt;/a&gt;<br/>                        &lt;/small&gt;<br/>                    &lt;/div&gt;<br/>                    &lt;small class="mb-1"&gt;{{product.description}}&lt;/small&gt;<br/>                &lt;p class="mb-1"&gt;<strong>{{product.price | currency:'USD'}}</strong>&lt;/p&gt;<br/>                    &lt;small&gt;<br/>                        Size:<br/>                        &lt;span jhiTranslate="{{'storeApp.Size.' + <br/>                         product.size}}"&gt;<br/>                            {{product.size}}<br/>                        &lt;/span&gt;<br/>                    &lt;/small&gt;<br/>                    &lt;div <strong>*jhiHasAnyAuthority="'ROLE_ADMIN'"</strong>&gt;<br/>                        &lt;button type="submit"<br/>                                [routerLink]="['/', <br/>                                    { outlets: { popup: 'product/'+ <br/>                                    product.id + '/edit'} }]"<br/>                                replaceUrl="true"<br/>                                queryParamsHandling="merge"<br/>                                class="btn btn-primary btn-sm"&gt;<br/>                            &lt;span class="fa fa-pencil"&gt;&lt;/span&gt;<br/>                            &lt;span class="d-none d-md-inline"<br/>                                  jhiTranslate="entity.action.edit"&gt;Edit&lt;/span&gt;<br/>                        &lt;/button&gt;<br/>                        &lt;button type="submit"<br/>                                [routerLink]="['/', <br/>                                    { outlets: { popup: 'product/'+ <br/>                                     product.id + '/delete'} }]"<br/>                                replaceUrl="true"<br/>                                queryParamsHandling="merge"<br/>                                class="btn btn-danger btn-sm"&gt;<br/>                            &lt;span class="fa fa-remove"&gt;&lt;/span&gt;<br/>                            &lt;span class="d-none d-md-inline" <br/>                                  jhiTranslate="entity.action.delete"&gt;Delete&lt;/span&gt;<br/>                        &lt;/button&gt;<br/>                    &lt;/div&gt;<br/>                &lt;/div&gt;<br/>            &lt;/div&gt;<br/>        &lt;/a&gt;<br/>    &lt;/div&gt;<br/>&lt;/div&gt;</pre>
<p>The <kbd>*jhiHasAnyAuthority="'ROLE_ADMIN'"</kbd> directive is provided by JHipster and can be used to control presentation based on user roles. By default, JHipster provides <kbd>ROLE_ADMIN</kbd> and <kbd>ROLE_USER</kbd>, but controlling this only on the client side is not secure as it can be easily bypassed, so we should secure this on the server side as well. We will look at this later in the chapter. Log out and log in again using the user account to see the directive in action:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/917bd423-64fd-47df-85d5-6f899bb36ae3.png"/></div>
<p>Now, let's also add the <kbd>*jhiHasAnyAuthority="'ROLE_ADMIN'"</kbd> directive to the create button element.</p>
<p>Now that our view is much better, let's bring back the sorting functionality we originally had. Since we do not have table headers anymore we can use some buttons to sort based on certain fields that are important.</p>
<p>Let's use Bootstrap button group (<a href="https://getbootstrap.com/docs/4.0/components/button-group/">https://getbootstrap.com/docs/4.0/components/button-group/</a>) for this. Place the following snippet above the <kbd>&lt;div class="list-group"&gt;</kbd> element we created earlier:</p>
<pre>&lt;div class="<strong>mb-2 d-flex justify-content-end align-items-center</strong>"&gt;<br/>    &lt;span class="mx-2 col-1"&gt;Sort by&lt;/span&gt;<br/>    &lt;div <strong>class="btn-group"</strong> role="group"<br/>        <strong>jhiSort [(predicate)]="predicate" [(ascending)]="reverse"</strong><br/><strong>                [callback]="transition.bind(this)"</strong>&gt;<br/>        &lt;<strong>button type="button" class="btn btn-light"</strong> <strong>jhiSortBy="name"</strong>&gt;<br/>            &lt;span jhiTranslate="storeApp.product.name"&gt;Name&lt;/span&gt;<br/>            &lt;span class="fa fa-sort"&gt;&lt;/span&gt;<br/>        &lt;/button&gt;<br/>        &lt;button type="button" class="btn btn-light" jhiSortBy="price"&gt;<br/>            &lt;span jhiTranslate="storeApp.product.price"&gt;Price&lt;/span&gt;<br/>            &lt;span class="fa fa-sort"&gt;&lt;/span&gt;<br/>        &lt;/button&gt;<br/>        &lt;button type="button" class="btn btn-light" jhiSortBy="size"&gt;<br/>            &lt;span jhiTranslate="storeApp.product.size"&gt;Size&lt;/span&gt;<br/>            &lt;span class="fa fa-sort"&gt;&lt;/span&gt;<br/>        &lt;/button&gt;<br/>        &lt;button type="button" class="btn btn-light" <br/>         jhiSortBy="productCategory.id"&gt;<br/>            &lt;span  <br/>jhiTranslate="storeApp.product.productCategory"&gt;Product Category&lt;/span&gt;<br/>            &lt;span class="fa fa-sort"&gt;&lt;/span&gt;<br/>        &lt;/button&gt;<br/>    &lt;/div&gt;<br/>&lt;/div&gt;</pre>
<p>We can use Bootstrap margin and flexbox utility classes such as <kbd>mb-2 d-flex justify-content-end align-items-center</kbd> to position and align the item properly. We use the <kbd>btn-group</kbd> class on a div element to group our button elements together on which we have placed the <kbd>jhiSort</kbd> directive and its bound properties such as <kbd>predicate</kbd>, <kbd>ascending</kbd>, and <kbd>callback</kbd>. On the buttons themselves, we use the <kbd>jhiSortBy</kbd> directive to specify which field it would use to sort. Now our page looks as follows, where products are sorted by price:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/113a2cb2-3da0-485d-a5ac-21d3b37fc3f9.png"/></div>
<p><span>Finally, let's add some good old client-side filtering for the page.</span></p>
<div class="packt_infobox"><span>JHipster provides an option to enable server-side filtering using JPA metamodel. Another option is to enable Elasticsearch, for which JHipster will automatically create full-text search fields for every entity. So for any serious filtering requirements, you should use these. </span></div>
<p>First, let's add a new instance variable called <kbd>filter</kbd> of type string to the <kbd>ProductComponent</kbd> class in the <kbd>product.component.ts</kbd> file:</p>
<pre>export class ProductComponent implements OnInit, OnDestroy {<br/><br/>    ...<br/>    <strong>filter: string;</strong><br/><br/>    constructor(<br/>        ...<br/>    ) {<br/>    ...<br/>    }<br/>    ...<br/>}</pre>
<p>Now, let's use this variable in the <kbd>product.component.html</kbd> file. Add the highlighted snippet from the following code to the <kbd>div</kbd> we created for the sort-by buttons:</p>
<pre>&lt;div class="mb-2 d-flex justify-content-end align-items-center"&gt;<br/>    <strong>&lt;span class="mr-2 col-2"&gt;Filter by name&lt;/span&gt;</strong><br/><strong>    &lt;input type="search" class="form-control" [(ngModel)]="filter"&gt;</strong><br/>    &lt;span class="mx-2 col-1"&gt;Sort by&lt;/span&gt;<br/>    &lt;div class="btn-group" role="group"<br/>        ...<br/>    &lt;/div&gt;<br/>&lt;/div&gt;</pre>
<p>We bound the filter variable to an input element using the <kbd>ngModel</kbd> directive, and using <kbd>[()]</kbd> ensures two-way binding on the variable.</p>
<div class="packt_tip"><kbd>[(ngModel)]="filter"</kbd> creates a two-way binding, <kbd>[ngModel]="filter"</kbd> creates a one-way binding from model to view, and <kbd>(ngModel)="filter"</kbd> creates a one-way binding from view to model.</div>
<p>Finally, update the <kbd>ngFor</kbd> directive on our list-group-item element as follows. We use a pipe provided by JHipster to filter the list using the name field of the product:</p>
<pre>*ngFor="let product of <strong>(products | pureFilter:filter:'name')</strong>; trackBy: trackId"</pre>
<p>That's it, and we get a shiny filter option on our screen:</p>
<div class="mce-root CDPAlignCenter CDPAlign"><img src="assets/8753e58a-9256-42b6-a546-6a45f1a157b1.png"/></div>
<p>The UX is much better than before but for a real-world use case you could build a much better UI for the client-facing website, <span>with features to add items to a cart, pay for items online, and so on, </span>and leave this part for the back office use. Let's commit this to <kbd>git</kbd>: this is very important for managing changes to the project later. Run the following commands:</p>
<pre><strong>&gt; git add --all</strong><br/><strong>&gt; git commit -am "update product listing page UI"</strong></pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Editing an entity using the JHipster entity sub-generator</h1>
                </header>
            
            <article>
                
<p>While looking through the generated entity screens, we might realize that there are some minor issues that affect the user experience. For example, on the product screens we have a relationship to a product category but when choosing the product category from the drop-down menu during creation, or when showing the category in the list, we show the category by its ID, which is not user-friendly. It would be nice if we could show the product category name instead. This is the default JHipster behavior but it can be customized while defining the relationships. Let's see how we can make our generated screens more user-friendly by editing the JDL model. <span>This will overwrite existing files, but since we are using <kbd>git</kbd> we can easily cherry-pick the changes we made, we will see how this is done in a moment. </span></p>
<p>In our JDL, we defined relationships between entities using the following code:</p>
<pre>relationship OneToOne {<br/>    Customer{user} to User<br/>}<br/><br/>relationship ManyToOne {<br/>  OrderItem{product} to Product<br/>}<br/><br/>relationship OneToMany {<br/>   Customer{order} to ProductOrder{customer},<br/>   ProductOrder{orderItem} to OrderItem{order},<br/>   ProductOrder{invoice} to Invoice{order},<br/>   Invoice{shipment} to Shipment{invoice},<br/>   ProductCategory{product} to Product{productCategory}<br/>}</pre>
<p>By <span>specifying the field to use for displaying the relationship in JDL using the <kbd>(&lt;field name&gt;)</kbd> </span>syntax as follows, we can change how the client-side code displays relationships:</p>
<pre>relationship OneToOne {<br/>    Customer{user<strong>(login)</strong>} to User<br/>}<br/><br/>relationship ManyToOne {<br/>  OrderItem{product<strong>(name)</strong>} to Product<br/>}<br/><br/>relationship OneToMany {<br/>   Customer{order} to ProductOrder{customer<strong>(email)</strong>},<br/>   ProductOrder{orderItem} to OrderItem{order<strong>(code)</strong>},<br/>   ProductOrder{invoice} to Invoice{order<strong>(code)</strong>},<br/>   Invoice{shipment} to Shipment{invoice<strong>(code)</strong>},<br/>   ProductCategory{product} to Product{productCategory<strong>(name)</strong>}<br/>}</pre>
<p>Let's run this using the <kbd>import-jdl</kbd> command. T<span>he command only generates entities that underwent changes from the last run. But before we run let's also switch to a new branch, because it's a good practice to do major changes on a separate branch and merge them back so you have more control:</span></p>
<pre><strong>&gt; git checkout -b entity-update-display-name</strong><br/><strong>&gt; jhipster import-jdl online-store.jh</strong></pre>
<div class="packt_tip"><span>Read more about Git flow here: </span><a href="https://guides.github.com/introduction/flow/">https://guides.github.com/introduction/flow/</a><span>.</span></div>
<p>Accept the changes to the files and wait for the build to finish. Now, let's look at the entity pages to verify that the display names are used properly and create some entities to try it out. Now we realize that the <kbd>Invoice</kbd> entity has empty drop-down menus, and that is because the <kbd>Invoice</kbd> entity does not have a field called <strong>code</strong>. Since we use <kbd>{{invoice.order?.code}}</kbd> <span>in the template the symbol <kbd>?</kbd> makes Angular skip undefined values preventing errors in rendering.</span></p>
<p><span>This is easy to fix. </span><span>Sometimes we might want to make a small change to an entity after we have created it using JDL and the <kbd>import-jdl</kbd> command. The best way would be to make the change in JDL and regenerate it using the import JDL command as we saw in the previous code. Now there is also another option, the entity sub generator, which can yield the same result. For the sake of familiarizing yourself with this option, let's use that to add the field to our <kbd>Invoice</kbd> entity:</span></p>
<ol>
<li>Run the following command:</li>
</ol>
<pre style="padding-left: 60px"><strong>&gt; jhipster entity Invoice</strong> </pre>
<ol start="2">
<li>From the options select <span class="packt_screen">Yes, add more fields and relationships</span>: </li>
</ol>
<pre style="padding-left: 60px">Using JHipster version installed globally<br/>Executing jhipster:entity Invoice<br/>Options: <br/><br/>Found the .jhipster/Invoice.json configuration file, entity can be automatically generated!<br/><br/>The entity Invoice is being updated.<br/><br/>? Do you want to update the entity? This will replace the existing files for this entity, all your custom code will be overwritten <br/>  Yes, re generate the entity <br/>❯ <strong>Yes, add more fields and relationships</strong> <br/>  Yes, remove fields and relationships <br/>  No, exit </pre>
<ol start="3">
<li>Select <span class="packt_screen">Yes</span> for the next question and provide the field name, type, and validation in the questions that follow:</li>
</ol>
<pre style="padding-left: 60px">Generating field #7<br/><br/>? Do you want to add a field to your entity? <strong>Yes</strong><br/>? What is the name of your field? <strong>code</strong><br/>? What is the type of your field? <strong>String</strong><br/>? Do you want to add validation rules to your field? <strong>Yes</strong><br/>? Which validation rules do you want to add? <strong>Required</strong><br/><br/>================= Invoice =================<br/>Fields<br/>date (Instant) required<br/>details (String) <br/>status (InvoiceStatus) required<br/>paymentMethod (PaymentMethod) required<br/>paymentDate (Instant) required<br/>paymentAmount (BigDecimal) required<br/>code (String) required<br/><br/>Relationships<br/>shipment (Shipment) one-to-many <br/>order (ProductOrder) many-to-one <br/><br/><br/>Generating field #8<br/><br/>? Do you want to add a field to your entity? (Y/n) </pre>
<ol start="4">
<li>Select <span class="packt_screen">n</span> for the prompts that follow to add more fields and relationships. Accept the proposed file changes and that's it, we are done.</li>
<li class="mce-root">Now just make sure to update the JDL so that the entity <kbd>Invoice</kbd> has <kbd>code String required</kbd> <span>as a field.</span></li>
</ol>
<div class="mce-root packt_tip"><span>You could also run <kbd>jhipster export-jdl online-store.jh</kbd> to export the current model back to the JDL.</span></div>
<p>Now that we have displayed entity relationships properly, we also need to make sure certain entities have relationship values mandatory. For example, for customers it should be mandatory to have a user, <kbd>ProductOrder</kbd> should have a customer, order item should have an order, Invoice should have an order, and finally, the shipment should have an invoice. Since JHipster supports making relationships required, we can make these changes using JDL. Update the relationships to the following snippet in <kbd>online-store.jh</kbd>:</p>
<pre>relationship OneToOne {<br/>    Customer{user(login) <strong>required</strong>} to User<br/>}<br/><br/>relationship ManyToOne {<br/>    OrderItem{product(name) <strong>required</strong>} to Product<br/>}<br/><br/>relationship OneToMany {<br/>   Customer{order} to ProductOrder{customer(email) <strong>required</strong>},<br/>   ProductOrder{orderItem} to OrderItem{order(code) <strong>required</strong>},<br/>   ProductOrder{invoice} to Invoice{order(code) <strong>required</strong>},<br/>   Invoice{shipment} to Shipment{invoice(code) <strong>required</strong>},<br/>   ProductCategory{product} to Product{productCategory(name)}<br/>}</pre>
<p>Now, run <span><kbd>jhipster import-jdl online-store.jh</kbd> and accept the proposed updates. Make sure to check what has changed using the <kbd>git diff</kbd> command or your Git UI tool.</span></p>
<p>Let's commit this step so that it can be rolled back if required:</p>
<pre><strong>&gt; git add --all</strong><br/><strong>&gt; git commit -am "entity relationships display names and required update"</strong></pre>
<p>Now we have a problem, regenerating the entities overwrote all the files and that means we lost all the changes we made for the product listing page, but since we use <kbd>git</kbd> it's easy to get it back. So far, our project has only a few commits, so it will be easy to cherry-pick the commit we made for the product listing UI change and apply it back on top of the current codebase. However, in real-world scenarios, there could be a lot of changes before you can regenerate the JDL, and so it will require some effort to verify and merge the required changes back. Always rely on pull requests so that you can see what has changed and others can review and find any issues.</p>
<p>Let's cherry-pick the changes that we need.</p>
<div class="packt_infobox">Refer to the documentation for cherry-picking advanced options at: <a href="https://git-scm.com/docs/git-cherry-pick">https://git-scm.com/docs/git-cherry-pick</a>.</div>
<p>Since the commit we need is the last one on the master we can simply use <span><kbd>git cherry-pick master</kbd>. We could also switch to the master and use the <kbd>git log</kbd> command to list the commits, then copy the commit hash of the required commit and use that with <kbd>git cherry-pick &lt;commit-sha&gt;</kbd></span>. </p>
<p>Now, this results in merge conflicts, as the <kbd>product.component.html</kbd> file was updated in the commit we picked on our current branch tip. We need the incoming change from the commit but also need to update the product category display name from ID to code, so let's accept the incoming change and make a manual update from <span><kbd>{{product.productCategory?.id}}</kbd> to </span><span><kbd><span>{{product.productCategory?.name}}</span></kbd></span>.</p>
<p class="mce-root">Resolve the conflict by staging the file and commit. Now we can merge the branch into the master:</p>
<pre><strong>&gt; git add src/main/webapp/app/entities/product/product.component.html</strong><br/><strong>&gt; git commit -am "cherrypick: update product listing page UI"</strong><br/><strong>&gt; git checkout master</strong><br/><strong>&gt; git merge --no-ff entity-update-display-name</strong></pre>
<div class="packt_tip"><span>If you are new to Git, it is advisable to use a UI tool such as SourceTree or GitKraken to cherry-pick and resolve merge conflicts. IDEs such as IntelliJ and editors such as VSCode, also provide good options for these.</span></div>
<p>Now our page view should be good:</p>
<div class="CDPAlignCenter CDPAlign"><img height="218" src="assets/d0c78f86-2f00-4628-8a7a-2ac64f32fb98.png" width="526"/></div>
<p>Of course, we could also make it more user-friendly by making the product listing our home page. But for now, let's skip that.</p>
<p>Since we were working on the client-side code we didn't pay attention to the server-side code that was changed during this. We need to compile the Java code to reload our server. Let's run <kbd>./gradlew compileJava</kbd>.</p>
<p>Unfortunately, we receive an error during the reload regarding a failure to update the database changelogs by Liquibase due to a checksum error:</p>
<pre><strong>liquibase.AsyncSpringLiquibase : Liquibase could not start correctly, your database is NOT ready: Validation Failed:</strong><br/><strong>     5 change sets check sum</strong><br/><strong>          config/liquibase/changelog/20180114123500_added_entity_Customer.xml::20180114123500-1::jhipster was: 7:3e0637bae010a31ecb3416d07e41b621 but is now: 7:01f8e1965f0f48d255f613e7fb977628</strong><br/><strong>          config/liquibase/changelog/20180114123501_added_entity_ProductOrder.xml::20180114123501-1::jhipster was: 7:0ff4ce77d65d6ab36f27b229b28e0cda but is now: 7:e5093e300c347aacf09284b817dc31f1</strong><br/><strong>          config/liquibase/changelog/20180114123502_added_entity_OrderItem.xml::20180114123502-1::jhipster was: 7:2b3d9492d127add80003e2f7723903bf but is now: 7:4beb407d4411d250da2cc2f1d84dc025</strong><br/><strong>          config/liquibase/changelog/20180114123503_added_entity_Invoice.xml::20180114123503-1::jhipster was: 7:5afaca031815e037cad23f0a0f5515d6 but is now: 7:fadec7bfabcd82dfc1ed22c0ba6c6406</strong><br/><strong>          config/liquibase/changelog/20180114123504_added_entity_Shipment.xml::20180114123504-1::jhipster was: 7:74d9167f5da06d3dc072954b1487e11d but is now: 7:0b1b20dd4e3a38f7410b6b3c81e224fd</strong></pre>
<p>This is due to the changes made to the original changelog by JHipster. In an ideal world, new schema changes should be done in new changelogs so that Liquibase can apply them, but JHipster doesn't generate this by default yet. For local development using an H2 DB we can run <kbd>./gradlew clean</kbd> to clear the DB and start the application again, but in real use cases you might be using an actual DB, and you would want to retain the data, so we would have to handle this manually here using the diff features provided by Liquibase.</p>
<p>JHipster provides an integration for Liquibase in both Gradle and Maven builds. You can make use of it to create new changelogs and to create diff changelogs. In cases like these, when we would like to resolve conflicts while retaining data, the Liquibase diff feature is our friend. With Gradle, you could run the <kbd>./gradlew liquibaseDiffChangeLog</kbd> command to create a diff changelog of your changesets and the database. You can add this changeset to the <kbd>src/main/resources/config/liquibase/master.xml</kbd> file and it will get applied the next time you restart your server. By default, the command is configured to run against your development database, if you would like to do this against your production database just update the liquibaseCommand command definition in the <kbd>gradle/liquibase.gradle</kbd> file with the details of the production DB. Refer to <a href="http://www.jhipster.tech/development/#using-a-database">http://www.jhipster.tech/development/#using-a-database</a> for more.</p>
<div class="packt_tip">If you want to clear checksums in your DB, use the <kbd>./gradlew liquibaseClearChecksums</kbd> task.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Changing the look and feel of the application</h1>
                </header>
            
            <article>
                
<p>The good thing about using Bootstrap is that it lets us easily change the look and feel of the application using any available Bootstrap themes. Let's see how we can install a cool theme for our application, then we will also fine tune the styles to fit our needs using Sass variables provided by Bootstrap.</p>
<p>There are hundreds of Bootstrap themes out there. Since we are using Bootstrap 4 it is important to pick a theme that is made for Bootstrap 4.</p>
<div class="packt_infobox">Bootswatch is a nice collection of themes for Bootstrap; check it out to see all the available themes at: <a href="https://bootswatch.com/">https://bootswatch.com/</a>.</div>
<p>Let's use a Bootswatch theme called <strong>materia</strong>.</p>
<p>In your terminal, run <kbd>yarn add bootswatch</kbd> to install all the themes. Don't worry; we will only import the theme that we want to use so you do not have to worry about installing all themes.</p>
<p>Now let's import this using Sass. Open <kbd>src/main/webapp/content/scss/vendor.scss</kbd> and find the line <kbd>@import 'node_modules/bootstrap/scss/bootstrap';</kbd> and add the following code highlighted in bold:</p>
<pre>// Override Boostrap variables<br/>@import "bootstrap-variables";<br/><strong>@import 'node_modules/bootswatch/dist/materia/variables';<br/></strong>// Import Bootstrap source files from node_modules<br/>@import 'node_modules/bootstrap/scss/bootstrap';<br/><strong>@import "node_modules/bootswatch/dist/materia/bootswatch";</strong></pre>
<p>The name of the theme here is materia, you can use any theme available in Bootswatch here. Make sure that name is in all lowercase. Also, notice the order of imports. It is important that we import the theme variables after importing Bootstrap variables and themes after importing the Bootstrap theme so that SASS variables and styles are overridden properly.</p>
<p>We can customize the theme further by overriding Bootstrap variables defined in<span> </span><kbd>src/main/webapp/content/scss/_bootstrap-variables.scss</kbd>.</p>
<p>You can override any variable supported by Bootstrap. The full list of supported variables can be found in<span> </span><kbd>node_modules/bootstrap/scss/_variables.scss</kbd>.</p>
<p>For example, let's change some colors as follows, in <kbd>_bootstrap-variables.scss</kbd>:</p>
<pre>$primary: #032b4e;<br/>$success: #1df54f;<br/>$info: #17a2b8;<br/>$warning: #ffc107;<br/>$danger: #fa1a30;</pre>
<p>There might be some UI glitches when you apply a new theme, you could solve them by updating the generated SASS files.</p>
<p>For example, add the following CSS to <kbd>src/main/webapp/content/scss/global.scss</kbd> to fix the glitch in checkboxes that we got after the theme change:</p>
<pre>.form-check-input {<br/>    height: 18px;<br/>    width: 18px;<br/>}</pre>
<p>We now have a cool new theme:</p>
<div class="CDPAlignCenter CDPAlign"><img src="assets/0982f799-068a-476d-aced-59efc6d5dd2f.png"/></div>
<p>Further reference can be found at: <a href="https://getbootstrap.com/docs/4.0/getting-started/theming/">https://getbootstrap.com/docs/4.0/getting-started/theming/.</a></p>
<p>Let's commit this:</p>
<pre><strong>&gt; git add --all</strong><br/><strong>&gt; git commit -am "update bootstrap theme using bootswatch"</strong></pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Adding a new i18n language</h1>
                </header>
            
            <article>
                
<p>Since we enabled i18n support for our application we can add new i18n languages easily, at any time, using the JHipster language generator. Let's add a new language to our application.</p>
<p>In the terminal, switch to a new branch and run the following command:</p>
<pre><strong>&gt; git checkout -b add-french-language</strong><br/><strong>&gt; jhipster languages</strong></pre>
<p><span>You will now see a prompt like this, where you can choose any available language listed:</span></p>
<pre><strong>Using JHipster version installed locally in current project's node_modules</strong><br/><strong>Executing jhipster:languages</strong><br/><strong>Options:</strong><br/><br/><strong>Languages configuration is starting</strong><br/><strong>? Please choose additional languages to install (Press &lt;space&gt; to select, &lt;a&gt; to toggle all, &lt;i&gt; to inverse selection)<br/></strong><strong>&gt;</strong><strong>◯ Arabic (Libya)</strong><br/><strong> ◯ Armenian</strong><br/><strong> ◯ Catalan</strong><br/><strong> ◯ Chinese (Simplified)</strong><br/><strong> ◯ Chinese (Traditional)</strong><br/><strong> ◯ Czech</strong><br/><strong> ◯ Danish</strong><br/><strong>(Move up and down to reveal more choices)</strong></pre>
<p>Let's select French here for now. Accept the file changes proposed and we are good to go. Once the application automatically refreshes you can see the new language in the language drop-down menu in the application menu. Now, wasn't that easy!</p>
<p>Now there is a problem, since we have some entities and we added a new language. We will need to get i18n French files for entities as well. We can do this easily by running the <kbd>jhipster --with-entities</kbd> command, which will regenerate the application along with entities. Now make sure to carefully stage only changes that you need (i18n related JSON files) from the diff and discard the remaining changes. The following are the files and folders that need to be staged:</p>
<pre>.yo-rc.json<br/><br/>src/main/resources/i18n/messages_fr.properties<br/><br/>src/main/webapp/app/shared/language/find-language-from-key.pipe.ts<br/><br/>src/main/webapp/app/shared/language/language.constants.ts<br/><br/>webpack/webpack.common.js<br/><br/>src/main/webapp/i18n/fr</pre>
<p>Now, let's commit this and merge it back to the master. If we have picked only i18n related changes we shouldn't have any merge conflicts:</p>
<pre><strong>&gt; git add --all</strong><br/><strong>&gt; git commit -am "add French as additional language"</strong><br/><strong>&gt; git merge --no-ff add-french-language</strong></pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Authorization with Spring Security</h1>
                </header>
            
            <article>
                
<p>As you may have noticed, when it comes to generated code, JHipster doesn't provide much in terms of role-based security, authorization management, and so on. This is intentional, as these heavily depend on the use case and most often associated with the business logic of the application. So, it would be better if this was hand-coded by the developers as part of the business code.</p>
<p>Normal users have <kbd>ROLE_USER</kbd> and admin users have <kbd>ROLE_ADMIN</kbd> assigned in user management. <span>For our use </span>case<span> there are few security holes that we need to take care of: </span></p>
<ul>
<li>Normal users should only have access to view the product listing, product order, order item, invoice, and shipment </li>
<li>Normal users should not have access to create/edit/delete entities via the CRUD API</li>
<li>Normal users should not be able to access the <span>product order, order item, invoice, and shipment of other users</span></li>
</ul>
<p>We could overcome these issues using features provided by Spring Security.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Limiting access to entities</h1>
                </header>
            
            <article>
                
<p class="mce-root">First, let's limit the access for normal users. This can be done easily at the API level using Spring Security. Add the following snippet to the configure method of <kbd>src/main/java/com/mycompany/store/config/SecurityConfiguration.java</kbd>.</p>
<p>Add it right before the line <kbd>.antMatchers("/api/**").authenticated()</kbd>. The position is very important:</p>
<pre>.antMatchers("/api/customers").hasAuthority(AuthoritiesConstants.ADMIN)<br/>.antMatchers("/api/product-categories").hasAuthority(AuthoritiesConstants.ADMIN)</pre>
<p>We specify that when the request path matches <kbd>api/customers</kbd> or <kbd>api/product-categories</kbd> the user should have <kbd>ROLE_ADMIN</kbd> to access them. Now sign out and log in as <kbd>user</kbd> and try to access the customer entity page. Look at the console in your browser's development tools and you should see a <kbd>403 Forbidden</kbd> error for calls made to <kbd>GET http://localhost:9000/api/customers</kbd>.</p>
<p>Now that our backend handles this properly let's hide these entries in the menu for normal users. Let's add a <kbd>*jhiHasAnyAuthority="'ROLE_ADMIN'"</kbd> directive to the elements for customer and product category in <kbd>src/main/webapp/app/layouts/navbar/navbar.component.html</kbd>.</p>
<p>Now only admin users will see these items on the menu.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Limiting access to create/edit/delete entities</h1>
                </header>
            
            <article>
                
<p>Now we need to ensure that only admin users can edit entities, normal users should only be able to view entities authorized to them. For this, it would be better to handle it at the API level using the Spring Security <span><kbd>PreAuthorize</kbd> </span>annotation. Let's start with the order item. Go to <kbd>src/main/java/com/mycompany/store/web/rest/OrderItemResource.java</kbd> and add <kbd>@PreAuthorize("hasAuthority('ROLE_ADMIN')")</kbd> to methods <kbd>createOrderItem</kbd>, <kbd>updateOrderItem</kbd>, and <kbd>deleteOrderItem</kbd>:</p>
<pre>    @DeleteMapping("/order-items/{id}")<br/>    @Timed<br/>    <strong>@PreAuthorize("hasAuthority('ROLE_ADMIN')")</strong><br/>    public ResponseEntity&lt;Void&gt; deleteOrderItem(@PathVariable Long id) {<br/>        ...<br/>    }</pre>
<p>We are asking Spring Security interceptors to provide access to these methods only when the user has <kbd>ROLE_ADMIN</kbd>.<strong> </strong>The <kbd>PreAuthorize</kbd> annotation stops access before executing the method. Spring Security also provides <kbd>PostAuthorize</kbd> and more general <kbd>Secured</kbd> annotations. More about these can be found in the Spring Security documentation at: <a href="https://projects.spring.io/spring-security/">https://projects.spring.io/spring-security/</a>.</p>
<p>Compile the backend using <kbd>./gradlew compileJava</kbd> or using the IDE. Now go to the order items page and try to create an order item. You will get an <kbd>POST http://localhost:9000/api/order-items 403 (Forbidden)</kbd> error from the API call on the web console. Now let's add the annotation to all the entity Resource class create, update, and delete methods. You could skip customer and product category entities as they are entirely forbidden to the <kbd>ROLE_USER</kbd> already.</p>
<p>Let's also hide the create, edit, and delete buttons from the Angular views using the <span><kbd>*jhiHasAnyAuthority="'ROLE_ADMIN'"</kbd> directive.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Limiting access to data of other users</h1>
                </header>
            
            <article>
                
<p>Now, this is a little more tricky, as this requires us to change code at the service layer on the backend, but it is not hard. Let's get right to it.</p>
<p>Let's start with the product order entity. Let's modify the <kbd>findAll</kbd> method in <kbd>src/main/java/com/mycompany/store/service/ProductOrderService.java</kbd> as follows:</p>
<pre>    @Transactional(readOnly = true)<br/>    public Page&lt;ProductOrder&gt; findAll(Pageable pageable) {<br/>        log.debug("Request to get all ProductOrders");<br/><strong>        if (SecurityUtils.isCurrentUserInRole(AuthoritiesConstants.ADMIN)) {</strong><br/><strong>            return productOrderRepository.findAll(pageable);</strong><br/><strong>        } else</strong><br/><strong>            return productOrderRepository.findAllByCustomerUserLogin(</strong><br/><strong>                SecurityUtils.getCurrentUserLogin().get(),</strong><br/><strong>                pageable</strong><br/><strong>            );</strong><br/>    }</pre>
<p>As you can see, we modified the original call to <kbd>productOrderRepository.findAll(pageable)</kbd> so that we call it only when the current user has the <kbd>Admin</kbd> role, else we call <kbd>findAllByCustomerUserLogin</kbd>, but our generated <kbd>ProductOrderRepository</kbd> interface does not have this method yet so let's add that. In <kbd>src/main/java/com/mycompany/store/repository/ProductOrderRepository.java</kbd> let's add a new method as follows. Currently, the interface doesn't have any methods and only uses methods inherited from <kbd>JpaRepository</kbd>:</p>
<pre>Page&lt;ProductOrder&gt; findAllByCustomerUserLogin(String login, Pageable pageable);</pre>
<p>There is a lot of magic going on here. This is a Spring Data interface and hence, we can simply write a new method and expect Spring Data to create an implementation for this automatically; we just need to follow the naming conventions. In our use case, we need to find all product orders where the user relationship for the customer has the same login as our current logged in user. In SQL, this would be as follows:</p>
<pre>select * from product_order po cross join customer c cross join jhi_user u where po.customer_id=c.id and c.user_id=u.id and u.login=:login</pre>
<p>In simple terms, we could say <em>find all product orders where</em> <kbd>customer.user.login</kbd> <em>equals</em> <kbd>login</kbd> and that is exactly what we have written as the <kbd>findAllByCustomerUserLogin</kbd> method. The entity under operation is implicit, hence the product order is omitted. By providing the Pageable parameter we tell Spring Data to provide us a page from the paginated list of entities. You can refer to the Spring Data docs (<a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/">https://docs.spring.io/spring-data/jpa/docs/current/reference/html/</a>) for more information.</p>
<p>While calling the <kbd>productOrderRepository.findAllByCustomerUserLogin</kbd> method we can pass the current user login using the <kbd>SecurityUtils.getCurrentUserLogin()</kbd> method. The SecurityUtils class is generated by JHipster as well, as it has useful methods such as <kbd>getCurrentUserLogin</kbd>, <kbd>getCurrentUserJWT</kbd>, <kbd>isAuthenticated</kbd>, and <kbd>isCurrentUserInRole</kbd>.</p>
<p>That is it. Now log in as admin and create two new users, create two customers, and create product orders for each of them. Then log out and log in again as the default user and see if you can see the product order for the newly created user.</p>
<p>Now let's make similar updates for other services. The repository methods for those would be as follows:<br/>
For <kbd>src/main/java/com/mycompany/store/repository/InvoiceRepository</kbd>:</p>
<pre>Page&lt;Invoice&gt; findAllByOrderCustomerUserLogin(String login, Pageable pageable);</pre>
<p>For <kbd>src/main/java/com/mycompany/store/repository/OrderItemRepository</kbd>:</p>
<pre>Page&lt;OrderItem&gt; findAllByOrderCustomerUserLogin(String login, Pageable pageable);</pre>
<p>For <kbd>src/main/java/com/mycompany/store/repository/ShipmentRepository</kbd>:</p>
<pre>Page&lt;Shipment&gt; findAllByInvoiceOrderCustomerUserLogin(String login, Pageable pageable);</pre>
<p>Now we need to make similar changes for <kbd>findOne</kbd> methods on the services.</p>
<p>For the <kbd>ProductOrderService</kbd> it would be as follows:</p>
<pre>    @Transactional(readOnly = true)<br/>    public ProductOrder findOne(Long id) {<br/>        log.debug("Request to get ProductOrder : {}", id);<br/>        <strong>if (SecurityUtils.isCurrentUserInRole(AuthoritiesConstants.ADMIN)) {</strong><br/><strong>            return productOrderRepository.findOne(id);</strong><br/><strong>        } else</strong><br/><strong>            return productOrderRepository.findOneByIdAndCustomerUserLogin(</strong><br/><strong>                id,</strong><br/><strong>                SecurityUtils.getCurrentUserLogin().get()</strong><br/><strong>            );</strong><br/>    }</pre>
<p>As you can see, we changed the methods to find one by ID and customer user login. The repository method for the same would be as follows:</p>
<pre>ProductOrder <strong>findOneByIdAndCustomerUserLogin</strong>(Long id, String login);</pre>
<p><span>For </span><kbd>src/main/java/com/mycompany/store/repository/InvoiceRepository</kbd>:</p>
<pre><span>Invoice </span><span>findOneByIdAndOrderCustomerUserLogin</span>(<span>Long </span><span>id</span>, <span>String </span><span>login</span>);</pre>
<p><span>For</span> <kbd>src/main/java/com/mycompany/store/repository/OrderItemRepository</kbd>:</p>
<pre><span>OrderItem </span><span>findOneByIdAndOrderCustomerUserLogin</span>(<span>Long </span><span>id</span>, <span>String </span><span>login</span>);</pre>
<p><span>For </span><kbd>src/main/java/com/mycompany/store/repository/ShipmentRepository</kbd>:</p>
<pre><span>Shipment </span><span>findOneByIdAndInvoiceOrderCustomerUserLogin</span>(<span>Long </span><span>id</span>, <span>String </span><span>login</span>);</pre>
<p>The same queries can be written using the <kbd>@Query</kbd> annotation provided by Spring Data as well.</p>
<p>That's it. We have implemented a good role-based authorization logic for the application.</p>
<p>Let's commit this checkpoint:</p>
<pre><strong>&gt; git add --all</strong><br/><strong>&gt; git commit -am "update role based authorization logic"</strong></pre>
<p>In a real-world scenario, the changes we have made so far are not enough for an e-commerce website. But since our aim is to learn JHipster and its supported tools rather than to create a feature perfect application, consider this a minimum viable product. To make this e-commerce application usable, we would need to build more features, such as a shopping cart, invoice generation, customer registration, and so on. Why don't you take it up as an assignment and see if you can build more features for this application? This would be part of the next steps to take once you finish the book. The use case and instructions will be detailed in <a href="7a7b29a3-0ff7-4d86-be16-2c4b88d3a16a.xhtml">Chapter 14</a>, <em>Best Practices with JHipster</em>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>In this chapter, we saw how we can easily customize a web application created using JHipster. We also learned about Angular and Bootstrap when we customized our Product listing page. <span>In addition to this, we saw</span> how to secure our application with role-based authorization using Spring Security. We also learned about Spring Data and used Git to manage our source code properly. We saw our application evolving with business logic and becoming more user-friendly. In the next chapter, we will see how we can integrate continuous integration with our application using Jenkins.</p>


            </article>

            
        </section>
    </body></html>