<html><head></head><body><div class="chapter" title="Chapter&#xA0;4.&#xA0;Composite Dynamic Components and Forms"><div class="titlepage"><div><div><h1 class="title"><a id="ch04"/>Chapter 4. Composite Dynamic Components and Forms</h1></div></div></div><p>In the previous chapter, we saw the various life cycle methods of a React component, how the data flows between React components, and how to manage state and props in our React application.</p><p>In this chapter, we will focus on multiple dynamic components and building forms using React.</p><p>We will cover following points:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Multiple dynamic components with interactivity</li><li class="listitem" style="list-style-type: disc">Controlled and uncontrolled components</li><li class="listitem" style="list-style-type: disc">Form elements</li><li class="listitem" style="list-style-type: disc">Form events and handlers</li></ul></div><p>At the end of this chapter, we will be able to create applications containing complex forms using React with an understanding of the dynamic components.</p><p>Mike and Shawn are getting ready for their next project. The application is a prototype for an online bookstore where people can buy different books. Shawn is excited to work with Mike again and learn more about React. This project is based on React too.</p><div class="section" title="Forms in React"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec40"/>Forms in React</h1></div></div></div><p>"Shawn, in this <a id="id94" class="indexterm"/>project there will be many things related to placing an order, taking user's shipping and billing <a id="id95" class="indexterm"/>information, and so on. We are going to deal with a lot of forms now." started Mike.</p><p>"Forms using React, right?" Shawn asked excitedly.</p><p>"Yes. That is why today we will only focus on forms. Let's go through the intrinsic details of using forms using React." said Mike.</p></div></div>
<div class="section" title="Setting up the application"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec41"/>Setting up the application</h1></div></div></div><p>"Shawn, we were using JSBin up to this point. But now we will create the app locally. We will use the following directory structure for our code:"</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ tree -L 1</strong></span>
<span class="strong"><strong>.</strong></span>
<span class="strong"><strong>├── LICENSE</strong></span>
<span class="strong"><strong>├── README.md</strong></span>
<span class="strong"><strong>├── index.html</strong></span>
<span class="strong"><strong>├── node_modules</strong></span>
<span class="strong"><strong>├── package.json</strong></span>
<span class="strong"><strong>├── server.js</strong></span>
<span class="strong"><strong>├── src</strong></span>
<span class="strong"><strong>└── webpack.config.js</strong></span>

<span class="strong"><strong>2 directories, 6 files</strong></span>
</pre></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The <code class="literal">src</code> directory will contain all of the React components</li><li class="listitem" style="list-style-type: disc">The <code class="literal">webpack.config.js</code> and <code class="literal">server.js</code> file will be used for setting up local development server using webpack.</li><li class="listitem" style="list-style-type: disc">The <code class="literal">package.json</code> file will be used to contain information about all of the npm packages used by us</li><li class="listitem" style="list-style-type: disc">The <code class="literal">index.html</code> file will be the starting point of the app</li></ul></div><p>"Let's see our <code class="literal">index.html</code> file."</p><div class="informalexample"><pre class="programlisting">// index.html
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Forms in React&lt;/title&gt;
    &lt;link rel="stylesheet"  href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" /&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div id='root' class="container"&gt;
    &lt;/div&gt;
  &lt;/body&gt;
  &lt;script src="/static/bundle.js"&gt;&lt;/script&gt;
&lt;/html&gt;</pre></div><p>"We are using bootstrap CSS to beautify our app. Other than this, we are including the bundled JavaScript as <code class="literal">static/bundle.js</code>. Webpack will bundle the JavaScript code from our app and place it in <code class="literal">static/bundle.js</code>."</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note05"/>Note</h3><p>Webpack is a module bundler that takes our JavaScript code and generates static assets representing these modules. It also has other features such as hot module replacement, which we will be using in this book. We will be covering webpack and it's configuration in more depth in <a class="link" href="ch11.html" title="Chapter 11. React Tools">Chapter 11</a>, <span class="emphasis"><em>React Tools</em></span>.</p></div></div><p>"Let's see our <code class="literal">index.js</code> <a id="id96" class="indexterm"/>file, which will be the entry point of the JavaScript code."</p><div class="informalexample"><pre class="programlisting">// src/index.js

import ReactDOM from 'react-dom';
import BookStore from './BookStore';

ReactDOM.render(&lt;BookStore /&gt;, document.getElementById('root'));</pre></div><p>"It will render our <code class="literal">BookStore</code> component in the root container present in <code class="literal">index.html</code>. Now, the only thing left to do is actually writing the code for our <code class="literal">BookStore</code> component. Let's get started."</p><p>"Mike, in JSBin, our ES6 code was getting converted to normal JavaScript automatically. How will it be converted now?" asked Shawn.</p><p>"Excellent question. I forgot to mention about using Babel. Babel is a JavaScript transpiler that will convert our ES6 and JSX code to normal JavaScript. I have already configured this app to use Babel. You can check <code class="literal">package.json</code> and <code class="literal">webpack.config.js</code> to see how we configured Babel to convert the ES6 code to ES5 code. But let's not worry too much about it for now. We will come back to it and see how the whole setup works later."</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note06"/>Note</h3><p>We will be covering how we have used Babel and Webpack in <a class="link" href="ch11.html" title="Chapter 11. React Tools">Chapter 11</a>, <span class="emphasis"><em>React Tools</em></span>. Right now, the reader is expected to not worry about it and directly set up the application using the instructions given in source code of this chapter. You can also check <a class="link" href="ch11.html" title="Chapter 11. React Tools">Chapter 11</a>, <span class="emphasis"><em>React Tools</em></span> for more details before completing this chapter.</p></div></div></div>
<div class="section" title="Getting started with forms"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec42"/>Getting started with forms</h1></div></div></div><p>"Forms behave slightly <a id="id97" class="indexterm"/>differently in the React world than in the normal HTML world. They are a bit special than the other DOM components in the React world. The <code class="literal">&lt;input&gt;</code>, <code class="literal">&lt;textarea&gt;</code>, and <code class="literal">&lt;option&gt;</code> tags are some of the common input components provided by React." explained Mike.</p><p>"These form components are mutated when the user interacts with them, adds some text in the input, or selects an option. Therefore, we need to take care that we are managing those user interactions properly." Mike explained further.</p><p>"Let's start with a simple <a id="id98" class="indexterm"/>input tag to understand the user interaction." informed Mike.</p><div class="informalexample"><pre class="programlisting">// src/index.js

import React from 'react';
import ReactDOM from 'react-dom';

var InputExample = React.createClass({
  render() {
    return (
      &lt;input type="text" value="Shawn" /&gt;
    );
  }
});
ReactDOM.render(&lt;InputExample /&gt;,  
                 document.getElementById('root'));</pre></div><p>"Mike, what is the meaning of import here?" asked Shawn.</p><p>"Good catch. This is one of the ES6 features that we are going to use in this project. It is used to import functions defined in other modules or external scripts."</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note07"/>Note</h3><p>More information <a id="id99" class="indexterm"/>on import can be found at <a class="ulink" href="https://developer.mozilla.org/en/docs/web/javascript/reference/statements/import">https://developer.mozilla.org/en/docs/web/javascript/reference/statements/import</a>.</p></div></div><p>"We are also using a new way of defining functions in ES6."</p><div class="informalexample"><pre class="programlisting">// Old way of defining function
render: function() {
  return (
    &lt;input type="text" value="Shwn" /&gt;
  );
}

// New way of defining function
render() {
    return (
      &lt;input type="text" value="Shawn" /&gt;
    );
  }</pre></div><p>"Using this new syntax, we don't have to write word <code class="literal">function</code> every time we define the function."</p><p>"Shawn, start our app by running <code class="literal">npm start</code>."</p><div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>$ npm start</strong></span>

<span class="strong"><strong>&gt; reactjs-by-example-react-forms@0.0.1 start /Users/prathamesh/Projects/sources/reactjs-by-example/chapter4</strong></span>
<span class="strong"><strong>&gt; node server.js</strong></span>

<span class="strong"><strong>Listening at localhost:9000</strong></span>
<span class="strong"><strong>Hash: 8ec0d12965567260413b</strong></span>
<span class="strong"><strong>Version: webpack 1.9.11</strong></span>
<span class="strong"><strong>Time: 1639ms</strong></span>
</pre></div><p>"Awesome, it works because <a id="id100" class="indexterm"/>we have configured the <code class="literal">package.json</code> scripts section for starting the app."</p><div class="informalexample"><pre class="programlisting">  // package.json
  ……
  "scripts": {
    "start": "node server.js",
    "lint": "eslint src"
  },
……</pre></div><p>"Let's get back to our input box. We see a normal HTML text input with a predefined value, <code class="literal">Shawn</code>. All good." said Mike.</p><div class="mediaobject"><img src="graphics/4730_04_01.jpg" alt="Getting started with forms"/></div><p>"Mike, I can't edit it. Seems <a id="id101" class="indexterm"/>like the field is read-only. Also, I am seeing a warning in the console." informed Shawn.</p><div class="mediaobject"><img src="graphics/4730_04_02.jpg" alt="Getting started with forms"/></div></div>
<div class="section" title="Interactive props"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec43"/>Interactive props</h1></div></div></div><p>"Right. It also says that <a id="id102" class="indexterm"/>value is a prop. Similar to value, there are some other props supported by the input fields." said Mike.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">value</li><li class="listitem" style="list-style-type: disc">defaultValue</li><li class="listitem" style="list-style-type: disc">onChange</li></ul></div><p>"As React has warned us that we need to either provide the <code class="literal">defaultValue</code> or <code class="literal">onChange</code> prop to make this field mutable, let's take care of this and add a <code class="literal">onChange</code> handler. The field is read-only because by setting the value <code class="literal">prop</code>, we have rendered a controlled component." explained Mike.</p></div>
<div class="section" title="Controlled components"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec44"/>Controlled components</h1></div></div></div><p>"What is a <a id="id103" class="indexterm"/>controlled component, Mike?" asked Shawn.</p><p>"It's an input component whose value is controlled by React. By providing the value prop, we are informing React that the value of this field is "Shawn". Once React has declared it to be "Shawn", any user input won't have an effect as the value is already set in the ." explained Mike.</p><p>"I think that we have to resort to <code class="literal">state</code> instead of <code class="literal">props</code>?" Shawn asked.</p><p>"Exactly. As an user is interacting with the input field, we need to update the value <code class="literal">prop</code> using <code class="literal">state</code> and <code class="literal">onChange</code> event handler. Can you give it a try?" suggested Mike.</p><div class="informalexample"><pre class="programlisting">// src/index.js

var InputExample = React.createClass({
  getInitialState() {
    return (
      { name: '-'}
    );
  },

  handleChange(event) {
    this.setState({ name: event.target.value });
  },

  render() {
    return (
      &lt;input type="text"
             value={this.state.name}
             onChange={this.handleChange} /&gt;
    );
  }
});</pre></div><p>"Awesome. This pattern of making the value of an input based on state and updating the state based on the user interaction makes it very easy to respond to user interactions. We can also do some housekeeping things such as validating the input." Mike explained further.</p><p>"For example, you can change the case of all the text to uppercase." Mike added.</p><div class="informalexample"><pre class="programlisting">handleChange: function(event) {
  this.setState({name: event.target.value.toUpperCase()});
}</pre></div></div>
<div class="section" title="Uncontrolled components"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec45"/>Uncontrolled components</h1></div></div></div><p>"React also has <a id="id104" class="indexterm"/>uncontrolled components where the <code class="literal">value</code> prop is not passed to the input".</p><div class="informalexample"><pre class="programlisting">render() {
    return (
      &lt;input type="text" /&gt;
    );
  }</pre></div><p>"In this case, the value entered by the user will be immediately reflected in the input. For setting some default initial value, we can pass the default <code class="literal">value</code> prop, which will act as the initial value for an uncontrolled component."</p><div class="informalexample"><pre class="programlisting">render() {
    return (
      &lt;input type="text" defaultValue="Shawn"/&gt;
    );
  }</pre></div><p>"Awesome. This does it."</p></div>
<div class="section" title="Getting started with form wizard"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec46"/>Getting started with form wizard</h1></div></div></div><p>"Shawn, our task <a id="id105" class="indexterm"/>today is to build a form wizard, modeling all the steps that the user will take while using the online bookstore."</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">We will start with a form, where the user selects the book that they want to buy</li><li class="listitem" style="list-style-type: disc">In the next step, the user will enter the information related to the billing and shipping address</li><li class="listitem" style="list-style-type: disc">After this, the user needs to choose a delivery mechanism</li><li class="listitem" style="list-style-type: disc">In the end, the user will confirm the transaction and place the order</li></ul></div><p>"Will we design four different forms then?" asked Shawn.</p><p>"Yes. But all of them will be controlled by a single parent. The parent component will keep a track of the state that the user is in and will render a form for this step." explained Mike.</p><div class="informalexample"><pre class="programlisting">// src/BookStore.js

import React from 'react';

var BookStore = React.createClass({
  render() {
    switch (step) {
      case 1:
        return &lt;BookList /&gt;;
      case 2:
        return &lt;ShippingDetails /&gt;;
      case 3:
        return &lt;DeliveryDetails /&gt;;
    }
  }
});</pre></div><p>"How will we control the step?" asked Shawn.</p><p>"We will discuss this point later. Let's fill in some details before that. Let's add the placeholders for all <a id="id106" class="indexterm"/>of our forms." said Mike.</p><div class="informalexample"><pre class="programlisting">// src/BookStore.js


var BookList = React.createClass({
  render() {
    return(
      &lt;h1&gt; 
        Choose from wide variety of books available in our store.
      &lt;/h1&gt;
    );
  }
});

var ShippingDetails = React.createClass({
  render() {
    return(
      &lt;h1&gt;Enter your shipping information.&lt;/h1&gt;
    );
  }
});

var DeliveryDetails = React.createClass({
  render() {
    return (
      &lt;h1&gt;Choose your delivery options here.&lt;/h1&gt;
    );
  }
});</pre></div><p>"Great. Now, let's make sure that we always start from the first step." explained Mike.</p><div class="informalexample"><pre class="programlisting">// src/BookStore.js

……

var BookStore = React.createClass({
  getInitialState() {
    return ({ currentStep: 1 });
  },

  render() {
    switch (this.state.currentStep) {
      case 1:
        return &lt;BookList /&gt;;
      case 2:
        return &lt;ShippingDetails /&gt;;
      case 3:
        return &lt;DeliveryDetails /&gt;;
    }
  }
……

});</pre></div><p>"Now that we have made sure that the user will always be on the first step at the start, let's go ahead and <a id="id107" class="indexterm"/>finish the book store." said Mike.</p><div class="informalexample"><pre class="programlisting">// src/BookStore.js

var BookList = React.createClass({
  getInitialState() {
    return (
      { books: [
        { name: 'Zero to One', author: 'Peter Thiel' },
        { name: 'Monk who sold his Ferrari', author: 'Robin Sharma' },
        { name: 'Wings of Fire', author: 'A.P.J. Abdul Kalam' }
      ] }
    )
  },

  _renderBook(book) {
    return(
      &lt;div className="checkbox"&gt;
        &lt;label&gt;
          &lt;input type="checkbox" /&gt; {book.name} -- {book.author}
        &lt;/label&gt;
      &lt;/div&gt;
    );
  },

  render() {
    return(
      &lt;div&gt;
        &lt;h3&gt; Choose from wide variety of books available in our store &lt;/h3&gt;
        &lt;form&gt;
          {this.state.books.map((book) =&gt; { 
             return this._renderBook(book); })
          }

          &lt;input type="submit" className="btn btn-success" /&gt;
        &lt;/form&gt;
      &lt;/div&gt;
    );
  }
});</pre></div><p>"This is our static form. It doesn't do anything on user interaction. The next step will be to make it respond to the events." Mike added.</p><p>"Cool, I am interested in how we move to the next step." said Shawn.</p><p>"We will reach there <a id="id108" class="indexterm"/>soon. Let's finish other things first." informed Mike.</p><p>"OK. Before that, what's happening here?"</p><div class="informalexample"><pre class="programlisting">this.state.books.map((book) =&gt; { return (this._renderBook(book)) })</pre></div><p>"This is called as a <a id="id109" class="indexterm"/>
<span class="strong"><strong>fat arrow syntax</strong></span> to define functions. It is another ES6 feature. It's a shorthand for writing functions."</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note08"/>Note</h3><p>More details about fat <a id="id110" class="indexterm"/>arrow functions can be found at <a class="ulink" href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Functions/Arrow_functions">https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Functions/Arrow_functions</a>.</p></div></div></div>
<div class="section" title="Form events"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec47"/>Form events</h1></div></div></div><p>"Let's handle <a id="id111" class="indexterm"/>submitting the form now. React provides the <code class="literal">onSubmit</code> event for this purpose." said Mike.</p><div class="informalexample"><pre class="programlisting">// src/BookStore.js
……
// Updating BookStore component

render() {
    return(
      &lt;div&gt;
        &lt;h3&gt; Choose from wide variety of books available in our store &lt;/h3&gt;
        &lt;form onSubmit={this.handleSubmit}&gt;
          {this.state.books.map((book) =&gt; { return (this._renderBook(book)) })}

          &lt;input type="submit" className="btn btn-success" /&gt;
        &lt;/form&gt;
      &lt;/div&gt;
    );
  },

handleSubmit(event) {
    console.log(event);
    event.preventDefault();
    console.log("Form submitted");
   }
   ……</pre></div><p>"Now, the next task <a id="id112" class="indexterm"/>is to get hold of all the books selected by the user. We can use <code class="literal">state</code> to achieve this." explained Mike.</p><div class="informalexample"><pre class="programlisting">// src/BookStore.js
……

// Updating BookStore component

getInitialState() {
    return (
      { books: [
        { id: 1, name: 'Zero to One', author: 'Peter Thiel' },
        { id: 2, name: 'Monk who sold his Fearrary', author: 'Robin Sharma' },
        { id: 3, name: 'Wings of Fire', author: 'A.P.J. Abdul Kalam' }
      ],
        selectedBooks: []
      }
    );
  },

_renderBook(book) {
    return (
      &lt;div className="checkbox" key={book.id}&gt;
        &lt;label&gt;
          &lt;input type="checkbox" value={book.name}
                 onChange={this.handleSelectedBooks}/&gt;
          {book.name} -- {book.author}
        &lt;/label&gt;
      &lt;/div&gt;
    );
  },

  handleSelectedBooks(event) {
    var selectedBooks = this.state.selectedBooks;
    var index = selectedBooks.indexOf(event.target.value);

    if (event.target.checked) {
      if (index === -1)
        selectedBooks.push(event.target.value);
    } else {
      selectedBooks.splice(index, 1);
    }

    this.setState({selectedBooks: selectedBooks });
}</pre></div><p>"We added an <code class="literal">onChange</code> handler for the checkboxes. We also provided the <code class="literal">value</code> prop to the checkboxes which will be name of the book. Initially, the <code class="literal">selectedBooks</code> state will be an empty array set through the <code class="literal">getInitialState</code> function. The <code class="literal">handleSelectedBooks</code> method will check whether the checkbox is checked or not. We are using the checked prop provided by React for checkbox inputs. Similar to value, it also gets updated <a id="id113" class="indexterm"/>with user interaction.</p><p>At the end, we are updating the state with the new value of <code class="literal">selectedBooks</code>. Therefore, at any point of time, we will have hold of selected books in <code class="literal">this.state.selectedBooks</code>." explained Mike.</p><p>"Perfect!" said Shawn.</p></div>
<div class="section" title="Parent Child relationship"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec48"/>Parent Child relationship</h1></div></div></div><p>"Now after this, the <a id="id114" class="indexterm"/>next step is communicating with the parent component. Currently, there is no way that our child component can communicate with props. We want to communicate with the parent component as we want to send the selected books by the user to the parent component. The easiest way for a child to communicate with the parent is via props." Mike explained.</p><p>"But props are generally the attributes or properties that are sent to a child, right? How can a child communicate with the parent using them?" Shawn asked.</p><p>"Remember the <code class="literal">{}</code> syntax. We can pass any valid expression as prop. We can pass a function callback as prop to a child component. A child can call it to update the state of the parent. Let's <a id="id115" class="indexterm"/>update our <code class="literal">BookStore</code> component now." Mike explained.</p><div class="informalexample"><pre class="programlisting">// src/BookStore.js

……
// Updating BookStore component

  updateFormData(formData) {
    console.log(formData);
  },
  
  render() {
    switch (this.state.currentStep) {
      case 1:
        return &lt;BookList 
                 updateFormData={this.updateFormData} /&gt;;
      case 2:
        return &lt;ShippingDetails  
                 updateFormData={this.updateFormData} /&gt;;
      case 3:
        return &lt;DeliveryDetails 
                 updateFormData={this.updateFormData} /&gt;;
    }
  }
……

});</pre></div><p>"We pass the <code class="literal">updateFormData</code> function as a prop to all the child components. This function will take care of updating the form data. We will also need to update <code class="literal">BookList</code> in order to use it."</p><div class="informalexample"><pre class="programlisting">// src/BookStore.js
// Updating BookList component

……
  handleSubmit(event) {
    event.preventDefault();

    this.props.updateFormData({ selectedBooks: 
                                this.state.selectedBooks });
  }
  ……
}); </pre></div><p>"The <code class="literal">BookList</code> component now calls the <code class="literal">updateFormData</code> function and passes the currently selected books to it, whenever a user submits the first form," explained Mike.</p><p>"Therefore, every form will send its data to the parent component and we will use the complete data for final submission, right?" Shawn asked.</p><p>"Exactly. We will <a id="id116" class="indexterm"/>need a way to store the incoming data in the parent component though."</p><div class="informalexample"><pre class="programlisting">// src/BookStore.js
// Updating BookStore component

var BookStore = React.createClass({
  getInitialState() {
    return ({ currentStep: 1, formValues: {} });
  },

  updateFormData(formData) {
    var formValues = Object.assign({}, this.state.formValues, formData);
    this.setState({formValues: formValues});  
  },

  render() {
    switch (this.state.currentStep) {
      case 1:
        return &lt;BookList updateFormData={this.updateFormData} /&gt;;
      case 2:
        return &lt;ShippingDetails updateFormData={this.updateFormData} /&gt;;
      case 3:
        return &lt;DeliveryDetails updateFormData={this.updateFormData} /&gt;;
    }
  }
});</pre></div><p>"We added state to store <code class="literal">formValues</code>. Whenever the user submits the form, the child form will call the parent's <code class="literal">updateFormData</code> function. This function will merge the current data stored in the parent's <code class="literal">formValues</code> with incoming <code class="literal">formData</code> and reset the state to the new <code class="literal">formValues</code>. In this case, we will get <code class="literal">selectedBooks</code> in the <code class="literal">formValues</code> object, as follows:" said Mike.</p><div class="informalexample"><pre class="programlisting"> { selectedBooks: ['Zero to One', 'Monk who sold his Ferrary'] }</pre></div><p>"Note that, we are making use of another ES6 method—<code class="literal">Object.assign</code>. The <code class="literal">Object.assign()</code> method is used to copy the values of all the enumerable properties from one or more source objects to a target object."</p><p>"In our case, the use of <code class="literal">Object.assign</code> will merge the current state of form values with the new form values that are changed after some user interaction. We will then use this updated data to update the state of the component. We are using <code class="literal">Object.assign</code> instead of directly mutating the state of the component. We will cover why this is better than directly mutating the state of the component in the following chapters."</p><div class="informalexample"><pre class="programlisting">var formValues = Object.assign({}, this.state.formValues, formData);</pre></div><p>"Makes sense. This <a id="id117" class="indexterm"/>takes care of updating the form data. Now, how will we go to the next step?" Shawn asked.</p><p>"That's simple. Whenever we update the form data, we also need to update the <code class="literal">currentStep</code> method of the <code class="literal">BookStore</code> component. Can you give it a try?" Mike asked.</p><div class="informalexample"><pre class="programlisting">// src/BookStore.js
// Updating BookStore component

var BookStore = React.createClass({
  updateFormData(formData) {
    var formValues = Object.assign({}, this.state.formValues, formData);
    var nextStep = this.state.currentStep + 1;
    this.setState({currentStep: nextStep, formValues: formValues});
    console.log(formData);
  },

  render() {
    switch (this.state.currentStep) {
      case 1:
        return &lt;BookList updateFormData={this.updateFormData} /&gt;;
      case 2:
        return &lt;ShippingDetails updateFormData={this.updateFormData} /&gt;;
      case 3:
        return &lt;DeliveryDetails updateFormData={this.updateFormData} /&gt;;
    }
  }
});</pre></div><p>"Perfect. You have updated the step by <code class="literal">1</code> in the <code class="literal">updateFormData</code> callback. This will take the user to the <a id="id118" class="indexterm"/>next step." Mike.</p></div>
<div class="section" title="Form validation"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec49"/>Form validation</h1></div></div></div><p>"Shawn, I think <a id="id119" class="indexterm"/>we should also add basic validation to the <code class="literal">BookList</code> component so that the user can't go to the next step without selecting a book," said Mike.</p><p>"Agree. Let me give it a try." answered Shawn.</p><div class="informalexample"><pre class="programlisting">// src/BookStore.js
// Updating BookList component

var BookList = React.createClass({
  getInitialState() {
    return (
      { books: [
        { id: 1, name: 'Zero to One', author: 'Peter Thiel' },
        { id: 2, name: 'Monk who sold his Fearrary', author: 'Robin Sharma' },
        { id: 3, name: 'Wings of Fire', author: 'A.P.J. Abdul Kalam' }
      ],
        selectedBooks: [],
        error: false
      }
    );
  },

  _renderError() {
    if (this.state.error) {
      return (
        &lt;div className="alert alert-danger"&gt;
          {this.state.error}
        &lt;/div&gt;
      );
    }
  },

  handleSubmit(event) {
    event.preventDefault();

    if(this.state.selectedBooks.length === 0) {
      this.setState({error: 'Please choose at least one book to continue'});
    } else {
      this.setState({error: false});
      this.props.updateFormData({ selectedBooks: this.state.selectedBooks });
    }
  },

  render() {
    var errorMessage = this._renderError();

    return (
      &lt;div&gt;
        &lt;h3&gt; Choose from wide variety of books available in our store &lt;/h3&gt;
        {errorMessage}
        &lt;form onSubmit={this.handleSubmit}&gt;
          { this.state.books.map((book) =&gt; { return (this._renderBook(book)); })}
          &lt;input type="submit" className="btn btn-success" /&gt;
        &lt;/form&gt;
      &lt;/div&gt;
    );
  }
});</pre></div><p>"I added the state to manage the validation error. Initially, it will be set to <code class="literal">false</code>. After the user submits the form, we will check whether the user has not selected anything and set an appropriate error message. State will be updated and it will display the error message accordingly. If the user has selected at least one book, then the error state will be set to <code class="literal">false</code> and the error message won't <a id="id120" class="indexterm"/>be displayed. We get a nice error message with some help from the Bootstrap classes." said Shawn.</p><div class="mediaobject"><img src="graphics/4730_04_03.jpg" alt="Form validation"/></div><p>"Awesome. Let's move to the second form now. We want to accept the user's shipping details such as the <a id="id121" class="indexterm"/>address and contact information." said Mike.</p></div>
<div class="section" title="Shipping details step"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec50"/>Shipping details step</h1></div></div></div><p>"Shawn, in this step, we want to get the user's shipping preferences. It will contain the shipping address and <a id="id122" class="indexterm"/>name of the customer." explained Mike.</p><p>"We should also add a phone number." Shawn added.</p><p>"Sure thing. Here is how our shipping details form look like." informed Mike.</p><div class="informalexample"><pre class="programlisting">// src/BookStore.js
// Adding ShippingDetails component

var ShippingDetails = React.createClass({
  getInitialState() {
    return (
      { fullName: '', contactNumber: '', shippingAddress: '', error: false }
    );
  },

  _renderError() {
    if (this.state.error) {
      return (
        &lt;div className="alert alert-danger"&gt;
          {this.state.error}
        &lt;/div&gt;
      );
    }
  },

  _validateInput() {
    if (this.state.fullName === '') {
      this.setState({error: "Please enter full name"});
    } else if (this.state.contactNumber === '') {
      this.setState({error: "Please enter contact number"});
    } else if (this.state.shippingAddress === '') {
      this.setState({error: "Please enter shipping address"});
    } else {
      this.setState({error: false});
      return true;
    }

  },

  handleSubmit(event) {
    event.preventDefault();

    var formData = { fullName: this.state.fullName,
                     contactNumber: this.state.contactNumber,
                     shippingAddress: this.state.shippingAddress };

    if (this._validateInput()) {
      this.props.updateFormData(formData);
    }
  },

  handleChange(event, attribute) {
    var newState = this.state;
    newState[attribute] = event.target.value;
    this.setState(newState);
    console.log(this.state);
  },

  render() {
    var errorMessage = this._renderError();

    return (
      &lt;div&gt;
        &lt;h1&gt;Enter your shipping information.&lt;/h1&gt;
        {errorMessage}
        &lt;div style={{width: 200}}&gt;
          &lt;form onSubmit={this.handleSubmit}&gt;
            &lt;div className="form-group"&gt;
              &lt;input className="form-control"
                     type="text"
                     placeholder="Full Name"
                     value={this.state.fullName}
                     onChange={(event) =&gt; this.handleChange(event, 'fullName')} /&gt;
            &lt;/div&gt;

            &lt;div className="form-group"&gt;
              &lt;input className="form-control"
                     type="text"
                     placeholder="Contact number"
                     value={this.state.contactNumber}
                     onChange={(event) =&gt; this.handleChange(event, 'contactNumber')}/&gt;
            &lt;/div&gt;

            &lt;div className="form-group"&gt;
              &lt;input className="form-control"
                     type="text"
                     placeholder="Shipping Address"
                     value={this.state.shippingAddress}
                     onChange={(event) =&gt; this.handleChange(event, 'shippingAddress')} /&gt;
            &lt;/div&gt;

            &lt;div className="form-group"&gt;
              &lt;button type="submit"
                      ref="submit"
                      className="btn btn-success"&gt;
                Submit
              &lt;/button&gt;
            &lt;/div&gt;
          &lt;/form&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    );
  }
});</pre></div><p>"This component is using almost same code as our first form. We are showing textboxes for the shipping details to the user. There is validation and all the fields are required fields. We are syncing the data entered by the user using a <code class="literal">onChange</code> handler in the state of the component and passing this state to the <code class="literal">updateFormData</code> function of the parent component in the end." Mike explained.</p><p>"Now, at the end of <a id="id123" class="indexterm"/>second step, we have gathered a list of books chosen by the user and the shipping information." said Mike.</p><div class="informalexample"><pre class="programlisting">{ selectedBooks: ["Zero to One", "Wings of Fire"],
  fullName: "John Smith",
  contactNumber: "1234567890",
  shippingAddress: "10th Cross, NY" }</pre></div><p>"I can see how we are assigning the <code class="literal">value</code> prop of the input fields to it's corresponding state." Shawn.</p><div class="informalexample"><pre class="programlisting">  value={this.state.shippingAddress}</pre></div><p>"Yes. As we discussed earlier about the controlled and uncontrolled components, we are making sure that the <a id="id124" class="indexterm"/>UI reflects the latest state, based on the user interaction." said Mike.</p></div>
<div class="section" title="Delivery details step"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec51"/>Delivery details step</h1></div></div></div><p>"Shawn, the next <a id="id125" class="indexterm"/>step is about providing various delivery options. For now, let's assume that the user can choose between <code class="literal">Primary</code> delivery, meaning a next-day delivery, and <code class="literal">Normal</code> delivery, meaning 3 - 4 days delivery. By default, the <code class="literal">Primary</code> option must be selected. A user can choose the <code class="literal">Normal</code> delivery option too. Can you try building this last step?" Mike asked.</p><div class="informalexample"><pre class="programlisting">// src/BookStore.js
// Adding DeliveryDetails component

var DeliveryDetails = React.createClass({
  getInitialState() {
    return (
      { deliveryOption: 'Primary' }
    );
  },

  handleChange(event) {
    this.setState({ deliveryOption: event.target.value});
  },

  handleSubmit(event) {
    event.preventDefault();
    this.props.updateFormData(this.state);
  },

  render() {
    return (
      &lt;div&gt;
        &lt;h1&gt;Choose your delivery options here.&lt;/h1&gt;
        &lt;div style={{width:200}}&gt;
          &lt;form onSubmit={this.handleSubmit}&gt;
            &lt;div className="radio"&gt;
              &lt;label&gt;
                &lt;input type="radio"
                       checked={this.state.deliveryOption === "Primary"}
                       value="Primary"
                       onChange={this.handleChange} /&gt;
                Primary -- Next day delivery
              &lt;/label&gt;
            &lt;/div&gt;
            &lt;div className="radio"&gt;
              &lt;label&gt;
                &lt;input type="radio"
                       checked={this.state.deliveryOption === "Normal"}
                       value="Normal"
                       onChange={this.handleChange} /&gt;
                Normal -- 3-4 days
              &lt;/label&gt;
            &lt;/div&gt;

            &lt;button className="btn btn-success"&gt;
              Submit
            &lt;/button&gt;
          &lt;/form&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    );
  }
});</pre></div><p>"Mike, as needed, I added <code class="literal">Primary</code> as the default option through state. I used radio buttons and their checked prop in order to make sure that only one radio button is selected at any point of time. Also, the state is updated using the <code class="literal">onChange</code> callback to reflect the selected by option. Finally, the <code class="literal">updateFormData</code> function is called to update the parent's form data." Shawn explained.</p><p>"Great, Shawn. This looks good. I think we will also have to make some changes to our <code class="literal">BookStore</code> component as <a id="id126" class="indexterm"/>now we want to show a confirmation page after the user has completed choosing delivery options."</p><div class="informalexample"><pre class="programlisting">// src/BookStore.js
// Updating BookStore component

var BookStore = React.createClass({
 render() {
    switch (this.state.currentStep) {
      case 1:
        return &lt;BookList updateFormData={this.updateFormData} /&gt;;
      case 2:
        return &lt;ShippingDetails updateFormData={this.updateFormData} /&gt;;
      case 3:
        return &lt;DeliveryDetails updateFormData={this.updateFormData} /&gt;;
      case 4:
        return &lt;Confirmation data={this.state.formValues}/&gt;;}/&gt;;}/&gt;;
      default:
        return &lt;BookList updateFormData={this.updateFormData} /&gt;;
    }
  }
});

// Adding Conformation step

var Confirmation = React.createClass({
  render() {
    return (
      &lt;div&gt;
        &lt;h1&gt;Are you sure you want to submit the data?&lt;/h1&gt;
      &lt;/div&gt;
    );
  }
});</pre></div><p>"We added the <code class="literal">Confirmation</code> component as the last step and also added the default form to be the <code class="literal">BookList</code> form, where the user can choose the books. Now, we just need to show all the information captured up to the last step on the <span class="strong"><strong>Confirmation</strong></span> page and actually submit <a id="id127" class="indexterm"/>everything to the backend." said Mike.</p><p>"Let me update the <span class="strong"><strong>Confirmation</strong></span> page to show the data entered by the user." Shawn said.</p><div class="informalexample"><pre class="programlisting">var Confirmation = React.createClass({
  handleSubmit(event) {
    event.preventDefault();
    this.props.updateFormData(this.props.data);
  },

  render() {
    return (
      &lt;div&gt;
        &lt;h1&gt;Are you sure you want to submit the data?&lt;/h1&gt;
        &lt;form onSubmit={this.handleSubmit}&gt;
          &lt;div&gt;
            &lt;strong&gt;Full Name&lt;/strong&gt; : { this.props.data.fullName }
          &lt;/div&gt;&lt;br/&gt;
          &lt;div&gt;
            &lt;strong&gt;Contact Number&lt;/strong&gt; : { this.props.data.contactNumber }
          &lt;/div&gt;&lt;br/&gt;
          &lt;div&gt;
            &lt;strong&gt;Shipping Address&lt;/strong&gt; : { this.props.data.shippingAddress }
          &lt;/div&gt;&lt;br/&gt;
          &lt;div&gt;
            &lt;strong&gt;Selected books&lt;/strong&gt; : { this.props.data.selectedBooks.join(", ") }
          &lt;/div&gt;&lt;br/&gt;
          &lt;button className="btn btn-success"&gt;
            Place order
          &lt;/button&gt;
        &lt;/form&gt;
      &lt;/div&gt;
    );
  }
});</pre></div><p>"Mike, I listed all the <a id="id128" class="indexterm"/>data selected by the user and provided a button to place the order. It looks like this." Shawn.</p><div class="mediaobject"><img src="graphics/4730_04_04.jpg" alt="Delivery details step"/></div><p>"Perfect. I have the success page ready. Let's try that." Mike.</p><div class="informalexample"><pre class="programlisting">// src/BookStore.js
// Adding Success step

var Success = React.createClass({
  render() {
    var numberOfDays = "1 to 2 ";

    if (this.props.data.deliveryOption === 'Normal') {
      numberOfDays = "3 to 4 ";
    }
    return (
      &lt;div&gt;
        &lt;h2&gt;
          Thank you for shopping with us {this.props.data.fullName}.
        &lt;/h2&gt;
        &lt;h4&gt;
          You will soon get {this.props.data.selectedBooks.join(", ")} at {this.props.data.shippingAddress} in approrximately {numberOfDays} days.
        &lt;/h4&gt;
      &lt;/div&gt;
    );
  }
});</pre></div><p>"We will also need to <a id="id129" class="indexterm"/>update <code class="literal">BookStore</code> to show the success page," added Mike.</p><div class="informalexample"><pre class="programlisting">// Updating render method of BookStore component

  render() {
    switch (this.state.currentStep) {
      case 1:
        return &lt;BookList updateFormData={this.updateFormData} /&gt;;
      case 2:
        return &lt;ShippingDetails updateFormData={this.updateFormData} /&gt;;
      case 3:
        return &lt;DeliveryDetails updateFormData={this.updateFormData} /&gt;;
      case 4:
        return &lt;Confirmation data={this.state.formValues} updateFormData={this.updateFormData}/&gt;;
      case 5:
        return &lt;Success data={this.state.formValues}/&gt;;
      default:
        return &lt;BookList updateFormData={this.updateFormData} /&gt;;
    }
  }</pre></div><p>"Now, the success page will be shown as the last page after the user has confirmed and placed the order. Our first version of the form wizard is complete." Mike <a id="id130" class="indexterm"/>informed.</p><div class="mediaobject"><img src="graphics/4730_04_05.jpg" alt="Delivery details step"/></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec52"/>Summary</h1></div></div></div><p>In this chapter, we discussed how to develop forms in React. We saw how to use different input types and event handlers to respond to the user interaction for these inputs. We used state and props to manage the flow of form data from one step to another. We also saw how to use dynamic components to display particular form to the user based on the current step that the user is present on.</p><p>In the next chapter, we will continue with the form wizard and see how mixins can help us in organizing the code better.</p></div></body></html>