<html><head></head><body>
  <div class="Basic-Text-Frame" id="_idContainer353">
   <h1 class="chapterNumber">
    <span class="koboSpan" id="kobo.1.1">
     17
    </span>
   </h1>
   <h1 class="chapterTitle" id="_idParaDest-344">
    <span class="koboSpan" id="kobo.2.1">
     Understanding React Suspense &amp; The use() Hook
    </span>
   </h1>
   <div class="note">
    <p class="normal">
     <span class="koboSpan" id="kobo.3.1">
      Learning Objectives
     </span>
    </p>
    <p class="normal">
     <span class="koboSpan" id="kobo.4.1">
      By the end of this chapter, you will be able to do the following:
     </span>
    </p>
    <ul>
     <li class="bulletList">
      <span class="koboSpan" id="kobo.5.1">
       Describe the purpose and functionality of React’s Suspense feature
      </span>
     </li>
     <li class="bulletList">
      <span class="koboSpan" id="kobo.6.1">
       Use Suspense with RSCs to show fallback content on a granular level
      </span>
     </li>
     <li class="bulletList">
      <span class="koboSpan" id="kobo.7.1">
       Use Suspense for client components via React’s
      </span>
      <code class="inlineCode">
       <span class="koboSpan" id="kobo.8.1">
        use()
       </span>
      </code>
      <span class="koboSpan" id="kobo.9.1">
       Hook
      </span>
     </li>
     <li class="bulletList">
      <span class="koboSpan" id="kobo.10.1">
       Apply different Suspense strategies for data fetching and fallback content
      </span>
     </li>
    </ul>
   </div>
   <h1 class="heading-1" id="_idParaDest-345">
    <span class="koboSpan" id="kobo.11.1">
     Introduction
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.12.1">
     In
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.13.1">
      Chapter 10
     </span>
    </em>
    <span class="koboSpan" id="kobo.14.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.15.1">
      Behind the Scenes of React and Optimization Opportunities
     </span>
    </em>
    <span class="koboSpan" id="kobo.16.1">
     , in the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.17.1">
      Reducing Bundle Sizes via Code Splitting (Lazy Loading)
     </span>
    </em>
    <span class="koboSpan" id="kobo.18.1">
     section, you learned about React’s
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.19.1">
      &lt;Suspense&gt;
     </span>
    </code>
    <span class="koboSpan" id="kobo.20.1">
     component and how it may be used in the context of lazy loading and code splitting to show fallback content while a code bundle is being downloaded.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.21.1">
     As explained there, the purpose of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.22.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.23.1">
     component is to simplify the process of showing fallback content, which, in turn, can lead to a better user experience.
    </span>
    <span class="koboSpan" id="kobo.23.2">
     Since staring at outdated content or a blank page is not something most users appreciate, having a built-in feature that shows alternative content is very convenient.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.24.1">
     In this chapter, you’ll learn that React’s
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.25.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.26.1">
     component is not limited to being used for code splitting.
    </span>
    <span class="koboSpan" id="kobo.26.2">
     Instead, it can also be used for data fetching to show some temporary content while data is being loaded (e.g., from a database).
    </span>
    <span class="koboSpan" id="kobo.26.3">
     Though, as you will also learn,
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.27.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.28.1">
     can only be used for data fetching if the data is fetched in a certain way.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.29.1">
     In addition, this chapter will revisit the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.30.1">
      use()
     </span>
    </code>
    <span class="koboSpan" id="kobo.31.1">
     Hook, which was introduced in
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.32.1">
      Chapter 11
     </span>
    </em>
    <span class="koboSpan" id="kobo.33.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.34.1">
      Working with Complex State
     </span>
    </em>
    <span class="koboSpan" id="kobo.35.1">
     .
    </span>
    <span class="koboSpan" id="kobo.35.2">
     As you will learn, besides using it for getting access to context values, this Hook can be used in conjunction with
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.36.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.37.1">
     as well.
    </span>
   </p>
   <h1 class="heading-1" id="_idParaDest-346">
    <span class="koboSpan" id="kobo.38.1">
     Showing Granular Fallback Content with Suspense
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.39.1">
     When fetching data or downloading a resource (e.g., a code file), loading delays can occur—delays
    </span>
    <a id="_idIndexMarker897">
    </a>
    <span class="koboSpan" id="kobo.40.1">
     that can lead to a bad
    </span>
    <a id="_idIndexMarker898">
    </a>
    <span class="koboSpan" id="kobo.41.1">
     user experience.
    </span>
    <span class="koboSpan" id="kobo.41.2">
     You should therefore consider showing some temporary fallback content while waiting for the requested resource.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.42.1">
     For that reason, to simplify the process of rendering fallback content while waiting for some resource, React offers its
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.43.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.44.1">
     component.
    </span>
    <span class="koboSpan" id="kobo.44.2">
     As shown in
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.45.1">
      Chapter 10
     </span>
    </em>
    <span class="koboSpan" id="kobo.46.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.47.1">
      Behind the Scenes of React and Optimization Opportunities
     </span>
    </em>
    <span class="koboSpan" id="kobo.48.1">
     , you can use the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.49.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.50.1">
     component as a wrapper around React elements that fetch some code or data.
    </span>
    <span class="koboSpan" id="kobo.50.2">
     For example, when using it in the context of code splitting, you can show some temporary fallback content like this:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.51.1">import</span></span><span class="koboSpan" id="kobo.52.1"> { lazy, </span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.53.1">Suspense</span></strong></span><span class="koboSpan" id="kobo.54.1">, useState } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.55.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.56.1">'react'</span></span><span class="koboSpan" id="kobo.57.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.58.1">const</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.59.1">DateCalculator</span></span><span class="koboSpan" id="kobo.60.1"> = </span><span class="hljs-title"><span class="koboSpan" id="kobo.61.1">lazy</span></span><span class="koboSpan" id="kobo.62.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.63.1">() =&gt;</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.64.1">import</span></span><span class="koboSpan" id="kobo.65.1">(
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.66.1">'./components/DateCalculator.jsx'</span></span><span class="koboSpan" id="kobo.67.1">
  )
);
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.68.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.69.1">App</span></span><span class="koboSpan" id="kobo.70.1">() {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.71.1">const</span></span><span class="koboSpan" id="kobo.72.1"> [showDateCalc, setShowDateCalc] = </span><span class="hljs-title"><span class="koboSpan" id="kobo.73.1">useState</span></span><span class="koboSpan" id="kobo.74.1">(</span><span class="hljs-literal"><span class="koboSpan" id="kobo.75.1">false</span></span><span class="koboSpan" id="kobo.76.1">);
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.77.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.78.1">handleOpenDateCalc</span></span><span class="koboSpan" id="kobo.79.1">() {
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.80.1">setShowDateCalc</span></span><span class="koboSpan" id="kobo.81.1">(</span><span class="hljs-literal"><span class="koboSpan" id="kobo.82.1">true</span></span><span class="koboSpan" id="kobo.83.1">);
  }
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.84.1">return</span></span><span class="koboSpan" id="kobo.85.1"> (
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.86.1">&lt;&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.87.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.88.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.89.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.90.1">This app might be doing all kinds of things.</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.91.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.92.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.93.1">&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.94.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.95.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.96.1">&gt;</span></span>
<span class="language-xml"><span class="koboSpan" id="kobo.97.1">        But you can also open a calculator which calculates </span></span>
<span class="language-xml"><span class="koboSpan" id="kobo.98.1">        the difference between two dates.</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.99.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.100.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.101.1">&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.102.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.103.1">button</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.104.1">onClick</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.105.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.106.1">{handleOpenDateCalc}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.107.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.108.1">Open Calculator</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.109.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.110.1">button</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.111.1">&gt;</span></span>
      <span class="code-highlight"><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.112.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.113.1">Suspense</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.114.1">fallback</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.115.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.116.1">{</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.117.1">&lt;</span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.118.1">p</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.119.1">&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.120.1">Loading...</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.121.1">&lt;/</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.122.1">p</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.123.1">&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.124.1">}&gt;</span></strong></span>
<span class="language-xml"><span class="koboSpan" id="kobo.125.1">        {showDateCalc &amp;&amp; </span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.126.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.127.1">DateCalculator</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.128.1"> /&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.129.1">}</span></span>
      <span class="code-highlight"><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.130.1">&lt;/</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.131.1">Suspense</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.132.1">&gt;</span></strong></span>
<span class="language-xml">    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.133.1">&lt;/&gt;</span></span><span class="koboSpan" id="kobo.134.1">
  );
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.135.1">
     In this
    </span>
    <a id="_idIndexMarker899">
    </a>
    <span class="koboSpan" id="kobo.136.1">
     example (which is from a
    </span>
    <a id="_idIndexMarker900">
    </a>
    <span class="koboSpan" id="kobo.137.1">
     regular Vite-based React project), React’s
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.138.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.139.1">
     component is wrapped around the conditionally rendered
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.140.1">
      DateCalculator
     </span>
    </code>
    <span class="koboSpan" id="kobo.141.1">
     component.
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.142.1">
      DateCalculator
     </span>
    </code>
    <span class="koboSpan" id="kobo.143.1">
     is created with the help of React’s
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.144.1">
      lazy()
     </span>
    </code>
    <span class="koboSpan" id="kobo.145.1">
     function, which is used to lazily (i.e., on demand) load the code bundle that belongs to this component.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.146.1">
     As a result, the entire other page content is shown right from the start.
    </span>
    <span class="koboSpan" id="kobo.146.2">
     Only the conditionally displayed
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.147.1">
      DateCalculator
     </span>
    </code>
    <span class="koboSpan" id="kobo.148.1">
     component is replaced with the fallback content (
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.149.1">
      &lt;p&gt;Loading...&lt;/p&gt;
     </span>
    </code>
    <span class="koboSpan" id="kobo.150.1">
     ) while the code is being fetched.
    </span>
    <span class="koboSpan" id="kobo.150.2">
     Thus,
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.151.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.152.1">
     is used to render some fallback JSX code on a very granular level.
    </span>
    <span class="koboSpan" id="kobo.152.2">
     Instead of replacing the entire page or component markup with some temporary content, only a small part of the UI is replaced.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.153.1">
     Of course,
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.154.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.155.1">
     therefore provides a functionality that would also be nice to have when fetching data—after all, delays occur frequently there, too.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-347">
    <span class="koboSpan" id="kobo.156.1">
     Using Suspense for Data Fetching with Next.js
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.157.1">
     As explained in the previous chapter, in the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.158.1">
      Managing Loading States with Next.js
     </span>
    </em>
    <span class="koboSpan" id="kobo.159.1">
     section, the
    </span>
    <a id="_idIndexMarker901">
    </a>
    <span class="koboSpan" id="kobo.160.1">
     process of data fetching also often
    </span>
    <a id="_idIndexMarker902">
    </a>
    <span class="koboSpan" id="kobo.161.1">
     comes with waiting times that can negatively impact user experience.
    </span>
    <span class="koboSpan" id="kobo.161.2">
     That’s why, in that same section, you learned that Next.js allows you to define a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.162.1">
      loading.js
     </span>
    </code>
    <span class="koboSpan" id="kobo.163.1">
     file that contains some fallback component that’s rendered during such a delay.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.164.1">
     However, using that approach essentially replaces the entire page (or the main area of that page) with the loading fallback component content.
    </span>
    <span class="koboSpan" id="kobo.164.2">
     But that’s not always ideal—you instead might want to display some loading fallback content on a more granular level when fetching data.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.165.1">
     Thankfully, in Next.js projects, you can use
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.166.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.167.1">
     in a similar way, as shown in the example from the previous section, to wrap it around components that fetch data.
    </span>
    <span class="koboSpan" id="kobo.167.2">
     Since Next.js supports HTTP response streaming, it’s able to render the rest of the page immediately while streaming the content that depends on the fetched data to the client side once it’s available.
    </span>
    <span class="koboSpan" id="kobo.167.3">
     Until the data is loaded and available,
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.168.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.169.1">
     will render its defined fallback.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.170.1">
     Therefore, coming back to the example from the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.171.1">
      Managing Loading States with Next.js
     </span>
    </em>
    <span class="koboSpan" id="kobo.172.1">
     section
    </span>
    <a id="_idIndexMarker903">
    </a>
    <span class="koboSpan" id="kobo.173.1">
     of
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.174.1">
      Chapter 16
     </span>
    </em>
    <span class="koboSpan" id="kobo.175.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.176.1">
      React Server Components &amp; Server Actions
     </span>
    </em>
    <span class="koboSpan" id="kobo.177.1">
     , you can take advantage
    </span>
    <a id="_idIndexMarker904">
    </a>
    <span class="koboSpan" id="kobo.178.1">
     of
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.179.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.180.1">
     by outsourcing the data fetching code into a separate
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.181.1">
      UserGoals
     </span>
    </code>
    <span class="koboSpan" id="kobo.182.1">
     component:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.183.1">import</span></span><span class="koboSpan" id="kobo.184.1"> fs </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.185.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.186.1">'node:fs/promises'</span></span><span class="koboSpan" id="kobo.187.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.188.1">async</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.189.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.190.1">fetchGoals</span></span><span class="koboSpan" id="kobo.191.1">() {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.192.1">await</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.193.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.194.1">Promise</span></span><span class="koboSpan" id="kobo.195.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.196.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.197.1">resolve</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.198.1">) =&gt;</span></span> <span class="hljs-built_in"><span class="koboSpan" id="kobo.199.1">setTimeout</span></span><span class="koboSpan" id="kobo.200.1">(resolve, </span><span class="hljs-number"><span class="koboSpan" id="kobo.201.1">3000</span></span><span class="koboSpan" id="kobo.202.1">)); </span><span class="hljs-comment"><span class="koboSpan" id="kobo.203.1">// delay</span></span>
  <span class="hljs-keyword"><span class="koboSpan" id="kobo.204.1">const</span></span><span class="koboSpan" id="kobo.205.1"> goals = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.206.1">await</span></span><span class="koboSpan" id="kobo.207.1"> fs.</span><span class="hljs-title"><span class="koboSpan" id="kobo.208.1">readFile</span></span><span class="koboSpan" id="kobo.209.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.210.1">'./data/user-goals.json'</span></span><span class="koboSpan" id="kobo.211.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.212.1">'utf-8'</span></span><span class="koboSpan" id="kobo.213.1">);
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.214.1">return</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.215.1">JSON</span></span><span class="koboSpan" id="kobo.216.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.217.1">parse</span></span><span class="koboSpan" id="kobo.218.1">(goals);
}
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.219.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.220.1">default</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.221.1">async</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.222.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.223.1">UserGoals</span></span><span class="koboSpan" id="kobo.224.1">() {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.225.1">const</span></span><span class="koboSpan" id="kobo.226.1"> fetchedGoals = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.227.1">await</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.228.1">fetchGoals</span></span><span class="koboSpan" id="kobo.229.1">();
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.230.1">return</span></span><span class="koboSpan" id="kobo.231.1"> (
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.232.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.233.1">ul</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.234.1">&gt;</span></span>
<span class="language-xml"><span class="koboSpan" id="kobo.235.1">      {fetchedGoals.map((goal) =&gt; (</span></span>
<span class="language-xml">        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.236.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.237.1">li</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.238.1">key</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.239.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.240.1">{goal}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.241.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.242.1">{goal}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.243.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.244.1">li</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.245.1">&gt;</span></span>
<span class="language-xml"><span class="koboSpan" id="kobo.246.1">      ))}</span></span>
<span class="language-xml">    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.247.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.248.1">ul</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.249.1">&gt;</span></span><span class="koboSpan" id="kobo.250.1">
  );
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.251.1">
     This
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.252.1">
      UserGoals
     </span>
    </code>
    <span class="koboSpan" id="kobo.253.1">
     component can then be wrapped with
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.254.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.255.1">
     in the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.256.1">
      GoalsPage
     </span>
    </code>
    <span class="koboSpan" id="kobo.257.1">
     component like this:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.258.1">import</span></span><span class="koboSpan" id="kobo.259.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.260.1">Suspense</span></span><span class="koboSpan" id="kobo.261.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.262.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.263.1">'react'</span></span><span class="koboSpan" id="kobo.264.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.265.1">import</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.266.1">UserGoals</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.267.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.268.1">'../../components/UserGoals'</span></span><span class="koboSpan" id="kobo.269.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.270.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.271.1">default</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.272.1">async</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.273.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.274.1">GoalsPage</span></span><span class="koboSpan" id="kobo.275.1">() {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.276.1">return</span></span><span class="koboSpan" id="kobo.277.1"> (
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.278.1">&lt;&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.279.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.280.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.281.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.282.1">Top User Goals</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.283.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.284.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.285.1">&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.286.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.287.1">Suspense</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.288.1">fallback</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.289.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.290.1">{</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.291.1">        &lt;</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.292.1">p</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.293.1">id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.294.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.295.1">"fallback"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.296.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.297.1">Fetching user goals...</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.298.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.299.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.300.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.301.1">}</span></span>
<span class="language-xml"><span class="koboSpan" id="kobo.302.1">      &gt;</span></span>
<span class="language-xml">        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.303.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.304.1">UserGoals</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.305.1"> /&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.306.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.307.1">Suspense</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.308.1">&gt;</span></span>
<span class="language-xml">    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.309.1">&lt;/&gt;</span></span><span class="koboSpan" id="kobo.310.1">
  );
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.311.1">
     This
    </span>
    <a id="_idIndexMarker905">
    </a>
    <span class="koboSpan" id="kobo.312.1">
     code now utilizes React’s
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.313.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.314.1">
     component
    </span>
    <a id="_idIndexMarker906">
    </a>
    <span class="koboSpan" id="kobo.315.1">
     to show a fallback paragraph while the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.316.1">
      UserGoals
     </span>
    </code>
    <span class="koboSpan" id="kobo.317.1">
     component is fetching data.
    </span>
   </p>
   <div class="note">
    <p class="normal">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.318.1">
       Note
      </span>
     </strong>
    </p>
    <p class="normal">
     <span class="koboSpan" id="kobo.319.1">
      You can find the complete demo project code on GitHub:
     </span>
     <a href="https://github.com/mschwarzmueller/book-react-key-concepts-e2/tree/17-suspense-use/examples/02-data-fetching-suspense">
      <span class="url">
       <span class="koboSpan" id="kobo.320.1">
        https://github.com/mschwarzmueller/book-react-key-concepts-e2/tree/17-suspense-use/examples/02-data-fetching-suspense
       </span>
      </span>
     </a>
     <span class="koboSpan" id="kobo.321.1">
      .
     </span>
    </p>
   </div>
   <p class="normal">
    <span class="koboSpan" id="kobo.322.1">
     As a result, when users navigate to
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.323.1">
      /goals
     </span>
    </code>
    <span class="koboSpan" id="kobo.324.1">
     , they immediately see the title (the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.325.1">
      &lt;h1&gt;
     </span>
    </code>
    <span class="koboSpan" id="kobo.326.1">
     element) in combination with the fallback content.
    </span>
    <span class="koboSpan" id="kobo.326.2">
     There is no need for a separate
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.327.1">
      loading.js
     </span>
    </code>
    <span class="koboSpan" id="kobo.328.1">
     file anymore.
    </span>
   </p>
   <figure class="mediaobject">
    <span class="koboSpan" id="kobo.329.1">
     <img alt="A screen shot of a computer screen  Description automatically generated" src="image/B31339_17_01.png"/>
    </span>
   </figure>
   <p class="packt_figref">
    <span class="koboSpan" id="kobo.330.1">
     Figure 17.1: The fallback content is shown as part of the target page, instead of entirely replacing it
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.331.1">
     However, the advantage of using
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.332.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.333.1">
     in this situation is not just that the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.334.1">
      loading.js
     </span>
    </code>
    <span class="koboSpan" id="kobo.335.1">
     file isn’t needed anymore.
    </span>
    <span class="koboSpan" id="kobo.335.2">
     Instead, data fetching and fallback content can now be managed on a very granular level.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.336.1">
     For
    </span>
    <a id="_idIndexMarker907">
    </a>
    <span class="koboSpan" id="kobo.337.1">
     example, in a more complex online shop
    </span>
    <a id="_idIndexMarker908">
    </a>
    <span class="koboSpan" id="kobo.338.1">
     application, you could have a component like this:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.339.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.340.1">ShopOverviewPage</span></span><span class="koboSpan" id="kobo.341.1">() {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.342.1">return</span></span><span class="koboSpan" id="kobo.343.1"> (
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.344.1">&lt;&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.345.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.346.1">header</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.347.1">&gt;</span></span>
<span class="language-xml">        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.348.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.349.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.350.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.351.1">Find your next deal!</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.352.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.353.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.354.1">&gt;</span></span>
<span class="language-xml">        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.355.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.356.1">MainNavigation</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.357.1"> /&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.358.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.359.1">header</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.360.1">&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.361.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.362.1">main</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.363.1">&gt;</span></span>
<span class="language-xml">        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.364.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.365.1">Suspense</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.366.1">fallback</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.367.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.368.1">{</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.369.1">&lt;</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.370.1">DailyDealSkeleton</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.371.1"> /&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.372.1">}&gt;</span></span>
<span class="language-xml">          </span><span class="hljs-tag"><span class="koboSpan" id="kobo.373.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.374.1">DailyDeal</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.375.1"> /&gt;</span></span>
<span class="language-xml">        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.376.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.377.1">Suspense</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.378.1">&gt;</span></span>
<span class="language-xml">        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.379.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.380.1">section</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.381.1">id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.382.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.383.1">"search"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.384.1">&gt;</span></span>
<span class="language-xml">          </span><span class="hljs-tag"><span class="koboSpan" id="kobo.385.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.386.1">h2</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.387.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.388.1">Looking for something specific?</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.389.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.390.1">h2</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.391.1">&gt;</span></span>
<span class="language-xml">          </span><span class="hljs-tag"><span class="koboSpan" id="kobo.392.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.393.1">Search</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.394.1"> /&gt;</span></span>
<span class="language-xml">        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.395.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.396.1">section</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.397.1">&gt;</span></span>
<span class="language-xml">        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.398.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.399.1">Suspense</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.400.1">fallback</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.401.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.402.1">{</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.403.1">&lt;</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.404.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.405.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.406.1">Fetching products...</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.407.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.408.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.409.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.410.1">}&gt;</span></span>
<span class="language-xml">          </span><span class="hljs-tag"><span class="koboSpan" id="kobo.411.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.412.1">Products</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.413.1"> /&gt;</span></span>
<span class="language-xml">        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.414.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.415.1">Suspense</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.416.1">&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.417.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.418.1">main</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.419.1">&gt;</span></span>
<span class="language-xml">    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.420.1">&lt;/&gt;</span></span><span class="koboSpan" id="kobo.421.1">
  );
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.422.1">
     In this example, the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.423.1">
      &lt;header&gt;
     </span>
    </code>
    <span class="koboSpan" id="kobo.424.1">
     and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.425.1">
      &lt;section id="search"&gt;
     </span>
    </code>
    <span class="koboSpan" id="kobo.426.1">
     elements are always visible and rendered.
    </span>
    <span class="koboSpan" id="kobo.426.2">
     On the other hand,
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.427.1">
      &lt;DailyDeal /&gt;
     </span>
    </code>
    <span class="koboSpan" id="kobo.428.1">
     and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.429.1">
      &lt;Products /&gt;
     </span>
    </code>
    <span class="koboSpan" id="kobo.430.1">
     are only rendered once their data has been fetched.
    </span>
    <span class="koboSpan" id="kobo.430.2">
     Until then, their respective fallbacks are displayed.
    </span>
   </p>
   <figure class="mediaobject">
    <span class="koboSpan" id="kobo.431.1">
     <img alt="A diagram of a website  Description automatically generated" src="image/B31339_17_02.png"/>
    </span>
   </figure>
   <p class="packt_figref">
    <span class="koboSpan" id="kobo.432.1">
     Figure 17.2: Placeholders are shown initially until loaded data is streamed in and rendered to the screen
    </span>
   </p>
   <p class="normal">
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.433.1">
      &lt;DailyDeal /&gt;
     </span>
    </code>
    <span class="koboSpan" id="kobo.434.1">
     and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.435.1">
      &lt;Products /&gt;
     </span>
    </code>
    <span class="koboSpan" id="kobo.436.1">
     will be loaded and rendered independently from each other
    </span>
    <a id="_idIndexMarker909">
    </a>
    <span class="koboSpan" id="kobo.437.1">
     since they’re wrapped by two different
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.438.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.439.1">
     blocks.
    </span>
    <span class="koboSpan" id="kobo.439.2">
     Consequently, users will immediately see the header and search
    </span>
    <a id="_idIndexMarker910">
    </a>
    <span class="koboSpan" id="kobo.440.1">
     area, and then eventually see the daily deal and products—though either of the two may load and render first.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.441.1">
     What’s important about these examples is that the components wrapped by
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.442.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.443.1">
     are RSCs that use
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.444.1">
      async/await
     </span>
    </code>
    <span class="koboSpan" id="kobo.445.1">
     .
    </span>
    <span class="koboSpan" id="kobo.445.2">
     As you will learn in the next section, not all React components will interact with the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.446.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.447.1">
     component.
    </span>
    <span class="koboSpan" id="kobo.447.2">
     But React Server Components, in Next.js projects, will.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-348">
    <span class="koboSpan" id="kobo.448.1">
     Using Suspense in Other React Projects—Possible, But Tricky
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.449.1">
     The
    </span>
    <a id="_idIndexMarker911">
    </a>
    <span class="koboSpan" id="kobo.450.1">
     previous section explored how you may take advantage of
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.451.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.452.1">
     for data fetching with RSCs in Next.js projects.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.453.1">
     However,
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.454.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.455.1">
     is not a Next.js-specific feature or concept—instead, it’s provided by React itself.
    </span>
    <span class="koboSpan" id="kobo.455.2">
     Consequently, you can use it in any React project to show fallback content while data is being fetched.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.456.1">
     At least, that’s
    </span>
    <a id="_idIndexMarker912">
    </a>
    <span class="koboSpan" id="kobo.457.1">
     the theory.
    </span>
    <span class="koboSpan" id="kobo.457.2">
     But as it turns out, you can’t use it with all components and data fetching strategies.
    </span>
   </p>
   <h3 class="heading-3" id="_idParaDest-349">
    <span class="koboSpan" id="kobo.458.1">
     Suspense Does Not Work with useEffect()
    </span>
   </h3>
   <p class="normal">
    <span class="koboSpan" id="kobo.459.1">
     Since fetching data via
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.460.1">
      useEffect()
     </span>
    </code>
    <span class="koboSpan" id="kobo.461.1">
     is a common strategy, you might be inclined to use
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.462.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.463.1">
     in conjunction
    </span>
    <a id="_idIndexMarker913">
    </a>
    <span class="koboSpan" id="kobo.464.1">
     with this Hook to show some fallback content while data is being loaded via the effect function.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.465.1">
     For example, the following
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.466.1">
      BlogPosts
     </span>
    </code>
    <span class="koboSpan" id="kobo.467.1">
     components uses
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.468.1">
      useEffect()
     </span>
    </code>
    <span class="koboSpan" id="kobo.469.1">
     to load and display some blog posts:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.470.1">import</span></span><span class="koboSpan" id="kobo.471.1"> { useEffect, useState } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.472.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.473.1">'react'</span></span><span class="koboSpan" id="kobo.474.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.475.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.476.1">BlogPosts</span></span><span class="koboSpan" id="kobo.477.1">() {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.478.1">const</span></span><span class="koboSpan" id="kobo.479.1"> [posts, setPosts] = </span><span class="hljs-title"><span class="koboSpan" id="kobo.480.1">useState</span></span><span class="koboSpan" id="kobo.481.1">([]);
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.482.1">useEffect</span></span><span class="koboSpan" id="kobo.483.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.484.1">() =&gt;</span></span><span class="koboSpan" id="kobo.485.1"> {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.486.1">async</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.487.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.488.1">fetchBlogPosts</span></span><span class="koboSpan" id="kobo.489.1">() {
      </span><span class="hljs-comment"><span class="koboSpan" id="kobo.490.1">// simulate slow network</span></span>
      <span class="hljs-keyword"><span class="koboSpan" id="kobo.491.1">await</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.492.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.493.1">Promise</span></span><span class="koboSpan" id="kobo.494.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.495.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.496.1">resolve</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.497.1">) =&gt;</span></span> <span class="hljs-built_in"><span class="koboSpan" id="kobo.498.1">setTimeout</span></span><span class="koboSpan" id="kobo.499.1">(resolve, </span><span class="hljs-number"><span class="koboSpan" id="kobo.500.1">3000</span></span><span class="koboSpan" id="kobo.501.1">));
      </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.502.1">const</span></span><span class="koboSpan" id="kobo.503.1"> response = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.504.1">await</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.505.1">fetch</span></span><span class="koboSpan" id="kobo.506.1">(
        </span><span class="hljs-string"><span class="koboSpan" id="kobo.507.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.508.1">https://jsonplaceholder.typicode.com/posts'</span></span><span class="koboSpan" id="kobo.509.1">
      );
      </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.510.1">const</span></span><span class="koboSpan" id="kobo.511.1"> posts = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.512.1">await</span></span><span class="koboSpan" id="kobo.513.1"> response.</span><span class="hljs-title"><span class="koboSpan" id="kobo.514.1">json</span></span><span class="koboSpan" id="kobo.515.1">();
      </span><span class="hljs-title"><span class="koboSpan" id="kobo.516.1">setPosts</span></span><span class="koboSpan" id="kobo.517.1">(posts);
    }
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.518.1">fetchBlogPosts</span></span><span class="koboSpan" id="kobo.519.1">();
  }, []);
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.520.1">return</span></span><span class="koboSpan" id="kobo.521.1"> (
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.522.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.523.1">ul</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.524.1">&gt;</span></span>
<span class="language-xml"><span class="koboSpan" id="kobo.525.1">      {posts.map((post) =&gt; (</span></span>
<span class="language-xml">        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.526.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.527.1">li</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.528.1">key</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.529.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.530.1">{post.id}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.531.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.532.1">{post.title}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.533.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.534.1">li</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.535.1">&gt;</span></span>
<span class="language-xml"><span class="koboSpan" id="kobo.536.1">      ))}</span></span>
<span class="language-xml">    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.537.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.538.1">ul</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.539.1">&gt;</span></span><span class="koboSpan" id="kobo.540.1">
  );
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.541.1">
     You could wrap this component with
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.542.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.543.1">
     like this:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.544.1">import</span></span><span class="koboSpan" id="kobo.545.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.546.1">Suspense</span></span><span class="koboSpan" id="kobo.547.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.548.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.549.1">'react'</span></span><span class="koboSpan" id="kobo.550.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.551.1">import</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.552.1">BlogPosts</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.553.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.554.1">'./components/BlogPosts.jsx'</span></span><span class="koboSpan" id="kobo.555.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.556.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.557.1">App</span></span><span class="koboSpan" id="kobo.558.1">() {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.559.1">return</span></span><span class="koboSpan" id="kobo.560.1"> (
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.561.1">&lt;&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.562.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.563.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.564.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.565.1">All posts</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.566.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.567.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.568.1">&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.569.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.570.1">Suspense</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.571.1">fallback</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.572.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.573.1">{</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.574.1">&lt;</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.575.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.576.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.577.1">Fetching blog posts...</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.578.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.579.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.580.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.581.1">}&gt;</span></span>
<span class="language-xml">        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.582.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.583.1">BlogPosts</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.584.1"> /&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.585.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.586.1">Suspense</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.587.1">&gt;</span></span>
<span class="language-xml">    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.588.1">&lt;/&gt;</span></span><span class="koboSpan" id="kobo.589.1">
  );
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.590.1">
     Unfortunately, this will not work in the intended way, though.
    </span>
    <span class="koboSpan" id="kobo.590.2">
     Instead of displaying the fallback
    </span>
    <a id="_idIndexMarker914">
    </a>
    <span class="koboSpan" id="kobo.591.1">
     content, nothing will be rendered while the data is being fetched.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.592.1">
     The reason for this behavior is that
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.593.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.594.1">
     is intended to suspend when fetching data during the component rendering process—not when fetching inside of some effect function.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.595.1">
     It helps to recall how
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.596.1">
      useEffect()
     </span>
    </code>
    <span class="koboSpan" id="kobo.597.1">
     works (from
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.598.1">
      Chapter 8
     </span>
    </em>
    <span class="koboSpan" id="kobo.599.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.600.1">
      Handling Side Effects
     </span>
    </em>
    <span class="koboSpan" id="kobo.601.1">
     ): the effect function is executed after the component function is executed, i.e., after the first component render cycle is done.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.602.1">
     As a result, you can’t use
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.603.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.604.1">
     to show fallback content when fetching data via
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.605.1">
      useEffect()
     </span>
    </code>
    <span class="koboSpan" id="kobo.606.1">
     .
    </span>
    <span class="koboSpan" id="kobo.606.2">
     Instead, in those cases, you need to manually manage and use some loading state in the component that performs the data fetching (i.e., by manually managing different state slices like
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.607.1">
      isLoading
     </span>
    </code>
    <span class="koboSpan" id="kobo.608.1">
     —for example, as explained and shown in
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.609.1">
      Chapter 11
     </span>
    </em>
    <span class="koboSpan" id="kobo.610.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.611.1">
      Working with Complex State
     </span>
    </em>
    <span class="koboSpan" id="kobo.612.1">
     , in the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.613.1">
      Limitations of useState()
     </span>
    </em>
    <span class="koboSpan" id="kobo.614.1">
     and
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.615.1">
      Managing State with useReducer()
     </span>
    </em>
    <span class="koboSpan" id="kobo.616.1">
     sections.
    </span>
   </p>
   <h3 class="heading-3" id="_idParaDest-350">
    <span class="koboSpan" id="kobo.617.1">
     Fetching Data while Rendering—the Incorrect Way
    </span>
   </h3>
   <p class="normal">
    <span class="koboSpan" id="kobo.618.1">
     Since
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.619.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.620.1">
     intends to show fallback content while a component is fetching data during
    </span>
    <a id="_idIndexMarker915">
    </a>
    <span class="koboSpan" id="kobo.621.1">
     its rendering process, you could try to re-write the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.622.1">
      BlogPosts
     </span>
    </code>
    <span class="koboSpan" id="kobo.623.1">
     component to look like this:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.624.1">async</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.625.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.626.1">BlogPosts</span></span><span class="koboSpan" id="kobo.627.1">() {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.628.1">await</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.629.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.630.1">Promise</span></span><span class="koboSpan" id="kobo.631.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.632.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.633.1">resolve</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.634.1">) =&gt;</span></span> <span class="hljs-built_in"><span class="koboSpan" id="kobo.635.1">setTimeout</span></span><span class="koboSpan" id="kobo.636.1">(resolve, </span><span class="hljs-number"><span class="koboSpan" id="kobo.637.1">3000</span></span><span class="koboSpan" id="kobo.638.1">));
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.639.1">const</span></span><span class="koboSpan" id="kobo.640.1"> response = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.641.1">await</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.642.1">fetch</span></span><span class="koboSpan" id="kobo.643.1">(
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.644.1">'https://jsonplaceholder.typicode.com/posts'</span></span><span class="koboSpan" id="kobo.645.1">
  );
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.646.1">const</span></span><span class="koboSpan" id="kobo.647.1"> posts = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.648.1">await</span></span><span class="koboSpan" id="kobo.649.1"> response.</span><span class="hljs-title"><span class="koboSpan" id="kobo.650.1">json</span></span><span class="koboSpan" id="kobo.651.1">();
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.652.1">return</span></span><span class="koboSpan" id="kobo.653.1"> (
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.654.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.655.1">ul</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.656.1">&gt;</span></span>
<span class="language-xml"><span class="koboSpan" id="kobo.657.1">      {posts.map((post) =&gt; (</span></span>
<span class="language-xml">        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.658.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.659.1">li</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.660.1">key</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.661.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.662.1">{post.id}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.663.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.664.1">{post.title}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.665.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.666.1">li</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.667.1">&gt;</span></span>
<span class="language-xml"><span class="koboSpan" id="kobo.668.1">      ))}</span></span>
<span class="language-xml">    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.669.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.670.1">ul</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.671.1">&gt;</span></span><span class="koboSpan" id="kobo.672.1">
  );
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.673.1">
     But trying
    </span>
    <a id="_idIndexMarker916">
    </a>
    <span class="koboSpan" id="kobo.674.1">
     to use this code will yield an error in the browser developer tools:
    </span>
   </p>
   <figure class="mediaobject">
    <span class="koboSpan" id="kobo.675.1">
     <img alt="A close-up of a message  Description automatically generated" src="image/B31339_17_03.png"/>
    </span>
   </figure>
   <p class="packt_figref">
    <span class="koboSpan" id="kobo.676.1">
     Figure 17.3: React complains about async components on the client side
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.677.1">
     React does not support the usage of
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.678.1">
      async/await
     </span>
    </code>
    <span class="koboSpan" id="kobo.679.1">
     in client components.
    </span>
    <span class="koboSpan" id="kobo.679.2">
     Only React Server Components may use that syntax (and therefore return promises).
    </span>
    <span class="koboSpan" id="kobo.679.3">
     Consequently, regular React projects, which are not set up to support RSCs, can’t use this solution.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.680.1">
     Of course, you could come up with a (problematic) alternative solution like this:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.681.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.682.1">BlogPosts</span></span><span class="koboSpan" id="kobo.683.1">() {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.684.1">const</span></span><span class="koboSpan" id="kobo.685.1"> [posts, setPosts] = </span><span class="hljs-title"><span class="koboSpan" id="kobo.686.1">useState</span></span><span class="koboSpan" id="kobo.687.1">([]);
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.688.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.689.1">Promise</span></span><span class="koboSpan" id="kobo.690.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.691.1">() =&gt;</span></span> <span class="hljs-built_in"><span class="koboSpan" id="kobo.692.1">setTimeout</span></span><span class="koboSpan" id="kobo.693.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.694.1">() =&gt;</span></span><span class="koboSpan" id="kobo.695.1"> {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.696.1">return</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.697.1">fetch</span></span><span class="koboSpan" id="kobo.698.1">(
      </span><span class="hljs-string"><span class="koboSpan" id="kobo.699.1">'https://jsonplaceholder.typicode.com/posts'</span></span><span class="koboSpan" id="kobo.700.1">
    ).</span><span class="hljs-title"><span class="koboSpan" id="kobo.701.1">then</span></span><span class="koboSpan" id="kobo.702.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.703.1">response</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.704.1"> =&gt;</span></span><span class="koboSpan" id="kobo.705.1"> response.</span><span class="hljs-title"><span class="koboSpan" id="kobo.706.1">json</span></span><span class="koboSpan" id="kobo.707.1">())
     .</span><span class="hljs-title"><span class="koboSpan" id="kobo.708.1">then</span></span><span class="koboSpan" id="kobo.709.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.710.1">fetchedPosts</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.711.1"> =&gt;</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.712.1">setPosts</span></span><span class="koboSpan" id="kobo.713.1">(fetchedPosts));
  }, </span><span class="hljs-number"><span class="koboSpan" id="kobo.714.1">3000</span></span><span class="koboSpan" id="kobo.715.1">));
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.716.1">return</span></span><span class="koboSpan" id="kobo.717.1"> (
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.718.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.719.1">ul</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.720.1">&gt;</span></span>
<span class="language-xml"><span class="koboSpan" id="kobo.721.1">      {posts.map((post) =&gt; (</span></span>
<span class="language-xml">        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.722.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.723.1">li</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.724.1">key</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.725.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.726.1">{post.id}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.727.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.728.1">{post.title}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.729.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.730.1">li</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.731.1">&gt;</span></span>
<span class="language-xml"><span class="koboSpan" id="kobo.732.1">      ))}</span></span>
<span class="language-xml">    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.733.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.734.1">ul</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.735.1">&gt;</span></span><span class="koboSpan" id="kobo.736.1">
  );
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.737.1">
     But this
    </span>
    <a id="_idIndexMarker917">
    </a>
    <span class="koboSpan" id="kobo.738.1">
     approach was already discarded in
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.739.1">
      Chapter 8
     </span>
    </em>
    <span class="koboSpan" id="kobo.740.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.741.1">
      Handling Side Effects
     </span>
    </em>
    <span class="koboSpan" id="kobo.742.1">
     , in the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.743.1">
      What’s the Problem?
     </span>
    </em>
    <span class="koboSpan" id="kobo.744.1">
     section—the code creates an infinite loop.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.745.1">
     So, fetching data as part of a component’s rendering process is really difficult when not working with RSCs.
    </span>
   </p>
   <h3 class="heading-3" id="_idParaDest-351">
    <span class="koboSpan" id="kobo.746.1">
     Getting Suspense Support Is Tricky
    </span>
   </h3>
   <p class="normal">
    <span class="koboSpan" id="kobo.747.1">
     Since
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.748.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.749.1">
     requires data fetching to occur during the rendering process, which is difficult to
    </span>
    <a id="_idIndexMarker918">
    </a>
    <span class="koboSpan" id="kobo.750.1">
     set up manually, the React documentation (
    </span>
    <a href="https://react.dev/reference/react/Suspense#displaying-a-fallback-while-content-is-loading">
     <span class="url">
      <span class="koboSpan" id="kobo.751.1">
       https://react.dev/reference/react/Suspense#displaying-a-fallback-while-content-is-loading
      </span>
     </span>
    </a>
    <span class="koboSpan" id="kobo.752.1">
     ) itself mentions that
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.753.1">
      “only Suspense-enabled data sources will activate the Suspense component,”
     </span>
    </em>
    <span class="koboSpan" id="kobo.754.1">
     further stating that those data sources include:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.755.1">
      Data fetching with Suspense-enabled frameworks like Relay and Next.js
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.756.1">
      Lazy-loading components code with
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.757.1">
       lazy()
      </span>
     </code>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.758.1">
      Reading the value of a Promise with
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.759.1">
       use()
      </span>
     </code>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.760.1">
     On the same page, the official documentation highlights that
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.761.1">
      “Suspense-enabled data fetching without the use of an opinionated framework is not yet supported.”
     </span>
    </em>
   </p>
   <div class="note">
    <p class="normal">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.762.1">
       Note
      </span>
     </strong>
    </p>
    <p class="normal">
     <span class="koboSpan" id="kobo.763.1">
      Documentation may change over time—and so may React.
     </span>
     <span class="koboSpan" id="kobo.763.2">
      But even though the exact wording may differ at the point of time you’re reading this, the way of using
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.764.1">
       Suspense
      </span>
     </code>
     <span class="koboSpan" id="kobo.765.1">
      , and the fact that it can’t be used without special libraries or features like
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.766.1">
       lazy()
      </span>
     </code>
     <span class="koboSpan" id="kobo.767.1">
      , is highly unlikely to change.
     </span>
    </p>
    <p class="normal">
     <span class="koboSpan" id="kobo.768.1">
      This chapter was written when React 19 was released.
     </span>
     <span class="koboSpan" id="kobo.768.2">
      You can visit the official changelog of this book to find out whether anything significant has changed since then:
     </span>
     <a href="https://github.com/mschwarzmueller/book-react-key-concepts-e2/blob/main/CHANGELOG.md">
      <span class="url">
       <span class="koboSpan" id="kobo.769.1">
        https://github.com/mschwarzmueller/book-react-key-concepts-e2/blob/main/CHANGELOG.md
       </span>
      </span>
     </a>
     <span class="koboSpan" id="kobo.770.1">
      .
     </span>
    </p>
   </div>
   <p class="normal">
    <span class="koboSpan" id="kobo.771.1">
     Therefore, unless you plan on building your own Suspense-enabled library, you either have to stick to using
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.772.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.773.1">
     for code-splitting (via
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.774.1">
      lazy()
     </span>
    </code>
    <span class="koboSpan" id="kobo.775.1">
     ), use a third-party framework
    </span>
    <a id="_idIndexMarker919">
    </a>
    <span class="koboSpan" id="kobo.776.1">
     or library that integrates with
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.777.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.778.1">
     , or explore the usage of that
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.779.1">
      use()
     </span>
    </code>
    <span class="koboSpan" id="kobo.780.1">
     Hook.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.781.1">
     Of course, the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.782.1">
      lazy()
     </span>
    </code>
    <span class="koboSpan" id="kobo.783.1">
     function (and how to use it with
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.784.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.785.1">
     ) was already covered in
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.786.1">
      Chapter 10
     </span>
    </em>
    <span class="koboSpan" id="kobo.787.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.788.1">
      Behind the Scenes of React and Optimization Opportunities
     </span>
    </em>
    <span class="koboSpan" id="kobo.789.1">
     , in the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.790.1">
      Reducing Bundle Sizes via Code Splitting (Lazy Loading)
     </span>
    </em>
    <span class="koboSpan" id="kobo.791.1">
     section.
    </span>
    <span class="koboSpan" id="kobo.791.2">
     But what about the other two options:
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.792.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.793.1">
     -enabled libraries and the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.794.1">
      use()
     </span>
    </code>
    <span class="koboSpan" id="kobo.795.1">
     Hook?
    </span>
   </p>
   <h3 class="heading-3" id="_idParaDest-352">
    <span class="koboSpan" id="kobo.796.1">
     Using Suspense for Data Fetching with Supporting Libraries
    </span>
   </h3>
   <p class="normal">
    <span class="koboSpan" id="kobo.797.1">
     As you learned in the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.798.1">
      Using Suspense for Data Fetching with Next.js
     </span>
    </em>
    <span class="koboSpan" id="kobo.799.1">
     section, you can use
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.800.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.801.1">
     for data fetching when working with Next.js.
    </span>
    <span class="koboSpan" id="kobo.801.2">
     But while Next.js is one of the most
    </span>
    <a id="_idIndexMarker920">
    </a>
    <span class="koboSpan" id="kobo.802.1">
     popular React frameworks that supports
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.803.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.804.1">
     , it’s not the only option you have.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.805.1">
     For example, TanStack Query (formerly
    </span>
    <a id="_idIndexMarker921">
    </a>
    <span class="koboSpan" id="kobo.806.1">
     known as React Query) is another
    </span>
    <a id="_idIndexMarker922">
    </a>
    <span class="koboSpan" id="kobo.807.1">
     popular third-party library that unlocks
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.808.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.809.1">
     for data fetching.
    </span>
    <span class="koboSpan" id="kobo.809.2">
     This library, unlike Next.js, is not a library that aims to help with building full-stack React apps or running code on the server side, though.
    </span>
    <span class="koboSpan" id="kobo.809.3">
     Instead, TanStack Query is a library that’s all about helping with client-side data fetching, data mutations, and asynchronous state management.
    </span>
    <span class="koboSpan" id="kobo.809.4">
     Since it runs on the client side, it therefore works in React projects that do not integrate with SSR and RSCs, too—although you can also use it in such projects.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.810.1">
     TanStack Query is a complex, feature-rich library—we could probably write an entire book about it.
    </span>
    <span class="koboSpan" id="kobo.810.2">
     But the following short code snippet (which is from a Vite-based project, not from a Next.js project) shows how you may fetch data with the help of that library:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.811.1">import</span></span><span class="koboSpan" id="kobo.812.1"> { useSuspenseQuery } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.813.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.814.1">'@tanstack/react-query'</span></span><span class="koboSpan" id="kobo.815.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.816.1">async</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.817.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.818.1">fetchPosts</span></span><span class="koboSpan" id="kobo.819.1">() {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.820.1">await</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.821.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.822.1">Promise</span></span><span class="koboSpan" id="kobo.823.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.824.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.825.1">resolve</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.826.1">) =&gt;</span></span> <span class="hljs-built_in"><span class="koboSpan" id="kobo.827.1">setTimeout</span></span><span class="koboSpan" id="kobo.828.1">(resolve, </span><span class="hljs-number"><span class="koboSpan" id="kobo.829.1">3000</span></span><span class="koboSpan" id="kobo.830.1">));
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.831.1">const</span></span><span class="koboSpan" id="kobo.832.1"> response = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.833.1">await</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.834.1">fetch</span></span><span class="koboSpan" id="kobo.835.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.836.1">'https://jsonplaceholder.typicode.com/posts'</span></span><span class="koboSpan" id="kobo.837.1">);
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.838.1">const</span></span><span class="koboSpan" id="kobo.839.1"> posts = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.840.1">await</span></span><span class="koboSpan" id="kobo.841.1"> response.</span><span class="hljs-title"><span class="koboSpan" id="kobo.842.1">json</span></span><span class="koboSpan" id="kobo.843.1">();
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.844.1">return</span></span><span class="koboSpan" id="kobo.845.1"> posts;
}
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.846.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.847.1">BlogPosts</span></span><span class="koboSpan" id="kobo.848.1">() {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.849.1">const</span></span><span class="koboSpan" id="kobo.850.1"> {data} = </span><span class="hljs-title"><span class="koboSpan" id="kobo.851.1">useSuspenseQuery</span></span><span class="koboSpan" id="kobo.852.1">({
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.853.1">queryKey</span></span><span class="koboSpan" id="kobo.854.1">: [</span><span class="hljs-string"><span class="koboSpan" id="kobo.855.1">'posts'</span></span><span class="koboSpan" id="kobo.856.1">],
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.857.1">queryFn</span></span><span class="koboSpan" id="kobo.858.1">: fetchPosts
  });
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.859.1">return</span></span><span class="koboSpan" id="kobo.860.1"> (
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.861.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.862.1">ul</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.863.1">&gt;</span></span>
<span class="language-xml"><span class="koboSpan" id="kobo.864.1">      {data.map((post) =&gt; (</span></span>
<span class="language-xml">        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.865.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.866.1">li</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.867.1">key</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.868.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.869.1">{post.id}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.870.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.871.1">{post.title}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.872.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.873.1">li</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.874.1">&gt;</span></span>
<span class="language-xml"><span class="koboSpan" id="kobo.875.1">      ))}</span></span>
<span class="language-xml">    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.876.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.877.1">ul</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.878.1">&gt;</span></span><span class="koboSpan" id="kobo.879.1">
  );
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.880.1">
     In this
    </span>
    <a id="_idIndexMarker923">
    </a>
    <span class="koboSpan" id="kobo.881.1">
     example, the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.882.1">
      BlogPosts
     </span>
    </code>
    <span class="koboSpan" id="kobo.883.1">
     component uses TanStack Query’s
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.884.1">
      useSuspenseQuery()
     </span>
    </code>
    <span class="koboSpan" id="kobo.885.1">
     Hook, in conjunction with a custom
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.886.1">
      fetchPosts()
     </span>
    </code>
    <span class="koboSpan" id="kobo.887.1">
     function, to fetch data via an HTTP request.
    </span>
    <span class="koboSpan" id="kobo.887.2">
     As the name of the Hook implies, it integrates with React’s
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.888.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.889.1">
     component.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.890.1">
     As a result, the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.891.1">
      BlogPosts
     </span>
    </code>
    <span class="koboSpan" id="kobo.892.1">
     component can then be wrapped with
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.893.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.894.1">
     like this:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.895.1">import</span></span><span class="koboSpan" id="kobo.896.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.897.1">Suspense</span></span><span class="koboSpan" id="kobo.898.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.899.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.900.1">'react'</span></span><span class="koboSpan" id="kobo.901.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.902.1">import</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.903.1">BlogPosts</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.904.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.905.1">'./components/BlogPosts.jsx'</span></span><span class="koboSpan" id="kobo.906.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.907.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.908.1">App</span></span><span class="koboSpan" id="kobo.909.1">() {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.910.1">return</span></span><span class="koboSpan" id="kobo.911.1"> (
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.912.1">&lt;&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.913.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.914.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.915.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.916.1">All posts</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.917.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.918.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.919.1">&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.920.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.921.1">Suspense</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.922.1">fallback</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.923.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.924.1">{</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.925.1">&lt;</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.926.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.927.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.928.1">Fetching blog posts...</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.929.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.930.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.931.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.932.1">}&gt;</span></span>
<span class="language-xml">        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.933.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.934.1">BlogPosts</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.935.1"> /&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.936.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.937.1">Suspense</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.938.1">&gt;</span></span>
<span class="language-xml">    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.939.1">&lt;/&gt;</span></span><span class="koboSpan" id="kobo.940.1">
  );
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.941.1">
     As you can tell,
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.942.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.943.1">
     is used in the same way it was used with
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.944.1">
      lazy()
     </span>
    </code>
    <span class="koboSpan" id="kobo.945.1">
     or Next.js.
    </span>
    <span class="koboSpan" id="kobo.945.2">
     So, its functionality and usage don’t change—if you’re wrapping it around a component that integrates with
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.946.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.947.1">
     (like
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.948.1">
      BlogPost
     </span>
    </code>
    <span class="koboSpan" id="kobo.949.1">
     does, via TanStack Query’s
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.950.1">
      useSuspenseQuery()
     </span>
    </code>
    <span class="koboSpan" id="kobo.951.1">
     Hook),
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.952.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.953.1">
     can be used to output some fallback content while some data fetching process is underway.
    </span>
   </p>
   <div class="note">
    <p class="normal">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.954.1">
       Note
      </span>
     </strong>
    </p>
    <p class="normal">
     <span class="koboSpan" id="kobo.955.1">
      You can find the complete example project on GitHub:
     </span>
     <a href="https://github.com/mschwarzmueller/book-react-key-concepts-e2/tree/17-suspense-use/examples/05-tanstack-query">
      <span class="url">
       <span class="koboSpan" id="kobo.956.1">
        https://github.com/mschwarzmueller/book-react-key-concepts-e2/tree/17-suspense-use/examples/05-tanstack-query
       </span>
      </span>
     </a>
     <span class="koboSpan" id="kobo.957.1">
      .
     </span>
    </p>
   </div>
   <p class="normal">
    <span class="koboSpan" id="kobo.958.1">
     Of course, this is just a simple example.
    </span>
    <span class="koboSpan" id="kobo.958.2">
     You can do more with TanStack Query, and there
    </span>
    <a id="_idIndexMarker924">
    </a>
    <span class="koboSpan" id="kobo.959.1">
     also are other libraries that can be used in conjunction with
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.960.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.961.1">
     .
    </span>
    <span class="koboSpan" id="kobo.961.2">
     It’s just important to understand that there are other options than Next.js.
    </span>
    <span class="koboSpan" id="kobo.961.3">
     But it’s also crucial to keep in mind that not all code (and also not all libraries) will work with
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.962.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.963.1">
     .
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.964.1">
     Besides using libraries that directly integrate with
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.965.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.966.1">
     (like TanStack Query via its
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.967.1">
      useSuspenseQuery()
     </span>
    </code>
    <span class="koboSpan" id="kobo.968.1">
     Hook), you can also use
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.969.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.970.1">
     for data fetching with the help of React’s built-in
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.971.1">
      use()
     </span>
    </code>
    <span class="koboSpan" id="kobo.972.1">
     Hook.
    </span>
   </p>
   <h3 class="heading-3" id="_idParaDest-353">
    <span class="koboSpan" id="kobo.973.1">
     use()ing Data while Rendering
    </span>
   </h3>
   <p class="normal">
    <span class="koboSpan" id="kobo.974.1">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.975.1">
      use()
     </span>
    </code>
    <span class="koboSpan" id="kobo.976.1">
     Hook offered by React is not limited to accessing context values, as shown in
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.977.1">
      Chapter 11
     </span>
    </em>
    <span class="koboSpan" id="kobo.978.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.979.1">
      Working with Complex State
     </span>
    </em>
    <span class="koboSpan" id="kobo.980.1">
     —instead, it may also be used to read values from a promise.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.981.1">
     Thus, you can
    </span>
    <a id="_idIndexMarker925">
    </a>
    <span class="koboSpan" id="kobo.982.1">
     use the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.983.1">
      use()
     </span>
    </code>
    <span class="koboSpan" id="kobo.984.1">
     Hook during a component’s
    </span>
    <a id="_idIndexMarker926">
    </a>
    <span class="koboSpan" id="kobo.985.1">
     rendering process to extract and use the value of a promise.
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.986.1">
      use()
     </span>
    </code>
    <span class="koboSpan" id="kobo.987.1">
     will automatically interact with any wrapping
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.988.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.989.1">
     component and let it know about the current status of the data fetching process (i.e., if the promise has been resolved or not).
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.990.1">
     The example from the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.991.1">
      Fetching Data while Rendering—the Incorrect Way
     </span>
    </em>
    <span class="koboSpan" id="kobo.992.1">
     section can therefore be adjusted to use the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.993.1">
      use()
     </span>
    </code>
    <span class="koboSpan" id="kobo.994.1">
     Hook like this:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.995.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.996.1"> { use } </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.997.1">from</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.998.1">'react'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.999.1">;</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1000.1">async</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1001.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1002.1">fetchPosts</span></span><span class="koboSpan" id="kobo.1003.1">() {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1004.1">await</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1005.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1006.1">Promise</span></span><span class="koboSpan" id="kobo.1007.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.1008.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1009.1">resolve</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1010.1">) =&gt;</span></span> <span class="hljs-built_in"><span class="koboSpan" id="kobo.1011.1">setTimeout</span></span><span class="koboSpan" id="kobo.1012.1">(resolve, </span><span class="hljs-number"><span class="koboSpan" id="kobo.1013.1">3000</span></span><span class="koboSpan" id="kobo.1014.1">));
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1015.1">const</span></span><span class="koboSpan" id="kobo.1016.1"> response = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1017.1">await</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1018.1">fetch</span></span><span class="koboSpan" id="kobo.1019.1">(
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.1020.1">'https://jsonplaceholder.typicode.com/posts'</span></span><span class="koboSpan" id="kobo.1021.1">
  );
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1022.1">const</span></span><span class="koboSpan" id="kobo.1023.1"> posts = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1024.1">await</span></span><span class="koboSpan" id="kobo.1025.1"> response.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1026.1">json</span></span><span class="koboSpan" id="kobo.1027.1">();
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1028.1">return</span></span><span class="koboSpan" id="kobo.1029.1"> posts;
}
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1030.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1031.1">BlogPosts</span></span><span class="koboSpan" id="kobo.1032.1">() {
  </span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1033.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1034.1"> posts = </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1035.1">use</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1036.1">(</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1037.1">fetchPosts</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1038.1">());</span></strong></span>
  <span class="hljs-keyword"><span class="koboSpan" id="kobo.1039.1">return</span></span><span class="koboSpan" id="kobo.1040.1"> (
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1041.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1042.1">ul</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1043.1">&gt;</span></span>
<span class="language-xml"><span class="koboSpan" id="kobo.1044.1">      {posts.map((post) =&gt; (</span></span>
<span class="language-xml">        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1045.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1046.1">li</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1047.1">key</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1048.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1049.1">{post.id}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1050.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.1051.1">{post.title}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1052.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1053.1">li</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1054.1">&gt;</span></span>
<span class="language-xml"><span class="koboSpan" id="kobo.1055.1">      ))}</span></span>
<span class="language-xml">    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1056.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1057.1">ul</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1058.1">&gt;</span></span><span class="koboSpan" id="kobo.1059.1">
  );
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1060.1">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1061.1">
      BlogPosts
     </span>
    </code>
    <span class="koboSpan" id="kobo.1062.1">
     component is now no longer a component that uses
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1063.1">
      async/await
     </span>
    </code>
    <span class="koboSpan" id="kobo.1064.1">
     .
    </span>
    <span class="koboSpan" id="kobo.1064.2">
     Instead, it uses
    </span>
    <a id="_idIndexMarker927">
    </a>
    <span class="koboSpan" id="kobo.1065.1">
     the imported
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1066.1">
      use()
     </span>
    </code>
    <span class="koboSpan" id="kobo.1067.1">
     Hook to read the value of the promise produced
    </span>
    <a id="_idIndexMarker928">
    </a>
    <span class="koboSpan" id="kobo.1068.1">
     by calling
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1069.1">
      fetchPosts()
     </span>
    </code>
    <span class="koboSpan" id="kobo.1070.1">
     .
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1071.1">
     As mentioned,
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1072.1">
      use()
     </span>
    </code>
    <span class="koboSpan" id="kobo.1073.1">
     interacts with
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1074.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.1075.1">
     , hence
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1076.1">
      BlogPosts
     </span>
    </code>
    <span class="koboSpan" id="kobo.1077.1">
     can be wrapped with
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1078.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.1079.1">
     like this:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1080.1">import</span></span><span class="koboSpan" id="kobo.1081.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.1082.1">Suspense</span></span><span class="koboSpan" id="kobo.1083.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1084.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1085.1">'react'</span></span><span class="koboSpan" id="kobo.1086.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1087.1">import</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1088.1">BlogPosts</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1089.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1090.1">'./components/BlogPosts.jsx'</span></span><span class="koboSpan" id="kobo.1091.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1092.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1093.1">App</span></span><span class="koboSpan" id="kobo.1094.1">() {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1095.1">return</span></span><span class="koboSpan" id="kobo.1096.1"> (
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1097.1">&lt;&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1098.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1099.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1100.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.1101.1">All posts</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1102.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1103.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1104.1">&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1105.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1106.1">Suspense</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1107.1">fallback</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1108.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1109.1">{</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1110.1">&lt;</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1111.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1112.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.1113.1">Fetching blog posts...</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1114.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1115.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1116.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.1117.1">}&gt;</span></span>
<span class="language-xml">        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1118.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1119.1">BlogPosts</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1120.1"> /&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1121.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1122.1">Suspense</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1123.1">&gt;</span></span>
<span class="language-xml">    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1124.1">&lt;/&gt;</span></span><span class="koboSpan" id="kobo.1125.1">
  );
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1126.1">
     When running this code, it might work as intended (depending on the React version you’re using), but it’s more likely to not yield any results or even show an error message in the browser developer tools:
    </span>
   </p>
   <figure class="mediaobject">
    <span class="koboSpan" id="kobo.1127.1">
     <img alt="A close-up of a computer error  Description automatically generated" src="image/B31339_17_04.png"/>
    </span>
   </figure>
   <p class="packt_figref">
    <span class="koboSpan" id="kobo.1128.1">
     Figure 17.4: The use() Hook only works with promises created by Suspense-compatible libraries
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1129.1">
     As explained
    </span>
    <a id="_idIndexMarker929">
    </a>
    <span class="koboSpan" id="kobo.1130.1">
     by this error message, the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1131.1">
      use()
     </span>
    </code>
    <span class="koboSpan" id="kobo.1132.1">
     Hook is
    </span>
    <a id="_idIndexMarker930">
    </a>
    <span class="koboSpan" id="kobo.1133.1">
     not intended to be used with regular promises as created in the previous example.
    </span>
    <span class="koboSpan" id="kobo.1133.2">
     Instead, it should be used on promises that are provided by
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1134.1">
      Suspense-compatible
     </span>
    </em>
    <span class="koboSpan" id="kobo.1135.1">
     libraries or frameworks.
    </span>
   </p>
   <div class="note">
    <p class="normal">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1136.1">
       Note
      </span>
     </strong>
    </p>
    <p class="normal">
     <span class="koboSpan" id="kobo.1137.1">
      If you want to go against the official recommendation and try to build promises that support
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1138.1">
       use()
      </span>
     </code>
     <span class="koboSpan" id="kobo.1139.1">
      and
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1140.1">
       Suspense
      </span>
     </code>
     <span class="koboSpan" id="kobo.1141.1">
      , you can explore the official
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1142.1">
       Suspense
      </span>
     </code>
     <span class="koboSpan" id="kobo.1143.1">
      demo projects linked in the official React documentation (
     </span>
     <a href="https://19.react.dev/reference/react/Suspense">
      <span class="url">
       <span class="koboSpan" id="kobo.1144.1">
        https://19.react.dev/reference/react/Suspense
       </span>
      </span>
     </a>
     <span class="koboSpan" id="kobo.1145.1">
      )—for example, this project:
     </span>
     <a href="https://codesandbox.io/p/sandbox/strange-black-6j7nnj">
      <span class="url">
       <span class="koboSpan" id="kobo.1146.1">
        https://codesandbox.io/p/sandbox/strange-black-6j7nnj
       </span>
      </span>
     </a>
     <span class="koboSpan" id="kobo.1147.1">
      .
     </span>
    </p>
    <p class="normal">
     <span class="koboSpan" id="kobo.1148.1">
      Please note that, as mentioned in the documentation, the approach used in that demo project uses unstable APIs and may not work with future React versions.
     </span>
    </p>
   </div>
   <p class="normal">
    <span class="koboSpan" id="kobo.1149.1">
     So, again, support from a third-party framework or library is needed.
    </span>
    <span class="koboSpan" id="kobo.1149.2">
     No matter if you try to use
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1150.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.1151.1">
     with components that fetch data as part of the rendering process with or without
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1152.1">
      use()
     </span>
    </code>
    <span class="koboSpan" id="kobo.1153.1">
     , you end up needing help.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1154.1">
     Put in other words: to take advantage of
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1155.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.1156.1">
     , you either need to directly fetch data via a Suspense-compatible library or framework, or you need to use the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1157.1">
      use()
     </span>
    </code>
    <span class="koboSpan" id="kobo.1158.1">
     Hook on a promise that’s generated by a Suspense-compatible library or framework.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1159.1">
     One such framework is, again, Next.js.
    </span>
    <span class="koboSpan" id="kobo.1159.2">
     Besides using
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1160.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.1161.1">
     around RSCs, as shown in the section
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1162.1">
      Using suspense for Data Fetching with Next.js
     </span>
    </em>
    <span class="koboSpan" id="kobo.1163.1">
     , you can also use
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1164.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.1165.1">
     in conjunction with the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1166.1">
      use()
     </span>
    </code>
    <span class="koboSpan" id="kobo.1167.1">
     Hook on promises produced by Next.js.
    </span>
   </p>
   <h4 class="heading-4">
    <span class="koboSpan" id="kobo.1168.1">
     Using use() with Promises Created by Next.js
    </span>
   </h4>
   <p class="normal">
    <span class="koboSpan" id="kobo.1169.1">
     Next.js projects are able to create promises that will work with
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1170.1">
      use()
     </span>
    </code>
    <span class="koboSpan" id="kobo.1171.1">
     and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1172.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.1173.1">
     .
    </span>
    <span class="koboSpan" id="kobo.1173.2">
     To be precise, any
    </span>
    <a id="_idIndexMarker931">
    </a>
    <span class="koboSpan" id="kobo.1174.1">
     promise you create in an RSC and pass to a (client) component via props qualifies as a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1175.1">
      use()
     </span>
    </code>
    <span class="koboSpan" id="kobo.1176.1">
     able promise.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1177.1">
     Consider this example code:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1178.1">import</span></span><span class="koboSpan" id="kobo.1179.1"> fs </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1180.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1181.1">'node:fs/promises'</span></span><span class="koboSpan" id="kobo.1182.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1183.1">import</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1184.1">UserGoals</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1185.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1186.1">'../../components/UserGoals'</span></span><span class="koboSpan" id="kobo.1187.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1188.1">async</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1189.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1190.1">fetchGoals</span></span><span class="koboSpan" id="kobo.1191.1">() {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1192.1">await</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1193.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1194.1">Promise</span></span><span class="koboSpan" id="kobo.1195.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.1196.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1197.1">resolve</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1198.1">) =&gt;</span></span> <span class="hljs-built_in"><span class="koboSpan" id="kobo.1199.1">setTimeout</span></span><span class="koboSpan" id="kobo.1200.1">(resolve, </span><span class="hljs-number"><span class="koboSpan" id="kobo.1201.1">3000</span></span><span class="koboSpan" id="kobo.1202.1">)); </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1203.1">// delay</span></span>
  <span class="hljs-keyword"><span class="koboSpan" id="kobo.1204.1">const</span></span><span class="koboSpan" id="kobo.1205.1"> goals = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1206.1">await</span></span><span class="koboSpan" id="kobo.1207.1"> fs.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1208.1">readFile</span></span><span class="koboSpan" id="kobo.1209.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1210.1">'./data/user-goals.json'</span></span><span class="koboSpan" id="kobo.1211.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.1212.1">'utf-8'</span></span><span class="koboSpan" id="kobo.1213.1">);
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1214.1">return</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1215.1">JSON</span></span><span class="koboSpan" id="kobo.1216.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1217.1">parse</span></span><span class="koboSpan" id="kobo.1218.1">(goals);
}
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1219.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1220.1">default</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1221.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1222.1">GoalsPage</span></span><span class="koboSpan" id="kobo.1223.1">() {
  </span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1224.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1225.1"> fetchGoalsPromise = </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1226.1">fetchGoals</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1227.1">();</span></strong></span>
  <span class="hljs-keyword"><span class="koboSpan" id="kobo.1228.1">return</span></span><span class="koboSpan" id="kobo.1229.1"> (
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1230.1">&lt;&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1231.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1232.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1233.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.1234.1">Top User Goals</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1235.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1236.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1237.1">&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1238.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1239.1">UserGoals</span></span><span class="hljs-tag"> </span><span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1240.1">promise</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1241.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1242.1">{fetchGoalsPromise}</span></strong></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1243.1"> /&gt;</span></span>
<span class="language-xml">    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1244.1">&lt;/&gt;</span></span><span class="koboSpan" id="kobo.1245.1">
  );
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1246.1">
     In this code snippet, a promise is created by calling
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1247.1">
      fetchGoals()
     </span>
    </code>
    <span class="koboSpan" id="kobo.1248.1">
     and stored in a constant called
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1249.1">
      fetchGoalsPromise
     </span>
    </code>
    <span class="koboSpan" id="kobo.1250.1">
     .
    </span>
    <span class="koboSpan" id="kobo.1250.2">
     The created promise (
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1251.1">
      fetchGoalsPromise
     </span>
    </code>
    <span class="koboSpan" id="kobo.1252.1">
     ) is then passed as a value for the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1253.1">
      promise
     </span>
    </code>
    <span class="koboSpan" id="kobo.1254.1">
     prop to the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1255.1">
      UserGoals
     </span>
    </code>
    <span class="koboSpan" id="kobo.1256.1">
     component.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1257.1">
     Along with another component, this
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1258.1">
      UserGoals
     </span>
    </code>
    <span class="koboSpan" id="kobo.1259.1">
     component is defined in the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1260.1">
      UserGoals.js
     </span>
    </code>
    <span class="koboSpan" id="kobo.1261.1">
     file like this:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1262.1">import</span></span><span class="koboSpan" id="kobo.1263.1"> { use, </span><span class="hljs-title"><span class="koboSpan" id="kobo.1264.1">Suspense</span></span><span class="koboSpan" id="kobo.1265.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1266.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1267.1">'react'</span></span><span class="koboSpan" id="kobo.1268.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1269.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1270.1">Goals</span></span><span class="koboSpan" id="kobo.1271.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.1272.1">{ fetchGoalsPromise }</span></span><span class="koboSpan" id="kobo.1273.1">) {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1274.1">const</span></span><span class="koboSpan" id="kobo.1275.1"> goals = </span><span class="hljs-title"><span class="koboSpan" id="kobo.1276.1">use</span></span><span class="koboSpan" id="kobo.1277.1">(fetchGoalsPromise);
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1278.1">return</span></span><span class="koboSpan" id="kobo.1279.1"> (
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1280.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1281.1">ul</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1282.1">&gt;</span></span>
<span class="language-xml"><span class="koboSpan" id="kobo.1283.1">      {goals.map((goal) =&gt; (</span></span>
<span class="language-xml">        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1284.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1285.1">li</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1286.1">key</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1287.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1288.1">{goal}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1289.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.1290.1">{goal}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1291.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1292.1">li</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1293.1">&gt;</span></span>
<span class="language-xml"><span class="koboSpan" id="kobo.1294.1">      ))}</span></span>
<span class="language-xml">    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1295.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1296.1">ul</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1297.1">&gt;</span></span><span class="koboSpan" id="kobo.1298.1">
  );
}
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1299.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1300.1">default</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1301.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1302.1">UserGoals</span></span><span class="koboSpan" id="kobo.1303.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.1304.1">{ promise }</span></span><span class="koboSpan" id="kobo.1305.1">) {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1306.1">return</span></span><span class="koboSpan" id="kobo.1307.1"> (
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1308.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1309.1">Suspense</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1310.1">fallback</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1311.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1312.1">{</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1313.1">&lt;</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1314.1">p</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1315.1">id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1316.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1317.1">"fallback"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1318.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.1319.1">Fetching user goals...</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1320.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1321.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1322.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.1323.1">}&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1324.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1325.1">Goals</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1326.1">fetchGoalsPromise</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1327.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1328.1">{promise}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1329.1"> /&gt;</span></span>
<span class="language-xml">    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1330.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1331.1">Suspense</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1332.1">&gt;</span></span><span class="koboSpan" id="kobo.1333.1">
  );
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1334.1">
     In this code example, the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1335.1">
      UserGoals
     </span>
    </code>
    <span class="koboSpan" id="kobo.1336.1">
     component uses
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1337.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.1338.1">
     to wrap the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1339.1">
      Goals
     </span>
    </code>
    <span class="koboSpan" id="kobo.1340.1">
     component
    </span>
    <a id="_idIndexMarker932">
    </a>
    <span class="koboSpan" id="kobo.1341.1">
     to which it essentially forwards the received
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1342.1">
      promise
     </span>
    </code>
    <span class="koboSpan" id="kobo.1343.1">
     prop value (via the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1344.1">
      fetchGoalsPromise
     </span>
    </code>
    <span class="koboSpan" id="kobo.1345.1">
     prop).
    </span>
    <span class="koboSpan" id="kobo.1345.2">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1346.1">
      Goals
     </span>
    </code>
    <span class="koboSpan" id="kobo.1347.1">
     component then reads that promise value via the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1348.1">
      use()
     </span>
    </code>
    <span class="koboSpan" id="kobo.1349.1">
     Hook.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1350.1">
     Since the promise is created in an RSC (
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1351.1">
      GoalsPage
     </span>
    </code>
    <span class="koboSpan" id="kobo.1352.1">
     ) that’s managed by Next.js, React will not complain about this code—Next.js creates promises that work with
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1353.1">
      use()
     </span>
    </code>
    <span class="koboSpan" id="kobo.1354.1">
     .
    </span>
    <span class="koboSpan" id="kobo.1354.2">
     Instead, it will show the fallback content (
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1355.1">
      &lt;p id="fallback"&gt;Fetching user goals...&lt;/p&gt;
     </span>
    </code>
    <span class="koboSpan" id="kobo.1356.1">
     ) while data is being fetched and renders the final user interface once the data has arrived and has been streamed to the client.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1357.1">
     As explained before, any elements not wrapped by Suspense (i.e., the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1358.1">
      &lt;h1&gt;
     </span>
    </code>
    <span class="koboSpan" id="kobo.1359.1">
     element, in this example) will be displayed right from the start.
    </span>
   </p>
   <figure class="mediaobject">
    <span class="koboSpan" id="kobo.1360.1">
     <img alt="A screen shot of a computer screen  Description automatically generated" src="image/B31339_17_05.png"/>
    </span>
   </figure>
   <p class="packt_figref">
    <span class="koboSpan" id="kobo.1361.1">
     Figure 17.5: The fallback text is shown next to the title while data is fetched via use()
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1362.1">
     It’s also
    </span>
    <a id="_idIndexMarker933">
    </a>
    <span class="koboSpan" id="kobo.1363.1">
     worth noting that both
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1364.1">
      UserGoals
     </span>
    </code>
    <span class="koboSpan" id="kobo.1365.1">
     and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1366.1">
      Goals
     </span>
    </code>
    <span class="koboSpan" id="kobo.1367.1">
     are RSCs, too—nonetheless, they can use the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1368.1">
      use()
     </span>
    </code>
    <span class="koboSpan" id="kobo.1369.1">
     Hook.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1370.1">
     Normally, Hooks can’t be used in RSCs but the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1371.1">
      use()
     </span>
    </code>
    <span class="koboSpan" id="kobo.1372.1">
     Hook is special.
    </span>
    <span class="koboSpan" id="kobo.1372.2">
     Just as it may be used inside
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1373.1">
      if
     </span>
    </code>
    <span class="koboSpan" id="kobo.1374.1">
     statements or loops (as explained in
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1375.1">
      Chapter 11
     </span>
    </em>
    <span class="koboSpan" id="kobo.1376.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1377.1">
      Working with Complex State
     </span>
    </em>
    <span class="koboSpan" id="kobo.1378.1">
     ), it can be executed in both server and client components.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1379.1">
     However, when working with a server component, you can also simply use
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1380.1">
      async/await
     </span>
    </code>
    <span class="koboSpan" id="kobo.1381.1">
     instead of
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1382.1">
      use()
     </span>
    </code>
    <span class="koboSpan" id="kobo.1383.1">
     .
    </span>
    <span class="koboSpan" id="kobo.1383.2">
     Thus, the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1384.1">
      use()
     </span>
    </code>
    <span class="koboSpan" id="kobo.1385.1">
     Hook is really only useful when it comes to reading promise values in client components—there,
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1386.1">
      async/await
     </span>
    </code>
    <span class="koboSpan" id="kobo.1387.1">
     is not available.
    </span>
   </p>
   <h4 class="heading-4">
    <span class="koboSpan" id="kobo.1388.1">
     Using use() in Client Components
    </span>
   </h4>
   <p class="normal">
    <span class="koboSpan" id="kobo.1389.1">
     Besides using it for accessing context, the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1390.1">
      use()
     </span>
    </code>
    <span class="koboSpan" id="kobo.1391.1">
     Hook was introduced to help with reading
    </span>
    <a id="_idIndexMarker934">
    </a>
    <span class="koboSpan" id="kobo.1392.1">
     values from promises in client components—i.e., in situations where you can’t use
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1393.1">
      async/await
     </span>
    </code>
    <span class="koboSpan" id="kobo.1394.1">
     .
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1395.1">
     Consider this updated
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1396.1">
      user goals
     </span>
    </em>
    <span class="koboSpan" id="kobo.1397.1">
     example, where some state is managed and a side effect is triggered:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1398.1">'use client'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1399.1">;</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1400.1">import</span></span><span class="koboSpan" id="kobo.1401.1"> { use, </span><span class="hljs-title"><span class="koboSpan" id="kobo.1402.1">Suspense</span></span><span class="koboSpan" id="kobo.1403.1">, </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1404.1">useEffect,</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1405.1">useState</span></strong></span><span class="koboSpan" id="kobo.1406.1">  } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1407.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1408.1">'react'</span></span><span class="koboSpan" id="kobo.1409.1">;
</span><span class="hljs-comment"><span class="koboSpan" id="kobo.1410.1">// sendAnalytics() is a dummy function that just logs to the console</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1411.1">import</span></span><span class="koboSpan" id="kobo.1412.1"> { sendAnalytics } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1413.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1414.1">'../lib/analytics'</span></span><span class="koboSpan" id="kobo.1415.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1416.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1417.1">Goals</span></span><span class="koboSpan" id="kobo.1418.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.1419.1">{ fetchGoalsPromise }</span></span><span class="koboSpan" id="kobo.1420.1">) {
  </span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1421.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1422.1"> [mainGoal, setMainGoal] = </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1423.1">useState</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1424.1">();</span></strong></span>
  <span class="hljs-keyword"><span class="koboSpan" id="kobo.1425.1">const</span></span><span class="koboSpan" id="kobo.1426.1"> goals = </span><span class="hljs-title"><span class="koboSpan" id="kobo.1427.1">use</span></span><span class="koboSpan" id="kobo.1428.1">(fetchGoalsPromise);
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1429.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1430.1">handleSetMainGoal</span></span><span class="koboSpan" id="kobo.1431.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.1432.1">goal</span></span><span class="koboSpan" id="kobo.1433.1">) {
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1434.1">setMainGoal</span></span><span class="koboSpan" id="kobo.1435.1">(goal);
  }
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1436.1">return</span></span><span class="koboSpan" id="kobo.1437.1"> (
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1438.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1439.1">ul</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1440.1">&gt;</span></span>
<span class="language-xml"><span class="koboSpan" id="kobo.1441.1">      {goals.map((goal) =&gt; (</span></span>
<span class="language-xml">        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1442.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1443.1">li</span></span>
<span class="hljs-tag">          </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1444.1">key</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1445.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1446.1">{goal}</span></span>
<span class="hljs-tag">          </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1447.1">id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1448.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1449.1">{goal</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1450.1"> === </span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1451.1">mainGoal</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1452.1"> ? </span><span class="koboSpan" id="kobo.1452.2">'</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1453.1">main-goal</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1454.1">' </span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1455.1">:</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1456.1">undefined</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1457.1">}</span></span>
<span class="hljs-tag">          </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1458.1">onClick</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1459.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1460.1">{()</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1461.1"> =&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.1462.1"> handleSetMainGoal(goal)}</span></span>
<span class="language-xml"><span class="koboSpan" id="kobo.1463.1">        &gt;</span></span>
<span class="language-xml"><span class="koboSpan" id="kobo.1464.1">          {goal}</span></span>
<span class="language-xml">        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1465.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1466.1">li</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1467.1">&gt;</span></span>
<span class="language-xml"><span class="koboSpan" id="kobo.1468.1">      ))}</span></span>
<span class="language-xml">    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1469.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1470.1">ul</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1471.1">&gt;</span></span><span class="koboSpan" id="kobo.1472.1">
  );
}
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1473.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1474.1">default</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1475.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1476.1">UserGoals</span></span><span class="koboSpan" id="kobo.1477.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.1478.1">{ promise }</span></span><span class="koboSpan" id="kobo.1479.1">) {
  </span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1480.1">useEffect</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1481.1">(</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1482.1">() =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1483.1"> {</span></strong></span>
    <span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1484.1">sendAnalytics</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1485.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1486.1">'user-goals-loaded'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1487.1">, navigator.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1488.1">userAgent</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1489.1">);</span></strong></span>
  <span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1490.1">}, []);</span></strong></span>
  <span class="hljs-keyword"><span class="koboSpan" id="kobo.1491.1">return</span></span><span class="koboSpan" id="kobo.1492.1"> (
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1493.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1494.1">Suspense</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1495.1">fallback</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1496.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1497.1">{</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1498.1">&lt;</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1499.1">p</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1500.1">id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1501.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1502.1">"fallback"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1503.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.1504.1">Fetching user goals...</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1505.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1506.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1507.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.1508.1">}&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1509.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1510.1">Goals</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1511.1">fetchGoalsPromise</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1512.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1513.1">{promise}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1514.1"> /&gt;</span></span>
<span class="language-xml">    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1515.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1516.1">Suspense</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1517.1">&gt;</span></span><span class="koboSpan" id="kobo.1518.1">
  );
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1519.1">
     In this example, the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1520.1">
      Goals
     </span>
    </code>
    <span class="koboSpan" id="kobo.1521.1">
     component uses
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1522.1">
      useState()
     </span>
    </code>
    <span class="koboSpan" id="kobo.1523.1">
     to manage the information of which goal was marked as the main goal by the user.
    </span>
    <span class="koboSpan" id="kobo.1523.2">
     Furthermore, the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1524.1">
      UserGoals
     </span>
    </code>
    <span class="koboSpan" id="kobo.1525.1">
     component (which uses
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1526.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.1527.1">
     ) utilizes the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1528.1">
      useEffect()
     </span>
    </code>
    <span class="koboSpan" id="kobo.1529.1">
     Hook to send an analytics event once the component renders (i.e., before the suspended
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1530.1">
      Goals
     </span>
    </code>
    <span class="koboSpan" id="kobo.1531.1">
     component is displayed).
    </span>
    <span class="koboSpan" id="kobo.1531.2">
     Due to the usage of all these client-side exclusive features, the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1532.1">
      '
     </span>
    </code>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1533.1">
      use client'
     </span>
    </code>
    <span class="koboSpan" id="kobo.1534.1">
     directive is required.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1535.1">
     As a result,
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1536.1">
      async/await
     </span>
    </code>
    <span class="koboSpan" id="kobo.1537.1">
     can’t be used in the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1538.1">
      Goals
     </span>
    </code>
    <span class="koboSpan" id="kobo.1539.1">
     and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1540.1">
      UserGoals
     </span>
    </code>
    <span class="koboSpan" id="kobo.1541.1">
     components.
    </span>
    <span class="koboSpan" id="kobo.1541.2">
     But since the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1542.1">
      use()
     </span>
    </code>
    <span class="koboSpan" id="kobo.1543.1">
     Hook can be used in client components, it offers a possible solution for situations like this.
    </span>
    <span class="koboSpan" id="kobo.1543.2">
     And, since this example is from a Next.js application, React will not complain
    </span>
    <a id="_idIndexMarker935">
    </a>
    <span class="koboSpan" id="kobo.1544.1">
     about the kind of promise being consumed by
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1545.1">
      use()
     </span>
    </code>
    <span class="koboSpan" id="kobo.1546.1">
     .
    </span>
    <span class="koboSpan" id="kobo.1546.2">
     Instead, this example code would lead to the fallback content being displayed while the goals data is fetched.
    </span>
   </p>
   <h1 class="heading-1" id="_idParaDest-354">
    <span class="koboSpan" id="kobo.1547.1">
     Suspense Usage Patterns
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.1548.1">
     As you have learned, the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1549.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.1550.1">
     component can be wrapped around components that fetch
    </span>
    <a id="_idIndexMarker936">
    </a>
    <span class="koboSpan" id="kobo.1551.1">
     data as part of their rendering process—as long as they do it in a compliant way.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1552.1">
     Of course, in many projects, you may have multiple components that fetch data and that should display some fallback content while doing so.
    </span>
    <span class="koboSpan" id="kobo.1552.2">
     Thankfully, you can use the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1553.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.1554.1">
     component as often as needed—you can even combine multiple
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1555.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.1556.1">
     components with each other.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-355">
    <span class="koboSpan" id="kobo.1557.1">
     Revealing Content Together
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.1558.1">
     Thus far, in all examples,
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1559.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.1560.1">
     was always wrapped around exactly one component.
    </span>
    <span class="koboSpan" id="kobo.1560.2">
     But there
    </span>
    <a id="_idIndexMarker937">
    </a>
    <span class="koboSpan" id="kobo.1561.1">
     is no rule that would stop you from wrapping
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1562.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.1563.1">
     around multiple components.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1564.1">
     For example, the following code is valid:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1565.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1566.1">Shop</span></span><span class="koboSpan" id="kobo.1567.1">() {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1568.1">return</span></span><span class="koboSpan" id="kobo.1569.1"> (
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1570.1">&lt;&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1571.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1572.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1573.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.1574.1">Welcome to our shop!</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1575.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1576.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1577.1">&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1578.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1579.1">Suspense</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1580.1">fallback</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1581.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1582.1">{</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1583.1">&lt;</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1584.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1585.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.1586.1">Fetching shop data...</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1587.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1588.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1589.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.1590.1">}&gt;</span></span>
<span class="language-xml">        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1591.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1592.1">DailyDeal</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1593.1"> /&gt;</span></span>
<span class="language-xml">        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1594.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1595.1">Products</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1596.1"> /&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1597.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1598.1">Suspense</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1599.1">&gt;</span></span>
<span class="language-xml">    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1600.1">&lt;/&gt;</span></span><span class="koboSpan" id="kobo.1601.1">
  );
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1602.1">
     In this code snippet, data fetching in the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1603.1">
      DailyDeal
     </span>
    </code>
    <span class="koboSpan" id="kobo.1604.1">
     and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1605.1">
      Products
     </span>
    </code>
    <span class="koboSpan" id="kobo.1606.1">
     components starts simultaneously.
    </span>
    <span class="koboSpan" id="kobo.1606.2">
     Since both components are wrapped by one single
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1607.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.1608.1">
     component, the fallback content is displayed unti both components are done fetching data.
    </span>
    <span class="koboSpan" id="kobo.1608.2">
     So, if one component (e.g.,
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1609.1">
      DailyDeal
     </span>
    </code>
    <span class="koboSpan" id="kobo.1610.1">
     ) is done after one second, and the other component (
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1611.1">
      Products
     </span>
    </code>
    <span class="koboSpan" id="kobo.1612.1">
     ) takes five seconds, both components are only revealed (and replace the fallback content) after five seconds.
    </span>
   </p>
   <figure class="mediaobject">
    <span class="koboSpan" id="kobo.1613.1">
     <img alt="A screenshot of a computer  Description automatically generated" src="image/B31339_17_06.png"/>
    </span>
   </figure>
   <p class="packt_figref">
    <span class="koboSpan" id="kobo.1614.1">
     Figure 17.6: Data is fetched in parallel, and fallback content is shown via Suspense until all components are done
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-356">
    <span class="koboSpan" id="kobo.1615.1">
     Revealing Content as Soon as Possible
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.1616.1">
     Of course, there are situations where you might want to display fallback content for multiple
    </span>
    <a id="_idIndexMarker938">
    </a>
    <span class="koboSpan" id="kobo.1617.1">
     components, but where you don’t want to wait for all components to finish fetching data before showing any fetched content.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1618.1">
     In such situations, you can use
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1619.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.1620.1">
     multiple times:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1621.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1622.1">Shop</span></span><span class="koboSpan" id="kobo.1623.1">() {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1624.1">return</span></span><span class="koboSpan" id="kobo.1625.1"> (
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1626.1">&lt;&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1627.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1628.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1629.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.1630.1">Welcome to our shop!</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1631.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1632.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1633.1">&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1634.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1635.1">Suspense</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1636.1">fallback</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1637.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1638.1">{</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1639.1">&lt;</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1640.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1641.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.1642.1">Fetching daily deal data...</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1643.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1644.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1645.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.1646.1">}&gt;</span></span>
<span class="language-xml">        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1647.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1648.1">DailyDeal</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1649.1"> /&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1650.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1651.1">Suspense</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1652.1">&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1653.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1654.1">Suspense</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1655.1">fallback</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1656.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1657.1">{</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1658.1">&lt;</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1659.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1660.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.1661.1">Fetching products data...</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1662.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1663.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1664.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.1665.1">}&gt;</span></span>
<span class="language-xml">        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1666.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1667.1">Products</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1668.1"> /&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1669.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1670.1">Suspense</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1671.1">&gt;</span></span>
<span class="language-xml">    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1672.1">&lt;/&gt;</span></span><span class="koboSpan" id="kobo.1673.1">
  );
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1674.1">
     In this adjusted code example,
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1675.1">
      DailyDeal
     </span>
    </code>
    <span class="koboSpan" id="kobo.1676.1">
     and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1677.1">
      Products
     </span>
    </code>
    <span class="koboSpan" id="kobo.1678.1">
     are wrapped with two different instances
    </span>
    <a id="_idIndexMarker939">
    </a>
    <span class="koboSpan" id="kobo.1679.1">
     of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1680.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.1681.1">
     component.
    </span>
    <span class="koboSpan" id="kobo.1681.2">
     Thus, each component’s content will be revealed once available, independent from the other component’s data fetching status.
    </span>
   </p>
   <figure class="mediaobject">
    <span class="koboSpan" id="kobo.1682.1">
     <img alt="A screenshot of a computer  Description automatically generated" src="image/B31339_17_07.png"/>
    </span>
   </figure>
   <p class="packt_figref">
    <span class="koboSpan" id="kobo.1683.1">
     Figure 17.7: Each component replaces its fallback content with the final content once it’s done fetching
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-357">
    <span class="koboSpan" id="kobo.1684.1">
     Nesting Suspended Content
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.1685.1">
     Besides
    </span>
    <a id="_idIndexMarker940">
    </a>
    <span class="koboSpan" id="kobo.1686.1">
     fetching in parallel, you can also create more complex loading sequences with nested
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1687.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.1688.1">
     components.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1689.1">
     Consider this example:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1690.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1691.1">Shop</span></span><span class="koboSpan" id="kobo.1692.1">() {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1693.1">return</span></span><span class="koboSpan" id="kobo.1694.1"> (
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1695.1">&lt;&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1696.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1697.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1698.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.1699.1">Welcome to our shop!</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1700.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1701.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1702.1">&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1703.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1704.1">Suspense</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1705.1">fallback</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1706.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1707.1">{</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1708.1">&lt;</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1709.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1710.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.1711.1">Fetching shop data...</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1712.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1713.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1714.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.1715.1">}&gt;</span></span>
<span class="language-xml">        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1716.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1717.1">DailyDeal</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1718.1"> /&gt;</span></span>
<span class="language-xml">        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1719.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1720.1">Suspense</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1721.1">fallback</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1722.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1723.1">{</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1724.1">&lt;</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1725.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1726.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.1727.1">Fetching products data...</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1728.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1729.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1730.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.1731.1">}&gt;</span></span>
<span class="language-xml">          </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1732.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1733.1">Products</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1734.1"> /&gt;</span></span>
<span class="language-xml">        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1735.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1736.1">Suspense</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1737.1">&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1738.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1739.1">Suspense</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1740.1">&gt;</span></span>
<span class="language-xml">    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1741.1">&lt;/&gt;</span></span><span class="koboSpan" id="kobo.1742.1">
  );
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1743.1">
     In this case, initially, the paragraph with the text
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1744.1">
      Fetching shop data
     </span>
    </code>
    <span class="koboSpan" id="kobo.1745.1">
     is displayed.
    </span>
    <span class="koboSpan" id="kobo.1745.2">
     Behind the scenes, data fetching in the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1746.1">
      DailyDeal
     </span>
    </code>
    <span class="koboSpan" id="kobo.1747.1">
     and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1748.1">
      Products
     </span>
    </code>
    <span class="koboSpan" id="kobo.1749.1">
     components starts.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1750.1">
     Once the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1751.1">
      DailyDeal
     </span>
    </code>
    <span class="koboSpan" id="kobo.1752.1">
     component is done fetching data, its content is displayed.
    </span>
    <span class="koboSpan" id="kobo.1752.2">
     At the same
    </span>
    <a id="_idIndexMarker941">
    </a>
    <span class="koboSpan" id="kobo.1753.1">
     time, below
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1754.1">
      DailyDeal
     </span>
    </code>
    <span class="koboSpan" id="kobo.1755.1">
     , the fallback of the nested
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1756.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.1757.1">
     block is rendered if the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1758.1">
      Products
     </span>
    </code>
    <span class="koboSpan" id="kobo.1759.1">
     component is still fetching data.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1760.1">
     Finally, once
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1761.1">
      Products
     </span>
    </code>
    <span class="koboSpan" id="kobo.1762.1">
     has received its data, the inner
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1763.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.1764.1">
     component’s fallback content is removed, and the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1765.1">
      Products
     </span>
    </code>
    <span class="koboSpan" id="kobo.1766.1">
     component is rendered instead.
    </span>
   </p>
   <figure class="mediaobject">
    <span class="koboSpan" id="kobo.1767.1">
     <img alt="A screenshot of a computer  Description automatically generated" src="image/B31339_17_08.png"/>
    </span>
   </figure>
   <p class="packt_figref">
    <span class="koboSpan" id="kobo.1768.1">
     Figure 17.8: Nested Suspense blocks lead to sequential data fetching and content revelation
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1769.1">
     Therefore, as you can see, you can use
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1770.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.1771.1">
     multiple times.
    </span>
    <span class="koboSpan" id="kobo.1771.2">
     In addition, you can combine different
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1772.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.1773.1">
     components such that you can create exactly the loading sequence and user experience you need.
    </span>
   </p>
   <h1 class="heading-1" id="_idParaDest-358">
    <span class="koboSpan" id="kobo.1774.1">
     Should You Fetch Data via Suspense or useEffect()?
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.1775.1">
     As you learned throughout this chapter, you can use
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1776.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.1777.1">
     in conjunction with RSCs,
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1778.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.1779.1">
     -enabled libraries, or the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1780.1">
      use()
     </span>
    </code>
    <span class="koboSpan" id="kobo.1781.1">
     Hook (which also requires supporting libraries) to fetch
    </span>
    <a id="_idIndexMarker942">
    </a>
    <span class="koboSpan" id="kobo.1782.1">
     data and show some fallback content while data is being fetched.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1783.1">
     Alternatively, as covered in
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1784.1">
      Chapter 11
     </span>
    </em>
    <span class="koboSpan" id="kobo.1785.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1786.1">
      Working with Complex State
     </span>
    </em>
    <span class="koboSpan" id="kobo.1787.1">
     , you can also fetch data and
    </span>
    <a id="_idIndexMarker943">
    </a>
    <span class="koboSpan" id="kobo.1788.1">
     manually show fallback content via
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1789.1">
      useEffect()
     </span>
    </code>
    <span class="koboSpan" id="kobo.1790.1">
     and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1791.1">
      useState()
     </span>
    </code>
    <span class="koboSpan" id="kobo.1792.1">
     or
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1793.1">
      useReducer()
     </span>
    </code>
    <span class="koboSpan" id="kobo.1794.1">
     .
    </span>
    <span class="koboSpan" id="kobo.1794.2">
     In that case, you essentially manage the state that determines whether to show some loading fallback content on your own; with
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1795.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.1796.1">
     , React does that for you.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1797.1">
     Consequently, it’s up to you which approach you prefer.
    </span>
    <span class="koboSpan" id="kobo.1797.2">
     Using
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1798.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.1799.1">
     can save you quite a bit
    </span>
    <a id="_idIndexMarker944">
    </a>
    <span class="koboSpan" id="kobo.1800.1">
     of code since you don’t need to manage
    </span>
    <a id="_idIndexMarker945">
    </a>
    <span class="koboSpan" id="kobo.1801.1">
     these different state slices manually.
    </span>
    <span class="koboSpan" id="kobo.1801.2">
     Combined with frameworks like Next.js or libraries like TanStack Query, data fetching can therefore become significantly easier than when doing it manually via
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1802.1">
      useEffect()
     </span>
    </code>
    <span class="koboSpan" id="kobo.1803.1">
     .
    </span>
    <span class="koboSpan" id="kobo.1803.2">
     In addition,
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1804.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.1805.1">
     integrates with RSCs and SSR and therefore can be used to fetch data on the server side—unlike
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1806.1">
      useEffect()
     </span>
    </code>
    <span class="koboSpan" id="kobo.1807.1">
     , which has no effect (no pun intended) on the server side.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1808.1">
     However, if you’re not using any library or framework that supports
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1809.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.1810.1">
     or
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1811.1">
      use()
     </span>
    </code>
    <span class="koboSpan" id="kobo.1812.1">
     -enabled promises, you don’t have much of a choice other than to fall back to
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1813.1">
      useEffect()
     </span>
    </code>
    <span class="koboSpan" id="kobo.1814.1">
     (and hence not use
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1815.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.1816.1">
     for data fetching).
    </span>
    <span class="koboSpan" id="kobo.1816.2">
     This may change with future React versions, since they might provide tools that help with building promises that work with
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1817.1">
      use()
     </span>
    </code>
    <span class="koboSpan" id="kobo.1818.1">
     .
    </span>
    <span class="koboSpan" id="kobo.1818.2">
     But for the time being, it’s basically a decision between using (the right) libraries and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1819.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.1820.1">
     or no libraries and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1821.1">
      useEffect()
     </span>
    </code>
    <span class="koboSpan" id="kobo.1822.1">
     .
    </span>
   </p>
   <h1 class="heading-1" id="_idParaDest-359">
    <span class="koboSpan" id="kobo.1823.1">
     Summary and Key Takeaways
    </span>
   </h1>
   <ul>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.1824.1">
      The
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1825.1">
       Suspense
      </span>
     </code>
     <span class="koboSpan" id="kobo.1826.1">
      component can be used to show fallback content while data is fetched, or code is downloaded.
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.1827.1">
      For data fetching,
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1828.1">
       Suspense
      </span>
     </code>
     <span class="koboSpan" id="kobo.1829.1">
      only works with components that fetch data via Suspense-enabled data sources during their rendering process.
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.1830.1">
      Libraries and frameworks like TanStack Query and Next.js support using
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1831.1">
       Suspense
      </span>
     </code>
     <span class="koboSpan" id="kobo.1832.1">
      for data fetching.
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.1833.1">
      Using Next.js, you can wrap
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1834.1">
       Suspense
      </span>
     </code>
     <span class="koboSpan" id="kobo.1835.1">
      around server components that use
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1836.1">
       async/await
      </span>
     </code>
     <span class="koboSpan" id="kobo.1837.1">
      .
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.1838.1">
      Alternatively,
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1839.1">
       Suspense
      </span>
     </code>
     <span class="koboSpan" id="kobo.1840.1">
      can be wrapped around components that use React’s
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1841.1">
       use()
      </span>
     </code>
     <span class="koboSpan" id="kobo.1842.1">
      Hook for reading a promise value.
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1843.1">
       use()
      </span>
     </code>
     <span class="koboSpan" id="kobo.1844.1">
      should only be used to read values of promises that resolve with
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1845.1">
       Suspense
      </span>
     </code>
     <span class="koboSpan" id="kobo.1846.1">
      in mind—e.g., promises created by Suspense-compatible third-party libraries.
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.1847.1">
      When using Next.js, promises created in RSCs and passed to (client) components via props may be consumed via
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1848.1">
       use()
      </span>
     </code>
     <span class="koboSpan" id="kobo.1849.1">
      .
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.1850.1">
      The
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1851.1">
       use()
      </span>
     </code>
     <span class="koboSpan" id="kobo.1852.1">
      Hook helps with reading values and using
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1853.1">
       Suspense
      </span>
     </code>
     <span class="koboSpan" id="kobo.1854.1">
      in components that also need to use client-specific features like
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1855.1">
       useState()
      </span>
     </code>
     <span class="koboSpan" id="kobo.1856.1">
      .
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1857.1">
       Suspense
      </span>
     </code>
     <span class="koboSpan" id="kobo.1858.1">
      can be wrapped around as many components as needed to fetch data and display content simultaneously.
     </span>
    </li>
    <li class="bulletList">
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1859.1">
       Suspense
      </span>
     </code>
     <span class="koboSpan" id="kobo.1860.1">
      can also be nested to create complex loading sequences.
     </span>
    </li>
   </ul>
   <h2 class="heading-2" id="_idParaDest-360">
    <span class="koboSpan" id="kobo.1861.1">
     What’s Next?
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.1862.1">
     React’s
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1863.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.1864.1">
     feature can be very useful since it helps with granularly showing fallback content while code or data is being fetched.
    </span>
    <span class="koboSpan" id="kobo.1864.2">
     At the same time, when it comes to data fetching, it can be tricky to use
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1865.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.1866.1">
     since it only works with components that fetch data in the correct way (e.g., via the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1867.1">
      use()
     </span>
    </code>
    <span class="koboSpan" id="kobo.1868.1">
     Hook, if the promise passed to the Hook is
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1869.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.1870.1">
     -compatible).
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1871.1">
     That’s why this chapter also explored how to use
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1872.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.1873.1">
     and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1874.1">
      use()
     </span>
    </code>
    <span class="koboSpan" id="kobo.1875.1">
     with Next.js, and how that framework simplifies the process of fetching data and showing fallback content with
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1876.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.1877.1">
     and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1878.1">
      use()
     </span>
    </code>
    <span class="koboSpan" id="kobo.1879.1">
     .
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1880.1">
     Despite the potential complexity,
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1881.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.1882.1">
     can help with creating great user experiences since it allows you to easily show fallback content while a resource is pending.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1883.1">
     This chapter also concludes the list of core React features you must know about as a React developer.
    </span>
    <span class="koboSpan" id="kobo.1883.2">
     Of course, you can always dive deeper to explore more patterns and third-party libraries.
    </span>
    <span class="koboSpan" id="kobo.1883.3">
     The next (and last) chapter will share some resources and possible next steps you could dive into after finishing this book.
    </span>
   </p>
   <h1 class="heading-1" id="_idParaDest-361">
    <span class="koboSpan" id="kobo.1884.1">
     Test Your Knowledge!
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.1885.1">
     Test your knowledge of the concepts covered in this chapter by answering the following questions.
    </span>
    <span class="koboSpan" id="kobo.1885.2">
     You can then compare your answers to examples that can be found at
    </span>
    <a href="https://github.com/mschwarzmueller/book-react-key-concepts-e2/blob/17-suspense-use/exercises/questions-answers.md">
     <span class="url">
      <span class="koboSpan" id="kobo.1886.1">
       https://github.com/mschwarzmueller/book-react-key-concepts-e2/blob/17-suspense-use/exercises/questions-answers.md
      </span>
     </span>
    </a>
    <span class="koboSpan" id="kobo.1887.1">
     :
    </span>
   </p>
   <ol>
    <li class="numberedList" value="1">
     <span class="koboSpan" id="kobo.1888.1">
      What’s the purpose of React’s
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1889.1">
       Suspense
      </span>
     </code>
     <span class="koboSpan" id="kobo.1890.1">
      component?
     </span>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.1891.1">
      How do components need to fetch data in order to work with
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1892.1">
       Suspense
      </span>
     </code>
     <span class="koboSpan" id="kobo.1893.1">
      ?
     </span>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.1894.1">
      How may
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1895.1">
       Suspense
      </span>
     </code>
     <span class="koboSpan" id="kobo.1896.1">
      be used when working with Next.js?
     </span>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.1897.1">
      What’s the purpose of the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1898.1">
       use()
      </span>
     </code>
     <span class="koboSpan" id="kobo.1899.1">
      Hook?
     </span>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.1900.1">
      Which kind of promises can be read by the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1901.1">
       use()
      </span>
     </code>
     <span class="koboSpan" id="kobo.1902.1">
      Hook?
     </span>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.1903.1">
      List three ways of using
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1904.1">
       Suspense
      </span>
     </code>
     <span class="koboSpan" id="kobo.1905.1">
      with multiple components.
     </span>
    </li>
   </ol>
   <h1 class="heading-1" id="_idParaDest-362">
    <span class="koboSpan" id="kobo.1906.1">
     Apply What You Learned
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.1907.1">
     With all the newly gained knowledge about Next.js, it’s time to apply it to a real demo project.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1908.1">
     In the following section, you’ll find an activity that allows you to practice working with Next.js and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1909.1">
      Suspense
     </span>
    </code>
    <span class="koboSpan" id="kobo.1910.1">
     .
    </span>
    <span class="koboSpan" id="kobo.1910.2">
     As always, you will also need to employ some of the concepts covered in earlier chapters.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-363">
    <span class="koboSpan" id="kobo.1911.1">
     Activity 17.1: Implement Suspense in the Mini Blog
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.1912.1">
     In this activity, your job is to build upon the finished project from
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1913.1">
      Activity 16.1
     </span>
    </em>
    <span class="koboSpan" id="kobo.1914.1">
     .
    </span>
    <span class="koboSpan" id="kobo.1914.2">
     There, a very simple blog was built.
    </span>
    <span class="koboSpan" id="kobo.1914.3">
     Now, your task is to enhance this blog to show some fallback content while the list of blog posts or the details for an individual blog post are loading.
    </span>
    <span class="koboSpan" id="kobo.1914.4">
     To prove your knowledge, you should fetch data via
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1915.1">
      async/await
     </span>
    </code>
    <span class="koboSpan" id="kobo.1916.1">
     on the starting page (
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1917.1">
      /
     </span>
    </code>
    <span class="koboSpan" id="kobo.1918.1">
     ), and via the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1919.1">
      use()
     </span>
    </code>
    <span class="koboSpan" id="kobo.1920.1">
     Hook on the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1921.1">
      blog/&lt;some-id&gt;
     </span>
    </code>
    <span class="koboSpan" id="kobo.1922.1">
     page.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1923.1">
     In addition, the list of available blog posts should also be displayed below the details for a single blog post.
    </span>
    <span class="koboSpan" id="kobo.1923.2">
     Of course, while fetching that list data, some fallback text must be displayed—though, that text should be displayed independently from the fallback content for the blog post details.
    </span>
   </p>
   <div class="note">
    <p class="normal">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1924.1">
       Note
      </span>
     </strong>
    </p>
    <p class="normal">
     <span class="koboSpan" id="kobo.1925.1">
      You can find a starting project snapshot for this activity at
     </span>
     <a href="https://github.com/mschwarzmueller/book-react-key-concepts-e2/tree/17-suspense-use/activities/practice-1-start">
      <span class="url">
       <span class="koboSpan" id="kobo.1926.1">
        https://github.com/mschwarzmueller/book-react-key-concepts-e2/tree/17-suspense-use/activities/practice-1-start
       </span>
      </span>
     </a>
     <span class="koboSpan" id="kobo.1927.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1927.2">
      When downloading this code, you’ll always download the entire repository.
     </span>
     <span class="koboSpan" id="kobo.1927.3">
      Make sure to then navigate to the subfolder with the starting code (
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1928.1">
       activities/practice-1-start
      </span>
     </code>
     <span class="koboSpan" id="kobo.1929.1">
      , in this case) to use the right code snapshot.
     </span>
    </p>
    <p class="normal">
     <span class="koboSpan" id="kobo.1930.1">
      In the provided starting project, you’ll find functions for fetching all blog posts and a single post.
     </span>
     <span class="koboSpan" id="kobo.1930.2">
      These functions contain artificial delays to simulate slow servers.
     </span>
    </p>
   </div>
   <p class="normal">
    <span class="koboSpan" id="kobo.1931.1">
     After downloading the code and running
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1932.1">
      npm install
     </span>
    </code>
    <span class="koboSpan" id="kobo.1933.1">
     in the project folder to install all required dependencies, the solution steps are as follows:
    </span>
   </p>
   <ol>
    <li class="numberedList" value="1">
     <span class="koboSpan" id="kobo.1934.1">
      Outsource the logic for fetching and displaying a list of posts into a separate component.
     </span>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.1935.1">
      Use that component on the starting page and use React’s
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1936.1">
       Suspense
      </span>
     </code>
     <span class="koboSpan" id="kobo.1937.1">
      component to display some fitting fallback content while the blog posts are being fetched.
     </span>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.1938.1">
      Also, outsource the logic for retrieving and rendering the details for a single blog post into a separate client (!) component.
     </span>
     <span class="koboSpan" id="kobo.1938.2">
      Output that newly created component on the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1939.1">
       /blog/&lt;some-id&gt;
      </span>
     </code>
     <span class="koboSpan" id="kobo.1940.1">
      page.
     </span>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.1941.1">
      Pass a promise for fetching the details of a blog to that newly created component, and use the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1942.1">
       use()
      </span>
     </code>
     <span class="koboSpan" id="kobo.1943.1">
      Hook to read its value.
     </span>
     <span class="koboSpan" id="kobo.1943.2">
      Also, take advantage of the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1944.1">
       Suspense
      </span>
     </code>
     <span class="koboSpan" id="kobo.1945.1">
      component to output some fallback content.
     </span>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.1946.1">
      Re-use the component that fetches and renders a list of blog posts and output it below the blog post details on the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1947.1">
       /blog/&lt;some-id&gt;
      </span>
     </code>
     <span class="koboSpan" id="kobo.1948.1">
      page.
     </span>
     <span class="koboSpan" id="kobo.1948.2">
      Use
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1949.1">
       Suspense
      </span>
     </code>
     <span class="koboSpan" id="kobo.1950.1">
      to show some fallback content, independently from the data fetching status of the blog post details.
     </span>
    </li>
   </ol>
   <p class="normal">
    <span class="koboSpan" id="kobo.1951.1">
     The final page should look as shown in the following screenshots:
    </span>
   </p>
   <figure class="mediaobject">
    <span class="koboSpan" id="kobo.1952.1">
     <img alt="img" src="image/B31339_17_09.png"/>
    </span>
   </figure>
   <p class="packt_figref">
    <span class="koboSpan" id="kobo.1953.1">
     Figure 17.9: Fallback content is shown while the blog posts are fetched
    </span>
   </p>
   <figure class="mediaobject">
    <span class="koboSpan" id="kobo.1954.1">
     <img alt="img" src="image/B31339_17_10.png"/>
    </span>
   </figure>
   <p class="packt_figref">
    <span class="koboSpan" id="kobo.1955.1">
     Figure 17.10: Fallback content is shown while fetching blog post details and the list of blog posts
    </span>
   </p>
   <div class="note">
    <p class="normal">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1956.1">
       Note
      </span>
     </strong>
    </p>
    <p class="normal">
     <span class="koboSpan" id="kobo.1957.1">
      You can find the full code for this activity, and an example solution, here:
     </span>
     <a href="https://github.com/mschwarzmueller/book-react-key-concepts-e2/tree/17-suspense-use/activities/practice-1">
      <span class="url">
       <span class="koboSpan" id="kobo.1958.1">
        https://github.com/mschwarzmueller/book-react-key-concepts-e2/tree/17-suspense-use/activities/practice-1
       </span>
      </span>
     </a>
     <span class="koboSpan" id="kobo.1959.1">
      .
     </span>
    </p>
   </div>
  </div>
 </body></html>