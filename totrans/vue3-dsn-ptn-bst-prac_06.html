<html><head></head><body>
<div id="_idContainer048">
<h1 class="chapter-number" id="_idParaDest-122"><a id="_idTextAnchor148"/><span class="koboSpan" id="kobo.1.1">6</span></h1>
<h1 id="_idParaDest-123"><a id="_idTextAnchor149"/><span class="koboSpan" id="kobo.2.1">Progressive Web Applications</span></h1>
<p><span class="koboSpan" id="kobo.3.1">In this chapter, we will see the next evolutionary step for web applications: </span><strong class="bold"><span class="koboSpan" id="kobo.4.1">progressive web applications</span></strong><span class="koboSpan" id="kobo.5.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.6.1">PWAs</span></strong><span class="koboSpan" id="kobo.7.1">). </span><span class="koboSpan" id="kobo.7.2">This term may not seem descriptive enough, but it</span><a id="_idIndexMarker486"/><span class="koboSpan" id="kobo.8.1"> refers to a group of technologies that create the general concept and can be implemented gradually or partially. </span><span class="koboSpan" id="kobo.8.2">The basic idea behind it is to bring a web application out of the context of the browser and implement it in any type of device, to act and behave as much as possible to a native application. </span><span class="koboSpan" id="kobo.8.3">This is done thanks to the implementation of new APIs in the browser engines, as well as integrations among the most popular operating systems for desktop and mobile devices. </span><span class="koboSpan" id="kobo.8.4">The</span><a id="_idIndexMarker487"/><span class="koboSpan" id="kobo.9.1"> starting point for a PWA is, of course, a </span><strong class="bold"><span class="koboSpan" id="kobo.10.1">single-page </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.11.1">application</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.12.1"> (</span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.13.1">SPA</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.14.1">).</span></span></p>
<p><span class="koboSpan" id="kobo.15.1">By the end of this chapter, we will have learned </span><span class="No-Break"><span class="koboSpan" id="kobo.16.1">the following:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.17.1">What makes a SPA a PWA, and which technologies </span><span class="No-Break"><span class="koboSpan" id="kobo.18.1">are involved</span></span></li>
<li><span class="koboSpan" id="kobo.19.1">How to implement manually a responsive SPA, manifest file, service workers, offline storage, and </span><span class="No-Break"><span class="koboSpan" id="kobo.20.1">so on</span></span></li>
<li><span class="koboSpan" id="kobo.21.1">What</span><em class="italic"><span class="koboSpan" id="kobo.22.1"> service </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.23.1">workers </span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.24.1">are</span></span></li>
<li><span class="koboSpan" id="kobo.25.1">How to use Vite plugins to automate the creation </span><span class="No-Break"><span class="koboSpan" id="kobo.26.1">of PWAs</span></span></li>
<li><span class="koboSpan" id="kobo.27.1">How to test the readiness of your application using </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.28.1">Google Lighthouse</span></em></span></li>
</ul>
<p><span class="koboSpan" id="kobo.29.1">From the preceding list, we will concentrate on learning the scaffolding for several technologies, setting the foundation to use them later, implemented in detail in </span><a href="B18602_07.xhtml#_idTextAnchor173"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.30.1">Chapter 7</span></em></span></a><span class="koboSpan" id="kobo.31.1">,</span><em class="italic"><span class="koboSpan" id="kobo.32.1"> Data Flow Management</span></em><span class="koboSpan" id="kobo.33.1">, and </span><a href="B18602_08.xhtml#_idTextAnchor186"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.34.1">Chapter 8</span></em></span></a><span class="koboSpan" id="kobo.35.1">, </span><em class="italic"><span class="koboSpan" id="kobo.36.1">Multithreading with Web Workers</span></em><span class="koboSpan" id="kobo.37.1">. </span><span class="koboSpan" id="kobo.37.2">By the end of these chapters, you will know how to create PWAs that make good use of today’s computing power, making them responsive, reliable, </span><span class="No-Break"><span class="koboSpan" id="kobo.38.1">and performant.</span></span></p>
<h1 id="_idParaDest-124"><a id="_idTextAnchor150"/><span class="koboSpan" id="kobo.39.1">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.40.1">In order to follow along with this chapter, you will need the code examples found in the repository at </span><a href="https://github.com/PacktPublishing/Vue.js-3-Design-Patterns-and-Best-Practices/tree/main/Chapter06"><span class="koboSpan" id="kobo.41.1">https://github.com/PacktPublishing/Vue.js-3-Design-Patterns-and-Best-Practices/tree/main/Chapter06</span></a><span class="koboSpan" id="kobo.42.1">. </span><span class="koboSpan" id="kobo.42.2">The text code examples in this section may not be enough to create a working example, without the additional code from </span><span class="No-Break"><span class="koboSpan" id="kobo.43.1">the repository.</span></span></p>
<p><span class="koboSpan" id="kobo.44.1">Check out the following video to see the Code in </span><span class="No-Break"><span class="koboSpan" id="kobo.45.1">Action: </span></span><a href="https://packt.link/SBZys"><span class="No-Break"><span class="koboSpan" id="kobo.46.1">https://packt.link/SBZys</span></span></a></p>
<h1 id="_idParaDest-125"><a id="_idTextAnchor151"/><span class="koboSpan" id="kobo.47.1">PWAs or installable SPAs</span></h1>
<p><span class="koboSpan" id="kobo.48.1">A PWA is not a </span><a id="_idIndexMarker488"/><span class="koboSpan" id="kobo.49.1">single</span><a id="_idIndexMarker489"/><span class="koboSpan" id="kobo.50.1"> setting or technology, but a systematic enhancement of a web application to comply with certain conditions, be it either a </span><strong class="bold"><span class="koboSpan" id="kobo.51.1">multi-page application</span></strong><span class="koboSpan" id="kobo.52.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.53.1">MPA</span></strong><span class="koboSpan" id="kobo.54.1">) or a SPA. </span><span class="koboSpan" id="kobo.54.2">However, they</span><a id="_idIndexMarker490"/><span class="koboSpan" id="kobo.55.1"> really shine and come to life when these technologies are applied to SPAs, giving us powerful applications that blend the line between online/offline and desktop or web. </span><span class="koboSpan" id="kobo.55.2">The term </span><strong class="bold"><span class="koboSpan" id="kobo.56.1">progressive</span></strong><span class="koboSpan" id="kobo.57.1"> used here has the same connotation as we have discussed previously when applied to the Vue framework—an incremental application of </span><span class="No-Break"><span class="koboSpan" id="kobo.58.1">web technologies.</span></span></p>
<p><span class="koboSpan" id="kobo.59.1">PWAs are then treated somehow specially by the browsers and the operating system. </span><span class="koboSpan" id="kobo.59.2">They can be installed alongside native or desktop applications and manage network communications (to send, receive, cache files, and even push notifications from the server). </span><span class="koboSpan" id="kobo.59.3">At this point, it is important to note that we are no longer referring only to desktop computers but also to mobile devices such as tablets and phones, and different operating systems. </span><span class="koboSpan" id="kobo.59.4">It is because of this multiplatform approach that special consideration needs to be taken if the intention is to cover a user base on different devices, such as the use of special and dedicated CSS rules to adapt the UI to different sizes (the so-called </span><strong class="bold"><span class="koboSpan" id="kobo.60.1">responsive applications</span></strong><span class="koboSpan" id="kobo.61.1">), different icons, and colors to blend with local user customizations at the operating system level (for example, light and dark modes), and so on. </span><span class="koboSpan" id="kobo.61.2">Moreover, PWAs have the capacity (just as with SPAs) to store content for offline use and, hopefully, should also provide some functionality for offline use. </span><span class="koboSpan" id="kobo.61.3">To accomplish all of this, at the bare minimum, a PWA must comply with the </span><span class="No-Break"><span class="koboSpan" id="kobo.62.1">following requirements:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.63.1">The web application must be served through a secure </span><span class="No-Break"><span class="koboSpan" id="kobo.64.1">connection (HTTPS).</span></span></li>
<li><span class="koboSpan" id="kobo.65.1">The application must provide a </span><span class="No-Break"><span class="koboSpan" id="kobo.66.1">manifest file.</span></span></li>
<li><span class="koboSpan" id="kobo.67.1">It must provide and install a </span><span class="No-Break"><span class="koboSpan" id="kobo.68.1">service worker.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.69.1">When all these conditions are met, the browser or operating system may prompt the user to “install” the application. </span><span class="koboSpan" id="kobo.69.2">If the user accepts, the manifest file will be used to customize the appearance of the application to match the local operating system (icons, names, colors, and so on), and it will appear alongside all the other applications in the system. </span><span class="koboSpan" id="kobo.69.3">When run, it will open in its own window (if so selected) outside the confines of the web browser, just as with a regular native application. </span><span class="koboSpan" id="kobo.69.4">Internally, it will still run over the browser engine using web technologies, but the intent is that this will be transparent for the user, providing the best of both worlds. </span><span class="koboSpan" id="kobo.69.5">Chances are that a user may have been using PWAs instead of regular applications without knowing. </span><span class="koboSpan" id="kobo.69.6">Successful examples of this approach are Starbucks, Trivago, and </span><span class="No-Break"><span class="koboSpan" id="kobo.70.1">Tinder (</span></span><a href="https://medium.com/@addyosmani/a-tinder-progressive-web-app-performance-case-study-78919d98ece0"><span class="No-Break"><span class="koboSpan" id="kobo.71.1">https://medium.com/@addyosmani/a-tinder-progressive-web-app-performance-case-study-78919d98ece0</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.72.1">).</span></span></p>
<p><span class="koboSpan" id="kobo.73.1">This creates a good number of advantages that overpower the complications of creating a web application to match the different </span><span class="No-Break"><span class="koboSpan" id="kobo.74.1">installation scenarios:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.75.1">One single code base to install an application on multiple devices (desktop, mobile, …) and</span><a id="_idIndexMarker491"/><span class="koboSpan" id="kobo.76.1"> operating systems (Windows, Linux, macOS, Android, iOS, and </span><a id="_idIndexMarker492"/><span class="No-Break"><span class="koboSpan" id="kobo.77.1">so on)</span></span></li>
<li><span class="koboSpan" id="kobo.78.1">Support push notifications from the server, manual handling of caching, offline use, and </span><span class="No-Break"><span class="koboSpan" id="kobo.79.1">so on</span></span></li>
<li><span class="koboSpan" id="kobo.80.1">They integrate with the local </span><span class="No-Break"><span class="koboSpan" id="kobo.81.1">operating system</span></span></li>
<li><span class="koboSpan" id="kobo.82.1">Updates are transparent for the user and are much faster than a </span><span class="No-Break"><span class="koboSpan" id="kobo.83.1">traditional application</span></span><span class="koboSpan" id="kobo.84.1">
(for the </span><span class="No-Break"><span class="koboSpan" id="kobo.85.1">most part)</span></span></li>
<li><span class="koboSpan" id="kobo.86.1">Developing a PWA incurs much fewer costs than the equivalent targeted individual applications for </span><span class="No-Break"><span class="koboSpan" id="kobo.87.1">each platform</span></span></li>
<li><span class="koboSpan" id="kobo.88.1">One can use all available web technologies, frameworks, </span><span class="No-Break"><span class="koboSpan" id="kobo.89.1">and libraries</span></span></li>
<li><span class="koboSpan" id="kobo.90.1">Can be indexed by search engines, and the distribution and installation do not depend on proprietary </span><span class="No-Break"><span class="koboSpan" id="kobo.91.1">application stores</span></span></li>
<li><span class="koboSpan" id="kobo.92.1">They are responsive, safe, and fast, and can be shared with just </span><span class="No-Break"><span class="koboSpan" id="kobo.93.1">a link</span></span></li>
<li><span class="koboSpan" id="kobo.94.1">You can access local devices using standard web APIs, such as the local filesystem and USB devices, use hardware accelerated graphics, and </span><span class="No-Break"><span class="koboSpan" id="kobo.95.1">so on</span></span></li>
<li><span class="koboSpan" id="kobo.96.1">Some proprietary application stores allow you to re-package your PWA and distribute it as a regular application (Microsoft Store, Amazon Store, Android Store, and </span><span class="No-Break"><span class="koboSpan" id="kobo.97.1">so on)</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.98.1">There are more advantages, but these may be enough to make our case for them. </span><span class="koboSpan" id="kobo.98.2">Also, it is easier to add the necessary elements to our SPA to make it a PWA. </span><span class="koboSpan" id="kobo.98.3">This may make PWAs look like the silver bullet of applications; however, there are a few caveats and drawbacks to consider </span><span class="No-Break"><span class="koboSpan" id="kobo.99.1">as well:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.100.1">The performance of a PWA is good but will always fall behind a native application for certain specific scenarios. </span><span class="koboSpan" id="kobo.100.2">The same may happen in older hardware—they will run, but performance </span><span class="No-Break"><span class="koboSpan" id="kobo.101.1">may suffer.</span></span></li>
<li><span class="koboSpan" id="kobo.102.1">Apple devices fall a little behind in the adoption of some web technologies or limit them purposely for PWAs (for example, server </span><span class="No-Break"><span class="koboSpan" id="kobo.103.1">push notifications).</span></span></li>
<li><span class="koboSpan" id="kobo.104.1">There’s a need to dedicate a bit more effort to cover different user experience scenarios on multiple devices (but slightly more than for a normal responsive </span><span class="No-Break"><span class="koboSpan" id="kobo.105.1">web application).</span></span></li>
<li><span class="koboSpan" id="kobo.106.1">Some application stores will not allow PWAs (specifically at the time of this writing, the Apple App Store). </span><span class="koboSpan" id="kobo.106.2">Also, the application will not benefit from the exposure and </span><em class="italic"><span class="koboSpan" id="kobo.107.1">foot traffic</span></em><span class="koboSpan" id="kobo.108.1"> from an </span><span class="No-Break"><span class="koboSpan" id="kobo.109.1">app store.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.110.1">Overall, the </span><a id="_idIndexMarker493"/><span class="koboSpan" id="kobo.111.1">advantages outweigh considerably the </span><a id="_idIndexMarker494"/><span class="koboSpan" id="kobo.112.1">disadvantages. </span><span class="koboSpan" id="kobo.112.2">As web technologies continue to advance, PWAs benefit more from them and become more ubiquitous. </span><span class="koboSpan" id="kobo.112.3">Now, with a better understanding of what a PWA is and what it can do, let’s upgrade our SPAs </span><span class="No-Break"><span class="koboSpan" id="kobo.113.1">into PWAs.</span></span></p>
<h1 id="_idParaDest-126"><a id="_idTextAnchor152"/><span class="koboSpan" id="kobo.114.1">Upscaling a SPA into a PWA</span></h1>
<p><span class="koboSpan" id="kobo.115.1">The first requirement</span><a id="_idIndexMarker495"/><span class="koboSpan" id="kobo.116.1"> mentioned </span><a id="_idIndexMarker496"/><span class="koboSpan" id="kobo.117.1">previously is to serve the application over a secure connection. </span><span class="koboSpan" id="kobo.117.2">We will see how to accomplish this by installing a free SSL certificate in</span><a id="_idIndexMarker497"/><span class="koboSpan" id="kobo.118.1"> our server using </span><strong class="bold"><span class="koboSpan" id="kobo.119.1">Let’s Encrypt</span></strong><span class="koboSpan" id="kobo.120.1">, in </span><a href="B18602_10.xhtml#_idTextAnchor224"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.121.1">Chapter 10</span></em></span></a><span class="koboSpan" id="kobo.122.1">, </span><em class="italic"><span class="koboSpan" id="kobo.123.1">Deploying Your Application</span></em><span class="koboSpan" id="kobo.124.1">. </span><span class="koboSpan" id="kobo.124.2">With that in mind, let’s</span><a id="_idTextAnchor153"/><span class="koboSpan" id="kobo.125.1"> see how to fulfil the </span><span class="No-Break"><span class="koboSpan" id="kobo.126.1">other requirements.</span></span></p>
<h2 id="_idParaDest-127"><a id="_idTextAnchor154"/><span class="koboSpan" id="kobo.127.1">The manifest file</span></h2>
<p><span class="koboSpan" id="kobo.128.1">Adding a manifest </span><a id="_idIndexMarker498"/><span class="koboSpan" id="kobo.129.1">file is the starting point to turn our </span><a id="_idIndexMarker499"/><span class="koboSpan" id="kobo.130.1">application into a PWA. </span><span class="koboSpan" id="kobo.130.2">It is nothing less than a J</span><a id="_idTextAnchor155"/><span class="koboSpan" id="kobo.131.1">SON file with well-known fields that instruct the browser or operating system on how the application should be installed on the desktop or mobile device. </span><span class="koboSpan" id="kobo.131.2">This file must appear linked in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.132.1">head</span></strong><span class="koboSpan" id="kobo.133.1"> section of our </span><strong class="source-inline"><span class="koboSpan" id="kobo.134.1">index.html</span></strong><span class="koboSpan" id="kobo.135.1"> file, and while it could be arbitrarily named, the convention is to use the name </span><strong class="source-inline"><span class="koboSpan" id="kobo.136.1">manifest.json</span></strong><span class="koboSpan" id="kobo.137.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.138.1">app.webmanifest</span></strong><span class="koboSpan" id="kobo.139.1">. </span><span class="koboSpan" id="kobo.139.2">The official specification suggests the </span><strong class="source-inline"><span class="koboSpan" id="kobo.140.1">.webmanifest</span></strong><span class="koboSpan" id="kobo.141.1"> extension, but at the same type clarifies that the </span><a id="_idIndexMarker500"/><span class="koboSpan" id="kobo.142.1">name is not really important as long as the file is received properly with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.143.1">application/manifest+json - </span></strong><strong class="bold"><span class="koboSpan" id="kobo.144.1">Multipurpose Internet Mail Extensions</span></strong><span class="koboSpan" id="kobo.145.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.146.1">MIME</span></strong><span class="koboSpan" id="kobo.147.1">) type (see </span><a href="https://www.w3.org/TR/appmanifest/"><span class="koboSpan" id="kobo.148.1">https://www.w3.org/TR/appmanifest/</span></a><span class="koboSpan" id="kobo.149.1">, section </span><em class="italic"><span class="koboSpan" id="kobo.150.1">§1.1.2</span></em><span class="koboSpan" id="kobo.151.1">).  </span><span class="koboSpan" id="kobo.151.2">In our code examples, we will use the name </span><strong class="source-inline"><span class="koboSpan" id="kobo.152.1">manifest.json</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.153.1">for simplicity:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.154.1">
&lt;link rel="</span><strong class="bold"><span class="koboSpan" id="kobo.155.1">manifest</span></strong><span class="koboSpan" id="kobo.156.1">" href="</span><strong class="bold"><span class="koboSpan" id="kobo.157.1">/manifest.json"</span></strong><span class="koboSpan" id="kobo.158.1">&gt;</span></pre>
<p><span class="koboSpan" id="kobo.159.1">Notice from the previous code that the file is placed at the root of our application, and the </span><strong class="source-inline"><span class="koboSpan" id="kobo.160.1">rel</span></strong><span class="koboSpan" id="kobo.161.1"> attribute must be </span><strong class="source-inline"><span class="koboSpan" id="kobo.162.1">manifest</span></strong><span class="koboSpan" id="kobo.163.1">. </span><span class="koboSpan" id="kobo.163.2">The field attributes in our manifest file can appear in any order, and all of them are considered </span><em class="italic"><span class="koboSpan" id="kobo.164.1">o</span><a id="_idTextAnchor156"/><span class="koboSpan" id="kobo.165.1">ptional</span></em><span class="koboSpan" id="kobo.166.1"> by the aforementioned specification. </span><span class="koboSpan" id="kobo.166.2">However, some platforms do expect a minimum set of attributes that we will consider </span><em class="italic"><span class="koboSpan" id="kobo.167.1">necessary</span></em><span class="koboSpan" id="kobo.168.1">. </span><span class="koboSpan" id="kobo.168.2">The common practice also demands other attribute</span><a id="_idTextAnchor157"/><span class="koboSpan" id="kobo.169.1">s that we will catalogue as </span><em class="italic"><span class="koboSpan" id="kobo.170.1">recommended</span></em><span class="koboSpan" id="kobo.171.1">, and finally, some attributes in the specification are used often in app stores, social media, and so on to present or describe the application, so we will refer to these as </span><em class="italic"><span class="koboSpan" id="kobo.172.1">descriptive</span></em><span class="koboSpan" id="kobo.173.1"> fields. </span><span class="koboSpan" id="kobo.173.2">This classification is n</span><a id="_idTextAnchor158"/><span class="koboSpan" id="kobo.174.1">ot part of the specifications but is useful to guide you in the implementation. </span><span class="koboSpan" id="kobo.174.2">Here is a list of the most common and </span><span class="No-Break"><span class="koboSpan" id="kobo.175.1">useful attributes:</span></span></p>
<table class="No-Table-Style _idGenTablePara-1" id="table001-4">
<colgroup>
<col/>
<col/>
</colgroup>
<tbody>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.176.1">Classification</span></span></p>
</td>
<td class="No-Table-Style">
<p><span class="No-Break"><span class="koboSpan" id="kobo.177.1">Attribute</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style" colspan="2">
<p><span class="No-Break"><span class="koboSpan" id="kobo.178.1">Necessary</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.179.1">short_name</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.180.1">A short name to be used when there is not enough space to display the entire name of the application. </span><span class="koboSpan" id="kobo.180.2">In mobile devices, it is often used for the </span><span class="No-Break"><span class="koboSpan" id="kobo.181.1">icon name.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.182.1">name</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.183.1">The full name of </span><span class="No-Break"><span class="koboSpan" id="kobo.184.1">the application.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.185.1">icons</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.186.1">An array of objects, each one representing an individual icon to be used in different contexts. </span><span class="koboSpan" id="kobo.186.2">Each object has at least </span><span class="No-Break"><span class="koboSpan" id="kobo.187.1">two attributes:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.188.1">src</span></strong><span class="koboSpan" id="kobo.189.1">: The path to </span><span class="No-Break"><span class="koboSpan" id="kobo.190.1">the image</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.191.1">sizes</span></strong><span class="koboSpan" id="kobo.192.1">: A string with the dimensions of </span><span class="No-Break"><span class="koboSpan" id="kobo.193.1">the image</span></span></li>
</ul>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.194.1">start_url</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.195.1">The URL where the application should start, as set by </span><span class="No-Break"><span class="koboSpan" id="kobo.196.1">the developer.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.197.1">display</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.198.1">A string that represents how the application </span><span class="No-Break"><span class="koboSpan" id="kobo.199.1">is presented:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.200.1">fullscreen</span></strong><span class="koboSpan" id="kobo.201.1">: Fullscreen, but showing </span><span class="No-Break"><span class="koboSpan" id="kobo.202.1">browser UI.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.203.1">standalone</span></strong><span class="koboSpan" id="kobo.204.1">: Like </span><strong class="source-inline"><span class="koboSpan" id="kobo.205.1">fullscreen</span></strong><span class="koboSpan" id="kobo.206.1">, but without browser controls. </span><span class="koboSpan" id="kobo.206.2">On a desktop, windows controls will </span><span class="No-Break"><span class="koboSpan" id="kobo.207.1">still display.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.208.1">minimal-ui</span></strong><span class="koboSpan" id="kobo.209.1">: Like </span><strong class="source-inline"><span class="koboSpan" id="kobo.210.1">standalone</span></strong><span class="koboSpan" id="kobo.211.1">, but with basic navigation to move forward and backward, print, share, and </span><span class="No-Break"><span class="koboSpan" id="kobo.212.1">so on.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.213.1">browser</span></strong><span class="koboSpan" id="kobo.214.1">: The application is open in the </span><span class="No-Break"><span class="koboSpan" id="kobo.215.1">default browser.</span></span></li>
</ul>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style" colspan="2">
<p><span class="No-Break"><span class="koboSpan" id="kobo.216.1">Recommended</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.217.1">theme_color</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.218.1">A string representing a CSS color for the application. </span><span class="koboSpan" id="kobo.218.2">It is upon the OS to decide how to use this value (usually, applied in the window </span><span class="No-Break"><span class="koboSpan" id="kobo.219.1">title bar).</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.220.1">background_color</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.221.1">A string that represents the background color of the application when it is launched and before the actual styles from the application </span><span class="No-Break"><span class="koboSpan" id="kobo.222.1">are applied.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.223.1">orientation</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.224.1">Mostly used in mobile devices, it defines the orientation that the application must use—for example,</span><strong class="source-inline"><span class="koboSpan" id="kobo.225.1"> landscape, portrait, any,</span></strong><span class="koboSpan" id="kobo.226.1"> and </span><span class="No-Break"><span class="koboSpan" id="kobo.227.1">so on.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.228.1">lang</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.229.1">A string that defines the main language of </span><span class="No-Break"><span class="koboSpan" id="kobo.230.1">the application.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style" colspan="2">
<p><span class="No-Break"><span class="koboSpan" id="kobo.231.1">Descriptive</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.232.1">shortcuts</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.233.1">This is an array of objects that define direct menu options for tight integration with the operating system. </span><span class="koboSpan" id="kobo.233.2">Usually, these appear in the context menu, such as when a user right-clicks on the application icon. </span><span class="koboSpan" id="kobo.233.3">Each shortcut object must contain at least </span><strong class="source-inline"><span class="koboSpan" id="kobo.234.1">name</span></strong><span class="koboSpan" id="kobo.235.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.236.1">URL</span></strong><span class="koboSpan" id="kobo.237.1">, and—optionally—a </span><strong class="source-inline"><span class="koboSpan" id="kobo.238.1">description</span></strong><span class="koboSpan" id="kobo.239.1"> and </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.240.1">icons</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.241.1"> array.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.242.1">description</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.243.1">A string with a short description of </span><span class="No-Break"><span class="koboSpan" id="kobo.244.1">the application.</span></span></p>
</td>
</tr>
<tr class="No-Table-Style">
<td class="No-Table-Style">
<p><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.245.1">screenshots</span></strong></span></p>
</td>
<td class="No-Table-Style">
<p><span class="koboSpan" id="kobo.246.1">An array of objects, with the </span><span class="No-Break"><span class="koboSpan" id="kobo.247.1">following fields:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.248.1">src</span></strong><span class="koboSpan" id="kobo.249.1">: URL for </span><span class="No-Break"><span class="koboSpan" id="kobo.250.1">the image</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.251.1">type</span></strong><span class="koboSpan" id="kobo.252.1">: MIME type of </span><span class="No-Break"><span class="koboSpan" id="kobo.253.1">the image</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.254.1">sizes</span></strong><span class="koboSpan" id="kobo.255.1">: A string with the dimensions of </span><span class="No-Break"><span class="koboSpan" id="kobo.256.1">the image</span></span></li>
</ul>
</td>
</tr>
</tbody>
</table>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.257.1">Table 6.1 – Manifest fields</span></p>
<p><span class="koboSpan" id="kobo.258.1">In practice, I</span><a id="_idIndexMarker501"/><span class="koboSpan" id="kobo.259.1"> would</span><a id="_idIndexMarker502"/><span class="koboSpan" id="kobo.260.1"> recommend that the necessary and recommended fields are completed for each PWA, while the descriptive fields are used as needed based on the context of your application. </span><span class="koboSpan" id="kobo.260.2">Additionally, research you</span><a id="_idTextAnchor159"/><span class="koboSpan" id="kobo.261.1">r target platforms for additional supported fields that are not part of the </span><span class="No-Break"><span class="koboSpan" id="kobo.262.1">standard specification.</span></span></p>
<p><span class="koboSpan" id="kobo.263.1">Following the preceding table, here is an example of a </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.264.1">manifest.json</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.265.1"> file:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.266.1">
{
    "short_name":"PWA Example",
    "name": "Chapter 6: Progressive Web Application Example",
    "start_url":"/",
    "display": "standalone",
    "theme_color":"#2979FF",
    "background_color":"#000",
    "orientation": "portrait"
}</span></pre>
<p><span class="koboSpan" id="kobo.267.1">As you can</span><a id="_idIndexMarker503"/><span class="koboSpan" id="kobo.268.1"> see, creating a manifest file is not much</span><a id="_idIndexMarker504"/><span class="koboSpan" id="kobo.269.1"> additional effort and is an easy addition to </span><span class="No-Break"><span class="koboSpan" id="kobo.270.1">our SPA.</span></span></p>
<h2 id="_idParaDest-128"><a id="_idTextAnchor160"/><span class="koboSpan" id="kobo.271.1">Testing your manifest</span></h2>
<p><span class="koboSpan" id="kobo.272.1">Once you have </span><a id="_idIndexMarker505"/><span class="koboSpan" id="kobo.273.1">created your manifest file and linked it</span><a id="_idIndexMarker506"/><span class="koboSpan" id="kobo.274.1"> to your </span><strong class="source-inline"><span class="koboSpan" id="kobo.275.1">index.html</span></strong><span class="koboSpan" id="kobo.276.1"> file, you can use the Developer Tools in a browser to check that it has been properly loaded. </span><span class="koboSpan" id="kobo.276.2">For example, when using Google Chrome, in the </span><strong class="bold"><span class="koboSpan" id="kobo.277.1">Application</span></strong><span class="koboSpan" id="kobo.278.1"> menu, we can see here that the example file has been </span><span class="No-Break"><span class="koboSpan" id="kobo.279.1">properly loaded:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer040">
<span class="koboSpan" id="kobo.280.1"><img alt="Figure 6.1 – Developer Tools on Google Chrome, showing the manifest file" src="image/Figure_6.01_B18602.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.281.1">Figure 6.1 – Developer Tools on Google Chrome, showing the manifest file</span></p>
<p><span class="koboSpan" id="kobo.282.1">However, there is one more topic related to the installation of the application that we must review: when </span><a id="_idIndexMarker507"/><span class="koboSpan" id="kobo.283.1">and how does the user know that the </span><a id="_idIndexMarker508"/><span class="koboSpan" id="kobo.284.1">web application can be installed? </span><span class="koboSpan" id="kobo.284.2">This is where the </span><em class="italic"><span class="koboSpan" id="kobo.285.1">Install prompt</span></em><span class="koboSpan" id="kobo.286.1"> comes into play, which we will </span><span class="No-Break"><span class="koboSpan" id="kobo.287.1">see next.</span></span></p>
<h2 id="_idParaDest-129"><a id="_idTextAnchor161"/><span class="koboSpan" id="kobo.288.1">Install prompt</span></h2>
<p><span class="koboSpan" id="kobo.289.1">Each platform (mobile or desktop) has its </span><a id="_idIndexMarker509"/><span class="koboSpan" id="kobo.290.1">own method of determining</span><a id="_idIndexMarker510"/><span class="koboSpan" id="kobo.291.1"> when a PWA that meets the installation criteria can be installed. </span><span class="koboSpan" id="kobo.291.2">This could trigger a notification for the user to accept the installation after a certain amount of time, or only provide a UI to do so. </span><span class="koboSpan" id="kobo.291.3">On mobile devices, the installed PWA will be placed on the home screen alongside other native applications, while on a desktop, it may be placed inside the browser and/or also in the main menu. </span><span class="koboSpan" id="kobo.291.4">Also, in mobile operating systems such as Android, a splash screen will be automatically created with the theme and background colors and the application icon provided in the manifest. </span><span class="koboSpan" id="kobo.291.5">Independently of how and when the PWA can be installed, it is important to know that it can only be done with the user’s consent and initiative. </span><span class="koboSpan" id="kobo.291.6">We cannot trigger the installation automatically from the code without the </span><span class="No-Break"><span class="koboSpan" id="kobo.292.1">user’s approval.</span></span></p>
<p><span class="koboSpan" id="kobo.293.1">The basic installation flow is </span><span class="No-Break"><span class="koboSpan" id="kobo.294.1">as follows:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.295.1">When the platform detects that our application can be installed, it will trigger an event in the window object called </span><strong class="source-inline"><span class="koboSpan" id="kobo.296.1">beforeinstallprompt</span></strong><span class="koboSpan" id="kobo.297.1">. </span><span class="koboSpan" id="kobo.297.2">We can cache this event to trigger the prompt later from </span><span class="No-Break"><span class="koboSpan" id="kobo.298.1">our application.</span></span></li>
<li><span class="koboSpan" id="kobo.299.1">The user initiates the install either through the platform UI or through our PWA-provided method (such as </span><span class="No-Break"><span class="koboSpan" id="kobo.300.1">a button).</span></span></li>
<li><span class="koboSpan" id="kobo.301.1">The platform will prompt the user to accept or reject </span><span class="No-Break"><span class="koboSpan" id="kobo.302.1">the installation.</span></span></li>
<li><span class="koboSpan" id="kobo.303.1">If the user accepts, it will install the PWA and trigger another event </span><span class="No-Break"><span class="koboSpan" id="kobo.304.1">named </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.305.1">appinstalled</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.306.1">.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.307.1">This is a rather simple workflow. </span><span class="koboSpan" id="kobo.307.2">However, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.308.1">beforeinstallprompt</span></strong><span class="koboSpan" id="kobo.309.1"> event is triggered only once, so if the user rejects the installation, we need to wait until the browser triggers the </span><span class="No-Break"><span class="koboSpan" id="kobo.310.1">event again.</span></span></p>
<p><span class="koboSpan" id="kobo.311.1">Now</span><a id="_idTextAnchor162"/><span class="koboSpan" id="kobo.312.1"> that we</span><a id="_idIndexMarker511"/><span class="koboSpan" id="kobo.313.1"> understand how things will work, it is time to see this</span><a id="_idIndexMarker512"/><span class="koboSpan" id="kobo.314.1"> in code. </span><span class="koboSpan" id="kobo.314.2">Consider that in our Vue 3 component’s template, we have the </span><span class="No-Break"><span class="koboSpan" id="kobo.315.1">following elements:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.316.1">
&lt;p v-show="</span><strong class="bold"><span class="koboSpan" id="kobo.317.1">_install_ready &amp;&amp; !_app_installed"</span></strong><span class="koboSpan" id="kobo.318.1">&gt;
   Install this app
   &lt;button @click="</span><strong class="bold"><span class="koboSpan" id="kobo.319.1">installPWA()</span></strong><span class="koboSpan" id="kobo.320.1">"&gt;Install&lt;/button&gt;
&lt;/p&gt;
&lt;p v-show="</span><strong class="bold"><span class="koboSpan" id="kobo.321.1">_app_installed"</span></strong><span class="koboSpan" id="kobo.322.1">&gt;
   Progressive Web Application installed
&lt;/p&gt;</span></pre>
<p><span class="koboSpan" id="kobo.323.1">As you can see, we have two paragraphs that will show according to the value of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.324.1">_install_ready </span></strong><span class="koboSpan" id="kobo.325.1">and </span><strong class="source-inline"><span class="koboSpan" id="kobo.326.1">_app_installed</span></strong><span class="koboSpan" id="kobo.327.1"> reactive variables, both Boolean. </span><span class="koboSpan" id="kobo.327.2">The first will appear when the PWA is r</span><a id="_idTextAnchor163"/><span class="koboSpan" id="kobo.328.1">eady to be installed and will provide a button to trigger the installation through the </span><strong class="source-inline"><span class="koboSpan" id="kobo.329.1">installPWA()</span></strong><span class="koboSpan" id="kobo.330.1"> function. </span><span class="koboSpan" id="kobo.330.2">The second will show once it has </span><span class="No-Break"><span class="koboSpan" id="kobo.331.1">been performed.</span></span></p>
<p><span class="koboSpan" id="kobo.332.1">Our code in the script section is also </span><span class="No-Break"><span class="koboSpan" id="kobo.333.1">rather straightforward:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.334.1">
import { onMounted, ref, onBeforeUnmount } from 'vue'
const
    _install_ready=ref(false),
    _install_prompt=ref(null),
    _app_installed=ref(false)
// Detect PWA installable
onMounted(()=&gt;{
    window.addEventListener("</span><strong class="bold"><span class="koboSpan" id="kobo.335.1">beforeinstallprompt</span></strong><span class="koboSpan" id="kobo.336.1">",savePrompt)
    window.addEventListener("</span><strong class="bold"><span class="koboSpan" id="kobo.337.1">appinstalled</span></strong><span class="koboSpan" id="kobo.338.1">",handleAppInstalled)})
function savePrompt(event){
    event.preventDefault(); // Prevents mobile prompt
    // Save reference to the event, to activate it later
    </span><strong class="bold"><span class="koboSpan" id="kobo.339.1">_install_prompt.value=event</span></strong><span class="koboSpan" id="kobo.340.1">;
    // Notify UI that the application can be installed
    _install_ready.value=true;
}
function installPWA(){
    // Trigger the installation prompt
    if(_install_prompt.value){
        </span><strong class="bold"><span class="koboSpan" id="kobo.341.1">_install_prompt.value.prompt()</span></strong><span class="koboSpan" id="kobo.342.1">
    }
}
function handleAppInstalled(){
    _install_prompt.value=null;
    _app_installed.value=true;
}</span></pre>
<p><span class="koboSpan" id="kobo.343.1">In the previous code, we register two listeners when our component is mounted on the page, one to manage and cache the installation prompt, and another to detect when the application has been installed. </span><span class="koboSpan" id="kobo.343.2">Some parts have been omitted to keep the code simple, but the full component with styles can be fo</span><a id="_idTextAnchor164"/><span class="koboSpan" id="kobo.344.1">und in the </span><span class="No-Break"><span class="koboSpan" id="kobo.345.1">GitHub repository.</span></span></p>
<p><span class="koboSpan" id="kobo.346.1">While the preceding example is rather simplistic, there are some well-known patterns to promote or introduce the installation option to the end user. </span><span class="koboSpan" id="kobo.346.2">They all rely on the same logic of capturing the event and pr</span><a id="_idTextAnchor165"/><span class="koboSpan" id="kobo.347.1">ompting it later while showing the trigger element. </span><span class="koboSpan" id="kobo.347.2">The</span><a id="_idIndexMarker513"/><span class="koboSpan" id="kobo.348.1"> implementation is trivial and has more to do with design than a </span><a id="_idIndexMarker514"/><span class="koboSpan" id="kobo.349.1">coding pattern, so we will </span><a id="_idTextAnchor166"/><span class="koboSpan" id="kobo.350.1">only see the </span><span class="No-Break"><span class="koboSpan" id="kobo.351.1">mock-ups here:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.352.1">Simple </span><strong class="bold"><span class="koboSpan" id="kobo.353.1">Install</span></strong><span class="koboSpan" id="kobo.354.1"> button (as in our </span><span class="No-Break"><span class="koboSpan" id="kobo.355.1">example application):</span></span></li>
</ul>
<div>
<div class="IMG---Figure" id="_idContainer041">
<span class="koboSpan" id="kobo.356.1"><img alt="Figure 6.2 – Simple Install button" src="image/Figure_6.02_B18602.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.357.1">Figure 6.2 – Simple Install button</span></p>
<ul>
<li><span class="koboSpan" id="kobo.358.1">Menu </span><strong class="bold"><span class="koboSpan" id="kobo.359.1">Install</span></strong><span class="koboSpan" id="kobo.360.1"> button—placed in the </span><span class="No-Break"><span class="koboSpan" id="kobo.361.1">main navigation:</span></span></li>
</ul>
<div>
<div class="IMG---Figure" id="_idContainer042">
<span class="koboSpan" id="kobo.362.1"><img alt="Figure 6.3 – Main menu Install button" src="image/Figure_6.03_B18602.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.363.1">Figure 6.3 – Main menu Install button</span></p>
<ul>
<li><span class="koboSpan" id="kobo.364.1">An </span><span class="No-Break"><span class="koboSpan" id="kobo.365.1">overlay notification:</span></span></li>
</ul>
<div>
<div class="IMG---Figure" id="_idContainer043">
<span class="koboSpan" id="kobo.366.1"><img alt="Figure 6.4 – Overlay notification" src="image/Figure_6.04_B18602.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.367.1">Figure 6.4 – Overlay notification</span></p>
<ul>
<li><span class="koboSpan" id="kobo.368.1">An on-top</span><a id="_idIndexMarker515"/><span class="koboSpan" id="kobo.369.1"> overlayed element, such as an installation </span><a id="_idIndexMarker516"/><span class="koboSpan" id="kobo.370.1">banner (either before the header or at the bottom of </span><span class="No-Break"><span class="koboSpan" id="kobo.371.1">the viewport):</span></span></li>
</ul>
<div>
<div class="IMG---Figure" id="_idContainer044">
<span class="koboSpan" id="kobo.372.1"><img alt="Figure 6.5 – Installation prompt banner" src="image/Figure_6.05_B18602.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.373.1">Figure 6.5 – Installation prompt banner</span></p>
<p><span class="koboSpan" id="kobo.374.1">Once the application has been installed, we want to prevent keeping prompting the user for an install. </span><span class="koboSpan" id="kobo.374.2">In this case, it is recommendable that we save the offline flag, in </span><strong class="source-inline"><span class="koboSpan" id="kobo.375.1">localStorage</span></strong><span class="koboSpan" id="kobo.376.1">, a cookie, on </span><strong class="source-inline"><span class="koboSpan" id="kobo.377.1">indexeDB,</span></strong><span class="koboSpan" id="kobo.378.1"> or mark the start URL of our application to a specific location. </span><span class="koboSpan" id="kobo.378.2">We will</span><a id="_idIndexMarker517"/> <a id="_idTextAnchor167"/><span class="koboSpan" id="kobo.379.1">see offline persistent storage</span><a id="_idIndexMarker518"/><span class="koboSpan" id="kobo.380.1"> options in </span><a href="B18602_07.xhtml#_idTextAnchor173"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.381.1">Chapter 7</span></em></span></a><span class="koboSpan" id="kobo.382.1">, </span><em class="italic"><span class="koboSpan" id="kobo.383.1">Data Flow Management</span></em><span class="koboSpan" id="kobo.384.1">. </span><span class="koboSpan" id="kobo.384.2">Now, it’s time to look at the last item to make our SPA a true PWA: </span><span class="No-Break"><span class="koboSpan" id="kobo.385.1">service workers.</span></span></p>
<h1 id="_idParaDest-130"><a id="_idTextAnchor168"/><span class="koboSpan" id="kobo.386.1">Service workers</span></h1>
<p><span class="koboSpan" id="kobo.387.1">A service worker is </span><a id="_idIndexMarker519"/><span class="koboSpan" id="kobo.388.1">a JavaScript script that runs on a separate thread, as a background process to your application. </span><span class="koboSpan" id="kobo.388.2">It acts like a proxy for the network, intercepting all calls and behaving according to a programmed strategy to serve pages </span><span class="No-Break"><span class="koboSpan" id="kobo.389.1">and data.</span></span></p>
<p><span class="koboSpan" id="kobo.390.1">We can have multiple service workers as each one is responsible for their scope. </span><span class="koboSpan" id="kobo.390.2">The scope is defined as the directory (URL path) where the source file for the service worker is located. </span><span class="koboSpan" id="kobo.390.3">Thus, a service worker placed at the root of the application will handle the </span><span class="No-Break"><span class="koboSpan" id="kobo.391.1">entire SPA/PWA.</span></span></p>
<p><span class="koboSpan" id="kobo.392.1">Service workers are installed without user intervention, so they can be used even if the user does not install the PWA. </span><span class="koboSpan" id="kobo.392.2">They have a well-defined life cycle (see https://web.dev/service-worker-lifecycle/), triggering events for each accomplished state. </span><span class="koboSpan" id="kobo.392.3">To start, a service worker needs to be first </span><em class="italic"><span class="koboSpan" id="kobo.393.1">registered</span></em><span class="koboSpan" id="kobo.394.1">, then it becomes </span><em class="italic"><span class="koboSpan" id="kobo.395.1">activated</span></em><span class="koboSpan" id="kobo.396.1">, and eventually, we can also </span><em class="italic"><span class="koboSpan" id="kobo.397.1">unregister</span></em><span class="koboSpan" id="kobo.398.1"> it. </span><span class="koboSpan" id="kobo.398.2">Once the service worker is activated, it will not take control of the application communication until the next time the site </span><span class="No-Break"><span class="koboSpan" id="kobo.399.1">is accessed.</span></span></p>
<p><span class="koboSpan" id="kobo.400.1">The most common </span><a id="_idIndexMarker520"/><span class="koboSpan" id="kobo.401.1">strategies to program a service worker are </span><span class="No-Break"><span class="koboSpan" id="kobo.402.1">as follows:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.403.1">Serve the </span><span class="No-Break"><span class="koboSpan" id="kobo.404.1">cache only</span></span></li>
<li><span class="koboSpan" id="kobo.405.1">Serve </span><span class="No-Break"><span class="koboSpan" id="kobo.406.1">network only</span></span></li>
<li><span class="koboSpan" id="kobo.407.1">Try to serve the cache first, fall back to </span><span class="No-Break"><span class="koboSpan" id="kobo.408.1">the network</span></span></li>
<li><span class="koboSpan" id="kobo.409.1">Try to serve the network first, fall back to </span><span class="No-Break"><span class="koboSpan" id="kobo.410.1">the cache</span></span></li>
<li><span class="koboSpan" id="kobo.411.1">Serve the cache first, update the </span><span class="No-Break"><span class="koboSpan" id="kobo.412.1">cache next</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.413.1">When considering the cache and offline strategies, we need to consider what are the files and assets that our application needs to run that will have little or no change, to cache them. </span><span class="koboSpan" id="kobo.413.2">We also need to identify routes that should never </span><span class="No-Break"><span class="koboSpan" id="kobo.414.1">be cached.</span></span></p>
<p><span class="koboSpan" id="kobo.415.1">To use a service worker, we register it in our </span><strong class="source-inline"><span class="koboSpan" id="kobo.416.1">main.js</span></strong><span class="koboSpan" id="kobo.417.1"> file with the </span><span class="No-Break"><span class="koboSpan" id="kobo.418.1">following lines:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.419.1">
if(navigator.serviceWorker){
   navigator.serviceWorker.register("/service_worker.js")
}</span></pre>
<p><span class="koboSpan" id="kobo.420.1">In these lines, we first test if the current browser has capabilities to use service workers, and if so, we register it. </span><span class="koboSpan" id="kobo.420.2">As we can see, we have placed the worker at the root. </span><span class="koboSpan" id="kobo.420.3">For this example, we will use a </span><a id="_idIndexMarker521"/><span class="koboSpan" id="kobo.421.1">cache-first, network-fallback strategy manually for all </span><span class="No-Break"><span class="koboSpan" id="kobo.422.1">network calls:</span></span></p>
<pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.423.1">// Set strategy, cache first, then network</span></strong><span class="koboSpan" id="kobo.424.1">
const CACHE_NAME="MyCache"
self.addEventListener("fetch", event=&gt;{
    </span><strong class="bold"><span class="koboSpan" id="kobo.425.1">// Intercepts the event to respond</span></strong><span class="koboSpan" id="kobo.426.1">
    event.respondWith((async ()=&gt;{
    </span><strong class="bold"><span class="koboSpan" id="kobo.427.1">// Try to find the request in the cache</span></strong><span class="koboSpan" id="kobo.428.1">
    const found=await caches.match(event.request);
    if(found){
        return found;
    }else{
        </span><strong class="bold"><span class="koboSpan" id="kobo.429.1">// Not cached fount, fall back to the network</span></strong><span class="koboSpan" id="kobo.430.1">
        const response=await fetch(event.request);
        </span><strong class="bold"><span class="koboSpan" id="kobo.431.1">// Open the cache</span></strong><span class="koboSpan" id="kobo.432.1">
        const cache=await caches.open(CACHE_NAME);
        </span><strong class="bold"><span class="koboSpan" id="kobo.433.1">// Place the network response in the cache</span></strong><span class="koboSpan" id="kobo.434.1">
        cache.put(event.request, response.clone());
        </span><strong class="bold"><span class="koboSpan" id="kobo.435.1">// Return the response</span></strong><span class="koboSpan" id="kobo.436.1">
        return response;
    }
  })())
})</span></pre>
<p><span class="koboSpan" id="kobo.437.1">The previous code is based almost verbose on the example provided in the </span><strong class="bold"><span class="koboSpan" id="kobo.438.1">Mozilla Developer Network</span></strong><span class="koboSpan" id="kobo.439.1"> documentation at </span><a href="https://developer.mozilla.org/en-US/docs/Web/Progressive_web_apps/Offline_Service_workers"><span class="koboSpan" id="kobo.440.1">https://developer.mozilla.org/en-US/docs/Web/Progressive_web_apps/Offline_Service_workers</span></a><span class="koboSpan" id="kobo.441.1">. </span><span class="koboSpan" id="kobo.441.2">The comments in the code will help you understand the logic for the implementation of the strategy. </span><span class="koboSpan" id="kobo.441.3">However, using the basic APIs available to the service worker can be cumbersome, if not verbose. </span><span class="koboSpan" id="kobo.441.4">Instead, it is more convenient to use a framework or library to handle them and implement more complex strategies. </span><span class="koboSpan" id="kobo.441.5">The standard today is to use </span><strong class="bold"><span class="koboSpan" id="kobo.442.1">Workbox</span></strong><span class="koboSpan" id="kobo.443.1">, made by </span><strong class="bold"><span class="koboSpan" id="kobo.444.1">Google</span></strong><span class="koboSpan" id="kobo.445.1"> (https://developer.chrome.com/docs/workbox/). </span><span class="koboSpan" id="kobo.445.2">We will not use it directly, but through </span><a id="_idIndexMarker522"/><span class="koboSpan" id="kobo.446.1">a Vite plugin that we will see in the </span><span class="No-Break"><span class="koboSpan" id="kobo.447.1">next section.</span></span></p>
<p><span class="koboSpan" id="kobo.448.1">With all the code seen thus far, our PWA is ready to work and be installed. </span><span class="koboSpan" id="kobo.448.2">If we run the example application in the development server, we will notice that it can be installed. </span><span class="koboSpan" id="kobo.448.3">Using either the browser UI or our </span><strong class="bold"><span class="koboSpan" id="kobo.449.1">Install</span></strong><span class="koboSpan" id="kobo.450.1"> button, we will receive the </span><span class="No-Break"><span class="koboSpan" id="kobo.451.1">following prompt:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer045">
<span class="koboSpan" id="kobo.452.1"><img alt="Figure 6.6 – PWA install prompt from localhost" src="image/Figure_6.06_B18602.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.453.1">Figure 6.6 – PWA install prompt from localhost</span></p>
<p><span class="koboSpan" id="kobo.454.1">Adapting manually our SPA to turn it into a PWA is not complicated, but it does require some manual work. </span><span class="koboSpan" id="kobo.454.2">However, with the choice of tools we have, we can do better. </span><span class="koboSpan" id="kobo.454.3">There is an easier way to generate and inject both the manifest file and service worker as part of our workflow</span><a id="_idIndexMarker523"/><span class="koboSpan" id="kobo.455.1"> directly into our SPA: using a </span><span class="No-Break"><span class="koboSpan" id="kobo.456.1">Vite plugin.</span></span></p>
<h1 id="_idParaDest-131"><a id="_idTextAnchor169"/><span class="koboSpan" id="kobo.457.1">Vite-PWA plugin</span></h1>
<p><span class="koboSpan" id="kobo.458.1">In the Vite </span><a id="_idIndexMarker524"/><span class="koboSpan" id="kobo.459.1">ecosystem of plugins, there is an excellent zero-configuration Vite-PWA plugin (</span><a href="https://vite-pwa-org.netlify.app/"><span class="koboSpan" id="kobo.460.1">https://vite-pwa-org.netlify.app/</span></a><span class="koboSpan" id="kobo.461.1">). </span><span class="koboSpan" id="kobo.461.2">Out of the box, it provides us with great functionality without much manual work. </span><span class="koboSpan" id="kobo.461.3">We install the plugin as a developer dependency with the following command in </span><span class="No-Break"><span class="koboSpan" id="kobo.462.1">the terminal:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.463.1">
$ npm install –-save-dev vite-plugin-pwa</span></pre>
<p><span class="koboSpan" id="kobo.464.1">Once it has been installed, we must register it in the Vite configuration. </span><span class="koboSpan" id="kobo.464.2">Modify </span><span class="No-Break"><span class="koboSpan" id="kobo.465.1">the </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.466.1">vite.config.js</span></strong></span><span class="koboSpan" id="kobo.467.1">
file to match </span><span class="No-Break"><span class="koboSpan" id="kobo.468.1">the following:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.469.1">
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import { </span><strong class="bold"><span class="koboSpan" id="kobo.470.1">VitePWA </span></strong><span class="koboSpan" id="kobo.471.1">} from 'vite-plugin-pwa'
export default defineConfig({
plugins: [
vue(),
</span><strong class="bold"><span class="koboSpan" id="kobo.472.1">VitePWA</span></strong><span class="koboSpan" id="kobo.473.1">({
    </span><strong class="bold"><span class="koboSpan" id="kobo.474.1">registerType</span></strong><span class="koboSpan" id="kobo.475.1">: "autoUpdate",
    </span><strong class="bold"><span class="koboSpan" id="kobo.476.1">injectRegister</span></strong><span class="koboSpan" id="kobo.477.1">: 'auto',
    </span><strong class="bold"><span class="koboSpan" id="kobo.478.1">devOptions</span></strong><span class="koboSpan" id="kobo.479.1">: { enabled:true },
    </span><strong class="bold"><span class="koboSpan" id="kobo.480.1">workbox</span></strong><span class="koboSpan" id="kobo.481.1">: {
        globPatterns: ['**/*.{js,css,html,ico,png,svg}']
    },
    </span><strong class="bold"><span class="koboSpan" id="kobo.482.1">includeAssets</span></strong><span class="koboSpan" id="kobo.483.1">:
              ['fonts/*.ttf','images/*.png','css/*.css'],
    </span><strong class="bold"><span class="koboSpan" id="kobo.484.1">manifest</span></strong><span class="koboSpan" id="kobo.485.1">: {
        "short_name": "PWA Example",
        "name": "Chapter 6 - Progressive Web Application Example",
        "start_url": "/",
        "display": "standalone",
        "theme_color": "#333333",
        "background_color": "#000000",
        "orientation": "portrait",
        "icons": [
           {
            "src": "/images/chapter_6_icon_192x192.png",
            "sizes": "192x192",
            "type": "image/png"
           },
           {
            "src": "/images/chapter_6_icon.png",
            "sizes": "512x512",
            "type": "image/png"
           },
           {
            "src": "/images/chapter_6_icon.png",
            "sizes": "512x512",
            "type": "image/png",
            "purpose":"maskable"
           }
         ],
         "prefer_related_applications": false
    }
  })]
})</span></pre>
<p><span class="koboSpan" id="kobo.486.1">Using this plugin, we unload the burden of generating the service worker and web manifest to the bundler. </span><span class="koboSpan" id="kobo.486.2">This is necessary since with each production build, Vite will generate different filenames for each script according to our strategy to lazy load components, as we discussed in the </span><span class="No-Break"><span class="koboSpan" id="kobo.487.1">previous chapter.</span></span></p>
<p><span class="koboSpan" id="kobo.488.1">In the preceding example, we pass into the </span><strong class="source-inline"><span class="koboSpan" id="kobo.489.1">VitePWA()</span></strong><span class="koboSpan" id="kobo.490.1"> plugin an object with some sensible options for the automatic creation and injection of our manifest and worker. </span><span class="koboSpan" id="kobo.490.2">If we need finer control over the service worker strategy created, as well as with the web manifest, it is possible to use the plugin in “inject mode” and provide a base file for our service worker. </span><span class="koboSpan" id="kobo.490.3">In this case, the script will be injected with the generated files from the build process. </span><span class="koboSpan" id="kobo.490.4">Underneath, this </span><a id="_idIndexMarker525"/><span class="koboSpan" id="kobo.491.1">plugin uses </span><strong class="bold"><span class="koboSpan" id="kobo.492.1">Workbox</span></strong><span class="koboSpan" id="kobo.493.1">, a tool that we mentioned before and that we can </span><a id="_idIndexMarker526"/><span class="koboSpan" id="kobo.494.1">customize directly through the </span><strong class="source-inline"><span class="koboSpan" id="kobo.495.1">workbox</span></strong><span class="koboSpan" id="kobo.496.1"> field. </span><span class="koboSpan" id="kobo.496.2">Going further into the details of the different implementations and strategies goes beyond the scope of this book, but the reader should consult the documentation about the </span><strong class="bold"><span class="koboSpan" id="kobo.497.1">Vite-PWA</span></strong><span class="koboSpan" id="kobo.498.1"> plugin and </span><strong class="bold"><span class="koboSpan" id="kobo.499.1">Workbox</span></strong><span class="koboSpan" id="kobo.500.1"> for specific contexts and </span><span class="No-Break"><span class="koboSpan" id="kobo.501.1">use cases.</span></span></p>
<h1 id="_idParaDest-132"><a id="_idTextAnchor170"/><span class="koboSpan" id="kobo.502.1">Testing your PWA score with Google Lighthouse</span></h1>
<p><span class="koboSpan" id="kobo.503.1">Chrome-based</span><a id="_idIndexMarker527"/><span class="koboSpan" id="kobo.504.1"> browsers </span><a id="_idIndexMarker528"/><span class="koboSpan" id="kobo.505.1">provide together with the developer tools a utility called Lighthouse, specifically designed to test and rate web pages, and the readiness of PWAs. </span><span class="koboSpan" id="kobo.505.2">To access this tool, after you have opened your application in the browser, follow </span><span class="No-Break"><span class="koboSpan" id="kobo.506.1">these steps:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.507.1">Open the developer tools (by pressing </span><em class="italic"><span class="koboSpan" id="kobo.508.1">F12</span></em><span class="koboSpan" id="kobo.509.1"> in Windows/Linux, </span><em class="italic"><span class="koboSpan" id="kobo.510.1">Fn</span></em><span class="koboSpan" id="kobo.511.1"> + </span><em class="italic"><span class="koboSpan" id="kobo.512.1">F12</span></em><span class="koboSpan" id="kobo.513.1"> in Mac, or through the </span><span class="No-Break"><span class="koboSpan" id="kobo.514.1">browser menu).</span></span></li>
<li><span class="koboSpan" id="kobo.515.1">Click the </span><strong class="bold"><span class="koboSpan" id="kobo.516.1">Lighthouse</span></strong><span class="koboSpan" id="kobo.517.1"> menu toward the </span><span class="No-Break"><span class="koboSpan" id="kobo.518.1">further right.</span></span></li>
<li><span class="koboSpan" id="kobo.519.1">Select </span><strong class="bold"><span class="koboSpan" id="kobo.520.1">Mobile</span></strong><span class="koboSpan" id="kobo.521.1"> or </span><strong class="bold"><span class="koboSpan" id="kobo.522.1">Desktop</span></strong><span class="koboSpan" id="kobo.523.1">, plus make sure the </span><strong class="bold"><span class="koboSpan" id="kobo.524.1">Progressive Web App</span></strong><span class="koboSpan" id="kobo.525.1"> category </span><span class="No-Break"><span class="koboSpan" id="kobo.526.1">is checked.</span></span></li>
<li><span class="koboSpan" id="kobo.527.1">Click </span><strong class="bold"><span class="koboSpan" id="kobo.528.1">Analyze page load</span></strong><span class="koboSpan" id="kobo.529.1"> in the top-right corner of </span><span class="No-Break"><span class="koboSpan" id="kobo.530.1">the tool.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.531.1">The </span><a id="_idIndexMarker529"/><span class="koboSpan" id="kobo.532.1">developer</span><a id="_idIndexMarker530"/><span class="koboSpan" id="kobo.533.1"> tools should look something </span><span class="No-Break"><span class="koboSpan" id="kobo.534.1">like this:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer046">
<span class="koboSpan" id="kobo.535.1"><img alt="Figure 6.7 – Lighthouse utility" src="image/Figure_6.07_B18602.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.536.1">Figure 6.7 – Lighthouse utility</span></p>
<p><span class="koboSpan" id="kobo.537.1">The tool will run a number of tests, and each different category will display a rating, as well as a detailed list of items that have either passed or failed. </span><span class="koboSpan" id="kobo.537.2">If our application does not qualify to be a PWA, the items marked in red will tell us why and how to </span><span class="No-Break"><span class="koboSpan" id="kobo.538.1">fix them:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer047">
<span class="koboSpan" id="kobo.539.1"><img alt="Figure 6.8 – Chapter 6 code example ratings in Lighthouse" src="image/Figure_6.08_B18602.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.540.1">Figure 6.8 – Chapter 6 code example ratings in Lighthouse</span></p>
<p><span class="koboSpan" id="kobo.541.1">Our example code application fully qualifies as a PWA and passes all tests with flying colors. </span><span class="koboSpan" id="kobo.541.2">This is easier</span><a id="_idIndexMarker531"/><span class="koboSpan" id="kobo.542.1"> to </span><a id="_idIndexMarker532"/><span class="koboSpan" id="kobo.543.1">accomplish with smaller applications, of course. </span><span class="koboSpan" id="kobo.543.2">In practice, every rating above 90 </span><span class="No-Break"><span class="koboSpan" id="kobo.544.1">is great.</span></span></p>
<h1 id="_idParaDest-133"><a id="_idTextAnchor171"/><span class="koboSpan" id="kobo.545.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.546.1">In this chapter, we have taken a simple SPA and learned how to upgrade it into a PWA, manually and through the use of a plugin in Vite. </span><span class="koboSpan" id="kobo.546.2">Users can install PWAs in their platforms alongside native applications and interact with them, even if they are not connected to the internet. </span><span class="koboSpan" id="kobo.546.3">PWAs offer many advantages over web-only applications. </span><span class="koboSpan" id="kobo.546.4">We also saw how we can measure and rate our application in several industry-standard categories using Lighthouse. </span><span class="koboSpan" id="kobo.546.5">With this chapter, we end the incremental building of applications using web technologies and henceforth will focus on patterns and models for internal performance </span><span class="No-Break"><span class="koboSpan" id="kobo.547.1">and efficiency.</span></span></p>
<h1 id="_idParaDest-134"><a id="_idTextAnchor172"/><span class="koboSpan" id="kobo.548.1">Review questions</span></h1>
<p><span class="koboSpan" id="kobo.549.1">To help you solidify the concepts learned in this chapter, answer the </span><span class="No-Break"><span class="koboSpan" id="kobo.550.1">following questions:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.551.1">What is the difference between a SPA and </span><span class="No-Break"><span class="koboSpan" id="kobo.552.1">a PWA?</span></span></li>
<li><span class="koboSpan" id="kobo.553.1">What are the advantages of </span><span class="No-Break"><span class="koboSpan" id="kobo.554.1">a PWA?</span></span></li>
<li><span class="koboSpan" id="kobo.555.1">What are the basic three requirements that a web application must comply with to be considered </span><span class="No-Break"><span class="koboSpan" id="kobo.556.1">a PWA?</span></span></li>
<li><span class="koboSpan" id="kobo.557.1">Which tools we can use to incrementally prepare our application to be </span><span class="No-Break"><span class="koboSpan" id="kobo.558.1">a PWA?</span></span></li>
<li><span class="koboSpan" id="kobo.559.1">What is a service worker, and what are some strategies to </span><span class="No-Break"><span class="koboSpan" id="kobo.560.1">use it?</span></span></li>
<li><span class="koboSpan" id="kobo.561.1">What is a web manifest and why is </span><span class="No-Break"><span class="koboSpan" id="kobo.562.1">it necessary?</span></span></li>
</ul>
</div>
</body></html>