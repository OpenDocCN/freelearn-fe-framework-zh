<html><head></head><body>
        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">Advanced Redux and Falcor on the Client Side</h1>
            

            <article>
                
<p class="calibre2">Redux is our app's state container which keeps the information about how the React view layer shall render in the browser. On the other hand, Falcor differs from Redux, because it is the full-stack toolset that replaces the outdated approach of API endpoints data communication. In the next pages, we will  work with Falcor on the client side, but you need to remember that Factor is a full-stack library. That means, we need to use it on both sides (where on backend we use an additional library called Falcor-Router). Starting from <a href="part0140.html#45GEO0-7870c13caa1244daa9bd53ca5c1e1a42" class="calibre6">Chapter 5</a>, <em class="calibre21">Falcor Advanced Concepts</em>, we will work with full-stack Falcor. While in the current chapter, we will focus only on the client side.</p>


            </article>

            <footer class="calibre4">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">Focusing on the app's frontend</h1>
            

            <article>
                
<p class="calibre2">Currently, our app is a simple starter kit, which is a skeleton for its further development. We need to focus more on the customer-facing frontend because it's important to have a good-looking frontend in the current age. Thanks to Material UI, we can reuse many things to make our app look prettier.</p>
<p class="calibre2">It's important to note that responsive web design is not in the scope of this book at this point (and overall), so you need to find out how all the styles can be improved for mobile. The app we are going to work on will look fine on tablets, but small mobile screens may not look so good.</p>
<p class="calibre2">In this chapter, we will focus our efforts on the following:</p>
<ul class="calibre14">
<li class="calibre15">Unmocking <kbd class="calibre11">fetchServerSide.js</kbd></li>
<li class="calibre15">Adding a new <kbd class="calibre11">ArticleCard</kbd> component, which will make our main page more professional for our users</li>
<li class="calibre15">Improving the general look of our application</li>
<li class="calibre15">Implementing the ability to logout</li>
<li class="calibre15">Adding a WYSIWYG editor in <kbd class="calibre11">Draft.js</kbd> which is a rich text-editor framework for React created by the Facebook team</li>
<li class="calibre15">Adding the ability to create new articles in our Redux frontend application</li>
</ul>


            </article>

            <footer class="calibre4">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">Backend wrap-up before frontend improvement</h1>
            

            <article>
                
<p class="calibre2">In the previous chapter, we performed a server-side rendering that will affect our users such that they will see their articles quicker and will improve our website's SEO as the whole HTML markup is being rendered on the server side.</p>
<p class="calibre2">The last thing to make our server-side rendering work 100% is to unmock the server-side article fetching in <kbd class="calibre11">/server/fetchServerSide.js</kbd>. The new code for fetching is as follows:</p>
<pre class="calibre22">
import configMongoose from './configMongoose'; <br class="title-page-name"/>const Article = configMongoose.Article; <br class="title-page-name"/><br class="title-page-name"/>export default () =&gt; { <br class="title-page-name"/>  return Article.find({}, function(err, articlesDocs) { <br class="title-page-name"/>    return articlesDocs; <br class="title-page-name"/>  }).then ((articlesArrayFromDB) =&gt; { <br class="title-page-name"/>    return articlesArrayFromDB; <br class="title-page-name"/>  }); <br class="title-page-name"/>}
</pre>
<p class="calibre2">As you can find in the preceding code snippet, this function returns a promise with <kbd class="calibre11">Article.find</kbd> (the <kbd class="calibre11">find</kbd> function comes from Mongoose). You can also find that we are returning an array of articles that are fetched from our MongoDB.</p>


            </article>

            <footer class="calibre4">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">Improving handleServerSideRender</h1>
            

            <article>
                
<p class="calibre2">The next step is to tweak the <kbd class="calibre11">handleServerSideRender</kbd> function, which is currently kept in the <kbd class="calibre11">/server/server.js</kbd> file. The current function is as shown in the following code snippet:</p>
<pre class="calibre22">
// te following code should already be in your codebase: <br class="title-page-name"/>let handleServerSideRender = (req, res, next) =&gt; { <br class="title-page-name"/><a class="calibre25">try {</a> <br class="title-page-name"/>    let initMOCKstore = fetchServerSide(); // mocked for now <br class="title-page-name"/><br class="title-page-name"/>    // Create a new Redux store instance <br class="title-page-name"/>    const store = createStore(rootReducer, initMOCKstore) <br class="title-page-name"/>    const location = hist.createLocation(req.path);
</pre>
<p class="calibre2">We need to replace it with this improved one:</p>
<pre class="calibre22">
// this is an improved version: <br class="title-page-name"/>let handleServerSideRender = async (req, res, next) =&gt; { <br class="title-page-name"/>  try { <br class="title-page-name"/>    let articlesArray = await fetchServerSide(); <br class="title-page-name"/>    let initMOCKstore = { <br class="title-page-name"/>      article: articlesArray <br class="title-page-name"/>    } <br class="title-page-name"/><br class="title-page-name"/>  // Create a new Redux store instance <br class="title-page-name"/>  const store = createStore(rootReducer, initMOCKstore) <br class="title-page-name"/>  const location = hist.createLocation(req.path);
</pre>
<p class="calibre2">What is new in our improved <kbd class="calibre11">handleServerSideRender</kbd>? As you can see, we have added <kbd class="calibre11">async await</kbd>. Recall that it is helping us make our code less painful with asynchronous calls such as queries to the database (synchronous-looking generator-style code). This ES7 feature helps us write asynchronous calls as if they're synchronous ones--under the hood, <kbd class="calibre11">async await</kbd> is much more complicated (after it's transpiled into ES5 so that it can be run in any modern browser), but we won't get into details of how <kbd class="calibre11">async await</kbd> works because it's not in the scope of this chapter.</p>


            </article>

            <footer class="calibre4">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">Changing routes in Falcor (frontend and backend)</h1>
            

            <article>
                
<p class="calibre2">You also need to change the two ID variable names to <kbd class="calibre11">_id</kbd> (<kbd class="calibre11">_id</kbd> is a default name for the ID of a document in a Mongo collection).</p>
<p class="calibre2">Look in <kbd class="calibre11">server/routes.js</kbd> for this old code:</p>
<pre class="calibre22">
route: 'articles[{integers}]["id","articleTitle","articleContent"]',
</pre>
<p class="calibre2">Change it into the following:</p>
<pre class="calibre22">
route: 'articles[{integers}]["_id","articleTitle","articleContent"]',
</pre>
<p class="calibre2">The only change is that we will return <kbd class="calibre11">_id</kbd> instead of <kbd class="calibre11">id</kbd>. We need to fetch the <kbd class="calibre11">_id</kbd> value in <kbd class="calibre11">src/layouts/PublishingApp.js</kbd>, so find the following code snippet:</p>
<pre class="calibre22">
get(['articles', {from: 0, to: articlesLength-1}, ['id','articleTitle', 'articleContent']]).
</pre>
<p class="calibre2">Change it into the new one with <kbd class="calibre11">_id</kbd>:</p>
<pre class="calibre22">
get(['articles', {from: 0, to: articlesLength-1}, ['_id','articleTitle', 'articleContent']]).
</pre>


            </article>

            <footer class="calibre4">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">Our website header and articles list need improvements</h1>
            

            <article>
                
<p class="calibre2">Since we've finished wrapping up the server-side rendering and fetching articles from the DB, let's start with the frontend.</p>
<p class="calibre2">First, delete the following header from <kbd class="calibre11">server/server.js</kbd>; we don't need it anymore:</p>
<pre class="calibre22">
&lt;h1&gt;Server side publishing app&lt;/h1&gt;
</pre>
<p class="calibre2">You can also delete this header in <kbd class="calibre11">src/layouts/PublishingApp.js</kbd>:</p>
<pre class="calibre22">
&lt;h1&gt;Our publishing app&lt;/h1&gt;
</pre>
<p class="calibre2">Delete the <kbd class="calibre11">h1</kbd> markup in the registration and login view (<kbd class="calibre11">src/LoginView.js</kbd>):</p>
<pre class="calibre22">
&lt;h1&gt;Login view&lt;/h1&gt;
</pre>
<p class="calibre2">Delete registration in <kbd class="calibre11">src/RegisterView.js</kbd>:</p>
<pre class="calibre22">
&lt;h1&gt;Register&lt;/h1&gt;
</pre>
<p class="calibre2">All these <kbd class="calibre11">h1</kbd> lines are not needed as we want to have a nice-looking design instead of an outdated one.</p>
<p class="calibre2">After this, go to <kbd class="calibre11">src/CoreLayout.js</kbd> and import a new <kbd class="calibre11">AppBar</kbd> component and two button components from the Material UI:</p>
<pre class="calibre22">
import AppBar from 'material-ui/lib/app-bar'; <br class="title-page-name"/>import RaisedButton from 'material-ui/lib/raised-button'; <br class="title-page-name"/>import ActionHome from 'material-ui/lib/svg-icons/action/home';
</pre>
<p class="calibre2">Add this <kbd class="calibre11">AppBar</kbd> together with inline styles into <kbd class="calibre11">render</kbd>:</p>
<pre class="calibre22">
 render () { <br class="title-page-name"/>    const buttonStyle = { <br class="title-page-name"/>      margin: 5 <br class="title-page-name"/>    }; <br class="title-page-name"/>    const homeIconStyle = { <br class="title-page-name"/>      margin: 5, <br class="title-page-name"/>      paddingTop: 5 <br class="title-page-name"/>    }; <br class="title-page-name"/><br class="title-page-name"/>    let menuLinksJSX = ( <br class="title-page-name"/>    &lt;span&gt; <br class="title-page-name"/>        &lt;Link to='/register'&gt; <br class="title-page-name"/>       &lt;RaisedButton label='Register' style={buttonStyle}  /&gt; <br class="title-page-name"/>     &lt;/Link&gt;  <br class="title-page-name"/>        &lt;Link to='/login'&gt; <br class="title-page-name"/>       &lt;RaisedButton label='Login' style={buttonStyle}  /&gt; <br class="title-page-name"/>     &lt;/Link&gt;  <br class="title-page-name"/>      &lt;/span&gt;); <br class="title-page-name"/><br class="title-page-name"/>    let homePageButtonJSX = ( <br class="title-page-name"/>     &lt;Link to='/'&gt; <br class="title-page-name"/>          &lt;RaisedButton label={&lt;ActionHome /&gt;} <br class="title-page-name"/>           style={homeIconStyle}  /&gt; <br class="title-page-name"/>        &lt;/Link&gt;); <br class="title-page-name"/><br class="title-page-name"/><br class="title-page-name"/>    return ( <br class="title-page-name"/>      &lt;div&gt; <br class="title-page-name"/>        &lt;AppBar <br class="title-page-name"/>          title='Publishing App' <br class="title-page-name"/>          iconElementLeft={homePageButtonJSX} <br class="title-page-name"/>          iconElementRight={menuLinksJSX} /&gt; <br class="title-page-name"/>          &lt;br/&gt; <br class="title-page-name"/>          {this.props.children} <br class="title-page-name"/>      &lt;/div&gt; <br class="title-page-name"/>    ); <br class="title-page-name"/>  }
</pre>
<p class="calibre2">We have added the inline styles for <kbd class="calibre11">buttonStyle</kbd> and <kbd class="calibre11">homeIconStyle</kbd>. The <kbd class="calibre11">menuLinksJSX</kbd> and <kbd class="calibre11">homePageButtonJSX</kbd>'s visual output will improve. This is how your app will be looking after those <kbd class="calibre11">AppBar</kbd> changes:</p>
<div class="packt_figure"><img class="image-border25" src="../images/00030.jpeg"/></div>


            </article>

            <footer class="calibre4">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">New ArticleCard component</h1>
            

            <article>
                
<p class="calibre2">The next step in order to improve the look of our home page is to make article cards based on the Material Design CSS as well. Let's create a component's file first:</p>
<pre class="calibre22">
<strong class="calibre1">$ [[you are in the src/components/ directory of your project]]</strong><br class="title-page-name"/><strong class="calibre1">$ touch ArticleCard.js</strong>
</pre>
<p class="calibre2">Then, in the <kbd class="calibre11">ArticleCard.js</kbd> file, let's initialize the <kbd class="calibre11">ArticleCard</kbd> component with the following content:</p>
<pre class="calibre22">
import React from 'react'; <br class="title-page-name"/>import {  <br class="title-page-name"/>  Card,  <br class="title-page-name"/>  CardHeader,  <br class="title-page-name"/>  CardMedia,  <br class="title-page-name"/>  CardTitle,  <br class="title-page-name"/>  CardText  <br class="title-page-name"/>} from 'material-ui/lib/card'; <br class="title-page-name"/>import {Paper} from 'material-ui'; <br class="title-page-name"/><br class="title-page-name"/>class ArticleCard extends React.Component { <br class="title-page-name"/>  constructor(props) { <br class="title-page-name"/>    super(props); <br class="title-page-name"/>  } <br class="title-page-name"/><br class="title-page-name"/>  render() { <br class="title-page-name"/>    return &lt;h1&gt;here goes the article card&lt;/h1&gt;; <br class="title-page-name"/>  } <br class="title-page-name"/>}; <br class="title-page-name"/>export default ArticleCard;
</pre>
<p class="calibre2">As you can find in the preceding code, we have imported the required components from material-ui/card that will help our home page's articles list look nice. The next step is to improve our article card's <kbd class="calibre11">render</kbd> function with the following:</p>
<pre class="calibre22">
render() { <br class="title-page-name"/>  let title = this.props.title || 'no title provided'; <br class="title-page-name"/>  let content = this.props.content || 'no content provided'; <br class="title-page-name"/><br class="title-page-name"/>  const paperStyle = { <br class="title-page-name"/>    padding: 10,  <br class="title-page-name"/>    width: '100%',  <br class="title-page-name"/>    height: 300 <br class="title-page-name"/>  }; <br class="title-page-name"/><br class="title-page-name"/>  const leftDivStyle = { <br class="title-page-name"/>    width: '30%',  <br class="title-page-name"/>    float: 'left' <br class="title-page-name"/>  }; <br class="title-page-name"/><br class="title-page-name"/>  const rightDivStyle = { <br class="title-page-name"/>    width: '60%',  <br class="title-page-name"/>    float: 'left',  <br class="title-page-name"/>    padding: '10px 10px 10px 10px' <br class="title-page-name"/>  }; <br class="title-page-name"/><br class="title-page-name"/>  return ( <br class="title-page-name"/>    &lt;Paper style={paperStyle}&gt; <br class="title-page-name"/>      &lt;CardHeader <br class="title-page-name"/>        title={this.props.title} <br class="title-page-name"/>        subtitle='Subtitle' <br class="title-page-name"/>        avatar='/static/avatar.png' <br class="title-page-name"/>      /&gt; <br class="title-page-name"/><br class="title-page-name"/>      &lt;div style={leftDivStyle}&gt; <br class="title-page-name"/>        &lt;Card &gt; <br class="title-page-name"/>          &lt;CardMedia <br class="title-page-name"/>            overlay={&lt;CardTitle title={title} <br class="title-page-name"/>             subtitle='Overlay subtitle' /&gt;}&gt; <br class="title-page-name"/>            &lt;img src='/static/placeholder.png' height="190" /&gt; <br class="title-page-name"/>          &lt;/CardMedia&gt; <br class="title-page-name"/>        &lt;/Card&gt; <br class="title-page-name"/>      &lt;/div&gt; <br class="title-page-name"/>      &lt;div style={rightDivStyle}&gt; <br class="title-page-name"/>        {content} <br class="title-page-name"/>      &lt;/div&gt; <br class="title-page-name"/>    &lt;/Paper&gt;); <br class="title-page-name"/>}
</pre>
<p class="calibre2">As you can find in the preceding code, we have created an article card, and there are some inline styles for the <kbd class="calibre11">Paper</kbd> component and left and right <kbd class="calibre11">div</kbd>. Feel free to change the styles if you want.</p>
<p class="calibre2">In general, we are missing two static images in the previous <kbd class="calibre11">render</kbd> function, which are <kbd class="calibre11">src= '/static/placeholder.png'</kbd> and <kbd class="calibre11">avatar='/static/avatar.png'</kbd>. Let's add them using the following steps:</p>
<ol class="calibre17">
<li value="1" class="calibre15">Make a PNG file with the name <kbd class="calibre11">placeholder.png</kbd> in the <kbd class="calibre11">dist</kbd> directory. In my case, this is what my <kbd class="calibre11">placeholder.png</kbd> file looks like:</li>
</ol>
<div class="packt_figure"><img class="image-border26" src="../images/00031.jpeg"/></div>
<ol start="2" class="calibre17">
<li value="2" class="calibre15">Also create an <kbd class="calibre11">avatar.png</kbd> file in the <kbd class="calibre11">dist</kbd> directory that will be exposed in <kbd class="calibre11">/static/avatar.png</kbd>. I am not providing the screenshot here, as it has my personal photo in it.</li>
</ol>
<p class="calibre2">The <kbd class="calibre11">/static/</kbd> file in <kbd class="calibre11">express.js</kbd> is exposed in the <kbd class="calibre11">/server/server.js</kbd> file with <kbd class="calibre11">codeapp.use('/static', express.static('dist'));</kbd> (you will already have it in there as we have added this in the previous chapter).</p>
<p class="calibre2">The last thing is that you need to import <kbd class="calibre11">ArticleCard</kbd> and modify the render of <kbd class="calibre11">layouts/PublishingApp.js</kbd> from the old simple view to the new one.</p>
<p class="calibre2">Add <kbd class="calibre11">import</kbd> to the top of the file:</p>
<pre class="calibre22">
import ArticleCard from '../components/ArticleCard';
</pre>
<p class="calibre2">Then, replace the render with this new one:</p>
<pre class="calibre22">
render () { <br class="title-page-name"/><br class="title-page-name"/>  let articlesJSX = []; <br class="title-page-name"/>  for(let articleKey in this.props.article) { <br class="title-page-name"/>    const articleDetails = this.props.article[articleKey]; <br class="title-page-name"/><br class="title-page-name"/>    const currentArticleJSX = ( <br class="title-page-name"/>      &lt;div key={articleKey}&gt; <br class="title-page-name"/>        &lt;ArticleCard  <br class="title-page-name"/>          title={articleDetails.articleTitle} <br class="title-page-name"/>          content={articleDetails.articleContent} /&gt; <br class="title-page-name"/>      &lt;/div&gt; <br class="title-page-name"/>    ); <br class="title-page-name"/><br class="title-page-name"/>    articlesJSX.push(currentArticleJSX); <br class="title-page-name"/>  } <br class="title-page-name"/>  return ( <br class="title-page-name"/>    &lt;div style={{height: '100%', width: '75%', margin: 'auto'}}&gt; <br class="title-page-name"/>        {articlesJSX} <br class="title-page-name"/>    &lt;/div&gt; <br class="title-page-name"/>  ); <br class="title-page-name"/>}
</pre>
<p class="calibre2">The preceding new code only differs in this new <kbd class="calibre11">ArticleCard</kbd> component:</p>
<pre class="calibre22">
&lt;ArticleCard  <br class="title-page-name"/>  title={articleDetails.articleTitle} <br class="title-page-name"/>  content={articleDetails.articleContent} /&gt;
</pre>
<p class="calibre2">We also have added some styles to <kbd class="calibre11">div style={{height: '100%', width: '75%', margin: 'auto'}}</kbd>.</p>
<p class="calibre2">On following all these steps exactly in terms of styles, this is what you will see:</p>
<div class="packt_figure"><img class="image-border27" src="../images/00032.jpeg"/></div>
<p class="calibre2">This is the register user view:</p>
<div class="packt_figure"><img class="image-border28" src="../images/00033.jpeg"/></div>
<p class="calibre2">This is the login user view:</p>
<div class="packt_figure"><img class="image-border29" src="../images/00034.jpeg"/></div>


            </article>

            <footer class="calibre4">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">Dashboard - adding an article button, logout, and header improvements</h1>
            

            <article>
                
<p class="calibre2">Our plan for now is to create a logout mechanism, make our header aware whether a user is logged in or not, and based on that information show different buttons in the header (<span>Login</span>/<span>Register</span> when a user is not logged in and <span>Dashboard</span>/<span>Logout</span> when a user is logged in) We will create an <span>Add Article</span> button in our dashboard and create a mocked view with a mocked <a class="calibre6">WYSIWYG</a> (we will unmock it later).</p>
<div class="packt_infobox"><strong class="calibre26">WYSIWYG</strong> stands for <strong class="calibre26">what you see is what you get</strong>, of course.</div>
<p class="calibre2">The WYSIWYG mockup will be located in <kbd class="calibre11">src/components/articles/WYSIWYGeditor.js</kbd>, so you need to create a new directory and file in <kbd class="calibre11">components</kbd> with the following commands:</p>
<pre class="calibre22">
<strong class="calibre1">$ [[you are in the src/components/ directory of your project]]</strong><br class="title-page-name"/><strong class="calibre1">$ mkdir articles</strong><br class="title-page-name"/><strong class="calibre1">$ cd articles</strong><br class="title-page-name"/><strong class="calibre1">$ touch WYSIWYGeditor.js</strong>
</pre>
<p class="calibre2">Then our <kbd class="calibre11">WYSIWYGeditor.js</kbd> mock content will be as follows:</p>
<pre class="calibre22">
import React from 'react'; <br class="title-page-name"/><br class="title-page-name"/>class WYSIWYGeditor extends React.Component { <br class="title-page-name"/>  constructor(props) { <br class="title-page-name"/>    super(props); <br class="title-page-name"/>  } <br class="title-page-name"/><br class="title-page-name"/>  render() { <br class="title-page-name"/>    return &lt;h1&gt;WYSIWYGeditor&lt;/h1&gt;; <br class="title-page-name"/>  } <br class="title-page-name"/>}; <br class="title-page-name"/>export default WYSIWYGeditor;
</pre>
<p class="calibre2">The next step is to create a logout view at <kbd class="calibre11">src/views/LogoutView.js</kbd>:</p>
<pre class="calibre22">
<strong class="calibre1">$ [[you should be at src/views/ directory of your project]]</strong><br class="title-page-name"/><strong class="calibre1">$ touch LogoutView.js</strong>
</pre>
<p class="calibre2">The <kbd class="calibre11">src/views/LogoutView.js</kbd> file's content is as follows:</p>
<pre class="calibre22">
import React from 'react'; <br class="title-page-name"/>import {Paper} from 'material-ui'; <br class="title-page-name"/><br class="title-page-name"/>class LogoutView extends React.Component { <br class="title-page-name"/>  constructor(props) { <br class="title-page-name"/>    super(props); <br class="title-page-name"/>  } <br class="title-page-name"/><br class="title-page-name"/>  componentWillMount() { <br class="title-page-name"/>    if (typeof localStorage !== 'undefined' &amp;&amp; localStorage.token) { <br class="title-page-name"/>      delete localStorage.token; <br class="title-page-name"/>      delete localStorage.username; <br class="title-page-name"/>      delete localStorage.role; <br class="title-page-name"/>    } <br class="title-page-name"/>  } <br class="title-page-name"/><br class="title-page-name"/>  render () { <br class="title-page-name"/>    return ( <br class="title-page-name"/>      &lt;div style={{width: 400, margin: 'auto'}}&gt; <br class="title-page-name"/>        &lt;Paper zDepth={3} style={{padding: 32, margin: 32}}&gt; <br class="title-page-name"/>          Logout successful. <br class="title-page-name"/>        &lt;/Paper&gt; <br class="title-page-name"/>      &lt;/div&gt; <br class="title-page-name"/>    ); <br class="title-page-name"/>  } <br class="title-page-name"/>} <br class="title-page-name"/>export default LogoutView;
</pre>
<p class="calibre2">The <kbd class="calibre11">logout</kbd> view mentioned here is a simple view without a connecting function to Redux (in comparison with <kbd class="calibre11">LoginView.js</kbd>). We are using some styling to make it nice, with the <kbd class="calibre11">Paper</kbd> component from Material UI.</p>
<p class="calibre2">The <kbd class="calibre11">componentWillMount</kbd> function is deleted from the <kbd class="calibre11">localStorage</kbd> information when the user lands on the logout page. As you can see, it also checks whether there is <kbd class="calibre11">localStorage</kbd> with <kbd class="calibre11">**if(typeof localStorage !== 'undefined' &amp;&amp; localStorage.token) **</kbd> because, as you can imagine, when you perform server-side rendering, <kbd class="calibre11">localStorage</kbd> is undefined (the server side doesn't have <kbd class="calibre11">localStorage</kbd> and <kbd class="calibre11">window</kbd> like the client side).</p>


            </article>

            <footer class="calibre4">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">Important note before creating a frontend add article feature</h1>
            

            <article>
                
<p class="calibre2">We've come to the point where you need to delete all documents from your articles collection, or you may have some trouble performing the next steps as we are going to use a draft-js library and some other stuff that will need a new schema on the backend. We will create that backend's schema in the next chapter as this chapter is focused on the frontend.</p>
<p class="calibre2">Delete all documents in your MongoDB articles collection right now, but keep the user collection as it was (don't delete users from the database).</p>


            </article>

            <footer class="calibre4">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">The AddArticleView component</h1>
            

            <article>
                
<p class="calibre2">After creating the <kbd class="calibre11">LogoutView</kbd> and the <kbd class="calibre11">WYSIWYGeditor</kbd> components, let's create the final missing component in our process: the <kbd class="calibre11">src/views/articles/AddArticleView.js</kbd> file. So let's create a directory and file now:</p>
<pre class="calibre22">
<strong class="calibre1">$ [[you are in the src/views/ directory of your project]]</strong><br class="title-page-name"/><strong class="calibre1">$ mkdir articles</strong><br class="title-page-name"/><strong class="calibre1">$ cd articles</strong><br class="title-page-name"/><strong class="calibre1">$ touch AddArticleView.js</strong>
</pre>
<p class="calibre2">As a result, you'll have that file in your <kbd class="calibre11">views/articles</kbd> directory. We need to put content into it:</p>
<pre class="calibre22">
import React from 'react'; <br class="title-page-name"/>import {connect} from 'react-redux'; <br class="title-page-name"/>import WYSIWYGeditor from '../../components/articles/WYSIWYGeditor.js'; <br class="title-page-name"/><br class="title-page-name"/>const mapStateToProps = (state) =&gt; ({ <br class="title-page-name"/>  ...state <br class="title-page-name"/>}); <br class="title-page-name"/><br class="title-page-name"/>const mapDispatchToProps = (dispatch) =&gt; ({ <br class="title-page-name"/><br class="title-page-name"/>}); <br class="title-page-name"/><br class="title-page-name"/>class AddArticleView extends React.Component { <br class="title-page-name"/>  constructor(props) { <br class="title-page-name"/>    super(props); <br class="title-page-name"/>  } <br class="title-page-name"/><br class="title-page-name"/>  render () { <br class="title-page-name"/>    return ( <br class="title-page-name"/>      &lt;div style={{height: '100%', width: '75%', margin: 'auto'}}&gt; <br class="title-page-name"/>        &lt;h1&gt;Add Article&lt;/h1&gt; <br class="title-page-name"/>        &lt;WYSIWYGeditor /&gt; <br class="title-page-name"/>      &lt;/div&gt; <br class="title-page-name"/>    ); <br class="title-page-name"/>  } <br class="title-page-name"/>} <br class="title-page-name"/>export default connect(mapStateToProps, mapDispatchToProps)(AddArticleView);
</pre>
<p class="calibre2">As you can see here, it's a simple React view, and it imports the <kbd class="calibre11">WYSIWYGeditor</kbd> component that we created a moment ago (<kbd class="calibre11">import WYSIWYGeditor from '../../components/articles/WYSIWYGeditor.js'</kbd>). We have some inline styles in order to make the view look nicer for our user.</p>
<p class="calibre2">Let's create two new routes for a logout and for an add article feature by modifying the <kbd class="calibre11">routes</kbd> file at the <kbd class="calibre11">**src/routes/index.js*</kbd> location:</p>
<pre class="calibre22">
import React from 'react'; <br class="title-page-name"/>import {Route, IndexRoute} from 'react-router'; <br class="title-page-name"/>import CoreLayout from '../layouts/CoreLayout'; <br class="title-page-name"/>import PublishingApp from '../layouts/PublishingApp'; <br class="title-page-name"/>import LoginView from '../views/LoginView'; <br class="title-page-name"/>import LogoutView from '../views/LogoutView'; <br class="title-page-name"/>import RegisterView from '../views/RegisterView'; <br class="title-page-name"/>import DashboardView from '../views/DashboardView'; <br class="title-page-name"/>import AddArticleView from '../views/articles/AddArticleView'; <br class="title-page-name"/><br class="title-page-name"/>export default ( <br class="title-page-name"/>  &lt;Route component={CoreLayout} path='/'&gt; <br class="title-page-name"/>    &lt;IndexRoute component={PublishingApp} name='home' /&gt; <br class="title-page-name"/>    &lt;Route component={LoginView} path='login' name='login' /&gt; <br class="title-page-name"/>    &lt;Route component={LogoutView} path='logout' name='logout' /&gt; <br class="title-page-name"/>    &lt;Route component={RegisterView} path='register' <br class="title-page-name"/>       name='register' /&gt; <br class="title-page-name"/>    &lt;Route component={DashboardView} path='dashboard' <br class="title-page-name"/>       name='dashboard' /&gt; <br class="title-page-name"/>    &lt;Route component={AddArticleView} path='add-article' <br class="title-page-name"/>       name='add-article' /&gt; <br class="title-page-name"/>  &lt;/Route&gt; <br class="title-page-name"/>);
</pre>
<p class="calibre2">As explained in our <kbd class="calibre11">src/routes/index.js</kbd> file, we have added two routes:</p>
<ul class="calibre14">
<li class="calibre15"><kbd class="calibre11">&lt;Route component={LogoutView} path='logout' name='logout' /&gt;</kbd></li>
<li class="calibre15"><kbd class="calibre11">&lt;Route component={AddArticleView} path='add-article' name='add-article' /&gt;</kbd></li>
</ul>
<p class="calibre2">Don't forget to import those two views' components with the following:</p>
<pre class="calibre22">
import LogoutView from '../views/LogoutView'; <br class="title-page-name"/>import AddArticleView from '../views/articles/AddArticleView';
</pre>
<p class="calibre2">Now, we have created the views and created routes into that view. The last piece is to show links into those two routes in our app.</p>
<p class="calibre2">First let's create the <kbd class="calibre11">src/layouts/CoreLayout.js</kbd> component so it will have a login/logout-type login so that a logged-in user will see different buttons than a user who isn't. Modify the <kbd class="calibre11">render</kbd> function in the <kbd class="calibre11">CoreLayout</kbd> component to this:</p>
<pre class="calibre22">
  render () { <br class="title-page-name"/>    const buttonStyle = { <br class="title-page-name"/>      margin: 5 <br class="title-page-name"/>    }; <br class="title-page-name"/>    const homeIconStyle = { <br class="title-page-name"/>      margin: 5, <br class="title-page-name"/>      paddingTop: 5 <br class="title-page-name"/>    }; <br class="title-page-name"/><br class="title-page-name"/>    let menuLinksJSX; <br class="title-page-name"/>    let userIsLoggedIn = typeof localStorage !== 'undefined' &amp;&amp;  <br class="title-page-name"/>     localStorage.token &amp;&amp; this.props.routes[1].name !== 'logout'; <br class="title-page-name"/><br class="title-page-name"/>    if (userIsLoggedIn) { <br class="title-page-name"/>      menuLinksJSX = ( <br class="title-page-name"/>     &lt;span&gt; <br class="title-page-name"/>          &lt;Link to='/dashboard'&gt; <br class="title-page-name"/>      &lt;RaisedButton label='Dashboard' style={buttonStyle}  /&gt; <br class="title-page-name"/>    &lt;/Link&gt;  <br class="title-page-name"/>          &lt;Link to='/logout'&gt; <br class="title-page-name"/>      &lt;RaisedButton label='Logout' style={buttonStyle}  /&gt; <br class="title-page-name"/>    &lt;/Link&gt;  <br class="title-page-name"/>      &lt;/span&gt;); <br class="title-page-name"/>    } else { <br class="title-page-name"/>      menuLinksJSX = ( <br class="title-page-name"/>     &lt;span&gt; <br class="title-page-name"/>         &lt;Link to='/register'&gt; <br class="title-page-name"/>      &lt;RaisedButton label='Register' style={buttonStyle}  /&gt; <br class="title-page-name"/>    &lt;/Link&gt;  <br class="title-page-name"/>           &lt;Link to='/login'&gt; <br class="title-page-name"/>       &lt;RaisedButton label='Login' style={buttonStyle}  /&gt; <br class="title-page-name"/>     &lt;/Link&gt;  <br class="title-page-name"/>       &lt;/span&gt;); <br class="title-page-name"/>    } <br class="title-page-name"/><br class="title-page-name"/>    let homePageButtonJSX = ( <br class="title-page-name"/>      &lt;Link to='/'&gt; <br class="title-page-name"/>        &lt;RaisedButton label={&lt;ActionHome /&gt;} style={homeIconStyle}  <br class="title-page-name"/>         /&gt; <br class="title-page-name"/>      &lt;/Link&gt;); <br class="title-page-name"/><br class="title-page-name"/><br class="title-page-name"/>    return ( <br class="title-page-name"/>      &lt;div&gt; <br class="title-page-name"/>        &lt;AppBar <br class="title-page-name"/>          title='Publishing App' <br class="title-page-name"/>          iconElementLeft={homePageButtonJSX} <br class="title-page-name"/>          iconElementRight={menuLinksJSX} /&gt; <br class="title-page-name"/>          &lt;br/&gt; <br class="title-page-name"/>          {this.props.children} <br class="title-page-name"/>      &lt;/div&gt; <br class="title-page-name"/>    ); <br class="title-page-name"/>  }
</pre>
<p class="calibre2">You can see that the new part in the preceding code is as follows:</p>
<pre class="calibre22">
  let menuLinksJSX; <br class="title-page-name"/>  let userIsLoggedIn = typeof localStorage !== <br class="title-page-name"/>  'undefined' &amp;&amp; localStorage.token &amp;&amp; this.props.routes[1].name <br class="title-page-name"/>   !== 'logout'; <br class="title-page-name"/><br class="title-page-name"/>  if (userIsLoggedIn) { <br class="title-page-name"/>    menuLinksJSX = ( <br class="title-page-name"/>  &lt;span&gt; <br class="title-page-name"/>        &lt;Link to='/dashboard'&gt; <br class="title-page-name"/>    &lt;RaisedButton label='Dashboard' style={buttonStyle}  /&gt; <br class="title-page-name"/>  &lt;/Link&gt;  <br class="title-page-name"/>        &lt;Link to='/logout'&gt; <br class="title-page-name"/>    &lt;RaisedButton label='Logout'style={buttonStyle}  /&gt; <br class="title-page-name"/>  &lt;/Link&gt;  <br class="title-page-name"/>      &lt;/span&gt;); <br class="title-page-name"/>  } else { <br class="title-page-name"/>    menuLinksJSX = ( <br class="title-page-name"/>  &lt;span&gt; <br class="title-page-name"/>        &lt;Link to='/register'&gt; <br class="title-page-name"/>    &lt;RaisedButton label='Register' style={buttonStyle}  /&gt; <br class="title-page-name"/>  &lt;/Link&gt;  <br class="title-page-name"/>        &lt;Link to='/login'&gt; <br class="title-page-name"/>    &lt;RaisedButton label='Login' style={buttonStyle}  /&gt; <br class="title-page-name"/>  &lt;/Link&gt;  <br class="title-page-name"/>      &lt;/span&gt;); <br class="title-page-name"/>  }
</pre>
<p class="calibre2">We have added <kbd class="calibre11">let userIsLoggedIn = typeof localStorage !== 'undefined' &amp;&amp; localStorage.token &amp;&amp; this.props.routes[1].name !== 'logout';</kbd>. The <kbd class="calibre11">userIsLoggedIn</kbd> variable is found if we are not on the server side (then it doesn't have <kbd class="calibre11">localStorage</kbd> as mentioned earlier). Then, it checks whether <kbd class="calibre11">localStorage.token</kbd> is <kbd class="calibre11">yes</kbd>, and also checks whether a user didn't click on the logout button with the <kbd class="calibre11">this.props.routes[1].name !== 'logout'</kbd> expression. The <kbd class="calibre11">this.props.routes[1].name</kbd> value/information is provided by the <kbd class="calibre11">redux-simple-router</kbd> and <kbd class="calibre11">react-router</kbd>. This is always the name of our current route on the client side, so we can render the proper buttons based on that information.</p>


            </article>

            <footer class="calibre4">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">Modifying DashboardView</h1>
            

            <article>
                
<p class="calibre2">As you will find, we have added the <kbd class="calibre11">if (userIsLoggedIn)</kbd> statement, and the new part is the dashboard and logout <kbd class="calibre11">RaisedButton</kbd> entities with links to the correct routes.</p>
<p class="calibre2">The last piece to finish at this stage is to modify the <kbd class="calibre11">src/views/DashboardView.js</kbd> component. <span>Add link to the <kbd class="calibre11">/add-article</kbd> route using the <kbd class="calibre11">{Link}</kbd> component imported from react-router</span>. Also, we need to import new Material UI components in order to make <kbd class="calibre11">DashboardView</kbd> nicer:</p>
<pre class="calibre22">
import {Link} from 'react-router'; <br class="title-page-name"/>import List from 'material-ui/lib/lists/list'; <br class="title-page-name"/>import ListItem from 'material-ui/lib/lists/list-item'; <br class="title-page-name"/>import Avatar from 'material-ui/lib/avatar'; <br class="title-page-name"/>import ActionInfo from 'material-ui/lib/svg-icons/action/info'; <br class="title-page-name"/>import FileFolder from 'material-ui/lib/svg-icons/file/folder'; <br class="title-page-name"/>import RaisedButton from 'material-ui/lib/raised-button'; <br class="title-page-name"/>import Divider from 'material-ui/lib/divider';
</pre>
<p class="calibre2">After you have imported all this in your <kbd class="calibre11">src/views/DashboardView.js</kbd> file, then we need to start work on improving the <kbd class="calibre11">render</kbd> function:</p>
<pre class="calibre22">
render () { <br class="title-page-name"/><br class="title-page-name"/>    let articlesJSX = []; <br class="title-page-name"/>    for(let articleKey in this.props.article) { <br class="title-page-name"/>      const articleDetails = this.props.article[articleKey]; <br class="title-page-name"/>      const currentArticleJSX = ( <br class="title-page-name"/>        &lt;ListItem <br class="title-page-name"/>          key={articleKey} <br class="title-page-name"/>          leftAvatar={&lt;img  <br class="title-page-name"/>          src='/static/placeholder.png'  <br class="title-page-name"/>          width='50'  <br class="title-page-name"/>          height='50' /&gt;} <br class="title-page-name"/>          primaryText={articleDetails.articleTitle} <br class="title-page-name"/>          secondaryText={articleDetails.articleContent} <br class="title-page-name"/>        /&gt; <br class="title-page-name"/>      ); <br class="title-page-name"/><br class="title-page-name"/>      articlesJSX.push(currentArticleJSX); <br class="title-page-name"/>    } <br class="title-page-name"/>    return ( <br class="title-page-name"/>      &lt;div style={{height: '100%', width: '75%', margin: 'auto'}}&gt; <br class="title-page-name"/>        &lt;Link to='/add-article'&gt; <br class="title-page-name"/>          &lt;RaisedButton  <br class="title-page-name"/>            label='Create an article'  <br class="title-page-name"/>            secondary={true}  <br class="title-page-name"/>            style={{margin: '20px 20px 20px 20px'}} /&gt; <br class="title-page-name"/>        &lt;/Link&gt; <br class="title-page-name"/><br class="title-page-name"/>        &lt;List&gt; <br class="title-page-name"/>          {articlesJSX} <br class="title-page-name"/>        &lt;/List&gt; <br class="title-page-name"/>      &lt;/div&gt; <br class="title-page-name"/>    ); <br class="title-page-name"/>  }
</pre>
<p class="calibre2">Here, we have our new <kbd class="calibre11">render</kbd> function for <kbd class="calibre11">DashboardView</kbd>. We are using the <kbd class="calibre11">ListItem</kbd> component to make our nice lists. We have also added the link and button to the <kbd class="calibre11">/add-article</kbd> routes. There are some inline styles, but feel free to style this app on your own.</p>
<p class="calibre2">Let's look at a few screenshots of how the app looks after all these changes after adding the <span>CREATE AN ARTICLE</span> button with a new view of articles:</p>
<div class="packt_figure"><img class="image-border30" src="../images/00035.jpeg"/></div>
<p class="calibre2">After having mocked WYSIWYG on the <kbd class="calibre11">/add-article</kbd> view:</p>
<div class="packt_figure"><img class="image-border31" src="../images/00036.jpeg"/></div>
<p class="calibre2">Our new logout view page will look like this:</p>
<div class="packt_figure"><img class="image-border32" src="../images/00037.jpeg"/></div>


            </article>

            <footer class="calibre4">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">Starting work on our WYSIWYG</h1>
            

            <article>
                
<p class="calibre2">Let's install a draft-js library, which is "a framework for building rich text editors in React, powered by an immutable model and abstracting over cross-browser differences," as stated on their website.</p>
<p class="calibre2">In general, draft-js is made by friends from Facebook, and it helps us make powerful WYSIWYG tools. It will be useful in our publishing app as we want to provide good tools for our editors in order to create interesting articles on our platform.</p>
<p class="calibre2">Let's install it first:</p>
<pre class="calibre22">
<strong class="calibre1">npm i --save draft-js@0.5.0</strong>
</pre>
<p class="calibre2">We will use version 0.5.0 of draft-js in our book. Before we start coding, let's install one more dependency that will be helpful later in fetching the articles from the DB via Falcor. Execute the following command:</p>
<pre class="calibre22">
<strong class="calibre1">npm i --save falcor-json-graph@1.1.7</strong>
</pre>
<p class="calibre2">In general, the <kbd class="calibre11">falcor-json-graph@1.1.7</kbd> syntax provides us with the ability to use different sentinels provided via the Falcor helper library (which will be described in detail in the next chapter).</p>


            </article>

            <footer class="calibre4">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">Stylesheet for the draft-js WYSIWYG</h1>
            

            <article>
                
<p class="calibre2"><span>In order to style draft-js editor, we need to create a new CSS file in the <kbd class="calibre11">dist</kbd> folder located at <kbd class="calibre11">dist/styles-draft-js.css</kbd>. It's the only place where we will put a CSS stylesheet:</span></p>
<pre class="calibre22">
.RichEditor-root { <br class="title-page-name"/>  background: #fff; <br class="title-page-name"/>  border: 1px solid #ddd; <br class="title-page-name"/>  font-family: 'Georgia', serif; <br class="title-page-name"/>  font-size: 14px; <br class="title-page-name"/>  padding: 15px; <br class="title-page-name"/>} <br class="title-page-name"/><br class="title-page-name"/>.RichEditor-editor { <br class="title-page-name"/>  border-top: 1px solid #ddd; <br class="title-page-name"/>  cursor: text; <br class="title-page-name"/>  font-size: 16px; <br class="title-page-name"/>  margin-top: 10px; <br class="title-page-name"/>  min-height: 100px; <br class="title-page-name"/>} <br class="title-page-name"/><br class="title-page-name"/>.RichEditor-editor .RichEditor-blockquote { <br class="title-page-name"/>  border-left: 5px solid #eee; <br class="title-page-name"/>  color: #666; <br class="title-page-name"/>  font-family: 'Hoefler Text', 'Georgia', serif; <br class="title-page-name"/>  font-style: italic; <br class="title-page-name"/>  margin: 16px 0; <br class="title-page-name"/>  padding: 10px 20px; <br class="title-page-name"/>} <br class="title-page-name"/><br class="title-page-name"/>.RichEditor-controls { <br class="title-page-name"/>  font-family: 'Helvetica', sans-serif; <br class="title-page-name"/>  font-size: 14px; <br class="title-page-name"/>  margin-bottom: 5px; <br class="title-page-name"/>  user-select: none; <br class="title-page-name"/>} <br class="title-page-name"/><br class="title-page-name"/>.RichEditor-styleButton { <br class="title-page-name"/>  color: #999; <br class="title-page-name"/>  cursor: pointer; <br class="title-page-name"/>  margin-right: 16px; <br class="title-page-name"/>  padding: 2px 0; <br class="title-page-name"/>} <br class="title-page-name"/><br class="title-page-name"/>.RichEditor-activeButton { <br class="title-page-name"/>  color: #5890ff; <br class="title-page-name"/>}
</pre>
<p class="calibre2">After you have created this file at <kbd class="calibre11">dist/styles-draft-js.css</kbd>, we need to import it to <kbd class="calibre11">server/server.js</kbd>, where we have been creating the HTML header, so the following code is already present in the <kbd class="calibre11">server.js</kbd> file:</p>
<pre class="calibre22">
let renderFullPage = (html, initialState) =&gt; <br class="title-page-name"/>{ <br class="title-page-name"/>  return &amp;grave; <br class="title-page-name"/>    &lt;!doctype html&gt; <br class="title-page-name"/>    &lt;html&gt; <br class="title-page-name"/>      &lt;head&gt; <br class="title-page-name"/>        &lt;title&gt;Publishing App Server Side Rendering&lt;/title&gt; <br class="title-page-name"/>        &lt;link rel="stylesheet" type="text/css" <br class="title-page-name"/>         href="/static/styles-draft-js.css" /&gt; <br class="title-page-name"/>      &lt;/head&gt; <br class="title-page-name"/>      &lt;body&gt; <br class="title-page-name"/>        &lt;div id="publishingAppRoot"&gt;${html}&lt;/div&gt; <br class="title-page-name"/>        &lt;script&gt; <br class="title-page-name"/>          window.__INITIAL_STATE__ = <br class="title-page-name"/>           ${JSON.stringify(initialState)} <br class="title-page-name"/>        &lt;/script&gt; <br class="title-page-name"/>        &lt;script src="/static/app.js"&gt;&lt;/script&gt; <br class="title-page-name"/>      &lt;/body&gt; <br class="title-page-name"/>    &lt;/html&gt; <br class="title-page-name"/>    &amp;grave; <br class="title-page-name"/>};
</pre>
<p class="calibre2">Then you need to include the link to the stylesheet with this:</p>
<pre class="calibre22">
&lt;link rel="stylesheet" type="text/css" href="/static/styles-draft- <br class="title-page-name"/> js.css" /&gt;
</pre>
<p class="calibre2">Nothing fancy so far. After we are done with the styles for our rich text WYSIWYG editor, let's have some fun.</p>


            </article>

            <footer class="calibre4">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">Coding a draft-js skeleton</h1>
            

            <article>
                
<p class="calibre2">Let's get back to the <kbd class="calibre11">src/components/articles/WYSIWYGeditor.js</kbd> file. It's currently mocked, but we will improve it now.</p>
<p class="calibre2">Just to make you aware, we will make a skeleton of the WYSIWYG right now. We will improve it later in the book. At this point, the WYSIWYG won't have any functionalities such as making text bold or creating lists with OL and UL elements.</p>
<pre class="calibre22">
import React from 'react'; <br class="title-page-name"/>import { <br class="title-page-name"/>  Editor,  <br class="title-page-name"/>  EditorState,  <br class="title-page-name"/>  ContentState,  <br class="title-page-name"/>  RichUtils,  <br class="title-page-name"/>  convertToRaw, <br class="title-page-name"/>  convertFromRaw <br class="title-page-name"/>} from 'draft-js'; <br class="title-page-name"/><br class="title-page-name"/><br class="title-page-name"/>export default class   WYSIWYGeditor extends React.Component { <br class="title-page-name"/>  constructor(props) { <br class="title-page-name"/>    super(props); <br class="title-page-name"/><br class="title-page-name"/>    let initialEditorFromProps = <br class="title-page-name"/>     EditorState.createWithContent <br class="title-page-name"/>     (ContentState.createFromText('')); <br class="title-page-name"/><br class="title-page-name"/>    this.state = { <br class="title-page-name"/>      editorState: initialEditorFromProps <br class="title-page-name"/>    }; <br class="title-page-name"/><br class="title-page-name"/>    this.onChange = (editorState) =&gt; {  <br class="title-page-name"/>      var contentState = editorState.getCurrentContent(); <br class="title-page-name"/><br class="title-page-name"/>      let contentJSON = convertToRaw(contentState); <br class="title-page-name"/>      props.onChangeTextJSON(contentJSON, contentState); <br class="title-page-name"/>      this.setState({editorState})  <br class="title-page-name"/>    }; <br class="title-page-name"/>  } <br class="title-page-name"/><br class="title-page-name"/>  render() { <br class="title-page-name"/>    return &lt;h1&gt;WYSIWYGeditor&lt;/h1&gt;; <br class="title-page-name"/>  } <br class="title-page-name"/>}
</pre>
<p class="calibre2">Here, we have created only a constructor of our new draft-js file's WYSIWYG. The <kbd class="calibre11">let initialEditorFromProps = EditorState.createWithContent(ContentState.createFromText(''));</kbd> expression is simply creating an empty WYSIWYG container. Later, we will improve it so we are able to receive <kbd class="calibre11">ContentState</kbd> from the database when we would like to edit our WYSIWYG.</p>
<p class="calibre2">The <kbd class="calibre11">editorState: initialEditorFromProps</kbd> is our current state. Our <kbd class="calibre11">**this.onChange = (editorState) =&gt; { **</kbd> line is firing on each change, so our view component at <kbd class="calibre11">src/views/articles/AddArticleView.js</kbd> will know about any changes in the WYSIWYG.</p>
<p class="calibre2">Anyway, you can check the documentation of draft-js at <a href="https://facebook.github.io/draft-js/" class="calibre6"><span>https://facebook.github.io/draft-js/</span></a>.</p>
<p class="calibre2">This is just the beginning; the next step is to add two new functions under <kbd class="calibre11">onChange</kbd>:</p>
<pre class="calibre22">
this.focus = () =&gt; this.refs['refWYSIWYGeditor'].focus(); <br class="title-page-name"/>this.handleKeyCommand = (command) =&gt; this._handleKeyCommand(command);
</pre>
<p class="calibre2">And add a new function in our <kbd class="calibre11">WYSIWYGeditor</kbd> class:</p>
<pre class="calibre22">
_handleKeyCommand(command) { <br class="title-page-name"/>   const {editorState} = this.state; <br class="title-page-name"/>   const newState = RichUtils.handleKeyCommand(editorState, <br class="title-page-name"/>    command); <br class="title-page-name"/><br class="title-page-name"/>   if (newState) { <br class="title-page-name"/>     this.onChange(newState); <br class="title-page-name"/>     return true; <br class="title-page-name"/>   } <br class="title-page-name"/>   return false; <br class="title-page-name"/> }
</pre>
<p class="calibre2">After all these changes, this is how your construction of the <kbd class="calibre11">WYSIWYGeditor</kbd> class should look:</p>
<pre class="calibre22">
export default class   WYSIWYGeditor extends React.Component { <br class="title-page-name"/>  constructor(props) { <br class="title-page-name"/>    super(props); <br class="title-page-name"/><br class="title-page-name"/>    let initialEditorFromProps = <br class="title-page-name"/>     EditorState.createWithContent <br class="title-page-name"/>     (ContentState.createFromText('')); <br class="title-page-name"/><br class="title-page-name"/>    this.state = { <br class="title-page-name"/>      editorState: initialEditorFromProps <br class="title-page-name"/>    }; <br class="title-page-name"/><br class="title-page-name"/>    this.onChange = (editorState) =&gt; {  <br class="title-page-name"/>      var contentState = editorState.getCurrentContent(); <br class="title-page-name"/><br class="title-page-name"/>      let contentJSON = convertToRaw(contentState); <br class="title-page-name"/>      props.onChangeTextJSON(contentJSON, contentState); <br class="title-page-name"/>      this.setState({editorState}); <br class="title-page-name"/>    }; <br class="title-page-name"/><br class="title-page-name"/>    this.focus = () =&gt; this.refs['refWYSIWYGeditor'].focus(); <br class="title-page-name"/>    this.handleKeyCommand = (command) =&gt; <br class="title-page-name"/>     this._handleKeyCommand(command); <br class="title-page-name"/>  }
</pre>
<p class="calibre2">And the rest of this class is as follows:</p>
<pre class="calibre22">
  _handleKeyCommand(command) { <br class="title-page-name"/>    const {editorState} = this.state; <br class="title-page-name"/>    const newState = RichUtils.handleKeyCommand(editorState, <br class="title-page-name"/>     command); <br class="title-page-name"/><br class="title-page-name"/>    if (newState) { <br class="title-page-name"/>      this.onChange(newState); <br class="title-page-name"/>      return true; <br class="title-page-name"/>    } <br class="title-page-name"/>    return false; <br class="title-page-name"/>  } <br class="title-page-name"/><br class="title-page-name"/>  render() { <br class="title-page-name"/>    return &lt;h1&gt; WYSIWYGeditor&lt;/h1&gt;; <br class="title-page-name"/>  } <br class="title-page-name"/>}
</pre>
<p class="calibre2">The next step is to improve the <kbd class="calibre11">render</kbd> function with the following code:</p>
<pre class="calibre22">
 render() { <br class="title-page-name"/>    const { editorState } = this.state; <br class="title-page-name"/>    let className = 'RichEditor-editor'; <br class="title-page-name"/>    var contentState = editorState.getCurrentContent(); <br class="title-page-name"/><br class="title-page-name"/>    return ( <br class="title-page-name"/>      &lt;div&gt; <br class="title-page-name"/>        &lt;h4&gt;{this.props.title}&lt;/h4&gt; <br class="title-page-name"/>        &lt;div className='RichEditor-root'&gt; <br class="title-page-name"/>          &lt;div className={className} onClick={this.focus}&gt; <br class="title-page-name"/>            &lt;Editor <br class="title-page-name"/>              editorState={editorState} <br class="title-page-name"/>              handleKeyCommand={this.handleKeyCommand} <br class="title-page-name"/>              onChange={this.onChange} <br class="title-page-name"/>              ref='refWYSIWYGeditor' /&gt; <br class="title-page-name"/>          &lt;/div&gt; <br class="title-page-name"/>        &lt;/div&gt; <br class="title-page-name"/>      &lt;/div&gt; <br class="title-page-name"/>    ); <br class="title-page-name"/>  }
</pre>
<p class="calibre2">Here, what we have done is simply use the draft-js API in order to make a simple rich editor; later, we will make it more functional, but for now, let's focus on something simple.</p>


            </article>

            <footer class="calibre4">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">Improving the views/articles/AddArticleView component</h1>
            

            <article>
                
<p class="calibre2">Before we move forward with adding all the WYSIWYG features, such as bolding, we need to improve the <kbd class="calibre11">views/articles/AddArticleView.js</kbd> component with a few things. Install a library that will convert the draft-js state into plain HTML with the following:</p>
<pre class="calibre22">
<strong class="calibre1">npm i --save draft-js-export-html@0.1.13</strong>
</pre>
<p class="calibre2">We will use this library to save read-only plain HTML for our regular readers. Next, import this into <kbd class="calibre11">src/views/articles/AddArticleView.js</kbd>:</p>
<pre class="calibre22">
import { stateToHTML } from 'draft-js-export-html';
</pre>
<p class="calibre2">Improve <kbd class="calibre11">AddArticleView</kbd> by changing a constructor and adding a new function called <kbd class="calibre11">_onDraftJSChange</kbd>:</p>
<pre class="calibre22">
class AddArticleView extends React.Component { <br class="title-page-name"/>  constructor(props) { <br class="title-page-name"/>    super(props); <br class="title-page-name"/>    this._onDraftJSChange = this._onDraftJSChange.bind(this); <br class="title-page-name"/><br class="title-page-name"/>    this.state = { <br class="title-page-name"/>      contentJSON: {}, <br class="title-page-name"/>      htmlContent: '' <br class="title-page-name"/>    }; <br class="title-page-name"/>  } <br class="title-page-name"/><br class="title-page-name"/>  _onDraftJSChange(contentJSON, contentState) { <br class="title-page-name"/>    let htmlContent = stateToHTML(contentState); <br class="title-page-name"/>    this.setState({contentJSON, htmlContent}); <br class="title-page-name"/>  }
</pre>
<p class="calibre2">We need to save on each change a state of <kbd class="calibre11">this.setState({contentJSON, htmlContent});</kbd>. This is because <kbd class="calibre11">contentJSON</kbd> will be saved into the database in order to have immutable information about our WYSIWYG and <kbd class="calibre11">htmlContent</kbd> will be the server for our readers. Both <kbd class="calibre11">htmlContent</kbd> and <kbd class="calibre11">contentJSON</kbd> variables will be kept in the articles collection. The last thing in the <kbd class="calibre11">AddArticleView</kbd> class is to modify <kbd class="calibre11">render</kbd> to new code, as follows:</p>
<pre class="calibre22">
render () { <br class="title-page-name"/>   return ( <br class="title-page-name"/>     &lt;div style={{height: '100%', width: '75%', margin: 'auto'}}&gt; <br class="title-page-name"/>       &lt;h1&gt;Add Article&lt;/h1&gt; <br class="title-page-name"/>       &lt;WYSIWYGeditor <br class="title-page-name"/>         initialValue='' <br class="title-page-name"/>         title='Create an article' <br class="title-page-name"/>         onChangeTextJSON={this._onDraftJSChange} /&gt; <br class="title-page-name"/>     &lt;/div&gt; <br class="title-page-name"/>   ); <br class="title-page-name"/> }
</pre>
<p class="calibre2">After all these changes, the new view that you will see is this:</p>
<div class="packt_figure"><img class="image-border33" src="../images/00038.jpeg"/></div>


            </article>

            <footer class="calibre4">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">Adding more formatting features to our WYSIWYG</h1>
            

            <article>
                
<p class="calibre2">Let's start working on version two of our WYSIWYG, with more options, as in the following example:</p>
<div class="packt_figure"><img class="image-border34" src="../images/00039.jpeg"/></div>
<p class="calibre2">After you follow the steps mentioned here, you will be able to format your text as follows and extract the HTML markup from it as well so that we can save both the JSON state of our WYSIWYG and plain HTML in our MongoDB articles collection.</p>
<p class="calibre2">In the following new file, called <kbd class="calibre11">WYSIWYGbuttons.js</kbd>, we will export two different classes, and we will import them into <kbd class="calibre11">components/articles/WYSWIWYGeditor.js</kbd> using the following:</p>
<pre class="calibre22">
// don't write it, this is only an example:<br class="title-page-name"/>import { BlockStyleControls, InlineStyleControls } from <br class="title-page-name"/> './wysiwyg/WYSIWY<br class="title-page-name"/>    Gbuttons';
</pre>
<p class="calibre2">In general, that new file will have three different React components, as follows:</p>
<ul class="calibre14">
<li class="calibre15"><kbd class="calibre11">StyleButton</kbd>: This will be a generic-style button that will be used in both <kbd class="calibre11">BlockStyleControls</kbd> and <kbd class="calibre11">InlineStyleControls</kbd>. Don't get confused by the fact that in the <kbd class="calibre11">WYSIWYGbuttons</kbd> file, you are creating the <kbd class="calibre11">StyleButton</kbd> React component first.</li>
<li class="calibre15"><kbd class="calibre11">BlockStyleControls</kbd>: This is an exported component, which will be used for block controls such as <kbd class="calibre11">H1</kbd>, <kbd class="calibre11">H2</kbd>, <kbd class="calibre11">Blockquote</kbd>, <kbd class="calibre11">UL</kbd>, and <kbd class="calibre11">OL</kbd>.</li>
<li class="calibre15"><kbd class="calibre11">InlineStyleControls</kbd>: This component is used for bold, italics, and underline.</li>
</ul>
<p class="calibre2">Now we are aware that in the new file, you will create three separate React components.</p>
<p class="calibre2">First, we need to create the WYSWIG buttons in the <kbd class="calibre11">src/components/articles/wysiwyg/WYSIWYGbuttons.js</kbd> location:</p>
<pre class="calibre22">
<strong class="calibre1">$ [[you are in the src/components/articles directory of your project]]</strong><br class="title-page-name"/><strong class="calibre1">$ mkdir wysiwyg</strong><br class="title-page-name"/><strong class="calibre1">$ cd wysiwyg</strong><br class="title-page-name"/><strong class="calibre1">$ touch  WYSIWYGbuttons.js</strong>
</pre>
<p class="calibre2">The content of this file will be the buttons component:</p>
<pre class="calibre22">
import React from 'react'; <br class="title-page-name"/><br class="title-page-name"/>class StyleButton extends React.Component { <br class="title-page-name"/>  constructor() { <br class="title-page-name"/>    super(); <br class="title-page-name"/>    this.onToggle = (e) =&gt; { <br class="title-page-name"/>      e.preventDefault(); <br class="title-page-name"/>      this.props.onToggle(this.props.style); <br class="title-page-name"/>    }; <br class="title-page-name"/>  } <br class="title-page-name"/><br class="title-page-name"/>  render() { <br class="title-page-name"/>    let className = 'RichEditor-styleButton'; <br class="title-page-name"/>    if (this.props.active) { <br class="title-page-name"/>      className += ' RichEditor-activeButton'; <br class="title-page-name"/>    } <br class="title-page-name"/><br class="title-page-name"/>    return ( <br class="title-page-name"/>      &lt;span className={className} onMouseDown={this.onToggle}&gt; <br class="title-page-name"/>        {this.props.label} <br class="title-page-name"/>      &lt;/span&gt; <br class="title-page-name"/>    ); <br class="title-page-name"/>  } <br class="title-page-name"/>}
</pre>
<p class="calibre2">The preceding code is giving us a reusable button with a certain label at <kbd class="calibre11">this.props.label</kbd>. As mentioned before, don't get confused with <kbd class="calibre11">WYSIWYGbuttons</kbd>; it's a generic button component that will be reused in the inline and block type button controls.</p>
<p class="calibre2">Next, under that component, you can put the following object:</p>
<pre class="calibre22">
const BLOCK_TYPES = [ <br class="title-page-name"/>  {label: 'H1', style: 'header-one'}, <br class="title-page-name"/>  {label: 'H2', style: 'header-two'}, <br class="title-page-name"/>  {label: 'Blockquote', style: 'blockquote'}, <br class="title-page-name"/>  {label: 'UL', style: 'unordered-list-item'}, <br class="title-page-name"/>  {label: 'OL', style: 'ordered-list-item'} <br class="title-page-name"/>];
</pre>
<p class="calibre2">This object is block type, which we can create in our draft-js WYSIWYG. It is used in the following component:</p>
<pre class="calibre22">
export const BlockStyleControls = (props) =&gt; { <br class="title-page-name"/>  const {editorState} = props; <br class="title-page-name"/>  const selection = editorState.getSelection(); <br class="title-page-name"/>  const blockType = editorState <br class="title-page-name"/>    .getCurrentContent() <br class="title-page-name"/>    .getBlockForKey(selection.getStartKey()) <br class="title-page-name"/>    .getType(); <br class="title-page-name"/><br class="title-page-name"/>  return ( <br class="title-page-name"/>    &lt;div className='RichEditor-controls'&gt; <br class="title-page-name"/>      {BLOCK_TYPES.map((type) =&gt; <br class="title-page-name"/>        &lt;StyleButton <br class="title-page-name"/>          key={type.label} <br class="title-page-name"/>          active={type.style === blockType} <br class="title-page-name"/>          label={type.label} <br class="title-page-name"/>          onToggle={props.onToggle} <br class="title-page-name"/>          style={type.style} <br class="title-page-name"/>        /&gt; <br class="title-page-name"/>      )} <br class="title-page-name"/>    &lt;/div&gt; <br class="title-page-name"/>  ); <br class="title-page-name"/>};
</pre>
<p class="calibre2">The preceding code is a whole bunch of buttons for block-style formatting. We will import them into <kbd class="calibre11">WYSIWYGeditor</kbd> in a while. As you can see, we are exporting it with <kbd class="calibre11">export const BlockStyleControls = (props) =&gt; {</kbd>.</p>
<p class="calibre2">Put the next object under the <kbd class="calibre11">BlockStyleControls</kbd> component, but this time, for inline styles such as <kbd class="calibre11">Bold</kbd>:</p>
<pre class="calibre22">
var INLINE_STYLES = [ <br class="title-page-name"/>  {label: 'Bold', style: 'BOLD'}, <br class="title-page-name"/>  {label: 'Italic', style: 'ITALIC'}, <br class="title-page-name"/>  {label: 'Underline', style: 'UNDERLINE'} <br class="title-page-name"/>];
</pre>
<p class="calibre2">As you can see, in our WYSIWYG, an editor will be able to use bold, italics, and underline.</p>
<p class="calibre2">The last <span>component </span><span>for those inline styles that you can put under all this is the following:</span></p>
<pre class="calibre22">
export const InlineStyleControls = (props) =&gt; { <br class="title-page-name"/>  var currentStyle = props.editorState.getCurrentInlineStyle(); <br class="title-page-name"/>  return ( <br class="title-page-name"/>    &lt;div className='RichEditor-controls'&gt; <br class="title-page-name"/>      {INLINE_STYLES.map(type =&gt; <br class="title-page-name"/>        &lt;StyleButton <br class="title-page-name"/>          key={type.label} <br class="title-page-name"/>          active={currentStyle.has(type.style)} <br class="title-page-name"/>          label={type.label} <br class="title-page-name"/>          onToggle={props.onToggle} <br class="title-page-name"/>          style={type.style} <br class="title-page-name"/>        /&gt; <br class="title-page-name"/>      )} <br class="title-page-name"/>    &lt;/div&gt; <br class="title-page-name"/>  ); <br class="title-page-name"/>};
</pre>
<p class="calibre2">As you can see, this is very simple. We are mapping the defined styles in the blocks and inline styles each time, and based on each iteration, we are creating <kbd class="calibre11">StyleButton</kbd>.</p>
<p class="calibre2">The next step is to import both <kbd class="calibre11">InlineStyleControls</kbd> and <kbd class="calibre11">BlockStyleControls</kbd> in our <kbd class="calibre11">WYSIWYGeditor</kbd> component (<kbd class="calibre11">src/components/articles/WYSIWYGeditor.js</kbd>):</p>
<pre class="calibre22">
import { BlockStyleControls, InlineStyleControls } from './wysiwyg/WYSIWYGbuttons';
</pre>
<p class="calibre2">Then, in the <kbd class="calibre11">WYSIWYGeditor</kbd> constructor, include the following code:</p>
<pre class="calibre22">
this.toggleInlineStyle = (style) =&gt; <br class="title-page-name"/>this._toggleInlineStyle(style); <br class="title-page-name"/>this.toggleBlockType = (type) =&gt; this._toggleBlockType(type);
</pre>
<p class="calibre2">Bind to <kbd class="calibre11">toggleInlineStyle</kbd> and <kbd class="calibre11">toggleBlockType</kbd> two arrow functions, which will be the callbacks when someone chooses the toggle in order to use inline or block type in our <kbd class="calibre11">WYSIWYGeditor</kbd> (we will create those functions in a moment).</p>
<p class="calibre2">Create these two new functions:</p>
<pre class="calibre22">
<a class="calibre25"> _toggleBlockType(blockType) {</a><a class="calibre25">this.onChange(</a> <br class="title-page-name"/>      RichUtils.toggleBlockType( <br class="title-page-name"/>        this.state.editorState, <br class="title-page-name"/>        blockType <br class="title-page-name"/>      ) <br class="title-page-name"/>    ); <br class="title-page-name"/>  } <br class="title-page-name"/><br class="title-page-name"/>  _toggleInlineStyle(inlineStyle) { <br class="title-page-name"/>    this.onChange( <br class="title-page-name"/>      RichUtils.toggleInlineStyle( <br class="title-page-name"/>        this.state.editorState, <br class="title-page-name"/>        inlineStyle <br class="title-page-name"/>      ) <br class="title-page-name"/>    ); <br class="title-page-name"/>  }
</pre>
<p class="calibre2">Here, both functions are using the draft-js <kbd class="calibre11">RichUtils</kbd> in order to set flags inside our WYSIWYG. We are using certain formatting options from <kbd class="calibre11">BLOCK_TYPES</kbd> and <kbd class="calibre11">INLINE_STYLES</kbd> that we have defined in the <kbd class="calibre11">import { BlockStyleControls, InlineStyleControls }</kbd> from <kbd class="calibre11">'./wysiwg/WYSIWGbuttons';</kbd>.</p>
<p class="calibre2">After we are done improving our <kbd class="calibre11">WYSIWYGeditor</kbd> construction and the <kbd class="calibre11">_toggleBlockType</kbd> and <kbd class="calibre11">_toggleInlineStyle</kbd> functions, then we can start improving our <kbd class="calibre11">render</kbd> function:</p>
<pre class="calibre22">
 render() { <br class="title-page-name"/>    const { editorState } = this.state; <br class="title-page-name"/>    let className = 'RichEditor-editor'; <br class="title-page-name"/>    var contentState = editorState.getCurrentContent(); <br class="title-page-name"/><br class="title-page-name"/>    return ( <br class="title-page-name"/>      &lt;div&gt; <br class="title-page-name"/>        &lt;h4&gt;{this.props.title}&lt;/h4&gt; <br class="title-page-name"/>        &lt;div className='RichEditor-root'&gt; <br class="title-page-name"/>          &lt;BlockStyleControls <br class="title-page-name"/>            editorState={editorState} <br class="title-page-name"/>            onToggle={this.toggleBlockType} /&gt; <br class="title-page-name"/><br class="title-page-name"/>          &lt;InlineStyleControls <br class="title-page-name"/>            editorState={editorState} <br class="title-page-name"/>            onToggle={this.toggleInlineStyle} /&gt; <br class="title-page-name"/><br class="title-page-name"/>          &lt;div className={className} onClick={this.focus}&gt; <br class="title-page-name"/>            &lt;Editor <br class="title-page-name"/>              editorState={editorState} <br class="title-page-name"/>              handleKeyCommand={this.handleKeyCommand} <br class="title-page-name"/>              onChange={this.onChange} <br class="title-page-name"/>              ref='refWYSIWYGeditor' /&gt; <br class="title-page-name"/>          &lt;/div&gt; <br class="title-page-name"/>        &lt;/div&gt; <br class="title-page-name"/>      &lt;/div&gt; <br class="title-page-name"/>    ); <br class="title-page-name"/>  }
</pre>
<p class="calibre2">As you may notice, in the preceding code, we have only added the <kbd class="calibre11">BlockStyleControls</kbd> and <kbd class="calibre11">InlineStyleControls</kbd> component. Also notice that we are using callbacks with <kbd class="calibre11">onToggle={this.toggleBlockType}</kbd> and <kbd class="calibre11">onToggle={this.toggleInlineStyle}</kbd>; this is for communicating between our <kbd class="calibre11">WYSIWYGbuttons</kbd> and the draft-js <kbd class="calibre11">RichUtils</kbd> about what a user has clicked on and in which mode they are currently using (such as bold, header1, and UL or OL).</p>


            </article>

            <footer class="calibre4">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">Pushing a new article into article reducer</h1>
            

            <article>
                
<p class="calibre2">We need to create a new action called <kbd class="calibre11">pushNewArticle</kbd> in the <kbd class="calibre11">src/actions/article.js</kbd> location:</p>
<pre class="calibre22">
export default { <br class="title-page-name"/>  articlesList: (response) =&gt; { <br class="title-page-name"/>    return { <br class="title-page-name"/>      type: 'ARTICLES_LIST_ADD', <br class="title-page-name"/>      payload: { response: response } <br class="title-page-name"/>    } <br class="title-page-name"/>  }, <br class="title-page-name"/>  pushNewArticle: (response) =&gt; { <br class="title-page-name"/>    return { <br class="title-page-name"/>      type: 'PUSH_NEW_ARTICLE', <br class="title-page-name"/>      payload: { response: response } <br class="title-page-name"/>    } <br class="title-page-name"/>  } <br class="title-page-name"/>}
</pre>
<p class="calibre2">The next step is to improve the <kbd class="calibre11">src/components/ArticleCard.js</kbd> component by improving the <kbd class="calibre11">render</kbd> function in it:</p>
<pre class="calibre22">
return ( <br class="title-page-name"/>   &lt;Paper style={paperStyle}&gt; <br class="title-page-name"/>     &lt;CardHeader <br class="title-page-name"/>       title={this.props.title} <br class="title-page-name"/>       subtitle='Subtitle' <br class="title-page-name"/>       avatar='/static/avatar.png' <br class="title-page-name"/>     /&gt; <br class="title-page-name"/><br class="title-page-name"/>     &lt;div style={leftDivStyle}&gt; <br class="title-page-name"/>       &lt;Card &gt; <br class="title-page-name"/>         &lt;CardMedia <br class="title-page-name"/>           overlay={&lt;CardTitle title={title} subtitle='Overlay <br class="title-page-name"/>            subtitle' /&gt;}&gt; <br class="title-page-name"/>           &lt;img src='/static/placeholder.png' height='190' /&gt; <br class="title-page-name"/>         &lt;/CardMedia&gt; <br class="title-page-name"/>       &lt;/Card&gt; <br class="title-page-name"/>     &lt;/div&gt; <br class="title-page-name"/>     &lt;div style={rightDivStyle}&gt; <br class="title-page-name"/>       &lt;div dangerouslySetInnerHTML={{__html: content}} /&gt; <br class="title-page-name"/>     &lt;/div&gt; <br class="title-page-name"/>   &lt;/Paper&gt;); <br class="title-page-name"/>}
</pre>
<p class="calibre2">Here, we have replaced the old <kbd class="calibre11">{content}</kbd> variable (which was receiving a plain text value in the content's variable) to a new one that shows all of the HTML using <kbd class="calibre11">dangerouslySetInnerHTML</kbd> in the article card:</p>
<pre class="calibre22">
&lt;div dangerouslySetInnerHTML={{__html: content}} /&gt;
</pre>
<p class="calibre2">This will help us show our readers the HTML code generated by our WYSIWYG.</p>


            </article>

            <footer class="calibre4">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">MapHelpers for improving our reducers</h1>
            

            <article>
                
<p class="calibre2">In general, all reducers <em class="calibre21">must</em> return a new reference to an object when it has changed. In our first example, we used <kbd class="calibre11">Object.assign</kbd>:</p>
<pre class="calibre22">
// this already exsits in your codebasecase 'ARTICLES_LIST_ADD': <br class="title-page-name"/>let articlesList = action.payload.response; <br class="title-page-name"/>return Object.assign({}, articlesList);
</pre>
<p class="calibre2">We will replace this <kbd class="calibre11">Object.assign</kbd> approach with a new one, with ES6's Maps:</p>
<pre class="calibre22">
case 'ARTICLES_LIST_ADD': <br class="title-page-name"/>  let articlesList = action.payload.response; <br class="title-page-name"/>  return mapHelpers.addMultipleItems(state, articlesList);
</pre>
<p class="calibre2">In the preceding code, you can find a new <kbd class="calibre11">ARTICLES_LIST_ADD</kbd> with <kbd class="calibre11">mapHelpers.addMultipleItems(state, articlesList)</kbd>.</p>
<p class="calibre2">In order to make our map helpers, we need to create a new directory called <kbd class="calibre11">utils</kbd> and a file called <kbd class="calibre11">mapHelpers.js(src/utils/mapHelpers.js)</kbd>:</p>
<pre class="calibre22">
<strong class="calibre1">$ [[you are in the src/ directory of your project]]</strong><br class="title-page-name"/><strong class="calibre1">$ mkdir utils</strong><br class="title-page-name"/><strong class="calibre1">$ cd utils</strong><br class="title-page-name"/><strong class="calibre1">$ touch mapHelpers.js</strong>
</pre>
<p class="calibre2">And then, you can enter this first function into that <kbd class="calibre11">src/utils/mapHelpers.js</kbd> file:</p>
<pre class="calibre22">
const duplicate = (map) =&gt; { <br class="title-page-name"/>  const newMap = new Map(); <br class="title-page-name"/>  map.forEach((item, key) =&gt; { <br class="title-page-name"/>    if (item['_id']) { <br class="title-page-name"/>      newMap.set(item['_id'], item); <br class="title-page-name"/>    } <br class="title-page-name"/>  }); <br class="title-page-name"/>  return newMap; <br class="title-page-name"/>}; <br class="title-page-name"/><br class="title-page-name"/>const addMultipleItems = (map, items) =&gt; { <br class="title-page-name"/>  const newMap = duplicate(map); <br class="title-page-name"/><br class="title-page-name"/>  Object.keys(items).map((itemIndex) =&gt; { <br class="title-page-name"/>    let item = items[itemIndex]; <br class="title-page-name"/>    if (item['_id']) { <br class="title-page-name"/>      newMap.set(item['_id'], item); <br class="title-page-name"/>    } <br class="title-page-name"/>  }); <br class="title-page-name"/><br class="title-page-name"/>  return newMap; <br class="title-page-name"/>};
</pre>
<p class="calibre2">The duplicate simply creates a new reference in memory in order to make our immutability a requirement in Redux applications. We also are checking, with <kbd class="calibre11">if(key === item['_id'])</kbd>, whether there is an edge case that the key is different from our object ID (the <kbd class="calibre11">_</kbd> in <kbd class="calibre11">_id</kbd> is intentional as this is how Mongoose marks the ID from our DB).The <kbd class="calibre11">addMultipleItems</kbd> function adds items to the new duplicated map (for example, after a successful fetch of articles).</p>
<p class="calibre2">The next code change that we require is in the same file at <kbd class="calibre11">src/utils/mapHelpers.js</kbd>:</p>
<pre class="calibre22">
const addItem = (map, newKey, newItem) =&gt; { <br class="title-page-name"/>  const newMap = duplicate(map); <br class="title-page-name"/>  newMap.set(newKey, newItem); <br class="title-page-name"/>  return newMap; <br class="title-page-name"/>}; <br class="title-page-name"/><br class="title-page-name"/>const deleteItem = (map, key) =&gt; { <br class="title-page-name"/>  const newMap = duplicate(map); <br class="title-page-name"/>  newMap.delete(key); <br class="title-page-name"/><br class="title-page-name"/>  return newMap; <br class="title-page-name"/>}; <br class="title-page-name"/><br class="title-page-name"/><br class="title-page-name"/>export default { <br class="title-page-name"/>  addItem, <br class="title-page-name"/>  deleteItem, <br class="title-page-name"/>  addMultipleItems <br class="title-page-name"/>};
</pre>
<p class="calibre2">As you can see, we have added an <kbd class="calibre11">add</kbd> function and <kbd class="calibre11">delete</kbd> function for a single item. After that, we are exporting all that from <kbd class="calibre11">src/utils/mapHelpers.js</kbd>.</p>
<p class="calibre2">The next step is that we need to improve the <kbd class="calibre11">src/reducers/article.js</kbd> reducer in order to use the map utilities in it:</p>
<pre class="calibre22">
import mapHelpers from '../utils/mapHelpers'; <br class="title-page-name"/><br class="title-page-name"/>const article = (state = {}, action) =&gt; { <br class="title-page-name"/>  switch (action.type) { <br class="title-page-name"/>    case 'ARTICLES_LIST_ADD': <br class="title-page-name"/>      let articlesList = action.payload.response; <br class="title-page-name"/>      return mapHelpers.addMultipleItems(state, articlesList); <br class="title-page-name"/>    case 'PUSH_NEW_ARTICLE': <br class="title-page-name"/>      let newArticleObject = action.payload.response; <br class="title-page-name"/>      return mapHelpers.addItem(state, newArticleObject['_id'], <br class="title-page-name"/>       newArticleObject); <br class="title-page-name"/>    default: <br class="title-page-name"/>      return state; <br class="title-page-name"/>  } <br class="title-page-name"/>} <br class="title-page-name"/>export default article
</pre>
<p class="calibre2">What's new in the <kbd class="calibre11">src/reducers/article.js</kbd> file? As you can see, we have improved <kbd class="calibre11">ARTICLES_LIST_ADD</kbd> (already discussed). We have added a new <kbd class="calibre11">PUSH_NEW_ARTICLE</kbd>; case; this will push a new object into our reducer's state tree. It's similar to pushing an item to an array, but we use our reducer and maps instead.</p>


            </article>

            <footer class="calibre4">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">The CoreLayout improvements</h1>
            

            <article>
                
<p class="calibre2">Because we are switching to the ES6's Map in the frontend, we also need to make sure that after we receive an object with server-side rendering, it is also a Map (not a plain JS object). Check out the following code:</p>
<pre class="calibre22">
// The following is old codebase: <br class="title-page-name"/>import React from 'react'; <br class="title-page-name"/>import { Link } from 'react-router'; <br class="title-page-name"/>import themeDecorator from 'material-ui/lib/styles/theme- <br class="title-page-name"/> decorator'; <br class="title-page-name"/>import getMuiTheme from 'material-ui/lib/styles/getMuiTheme'; <br class="title-page-name"/>import RaisedButton from 'material-ui/lib/raised-button'; <br class="title-page-name"/>import AppBar from 'material-ui/lib/app-bar'; <br class="title-page-name"/>import ActionHome from 'material-ui/lib/svg-icons/action/home';
</pre>
<p class="calibre2">In the following new code snippet, you can find all the imports required in the <kbd class="calibre11">CoreLayout</kbd> component:</p>
<pre class="calibre22">
import React from 'react'; <br class="title-page-name"/>import {Link} from 'react-router'; <br class="title-page-name"/>import themeDecorator from 'material-ui/lib/styles/theme- <br class="title-page-name"/> decorator'; <br class="title-page-name"/>import getMuiTheme from 'material-ui/lib/styles/getMuiTheme'; <br class="title-page-name"/>import RaisedButton from 'material-ui/lib/raised-button'; <br class="title-page-name"/>import AppBar from 'material-ui/lib/app-bar'; <br class="title-page-name"/>import ActionHome from 'material-ui/lib/svg-icons/action/home'; <br class="title-page-name"/>import {connect} from 'react-redux'; <br class="title-page-name"/>import {bindActionCreators} from 'redux'; <br class="title-page-name"/>import articleActions from '../actions/article.js'; <br class="title-page-name"/><br class="title-page-name"/>const mapStateToProps = (state) =&gt; ({ <br class="title-page-name"/>  ...state <br class="title-page-name"/>}); <br class="title-page-name"/><br class="title-page-name"/>const mapDispatchToProps = (dispatch) =&gt; ({ <br class="title-page-name"/>  articleActions: bindActionCreators(articleActions, dispatch) <br class="title-page-name"/>});
</pre>
<p class="calibre2">Above the <kbd class="calibre11">CoreLayout</kbd> component, we have added the Redux tools, so we will have a state tree and the actions available in the <kbd class="calibre11">CoreLayout</kbd> component.</p>
<p class="calibre2">Also, in the <kbd class="calibre11">CoreLayout</kbd> component, add the <kbd class="calibre11">componentWillMount</kbd> function:</p>
<pre class="calibre22">
  componentWillMount() { <br class="title-page-name"/>    if (typeof window !== 'undefined' &amp;&amp; !this.props.article.get) <br class="title-page-name"/>     { <br class="title-page-name"/>      this.props.articleActions.articlesList(this.props.article); <br class="title-page-name"/>    } <br class="title-page-name"/>  }
</pre>
<p class="calibre2">This function is responsible for checking whether an article's properties are an ES6 Map or not. If not, then we send an action to <kbd class="calibre11">articlesList</kbd> that makes the job done, and after that, we have maps in <kbd class="calibre11">this.props.article</kbd>.</p>
<p class="calibre2">The last thing is to improve <kbd class="calibre11">export</kbd> in the <kbd class="calibre11">CoreLayout</kbd> component:</p>
<pre class="calibre22">
const muiCoreLayout = themeDecorator(getMuiTheme(null, { <br class="title-page-name"/> userAgent: 'all' }))(CoreLayout); <br class="title-page-name"/> export default connect(mapStateToProps, <br class="title-page-name"/> mapDispatchToProps)(muiCoreLayout);
</pre>
<p class="calibre2">The preceding code helps us connect to the Redux single-state tree and the actions it allows.</p>


            </article>

            <footer class="calibre4">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">Why Maps over a JS object?</h1>
            

            <article>
                
<p class="calibre2">In general, an ES6 Map has some features for easy data manipulation---functions such as <kbd class="calibre11">.get</kbd> and <kbd class="calibre11">.set</kbd> which make programming more pleasurable. It also helps to have a simpler code to be able to keep our immutability as required by Redux.</p>
<p class="calibre2">Map methods are much easier to use than <kbd class="calibre11">slice/c-oncat/Object.assign</kbd>. I am sure that there are always some cons/pros to each approach, but in our app, we will use an ES6 Map-wise approach in order to keep things simpler after we are completely set up with it.</p>


            </article>

            <footer class="calibre4">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">Improving PublishingApp and DashboardView</h1>
            

            <article>
                
<p class="calibre2">In the <kbd class="calibre11">src/layouts/PublishingApp.js</kbd> file, we need to improve our <kbd class="calibre11">render</kbd> function:</p>
<pre class="calibre22">
render () { <br class="title-page-name"/><br class="title-page-name"/>  let articlesJSX = []; <br class="title-page-name"/><br class="title-page-name"/>  this.props.article.forEach((articleDetails, articleKey) =&gt; { <br class="title-page-name"/>    const currentArticleJSX = ( <br class="title-page-name"/>      &lt;div key={articleKey}&gt; <br class="title-page-name"/>        &lt;ArticleCard  <br class="title-page-name"/>          title={articleDetails.articleTitle} <br class="title-page-name"/>          content={articleDetails.articleContent} /&gt; <br class="title-page-name"/>      &lt;/div&gt; <br class="title-page-name"/>    ); <br class="title-page-name"/><br class="title-page-name"/>    articlesJSX.push(currentArticleJSX); <br class="title-page-name"/>  }); <br class="title-page-name"/><br class="title-page-name"/>  return ( <br class="title-page-name"/>    &lt;div style={{height: '100%', width: '75%', margin: 'auto'}}&gt; <br class="title-page-name"/>        {articlesJSX} <br class="title-page-name"/>    &lt;/div&gt; <br class="title-page-name"/>  ); <br class="title-page-name"/>}
</pre>
<p class="calibre2">As you can see in the preceding code, we switched the old <kbd class="calibre11">for(let articleKey in this.props.article) {</kbd> code into <kbd class="calibre11">this.props.article.forEach</kbd> because we have switched from objects to using Maps.</p>
<p class="calibre2">We need to do the same in the <kbd class="calibre11">src/views/DashboardView.js</kbd> file's <kbd class="calibre11">render</kbd> function:</p>
<pre class="calibre22">
render () { <br class="title-page-name"/><br class="title-page-name"/>  let articlesJSX = []; <br class="title-page-name"/>  this.props.article.forEach((articleDetails, articleKey) =&gt; { <br class="title-page-name"/>    const currentArticleJSX = ( <br class="title-page-name"/>      &lt;ListItem <br class="title-page-name"/>        key={articleKey} <br class="title-page-name"/>        leftAvatar={&lt;img src='/static/placeholder.png'  <br class="title-page-name"/>    width='50'  <br class="title-page-name"/>    height='50' /&gt;} <br class="title-page-name"/>        primaryText={articleDetails.articleTitle} <br class="title-page-name"/>        secondaryText={articleDetails.articleContent} <br class="title-page-name"/>      /&gt; <br class="title-page-name"/>    ); <br class="title-page-name"/><br class="title-page-name"/>    articlesJSX.push(currentArticleJSX); <br class="title-page-name"/>  }); <br class="title-page-name"/><br class="title-page-name"/>  return ( <br class="title-page-name"/>    &lt;div style={{height: '100%', width: '75%', margin: 'auto'}}&gt; <br class="title-page-name"/>      &lt;Link to='/add-article'&gt; <br class="title-page-name"/>        &lt;RaisedButton  <br class="title-page-name"/>          label='Create an article'  <br class="title-page-name"/>          secondary={true}  <br class="title-page-name"/>          style={{margin: '20px 20px 20px 20px'}} /&gt; <br class="title-page-name"/>      &lt;/Link&gt; <br class="title-page-name"/><br class="title-page-name"/>      &lt;List&gt; <br class="title-page-name"/>        {articlesJSX} <br class="title-page-name"/>      &lt;/List&gt; <br class="title-page-name"/>    &lt;/div&gt; <br class="title-page-name"/>  ); <br class="title-page-name"/>}
</pre>
<p class="calibre2">For the same reason as in the <kbd class="calibre11">PublishingApp</kbd> component, we switched to using ES6's new Map, and we will be also using the new ES6 <kbd class="calibre11">forEach</kbd> method:</p>
<pre class="calibre22">
this.props.article.forEach((articleDetails, articleKey) =&gt; {
</pre>


            </article>

            <footer class="calibre4">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">Tweaks to AddArticleView</h1>
            

            <article>
                
<p class="calibre2">After we are finished preparing our app to save a new article into the article's reducer, we need to tweak the <kbd class="calibre11">src/views/articles/AddArticleView.js</kbd> component. New imports in the <kbd class="calibre11">AddArticleView.js</kbd> are as follows:</p>
<pre class="calibre22">
import {bindActionCreators} from 'redux'; <br class="title-page-name"/>import {Link} from 'react-router'; <br class="title-page-name"/>import articleActions from '../../actions/article.js'; <br class="title-page-name"/>import RaisedButton from 'material-ui/lib/raised-button';
</pre>
<p class="calibre2">As you can see in the preceding code, we are importing <kbd class="calibre11">RaisedButton</kbd> and <kbd class="calibre11">Link</kbd>, which will be useful for redirecting an editor to the dashboard's view after a successful article addition. Then, we import <kbd class="calibre11">articleActions</kbd> because we need to make the <kbd class="calibre11">this.props.articleActions.pushNewArticle(newArticle);</kbd> action on article submit. The <kbd class="calibre11">bindActionCreators</kbd> will already be imported in your <kbd class="calibre11">AddArticleView</kbd> if you followed instructions from previous chapters.</p>
<p class="calibre2">Use <kbd class="calibre11">bindActionCreators</kbd> in order to have <kbd class="calibre11">articleActions</kbd> in the <kbd class="calibre11">AddArticleView</kbd> component by replacing this code snippet:</p>
<pre class="calibre22">
// this is old code, you shall have it already <br class="title-page-name"/>const mapDispatchToProps = (dispatch) =&gt; ({ <br class="title-page-name"/>});
</pre>
<p class="calibre2">Here is the new <kbd class="calibre11">bindActionCreators</kbd> code:</p>
<pre class="calibre22">
const mapDispatchToProps = (dispatch) =&gt; ({ <br class="title-page-name"/>  articleActions: bindActionCreators(articleActions, dispatch) <br class="title-page-name"/>});
</pre>
<p class="calibre2">The following is an updated constructor of the <kbd class="calibre11">AddArticleView</kbd> component:</p>
<pre class="calibre22">
 constructor(props) { <br class="title-page-name"/>    super(props); <br class="title-page-name"/>    this._onDraftJSChange = this._onDraftJSChange.bind(this); <br class="title-page-name"/>    this._articleSubmit = this._articleSubmit.bind(this); <br class="title-page-name"/><br class="title-page-name"/>    this.state = { <br class="title-page-name"/>      title: 'test', <br class="title-page-name"/>      contentJSON: {}, <br class="title-page-name"/>      htmlContent: '', <br class="title-page-name"/>      newArticleID: null <br class="title-page-name"/>    }; <br class="title-page-name"/>  }
</pre>
<p class="calibre2">The <kbd class="calibre11">_articleSubmit</kbd> method will be required after an editor wants to add an article. We have also added some default states for our title, <kbd class="calibre11">contentJSON</kbd> (we will keep the draft-js article state there), <kbd class="calibre11">htmlContent</kbd>, and the <kbd class="calibre11">newArticleID</kbd>. The next step is to create the <kbd class="calibre11">_articleSubmit</kbd> function:</p>
<pre class="calibre22">
 _articleSubmit() { <br class="title-page-name"/>    let newArticle = { <br class="title-page-name"/>      articleTitle: this.state.title, <br class="title-page-name"/>      articleContent: this.state.htmlContent, <br class="title-page-name"/>      articleContentJSON: this.state.contentJSON <br class="title-page-name"/>    } <br class="title-page-name"/><br class="title-page-name"/>    let newArticleID = 'MOCKEDRandomid' + Math.floor(Math.random() <br class="title-page-name"/>     * 10000); <br class="title-page-name"/><br class="title-page-name"/>    newArticle['_id'] = newArticleID; <br class="title-page-name"/>    this.props.articleActions.pushNewArticle(newArticle); <br class="title-page-name"/>    this.setState({ newArticleID: newArticleID}); <br class="title-page-name"/>  }
</pre>
<p class="calibre2">As you can see here, we get the state of our current writing with <kbd class="calibre11">this.state.title</kbd>, <kbd class="calibre11">this.state.htmlContent</kbd>, and <kbd class="calibre11">this.state.contentJSON</kbd>, and based on that, we then create a <kbd class="calibre11">newArticle</kbd> model:</p>
<pre class="calibre22">
let newArticle = { <br class="title-page-name"/>  articleTitle: this.state.title, <br class="title-page-name"/>  articleContent: this.state.htmlContent, <br class="title-page-name"/>  articleContentJSON: this.state.contentJSON <br class="title-page-name"/>}
</pre>
<p class="calibre2">Then we mock the new article's ID (later, we will save it to the DB) with <kbd class="calibre11">newArticle['_id'] = newArticleID;</kbd> and push it into our article's reducer with <kbd class="calibre11">this.props.articleActions.pushNewArticle(newArticle);</kbd>. The only thing is to set up <kbd class="calibre11">newarticleID</kbd> with <kbd class="calibre11">this.setState({ newArticleID: newArticleID});</kbd>. The last step is to update our <kbd class="calibre11">render</kbd> method in the <kbd class="calibre11">AddArticleView</kbd> component:</p>
<pre class="calibre22">
 render () { <br class="title-page-name"/>    if (this.state.newArticleID) { <br class="title-page-name"/>      return ( <br class="title-page-name"/>        &lt;div style={{height: '100%', width: '75%', margin: <br class="title-page-name"/>         'auto'}}&gt; <br class="title-page-name"/>          &lt;h3&gt;Your new article ID is <br class="title-page-name"/>           {this.state.newArticleID}&lt;/h3&gt; <br class="title-page-name"/>          &lt;Link to='/dashboard'&gt; <br class="title-page-name"/>            &lt;RaisedButton <br class="title-page-name"/>              secondary={true} <br class="title-page-name"/>              type='submit' <br class="title-page-name"/>              style={{margin: '10px auto', display: 'block', <br class="title-page-name"/>               width: 150}} <br class="title-page-name"/>              label='Done' /&gt; <br class="title-page-name"/>          &lt;/Link&gt; <br class="title-page-name"/>        &lt;/div&gt; <br class="title-page-name"/>      ); <br class="title-page-name"/>    } <br class="title-page-name"/><br class="title-page-name"/>    return ( <br class="title-page-name"/>      &lt;div style={{height: '100%', width: '75%', margin: 'auto'}}&gt; <br class="title-page-name"/>        &lt;h1&gt;Add Article&lt;/h1&gt; <br class="title-page-name"/>        &lt;WYSIWYGeditor <br class="title-page-name"/>          name='addarticle' <br class="title-page-name"/><br class="title-page-name"/>          onChangeTextJSON={this._onDraftJSChange} /&gt; <br class="title-page-name"/>          &lt;RaisedButton <br class="title-page-name"/>            onClick={this._articleSubmit} <br class="title-page-name"/>            secondary={true} <br class="title-page-name"/>            type='submit' <br class="title-page-name"/>            style={{margin: '10px auto', display: 'block', width: <br class="title-page-name"/>             150}} <br class="title-page-name"/>            label={'Submit Article'} /&gt; <br class="title-page-name"/>      &lt;/div&gt; <br class="title-page-name"/>    ); <br class="title-page-name"/>  }
</pre>
<p class="calibre2">Here in the <kbd class="calibre11">render</kbd> method, we have one statement that checks whether an article's editor has already created an article (clicked on the <span>Submit Article</span> button) with <kbd class="calibre11">if(this.state.newArticleID)</kbd>. If yes, then the editor will see his new article's ID and a button that links to the dashboard (link is <kbd class="calibre11">to='/dashboard'</kbd>).</p>
<p class="calibre2">The second return is in case an editor is in edit mode; if yes, then he can submit it by clicking on the <kbd class="calibre11">RaisedButton</kbd> component with the <kbd class="calibre11">onClick</kbd> method's called <kbd class="calibre11">_articleSubmit</kbd>.</p>


            </article>

            <footer class="calibre4">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">The ability to edit an article (the EditArticleView component)</h1>
            

            <article>
                
<p class="calibre2">We can add an article, but we can't edit it yet. Let's implement that feature.</p>
<p class="calibre2">The first thing to do is to create a route in <kbd class="calibre11">src/routes/index.js</kbd>:</p>
<pre class="calibre22">
import EditArticleView from '../views/articles/EditArticleView';
</pre>
<p class="calibre2">Then edit the routes:</p>
<pre class="calibre22">
export default ( <br class="title-page-name"/>  &lt;Route component={CoreLayout} path='/'&gt; <br class="title-page-name"/>    &lt;IndexRoute component={PublishingApp} name='home' /&gt; <br class="title-page-name"/>    &lt;Route component={LoginView} path='login' name='login' /&gt; <br class="title-page-name"/>    &lt;Route component={LogoutView} path='logout' name='logout' /&gt; <br class="title-page-name"/>    &lt;Route component={RegisterView} path='register' <br class="title-page-name"/>     name='register' /&gt; <br class="title-page-name"/>    &lt;Route component={DashboardView} <br class="title-page-name"/>    path='dashboard' name='dashboard' /&gt; <br class="title-page-name"/>    &lt;Route component={AddArticleView} <br class="title-page-name"/>    path='add-article' name='add-article' /&gt; <br class="title-page-name"/>    &lt;Route component={EditArticleView} <br class="title-page-name"/>  path='/edit-article/:articleID' name='edit-article' /&gt; <br class="title-page-name"/>  &lt;/Route&gt; <br class="title-page-name"/>);
</pre>
<p class="calibre2">As you can see, we have added the <kbd class="calibre11">EditArticleViews</kbd> route with <kbd class="calibre11">path='/edit-article/:articleID'</kbd>; as you should know already, the <kbd class="calibre11">articleID</kbd> will be sent to us with props as <kbd class="calibre11">this.props.params.articleID</kbd> (this is a default feature of <kbd class="calibre11">redux-router</kbd>).</p>
<p class="calibre2">The next step is to create the <kbd class="calibre11">src/views/articles/EditArticleView.js</kbd> component, which is a new component (mocked for now):</p>
<pre class="calibre22">
import React from 'react'; <br class="title-page-name"/>import Falcor from 'falcor'; <br class="title-page-name"/>import {Link} from 'react-router'; <br class="title-page-name"/>import falcorModel from '../../falcorModel.js'; <br class="title-page-name"/>import {connect} from 'react-redux'; <br class="title-page-name"/>import {bindActionCreators} from 'redux'; <br class="title-page-name"/>import articleActions from '../../actions/article.js'; <br class="title-page-name"/>import WYSIWYGeditor from '../../components/articles/WYSIWYGeditor'; <br class="title-page-name"/>import {stateToHTML} from 'draft-js-export-html'; <br class="title-page-name"/>import RaisedButton from 'material-ui/lib/raised-button'; <br class="title-page-name"/><br class="title-page-name"/>const mapStateToProps = (state) =&gt; ({ <br class="title-page-name"/>  ...state <br class="title-page-name"/>}); <br class="title-page-name"/><br class="title-page-name"/>const mapDispatchToProps = (dispatch) =&gt; ({ <br class="title-page-name"/>  articleActions: bindActionCreators(articleActions, dispatch) <br class="title-page-name"/>}); <br class="title-page-name"/><br class="title-page-name"/>class EditArticleView extends React.Component { <br class="title-page-name"/>  constructor(props) { <br class="title-page-name"/>    super(props); <br class="title-page-name"/>  } <br class="title-page-name"/><br class="title-page-name"/>  render () { <br class="title-page-name"/>    return &lt;h1&gt;An edit article MOCK&lt;/h1&gt; <br class="title-page-name"/>  } <br class="title-page-name"/>} <br class="title-page-name"/>export default connect(mapStateToProps, <br class="title-page-name"/> mapDispatchToProps)(EditArticleView);
</pre>
<p class="calibre2">Here, you can find a standard view component with a <kbd class="calibre11">render</kbd> function that returns a mock (we will improve it later). We have already put all the required imports in place (we will use all of them in the next iteration of the <kbd class="calibre11">EditArticleView</kbd> component).</p>


            </article>

            <footer class="calibre4">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">Let's add a dashboard link to an article's edition</h1>
            

            <article>
                
<p class="calibre2">Make a small tweak in <kbd class="calibre11">src/views/DashboardView.js</kbd>:</p>
<pre class="calibre22">
 let articlesJSX = []; <br class="title-page-name"/>  this.props.article.forEach((articleDetails, articleKey) =&gt; { <br class="title-page-name"/>    let currentArticleJSX = ( <br class="title-page-name"/>      &lt;Link to={&amp;grave;/edit-article/${articleDetails['_id']}&amp;grave;} <br class="title-page-name"/>       key={articleKey}&gt; <br class="title-page-name"/>        &lt;ListItem <br class="title-page-name"/>          leftAvatar={&lt;img  <br class="title-page-name"/>          src='/static/placeholder.png' <br class="title-page-name"/>          width='50' <br class="title-page-name"/>          height='50' /&gt;} <br class="title-page-name"/>          primaryText={articleDetails.articleTitle} <br class="title-page-name"/>          secondaryText={articleDetails.articleContent} <br class="title-page-name"/>        /&gt; <br class="title-page-name"/>      &lt;/Link&gt; <br class="title-page-name"/>    ); <br class="title-page-name"/><br class="title-page-name"/>    articlesJSX.push(currentArticleJSX); <br class="title-page-name"/>  });
</pre>
<p class="calibre2">Here, we have two things that need to be changed: adding a <kbd class="calibre11">Link</kbd> attribute to <kbd class="calibre11">to={/edit-article/${articleDetails['_id']}</kbd>. This will redirect a user to the article's edition view after clicking on <kbd class="calibre11">ListItem</kbd>. We also need to give a <kbd class="calibre11">Link</kbd> element a unique key property.</p>


            </article>

            <footer class="calibre4">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">Creating a new action and reducer</h1>
            

            <article>
                
<p class="calibre2">Modify the <kbd class="calibre11">src/actions/article.js</kbd> file and add this new action called <kbd class="calibre11">EDIT_ARTICLE</kbd>:</p>
<pre class="calibre22">
export default { <br class="title-page-name"/>  articlesList: (response) =&gt; { <br class="title-page-name"/>    return { <br class="title-page-name"/>      type: 'ARTICLES_LIST_ADD', <br class="title-page-name"/>      payload: { response: response } <br class="title-page-name"/>    } <br class="title-page-name"/>  }, <br class="title-page-name"/>  pushNewArticle: (response) =&gt; { <br class="title-page-name"/>    return { <br class="title-page-name"/>      type: 'PUSH_NEW_ARTICLE', <br class="title-page-name"/>      payload: { response: response } <br class="title-page-name"/>    } <br class="title-page-name"/>  }, <br class="title-page-name"/>  editArticle: (response) =&gt; { <br class="title-page-name"/>    return { <br class="title-page-name"/>      type: 'EDIT_ARTICLE', <br class="title-page-name"/>      payload: { response: response } <br class="title-page-name"/>    } <br class="title-page-name"/>  } <br class="title-page-name"/>}
</pre>
<p class="calibre2">The next step is to improve our reducer at <kbd class="calibre11">src/reducers/article.js</kbd>:</p>
<pre class="calibre22">
import mapHelpers from '../utils/mapHelpers'; <br class="title-page-name"/><br class="title-page-name"/>const article = (state = {}, action) =&gt; { <br class="title-page-name"/>  switch (action.type) { <br class="title-page-name"/>    case 'ARTICLES_LIST_ADD': <br class="title-page-name"/>      let articlesList = action.payload.response; <br class="title-page-name"/>      return mapHelpers.addMultipleItems(state, articlesList); <br class="title-page-name"/>    case 'PUSH_NEW_ARTICLE': <br class="title-page-name"/>      let newArticleObject = action.payload.response; <br class="title-page-name"/>      return mapHelpers.addItem(state, newArticleObject['_id'], <br class="title-page-name"/>       newArticleObject); <br class="title-page-name"/>    case 'EDIT_ARTICLE': <br class="title-page-name"/>      let editedArticleObject = action.payload.response; <br class="title-page-name"/>      return mapHelpers.addItem(state, editedArticleObject['_id'], <br class="title-page-name"/>       editedArticleObject); <br class="title-page-name"/>    default: <br class="title-page-name"/>      return state; <br class="title-page-name"/>  } <br class="title-page-name"/>};export default article;
</pre>
<p class="calibre2">As you can find here, we have added a new <kbd class="calibre11">switch</kbd> case for <kbd class="calibre11">EDIT_ARTICLE</kbd>. We use our <kbd class="calibre11">mapHelpers.addItem</kbd>; in general, if <kbd class="calibre11">_id</kbd> does exist in Map, then it replaces a value (this works great for editing actions).</p>


            </article>

            <footer class="calibre4">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">Edit mode in src/components/articles/WYSIWYGeditor.js</h1>
            

            <article>
                
<p class="calibre2">Let's now implement the ability to use the edit mode in our <kbd class="calibre11">WYSIWYGeditor</kbd> components by improving our construction in the <kbd class="calibre11">WYSIWYGeditor.js</kbd> file:</p>
<pre class="calibre22">
export default class  WYSIWYGeditor extends React.Component { <br class="title-page-name"/>  constructor(props) { <br class="title-page-name"/>    super(props); <br class="title-page-name"/><br class="title-page-name"/>    let initialEditorFromProps; <br class="title-page-name"/><br class="title-page-name"/>    if (typeof props.initialValue === 'undefined' || typeof <br class="title-page-name"/>     props.initialValue !== 'object') { <br class="title-page-name"/>      initialEditorFromProps = <br class="title-page-name"/>       EditorState.createWithContent <br class="title-page-name"/>       (ContentState.createFromText('')); <br class="title-page-name"/>    } else { <br class="title-page-name"/>      let isInvalidObject = typeof props.initialValue.entityMap <br class="title-page-name"/>       === 'undefined' || typeof props.initialValue.blocks === <br class="title-page-name"/>       'undefined'; <br class="title-page-name"/><br class="title-page-name"/>      if (isInvalidObject) { <br class="title-page-name"/>        alert('Invalid article-edit error provided, exit'); <br class="title-page-name"/>        return; <br class="title-page-name"/>      } <br class="title-page-name"/>      let draftBlocks = convertFromRaw(props.initialValue); <br class="title-page-name"/>      let contentToConsume = <br class="title-page-name"/>       ContentState.createFromBlockArray(draftBlocks); <br class="title-page-name"/><br class="title-page-name"/>      initialEditorFromProps = <br class="title-page-name"/>       EditorState.createWithContent(contentToConsume); <br class="title-page-name"/>    } <br class="title-page-name"/><br class="title-page-name"/>    this.state = { <br class="title-page-name"/>      editorState: initialEditorFromProps <br class="title-page-name"/>    }; <br class="title-page-name"/><br class="title-page-name"/>    this.focus = () =&gt; this.refs['refWYSIWYGeditor'].focus(); <br class="title-page-name"/>    this.onChange = (editorState) =&gt; {  <br class="title-page-name"/>      var contentState = editorState.getCurrentContent(); <br class="title-page-name"/><br class="title-page-name"/>      let contentJSON = convertToRaw(contentState); <br class="title-page-name"/>      props.onChangeTextJSON(contentJSON, contentState); <br class="title-page-name"/>      this.setState({editorState})  <br class="title-page-name"/>    }; <br class="title-page-name"/><br class="title-page-name"/>    this.handleKeyCommand = (command) =&gt; <br class="title-page-name"/>     this._handleKeyCommand(command); <br class="title-page-name"/>      this.toggleInlineStyle = (style) =&gt; <br class="title-page-name"/>       this._toggleInlineStyle(style); <br class="title-page-name"/>      this.toggleBlockType = (type) =&gt; <br class="title-page-name"/>       this._toggleBlockType(type); <br class="title-page-name"/>  }
</pre>
<p class="calibre2">Here you can find out how your constructor will look after making changes.</p>
<p class="calibre2">As you already know, draft-js is required to be an object, so we check in the first <kbd class="calibre11">if</kbd> statement whether it is one. Then, if not, we put an empty WYSIWYG as default (check <kbd class="calibre11">if(typeof props.initialValue === 'undefined' || typeof props.initialValue !== 'object'))</kbd>.</p>
<p class="calibre2">In the <kbd class="calibre11">else</kbd> statement, we put the following:</p>
<pre class="calibre22">
let isInvalidObject = typeof props.initialValue.entityMap === <br class="title-page-name"/> 'undefined' || typeof blocks === 'undefined'; <br class="title-page-name"/>if (isInvalidObject) { <br class="title-page-name"/>  alert('Error: Invalid article-edit object provided, exit'); <br class="title-page-name"/>  return; <br class="title-page-name"/>} <br class="title-page-name"/>let draftBlocks = convertFromRaw(props.initialValue); <br class="title-page-name"/>let contentToConsume = <br class="title-page-name"/> ContentState.createFromBlockArray(draftBlocks); <br class="title-page-name"/> initialEditorFromProps = <br class="title-page-name"/> EditorState.createWithContent(contentToConsume);
</pre>
<p class="calibre2">Here we check whether we have a valid draft-js JSON object; if not, we need to throw a critical error and return, because otherwise, the error can crash the whole browser (we need to handle that edge case with <kbd class="calibre11">withif(isInvalidObject))</kbd>.</p>
<p class="calibre2">After we have a valid object, we recover the state of our WYSIWYG editor with the use of the <kbd class="calibre11">convertFromRaw</kbd>, <kbd class="calibre11">ContentState.createFromBlockArray</kbd>, and <kbd class="calibre11">EditorState.createWithContent</kbd> functions provided by the draft-js library.</p>


            </article>

            <footer class="calibre4">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">Improvements in EditArticleView</h1>
            

            <article>
                
<p class="calibre2">The last improvement before finishing the article edit mode is improving <kbd class="calibre11">src/views/articles/EditArticleView.js</kbd>:</p>
<pre class="calibre22">
class EditArticleView extends React.Component { <br class="title-page-name"/>  constructor(props) { <br class="title-page-name"/>    super(props); <br class="title-page-name"/>    this._onDraftJSChange = this._onDraftJSChange.bind(this); <br class="title-page-name"/>    this._articleEditSubmit = this._articleEditSubmit.bind(this); <br class="title-page-name"/>    this._fetchArticleData = this._fetchArticleData.bind(this); <br class="title-page-name"/><br class="title-page-name"/>    this.state = { <br class="title-page-name"/>      articleFetchError: null, <br class="title-page-name"/>      articleEditSuccess: null, <br class="title-page-name"/>      editedArticleID: null, <br class="title-page-name"/>      articleDetails: null, <br class="title-page-name"/>      title: 'test', <br class="title-page-name"/>      contentJSON: {}, <br class="title-page-name"/>      htmlContent: '' <br class="title-page-name"/>    }; <br class="title-page-name"/>  }
</pre>
<p class="calibre2">This is our constructor; we will have some states variables such as <kbd class="calibre11">articleFetchError</kbd>, <kbd class="calibre11">articleEditSuccess</kbd>, <kbd class="calibre11">editedArticleID</kbd>, <kbd class="calibre11">articleDetails</kbd>, <kbd class="calibre11">title</kbd>, <kbd class="calibre11">contentJSON</kbd>, and <kbd class="calibre11">htmlContent</kbd>.</p>
<p class="calibre2">In general, all these variables are self-explanatory. Regarding the <kbd class="calibre11">articleDetails</kbd> variable here, we will keep the whole object fetched from a <kbd class="calibre11">reducer/mongoDB</kbd>. Things such as <kbd class="calibre11">title</kbd>, <kbd class="calibre11">contentHTML</kbd>, and <kbd class="calibre11">contentJSON</kbd> are kept in the <kbd class="calibre11">articleDetails</kbd> state (as you will find in a moment).</p>
<p class="calibre2">After you are done with the <kbd class="calibre11">EditArticleView</kbd> constructor, add some new functions:</p>
<pre class="calibre22">
 componentWillMount() { <br class="title-page-name"/>    this._fetchArticleData(); <br class="title-page-name"/>  } <br class="title-page-name"/><br class="title-page-name"/>  _fetchArticleData() { <br class="title-page-name"/>    let articleID = this.props.params.articleID; <br class="title-page-name"/>    if (typeof window !== 'undefined' &amp;&amp; articleID) { <br class="title-page-name"/>        let articleDetails = this.props.article.get(articleID); <br class="title-page-name"/>        if(articleDetails) { <br class="title-page-name"/>          this.setState({  <br class="title-page-name"/>            editedArticleID: articleID,  <br class="title-page-name"/>            articleDetails: articleDetails <br class="title-page-name"/>          }); <br class="title-page-name"/>        } else { <br class="title-page-name"/>          this.setState({ <br class="title-page-name"/>            articleFetchError: true <br class="title-page-name"/>          }) <br class="title-page-name"/>        } <br class="title-page-name"/>    } <br class="title-page-name"/>  } <br class="title-page-name"/><br class="title-page-name"/>  onDraftJSChange(contentJSON, contentState) { <br class="title-page-name"/>    let htmlContent = stateToHTML(contentState); <br class="title-page-name"/>    this.setState({contentJSON, htmlContent}); <br class="title-page-name"/>  } <br class="title-page-name"/><br class="title-page-name"/>  _articleEditSubmit() { <br class="title-page-name"/>    let currentArticleID = this.state.editedArticleID; <br class="title-page-name"/>    let editedArticle = { <br class="title-page-name"/>      _id: currentArticleID, <br class="title-page-name"/>      articleTitle: this.state.title, <br class="title-page-name"/>      articleContent: this.state.htmlContent, <br class="title-page-name"/>      articleContentJSON: this.state.contentJSON <br class="title-page-name"/>    } <br class="title-page-name"/><br class="title-page-name"/>    this.props.articleActions.editArticle(editedArticle); <br class="title-page-name"/>    this.setState({ articleEditSuccess: true }); <br class="title-page-name"/>  }
</pre>
<p class="calibre2">On <kbd class="calibre11">componentWillMount</kbd>, we will fetch data about the article with <kbd class="calibre11">_fetchArticleData</kbd>. The <kbd class="calibre11">_fetchArticleData</kbd> is getting the article's ID from props via <kbd class="calibre11">react-redux</kbd> (<kbd class="calibre11">let articleID = this.props.params.articleID;</kbd>). Then, we check whether we are not on the server side with <kbd class="calibre11">if(typeof window !== 'undefined' &amp;&amp; articleID)</kbd>. After this, we use the <kbd class="calibre11">.get</kbd> Map function in order to get details from a reducer (<kbd class="calibre11">let articleDetails = this.props.article.get(articleID);</kbd>), and based on the case, we set the state of our component with the following:</p>
<pre class="calibre22">
if (articleDetails) { <br class="title-page-name"/>  this.setState({  <br class="title-page-name"/>    editedArticleID: articleID,  <br class="title-page-name"/>    articleDetails: articleDetails <br class="title-page-name"/>  }); <br class="title-page-name"/>} else { <br class="title-page-name"/>  this.setState({ <br class="title-page-name"/>    articleFetchError: true <br class="title-page-name"/>  }) <br class="title-page-name"/>}
</pre>
<p class="calibre2">Here you can find that in the <kbd class="calibre11">articleDetails</kbd> variable, we keep all data fetched from reducer/DB. In general, now we only have the frontend side because a backend side fetching an edited article will be introduced later in this book.</p>
<p class="calibre2">The <kbd class="calibre11">_onDraftJSChange</kbd> function is similar to the one in the <kbd class="calibre11">AddArticleView</kbd> component.</p>
<p class="calibre2">The <kbd class="calibre11">_articleEditSubmit</kbd> is quite standard, so I will leave it to you to read the code. I will only mention that <kbd class="calibre11">_id: currentArticleID</kbd> is very important, because it's used later in our <kbd class="calibre11">reducer/mapUtils</kbd> in order to update the article correctly in the article's reducer.</p>


            </article>

            <footer class="calibre4">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">EditArticleView's render improvements</h1>
            

            <article>
                
<p class="calibre2">The last part is to improve our <kbd class="calibre11">render</kbd> function in the <kbd class="calibre11">EditArticleView</kbd> component:</p>
<pre class="calibre22">
render () { <br class="title-page-name"/>    if (this.state.articleFetchError) { <br class="title-page-name"/>      return &lt;h1&gt;Article not found (invalid article's ID <br class="title-page-name"/>       {this.props.params.articleID})&lt;/h1&gt;; <br class="title-page-name"/>    } else if (!this.state.editedArticleID) { <br class="title-page-name"/>        return &lt;h1&gt;Loading article details&lt;/h1&gt;; <br class="title-page-name"/>    } else if (this.state.articleEditSuccess) { <br class="title-page-name"/>      return ( <br class="title-page-name"/>        &lt;div style={{height: '100%', width: '75%', margin: <br class="title-page-name"/>         'auto'}}&gt; <br class="title-page-name"/>          &lt;h3&gt;Your article has been edited successfully&lt;/h3&gt; <br class="title-page-name"/>          &lt;Link to='/dashboard'&gt; <br class="title-page-name"/>            &lt;RaisedButton <br class="title-page-name"/>              secondary={true} <br class="title-page-name"/>              type='submit' <br class="title-page-name"/>              style={{margin: '10px auto', display: 'block', <br class="title-page-name"/>               width: 150}} <br class="title-page-name"/>              label='Done' /&gt; <br class="title-page-name"/>          &lt;/Link&gt; <br class="title-page-name"/>        &lt;/div&gt; <br class="title-page-name"/>      ); <br class="title-page-name"/>    } <br class="title-page-name"/><br class="title-page-name"/>    let initialWYSIWYGValue = <br class="title-page-name"/>     this.state.articleDetails.articleContentJSON; <br class="title-page-name"/><br class="title-page-name"/>    return ( <br class="title-page-name"/>      &lt;div style={{height: '100%', width: '75%', margin: 'auto'}}&gt; <br class="title-page-name"/>        &lt;h1&gt;Edit an existing article&lt;/h1&gt; <br class="title-page-name"/>        &lt;WYSIWYGeditor <br class="title-page-name"/>          initialValue={initialWYSIWYGValue} <br class="title-page-name"/>          name='editarticle' <br class="title-page-name"/>          title='Edit an article' <br class="title-page-name"/>          onChangeTextJSON={this._onDraftJSChange} /&gt; <br class="title-page-name"/>          &lt;RaisedButton <br class="title-page-name"/>            onClick={this._articleEditSubmit} <br class="title-page-name"/>            secondary={true} <br class="title-page-name"/>            type='submit' <br class="title-page-name"/>            style={{margin: '10px auto', display: 'block', <br class="title-page-name"/>             width: 150}} <br class="title-page-name"/>            label={'Submit Edition'} /&gt; <br class="title-page-name"/>      &lt;/div&gt; <br class="title-page-name"/>    ); <br class="title-page-name"/>  }
</pre>
<p class="calibre2">We are managing different states of our component with <kbd class="calibre11">if(this.state.articleFetchError)</kbd>, <kbd class="calibre11">else if(!this.state.editedArticleID)</kbd>, and <kbd class="calibre11">else if(this.state.articleEditSuccess)</kbd>, as follows:</p>
<pre class="calibre22">
&lt;WYSIWYGeditor <br class="title-page-name"/>  initialValue={initialWYSIWYGValue} <br class="title-page-name"/>  name='editarticle' <br class="title-page-name"/>  title='Edit an article' <br class="title-page-name"/>  onChangeTextJSON={this._onDraftJSChange} /&gt;
</pre>
<p class="calibre2">In this part, the major change is adding a new property called <kbd class="calibre11">initialValue</kbd>, which is passed down to the <kbd class="calibre11">WYSIWYGeditor</kbd>, the draft-js JSON object.</p>


            </article>

            <footer class="calibre4">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">Deleting an article's feature implementation</h1>
            

            <article>
                
<p class="calibre2">Let's create a new action for deletion at <kbd class="calibre11">src/actions/article.js</kbd>:</p>
<pre class="calibre22">
deleteArticle: (response) =&gt; { <br class="title-page-name"/>  return { <br class="title-page-name"/>    type: 'DELETE_ARTICLE', <br class="title-page-name"/>    payload: { response: response } <br class="title-page-name"/>  } <br class="title-page-name"/>}
</pre>
<p class="calibre2">Next, let's add a <kbd class="calibre11">DELETE_ARTICLE</kbd> switch case into <kbd class="calibre11">src/reducers/article.js</kbd>:</p>
<pre class="calibre22">
import mapHelpers from '../utils/mapHelpers'; <br class="title-page-name"/><br class="title-page-name"/>const article = (state = {}, action) =&gt; { <br class="title-page-name"/>  switch (action.type) { <br class="title-page-name"/>    case 'ARTICLES_LIST_ADD': <br class="title-page-name"/>      let articlesList = action.payload.response; <br class="title-page-name"/>      return mapHelpers.addMultipleItems(state, articlesList); <br class="title-page-name"/>    case 'PUSH_NEW_ARTICLE': <br class="title-page-name"/>      let newArticleObject = action.payload.response; <br class="title-page-name"/>      return mapHelpers.addItem(state, newArticleObject['_id'], <br class="title-page-name"/>       newArticleObject); <br class="title-page-name"/>    case 'EDIT_ARTICLE': <br class="title-page-name"/>      let editedArticleObject = action.payload.response; <br class="title-page-name"/>      return mapHelpers.addItem(state, editedArticleObject['_id'], <br class="title-page-name"/>       editedArticleObject); <br class="title-page-name"/>    case 'DELETE_ARTICLE': <br class="title-page-name"/>      let deleteArticleId = action.payload.response; <br class="title-page-name"/>      return mapHelpers.deleteItem(state, deleteArticleId); <br class="title-page-name"/>    default: <br class="title-page-name"/>      return state; <br class="title-page-name"/>  } <br class="title-page-name"/>export default article
</pre>
<p class="calibre2">The last step in implementing a delete button is to modify <kbd class="calibre11">src/views/articles/EditArticleView.js component.Import PopOver</kbd> (it will ask a second time whether you are sure about deleting an article):</p>
<pre class="calibre22">
import Popover from 'material-ui/lib/popover/popover'; <br class="title-page-name"/>Improve the constructor of EditArticleView: <br class="title-page-name"/>class EditArticleView extends React.Component { <br class="title-page-name"/>  constructor(props) { <br class="title-page-name"/>    super(props); <br class="title-page-name"/>    this._onDraftJSChange = this._onDraftJSChange.bind(this); <br class="title-page-name"/>    this._articleEditSubmit = this._articleEditSubmit.bind(this); <br class="title-page-name"/>    this._fetchArticleData = this._fetchArticleData.bind(this); <br class="title-page-name"/>    this._handleDeleteTap = this._handleDeleteTap.bind(this); <br class="title-page-name"/>    this._handleDeletion = this._handleDeletion.bind(this); <br class="title-page-name"/>    this._handleClosePopover = <br class="title-page-name"/>     this._handleClosePopover.bind(this); <br class="title-page-name"/><br class="title-page-name"/>    this.state = { <br class="title-page-name"/>      articleFetchError: null, <br class="title-page-name"/>      articleEditSuccess: null, <br class="title-page-name"/>      editedArticleID: null, <br class="title-page-name"/>      articleDetails: null, <br class="title-page-name"/>      title: 'test', <br class="title-page-name"/>      contentJSON: {}, <br class="title-page-name"/>      htmlContent: '', <br class="title-page-name"/>      openDelete: false, <br class="title-page-name"/>      deleteAnchorEl: null <br class="title-page-name"/>    }; <br class="title-page-name"/>  }
</pre>
<p class="calibre2">The new things here are <kbd class="calibre11">_handleDeleteTap</kbd>, <kbd class="calibre11">_handleDeletion</kbd>, <kbd class="calibre11">_handleClosePopover</kbd>, and <kbd class="calibre11">state (htmlContent, openDelete, deleteAnchorEl)</kbd>. Then, add three new functions to <kbd class="calibre11">EditArticleView</kbd>:</p>
<pre class="calibre22">
 _handleDeleteTap(event) { <br class="title-page-name"/>    this.setState({ <br class="title-page-name"/>      openDelete: true, <br class="title-page-name"/>      deleteAnchorEl: event.currentTarget <br class="title-page-name"/>    }); <br class="title-page-name"/>  } <br class="title-page-name"/><br class="title-page-name"/>  _handleDeletion() { <br class="title-page-name"/>    let articleID = this.state.editedArticleID; <br class="title-page-name"/>    this.props.articleActions.deleteArticle(articleID); <br class="title-page-name"/><br class="title-page-name"/>    this.setState({ <br class="title-page-name"/>      openDelete: false <br class="title-page-name"/>    }); <br class="title-page-name"/>    this.props.history.pushState(null, '/dashboard'); <br class="title-page-name"/>  } <br class="title-page-name"/><br class="title-page-name"/>  _handleClosePopover() { <br class="title-page-name"/>    this.setState({ <br class="title-page-name"/>      openDelete: false <br class="title-page-name"/>    }); <br class="title-page-name"/>  }
</pre>
<p class="calibre2">Improve the return in the <kbd class="calibre11">render</kbd> function:</p>
<pre class="calibre22">
let initialWYSIWYGValue = <br class="title-page-name"/> this.state.articleDetails.articleContentJSON; <br class="title-page-name"/><br class="title-page-name"/> return ( <br class="title-page-name"/>   &lt;div style={{height: '100%', width: '75%', margin: 'auto'}}&gt; <br class="title-page-name"/>     &lt;h1&gt;Edit an exisitng article&lt;/h1&gt; <br class="title-page-name"/>     &lt;WYSIWYGeditor <br class="title-page-name"/>       initialValue={initialWYSIWYGValue} <br class="title-page-name"/>       name='editarticle' <br class="title-page-name"/>       title='Edit an article' <br class="title-page-name"/>       onChangeTextJSON={this._onDraftJSChange} /&gt; <br class="title-page-name"/>       &lt;RaisedButton <br class="title-page-name"/>         onClick={this._articleEditSubmit} <br class="title-page-name"/>         secondary={true} <br class="title-page-name"/>         type='submit' <br class="title-page-name"/>         style={{margin: '10px auto', display: 'block', <br class="title-page-name"/>          width: 150}} <br class="title-page-name"/>         label={'Submit Edition'} /&gt; <br class="title-page-name"/>     &lt;hr /&gt; <br class="title-page-name"/>     &lt;h1&gt;Delete permanently this article&lt;/h1&gt; <br class="title-page-name"/>       &lt;RaisedButton <br class="title-page-name"/>         onClick={this._handleDeleteTap} <br class="title-page-name"/>         label='Delete' /&gt; <br class="title-page-name"/>       &lt;Popover <br class="title-page-name"/>         open={this.state.openDelete} <br class="title-page-name"/>         anchorEl={this.state.deleteAnchorEl} <br class="title-page-name"/>         anchorOrigin={{horizontal: 'left', vertical: <br class="title-page-name"/>          'bottom'}} <br class="title-page-name"/>         targetOrigin={{horizontal: 'left', vertical: 'top'}} <br class="title-page-name"/>         onRequestClose={this._handleClosePopover}&gt; <br class="title-page-name"/>         &lt;div style={{padding: 20}}&gt; <br class="title-page-name"/>           &lt;RaisedButton  <br class="title-page-name"/>             onClick={this._handleDeletion}  <br class="title-page-name"/>             primary={true}  <br class="title-page-name"/>             label="Permanent delete, click here"/&gt; <br class="title-page-name"/>         &lt;/div&gt; <br class="title-page-name"/>       &lt;/Popover&gt; <br class="title-page-name"/>   &lt;/div&gt; <br class="title-page-name"/> );
</pre>
<p class="calibre2">Regarding <kbd class="calibre11">render</kbd>, new things are all under the new <kbd class="calibre11">hr</kbd> tag: <kbd class="calibre11">&lt;h1&gt;: Delete permanently this article&lt;h1&gt;</kbd>. <kbd class="calibre11">RaisedButton: DeletePopover</kbd> is a component from Material-UI. You can find more documentation of this component at <a href="http://www.material-ui.com/v0.15.0-alpha.1/#/components/popover" class="calibre6"><span>http://www.material-ui.com/v0.15.0-alpha.1/#/components/popover</span></a>. You can find in the following screenshots how it should look in the <kbd class="calibre11">browserRaisedButton: Permanent delete, click here</kbd> label. The <kbd class="calibre11">AddArticleView</kbd> component:</p>
<div class="packt_figure"><img class="image-border35" src="../images/00040.jpeg"/></div>
<p class="calibre2">The <kbd class="calibre11">AddArticleView</kbd> component after a <kbd class="calibre11">SUBMIT ARTICLE</kbd> button has been hit:</p>
<div class="packt_figure"><img class="image-border36" src="../images/00041.jpeg"/></div>
<p class="calibre2">The dashboard component:</p>
<div class="packt_figure"><img class="image-border37" src="../images/00042.jpeg"/></div>
<p class="calibre2">The <kbd class="calibre11">EditArticleView</kbd> component:</p>
<div class="packt_figure"><img class="image-border38" src="../images/00043.jpeg"/></div>
<p class="calibre2">A <span>DELETE</span> button on the <kbd class="calibre11">EditArticleView</kbd> component:</p>
<div class="packt_figure"><img class="image-border39" src="../images/00044.jpeg"/></div>
<p class="calibre2">A <span>DELETE</span> button on the <kbd class="calibre11">EditArticleView</kbd> component after first click (popover component):</p>
<div class="packt_figure"><img class="image-border40" src="../images/00045.jpeg"/></div>
<p class="calibre2">A <kbd class="calibre11">PublishingApp</kbd> component (main page):</p>
<div class="packt_figure"><img class="image-border41" src="../images/00046.jpeg"/></div>


            </article>

            <footer class="calibre4">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">Summary</h1>
            

            <article>
                
<p class="calibre2">Currently, we have made a lot of progress on the frontend using Redux to store the state of our application in its single-state tree. The important drawback is that after you hit refresh, all the data disappears.</p>
<p class="calibre2">In the next chapter, we will start implementing the backend in order to store the articles in our database.</p>
<p class="calibre2">As you already know, Falcor is our glue that replaces the old popular RESTful approach; you will master stuff related to Falcor very soon. You will also learn what the differences between Relay/GraphQL and Falcor are. Both are trying to solve similar problems, but in very different ways.</p>
<p class="calibre2">Let's go even more in depth into our full-stack Falcor application. We will make it even more awesome for our end users.</p>


            </article>

            <footer class="calibre4">
                
            </footer>

        </section>
    </body></html>