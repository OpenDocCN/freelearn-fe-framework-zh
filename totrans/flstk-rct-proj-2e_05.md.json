["```js\nAuthorization: Bearer <JSON Web Token>\n```", "```js\n| mern_skeleton/\n   | -- config/\n      | --- config.js\n   | -- server/\n      | --- controllers/\n         | ---- auth.controller.js\n         | ---- user.controller.js\n      | --- helpers/\n         | ---- dbErrorHandler.js\n      | --- models/\n         | ---- user.model.js\n      | --- routes/\n         | ---- auth.routes.js\n         | ---- user.routes.js\n      | --- express.js\n      | --- server.js\n  | -- .babelrc\n  | -- nodemon.json\n  | -- package.json\n  | -- template.js\n  | -- webpack.config.server.js\n  | -- yarn.lock\n```", "```js\n{\n  \"presets\": [\n    [\"@babel/preset-env\",\n      {\n        \"targets\": {\n          \"node\": \"current\"\n        }\n      }\n    ]\n  ]\n}\n```", "```js\nyarn add --dev @babel/core babel-loader @babel/preset-env\n```", "```js\nyarn add --dev webpack webpack-cli webpack-node-externals\n```", "```js\nconst config = {\n  env: process.env.NODE_ENV || 'development',\n  port: process.env.PORT || 3000,\n  jwtSecret: process.env.JWT_SECRET || \"YOUR_secret_key\",\n  mongoUri: process.env.MONGODB_URI ||\n    process.env.MONGO_HOST ||\n    'mongodb://' + (process.env.IP || 'localhost') + ':' +\n    (process.env.MONGO_PORT || '27017') +\n    '/mernproject'\n}\n\nexport default config\n```", "```js\n\"scripts\": {\n    \"development\": \"nodemon\"\n }\n```", "```js\nyarn add express\n```", "```js\nimport express from 'express'\nconst app = express()\n  /*... configure express ... */\nexport default app\n```", "```js\nimport express from 'express'\nimport bodyParser from 'body-parser'\nimport cookieParser from 'cookie-parser'\nimport compress from 'compression'\nimport cors from 'cors'\nimport helmet from 'helmet'\n\nconst app = express()\n\napp.use(bodyParser.json())\napp.use(bodyParser.urlencoded({ extended: true }))\napp.use(cookieParser())\napp.use(compress())\napp.use(helmet())\napp.use(cors())\n\nexport default app\n```", "```js\nimport config from './../config/config'\nimport app from './express'\n\napp.listen(config.port, (err) => {\n  if (err) {\n    console.log(err)\n  }\n  console.info('Server started on port %s.', config.port)\n})\n```", "```js\nyarn add mongoose\n```", "```js\nimport mongoose from 'mongoose'\n\nmongoose.Promise = global.Promise\nmongoose.connect(config.mongoUri, { useNewUrlParser: true, \n                                    useCreateIndex: true,         \n                                    useUnifiedTopology: true } ) \n\nmongoose.connection.on('error', () => {\n  throw new Error(`unable to connect to database: ${mongoUri}`)\n})\n```", "```js\nexport default () => {\n    return `<!doctype html>\n      <html lang=\"en\">\n          <head>\n             <meta charset=\"utf-8\">\n             <title>MERN Skeleton</title>\n          </head>\n          <body>\n            <div id=\"root\">Hello World</div>\n          </body>\n      </html>`\n}\n```", "```js\nimport Template from './../template'\n...\napp.get('/', (req, res) => {\n res.status(200).send(Template())\n})\n...\n```", "```js\nimport mongoose from 'mongoose'\n\nconst UserSchema = new mongoose.Schema({ … })\n\nexport default mongoose.model('User', UserSchema) \n```", "```js\nname: {\n   type: String,\n   trim: true,\n   required: 'Name is required'\n },\n```", "```js\nemail: {\n  type: String,\n  trim: true,\n  unique: 'Email already exists',\n  match: [/.+\\@.+\\..+/, 'Please fill a valid email address'],\n  required: 'Email is required'\n},\n```", "```js\ncreated: {\n  type: Date,\n  default: Date.now\n},\nupdated: Date,\n```", "```js\nhashed_password: {\n    type: String,\n    required: \"Password is required\"\n},\nsalt: String\n```", "```js\nUserSchema\n  .virtual('password')\n  .set(function(password) {\n    this._password = password\n    this.salt = this.makeSalt()\n    this.hashed_password = this.encryptPassword(password)\n  })\n  .get(function() {\n    return this._password\n  })\n```", "```js\nUserSchema.methods = {\n  authenticate: function(plainText) {\n    return this.encryptPassword(plainText) === this.hashed_password\n  },\n  encryptPassword: function(password) {\n    if (!password) return ''\n    try {\n      return crypto\n        .createHmac('sha1', this.salt)\n        .update(password)\n        .digest('hex')\n    } catch (err) {\n      return ''\n    }\n  },\n  makeSalt: function() {\n    return Math.round((new Date().valueOf() * Math.random())) + ''\n  }\n}\n```", "```js\nUserSchema.path('hashed_password').validate(function(v) {\n  if (this._password && this._password.length < 6) {\n    this.invalidate('password', 'Password must be at least 6 characters.')\n  }\n  if (this.isNew && !this._password) {\n    this.invalidate('password', 'Password is required')\n  }\n}, null)\n```", "```js\nconst getErrorMessage = (err) => {\n  let message = ''\n  if (err.code) {\n      switch (err.code) {\n          case 11000:\n          case 11001:\n              message = getUniqueErrorMessage(err)\n              break\n          default:\n              message = 'Something went wrong'\n      }\n  } else {\n      for (let errName in err.errors) {\n          if (err.errors[errName].message)\n          message = err.errors[errName].message\n      }\n  }\n  return message\n}\n\nexport default {getErrorMessage}\n```", "```js\nconst getUniqueErrorMessage = (err) => {\n  let output\n  try {\n      let fieldName =   \n      err.message.substring(err.message.lastIndexOf('.$') + 2,                                             \n      err.message.lastIndexOf('_1'))\n      output = fieldName.charAt(0).toUpperCase() + fieldName.slice(1) +   \n      ' already exists'\n  } catch (ex) {\n      output = 'Unique field already exists'\n  }\n  return output\n}\n```", "```js\nimport userRoutes from './routes/user.routes'\n...\napp.use('/', userRoutes)\n...\n```", "```js\nimport express from 'express'\nimport userCtrl from '../controllers/user.controller'\n\nconst router = express.Router()\n\nrouter.route('/api/users')\n  .get(userCtrl.list)\n  .post(userCtrl.create)\n\nrouter.route('/api/users/:userId')\n  .get(userCtrl.read)\n  .put(userCtrl.update)\n  .delete(userCtrl.remove)\n\nrouter.param('userId', userCtrl.userByID)\n\nexport default router\n```", "```js\nimport User from '../models/user.model'\nimport extend from 'lodash/extend'\nimport errorHandler from './error.controller'\n\nconst create = (req, res, next) => { … }\nconst list = (req, res) => { … }\nconst userByID = (req, res, next, id) => { … }\nconst read = (req, res) => { … }\nconst update = (req, res, next) => { … }\nconst remove = (req, res, next) => { … }\n\nexport default { create, userByID, read, list, remove, update }\n```", "```js\nrouter.route('/api/users').post(userCtrl.create)\n```", "```js\nconst create = async (req, res) => {\n  const user = new User(req.body)\n  try {\n    await user.save()\n    return res.status(200).json({\n      message: \"Successfully signed up!\"\n    })\n  } catch (err) {\n    return res.status(400).json({\n      error: errorHandler.getErrorMessage(err)\n    })\n  }\n}\n```", "```js\nrouter.route('/api/users').get(userCtrl.list)\n```", "```js\nconst list = async (req, res) => {\n  try {\n    let users = await User.find().select('name email updated created')\n    res.json(users)\n  } catch (err) {\n    return res.status(400).json({\n      error: errorHandler.getErrorMessage(err)\n    })\n  }\n}\n```", "```js\nrouter.param('userId', userCtrl.userByID)\n```", "```js\nconst userByID = async (req, res, next, id) => {\n  try {\n    let user = await User.findById(id)\n    if (!user)\n      return res.status('400').json({\n        error: \"User not found\"\n      })\n    req.profile = user\n    next()\n  } catch (err) {\n    return res.status('400').json({\n      error: \"Could not retrieve user\"\n    })\n  }\n}\n```", "```js\nrouter.route('/api/users/:userId').get(userCtrl.read)\n```", "```js\nconst read = (req, res) => {\n  req.profile.hashed_password = undefined\n  req.profile.salt = undefined\n  return res.json(req.profile)\n}\n```", "```js\nrouter.route('/api/users/:userId').put(userCtrl.update)\n```", "```js\nconst update = async (req, res) => {\n  try {\n    let user = req.profile\n    user = extend(user, req.body)\n    user.updated = Date.now()\n    await user.save()\n    user.hashed_password = undefined\n    user.salt = undefined\n    res.json(user)\n  } catch (err) {\n    return res.status(400).json({\n      error: errorHandler.getErrorMessage(err)\n    })\n  }\n}\n```", "```js\nrouter.route('/api/users/:userId').delete(userCtrl.remove)\n```", "```js\nconst remove = async (req, res) => {\n  try {\n    let user = req.profile\n    let deletedUser = await user.remove()\n    deletedUser.hashed_password = undefined\n    deletedUser.salt = undefined\n    res.json(deletedUser)\n  } catch (err) {\n    return res.status(400).json({\n      error: errorHandler.getErrorMessage(err)\n    })\n  }\n}\n```", "```js\nimport authRoutes from './routes/auth.routes'\n  ...\n  app.use('/', authRoutes)\n  ...\n```", "```js\nimport express from 'express'\nimport authCtrl from '../controllers/auth.controller'\n\nconst router = express.Router()\n\nrouter.route('/auth/signin')\n  .post(authCtrl.signin)\nrouter.route('/auth/signout')\n  .get(authCtrl.signout)\n\nexport default router\n```", "```js\nimport User from '../models/user.model'\nimport jwt from 'jsonwebtoken'\nimport expressJwt from 'express-jwt'\nimport config from './../../config/config'\n\nconst signin = (req, res) => { … }\nconst signout = (req, res) => { … }\nconst requireSignin = … \nconst hasAuthorization = (req, res) => { … }\n\nexport default { signin, signout, requireSignin, hasAuthorization }\n```", "```js\nrouter.route('/auth/signin').post(authCtrl.signin)\n```", "```js\nconst signin = async (req, res) => {\n  try {\n    let user = await User.findOne({ \"email\": req.body.email })\n    if (!user)\n      return res.status('401').json({ error: \"User not found\" })\n\n    if (!user.authenticate(req.body.password)) {\n      return res.status('401').send({ error: \"Email and\n           password don't match.\" })\n    }\n\n    const token = jwt.sign({ _id: user._id }, config.jwtSecret)\n\n    res.cookie('t', token, { expire: new Date() + 9999 })\n\n    return res.json({\n      token,\n      user: {\n        _id: user._id,\n        name: user.name,\n        email: user.email\n      }\n    })\n  } catch (err) {\n    return res.status('401').json({ error: \"Could not sign in\" })\n  }\n}\n```", "```js\nrouter.route('/auth/signout').get(authCtrl.signout)\n```", "```js\nconst signout = (req, res) => {\n  res.clearCookie(\"t\")\n  return res.status('200').json({\n    message: \"signed out\"\n  })\n}\n```", "```js\nimport authCtrl from '../controllers/auth.controller'\n...\nrouter.route('/api/users/:userId')\n    .get(authCtrl.requireSignin, userCtrl.read)\n    .put(authCtrl.requireSignin, authCtrl.hasAuthorization, \n     userCtrl.update)\n    .delete(authCtrl.requireSignin, authCtrl.hasAuthorization, \n     userCtrl.remove)\n...\n```", "```js\nconst requireSignin = expressJwt({\n  secret: config.jwtSecret,\n  userProperty: 'auth'\n})\n```", "```js\nconst hasAuthorization = (req, res, next) => {\n  const authorized = req.profile && req.auth \n        && req.profile._id ==  req.auth._id\n  if (!(authorized)) {\n    return res.status('403').json({\n      error: \"User is not authorized\"\n    })\n  }\n  next()\n}\n```", "```js\napp.use((err, req, res, next) => {\n  if (err.name === 'UnauthorizedError') {\n    res.status(401).json({\"error\" : err.name + \": \" + err.message})\n  }else if (err) {\n    res.status(400).json({\"error\" : err.name + \": \" + err.message})\n    console.log(err)\n  }\n})\n```"]