<html><head></head><body>
        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Transforming Our App into a PWA</h1>
                
            
            <article>
                
<p class="mce-root4"><strong class="calibre1">Progressive Web App</strong> (<strong class="calibre1">PWA</strong>) is a new way to develop a web application. As a part of this chapter, you will learn about PWA and explore features that make an application PWA-compliant. As a part of this, we will add our friends application to mobile home screens, and this will make our friends application a part of other mobile-native apps. We will also cover offline mode for our application so that we can show data for our users to browse. Finally, we will audit our application in the <strong class="calibre1">Lighthouse</strong> tool, which provides a good insight into our Progressive Web Application.</p>
<p class="calibre2"><span>In this chapter, </span>we will cover the following<span> topics</span>:</p>
<ul class="calibre7">
<li class="calibre8">Introduction to PWA</li>
<li class="calibre8">Introduction to service worker</li>
<li class="calibre8">Adding our application to phone home screens</li>
<li class="calibre8">Enabling offline mode</li>
<li class="calibre8">Compliance testing using Lighthouse</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Introduction to PWA</h1>
                
            
            <article>
                
<p class="calibre2">PWA is a web app that uses enhanced features to deliver a mobile app-like experience to the users. This web application meets certain requirements and is deployed to the Firebase server, which is accessible through URL and indexed by the Google search engine. Progressive web application development is a paradigm shift in recent years to make your web application universally available.</p>
<p class="calibre2">The following are a few of the features that make an application PWA-compliant:</p>
<ul class="calibre7">
<li class="calibre8"><strong class="calibre1">Power of website and app</strong>: The application is optimized to work perfectly well on mobiles and in browsers. It has all the capabilities of a mobile app, such as offline mode and push notifications.</li>
<li class="calibre8"><strong class="calibre1">App store not required</strong>: Similar to a website, we don't require an app store and this is readily available for use with the latest software update.</li>
<li class="calibre8"><strong class="calibre1">App-Like</strong><span>:</span> The we<span>b application looks like a mobile application. It appears along with other mobile apps and occupies the full screen as a normal app.</span></li>
<li class="calibre8"><strong class="calibre1">Connectivity-Independent</strong>: These apps are independent of network types. They work quite well on weak networks, which gives users a seamless experience.</li>
<li class="calibre8"><strong class="calibre1">Additions to the home screen</strong>: This allows a user to add our website to their home screen so that they become a part of the app family. Users can frequently launch the application without opening the browser.</li>
<li class="calibre8"><strong class="calibre1">Safe</strong>: This app works on HTTPS, so they are safe from attacks or hacks.</li>
<li class="calibre8"><strong class="calibre1">Push Notification</strong>: With the advent of service worker, it is possible to send push notifications to a web application. This is really helpful in engaging the user with our application.</li>
<li class="calibre8"><strong class="calibre1">Searchable</strong>: Similar to a website, this app is searchable using Google Search. We can optimize our website with keywords so that PWA apps are recognizable and easily searchable by users.</li>
<li class="calibre8"><strong class="calibre1">Link able</strong>: This kind of app is easily shareable via links just like a normal web application.</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Introduction to service worker</h1>
                
            
            <article>
                
<p class="calibre2">Service worker is a script that runs in background. This background script does not interact with DOM elements. This helps support features such as push notification and offline mode, and service worker will be greatly enhanced in future to support other new features.</p>
<p class="calibre2">The following are the prerequisites for service worker:</p>
<ul class="calibre7">
<li class="calibre8"><strong class="calibre1">Browser support</strong>: Service worker is supported in the Chrome, Firefox, and Opera browsers, and the support will be extended for other browsers soon. </li>
<li class="calibre8"><strong class="calibre1">HTTPS support</strong>: <span><strong class="calibre1">Hyper text transfer protocol secure</strong> (<strong class="calibre1">HTTPS</strong>) is a secure version of HTTP and</span> is one of the prerequisites for PWA. This ensures that all communication between browser and server is encrypted.</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Adding our application to phone home screens</h1>
                
            
            <article>
                
<p class="calibre2">This is one of the most important features of Progressive Web Apps and provides many advantages, as follows:</p>
<ul class="calibre7">
<li class="calibre8"><strong class="calibre1">Easier access</strong>: Users normally put their most-used app on the home screen, as this provides easier access to the application</li>
<li class="calibre8"><strong class="calibre1">Engagement</strong>: A user can engage with our application more frequently</li>
</ul>
<p class="calibre2">The steps involved in making our web application appear on the home screen are as follows: </p>
<ol class="calibre13">
<li value="1" class="calibre8">In order to give our web application a mobile app appearance, we will modify the<span> </span><kbd class="calibre11">manifest.json</kbd><span> file </span>as shown in the following code.</li>
<li value="2" class="calibre8">Open the friends application in your phone's Chrome browser using the deployed application URL available from your Firebase portal. The page prompts you with an option to add the application to the home screen.</li>
</ol>
<p class="calibre2">Here's the <kbd class="calibre11">manifest.json</kbd> file:</p>
<pre class="calibre17">{<br class="title-page-name"/>   <span>"name"</span>: <span>"Friends"</span>,<br class="title-page-name"/>   <span>"short_name"</span>: <span>"Friends"</span>,<br class="title-page-name"/>   <span>"icons"</span>: [<br class="title-page-name"/>      {<br class="title-page-name"/>         <span>"src"</span>: <span>"/assets/images/android-chrome-192x192.png"</span>,<br class="title-page-name"/>         <span>"sizes"</span>: <span>"192x192"</span>,<br class="title-page-name"/>         <span>"type"</span>: <span>"image/png"<br class="title-page-name"/></span><span>      </span>}<br class="title-page-name"/>   ],<br class="title-page-name"/>   <span>"theme_color"</span>: <span>"#689f38"</span>,<br class="title-page-name"/>   <span>"background_color"</span>: <span>"#689f38"</span>,<br class="title-page-name"/>   <span>"start_url"</span>: <span>"/index.html"</span>,<br class="title-page-name"/>   <span>"display"</span>: <span>"standalone"</span>,<br class="title-page-name"/>   <span>"orientation"</span>: <span>"portrait"</span>,<br class="title-page-name"/>   <span>"gcm_sender_id"</span>: <span>"103953800507"<br class="title-page-name"/></span>}</pre>
<p class="calibre2">Take a look at the following detailed description of properties:</p>
<ul class="calibre7">
<li class="calibre8"><kbd class="calibre11">name</kbd>: This name appears when the add to home screen banner appears and Chrome gives the option to modify the name dynamically.</li>
<li class="calibre8"><kbd class="calibre11">short_name</kbd>: This appears below the application icon in the phone home screen. In our application, <kbd class="calibre11">name</kbd> and <kbd class="calibre11">short_name</kbd> are the same.</li>
<li class="calibre8"><kbd class="calibre11">icons</kbd>: According to the PWA standard, the recommended icon size is 192 x 192, and this icon appears on phone home screens.</li>
<li class="calibre8"><kbd class="calibre11">background_color</kbd>: The specified background color appears as the icon's background color. </li>
<li class="calibre8"><kbd class="calibre11">theme_color</kbd>: When a user clicks on the friends application on the home screen, this color appears in the splash screen of your mobile application.</li>
<li class="calibre8"><kbd class="calibre11">display</kbd>: Android Chrome gives native style when a page is opened, as it removes the navigation bar and give up tab to task switcher. </li>
<li class="calibre8"><kbd class="calibre11">start_url</kbd>: This page is <kbd class="calibre11">index.html</kbd> in web applications, and typically this is our home page. </li>
<li class="calibre8"><kbd class="calibre11">orientation</kbd>: This enforces either portrait or landscape orientation. </li>
</ul>
<p class="calibre2">Our application on a phone home screen looks like this:</p>
<div class="cdpaligncenter"><img src="../images/00074.jpeg" class="calibre80"/></div>
<p class="calibre2">The splash screen for our app screen looks as follows:</p>
<div class="cdpaligncenter"><img src="../images/00075.jpeg" class="calibre81"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Enabling offline mode</h1>
                
            
            <article>
                
<p class="calibre2">In this section, we will cover how to enable offline mode for our application, which helps the user open our web application without an internet connection.</p>
<p class="calibre2">In order to support offline mode, we have to cache resources in the client browser, and for that, we use the precache plugin to cache our resources using service worker. It creates the service worker file using <strong class="calibre1">sw-precache</strong>. The steps involved are as follows:</p>
<ol class="calibre13">
<li class="calibre8" value="1"><strong class="calibre1">Installing the plugin</strong>: The f<span>irst step is to install the precache plugin in our current project using the following command:</span></li>
</ol>
<pre class="calibre18"><strong class="calibre1">$npm install --save-dev sw-precache-webpack-plugin</strong></pre>
<ol start="2" class="calibre13">
<li class="calibre8" value="2"><strong class="calibre1">Creating precache JavaScript</strong>: The precache plugin uses the precache configuration file to define resources to cache in the client browser. For more details about the precache plugin, refer to <a href="https://github.com/goldhand/sw-precache-webpack-plugin" class="calibre10">https://github.com/goldhand/sw-precache-webpack-plugin</a>.</li>
</ol>
<p class="mce-root"><span>Here's the complete <kbd class="calibre11">precache.config.js</kbd></span><span>:</span></p>
<pre class="calibre18"><span>var </span><span>SWPrecacheWebpackPlugin </span>= <span>require</span>(<span>'sw-precache-webpack-plugin'</span>);<br class="title-page-name"/><span>module</span>.<span>exports </span>= {<br class="title-page-name"/> <span>navigateFallback</span>: <span>'/index.html'</span>,<br class="title-page-name"/> <span>navigateFallbackWhitelist</span>: [<span>/^(?!\/__)/</span>],<br class="title-page-name"/> <span>stripPrefix</span>: <span>'dist'</span>,<br class="title-page-name"/> <span>root</span>: <span>'dist/'</span>,<br class="title-page-name"/> <span>plugins</span>: [<br class="title-page-name"/>  <span>new </span><span>SWPrecacheWebpackPlugin</span>({<br class="title-page-name"/>   <span>cacheId</span>: <span>'friend-cache'</span>,<br class="title-page-name"/>   <span>filename</span>: <span>'service-worker.js'</span>,<br class="title-page-name"/>   <span>staticFileGlobs</span>: [<br class="title-page-name"/>    <span>'dist/index.html'</span>,<br class="title-page-name"/>    <span>'dist/**.js'</span>,<br class="title-page-name"/>    <span>'dist/**.css'<br class="title-page-name"/></span><span>   </span>],<br class="title-page-name"/>   <span>stripPrefix</span>: <span>'dist/assets/'</span>,<br class="title-page-name"/>   <span>mergeStaticsConfig</span>: <span>true<br class="title-page-name"/></span><span>  </span>}),<br class="title-page-name"/> ]<br class="title-page-name"/>};</pre>
<ol start="3" class="calibre13">
<li value="3" class="calibre8"><strong class="calibre1">Configuring<span> </span>package.json</strong>: Once we create the configuration file, we need to create a new build tag called <kbd class="calibre11">pwa</kbd> and refer the cache file in<kbd class="calibre11">package.json</kbd>.</li>
</ol>
<p class="mce-root"><span>Here's the modified <kbd class="calibre11">package.json</kbd> </span><span>:</span></p>
<pre class="calibre18"><span>...<br class="title-page-name"/>"scripts"</span>: {<br class="title-page-name"/>  <span>"ng"</span>: <span>"ng"</span>,<br class="title-page-name"/>  <span>"start"</span>: <span>"ng serve"</span>,<br class="title-page-name"/>  <span>"build"</span>: <span>"ng build"</span>,<br class="title-page-name"/>  <span>"test"</span>: <span>"ng test --sourcemaps false"</span>,<br class="title-page-name"/>  <span>"coverage"</span>: <span>"ng test --sourcemaps false --watch=false --code-coverage"</span>,<br class="title-page-name"/>  <span>"lint"</span>: <span>"ng lint"</span>,<br class="title-page-name"/>  <span>"e2e"</span>: <span>"ng e2e"</span>,<br class="title-page-name"/>  <span>"pwa"</span>: <span>"ng build --prod &amp;&amp; sw-precache --root=dist --config=precache-config.js"<br class="title-page-name"/></span>}<br class="title-page-name"/>...</pre>
<ol start="4" class="calibre13">
<li value="4" class="calibre8"><strong class="calibre1">Registering service worker</strong>: Once we create the new build, we need to register the service worker that is created by the precache plugin in <kbd class="calibre11">index.html</kbd>, as follows. Here's the modified <kbd class="calibre11">index.html</kbd><span>:</span></li>
</ol>
<pre class="calibre18"><span>...<br class="title-page-name"/>body</span><span>&gt;</span><br class="title-page-name"/>  <span>&lt;</span><span>app-root</span><span>&gt;&lt;/</span><span>app-root</span><span>&gt;</span><br class="title-page-name"/><br class="title-page-name"/>  <span>&lt;</span><span>script</span><span>&gt;</span><br class="title-page-name"/>    <span>if </span>(<span>'serviceWorker' </span>in <span>navigator</span>) {<br class="title-page-name"/>      <span>console</span>.<span>log</span>(<span>"Will the service worker register?"</span>);<br class="title-page-name"/>      <span>navigator</span>.serviceWorker.<span>register</span>(<span>'/service-worker.js'</span>)<br class="title-page-name"/>        .<span>then</span>(<span>function</span>(reg){<br class="title-page-name"/>          <span>console</span>.<span>log</span>(<span>"Service Worker Registered"</span>);<br class="title-page-name"/>        }).<span>catch</span>(<span>function</span>(err) {<br class="title-page-name"/>        <span>console</span>.<span>log</span>(<span>"Service Worker Not Registered: "</span>, err)<br class="title-page-name"/>      });<br class="title-page-name"/>    }<br class="title-page-name"/>  <span>&lt;/</span><span>script</span><span>&gt;</span><br class="title-page-name"/><span>&lt;/</span><span>body</span><span>&gt;<br class="title-page-name"/>...</span></pre>
<ol start="5" class="calibre13">
<li value="5" class="calibre8"><strong class="calibre1">Running the new build script</strong>: Once we configure the service worker, we can run the production build using the following command; this will create all the files with service worker in their distribution folder:</li>
</ol>
<pre class="calibre18"><strong class="calibre1">$ng pwa</strong></pre>
<ol start="5" class="calibre13">
<li class="calibre8" value="5"><strong class="calibre1">Deploying</strong>: Finally, we deploy the newly created files to Firebase. Once they are deployed, we can open the application on our phone's home screen, and it will cache all the required resources in the client browser.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Compliance testing using Lighthouse</h1>
                
            
            <article>
                
<p class="calibre2">Lighthouse is an open source automated tool. It audits the application on performance, accessibility, progressive web apps, and so on. This is available with Chrome's developer tools in <span>the</span> <span>Audits</span> tab. So, go to the Chrome developer tool, then open the <span>Audits</span> tab, and click on the <span>Perform an audit...</span> button</p>
<p class="calibre2">In order to see improvements in our application, we can use this tool in two phases: </p>
<ul class="calibre7">
<li class="calibre8"><strong class="calibre1">Without any PWA changes</strong>: We can run this tool without any of the preceding changes in our application and take a look at the performance. Since our application does not comply with the PWA criteria, our score will not be good.</li>
</ul>
<p class="calibre2">Take a look at the following screenshot showing the score when we run Lighthouse—it fails in five audits and the score is shown in red:</p>
<div class="cdpaligncenter"><img src="../images/00076.jpeg" class="calibre82"/></div>
<ul class="calibre7">
<li class="calibre8"><strong class="calibre1">With PWA changes</strong>: Now, apply all the PWA changes as discussed in this chapter in our friends application, then run this tool and take a look at our audit performance. As shown in the following screenshot, our PWA score is <span>82</span> and is shown in green: </li>
</ul>
<div class="cdpaligncenter"><img src="../images/00077.jpeg" class="calibre83"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Summary</h1>
                
            
            <article>
                
<p class="calibre2">In this chapter, we discussed progressive web apps. We covered PWAs and all their key features. We discussed service worker, which supports push notification, offline mode, and so on. We enhanced <kbd class="calibre11">manifest.json</kbd> for our web application and added our application to a phone home screen. We enabled the offline cache using the <kbd class="calibre11">sw-precache</kbd> plugin. Finally, we used the Lighthouse tool to evaluate our application's PWA compliance.</p>
<p class="calibre2">Finally, we come to the end of our book, but this is not the end of web application development. This books introduced you to a practical approach to Angular and Firebase. You need to carry forward this knowledge and develop another live application; this will give you a lot of confidence.</p>
<p class="calibre2">All the best for your next application using Angular and Firebase!</p>


            </article>

            
        </section>
    </body></html>