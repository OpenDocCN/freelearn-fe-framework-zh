<html><head></head><body>
<div id="_idContainer130">
<h1 class="chapterNumber"><a id="_idTextAnchor169"/><span class="koboSpan" id="kobo.1.1">7</span></h1>
<h1 class="chapterTitle" id="_idParaDest-163"><a id="_idTextAnchor170"/><span class="koboSpan" id="kobo.2.1">Using Hooks for Handling Forms</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.3.1">In the previous chapter, we learned how to use Hooks for Data Fetching and React Suspense for showing a fallback while waiting on the data to finish loading.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.4.1">In this chapter, we are going to learn how to use Hooks to handle forms and form state in React. </span><span class="koboSpan" id="kobo.4.2">We have already implemented a form for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.5.1">CreatePost</span></code><span class="koboSpan" id="kobo.6.1"> component earlier. </span><span class="koboSpan" id="kobo.6.2">However, instead of manually handling the form submission, we can use </span><strong class="keyWord"><span class="koboSpan" id="kobo.7.1">React Form Actions</span></strong><span class="koboSpan" id="kobo.8.1">, which not only make it easier to deal with form submission, but also allow us to use Hooks that access the form state. </span><span class="koboSpan" id="kobo.8.2">Additionally, we are going to learn about the </span><strong class="keyWord"><span class="koboSpan" id="kobo.9.1">Optimistic Hook</span></strong><span class="koboSpan" id="kobo.10.1"> to implement optimistic updates, that is, showing the preliminary result on the client-side before the server-side finishes processing.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.11.1">The following topics will be covered in this chapter:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.12.1">Handling form submission with the </span><strong class="keyWord"><span class="koboSpan" id="kobo.13.1">Action State Hook</span></strong></li>
<li class="bulletList"><span class="koboSpan" id="kobo.14.1">Simulating </span><strong class="keyWord"><span class="koboSpan" id="kobo.15.1">blocking UI</span></strong></li>
<li class="bulletList"><span class="koboSpan" id="kobo.16.1">Avoiding blocking UI with the </span><strong class="keyWord"><span class="koboSpan" id="kobo.17.1">Transition Hook</span></strong></li>
<li class="bulletList"><span class="koboSpan" id="kobo.18.1">Using the </span><strong class="keyWord"><span class="koboSpan" id="kobo.19.1">Optimistic Hook</span></strong><span class="koboSpan" id="kobo.20.1"> to implement optimistic updates</span></li>
</ul>
<h1 class="heading-1" id="_idParaDest-164"><a id="_idTextAnchor171"/><span class="koboSpan" id="kobo.21.1">Technical requirements</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.22.1">A fairly recent version of Node.js should already be installed. </span><span class="koboSpan" id="kobo.22.2">The Node Package Manager (</span><code class="inlineCode"><span class="koboSpan" id="kobo.23.1">npm</span></code><span class="koboSpan" id="kobo.24.1">) also needs to be installed (it should come with Node.js). </span><span class="koboSpan" id="kobo.24.2">For more information on how to install Node.js, please check out their official website: </span><a href="https://nodejs.org/"><span class="url"><span class="koboSpan" id="kobo.25.1">https://nodejs.org/</span></span></a><span class="koboSpan" id="kobo.26.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.27.1">We are going to use </span><strong class="keyWord"><span class="koboSpan" id="kobo.28.1">Visual Studio Code</span></strong><span class="koboSpan" id="kobo.29.1"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.30.1">VS Code</span></strong><span class="koboSpan" id="kobo.31.1">) for the guides in this book, but everything should work similarly in any other editor. </span><span class="koboSpan" id="kobo.31.2">For more information on how to install VS Code, please refer to their official website: </span><a href="https://code.visualstudio.com"><span class="url"><span class="koboSpan" id="kobo.32.1">https://code.visualstudio.com</span></span></a></p>
<p class="normal"><span class="koboSpan" id="kobo.33.1">In this book, we use the following versions:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.34.1">Node.js v22.14.0</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.35.1">npm</span></code><span class="koboSpan" id="kobo.36.1"> v10.9.2</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.37.1">Visual Studio Code v1.97.2</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.38.1">The versions mentioned in the preceding list are the ones used in the book. </span><span class="koboSpan" id="kobo.38.2">While installing a newer version should not be an issue, please note that certain steps might work differently on a newer version. </span><span class="koboSpan" id="kobo.38.3">If you are having an issue with the code and steps provided in this book, please try using the mentioned versions.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.39.1">You can find the code for this chapter on GitHub: </span><a href="https://github.com/PacktPublishing/Learn-React-Hooks-Second-Edition/tree/main/Chapter07"><span class="url"><span class="koboSpan" id="kobo.40.1">https://github.com/PacktPublishing/Learn-React-Hooks-Second-Edition/tree/main/Chapter07</span></span></a></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.41.1">It is highly recommended that you write the code on your own. </span><span class="koboSpan" id="kobo.41.2">Do not simply run the code examples that are provided with the book. </span><span class="koboSpan" id="kobo.41.3">It is important to write the code yourself to be able to learn and understand it properly. </span><span class="koboSpan" id="kobo.41.4">However, if you run into any issues, you can always refer to the code example.</span></p>
</div>
<h1 class="heading-1" id="_idParaDest-165"><a id="_idTextAnchor172"/><span class="koboSpan" id="kobo.42.1">Handling form submission with the Action State Hook</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.43.1">React 19 introduced a new feature </span><a id="_idIndexMarker341"/><span class="koboSpan" id="kobo.44.1">called </span><strong class="keyWord"><span class="koboSpan" id="kobo.45.1">Form Actions</span></strong><span class="koboSpan" id="kobo.46.1">. </span><span class="koboSpan" id="kobo.46.2">As we have seen in the previous chapters, performing</span><a id="_idIndexMarker342"/><span class="koboSpan" id="kobo.47.1"> data mutations in response to user actions is a common use case in web applications. </span><span class="koboSpan" id="kobo.47.2">Often, these data mutations require making an API request and handling the response, which means dealing with loading and error states. </span><span class="koboSpan" id="kobo.47.3">For example, when we made the </span><code class="inlineCode"><span class="koboSpan" id="kobo.48.1">CreatePost</span></code><span class="koboSpan" id="kobo.49.1"> component, we created a form that inserts a new post into the database upon submission. </span><span class="koboSpan" id="kobo.49.2">In this case, </span><strong class="keyWord"><span class="koboSpan" id="kobo.50.1">React Query</span></strong><span class="koboSpan" id="kobo.51.1"> already</span><a id="_idIndexMarker343"/><span class="koboSpan" id="kobo.52.1"> helped us out a lot by simplifying loading and error states. </span><span class="koboSpan" id="kobo.52.2">However, with React Form Actions</span><a id="_idIndexMarker344"/><span class="koboSpan" id="kobo.53.1"> there is now a native way to deal with these states, by using the Action State Hook.</span></p>
<h2 class="heading-2" id="_idParaDest-166"><a id="_idTextAnchor173"/><span class="koboSpan" id="kobo.54.1">Introducing the Action State Hook</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.55.1">The Action State Hook is</span><a id="_idIndexMarker345"/><span class="koboSpan" id="kobo.56.1"> defined as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.57.1">const</span></span><span class="koboSpan" id="kobo.58.1"> [state, action, isPending] = </span><span class="hljs-title"><span class="koboSpan" id="kobo.59.1">useActionState</span></span><span class="koboSpan" id="kobo.60.1">(actionFn, initialState)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.61.1">Let’s break it down a bit to get a better understanding of it. </span><span class="koboSpan" id="kobo.61.2">To define an Action State Hook, we need to provide at least a function to it as an argument. </span><span class="koboSpan" id="kobo.61.3">This function will be called when the form is submitted, and has the following signature:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.62.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.63.1">actionFn</span></span><span class="koboSpan" id="kobo.64.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.65.1">currentState, formData</span></span><span class="koboSpan" id="kobo.66.1">) {
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.67.1">The action function gets the current state of the action as the first argument, and the form data (as a </span><code class="inlineCode"><span class="koboSpan" id="kobo.68.1">FormData</span></code><span class="koboSpan" id="kobo.69.1"> object) as the second argument. </span><span class="koboSpan" id="kobo.69.2">Anything returned from the action function will be the new state of the Action State Hook.</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.70.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.71.1">FormData</span></code><span class="koboSpan" id="kobo.72.1"> API</span><a id="_idIndexMarker346"/><span class="koboSpan" id="kobo.73.1"> is a web standard used to represent form fields and their values. </span><span class="koboSpan" id="kobo.73.2">It can be used to handle form submission and sent over the network, for example, using </span><code class="inlineCode"><span class="koboSpan" id="kobo.74.1">fetch()</span></code><span class="koboSpan" id="kobo.75.1">. </span><span class="koboSpan" id="kobo.75.2">It is an iterable object (can be iterated over with a </span><code class="inlineCode"><span class="koboSpan" id="kobo.76.1">for … of</span></code><span class="koboSpan" id="kobo.77.1"> loop) and provides getter and setter functions to access the values. </span><span class="koboSpan" id="kobo.77.2">More information can be found here: </span><a href="https://developer.mozilla.org/en-US/docs/Web/API/FormData"><span class="url"><span class="koboSpan" id="kobo.78.1">https://developer.mozilla.org/en-US/docs/Web/API/FormData</span></span></a><span class="koboSpan" id="kobo.79.1">.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.80.1">Additionally, it is possible to provide an </span><code class="inlineCode"><span class="koboSpan" id="kobo.81.1">initialState</span></code><span class="koboSpan" id="kobo.82.1"> for the Action State Hook.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.83.1">The Hook then returns the current state of the action, the action itself (to be passed to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.84.1">&lt;form&gt;</span></code><span class="koboSpan" id="kobo.85.1"> element), and the </span><code class="inlineCode"><span class="koboSpan" id="kobo.86.1">isPending</span></code><span class="koboSpan" id="kobo.87.1"> state to check whether the action is currently pending (while the </span><code class="inlineCode"><span class="koboSpan" id="kobo.88.1">actionFn</span></code><span class="koboSpan" id="kobo.89.1"> is being executed).</span></p>
<h2 class="heading-2" id="_idParaDest-167"><a id="_idTextAnchor174"/><span class="koboSpan" id="kobo.90.1">Using the Action State Hook</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.91.1">Now, let’s get started refactoring</span><a id="_idIndexMarker347"/><span class="koboSpan" id="kobo.92.1"> the </span><code class="inlineCode"><span class="koboSpan" id="kobo.93.1">CreatePost</span></code><span class="koboSpan" id="kobo.94.1"> component to use the Action State Hook:</span></p>
<ol>
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.95.1">Copy the </span><code class="inlineCode"><span class="koboSpan" id="kobo.96.1">Chapter06_4</span></code><span class="koboSpan" id="kobo.97.1"> folder to a new </span><code class="inlineCode"><span class="koboSpan" id="kobo.98.1">Chapter07_1</span></code><span class="koboSpan" id="kobo.99.1"> folder by executing the following command:
        </span><pre class="programlisting con-one"><code class="hljs-con"><span class="koboSpan" id="kobo.100.1">$ cp -R Chapter06_4 Chapter07_1
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.101.1">Open the new </span><code class="inlineCode"><span class="koboSpan" id="kobo.102.1">Chapter07_1</span></code><span class="koboSpan" id="kobo.103.1"> folder in VS Code.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.104.1">Edit </span><code class="inlineCode"><span class="koboSpan" id="kobo.105.1">src/components/post/CreatePost.jsx </span></code><span class="koboSpan" id="kobo.106.1">and import the </span><code class="inlineCode"><span class="koboSpan" id="kobo.107.1">useActionState</span></code><span class="koboSpan" id="kobo.108.1"> function:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.109.1">import</span></span><span class="koboSpan" id="kobo.110.1"> { useContext, </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.111.1">useActionState</span></strong></span><span class="koboSpan" id="kobo.112.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.113.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.114.1">'react'</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.115.1">Inside the </span><em class="italic"><span class="koboSpan" id="kobo.116.1">CreatePost</span></em><span class="koboSpan" id="kobo.117.1"> component, </span><em class="italic"><span class="koboSpan" id="kobo.118.1">remove</span></em><span class="koboSpan" id="kobo.119.1"> the whole </span><code class="inlineCode"><span class="koboSpan" id="kobo.120.1">handleSubmit</span></code><span class="koboSpan" id="kobo.121.1"> function.</span></li>
<li class="numberedList"><em class="italic"><span class="koboSpan" id="kobo.122.1">Replace</span></em><span class="koboSpan" id="kobo.123.1"> it with the following Action State Hook:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.124.1">const</span></span><span class="koboSpan" id="kobo.125.1"> [error, submitAction, isPending] = </span><span class="hljs-title"><span class="koboSpan" id="kobo.126.1">useActionState</span></span><span class="koboSpan" id="kobo.127.1">(
</span></code></pre>
</li>
</ol>
<p class="normal-one"><span class="koboSpan" id="kobo.128.1">In this case, we are going to use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.129.1">state</span></code><span class="koboSpan" id="kobo.130.1"> of the action to store an error state. </span><span class="koboSpan" id="kobo.130.2">If there was an error, we will return it from the action function. </span><span class="koboSpan" id="kobo.130.3">Otherwise, we return nothing, so the error state is </span><code class="inlineCode"><span class="koboSpan" id="kobo.131.1">undefined</span></code><span class="koboSpan" id="kobo.132.1">.</span></p>
<ol>
<li class="numberedList" value="6"><span class="koboSpan" id="kobo.133.1">Define the action function, as follows:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.134.1">    async</span></span><span class="koboSpan" id="kobo.135.1"> (currentState, formData) =&gt; {
</span></code></pre>
</li>
</ol>
<p class="normal-one"><span class="koboSpan" id="kobo.136.1">In this case, we are not going to make use of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.137.1">currentState</span></code><span class="koboSpan" id="kobo.138.1"> passed to the function, but we need to define it anyway as we need the second argument to get the </span><code class="inlineCode"><span class="koboSpan" id="kobo.139.1">formData</span></code><span class="koboSpan" id="kobo.140.1">.</span></p>
<ol>
<li class="numberedList" value="7"><span class="koboSpan" id="kobo.141.1">Now, get the title and content from the form by making use of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.142.1">FormData</span></code><span class="koboSpan" id="kobo.143.1"> API:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.144.1">const</span></span><span class="koboSpan" id="kobo.145.1"> title = formData.</span><span class="hljs-title"><span class="koboSpan" id="kobo.146.1">get</span></span><span class="koboSpan" id="kobo.147.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.148.1">'title'</span></span><span class="koboSpan" id="kobo.149.1">)
      </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.150.1">const</span></span><span class="koboSpan" id="kobo.151.1"> content = formData.</span><span class="hljs-title"><span class="koboSpan" id="kobo.152.1">get</span></span><span class="koboSpan" id="kobo.153.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.154.1">'content'</span></span><span class="koboSpan" id="kobo.155.1">)
</span></code></pre>
</li>
</ol>
<p class="normal-one"><span class="koboSpan" id="kobo.156.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.157.1">FormData</span></code><span class="koboSpan" id="kobo.158.1"> API uses the </span><code class="inlineCode"><span class="koboSpan" id="kobo.159.1">name</span></code><span class="koboSpan" id="kobo.160.1"> prop to identify input fields.</span></p>
<ol>
<li class="numberedList" value="8"><span class="koboSpan" id="kobo.161.1">Next, create the post object and call the mutation:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.162.1">const</span></span><span class="koboSpan" id="kobo.163.1"> newPost = { title, content, </span><span class="hljs-attr"><span class="koboSpan" id="kobo.164.1">author</span></span><span class="koboSpan" id="kobo.165.1">: username, </span><span class="hljs-attr"><span class="koboSpan" id="kobo.166.1">featured</span></span><span class="koboSpan" id="kobo.167.1">: </span><span class="hljs-literal"><span class="koboSpan" id="kobo.168.1">false</span></span><span class="koboSpan" id="kobo.169.1"> }
      </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.170.1">try</span></span><span class="koboSpan" id="kobo.171.1"> {
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.172.1">await</span></span><span class="koboSpan" id="kobo.173.1"> createPostMutation.</span><span class="hljs-title"><span class="koboSpan" id="kobo.174.1">mutateAsync</span></span><span class="koboSpan" id="kobo.175.1">(newPost)
</span></code></pre>
</li>
</ol>
<p class="normal-one"><span class="koboSpan" id="kobo.176.1">Since we now have an </span><code class="inlineCode"><span class="koboSpan" id="kobo.177.1">async</span></code><span class="koboSpan" id="kobo.178.1"> function, we can use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.179.1">mutateAsync</span></code><span class="koboSpan" id="kobo.180.1"> method from the mutation to be able to </span><code class="inlineCode"><span class="koboSpan" id="kobo.181.1">await</span></code><span class="koboSpan" id="kobo.182.1"> the response.</span></p>
<ol>
<li class="numberedList" value="9"><span class="koboSpan" id="kobo.183.1">If there was an</span><a id="_idIndexMarker348"/><span class="koboSpan" id="kobo.184.1"> error, return it:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="koboSpan" id="kobo.185.1">      } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.186.1">catch</span></span><span class="koboSpan" id="kobo.187.1"> (err) {
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.188.1">return</span></span><span class="koboSpan" id="kobo.189.1"> err
      }
    },
  )
</span></code></pre>
</li>
</ol>
<div class="note-one">
<p class="normal"><span class="koboSpan" id="kobo.190.1">We do not need to manually reset the form anymore. </span><span class="koboSpan" id="kobo.190.2">When using form actions, all uncontrolled fields in the form will be reset automatically once the form action function completes successfully.</span></p>
</div>
<ol>
<li class="numberedList" value="10"><span class="koboSpan" id="kobo.191.1">Adjust the </span><code class="inlineCode"><span class="koboSpan" id="kobo.192.1">&lt;form&gt;</span></code><span class="koboSpan" id="kobo.193.1"> element to pass the </span><code class="inlineCode"><span class="koboSpan" id="kobo.194.1">action</span></code><span class="koboSpan" id="kobo.195.1"> to it instead of an </span><code class="inlineCode"><span class="koboSpan" id="kobo.196.1">onSubmit</span></code><span class="koboSpan" id="kobo.197.1"> handler:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="koboSpan" id="kobo.198.1">  return (
</span><span class="hljs-tag"><span class="koboSpan" id="kobo.199.1">    &lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.200.1">form</span></span><span class="hljs-tag"> </span><span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.201.1">action</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.202.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.203.1">{submitAction}</span></strong></span><span class="hljs-tag"><span class="koboSpan" id="kobo.204.1">&gt;</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.205.1">Adjust the submit button and error message, as follows:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-tag"><span class="koboSpan" id="kobo.206.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.207.1">input</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.208.1">type</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.209.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.210.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.211.1">submit'</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.212.1">value</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.213.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.214.1">'Create'</span></span><span class="hljs-tag"> </span><span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.215.1">disabled</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.216.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.217.1">{isPending}</span></strong></span><span class="hljs-tag"><span class="koboSpan" id="kobo.218.1"> /&gt;</span></span><span class="koboSpan" id="kobo.219.1">
      {</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.220.1">error</span></strong></span><span class="koboSpan" id="kobo.221.1"> &amp;&amp; </span><span class="hljs-tag"><span class="koboSpan" id="kobo.222.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.223.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.224.1">style</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.225.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.226.1">{{</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.227.1">color:</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.228.1"> '</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.229.1">red</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.230.1">' }}&gt;</span></span><span class="koboSpan" id="kobo.231.1">{</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.232.1">error</span></strong></span><span class="koboSpan" id="kobo.233.1">.toString()}</span><span class="hljs-tag"><span class="koboSpan" id="kobo.234.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.235.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.236.1">&gt;</span></span><span class="koboSpan" id="kobo.237.1">}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.238.1">Start the app, as follows:
        </span><pre class="programlisting con-one"><code class="hljs-con"><span class="koboSpan" id="kobo.239.1">$ npm run dev
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.240.1">On the blog app, log in and create a new post, you will see that it works the same way as before, but we are now using the Action State Hook for form submission!</span></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.241.1">After learning how to handle </span><a id="_idIndexMarker349"/><span class="koboSpan" id="kobo.242.1">form submission with the Action State Hook, let’s move on to learning about blocking UI.</span></p>
<div class="note">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.243.1">Example code</span></strong></p>
<p class="normal"><span class="koboSpan" id="kobo.244.1">The example code for this section can be found in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.245.1">Chapter07/Chapter07_1</span></code><span class="koboSpan" id="kobo.246.1"> folder. </span><span class="koboSpan" id="kobo.246.2">Check the </span><code class="inlineCode"><span class="koboSpan" id="kobo.247.1">README.md</span></code><span class="koboSpan" id="kobo.248.1"> file inside the folder for instructions on how to set up and run the example.</span></p>
</div>
<h1 class="heading-1" id="_idParaDest-168"><a id="_idTextAnchor175"/><span class="koboSpan" id="kobo.249.1">Simulating blocking UI</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.250.1">Before we learn about the Transition </span><a id="_idIndexMarker350"/><span class="koboSpan" id="kobo.251.1">Hook, let’s first introduce the problem that it attempts to solve: blocking UI. </span><span class="koboSpan" id="kobo.251.2">When certain components are computationally intensive, rendering them may cause the whole user interface to be unresponsive. </span><span class="koboSpan" id="kobo.251.3">This can result in a bad user experience, as users cannot do anything else while the components are rendering.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.252.1">We are now going to implement a comment section in our blog to simulate blocking UI.</span></p>
<h2 class="heading-2" id="_idParaDest-169"><a id="_idTextAnchor176"/><span class="koboSpan" id="kobo.253.1">Implementing a (purposefully slow) Comment component</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.254.1">We start by implementing a</span><a id="_idIndexMarker351"/><span class="koboSpan" id="kobo.255.1"> Comment component, which we make slow on purpose to simulate a computationally expensive component.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.256.1">Let’s get started implementing the Comment component:</span></p>
<ol>
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.257.1">Copy the </span><code class="inlineCode"><span class="koboSpan" id="kobo.258.1">Chapter07_1</span></code><span class="koboSpan" id="kobo.259.1"> folder to a new </span><code class="inlineCode"><span class="koboSpan" id="kobo.260.1">Chapter07_2</span></code><span class="koboSpan" id="kobo.261.1"> folder by executing the following command:
        </span><pre class="programlisting con-one"><code class="hljs-con"><span class="koboSpan" id="kobo.262.1">$ cp -R Chapter07_1 Chapter07_2
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.263.1">Open the new </span><code class="inlineCode"><span class="koboSpan" id="kobo.264.1">Chapter07_2</span></code><span class="koboSpan" id="kobo.265.1"> folder in VS Code.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.266.1">Create a new </span><code class="inlineCode"><span class="koboSpan" id="kobo.267.1">src/components/comment/</span></code><span class="koboSpan" id="kobo.268.1"> folder.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.269.1">Create a new </span><code class="inlineCode"><span class="koboSpan" id="kobo.270.1">src/components/comment/Comment.jsx</span></code><span class="koboSpan" id="kobo.271.1"> file. </span><span class="koboSpan" id="kobo.271.2">Inside it, define and export a </span><code class="inlineCode"><span class="koboSpan" id="kobo.272.1">Comment</span></code><span class="koboSpan" id="kobo.273.1"> component, which accepts </span><code class="inlineCode"><span class="koboSpan" id="kobo.274.1">content</span></code><span class="koboSpan" id="kobo.275.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.276.1">author</span></code><span class="koboSpan" id="kobo.277.1"> props:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.278.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.279.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.280.1">Comment</span></span><span class="koboSpan" id="kobo.281.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.282.1">{ content, author }</span></span><span class="koboSpan" id="kobo.283.1">) {
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.284.1">In the component, we simulate a computationally intensive operation by delaying the rendering by 1ms:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.285.1">let</span></span><span class="koboSpan" id="kobo.286.1"> startTime = performance.</span><span class="hljs-title"><span class="koboSpan" id="kobo.287.1">now</span></span><span class="koboSpan" id="kobo.288.1">()
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.289.1">while</span></span><span class="koboSpan" id="kobo.290.1"> (performance.</span><span class="hljs-title"><span class="koboSpan" id="kobo.291.1">now</span></span><span class="koboSpan" id="kobo.292.1">() - startTime &lt; </span><span class="hljs-number"><span class="koboSpan" id="kobo.293.1">1</span></span><span class="koboSpan" id="kobo.294.1">) {
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.295.1">// do nothing for 1 ms</span></span><span class="koboSpan" id="kobo.296.1">
  }
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.297.1">Now, render the comment, as follows:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.298.1">return</span></span><span class="koboSpan" id="kobo.299.1"> (
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.300.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.301.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.302.1">style</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.303.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.304.1">{{</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.305.1">padding:</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.306.1"> '</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.307.1">0.5em</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.308.1">0</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.309.1">' }}&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.310.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.311.1">span</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.312.1">&gt;</span></span><span class="koboSpan" id="kobo.313.1">{content}</span><span class="hljs-tag"><span class="koboSpan" id="kobo.314.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.315.1">span</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.316.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.317.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.318.1">i</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.319.1">&gt;</span></span><span class="koboSpan" id="kobo.320.1"> ~ {author}</span><span class="hljs-tag"><span class="koboSpan" id="kobo.321.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.322.1">i</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.323.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.324.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.325.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.326.1">&gt;</span></span><span class="koboSpan" id="kobo.327.1">
  )
}	
</span></code></pre>
</li>
</ol>
<h2 class="heading-2" id="_idParaDest-170"><a id="_idTextAnchor177"/><span class="koboSpan" id="kobo.328.1">Implementing a CommentList component</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.329.1">Now, we are going to implement a</span><a id="_idIndexMarker352"/><span class="koboSpan" id="kobo.330.1"> CommentList component, which will render 1000 comments:</span></p>
<ol>
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.331.1">Create a new </span><code class="inlineCode"><span class="koboSpan" id="kobo.332.1">src/components/comment/CommentList.jsx</span></code><span class="koboSpan" id="kobo.333.1"> file.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.334.1">Inside it, import the </span><code class="inlineCode"><span class="koboSpan" id="kobo.335.1">Comment</span></code><span class="koboSpan" id="kobo.336.1"> component:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.337.1">import</span></span><span class="koboSpan" id="kobo.338.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.339.1">Comment</span></span><span class="koboSpan" id="kobo.340.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.341.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.342.1">'./Comment.jsx'</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.343.1">Then, define and export a </span><code class="inlineCode"><span class="koboSpan" id="kobo.344.1">CommentList</span></code><span class="koboSpan" id="kobo.345.1"> component, which generates 1000 comments:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.346.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.347.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.348.1">CommentList</span></span><span class="koboSpan" id="kobo.349.1">() {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.350.1">const</span></span><span class="koboSpan" id="kobo.351.1"> comments = </span><span class="hljs-title"><span class="koboSpan" id="kobo.352.1">Array</span></span><span class="koboSpan" id="kobo.353.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.354.1">from</span></span><span class="koboSpan" id="kobo.355.1">({ </span><span class="hljs-attr"><span class="koboSpan" id="kobo.356.1">length</span></span><span class="koboSpan" id="kobo.357.1">: </span><span class="hljs-number"><span class="koboSpan" id="kobo.358.1">1000</span></span><span class="koboSpan" id="kobo.359.1"> }, </span><span class="hljs-function"><span class="koboSpan" id="kobo.360.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.361.1">_, i</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.362.1">) =&gt;</span></span><span class="koboSpan" id="kobo.363.1"> ({
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.364.1">id</span></span><span class="koboSpan" id="kobo.365.1">: i,
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.366.1">content</span></span><span class="koboSpan" id="kobo.367.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.368.1">`Comment #</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.369.1">${i}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.370.1">`</span></span><span class="koboSpan" id="kobo.371.1">,
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.372.1">author</span></span><span class="koboSpan" id="kobo.373.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.374.1">'test'</span></span><span class="koboSpan" id="kobo.375.1">,
  }))
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.376.1">Render the comments:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.377.1">return</span></span><span class="koboSpan" id="kobo.378.1"> (
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.379.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.380.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.381.1">&gt;</span></span><span class="koboSpan" id="kobo.382.1">
      {comments.map((comment) =&gt; (
        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.383.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.384.1">Comment</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.385.1"> {</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.386.1">...comment</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.387.1">} </span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.388.1">key</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.389.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.390.1">{comment.id}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.391.1"> /&gt;</span></span><span class="koboSpan" id="kobo.392.1">
      ))}
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.393.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.394.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.395.1">&gt;</span></span><span class="koboSpan" id="kobo.396.1">
  )
}
</span></code></pre>
</li>
</ol>
<h2 class="heading-2" id="_idParaDest-171"><a id="_idTextAnchor178"/><span class="koboSpan" id="kobo.397.1">Implementing the CommentSection component</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.398.1">Lastly, we are going to implement</span><a id="_idIndexMarker353"/><span class="koboSpan" id="kobo.399.1"> a </span><code class="inlineCode"><span class="koboSpan" id="kobo.400.1">CommentSection</span></code><span class="koboSpan" id="kobo.401.1"> component, which will allow us to show/hide comments of a post by pressing a button.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.402.1">Let’s get started implementing the </span><code class="inlineCode"><span class="koboSpan" id="kobo.403.1">CommentSection</span></code><span class="koboSpan" id="kobo.404.1"> component:</span></p>
<ol>
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.405.1">Create a new </span><code class="inlineCode"><span class="koboSpan" id="kobo.406.1">src/components/comment/CommentSection.jsx</span></code><span class="koboSpan" id="kobo.407.1"> file</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.408.1">Inside it, import the </span><code class="inlineCode"><span class="koboSpan" id="kobo.409.1">useState</span></code><span class="koboSpan" id="kobo.410.1"> function from React and the </span><code class="inlineCode"><span class="koboSpan" id="kobo.411.1">CommentList</span></code><span class="koboSpan" id="kobo.412.1"> component:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.413.1">import</span></span><span class="koboSpan" id="kobo.414.1"> { useState } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.415.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.416.1">'react'</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.417.1">import</span></span><span class="koboSpan" id="kobo.418.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.419.1">CommentList</span></span><span class="koboSpan" id="kobo.420.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.421.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.422.1">'./CommentList.jsx'</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.423.1">Next, define and export the </span><code class="inlineCode"><span class="koboSpan" id="kobo.424.1">CommentSection</span></code><span class="koboSpan" id="kobo.425.1"> component, in which we define a State Hook to toggle the comment list on and off:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.426.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.427.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.428.1">CommentSection</span></span><span class="koboSpan" id="kobo.429.1">() {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.430.1">const</span></span><span class="koboSpan" id="kobo.431.1"> [showComments, setShowComments] = </span><span class="hljs-title"><span class="koboSpan" id="kobo.432.1">useState</span></span><span class="koboSpan" id="kobo.433.1">(</span><span class="hljs-literal"><span class="koboSpan" id="kobo.434.1">false</span></span><span class="koboSpan" id="kobo.435.1">)
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.436.1">Then, define a </span><code class="inlineCode"><span class="koboSpan" id="kobo.437.1">handleClick</span></code><span class="koboSpan" id="kobo.438.1"> function which will toggle the comment list:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.439.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.440.1">handleClick</span></span><span class="koboSpan" id="kobo.441.1">() {
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.442.1">setShowComments</span></span><span class="koboSpan" id="kobo.443.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.444.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.445.1">prev</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.446.1">) =&gt;</span></span><span class="koboSpan" id="kobo.447.1"> !prev)
  }
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.448.1">Render a button and conditionally render the </span><code class="inlineCode"><span class="koboSpan" id="kobo.449.1">CommentList</span></code><span class="koboSpan" id="kobo.450.1"> component:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.451.1">return</span></span><span class="koboSpan" id="kobo.452.1"> (
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.453.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.454.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.455.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.456.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.457.1">button</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.458.1">onClick</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.459.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.460.1">{handleClick}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.461.1">&gt;</span></span><span class="koboSpan" id="kobo.462.1">
        {showComments ? </span><span class="koboSpan" id="kobo.462.2">'Hide' : 'Show'} comments
      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.463.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.464.1">button</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.465.1">&gt;</span></span><span class="koboSpan" id="kobo.466.1">
      {showComments &amp;&amp; </span><span class="hljs-tag"><span class="koboSpan" id="kobo.467.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.468.1">CommentList</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.469.1"> /&gt;</span></span><span class="koboSpan" id="kobo.470.1">}
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.471.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.472.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.473.1">&gt;</span></span><span class="koboSpan" id="kobo.474.1">
  )
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.475.1">Finally, edit </span><code class="inlineCode"><span class="koboSpan" id="kobo.476.1">src/components/post/Post.jsx</span></code><span class="koboSpan" id="kobo.477.1"> and import the </span><code class="inlineCode"><span class="koboSpan" id="kobo.478.1">CommentSection</span></code><span class="koboSpan" id="kobo.479.1"> component there:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.480.1">import</span></span><span class="koboSpan" id="kobo.481.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.482.1">CommentSection</span></span><span class="koboSpan" id="kobo.483.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.484.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.485.1">'@/components/comment/CommentSection.jsx'</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.486.1">Render it at the </span><a id="_idIndexMarker354"/><span class="koboSpan" id="kobo.487.1">end of the post, as follows:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="koboSpan" id="kobo.488.1">      &lt;i&gt;
        </span><span class="hljs-title"><span class="koboSpan" id="kobo.489.1">Written</span></span><span class="koboSpan" id="kobo.490.1"> by &lt;b&gt;{author}&lt;</span><span class="hljs-regexp"><span class="koboSpan" id="kobo.491.1">/b&gt;</span></span>
<span class="hljs-regexp"><span class="koboSpan" id="kobo.492.1">      &lt;/i</span></span><span class="koboSpan" id="kobo.493.1">&gt;
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.494.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.495.1">br</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.496.1"> /&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.497.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.498.1">br</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.499.1"> /&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.500.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.501.1">CommentSection</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.502.1"> /&gt;</span></strong></span><span class="koboSpan" id="kobo.503.1">
    &lt;/div&gt;
  )
}
</span></code></pre>
</li>
</ol>
<h2 class="heading-2" id="_idParaDest-172"><a id="_idTextAnchor179"/><span class="koboSpan" id="kobo.504.1">Testing out the simulated blocking UI</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.505.1">Now we can test the comment section</span><a id="_idIndexMarker355"/><span class="koboSpan" id="kobo.506.1"> and see how it causes the UI to block. </span><span class="koboSpan" id="kobo.506.2">Follow these steps:</span></p>
<ol>
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.507.1">Run the project, as follows:
        </span><pre class="programlisting con-one"><code class="hljs-con"><span class="koboSpan" id="kobo.508.1">$ npm run dev
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.509.1">Open the frontend in your browser by going to </span><code class="inlineCode"><span class="koboSpan" id="kobo.510.1">http://localhost:5173/</span></code></li>
<li class="numberedList"><span class="koboSpan" id="kobo.511.1">Click on one of the </span><strong class="screenText"><span class="koboSpan" id="kobo.512.1">Show comments</span></strong><span class="koboSpan" id="kobo.513.1"> buttons.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.514.1">You will see that after pressing the button, the whole UI is unresponsive. </span><span class="koboSpan" id="kobo.514.2">Try pressing one of </span><a id="_idIndexMarker356"/><span class="koboSpan" id="kobo.515.1">the other </span><strong class="screenText"><span class="koboSpan" id="kobo.516.1">Show comments</span></strong><span class="koboSpan" id="kobo.517.1"> buttons – it does not work.</span></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.518.1">As we can see, rendering computationally expensive components can cause the whole UI to become unresponsive. </span><span class="koboSpan" id="kobo.518.2">To fix this, we need to use Transitions – which we are going to learn about in the next section.</span></p>
<div class="note">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.519.1">Example code</span></strong></p>
<p class="normal"><span class="koboSpan" id="kobo.520.1">The example code for this section can be found in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.521.1">Chapter07/Chapter07_2</span></code><span class="koboSpan" id="kobo.522.1"> folder. </span><span class="koboSpan" id="kobo.522.2">Check the </span><code class="inlineCode"><span class="koboSpan" id="kobo.523.1">README.md</span></code><span class="koboSpan" id="kobo.524.1"> file inside the folder for instructions on how to set up and run the example.</span></p>
</div>
<h1 class="heading-1" id="_idParaDest-173"><a id="_idTextAnchor180"/><span class="koboSpan" id="kobo.525.1">Avoiding blocking UI with the Transition Hook</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.526.1">The Transition Hook lets you </span><a id="_idIndexMarker357"/><span class="koboSpan" id="kobo.527.1">handle asynchronous operations by </span><a id="_idIndexMarker358"/><span class="koboSpan" id="kobo.528.1">updating state without blocking the UI. </span><span class="koboSpan" id="kobo.528.2">This is especially useful for rendering computationally expensive component trees, such as rendering tabs and their (potentially complex) contents, or when making a client-side router. </span><span class="koboSpan" id="kobo.528.3">The Transition Hook has the following signature:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.529.1">const [isPending, startTransition] = useTransition()
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.530.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.531.1">isPending</span></code><span class="koboSpan" id="kobo.532.1"> state can be used to handle the loading state. </span><span class="koboSpan" id="kobo.532.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.533.1">startTransition</span></code><span class="koboSpan" id="kobo.534.1"> function allows us to pass a function to start the transition. </span><span class="koboSpan" id="kobo.534.2">This function needs to be synchronous. </span><span class="koboSpan" id="kobo.534.3">While the updates (for example, setting state) triggered inside the functions are being executed and their effects on components evaluated, </span><code class="inlineCode"><span class="koboSpan" id="kobo.535.1">isPending</span></code><span class="koboSpan" id="kobo.536.1"> will be set to </span><code class="inlineCode"><span class="koboSpan" id="kobo.537.1">true</span></code><span class="koboSpan" id="kobo.538.1">. </span><span class="koboSpan" id="kobo.538.2">This does not block the UI in any way, so other components still behave normally while the transition is executing.</span></p>
<h2 class="heading-2" id="_idParaDest-174"><a id="_idTextAnchor181"/><span class="koboSpan" id="kobo.539.1">Using the Transition Hook</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.540.1">We are now going to use the </span><a id="_idIndexMarker359"/><span class="koboSpan" id="kobo.541.1">Transition Hook to avoid blocking the UI when showing lots of comments. </span><span class="koboSpan" id="kobo.541.2">Let’s get started:</span></p>
<ol>
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.542.1">Copy the </span><code class="inlineCode"><span class="koboSpan" id="kobo.543.1">Chapter07_2</span></code><span class="koboSpan" id="kobo.544.1"> folder to a new </span><code class="inlineCode"><span class="koboSpan" id="kobo.545.1">Chapter07_3</span></code><span class="koboSpan" id="kobo.546.1"> folder by executing the following command:
        </span><pre class="programlisting con-one"><code class="hljs-con"><span class="koboSpan" id="kobo.547.1">$ cp -R Chapter07_2 Chapter07_3
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.548.1">Open the new </span><code class="inlineCode"><span class="koboSpan" id="kobo.549.1">Chapter07_3</span></code><span class="koboSpan" id="kobo.550.1"> folder in VS Code.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.551.1">Edit </span><code class="inlineCode"><span class="koboSpan" id="kobo.552.1">src/components/comment/CommentSection.jsx</span></code><span class="koboSpan" id="kobo.553.1"> and import the </span><code class="inlineCode"><span class="koboSpan" id="kobo.554.1">useTransition</span></code><span class="koboSpan" id="kobo.555.1"> function:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.556.1">import</span></span><span class="koboSpan" id="kobo.557.1"> { useState, </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.558.1">useTransition</span></strong></span><span class="koboSpan" id="kobo.559.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.560.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.561.1">'react'</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.562.1">Define a Transition Hook, as follows:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.563.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.564.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.565.1">CommentSection</span></span><span class="koboSpan" id="kobo.566.1">() {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.567.1">const</span></span><span class="koboSpan" id="kobo.568.1"> [showComments, setShowComments] = </span><span class="hljs-title"><span class="koboSpan" id="kobo.569.1">useState</span></span><span class="koboSpan" id="kobo.570.1">(</span><span class="hljs-literal"><span class="koboSpan" id="kobo.571.1">false</span></span><span class="koboSpan" id="kobo.572.1">)
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.573.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.574.1"> [isPending, startTransition] = </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.575.1">useTransition</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.576.1">()</span></strong></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.577.1">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.578.1">handleClick</span></code><span class="koboSpan" id="kobo.579.1"> function, start a transition:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.580.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.581.1">handleClick</span></span><span class="koboSpan" id="kobo.582.1">() {
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.583.1">startTransition</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.584.1">(</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.585.1">() =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.586.1"> {</span></strong></span>
<span class="hljs-title"><span class="koboSpan" id="kobo.587.1">setShowComments</span></span><span class="koboSpan" id="kobo.588.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.589.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.590.1">prev</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.591.1">) =&gt;</span></span><span class="koboSpan" id="kobo.592.1"> !prev)
    </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.593.1">})</span></strong></span><span class="koboSpan" id="kobo.594.1">
  }
</span></code></pre>
</li>
</ol>
<div class="note-one">
<p class="normal"><span class="koboSpan" id="kobo.595.1">Transitions have specific use cases and certain limitations. </span><span class="koboSpan" id="kobo.595.2">For example, do not use Transitions for handling controlled input state, because Transitions are non-blocking, but we actually want the input state to update immediately. </span><span class="koboSpan" id="kobo.595.3">Additionally, inside a Transition, all updates need to be called immediately. </span><span class="koboSpan" id="kobo.595.4">While it is generally possible to await asynchronous functions in Transitions, it is not possible to wait for an asynchronous request to finish </span><em class="italic"><span class="koboSpan" id="kobo.596.1">before updating the state</span></em><span class="koboSpan" id="kobo.597.1"> inside a Transition. </span><span class="koboSpan" id="kobo.597.2">If you need to wait for an asynchronous request before updating state, it is better to </span><code class="inlineCode"><span class="koboSpan" id="kobo.598.1">await</span></code><span class="koboSpan" id="kobo.599.1"> it in the handler function and then start the Transition afterward. </span><span class="koboSpan" id="kobo.599.2">For more information, check out the troubleshooting guide on the React docs: </span><a href="https://react.dev/reference/react/useTransition#troubleshooting"><span class="url"><span class="koboSpan" id="kobo.600.1">https://react.dev/reference/react/useTransition#troubleshooting</span></span></a></p>
</div>
<ol>
<li class="numberedList" value="6"><span class="koboSpan" id="kobo.601.1">We can now disable the button while the transition is pending:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-tag"><span class="koboSpan" id="kobo.602.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.603.1">button</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.604.1">onClick</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.605.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.606.1">{handleClick}</span></span><span class="hljs-tag"> </span><span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.607.1">disabled</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.608.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.609.1">{isPending}</span></strong></span><span class="hljs-tag"><span class="koboSpan" id="kobo.610.1">&gt;</span></span>
</code></pre>
</li>
</ol>
<h2 class="heading-2" id="_idParaDest-175"><a id="_idTextAnchor182"/><span class="koboSpan" id="kobo.611.1">Testing out the non-blocking Transition</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.612.1">Now we can test the comment</span><a id="_idIndexMarker360"/><span class="koboSpan" id="kobo.613.1"> section and see how it does not block the UI anymore. </span><span class="koboSpan" id="kobo.613.2">Follow these steps:</span></p>
<ol>
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.614.1">Run the project, as follows:
        </span><pre class="programlisting con-one"><code class="hljs-con"><span class="koboSpan" id="kobo.615.1">$ npm run dev
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.616.1">Open the frontend in your browser by going to </span><code class="inlineCode"><span class="koboSpan" id="kobo.617.1">http://localhost:5173/</span></code></li>
<li class="numberedList"><span class="koboSpan" id="kobo.618.1">Click on one of the </span><strong class="screenText"><span class="koboSpan" id="kobo.619.1">Show comments</span></strong><span class="koboSpan" id="kobo.620.1"> buttons.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.621.1">You will see that after pressing the button, the rest of the UI remains responsive. </span><span class="koboSpan" id="kobo.621.2">Try pressing one of the other </span><strong class="screenText"><span class="koboSpan" id="kobo.622.1">Show comments</span></strong><span class="koboSpan" id="kobo.623.1"> buttons – it works now and triggers another Transition!</span></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.624.1">As we can see, by using Transitions we can keep the UI responsive while causing state updates that render computationally expensive components!</span></p>
<div class="note">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.625.1">Example code</span></strong></p>
<p class="normal"><span class="koboSpan" id="kobo.626.1">The example code for this section can be found in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.627.1">Chapter07/Chapter07_3</span></code><span class="koboSpan" id="kobo.628.1"> folder. </span><span class="koboSpan" id="kobo.628.2">Check the </span><code class="inlineCode"><span class="koboSpan" id="kobo.629.1">README.md</span></code><span class="koboSpan" id="kobo.630.1"> file inside the folder for instructions on how to set up and run the example.</span></p>
</div>
<h1 class="heading-1" id="_idParaDest-176"><a id="_idTextAnchor183"/><span class="koboSpan" id="kobo.631.1">Using the Optimistic Hook to implement optimistic updates</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.632.1">There are two ways to </span><a id="_idIndexMarker361"/><span class="koboSpan" id="kobo.633.1">handle updates/mutations:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.634.1">Show a loading state and disable certain actions while it is loading</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.635.1">Do an optimistic update, which immediately shows the result of the action on the client, while the mutation is still pending. </span><span class="koboSpan" id="kobo.635.2">Then, update the local state from the server state when the mutation finishes.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.636.1">Depending on your use case, one or the other option will be a better fit. </span><span class="koboSpan" id="kobo.636.2">Usually, optimistic updates are great for </span><em class="italic"><span class="koboSpan" id="kobo.637.1">fast-paced</span></em><span class="koboSpan" id="kobo.638.1"> actions, such as a chat app. </span><span class="koboSpan" id="kobo.638.2">While a loading state without optimistic updates is better for critical actions, such as making a bank transfer.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.639.1">The Optimistic Hook has the following signature:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.640.1">const</span></span><span class="koboSpan" id="kobo.641.1"> [optimisticState, addOptimistic] = </span><span class="hljs-title"><span class="koboSpan" id="kobo.642.1">useOptimistic</span></span><span class="koboSpan" id="kobo.643.1">(state, updateFn)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.644.1">As we can see, it accepts a </span><code class="inlineCode"><span class="koboSpan" id="kobo.645.1">state</span></code><span class="koboSpan" id="kobo.646.1"> (usually, this is a server state) and an </span><code class="inlineCode"><span class="koboSpan" id="kobo.647.1">updateFn</span></code><span class="koboSpan" id="kobo.648.1"> function to process the update. </span><span class="koboSpan" id="kobo.648.2">Then, it returns an </span><code class="inlineCode"><span class="koboSpan" id="kobo.649.1">optimisticState</span></code><span class="koboSpan" id="kobo.650.1"> and an </span><code class="inlineCode"><span class="koboSpan" id="kobo.651.1">addOptimistic</span></code><span class="koboSpan" id="kobo.652.1"> function, which can be used to optimistically add a new item to the state. </span></p>
<p class="normal"><span class="koboSpan" id="kobo.653.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.654.1">updateFn</span></code><span class="koboSpan" id="kobo.655.1"> accepts two arguments, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.656.1">currentState</span></code><span class="koboSpan" id="kobo.657.1"> and the </span><code class="inlineCode"><span class="koboSpan" id="kobo.658.1">optimisticValue</span></code><span class="koboSpan" id="kobo.659.1"> passed to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.660.1">addOptimistic</span></code><span class="koboSpan" id="kobo.661.1"> function. </span><span class="koboSpan" id="kobo.661.2">It then returns a new optimistic state.</span></p>
<h2 class="heading-2" id="_idParaDest-177"><a id="_idTextAnchor184"/><span class="koboSpan" id="kobo.662.1">Implementing optimistic comment creation</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.663.1">In our case, we are </span><a id="_idIndexMarker362"/><span class="koboSpan" id="kobo.664.1">going to implement a way to create new comments using optimistic updates. </span><span class="koboSpan" id="kobo.664.2">Let’s get started doing it:</span></p>
<ol>
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.665.1">Copy the </span><code class="inlineCode"><span class="koboSpan" id="kobo.666.1">Chapter07_3</span></code><span class="koboSpan" id="kobo.667.1"> folder to a new </span><code class="inlineCode"><span class="koboSpan" id="kobo.668.1">Chapter07_4</span></code><span class="koboSpan" id="kobo.669.1"> folder by executing the following command:
        </span><pre class="programlisting con-one"><code class="hljs-con"><span class="koboSpan" id="kobo.670.1">$ cp -R Chapter07_3 Chapter07_4
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.671.1">Open the new </span><code class="inlineCode"><span class="koboSpan" id="kobo.672.1">Chapter07_4</span></code><span class="koboSpan" id="kobo.673.1"> folder in VS Code.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.674.1">Create a new </span><code class="inlineCode"><span class="koboSpan" id="kobo.675.1">src/components/comment/CreateComment.jsx</span></code><span class="koboSpan" id="kobo.676.1"> file and import the </span><code class="inlineCode"><span class="koboSpan" id="kobo.677.1">useContext</span></code><span class="koboSpan" id="kobo.678.1"> function and the </span><code class="inlineCode"><span class="koboSpan" id="kobo.679.1">UserContext</span></code><span class="koboSpan" id="kobo.680.1">:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.681.1">import</span></span><span class="koboSpan" id="kobo.682.1"> { useContext } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.683.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.684.1">'react'</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.685.1">import</span></span><span class="koboSpan" id="kobo.686.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.687.1">UserContext</span></span><span class="koboSpan" id="kobo.688.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.689.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.690.1">'@/contexts/UserContext.js'</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.691.1">Define the </span><code class="inlineCode"><span class="koboSpan" id="kobo.692.1">CreateComment</span></code><span class="koboSpan" id="kobo.693.1"> component, which accepts an </span><code class="inlineCode"><span class="koboSpan" id="kobo.694.1">addComment</span></code><span class="koboSpan" id="kobo.695.1"> function:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.696.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.697.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.698.1">CreateComment</span></span><span class="koboSpan" id="kobo.699.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.700.1">{ addComment }</span></span><span class="koboSpan" id="kobo.701.1">) {
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.702.1">Get the </span><code class="inlineCode"><span class="koboSpan" id="kobo.703.1">username</span></code><span class="koboSpan" id="kobo.704.1"> of the currently logged in user from the context:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.705.1">const</span></span><span class="koboSpan" id="kobo.706.1"> [username] = </span><span class="hljs-title"><span class="koboSpan" id="kobo.707.1">useContext</span></span><span class="koboSpan" id="kobo.708.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.709.1">UserContext</span></span><span class="koboSpan" id="kobo.710.1">)
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.711.1">Define </span><a id="_idIndexMarker363"/><span class="koboSpan" id="kobo.712.1">a </span><code class="inlineCode"><span class="koboSpan" id="kobo.713.1">submitAction</span></code><span class="koboSpan" id="kobo.714.1">, which calls the </span><code class="inlineCode"><span class="koboSpan" id="kobo.715.1">addComment</span></code><span class="koboSpan" id="kobo.716.1"> function:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.717.1">async</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.718.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.719.1">submitAction</span></span><span class="koboSpan" id="kobo.720.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.721.1">formData</span></span><span class="koboSpan" id="kobo.722.1">) {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.723.1">const</span></span><span class="koboSpan" id="kobo.724.1"> content = formData.</span><span class="hljs-title"><span class="koboSpan" id="kobo.725.1">get</span></span><span class="koboSpan" id="kobo.726.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.727.1">'content'</span></span><span class="koboSpan" id="kobo.728.1">)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.729.1">const</span></span><span class="koboSpan" id="kobo.730.1"> comment = {
      </span><span class="hljs-attr"><span class="koboSpan" id="kobo.731.1">author</span></span><span class="koboSpan" id="kobo.732.1">: username,
      content,
    }
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.733.1">await</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.734.1">addComment</span></span><span class="koboSpan" id="kobo.735.1">(comment)
  }
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.736.1">Define a </span><code class="inlineCode"><span class="koboSpan" id="kobo.737.1">&lt;form&gt;</span></code><span class="koboSpan" id="kobo.738.1"> and pass the </span><code class="inlineCode"><span class="koboSpan" id="kobo.739.1">submitAction</span></code><span class="koboSpan" id="kobo.740.1"> to it:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.741.1">return</span></span><span class="koboSpan" id="kobo.742.1"> (
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.743.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.744.1">form</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.745.1">action</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.746.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.747.1">{submitAction}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.748.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.749.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.750.1">input</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.751.1">type</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.752.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.753.1">'text'</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.754.1">name</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.755.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.756.1">'content'</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.757.1"> /&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.758.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.759.1">i</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.760.1">&gt;</span></span><span class="koboSpan" id="kobo.761.1"> ~ {username}</span><span class="hljs-tag"><span class="koboSpan" id="kobo.762.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.763.1">i</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.764.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.765.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.766.1">input</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.767.1">type</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.768.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.769.1">'submit'</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.770.1">value</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.771.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.772.1">'Create'</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.773.1"> /&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.774.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.775.1">form</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.776.1">&gt;</span></span><span class="koboSpan" id="kobo.777.1">
  )
}
</span></code></pre>
</li>
</ol>
<div class="note-one">
<p class="normal"><span class="koboSpan" id="kobo.778.1">As we can see, it is also possible to define Form Actions without using the Action State Hook. </span><span class="koboSpan" id="kobo.778.2">However, then we only get a simple function to handle form submission, without any of the form state handling functionality (such as pending and error states).</span></p>
</div>
<ol>
<li class="numberedList" value="8"><span class="koboSpan" id="kobo.779.1">Edit </span><code class="inlineCode"><span class="koboSpan" id="kobo.780.1">src/components/comment/CommentList.jsx</span></code><span class="koboSpan" id="kobo.781.1"> and</span><a id="_idIndexMarker364"/><span class="koboSpan" id="kobo.782.1"> import the following:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.783.1">import</span></span><span class="koboSpan" id="kobo.784.1"> { useContext, useState, useOptimistic } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.785.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.786.1">'react'</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.787.1">import</span></span><span class="koboSpan" id="kobo.788.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.789.1">UserContext</span></span><span class="koboSpan" id="kobo.790.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.791.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.792.1">'@/contexts/UserContext.js'</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.793.1">import</span></span><span class="koboSpan" id="kobo.794.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.795.1">CreateComment</span></span><span class="koboSpan" id="kobo.796.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.797.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.798.1">'./CreateComment.jsx'</span></span>
</code></pre>
</li>
<li class="numberedList"><em class="italic"><span class="koboSpan" id="kobo.799.1">Remove</span></em><span class="koboSpan" id="kobo.800.1"> the following code:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.801.1">const</span></span><span class="koboSpan" id="kobo.802.1"> comments = </span><span class="hljs-title"><span class="koboSpan" id="kobo.803.1">Array</span></span><span class="koboSpan" id="kobo.804.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.805.1">from</span></span><span class="koboSpan" id="kobo.806.1">({ </span><span class="hljs-attr"><span class="koboSpan" id="kobo.807.1">length</span></span><span class="koboSpan" id="kobo.808.1">: </span><span class="hljs-number"><span class="koboSpan" id="kobo.809.1">1000</span></span><span class="koboSpan" id="kobo.810.1"> }, </span><span class="hljs-function"><span class="koboSpan" id="kobo.811.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.812.1">_, i</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.813.1">) =&gt;</span></span><span class="koboSpan" id="kobo.814.1"> ({
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.815.1">id</span></span><span class="koboSpan" id="kobo.816.1">: i,
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.817.1">content</span></span><span class="koboSpan" id="kobo.818.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.819.1">`Comment #</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.820.1">${i}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.821.1">`</span></span><span class="koboSpan" id="kobo.822.1">,
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.823.1">author</span></span><span class="koboSpan" id="kobo.824.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.825.1">'test'</span></span><span class="koboSpan" id="kobo.826.1">,
  }))
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.827.1">Then, define a Context Hook to get the </span><code class="inlineCode"><span class="koboSpan" id="kobo.828.1">username</span></code><span class="koboSpan" id="kobo.829.1"> of the currently logged in user:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.830.1">const</span></span><span class="koboSpan" id="kobo.831.1"> [username] = </span><span class="hljs-title"><span class="koboSpan" id="kobo.832.1">useContext</span></span><span class="koboSpan" id="kobo.833.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.834.1">UserContext</span></span><span class="koboSpan" id="kobo.835.1">)
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.836.1">Next, define a State Hook to store the comments:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.837.1">const</span></span><span class="koboSpan" id="kobo.838.1"> [comments, setComments] = </span><span class="hljs-title"><span class="koboSpan" id="kobo.839.1">useState</span></span><span class="koboSpan" id="kobo.840.1">([])
</span></code></pre>
</li>
</ol>
<p class="normal-one"><span class="koboSpan" id="kobo.841.1">To keep this section short and to the point, we only focus on optimistic updates, feel free to implement a way to store the comments in the database on your own here.</span></p>
<ol>
<li class="numberedList" value="12"><span class="koboSpan" id="kobo.842.1">Now, define the Optimistic Hook:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.843.1">const</span></span><span class="koboSpan" id="kobo.844.1"> [optimisticComments, addOptimisticComment] = </span><span class="hljs-title"><span class="koboSpan" id="kobo.845.1">useOptimistic</span></span><span class="koboSpan" id="kobo.846.1">(
    comments,
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.847.1">In the update </span><a id="_idIndexMarker365"/><span class="koboSpan" id="kobo.848.1">function, we add the comment to the array with a </span><code class="inlineCode"><span class="koboSpan" id="kobo.849.1">sending</span></code><span class="koboSpan" id="kobo.850.1"> prop set to </span><code class="inlineCode"><span class="koboSpan" id="kobo.851.1">true</span></code><span class="koboSpan" id="kobo.852.1">. </span><span class="koboSpan" id="kobo.852.2">We are going to use this prop later to visually distinguish optimistically created comments from real comments:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="koboSpan" id="kobo.853.1">    (state, comment) =&gt; [
      ...state,
      {
        ...comment,
        </span><span class="hljs-attr"><span class="koboSpan" id="kobo.854.1">sending</span></span><span class="koboSpan" id="kobo.855.1">: </span><span class="hljs-literal"><span class="koboSpan" id="kobo.856.1">true</span></span><span class="koboSpan" id="kobo.857.1">,
        </span><span class="hljs-attr"><span class="koboSpan" id="kobo.858.1">id</span></span><span class="koboSpan" id="kobo.859.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.860.1">Date</span></span><span class="koboSpan" id="kobo.861.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.862.1">now</span></span><span class="koboSpan" id="kobo.863.1">(),
      },
    ],
  )
</span></code></pre>
</li>
</ol>
<p class="normal-one"><span class="koboSpan" id="kobo.864.1">We also defined a temporary ID for the optimistic comments here, which we can use later for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.865.1">key</span></code><span class="koboSpan" id="kobo.866.1"> prop.</span></p>
<ol>
<li class="numberedList" value="14"><span class="koboSpan" id="kobo.867.1">Now, define the </span><code class="inlineCode"><span class="koboSpan" id="kobo.868.1">addComment</span></code><span class="koboSpan" id="kobo.869.1"> function, which first adds the comment optimistically, then waits for a second, and then adds it to the “database”:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.870.1">async</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.871.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.872.1">addComment</span></span><span class="koboSpan" id="kobo.873.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.874.1">comment</span></span><span class="koboSpan" id="kobo.875.1">) {
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.876.1">addOptimisticComment</span></span><span class="koboSpan" id="kobo.877.1">(comment)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.878.1">await</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.879.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.880.1">Promise</span></span><span class="koboSpan" id="kobo.881.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.882.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.883.1">resolve</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.884.1">) =&gt;</span></span> <span class="hljs-built_in"><span class="koboSpan" id="kobo.885.1">setTimeout</span></span><span class="koboSpan" id="kobo.886.1">(resolve, </span><span class="hljs-number"><span class="koboSpan" id="kobo.887.1">1000</span></span><span class="koboSpan" id="kobo.888.1">))
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.889.1">setComments</span></span><span class="koboSpan" id="kobo.890.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.891.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.892.1">prev</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.893.1">) =&gt;</span></span><span class="koboSpan" id="kobo.894.1"> [...prev, comment])
  }
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.895.1">Render the </span><a id="_idIndexMarker366"/><span class="koboSpan" id="kobo.896.1">optimistic comments, as follows:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="koboSpan" id="kobo.897.1">  return (
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.898.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.899.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.900.1">&gt;</span></span><span class="koboSpan" id="kobo.901.1">
      {</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.902.1">optimisticComments</span></strong></span><span class="koboSpan" id="kobo.903.1">.map((comment) =&gt; (
        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.904.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.905.1">Comment</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.906.1"> {</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.907.1">...comment</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.908.1">} </span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.909.1">key</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.910.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.911.1">{comment.id}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.912.1"> /&gt;</span></span><span class="koboSpan" id="kobo.913.1">
      ))}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.914.1">If there are no comments yet, we can show an empty state:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="koboSpan" id="kobo.915.1">      {optimisticComments.length === 0 &amp;&amp; </span><span class="hljs-tag"><span class="koboSpan" id="kobo.916.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.917.1">i</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.918.1">&gt;</span></span><span class="koboSpan" id="kobo.919.1">No comments</span><span class="hljs-tag"><span class="koboSpan" id="kobo.920.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.921.1">i</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.922.1">&gt;</span></span><span class="koboSpan" id="kobo.923.1">}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.924.1">If the user is logged in, we allow them to create new comments:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.925.1">      {username &amp;&amp; </span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.926.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.927.1">CreateComment</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.928.1">addComment</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.929.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.930.1">{addComment}</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.931.1"> /&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.932.1">}</span></strong></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.933.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.934.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.935.1">&gt;</span></span><span class="koboSpan" id="kobo.936.1">
  )
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.937.1">Finally, edit </span><code class="inlineCode"><span class="koboSpan" id="kobo.938.1">src/components/comment/Comment.jsx</span></code><span class="koboSpan" id="kobo.939.1"> and add the </span><code class="inlineCode"><span class="koboSpan" id="kobo.940.1">sending</span></code><span class="koboSpan" id="kobo.941.1"> prop to it:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.942.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.943.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.944.1">Comment</span></span><span class="koboSpan" id="kobo.945.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.946.1">{ content, author, </span></span><span class="code-highlight"><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.947.1">sending</span></strong></span><span class="hljs-params"><span class="koboSpan" id="kobo.948.1"> }</span></span><span class="koboSpan" id="kobo.949.1">) {
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.950.1">Then, </span><em class="italic"><span class="koboSpan" id="kobo.951.1">remove</span></em><span class="koboSpan" id="kobo.952.1"> the following code from it:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.953.1">let</span></span><span class="koboSpan" id="kobo.954.1"> startTime = performance.</span><span class="hljs-title"><span class="koboSpan" id="kobo.955.1">now</span></span><span class="koboSpan" id="kobo.956.1">()
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.957.1">while</span></span><span class="koboSpan" id="kobo.958.1"> (performance.</span><span class="hljs-title"><span class="koboSpan" id="kobo.959.1">now</span></span><span class="koboSpan" id="kobo.960.1">() - startTime &lt; </span><span class="hljs-number"><span class="koboSpan" id="kobo.961.1">1</span></span><span class="koboSpan" id="kobo.962.1">) {
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.963.1">// do nothing for 1 ms</span></span><span class="koboSpan" id="kobo.964.1">
  }
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.965.1">Now, change the color depending on the sending prop, showing optimistically inserted comments in a gray color:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.966.1">return</span></span><span class="koboSpan" id="kobo.967.1"> (
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.968.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.969.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.970.1">style</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.971.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.972.1">{{</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.973.1">padding:</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.974.1"> '</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.975.1">0.5em</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.976.1">0</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.977.1">', </span></span><span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.978.1">color:</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.979.1">sending</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.980.1"> ? </span><span class="koboSpan" id="kobo.980.2">'</span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.981.1">gray</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.982.1">' </span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.983.1">:</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.984.1"> '</span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.985.1">black</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.986.1">' }}&gt;</span></strong></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.987.1">Run the project, as follows:
        </span><pre class="programlisting con-one"><code class="hljs-con"><span class="koboSpan" id="kobo.988.1">$ npm run dev
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.989.1">Open the frontend in your browser by going to </span><code class="inlineCode"><span class="koboSpan" id="kobo.990.1">http://localhost:5173/</span></code></li>
<li class="numberedList"><span class="koboSpan" id="kobo.991.1">Log in using the form at the top, then press one of the </span><strong class="screenText"><span class="koboSpan" id="kobo.992.1">Show comments</span></strong><span class="koboSpan" id="kobo.993.1"> buttons. </span><span class="koboSpan" id="kobo.993.2">It should show the </span><strong class="screenText"><span class="koboSpan" id="kobo.994.1">No comments</span></strong><span class="koboSpan" id="kobo.995.1"> message.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.996.1">Type</span><a id="_idIndexMarker367"/><span class="koboSpan" id="kobo.997.1"> in a new comment and press </span><strong class="screenText"><span class="koboSpan" id="kobo.998.1">Create</span></strong><span class="koboSpan" id="kobo.999.1">.</span></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.1000.1">You will see the comment being optimistically inserted in gray color at first, and then after a second it will appear in black, signifying that the comment has been successfully stored in the “database”:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1001.1"><img alt="Figure 7.1 – Optimistically inserting a new comment" src="../Images/B31327_07_01.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1002.1">Figure 7.1 – Optimistically inserting a new comment</span></p>
<div class="note">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.1003.1">Example code</span></strong></p>
<p class="normal"><span class="koboSpan" id="kobo.1004.1">The example code for this section can be found in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1005.1">Chapter07/Chapter07_4</span></code><span class="koboSpan" id="kobo.1006.1"> folder. </span><span class="koboSpan" id="kobo.1006.2">Check the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1007.1">README.md</span></code><span class="koboSpan" id="kobo.1008.1"> file inside the folder for instructions on how to set up and run the example.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.1009.1">As you can see, the Optimistic Hook is a great way to implement optimistic updates and keep your app fast and responsive!</span></p>
<h1 class="heading-1" id="_idParaDest-178"><a id="_idTextAnchor185"/><span class="koboSpan" id="kobo.1010.1">Summary</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1011.1">In this chapter, we first learned about handling form submission and states using Form Actions and the Action State Hook. </span><span class="koboSpan" id="kobo.1011.2">Then, we simulated a potential issue when dealing with rendering computationally expensive components: Blocking the UI. </span><span class="koboSpan" id="kobo.1011.3">Next, we solved this issue by introducing a Transition Hook to change the state in a non-blocking way, allowing the UI to remain responsive while the computationally expensive components are rendering. </span><span class="koboSpan" id="kobo.1011.4">Finally, we learned about implementing optimistic updates to show results immediately while waiting for an asynchronous operation to finish.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1012.1">In the next chapter, we are going to learn how to use Hooks to implement client-side routing in our blog application.</span></p>
<h1 class="heading-1" id="_idParaDest-179"><a id="_idTextAnchor186"/><span class="koboSpan" id="kobo.1013.1">Questions</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1014.1">To recap what we have learned in this chapter, try to answer the following questions:</span></p>
<ol>
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1015.1">Which feature can we use to handle form submission in React 19?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1016.1">Which web standard is used for handling form data in React 19?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1017.1">Which Hook is used to handle different form states?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1018.1">What is a potential problem that can happen when rendering computationally expensive components?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1019.1">How do we avoid that problem?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1020.1">What are limitations of Transitions?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1021.1">Which Hook can we use to display state on the client before it finished persisting to the server?</span></li>
</ol>
<h1 class="heading-1" id="_idParaDest-180"><a id="_idTextAnchor187"/><span class="koboSpan" id="kobo.1022.1">Further reading</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1023.1">If you are interested in more information about the concepts that we have learned in this chapter, take a look at the following links:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1024.1">FormData</span></code><span class="koboSpan" id="kobo.1025.1"> API: </span><a href="https://developer.mozilla.org/en-US/docs/Web/API/FormData"><span class="url"><span class="koboSpan" id="kobo.1026.1">https://developer.mozilla.org/en-US/docs/Web/API/FormData</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1027.1">Form submission with React: </span><a href="https://react.dev/reference/react-dom/components/form"><span class="url"><span class="koboSpan" id="kobo.1028.1">https://react.dev/reference/react-dom/components/form</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1029.1">The Action State Hook: </span><a href="https://react.dev/reference/react/useActionState"><span class="url"><span class="koboSpan" id="kobo.1030.1">https://react.dev/reference/react/useActionState</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1031.1">The Transition Hook: </span><a href="https://react.dev/reference/react/useTransition"><span class="url"><span class="koboSpan" id="kobo.1032.1">https://react.dev/reference/react/useTransition</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1033.1">The Optimistic Hook: </span><a href="https://react.dev/reference/react/useOptimistic"><span class="url"><span class="koboSpan" id="kobo.1034.1">https://react.dev/reference/react/useOptimistic</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1035.1">More information on optimistic updates: </span><a href="https://dev.to/_jhohannes/why-your-applications-need-optimistic-updates-3h62"><span class="url"><span class="koboSpan" id="kobo.1036.1">https://dev.to/_jhohannes/why-your-applications-need-optimistic-updates-3h62</span></span></a></li>
</ul>
<h1 class="heading-1"><span class="koboSpan" id="kobo.1037.1">Learn more on Discord</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1038.1">To join the Discord community for this book – where you can share feedback, ask questions to the author, and learn about new releases – follow the QR code below:</span></p>
<p class="normal"><a href="Chapter_07.xhtml"><span class="url"><span class="koboSpan" id="kobo.1039.1">https://packt.link/wnXT0</span></span></a></p>
<p class="normal"><span class="koboSpan" id="kobo.1040.1"><img alt="" src="../Images/image_%283%29.png"/></span></p>
</div>
</body></html>