<html><head></head><body>
<div id="_idContainer200">
<h1 class="chapterNumber"><a id="_idTextAnchor282"/><span class="koboSpan" id="kobo.1.1">12</span></h1>
<h1 class="chapterTitle" id="_idParaDest-250"><a id="_idTextAnchor283"/><span class="koboSpan" id="kobo.2.1">Building Your Own Hooks</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.3.1">In the previous chapter, we learned about the limitations and rules of Hooks. </span><span class="koboSpan" id="kobo.3.2">We also learned where to call Hooks, why the order matters, and naming conventions for Hooks.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.4.1">In this chapter, we are going to learn how to create custom Hooks by extracting existing code from our components. </span><span class="koboSpan" id="kobo.4.2">We are also going to learn how to use custom Hooks and how Hooks can interact with each other. </span><span class="koboSpan" id="kobo.4.3">Finally, we are going to learn how to write tests for our custom Hooks.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.5.1">At the end of this chapter, you will be able to create custom Hooks to encapsulate and re-use application logic, keeping your code clean and maintainable.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.6.1">The following topics will be covered in this chapter:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.7.1">Creating a custom Theme Hook</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.8.1">Creating a custom User Hook</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.9.1">Creating custom API Hooks</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.10.1">Creating a Debounced History State Hook</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.11.1">Testing custom Hooks</span></li>
</ul>
<h1 class="heading-1" id="_idParaDest-251"><a id="_idTextAnchor284"/><span class="koboSpan" id="kobo.12.1">Technical requirements</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.13.1">A fairly recent version of Node.js should already be installed. </span><span class="koboSpan" id="kobo.13.2">The Node Package Manager (</span><code class="inlineCode"><span class="koboSpan" id="kobo.14.1">npm</span></code><span class="koboSpan" id="kobo.15.1">) also needs to be installed (it should come with Node.js). </span><span class="koboSpan" id="kobo.15.2">For more information on how to install Node.js, please check out their official website: </span><a href="https://nodejs.org/"><span class="url"><span class="koboSpan" id="kobo.16.1">https://nodejs.org/</span></span></a><span class="koboSpan" id="kobo.17.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.18.1">We are going to use </span><strong class="keyWord"><span class="koboSpan" id="kobo.19.1">Visual Studio Code</span></strong><span class="koboSpan" id="kobo.20.1"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.21.1">VS Code</span></strong><span class="koboSpan" id="kobo.22.1">) for the guides in this book, but everything should work similarly in any other editor. </span><span class="koboSpan" id="kobo.22.2">For more information on how to install VS Code, please refer to their official website: </span><a href="https://code.visualstudio.com"><span class="url"><span class="koboSpan" id="kobo.23.1">https://code.visualstudio.com</span></span></a></p>
<p class="normal"><span class="koboSpan" id="kobo.24.1">In this book, we use the following versions:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.25.1">Node.js v22.14.0</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.26.1">npm</span></code><span class="koboSpan" id="kobo.27.1"> v10.9.2</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.28.1">Visual Studio Code v1.97.2</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.29.1">The versions mentioned in the preceding list are the ones used in the book. </span><span class="koboSpan" id="kobo.29.2">While installing a newer version should not be an issue, please note that certain steps might work differently on a newer version. </span><span class="koboSpan" id="kobo.29.3">If you are having an issue with the code and steps provided in this book, please try using the mentioned versions.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.30.1">You can find the code for this chapter on GitHub: </span><a href="https://github.com/PacktPublishing/Learn-React-Hooks-Second-Edition/tree/main/Chapter12"><span class="url"><span class="koboSpan" id="kobo.31.1">https://github.com/PacktPublishing/Learn-React-Hooks-Second-Edition/tree/main/Chapter12</span></span></a></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.32.1">It is highly recommended that you write the code on your own. </span><span class="koboSpan" id="kobo.32.2">Do not simply run the code examples that are provided in the book. </span><span class="koboSpan" id="kobo.32.3">It is important to write the code yourself to be able to learn and understand it properly. </span><span class="koboSpan" id="kobo.32.4">However, if you run into any issues, you can always refer to the code example.</span></p>
</div>
<h1 class="heading-1" id="_idParaDest-252"><a id="_idTextAnchor285"/><span class="koboSpan" id="kobo.33.1">Creating a custom Theme Hook</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.34.1">After getting a </span><a id="_idIndexMarker565"/><span class="koboSpan" id="kobo.35.1">good grasp on the concept of Hooks by learning about the built-in React Hooks, community Hooks, as well as the rules of Hooks, we are now going to build our own Hooks.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.36.1">In </span><a href="Chapter_05.xhtml#_idTextAnchor127"><em class="italic"><span class="koboSpan" id="kobo.37.1">Chapter 5</span></em></a><em class="italic"><span class="koboSpan" id="kobo.38.1">, Implementing React Contexts</span></em><span class="koboSpan" id="kobo.39.1">, we introduced a </span><code class="inlineCode"><span class="koboSpan" id="kobo.40.1">ThemeContext</span></code><span class="koboSpan" id="kobo.41.1"> to style blog posts in our app. </span><span class="koboSpan" id="kobo.41.2">We used a Context Hook to access the </span><code class="inlineCode"><span class="koboSpan" id="kobo.42.1">ThemeContext</span></code><span class="koboSpan" id="kobo.43.1"> in many components. </span><span class="koboSpan" id="kobo.43.2">Functionality that is used across multiple components is usually a good opportunity for a custom Hook. </span><span class="koboSpan" id="kobo.43.3">As you might have noticed, we often do the following:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.44.1">import</span></span><span class="koboSpan" id="kobo.45.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.46.1">ThemeContext</span></span><span class="koboSpan" id="kobo.47.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.48.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.49.1">'@/contexts/ThemeContext.js'</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.50.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.51.1">default</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.52.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.53.1">SomeComponent</span></span><span class="koboSpan" id="kobo.54.1"> () {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.55.1">const</span></span><span class="koboSpan" id="kobo.56.1"> theme = </span><span class="hljs-title"><span class="koboSpan" id="kobo.57.1">useContext</span></span><span class="koboSpan" id="kobo.58.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.59.1">ThemeContext</span></span><span class="koboSpan" id="kobo.60.1">)
  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.61.1">// …</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.62.1">We could abstract this functionality </span><a id="_idIndexMarker566"/><span class="koboSpan" id="kobo.63.1">into a </span><code class="inlineCode"><span class="koboSpan" id="kobo.64.1">useTheme</span></code><span class="koboSpan" id="kobo.65.1"> Hook, which will get the </span><code class="inlineCode"><span class="koboSpan" id="kobo.66.1">theme</span></code><span class="koboSpan" id="kobo.67.1"> object from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.68.1">ThemeContext</span></code><span class="koboSpan" id="kobo.69.1">.</span></p>
<div class="packt_tip">
<p class="normal"><span class="koboSpan" id="kobo.70.1">Usually, it makes the most sense to first write the component, and then later extract a custom Hook from it if we notice that we use similar code across multiple components. </span><span class="koboSpan" id="kobo.70.2">Doing so avoids prematurely creating custom Hooks and making our project unnecessarily complex.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.71.1">Now, let’s get started creating the custom Theme Hook.</span></p>
<h2 class="heading-2" id="_idParaDest-253"><a id="_idTextAnchor286"/><span class="koboSpan" id="kobo.72.1">Creating the custom Theme Hook</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.73.1">Let’s get started</span><a id="_idIndexMarker567"/><span class="koboSpan" id="kobo.74.1"> creating a custom Theme Hook now, by extracting the existing code for the Context Hook into a separate function:</span></p>
<ol>
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.75.1">Copy the </span><code class="inlineCode"><span class="koboSpan" id="kobo.76.1">Chapter10_3</span></code><span class="koboSpan" id="kobo.77.1"> folder to a new </span><code class="inlineCode"><span class="koboSpan" id="kobo.78.1">Chapter12_1</span></code><span class="koboSpan" id="kobo.79.1"> folder by executing the following command:
        </span><pre class="programlisting con-one"><code class="hljs-con"><span class="koboSpan" id="kobo.80.1">$ cp -R Chapter10_3 Chapter12_1
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.81.1">Open the new </span><code class="inlineCode"><span class="koboSpan" id="kobo.82.1">Chapter12_1</span></code><span class="koboSpan" id="kobo.83.1"> folder in VS Code.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.84.1">Create a new </span><code class="inlineCode"><span class="koboSpan" id="kobo.85.1">src/hooks/</span></code><span class="koboSpan" id="kobo.86.1"> folder.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.87.1">Inside it, create a new </span><code class="inlineCode"><span class="koboSpan" id="kobo.88.1">src/hooks/theme.js</span></code><span class="koboSpan" id="kobo.89.1"> file.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.90.1">In this newly created file, import the </span><code class="inlineCode"><span class="koboSpan" id="kobo.91.1">useContext</span></code><span class="koboSpan" id="kobo.92.1"> function and the </span><code class="inlineCode"><span class="koboSpan" id="kobo.93.1">ThemeContext</span></code><span class="koboSpan" id="kobo.94.1">:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.95.1">import</span></span><span class="koboSpan" id="kobo.96.1"> { useContext } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.97.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.98.1">'react'</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.99.1">import</span></span><span class="koboSpan" id="kobo.100.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.101.1">ThemeContext</span></span><span class="koboSpan" id="kobo.102.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.103.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.104.1">'@/contexts/ThemeContext.js'</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.105.1">Now, define and export a </span><code class="inlineCode"><span class="koboSpan" id="kobo.106.1">useTheme</span></code><span class="koboSpan" id="kobo.107.1"> function, which simply returns the Context Hook:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.108.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.109.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.110.1">useTheme</span></span><span class="koboSpan" id="kobo.111.1">() {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.112.1">return</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.113.1">useContext</span></span><span class="koboSpan" id="kobo.114.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.115.1">ThemeContext</span></span><span class="koboSpan" id="kobo.116.1">)
}
</span></code></pre>
</li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.117.1">It’s as simple as that, as long as we</span><a id="_idIndexMarker568"/><span class="koboSpan" id="kobo.118.1"> stick to the rules and naming conventions of Hooks, we can easily create our own custom Hooks! </span><span class="koboSpan" id="kobo.118.2">Let’s continue by using our custom Theme Hook throughout the blog app.</span></p>
<h2 class="heading-2" id="_idParaDest-254"><a id="_idTextAnchor287"/><span class="koboSpan" id="kobo.119.1">Using the custom Theme Hook</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.120.1">To get started using our </span><a id="_idIndexMarker569"/><span class="koboSpan" id="kobo.121.1">custom Theme Hook:</span></p>
<ol>
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.122.1">Edit </span><code class="inlineCode"><span class="koboSpan" id="kobo.123.1">src/components/post/Post.jsx</span></code><span class="koboSpan" id="kobo.124.1"> and </span><em class="italic"><span class="koboSpan" id="kobo.125.1">remove</span></em><span class="koboSpan" id="kobo.126.1"> the following imports:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.127.1">import</span></span><span class="koboSpan" id="kobo.128.1"> { useContext } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.129.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.130.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.131.1">react'</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.132.1">import</span></span><span class="koboSpan" id="kobo.133.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.134.1">ThemeContext</span></span><span class="koboSpan" id="kobo.135.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.136.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.137.1">'@/contexts/ThemeContext.js'</span></span>
</code></pre>
</li>
</ol>
<p class="normal-one"><em class="italic"><span class="koboSpan" id="kobo.138.1">Replace</span></em><span class="koboSpan" id="kobo.139.1"> them with an import of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.140.1">useTheme</span></code><span class="koboSpan" id="kobo.141.1"> function:</span></p>
<pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.142.1">import</span></span><span class="koboSpan" id="kobo.143.1"> { useTheme } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.144.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.145.1">'@/hooks/theme.js'</span></span>
</code></pre>
<ol>
<li class="numberedList" value="2"><em class="italic"><span class="koboSpan" id="kobo.146.1">Replace</span></em><span class="koboSpan" id="kobo.147.1"> the existing Context Hook with our custom Theme Hook:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.148.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.149.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.150.1">Post</span></span><span class="koboSpan" id="kobo.151.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.152.1">{ id }</span></span><span class="koboSpan" id="kobo.153.1">) {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.154.1">const</span></span><span class="koboSpan" id="kobo.155.1"> theme = </span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.156.1">useTheme</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.157.1">()</span></strong></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.158.1">Edit </span><code class="inlineCode"><span class="koboSpan" id="kobo.159.1">src/components/post/PostListItem.jsx</span></code><span class="koboSpan" id="kobo.160.1"> and </span><em class="italic"><span class="koboSpan" id="kobo.161.1">remove</span></em><span class="koboSpan" id="kobo.162.1"> the following imports:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.163.1">import</span></span><span class="koboSpan" id="kobo.164.1"> { useContext } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.165.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.166.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.167.1">react'</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.168.1">import</span></span><span class="koboSpan" id="kobo.169.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.170.1">ThemeContext</span></span><span class="koboSpan" id="kobo.171.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.172.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.173.1">'@/contexts/ThemeContext.js'</span></span>
</code></pre>
</li>
</ol>
<p class="normal-one"><em class="italic"><span class="koboSpan" id="kobo.174.1">Replace</span></em><span class="koboSpan" id="kobo.175.1"> them with an import of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.176.1">useTheme</span></code><span class="koboSpan" id="kobo.177.1"> function:</span></p>
<pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.178.1">import</span></span><span class="koboSpan" id="kobo.179.1"> { useTheme } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.180.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.181.1">'@/hooks/theme.js'</span></span>
</code></pre>
<ol>
<li class="numberedList" value="4"><span class="koboSpan" id="kobo.182.1">Replace the Context Hook with our Theme Hook:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.183.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.184.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.185.1">PostListItem</span></span><span class="koboSpan" id="kobo.186.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.187.1">{ id, title, author }</span></span><span class="koboSpan" id="kobo.188.1">) {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.189.1">const</span></span><span class="koboSpan" id="kobo.190.1"> theme = </span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.191.1">useTheme</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.192.1">()</span></strong></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.193.1">Run the </span><code class="inlineCode"><span class="koboSpan" id="kobo.194.1">dev</span></code><span class="koboSpan" id="kobo.195.1"> server, as follows:
        </span><pre class="programlisting con-one"><code class="hljs-con"><span class="koboSpan" id="kobo.196.1">$ npm run dev
</span></code></pre>
</li>
</ol>
<p class="normal-one"><span class="koboSpan" id="kobo.197.1">You will see that the theme still works the same way as before, showing featured posts in a different color.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.198.1">As we can see, replacing the Context Hooks with our Theme Hook simplifies the code a bit (requiring less imports) and</span><a id="_idIndexMarker570"/><span class="koboSpan" id="kobo.199.1"> allows us to easily adjust the theming system later. </span><span class="koboSpan" id="kobo.199.2">For example, if we wanted to fetch the default theme from a user setting instead of getting it from the context, we could implement this functionality in the Theme Hook and all components would automatically use this new theme system.</span></p>
<div class="note">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.200.1">Example code</span></strong></p>
<p class="normal"><span class="koboSpan" id="kobo.201.1">The example code for this section can be found in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.202.1">Chapter12/Chapter12_1</span></code><span class="koboSpan" id="kobo.203.1"> folder. </span><span class="koboSpan" id="kobo.203.2">Check the </span><code class="inlineCode"><span class="koboSpan" id="kobo.204.1">README.md</span></code><span class="koboSpan" id="kobo.205.1"> file inside the folder for instructions on how to set up and run the example.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.206.1">Now that we have successfully created a custom Theme Hook, let’s move on to creating a custom User Hook.</span></p>
<h1 class="heading-1" id="_idParaDest-255"><a id="_idTextAnchor288"/><span class="koboSpan" id="kobo.207.1">Creating a custom User Hook</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.208.1">In </span><a href="Chapter_05.xhtml#_idTextAnchor127"><em class="italic"><span class="koboSpan" id="kobo.209.1">Chapter 5</span></em></a><span class="koboSpan" id="kobo.210.1">, </span><em class="italic"><span class="koboSpan" id="kobo.211.1">Implementing React Contexts</span></em><span class="koboSpan" id="kobo.212.1">, we</span><a id="_idIndexMarker571"/><span class="koboSpan" id="kobo.213.1"> defined a </span><code class="inlineCode"><span class="koboSpan" id="kobo.214.1">UserContext</span></code><span class="koboSpan" id="kobo.215.1"> to store the username of the currently logged in user. </span><span class="koboSpan" id="kobo.215.2">In </span><a href="Chapter_10.xhtml#_idTextAnchor250"><em class="italic"><span class="koboSpan" id="kobo.216.1">Chapter 10</span></em></a><span class="koboSpan" id="kobo.217.1">, </span><em class="italic"><span class="koboSpan" id="kobo.218.1">Using Community Hooks</span></em><span class="koboSpan" id="kobo.219.1">, we replaced the </span><code class="inlineCode"><span class="koboSpan" id="kobo.220.1">UserContext</span></code><span class="koboSpan" id="kobo.221.1"> with a Local Storage Hook. </span><span class="koboSpan" id="kobo.221.2">As you may remember, refactoring from the Context Hook to a Local Storage Hook required us to adjust the code in many components.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.222.1">To avoid such issues in the future, we can put all user related information and functions into a User Hook, which then exposes them to be used by other components.</span></p>
<h2 class="heading-2" id="_idParaDest-256"><a id="_idTextAnchor289"/><span class="koboSpan" id="kobo.223.1">Creating the custom User Hook</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.224.1">Let’s start by </span><a id="_idIndexMarker572"/><span class="koboSpan" id="kobo.225.1">extracting all of our existing code related to dealing with the username into a custom User Hook:</span></p>
<ol>
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.226.1">Copy the </span><code class="inlineCode"><span class="koboSpan" id="kobo.227.1">Chapter12_1</span></code><span class="koboSpan" id="kobo.228.1"> folder to a new </span><code class="inlineCode"><span class="koboSpan" id="kobo.229.1">Chapter12_2</span></code><span class="koboSpan" id="kobo.230.1"> folder by executing the following command:
        </span><pre class="programlisting con-one"><code class="hljs-con"><span class="koboSpan" id="kobo.231.1">$ cp -R Chapter12_1 Chapter12_2
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.232.1">Open the new </span><code class="inlineCode"><span class="koboSpan" id="kobo.233.1">Chapter12_2</span></code><span class="koboSpan" id="kobo.234.1"> folder in VS Code.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.235.1">Create a new </span><code class="inlineCode"><span class="koboSpan" id="kobo.236.1">src/hooks/user.js</span></code><span class="koboSpan" id="kobo.237.1"> file.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.238.1">Inside it, import the </span><code class="inlineCode"><span class="koboSpan" id="kobo.239.1">useLocalStorage</span></code><span class="koboSpan" id="kobo.240.1"> function:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.241.1">import</span></span><span class="koboSpan" id="kobo.242.1"> { useLocalStorage } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.243.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.244.1">'@uidotdev/usehooks'</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.245.1">Define a new </span><code class="inlineCode"><span class="koboSpan" id="kobo.246.1">useUser</span></code><span class="koboSpan" id="kobo.247.1"> function, in which we use the Local Storage Hook:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.248.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.249.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.250.1">useUser</span></span><span class="koboSpan" id="kobo.251.1">() {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.252.1">const</span></span><span class="koboSpan" id="kobo.253.1"> [username, setUsername] = </span><span class="hljs-title"><span class="koboSpan" id="kobo.254.1">useLocalStorage</span></span><span class="koboSpan" id="kobo.255.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.256.1">'username'</span></span><span class="koboSpan" id="kobo.257.1">, </span><span class="hljs-literal"><span class="koboSpan" id="kobo.258.1">null</span></span><span class="koboSpan" id="kobo.259.1">)
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.260.1">Additionally, we define a flag to tell whether the user is logged in:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.261.1">const</span></span><span class="koboSpan" id="kobo.262.1"> isLoggedIn = username !== </span><span class="hljs-literal"><span class="koboSpan" id="kobo.263.1">null</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.264.1">Now, define the </span><code class="inlineCode"><span class="koboSpan" id="kobo.265.1">register</span></code><span class="koboSpan" id="kobo.266.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.267.1">login</span></code><span class="koboSpan" id="kobo.268.1">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.269.1">logout</span></code><span class="koboSpan" id="kobo.270.1"> functions:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.271.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.272.1">register</span></span><span class="koboSpan" id="kobo.273.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.274.1">username</span></span><span class="koboSpan" id="kobo.275.1">) {
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.276.1">setUsername</span></span><span class="koboSpan" id="kobo.277.1">(username)
  }
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.278.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.279.1">login</span></span><span class="koboSpan" id="kobo.280.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.281.1">username</span></span><span class="koboSpan" id="kobo.282.1">) {
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.283.1">setUsername</span></span><span class="koboSpan" id="kobo.284.1">(username)
  }
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.285.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.286.1">logout</span></span><span class="koboSpan" id="kobo.287.1">() {
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.288.1">setUsername</span></span><span class="koboSpan" id="kobo.289.1">(</span><span class="hljs-literal"><span class="koboSpan" id="kobo.290.1">null</span></span><span class="koboSpan" id="kobo.291.1">)
  }
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.292.1">Return the </span><code class="inlineCode"><span class="koboSpan" id="kobo.293.1">username</span></code><span class="koboSpan" id="kobo.294.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.295.1">isLoggedIn</span></code><span class="koboSpan" id="kobo.296.1"> flag, and the functions:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.297.1">return</span></span><span class="koboSpan" id="kobo.298.1"> { username, isLoggedIn, register, login, logout }
}
</span></code></pre>
</li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.299.1">As you can see, we are not just returning the username and a function to set the username, but instead returning an object</span><a id="_idIndexMarker573"/><span class="koboSpan" id="kobo.300.1"> with various information about the user session, as well as functions that we can call to adjust the user state. </span><span class="koboSpan" id="kobo.300.2">Now that we have abstracted this functionality into a User Hook, we can easily extend it later to support full authentication (instead of just storing the username).</span></p>
<p class="normal"><span class="koboSpan" id="kobo.301.1">With our User Hook successfully created, let’s use it in our app.</span></p>
<h2 class="heading-2" id="_idParaDest-257"><a id="_idTextAnchor290"/><span class="koboSpan" id="kobo.302.1">Using the custom User Hook</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.303.1">Let’s now refactor </span><a id="_idIndexMarker574"/><span class="koboSpan" id="kobo.304.1">our blog app to use the User Hook instead of directly reading from and writing to the Local Storage Hook:</span></p>
<ol>
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.305.1">Edit </span><code class="inlineCode"><span class="koboSpan" id="kobo.306.1">src/App.jsx</span></code><span class="koboSpan" id="kobo.307.1"> and </span><em class="italic"><span class="koboSpan" id="kobo.308.1">remove</span></em><span class="koboSpan" id="kobo.309.1"> the following import:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.310.1">import</span></span><span class="koboSpan" id="kobo.311.1"> { useLocalStorage } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.312.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.313.1">'@uidotdev/usehooks'</span></span>
</code></pre>
</li>
</ol>
<p class="normal-one"><em class="italic"><span class="koboSpan" id="kobo.314.1">Replace</span></em><span class="koboSpan" id="kobo.315.1"> it with an import to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.316.1">useUser</span></code><span class="koboSpan" id="kobo.317.1"> function:</span></p>
<pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.318.1">import</span></span><span class="koboSpan" id="kobo.319.1"> { useUser } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.320.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.321.1">'./hooks/user.js'</span></span>
</code></pre>
<ol>
<li class="numberedList" value="2"><em class="italic"><span class="koboSpan" id="kobo.322.1">Replace</span></em><span class="koboSpan" id="kobo.323.1"> the Local Storage Hook with our custom User Hook, as follows:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.324.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.325.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.326.1">App</span></span><span class="koboSpan" id="kobo.327.1">() {
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.328.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.329.1"> { isLoggedIn } = </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.330.1">useUser</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.331.1">()</span></strong></span>
</code></pre>
</li>
<li class="numberedList"><em class="italic"><span class="koboSpan" id="kobo.332.1">Replace</span></em><span class="koboSpan" id="kobo.333.1"> the </span><code class="inlineCode"><span class="koboSpan" id="kobo.334.1">username</span></code><span class="koboSpan" id="kobo.335.1"> check with a check for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.336.1">isLoggedIn</span></code><span class="koboSpan" id="kobo.337.1"> flag:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="koboSpan" id="kobo.338.1">            {</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.339.1">isLoggedIn</span></strong></span><span class="koboSpan" id="kobo.340.1"> &amp;&amp; </span><span class="hljs-tag"><span class="koboSpan" id="kobo.341.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.342.1">CreatePost</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.343.1"> /&gt;</span></span><span class="koboSpan" id="kobo.344.1">}
</span></code></pre>
</li>
</ol>
<p class="normal-one"><span class="koboSpan" id="kobo.345.1">Using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.346.1">isLoggedIn</span></code><span class="koboSpan" id="kobo.347.1"> flag from the Hook makes the code easier to read – before it may have been unclear why we are checking for the username, but now it’s clear that we only want to render this component when the user is logged in. </span><span class="koboSpan" id="kobo.347.2">Doing the check like this has the additional benefit that</span><a id="_idIndexMarker575"/><span class="koboSpan" id="kobo.348.1"> we can change the logic for checking if the user is logged in later by adjusting the User Hook.</span></p>
<ol>
<li class="numberedList" value="4"><span class="koboSpan" id="kobo.349.1">Now edit </span><code class="inlineCode"><span class="koboSpan" id="kobo.350.1">src/components/user/UserBar.jsx</span></code><span class="koboSpan" id="kobo.351.1"> and </span><em class="italic"><span class="koboSpan" id="kobo.352.1">remove</span></em><span class="koboSpan" id="kobo.353.1"> the following import:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.354.1">import</span></span><span class="koboSpan" id="kobo.355.1"> { useLocalStorage } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.356.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.357.1">'@uidotdev/usehooks'</span></span>
</code></pre>
</li>
</ol>
<p class="normal-one"><em class="italic"><span class="koboSpan" id="kobo.358.1">Replace</span></em><span class="koboSpan" id="kobo.359.1"> it with an import to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.360.1">useUser</span></code><span class="koboSpan" id="kobo.361.1"> function:</span></p>
<pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.362.1">import</span></span><span class="koboSpan" id="kobo.363.1"> { useUser } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.364.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.365.1">'@/hooks/user.js'</span></span>
</code></pre>
<ol>
<li class="numberedList" value="5"><em class="italic"><span class="koboSpan" id="kobo.366.1">Replace</span></em><span class="koboSpan" id="kobo.367.1"> the Local Storage Hook with our custom User Hook, as follows:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.368.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.369.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.370.1">UserBar</span></span><span class="koboSpan" id="kobo.371.1">() {
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.372.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.373.1"> { isLoggedIn } = </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.374.1">useUser</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.375.1">()</span></strong></span>
</code></pre>
</li>
<li class="numberedList"><em class="italic"><span class="koboSpan" id="kobo.376.1">Replace</span></em><span class="koboSpan" id="kobo.377.1"> the </span><code class="inlineCode"><span class="koboSpan" id="kobo.378.1">username</span></code><span class="koboSpan" id="kobo.379.1"> check with a check for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.380.1">isLoggedIn</span></code><span class="koboSpan" id="kobo.381.1"> flag:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.382.1">if</span></span><span class="koboSpan" id="kobo.383.1"> (</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.384.1">isLoggedIn</span></strong></span><span class="koboSpan" id="kobo.385.1">) {
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.386.1">Next edit </span><code class="inlineCode"><span class="koboSpan" id="kobo.387.1">src/components/user/Register.jsx</span></code><span class="koboSpan" id="kobo.388.1"> and </span><em class="italic"><span class="koboSpan" id="kobo.389.1">remove</span></em><span class="koboSpan" id="kobo.390.1"> the following import:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.391.1">import</span></span><span class="koboSpan" id="kobo.392.1"> { useLocalStorage } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.393.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.394.1">'@uidotdev/usehooks'</span></span>
</code></pre>
</li>
</ol>
<p class="normal-one"><em class="italic"><span class="koboSpan" id="kobo.395.1">Replace</span></em><span class="koboSpan" id="kobo.396.1"> it with an import to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.397.1">useUser</span></code><span class="koboSpan" id="kobo.398.1"> function:</span></p>
<pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.399.1">import</span></span><span class="koboSpan" id="kobo.400.1"> { useUser } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.401.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.402.1">'@/hooks/user.js'</span></span>
</code></pre>
<ol>
<li class="numberedList" value="8"><em class="italic"><span class="koboSpan" id="kobo.403.1">Replace</span></em><span class="koboSpan" id="kobo.404.1"> the Local Storage Hook with our custom User Hook, as follows:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.405.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.406.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.407.1">Register</span></span><span class="koboSpan" id="kobo.408.1">() {
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.409.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.410.1"> { register } = </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.411.1">useUser</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.412.1">()</span></strong></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.413.1">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.414.1">handleSubmit</span></code><span class="koboSpan" id="kobo.415.1"> function, </span><em class="italic"><span class="koboSpan" id="kobo.416.1">replace</span></em><span class="koboSpan" id="kobo.417.1"> the </span><code class="inlineCode"><span class="koboSpan" id="kobo.418.1">setUsername</span></code><span class="koboSpan" id="kobo.419.1"> function with our new </span><code class="inlineCode"><span class="koboSpan" id="kobo.420.1">register</span></code><span class="koboSpan" id="kobo.421.1"> function:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.422.1">const</span></span><span class="koboSpan" id="kobo.423.1"> username = e.</span><span class="hljs-property"><span class="koboSpan" id="kobo.424.1">target</span></span><span class="koboSpan" id="kobo.425.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.426.1">elements</span></span><span class="koboSpan" id="kobo.427.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.428.1">username</span></span><span class="koboSpan" id="kobo.429.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.430.1">value</span></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.431.1">register</span></strong></span><span class="koboSpan" id="kobo.432.1">(username)
  }
</span></code></pre>
</li>
</ol>
<p class="normal-one"><span class="koboSpan" id="kobo.433.1">Again, we are making our code</span><a id="_idIndexMarker576"/><span class="koboSpan" id="kobo.434.1"> easier to read by calling a function that explains what we actually want to do (register a new user). </span><span class="koboSpan" id="kobo.434.2">Before, we were just calling </span><code class="inlineCode"><span class="koboSpan" id="kobo.435.1">setUsername</span></code><span class="koboSpan" id="kobo.436.1"> here. </span><span class="koboSpan" id="kobo.436.2">Later, we may want to actually connect this to a database, so having the </span><code class="inlineCode"><span class="koboSpan" id="kobo.437.1">register</span></code><span class="koboSpan" id="kobo.438.1"> function in the User Hook will make it easier for us to add this functionality later.</span></p>
<ol>
<li class="numberedList" value="10"><span class="koboSpan" id="kobo.439.1">Edit </span><code class="inlineCode"><span class="koboSpan" id="kobo.440.1">src/components/user/Login.jsx</span></code><span class="koboSpan" id="kobo.441.1"> and </span><em class="italic"><span class="koboSpan" id="kobo.442.1">remove</span></em><span class="koboSpan" id="kobo.443.1"> the following import:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.444.1">import</span></span><span class="koboSpan" id="kobo.445.1"> { useLocalStorage } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.446.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.447.1">'@uidotdev/usehooks'</span></span>
</code></pre>
</li>
</ol>
<p class="normal-one"><em class="italic"><span class="koboSpan" id="kobo.448.1">Replace</span></em><span class="koboSpan" id="kobo.449.1"> it with an import to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.450.1">useUser</span></code><span class="koboSpan" id="kobo.451.1"> function:</span></p>
<pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.452.1">import</span></span><span class="koboSpan" id="kobo.453.1"> { useUser } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.454.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.455.1">'@/hooks/user.js'</span></span>
</code></pre>
<ol>
<li class="numberedList" value="11"><em class="italic"><span class="koboSpan" id="kobo.456.1">Replace</span></em><span class="koboSpan" id="kobo.457.1"> the Local Storage Hook with our custom User Hook, as follows:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.458.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.459.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.460.1">Login</span></span><span class="koboSpan" id="kobo.461.1">() {
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.462.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.463.1"> { login } = </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.464.1">useUser</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.465.1">()</span></strong></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.466.1">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.467.1">handleSubmit</span></code><span class="koboSpan" id="kobo.468.1"> function, </span><em class="italic"><span class="koboSpan" id="kobo.469.1">replace</span></em><span class="koboSpan" id="kobo.470.1"> the </span><code class="inlineCode"><span class="koboSpan" id="kobo.471.1">setUsername</span></code><span class="koboSpan" id="kobo.472.1"> function with our new </span><code class="inlineCode"><span class="koboSpan" id="kobo.473.1">login</span></code><span class="koboSpan" id="kobo.474.1"> function:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.475.1">const</span></span><span class="koboSpan" id="kobo.476.1"> username = e.</span><span class="hljs-property"><span class="koboSpan" id="kobo.477.1">target</span></span><span class="koboSpan" id="kobo.478.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.479.1">elements</span></span><span class="koboSpan" id="kobo.480.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.481.1">username</span></span><span class="koboSpan" id="kobo.482.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.483.1">value</span></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.484.1">login</span></strong></span><span class="koboSpan" id="kobo.485.1">(username)
  }
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.486.1">Edit </span><code class="inlineCode"><span class="koboSpan" id="kobo.487.1">src/components/user/Logout.jsx</span></code><span class="koboSpan" id="kobo.488.1"> and </span><em class="italic"><span class="koboSpan" id="kobo.489.1">remove</span></em><span class="koboSpan" id="kobo.490.1"> the following import:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.491.1">import</span></span><span class="koboSpan" id="kobo.492.1"> { useLocalStorage } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.493.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.494.1">'@uidotdev/usehooks'</span></span>
</code></pre>
</li>
</ol>
<p class="normal-one"><em class="italic"><span class="koboSpan" id="kobo.495.1">Replace</span></em><span class="koboSpan" id="kobo.496.1"> it with an </span><a id="_idIndexMarker577"/><span class="koboSpan" id="kobo.497.1">import to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.498.1">useUser</span></code><span class="koboSpan" id="kobo.499.1"> function:</span></p>
<pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.500.1">import</span></span><span class="koboSpan" id="kobo.501.1"> { useUser } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.502.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.503.1">'@/hooks/user.js'</span></span>
</code></pre>
<ol>
<li class="numberedList" value="14"><em class="italic"><span class="koboSpan" id="kobo.504.1">Replace</span></em><span class="koboSpan" id="kobo.505.1"> the Local Storage Hook with our custom User Hook, as follows:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.506.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.507.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.508.1">Logout</span></span><span class="koboSpan" id="kobo.509.1">() {
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.510.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.511.1"> { username, logout } = </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.512.1">useUser</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.513.1">()</span></strong></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.514.1">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.515.1">handleSubmit</span></code><span class="koboSpan" id="kobo.516.1"> function, </span><em class="italic"><span class="koboSpan" id="kobo.517.1">replace</span></em><span class="koboSpan" id="kobo.518.1"> the </span><code class="inlineCode"><span class="koboSpan" id="kobo.519.1">setUsername</span></code><span class="koboSpan" id="kobo.520.1"> function with our new </span><code class="inlineCode"><span class="koboSpan" id="kobo.521.1">logout</span></code><span class="koboSpan" id="kobo.522.1"> function:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.523.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.524.1">handleSubmit</span></span><span class="koboSpan" id="kobo.525.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.526.1">e</span></span><span class="koboSpan" id="kobo.527.1">) {
    e.</span><span class="hljs-title"><span class="koboSpan" id="kobo.528.1">preventDefault</span></span><span class="koboSpan" id="kobo.529.1">()
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.530.1">logout</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.531.1">()</span></strong></span><span class="koboSpan" id="kobo.532.1">
  }
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.533.1">Edit </span><code class="inlineCode"><span class="koboSpan" id="kobo.534.1">src/components/post/CreatePost.jsx</span></code><span class="koboSpan" id="kobo.535.1"> and </span><em class="italic"><span class="koboSpan" id="kobo.536.1">remove</span></em><span class="koboSpan" id="kobo.537.1"> the following import of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.538.1">useLocalStorage</span></code><span class="koboSpan" id="kobo.539.1"> function:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.540.1">import</span></span><span class="koboSpan" id="kobo.541.1"> { </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.542.1">useLocalStorage,</span></strong></span><span class="koboSpan" id="kobo.543.1"> useHistoryState } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.544.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.545.1">'@uidotdev/usehooks'</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.546.1">Add an import to </span><a id="_idIndexMarker578"/><span class="koboSpan" id="kobo.547.1">the </span><code class="inlineCode"><span class="koboSpan" id="kobo.548.1">useUser</span></code><span class="koboSpan" id="kobo.549.1"> function, as follows:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.550.1">import</span></span><span class="koboSpan" id="kobo.551.1"> { useUser } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.552.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.553.1">'@/hooks/user.js'</span></span>
</code></pre>
</li>
<li class="numberedList"><em class="italic"><span class="koboSpan" id="kobo.554.1">Replace</span></em><span class="koboSpan" id="kobo.555.1"> the Local Storage Hook with our custom User Hook, as follows:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.556.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.557.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.558.1">CreatePost</span></span><span class="koboSpan" id="kobo.559.1">() {
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.560.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.561.1"> { username } = </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.562.1">useUser</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.563.1">()</span></strong></span>
</code></pre>
</li>
</ol>
<p class="normal-one"><span class="koboSpan" id="kobo.564.1">Being able to access the </span><code class="inlineCode"><span class="koboSpan" id="kobo.565.1">username</span></code><span class="koboSpan" id="kobo.566.1"> from the User Hook decouples the component from the internal logic. </span><span class="koboSpan" id="kobo.566.2">For example, we may later store a whole user object, or an authentication token, in local storage. </span><span class="koboSpan" id="kobo.566.3">If we used the Local Storage Hook in each component, we would need to adjust every single component that uses it. </span><span class="koboSpan" id="kobo.566.4">Now, we can simply adjust the User Hook and as long as we still return the </span><code class="inlineCode"><span class="koboSpan" id="kobo.567.1">username</span></code><span class="koboSpan" id="kobo.568.1"> from it, we do not need to change any components.</span></p>
<ol>
<li class="numberedList" value="19"><span class="koboSpan" id="kobo.569.1">Edit </span><code class="inlineCode"><span class="koboSpan" id="kobo.570.1">src/components/comment/CreateComment.jsx</span></code><span class="koboSpan" id="kobo.571.1"> and </span><em class="italic"><span class="koboSpan" id="kobo.572.1">remove</span></em><span class="koboSpan" id="kobo.573.1"> the following import:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.574.1">import</span></span><span class="koboSpan" id="kobo.575.1"> { useLocalStorage } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.576.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.577.1">'@uidotdev/usehooks'</span></span>
</code></pre>
</li>
</ol>
<p class="normal-one"><em class="italic"><span class="koboSpan" id="kobo.578.1">Replace</span></em><span class="koboSpan" id="kobo.579.1"> it with an import to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.580.1">useUser</span></code><span class="koboSpan" id="kobo.581.1"> function:</span></p>
<pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.582.1">import</span></span><span class="koboSpan" id="kobo.583.1"> { useUser } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.584.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.585.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.586.1">@/hooks/user.js'</span></span>
</code></pre>
<ol>
<li class="numberedList" value="20"><em class="italic"><span class="koboSpan" id="kobo.587.1">Replace</span></em><span class="koboSpan" id="kobo.588.1"> the Local Storage Hook with our custom User Hook, as follows:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.589.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.590.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.591.1">CreateComment</span></span><span class="koboSpan" id="kobo.592.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.593.1">{ addComment }</span></span><span class="koboSpan" id="kobo.594.1">) {
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.595.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.596.1"> { username } = </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.597.1">useUser</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.598.1">()</span></strong></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.599.1">Edit </span><code class="inlineCode"><span class="koboSpan" id="kobo.600.1">src/components/comment/CommentList.jsx</span></code><span class="koboSpan" id="kobo.601.1"> and </span><em class="italic"><span class="koboSpan" id="kobo.602.1">remove</span></em><span class="koboSpan" id="kobo.603.1"> the following import:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.604.1">import</span></span><span class="koboSpan" id="kobo.605.1"> { useLocalStorage } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.606.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.607.1">'@uidotdev/usehooks'</span></span>
</code></pre>
</li>
</ol>
<p class="normal-one"><em class="italic"><span class="koboSpan" id="kobo.608.1">Replace</span></em><span class="koboSpan" id="kobo.609.1"> it with an import to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.610.1">useUser</span></code><span class="koboSpan" id="kobo.611.1"> function:</span></p>
<pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.612.1">import</span></span><span class="koboSpan" id="kobo.613.1"> { useUser } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.614.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.615.1">'@/hooks/user.js'</span></span>
</code></pre>
<ol>
<li class="numberedList" value="22"><em class="italic"><span class="koboSpan" id="kobo.616.1">Replace</span></em><span class="koboSpan" id="kobo.617.1"> the Local Storage Hook with our custom User Hook, as follows:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.618.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.619.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.620.1">CommentList</span></span><span class="koboSpan" id="kobo.621.1">() {
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.622.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.623.1"> { isLoggedIn } = </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.624.1">useUser</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.625.1">()</span></strong></span>
</code></pre>
</li>
<li class="numberedList"><em class="italic"><span class="koboSpan" id="kobo.626.1">Replace</span></em><span class="koboSpan" id="kobo.627.1"> the </span><code class="inlineCode"><span class="koboSpan" id="kobo.628.1">username</span></code><span class="koboSpan" id="kobo.629.1"> check with a check for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.630.1">isLoggedIn</span></code><span class="koboSpan" id="kobo.631.1"> flag:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="koboSpan" id="kobo.632.1">      {</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.633.1">isLoggedIn</span></strong></span><span class="koboSpan" id="kobo.634.1"> &amp;&amp; </span><span class="hljs-tag"><span class="koboSpan" id="kobo.635.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.636.1">CreateComment</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.637.1">addComment</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.638.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.639.1">{addComment}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.640.1"> /&gt;</span></span><span class="koboSpan" id="kobo.641.1">}
</span></code></pre>
</li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.642.1">As we can see, the refactored </span><a id="_idIndexMarker579"/><span class="koboSpan" id="kobo.643.1">code with the User Hook is already significantly easier to read. </span><span class="koboSpan" id="kobo.643.2">Instead of doing checks on the </span><code class="inlineCode"><span class="koboSpan" id="kobo.644.1">username</span></code><span class="koboSpan" id="kobo.645.1">, we are checking an </span><code class="inlineCode"><span class="koboSpan" id="kobo.646.1">isLoggedIn</span></code><span class="koboSpan" id="kobo.647.1"> flag. </span><span class="koboSpan" id="kobo.647.2">Additionally, we are calling </span><code class="inlineCode"><span class="koboSpan" id="kobo.648.1">login</span></code><span class="koboSpan" id="kobo.649.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.650.1">register</span></code><span class="koboSpan" id="kobo.651.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.652.1">logout</span></code><span class="koboSpan" id="kobo.653.1"> functions, abstracting implementation details and allowing the components to focus on their features. </span><span class="koboSpan" id="kobo.653.2">Doing this separates concerns about the application logic into custom Hooks, while components focus on the user interaction.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.654.1">We can now start the dev server, as follows:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.655.1">$ npm run dev
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.656.1">You will see that all functionality of our blog still works the same way as before.</span></p>
<div class="note">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.657.1">Example code</span></strong></p>
<p class="normal"><span class="koboSpan" id="kobo.658.1">The example code for this section can be found in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.659.1">Chapter12/Chapter12_2</span></code><span class="koboSpan" id="kobo.660.1"> folder. </span><span class="koboSpan" id="kobo.660.2">Check the </span><code class="inlineCode"><span class="koboSpan" id="kobo.661.1">README.md</span></code><span class="koboSpan" id="kobo.662.1"> file inside the folder for instructions on how to set up and run the example.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.663.1">Now that we finished</span><a id="_idIndexMarker580"/><span class="koboSpan" id="kobo.664.1"> creating the custom User Hook, let’s move on to creating custom Hooks for API calls.</span></p>
<h1 class="heading-1" id="_idParaDest-258"><a id="_idTextAnchor291"/><span class="koboSpan" id="kobo.665.1">Creating custom API Hooks</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.666.1">We can also create Hooks</span><a id="_idIndexMarker581"/><span class="koboSpan" id="kobo.667.1"> for the various API calls. </span><span class="koboSpan" id="kobo.667.2">Putting these Hooks in a single file allows us to adjust the API calls easily later on. </span><span class="koboSpan" id="kobo.667.3">We are going to prefix our custom API Hooks with </span><code class="inlineCode"><span class="koboSpan" id="kobo.668.1">useAPI</span></code><span class="koboSpan" id="kobo.669.1"> so it is easy to tell which functions are API Hooks.</span></p>
<h2 class="heading-2" id="_idParaDest-259"><a id="_idTextAnchor292"/><span class="koboSpan" id="kobo.670.1">Extracting custom API Hooks</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.671.1">Let’s create custom</span><a id="_idIndexMarker582"/><span class="koboSpan" id="kobo.672.1"> Hooks for our API now by following these steps:</span></p>
<ol>
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.673.1">Copy the </span><code class="inlineCode"><span class="koboSpan" id="kobo.674.1">Chapter12_2</span></code><span class="koboSpan" id="kobo.675.1"> folder to a new </span><code class="inlineCode"><span class="koboSpan" id="kobo.676.1">Chapter12_3</span></code><span class="koboSpan" id="kobo.677.1"> folder by executing the following command:
        </span><pre class="programlisting con-one"><code class="hljs-con"><span class="koboSpan" id="kobo.678.1">$ cp -R Chapter12_2 Chapter12_3
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.679.1">Open the new </span><code class="inlineCode"><span class="koboSpan" id="kobo.680.1">Chapter12_3</span></code><span class="koboSpan" id="kobo.681.1"> folder in VS Code.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.682.1">Create a new </span><code class="inlineCode"><span class="koboSpan" id="kobo.683.1">src/hooks/api.js</span></code><span class="koboSpan" id="kobo.684.1"> file.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.685.1">Edit </span><code class="inlineCode"><span class="koboSpan" id="kobo.686.1">src/hooks/api.js</span></code><span class="koboSpan" id="kobo.687.1"> and import the following functions:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.688.1">import</span></span><span class="koboSpan" id="kobo.689.1"> { useSuspenseQuery, useMutation } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.690.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.691.1">'@tanstack/react-query'</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.692.1">import</span></span><span class="koboSpan" id="kobo.693.1"> {
  fetchPosts,
  fetchPost,
  searchPosts,
  createPost,
  queryClient,
} </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.694.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.695.1">'@/api.js'</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.696.1">Define a function to fetch posts, copied over from the code we had in </span><code class="inlineCode"><span class="koboSpan" id="kobo.697.1">src/components/post/PostFeed.jsx</span></code><span class="koboSpan" id="kobo.698.1">:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.699.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.700.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.701.1">useAPIFetchPosts</span></span><span class="koboSpan" id="kobo.702.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.703.1">{ featured }</span></span><span class="koboSpan" id="kobo.704.1">) {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.705.1">const</span></span><span class="koboSpan" id="kobo.706.1"> { data } = </span><span class="hljs-title"><span class="koboSpan" id="kobo.707.1">useSuspenseQuery</span></span><span class="koboSpan" id="kobo.708.1">({
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.709.1">queryKey</span></span><span class="koboSpan" id="kobo.710.1">: [</span><span class="hljs-string"><span class="koboSpan" id="kobo.711.1">'posts'</span></span><span class="koboSpan" id="kobo.712.1">, featured],
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.713.1">queryFn</span></span><span class="koboSpan" id="kobo.714.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.715.1">async</span></span><span class="koboSpan" id="kobo.716.1"> () =&gt; </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.717.1">await</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.718.1">fetchPosts</span></span><span class="koboSpan" id="kobo.719.1">({ featured }),
  })
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.720.1">return</span></span><span class="koboSpan" id="kobo.721.1"> data
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.722.1">Define a function to</span><a id="_idIndexMarker583"/><span class="koboSpan" id="kobo.723.1"> fetch a single post, copied over from the code we had in </span><code class="inlineCode"><span class="koboSpan" id="kobo.724.1">src/components/post/Post.jsx</span></code><span class="koboSpan" id="kobo.725.1">:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.726.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.727.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.728.1">useAPIFetchPost</span></span><span class="koboSpan" id="kobo.729.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.730.1">{ id }</span></span><span class="koboSpan" id="kobo.731.1">) {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.732.1">const</span></span><span class="koboSpan" id="kobo.733.1"> { data } = </span><span class="hljs-title"><span class="koboSpan" id="kobo.734.1">useSuspenseQuery</span></span><span class="koboSpan" id="kobo.735.1">({
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.736.1">queryKey</span></span><span class="koboSpan" id="kobo.737.1">: [</span><span class="hljs-string"><span class="koboSpan" id="kobo.738.1">'post'</span></span><span class="koboSpan" id="kobo.739.1">, id],
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.740.1">queryFn</span></span><span class="koboSpan" id="kobo.741.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.742.1">async</span></span><span class="koboSpan" id="kobo.743.1"> () =&gt; </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.744.1">await</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.745.1">fetchPost</span></span><span class="koboSpan" id="kobo.746.1">({ id }),
  })
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.747.1">return</span></span><span class="koboSpan" id="kobo.748.1"> data
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.749.1">Define a function to search for posts, copied over from the code we had in </span><code class="inlineCode"><span class="koboSpan" id="kobo.750.1">src/components/post/PostSearchResults.jsx</span></code><span class="koboSpan" id="kobo.751.1">:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.752.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.753.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.754.1">useAPISearchPosts</span></span><span class="koboSpan" id="kobo.755.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.756.1">{ query }</span></span><span class="koboSpan" id="kobo.757.1">) {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.758.1">const</span></span><span class="koboSpan" id="kobo.759.1"> { data } = </span><span class="hljs-title"><span class="koboSpan" id="kobo.760.1">useSuspenseQuery</span></span><span class="koboSpan" id="kobo.761.1">({
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.762.1">queryKey</span></span><span class="koboSpan" id="kobo.763.1">: [</span><span class="hljs-string"><span class="koboSpan" id="kobo.764.1">'posts'</span></span><span class="koboSpan" id="kobo.765.1">, query],
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.766.1">queryFn</span></span><span class="koboSpan" id="kobo.767.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.768.1">async</span></span><span class="koboSpan" id="kobo.769.1"> () =&gt; </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.770.1">await</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.771.1">searchPosts</span></span><span class="koboSpan" id="kobo.772.1">(query),
  })
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.773.1">return</span></span><span class="koboSpan" id="kobo.774.1"> data
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.775.1">Define a function to create posts, copied over from the code we had in </span><code class="inlineCode"><span class="koboSpan" id="kobo.776.1">src/components/post/CreatePost.jsx</span></code><span class="koboSpan" id="kobo.777.1">:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.778.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.779.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.780.1">useAPICreatePost</span></span><span class="koboSpan" id="kobo.781.1">() {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.782.1">const</span></span><span class="koboSpan" id="kobo.783.1"> createPostMutation = </span><span class="hljs-title"><span class="koboSpan" id="kobo.784.1">useMutation</span></span><span class="koboSpan" id="kobo.785.1">({
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.786.1">mutationFn</span></span><span class="koboSpan" id="kobo.787.1">: createPost,
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.788.1">onSuccess</span></span><span class="koboSpan" id="kobo.789.1">: </span><span class="hljs-function"><span class="koboSpan" id="kobo.790.1">() =&gt;</span></span><span class="koboSpan" id="kobo.791.1"> {
      queryClient.</span><span class="hljs-title"><span class="koboSpan" id="kobo.792.1">invalidateQueries</span></span><span class="koboSpan" id="kobo.793.1">([</span><span class="hljs-string"><span class="koboSpan" id="kobo.794.1">'posts'</span></span><span class="koboSpan" id="kobo.795.1">])
    },
  })
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.796.1">return</span></span><span class="koboSpan" id="kobo.797.1"> createPostMutation.</span><span class="hljs-property"><span class="koboSpan" id="kobo.798.1">mutateAsync</span></span><span class="koboSpan" id="kobo.799.1">
}
</span></code></pre>
</li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.800.1">Similarly to the User</span><a id="_idIndexMarker584"/><span class="koboSpan" id="kobo.801.1"> Hook, the API Hooks abstract implementation details and only expose the necessary information, such as the </span><code class="inlineCode"><span class="koboSpan" id="kobo.802.1">data</span></code><span class="koboSpan" id="kobo.803.1"> or the </span><code class="inlineCode"><span class="koboSpan" id="kobo.804.1">mutateAsync</span></code><span class="koboSpan" id="kobo.805.1"> function. </span><span class="koboSpan" id="kobo.805.2">This means that we could even swap out React Query for a different library later, simply by adjusting the custom API Hooks.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.806.1">We can now refactor our blog app to use the custom API Hooks.</span></p>
<h2 class="heading-2" id="_idParaDest-260"><a id="_idTextAnchor293"/><span class="koboSpan" id="kobo.807.1">Using custom API Hooks</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.808.1">Follow these steps</span><a id="_idIndexMarker585"/><span class="koboSpan" id="kobo.809.1"> to refactor the app to use the previously defined API Hooks:</span></p>
<ol>
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.810.1">Edit </span><code class="inlineCode"><span class="koboSpan" id="kobo.811.1">src/components/post/PostFeed.jsx</span></code><span class="koboSpan" id="kobo.812.1"> and </span><em class="italic"><span class="koboSpan" id="kobo.813.1">remove</span></em><span class="koboSpan" id="kobo.814.1"> the following imports:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.815.1">import</span></span><span class="koboSpan" id="kobo.816.1"> { useSuspenseQuery } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.817.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.818.1">'@tanstack/react-query'</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.819.1">import</span></span><span class="koboSpan" id="kobo.820.1"> { fetchPosts } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.821.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.822.1">'@/api.js'</span></span>
</code></pre>
</li>
</ol>
<p class="normal-one"><em class="italic"><span class="koboSpan" id="kobo.823.1">Replace</span></em><span class="koboSpan" id="kobo.824.1"> them with an import of </span><code class="inlineCode"><span class="koboSpan" id="kobo.825.1">useAPIFetchPosts</span></code><span class="koboSpan" id="kobo.826.1">:</span></p>
<pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.827.1">import</span></span><span class="koboSpan" id="kobo.828.1"> { useAPIFetchPosts } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.829.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.830.1">'@/hooks/api.js'</span></span>
</code></pre>
<ol>
<li class="numberedList" value="2"><em class="italic"><span class="koboSpan" id="kobo.831.1">Replace</span></em><span class="koboSpan" id="kobo.832.1"> the Suspense Query Hook with our API Fetch Posts Hook:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.833.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.834.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.835.1">PostFeed</span></span><span class="koboSpan" id="kobo.836.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.837.1">{ featured = </span></span><span class="hljs-literal"><span class="koboSpan" id="kobo.838.1">false</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.839.1"> }</span></span><span class="koboSpan" id="kobo.840.1">) {
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.841.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.842.1"> posts = </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.843.1">useAPIFetchPosts</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.844.1">({ featured })</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.845.1">return</span></span> <span class="hljs-tag"><span class="koboSpan" id="kobo.846.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.847.1">PostList</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.848.1">posts</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.849.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.850.1">{</span></span><span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.851.1">posts</span></strong></span><span class="hljs-string"><span class="koboSpan" id="kobo.852.1">}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.853.1"> /&gt;</span></span><span class="koboSpan" id="kobo.854.1">
}
</span></code></pre>
</li>
</ol>
<p class="normal-one"><span class="koboSpan" id="kobo.855.1">Instead of having implementation details on </span><em class="italic"><span class="koboSpan" id="kobo.856.1">how</span></em><span class="koboSpan" id="kobo.857.1"> we fetch posts from the API, we now only provide the information that is relevant to the component (whether the posts are featured or not). </span><span class="koboSpan" id="kobo.857.2">The </span><a id="_idIndexMarker586"/><span class="koboSpan" id="kobo.858.1">rest is handled internally by the custom API Hook and can be changed later.</span></p>
<ol>
<li class="numberedList" value="3"><span class="koboSpan" id="kobo.859.1">Edit </span><code class="inlineCode"><span class="koboSpan" id="kobo.860.1">src/components/post/Post.jsx</span></code><span class="koboSpan" id="kobo.861.1"> and </span><em class="italic"><span class="koboSpan" id="kobo.862.1">remove</span></em><span class="koboSpan" id="kobo.863.1"> the following imports:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.864.1">import</span></span><span class="koboSpan" id="kobo.865.1"> { useSuspenseQuery } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.866.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.867.1">'@tanstack/react-query'</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.868.1">import</span></span><span class="koboSpan" id="kobo.869.1"> { fetchPost } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.870.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.871.1">'@/api.js'</span></span>
</code></pre>
</li>
</ol>
<p class="normal-one"><em class="italic"><span class="koboSpan" id="kobo.872.1">Replace</span></em><span class="koboSpan" id="kobo.873.1"> them with an import of </span><code class="inlineCode"><span class="koboSpan" id="kobo.874.1">useAPIFetchPost</span></code><span class="koboSpan" id="kobo.875.1">:</span></p>
<pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.876.1">import</span></span><span class="koboSpan" id="kobo.877.1"> { useAPIFetchPost } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.878.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.879.1">'@/hooks/api.js'</span></span>
</code></pre>
<ol>
<li class="numberedList" value="4"><em class="italic"><span class="koboSpan" id="kobo.880.1">Replace</span></em><span class="koboSpan" id="kobo.881.1"> the Suspense Query Hook with our API Fetch Posts Hook:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.882.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.883.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.884.1">Post</span></span><span class="koboSpan" id="kobo.885.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.886.1">{ id }</span></span><span class="koboSpan" id="kobo.887.1">) {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.888.1">const</span></span><span class="koboSpan" id="kobo.889.1"> theme = </span><span class="hljs-title"><span class="koboSpan" id="kobo.890.1">useTheme</span></span><span class="koboSpan" id="kobo.891.1">()
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.892.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.893.1"> { title, content, author } = </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.894.1">useAPIFetchPost</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.895.1">({ id })</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.896.1">return</span></span><span class="koboSpan" id="kobo.897.1"> (
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.898.1">Edit </span><code class="inlineCode"><span class="koboSpan" id="kobo.899.1">src/components/post/PostSearchResults.jsx</span></code><span class="koboSpan" id="kobo.900.1"> and </span><em class="italic"><span class="koboSpan" id="kobo.901.1">remove</span></em><span class="koboSpan" id="kobo.902.1"> the following imports:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.903.1">import</span></span><span class="koboSpan" id="kobo.904.1"> { useSuspenseQuery } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.905.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.906.1">'@tanstack/react-query'</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.907.1">import</span></span><span class="koboSpan" id="kobo.908.1"> { searchPosts } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.909.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.910.1">'@/api.js'</span></span>
</code></pre>
</li>
</ol>
<p class="normal-one"><em class="italic"><span class="koboSpan" id="kobo.911.1">Replace</span></em><span class="koboSpan" id="kobo.912.1"> them with an import of </span><code class="inlineCode"><span class="koboSpan" id="kobo.913.1">useAPISearchPosts</span></code><span class="koboSpan" id="kobo.914.1">:</span></p>
<pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.915.1">import</span></span><span class="koboSpan" id="kobo.916.1"> { useAPISearchPosts } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.917.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.918.1">'@/hooks/api.js'</span></span>
</code></pre>
<ol>
<li class="numberedList" value="6"><em class="italic"><span class="koboSpan" id="kobo.919.1">Replace</span></em><span class="koboSpan" id="kobo.920.1"> the Suspense Query Hook with our API Fetch Posts Hook:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.921.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.922.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.923.1">PostSearchResults</span></span><span class="koboSpan" id="kobo.924.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.925.1">{ query }</span></span><span class="koboSpan" id="kobo.926.1">) {
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.927.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.928.1"> posts = </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.929.1">useAPISearchPosts</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.930.1">({ query })</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.931.1">return</span></span> <span class="hljs-tag"><span class="koboSpan" id="kobo.932.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.933.1">PostList</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.934.1">posts</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.935.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.936.1">{</span></span><span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.937.1">posts</span></strong></span><span class="hljs-string"><span class="koboSpan" id="kobo.938.1">}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.939.1"> /&gt;</span></span><span class="koboSpan" id="kobo.940.1">
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.941.1">Edit </span><code class="inlineCode"><span class="koboSpan" id="kobo.942.1">src/components/post/CreatePost.jsx</span></code><span class="koboSpan" id="kobo.943.1"> and </span><em class="italic"><span class="koboSpan" id="kobo.944.1">remove</span></em><span class="koboSpan" id="kobo.945.1"> the following imports:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.946.1">import</span></span><span class="koboSpan" id="kobo.947.1"> { useMutation } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.948.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.949.1">'@tanstack/react-query'</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.950.1">import</span></span><span class="koboSpan" id="kobo.951.1"> { createPost, queryClient } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.952.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.953.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.954.1">@/api.js'</span></span>
</code></pre>
</li>
</ol>
<p class="normal-one"><em class="italic"><span class="koboSpan" id="kobo.955.1">Replace</span></em><span class="koboSpan" id="kobo.956.1"> them with an import of </span><code class="inlineCode"><span class="koboSpan" id="kobo.957.1">useAPICreatePost</span></code><span class="koboSpan" id="kobo.958.1">:</span></p>
<pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.959.1">import</span></span><span class="koboSpan" id="kobo.960.1"> { useAPICreatePost } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.961.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.962.1">'@/hooks/api.js'</span></span>
</code></pre>
<ol>
<li class="numberedList" value="8"><em class="italic"><span class="koboSpan" id="kobo.963.1">Remove</span></em><span class="koboSpan" id="kobo.964.1"> the existing</span><a id="_idIndexMarker587"/><span class="koboSpan" id="kobo.965.1"> Mutation Hook:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.966.1">const</span></span><span class="koboSpan" id="kobo.967.1"> createPostMutation = </span><span class="hljs-title"><span class="koboSpan" id="kobo.968.1">useMutation</span></span><span class="koboSpan" id="kobo.969.1">({
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.970.1">mutationFn</span></span><span class="koboSpan" id="kobo.971.1">: createPost,
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.972.1">onSuccess</span></span><span class="koboSpan" id="kobo.973.1">: </span><span class="hljs-function"><span class="koboSpan" id="kobo.974.1">() =&gt;</span></span><span class="koboSpan" id="kobo.975.1"> {
      queryClient.</span><span class="hljs-title"><span class="koboSpan" id="kobo.976.1">invalidateQueries</span></span><span class="koboSpan" id="kobo.977.1">([</span><span class="hljs-string"><span class="koboSpan" id="kobo.978.1">'posts'</span></span><span class="koboSpan" id="kobo.979.1">])
    },
  })
</span></code></pre>
</li>
</ol>
<p class="normal-one"><em class="italic"><span class="koboSpan" id="kobo.980.1">Replace</span></em><span class="koboSpan" id="kobo.981.1"> it with our API Create Post Hook:</span></p>
<pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.982.1">const</span></span><span class="koboSpan" id="kobo.983.1"> createPost = </span><span class="hljs-title"><span class="koboSpan" id="kobo.984.1">useAPICreatePost</span></span><span class="koboSpan" id="kobo.985.1">()
</span></code></pre>
<ol>
<li class="numberedList" value="9"><span class="koboSpan" id="kobo.986.1">We can now directly call the </span><code class="inlineCode"><span class="koboSpan" id="kobo.987.1">createPost</span></code><span class="koboSpan" id="kobo.988.1"> function, as follows:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.989.1">const</span></span><span class="koboSpan" id="kobo.990.1"> newPost = { title, content, </span><span class="hljs-attr"><span class="koboSpan" id="kobo.991.1">author</span></span><span class="koboSpan" id="kobo.992.1">: username, </span><span class="hljs-attr"><span class="koboSpan" id="kobo.993.1">featured</span></span><span class="koboSpan" id="kobo.994.1">: </span><span class="hljs-literal"><span class="koboSpan" id="kobo.995.1">false</span></span><span class="koboSpan" id="kobo.996.1"> }
      </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.997.1">try</span></span><span class="koboSpan" id="kobo.998.1"> {
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.999.1">const</span></span><span class="koboSpan" id="kobo.1000.1"> result = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1001.1">await</span></span> <span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1002.1">createPost</span></strong></span><span class="koboSpan" id="kobo.1003.1">(post)
        </span><span class="hljs-title"><span class="koboSpan" id="kobo.1004.1">clear</span></span><span class="koboSpan" id="kobo.1005.1">()
        </span><span class="hljs-title"><span class="koboSpan" id="kobo.1006.1">navigate</span></span><span class="koboSpan" id="kobo.1007.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1008.1">`/post/</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1009.1">${result.id}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1010.1">`</span></span><span class="koboSpan" id="kobo.1011.1">)
      } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1012.1">catch</span></span><span class="koboSpan" id="kobo.1013.1"> (err) {
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1014.1">return</span></span><span class="koboSpan" id="kobo.1015.1"> err
      }
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1016.1">Start the dev server, and make sure that everything still works like before:
        </span><pre class="programlisting con-one"><code class="hljs-con"><span class="koboSpan" id="kobo.1017.1">$ npm run dev
</span></code></pre>
</li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.1018.1">Again, refactoring to use </span><a id="_idIndexMarker588"/><span class="koboSpan" id="kobo.1019.1">custom Hooks has made our components easier to read, allowing us to focus on the user interaction logic, while our custom Hooks deal with the application logic internally.</span></p>
<div class="note">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.1020.1">Example code</span></strong></p>
<p class="normal"><span class="koboSpan" id="kobo.1021.1">The example code for this section can be found in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1022.1">Chapter12/Chapter12_3</span></code><span class="koboSpan" id="kobo.1023.1"> folder. </span><span class="koboSpan" id="kobo.1023.2">Check the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1024.1">README.md</span></code><span class="koboSpan" id="kobo.1025.1"> file inside the folder for instructions on how to set up and run the example.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.1026.1">After creating custom API Hooks, let’s move on to creating a Debounced History State Hook.</span></p>
<h1 class="heading-1" id="_idParaDest-261"><a id="_idTextAnchor294"/><span class="koboSpan" id="kobo.1027.1">Creating a Debounced History State Hook</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1028.1">We are now going to create a </span><a id="_idIndexMarker589"/><span class="koboSpan" id="kobo.1029.1">slightly more advanced Hook for debounced history state functionality. </span><span class="koboSpan" id="kobo.1029.2">In </span><a href="Chapter_10.xhtml#_idTextAnchor250"><em class="italic"><span class="koboSpan" id="kobo.1030.1">Chapter 10</span></em></a><span class="koboSpan" id="kobo.1031.1">, </span><em class="italic"><span class="koboSpan" id="kobo.1032.1">Using Community Hooks</span></em><span class="koboSpan" id="kobo.1033.1">, we learned about the History State Hook, which allowed us to implement undo/redo functionality in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1034.1">CreatePost</span></code><span class="koboSpan" id="kobo.1035.1"> component. </span><span class="koboSpan" id="kobo.1035.2">We then used a Debounce Hook to avoid storing every single change in the history, allowing us to undo/redo larger parts of the text instead of a single character at a time. </span><span class="koboSpan" id="kobo.1035.3">Now, we are going to extract this combined functionality into a custom Debounced History State Hook.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1036.1">While this functionality is </span><a id="_idIndexMarker590"/><span class="koboSpan" id="kobo.1037.1">currently only used in one component, it is a generic feature that could be used in other components. </span><span class="koboSpan" id="kobo.1037.2">Also, abstracting this functionality into a separate Hook allows us to keep the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1038.1">CreatePost</span></code><span class="koboSpan" id="kobo.1039.1"> component code clean and concise.</span></p>
<h2 class="heading-2" id="_idParaDest-262"><a id="_idTextAnchor295"/><span class="koboSpan" id="kobo.1040.1">Creating the Debounced History State Hook</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1041.1">Let’s now get started extracting </span><a id="_idIndexMarker591"/><span class="koboSpan" id="kobo.1042.1">the code from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1043.1">CreatePost</span></code><span class="koboSpan" id="kobo.1044.1"> component into a Debounced History State Hook:</span></p>
<ol>
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1045.1">Copy the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1046.1">Chapter12_3</span></code><span class="koboSpan" id="kobo.1047.1"> folder to a new </span><code class="inlineCode"><span class="koboSpan" id="kobo.1048.1">Chapter12_4</span></code><span class="koboSpan" id="kobo.1049.1"> folder by executing the following command:
        </span><pre class="programlisting con-one"><code class="hljs-con"><span class="koboSpan" id="kobo.1050.1">$ cp -R Chapter12_3 Chapter12_4
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1051.1">Open the new </span><code class="inlineCode"><span class="koboSpan" id="kobo.1052.1">Chapter12_4</span></code><span class="koboSpan" id="kobo.1053.1"> folder in VS Co</span><a id="_idTextAnchor296"/><span class="koboSpan" id="kobo.1054.1">de.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1055.1">Create a new </span><code class="inlineCode"><span class="koboSpan" id="kobo.1056.1">src/hooks/debouncedHistoryState.js</span></code><span class="koboSpan" id="kobo.1057.1"> file.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1058.1">Inside</span><a id="_idTextAnchor297"/><span class="koboSpan" id="kobo.1059.1"> it, import the following:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1060.1">import</span></span><span class="koboSpan" id="kobo.1061.1"> { useState, useEffect } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1062.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1063.1">'react'</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1064.1">import</span></span><span class="koboSpan" id="kobo.1065.1"> { useDebouncedCallback } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1066.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1067.1">'use-debounce'</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1068.1">import</span></span><span class="koboSpan" id="kobo.1069.1"> { useHistoryState } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1070.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1071.1">'@uidotdev/usehooks'</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1072.1">Define a function that accepts an initial state and a timeout value for the debounce:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1073.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1074.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1075.1">useDebouncedHistoryState</span></span><span class="koboSpan" id="kobo.1076.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.1077.1">initialState, timeout</span></span><span class="koboSpan" id="kobo.1078.1">) {
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1079.1">Now, define the History State Hook:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1080.1">const</span></span><span class="koboSpan" id="kobo.1081.1"> { state, set, undo, redo, clear, canUndo, canRedo } =
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1082.1">useHistoryState</span></span><span class="koboSpan" id="kobo.1083.1">(initialState)
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1084.1">Next, define a State Hook for the actively edited content:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1085.1">const</span></span><span class="koboSpan" id="kobo.1086.1"> [content, setContent] = </span><span class="hljs-title"><span class="koboSpan" id="kobo.1087.1">useState</span></span><span class="koboSpan" id="kobo.1088.1">(initialState)
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1089.1">Then, define a Debounced Callback Hook that will set the value of the History State Hook:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1090.1">const</span></span><span class="koboSpan" id="kobo.1091.1"> debounced = </span><span class="hljs-title"><span class="koboSpan" id="kobo.1092.1">useDebouncedCallback</span></span><span class="koboSpan" id="kobo.1093.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.1094.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1095.1">value</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1096.1">) =&gt;</span></span>
<span class="hljs-keyword"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.1097.1">set</span></span><span class="koboSpan" id="kobo.1098.1">(value), timeout)
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1099.1">Add the Effect Hook</span><a id="_idIndexMarker592"/><span class="koboSpan" id="kobo.1100.1"> that we had before in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1101.1">CreatePost</span></code><span class="koboSpan" id="kobo.1102.1"> component:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-title"><span class="koboSpan" id="kobo.1103.1">useEffect</span></span><span class="koboSpan" id="kobo.1104.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.1105.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1106.1"> {
    debounced.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1107.1">cancel</span></span><span class="koboSpan" id="kobo.1108.1">()
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1109.1">setContent</span></span><span class="koboSpan" id="kobo.1110.1">(state)
  }, [state, debounced])
</span></code></pre>
</li>
</ol>
<p class="normal-one"><span class="koboSpan" id="kobo.1111.1">Remember, this Effect Hook is used to sync the History State back into the actively edited </span><code class="inlineCode"><span class="koboSpan" id="kobo.1112.1">content</span></code><span class="koboSpan" id="kobo.1113.1"> state, meaning that it will change the content of the textbox whenever we trigger the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1114.1">undo</span></code><span class="koboSpan" id="kobo.1115.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1116.1">redo</span></code><span class="koboSpan" id="kobo.1117.1">, or </span><code class="inlineCode"><span class="koboSpan" id="kobo.1118.1">clear</span></code><span class="koboSpan" id="kobo.1119.1"> functionality.</span></p>
<ol>
<li class="numberedList" value="10"><span class="koboSpan" id="kobo.1120.1">Now, define a handler function which sets the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1121.1">content</span></code><span class="koboSpan" id="kobo.1122.1"> state and starts the debounced callback:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1123.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1124.1">handleContentChange</span></span><span class="koboSpan" id="kobo.1125.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.1126.1">e</span></span><span class="koboSpan" id="kobo.1127.1">) {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1128.1">const</span></span><span class="koboSpan" id="kobo.1129.1"> { value } = e.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1130.1">target</span></span>
<span class="hljs-title"><span class="koboSpan" id="kobo.1131.1">setContent</span></span><span class="koboSpan" id="kobo.1132.1">(value)
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1133.1">debounced</span></span><span class="koboSpan" id="kobo.1134.1">(value)
  }
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1135.1">Finally, return all the values and functions we need from the Hook:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1136.1">return</span></span><span class="koboSpan" id="kobo.1137.1"> { content, handleContentChange, undo, redo, clear, canUndo,
</span><span class="hljs-keyword"> </span><span class="koboSpan" id="kobo.1138.1">canRedo }
}
</span></code></pre>
</li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.1139.1">Now we have a drop-in replacement for the Debounced History State functionality, which we now use in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1140.1">CreatePost</span></code><span class="koboSpan" id="kobo.1141.1"> component, so</span><a id="_idIndexMarker593"/><span class="koboSpan" id="kobo.1142.1"> let’s do it!</span></p>
<h2 class="heading-2" id="_idParaDest-263"><a id="_idTextAnchor298"/><span class="koboSpan" id="kobo.1143.1">Using the Debounced History State Hook</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1144.1">Follow these steps to</span><a id="_idIndexMarker594"/><span class="koboSpan" id="kobo.1145.1"> refactor the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1146.1">CreatePost</span></code><span class="koboSpan" id="kobo.1147.1"> component to use the Debounced History State Hook:</span></p>
<ol>
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1148.1">Edit </span><code class="inlineCode"><span class="koboSpan" id="kobo.1149.1">src/components/post/CreatePost.jsx</span></code><span class="koboSpan" id="kobo.1150.1"> and </span><em class="italic"><span class="koboSpan" id="kobo.1151.1">remove</span></em><span class="koboSpan" id="kobo.1152.1"> the following highlighted imports:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1153.1">import</span></span><span class="koboSpan" id="kobo.1154.1"> { useActionState</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1155.1">, useState, useEffect</span></strong></span><span class="koboSpan" id="kobo.1156.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1157.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1158.1">'react'</span></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1159.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1160.1"> { useDebouncedCallback } </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1161.1">from</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1162.1">'use-debounce'</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1163.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1164.1"> { useHistoryState } </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1165.1">from</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1166.1">'@uidotdev/usehooks'</span></strong></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1167.1">Add an import of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1168.1">useDebouncedHistoryState</span></code><span class="koboSpan" id="kobo.1169.1"> function:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1170.1">import</span></span><span class="koboSpan" id="kobo.1171.1"> { useDebouncedHistoryState } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1172.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1173.1">'@/hooks/debouncedHistoryState.js'</span></span>
</code></pre>
</li>
<li class="numberedList"><em class="italic"><span class="koboSpan" id="kobo.1174.1">Remove</span></em><span class="koboSpan" id="kobo.1175.1"> all of the following code:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1176.1">const</span></span><span class="koboSpan" id="kobo.1177.1"> { state, set, undo, redo, clear, canUndo, canRedo } =
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1178.1">useHistoryState</span></span><span class="koboSpan" id="kobo.1179.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1180.1">''</span></span><span class="koboSpan" id="kobo.1181.1">)
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1182.1">const</span></span><span class="koboSpan" id="kobo.1183.1"> [content, setContent] = </span><span class="hljs-title"><span class="koboSpan" id="kobo.1184.1">useState</span></span><span class="koboSpan" id="kobo.1185.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1186.1">''</span></span><span class="koboSpan" id="kobo.1187.1">)
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1188.1">const</span></span><span class="koboSpan" id="kobo.1189.1"> debounced = </span><span class="hljs-title"><span class="koboSpan" id="kobo.1190.1">useDebouncedCallback</span></span><span class="koboSpan" id="kobo.1191.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.1192.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1193.1">value</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1194.1">) =&gt;</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1195.1">set</span></span><span class="koboSpan" id="kobo.1196.1">(value), </span><span class="hljs-number"><span class="koboSpan" id="kobo.1197.1">200</span></span><span class="koboSpan" id="kobo.1198.1">)
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.1199.1">useEffect</span></span><span class="koboSpan" id="kobo.1200.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.1201.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1202.1"> {
    debounced.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1203.1">cancel</span></span><span class="koboSpan" id="kobo.1204.1">()
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1205.1">setContent</span></span><span class="koboSpan" id="kobo.1206.1">(state)
  }, [state, debounced])
</span></code></pre>
</li>
</ol>
<p class="normal-one"><em class="italic"><span class="koboSpan" id="kobo.1207.1">Replace</span></em><span class="koboSpan" id="kobo.1208.1"> it with the Debounced History State Hook:</span></p>
<pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1209.1">const</span></span><span class="koboSpan" id="kobo.1210.1"> { content, handleContentChange, undo, redo, clear, canUndo,
    canRedo } =
</span><span class="hljs-title"><span class="koboSpan" id="kobo.1211.1">useDebouncedHistoryState</span></span><span class="koboSpan" id="kobo.1212.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1213.1">''</span></span><span class="koboSpan" id="kobo.1214.1">, </span><span class="hljs-number"><span class="koboSpan" id="kobo.1215.1">200</span></span><span class="koboSpan" id="kobo.1216.1">)
</span></code></pre>
<ol>
<li class="numberedList" value="4"><em class="italic"><span class="koboSpan" id="kobo.1217.1">Remove</span></em><span class="koboSpan" id="kobo.1218.1"> the following handler function:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1219.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1220.1">handleContentChange</span></span><span class="koboSpan" id="kobo.1221.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.1222.1">e</span></span><span class="koboSpan" id="kobo.1223.1">) {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1224.1">const</span></span><span class="koboSpan" id="kobo.1225.1"> { value } = e.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1226.1">target</span></span>
<span class="hljs-title"><span class="koboSpan" id="kobo.1227.1">setContent</span></span><span class="koboSpan" id="kobo.1228.1">(value)
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1229.1">debounced</span></span><span class="koboSpan" id="kobo.1230.1">(value)
  }
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1231.1">Start the dev server </span><a id="_idIndexMarker595"/><span class="koboSpan" id="kobo.1232.1">and ensure that creating a post and undo/redo still work:
        </span><pre class="programlisting con-one"><code class="hljs-con"><span class="koboSpan" id="kobo.1233.1">$ npm run dev
</span></code></pre>
</li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.1234.1">That’s all there is to it – now the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1235.1">CreatePost</span></code><span class="koboSpan" id="kobo.1236.1"> component code is much less cluttered!</span></p>
<div class="note">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.1237.1">Example code</span></strong></p>
<p class="normal"><span class="koboSpan" id="kobo.1238.1">The example code for this section can be found in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1239.1">Chapter12/Chapter12_4</span></code><span class="koboSpan" id="kobo.1240.1"> folder. </span><span class="koboSpan" id="kobo.1240.2">Check the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1241.1">README.md</span></code><span class="koboSpan" id="kobo.1242.1"> file inside the folder for instructions on how to set up and run the example.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.1243.1">After creating the Debounced History State Hook, let’s move on to learn about testing custom Hooks.</span></p>
<h1 class="heading-1" id="_idParaDest-264"><a id="_idTextAnchor299"/><span class="koboSpan" id="kobo.1244.1">Testing custom Hooks</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1245.1">Now our blog application fully </span><a id="_idIndexMarker596"/><span class="koboSpan" id="kobo.1246.1">makes use of Hooks! </span><span class="koboSpan" id="kobo.1246.2">We even defined custom Hooks for various functions to make our code more reusable, concise, and easy to read.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1247.1">When creating custom Hooks, it also makes sense to write unit tests for them to ensure they work properly, even when we change them later on or add more options. </span><span class="koboSpan" id="kobo.1247.2">We are going to use </span><strong class="keyWord"><span class="koboSpan" id="kobo.1248.1">Vitest</span></strong><span class="koboSpan" id="kobo.1249.1"> to write our unit</span><a id="_idIndexMarker597"/><span class="koboSpan" id="kobo.1250.1"> tests. </span><span class="koboSpan" id="kobo.1250.2">Vitest and Vite go very well together, because Vitest can read and use Vite configurations. </span><span class="koboSpan" id="kobo.1250.3">Vitest also offers a Jest-compatible API. </span><strong class="keyWord"><span class="koboSpan" id="kobo.1251.1">Jest</span></strong><span class="koboSpan" id="kobo.1252.1"> is another very popular testing framework. </span><span class="koboSpan" id="kobo.1252.2">If you are already familiar with Jest, learning Vitest will be a breeze. </span><span class="koboSpan" id="kobo.1252.3">Additionally, Vitest is very fast and well equipped for modern web apps.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1253.1">However, as a result of the rules of Hooks, we cannot call Hooks from the test functions because they can only be called inside the body of a functional React component. </span><span class="koboSpan" id="kobo.1253.2">As we do not want to create a component </span><a id="_idIndexMarker598"/><span class="koboSpan" id="kobo.1254.1">specifically for each test, we are going to use the React Testing Library to test Hooks directly. </span><span class="koboSpan" id="kobo.1254.2">This library actually creates a test component and provides various utility functions to interact with Hooks.</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.1255.1">In the past, there were two libraries: The React Testing Library and the React Hooks Testing Library. </span><span class="koboSpan" id="kobo.1255.2">However, nowadays the React Testing Library already includes support for rendering and testing Hooks out of the box, so it is the perfect fit for testing React components and Hooks! </span><span class="koboSpan" id="kobo.1255.3">The React Hooks Testing Library is deprecated now, so we will only be using the React Testing Library.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.1256.1">We should particularly write tests for Hooks in the following circumstances:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.1257.1">When writing libraries that define and export Hooks</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1258.1">When you have Hooks that are used throughout multiple components</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1259.1">When a Hook is complex and will thus be difficult to change/refactor later</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.1260.1">When you have Hooks that are specific to one component, it is often better to just test the component directly. </span><span class="koboSpan" id="kobo.1260.2">However, testing React components is out of scope of this book. </span><span class="koboSpan" id="kobo.1260.3">More information about testing </span><a id="_idIndexMarker599"/><span class="koboSpan" id="kobo.1261.1">components can be found on </span><a id="_idTextAnchor300"/><span class="koboSpan" id="kobo.1262.1">the React Testing Library website: </span><a href="https://testing-library.com/docs/react-testing-library/intro/"><span class="url"><span class="koboSpan" id="kobo.1263.1">https://testing-library.com/docs/react-testing-library/intro/</span></span></a></p>
<p class="normal"><span class="koboSpan" id="kobo.1264.1">Now, let’s get started setting up Vitest and the React Testing Library!</span></p>
<h2 class="heading-2" id="_idParaDest-265"><a id="_idTextAnchor301"/><span class="koboSpan" id="kobo.1265.1">Setting up Vitest and the React Testing Library</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1266.1">Before we can </span><a id="_idIndexMarker600"/><span class="koboSpan" id="kobo.1267.1">start writing tests for our Hooks, we first need to</span><a id="_idIndexMarker601"/><span class="koboSpan" id="kobo.1268.1"> set up Vitest and the React Testing Library:</span></p>
<ol>
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1269.1">Copy the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1270.1">Chapter12_4</span></code><span class="koboSpan" id="kobo.1271.1"> folder</span><a id="_idIndexMarker602"/><span class="koboSpan" id="kobo.1272.1"> to a new </span><code class="inlineCode"><span class="koboSpan" id="kobo.1273.1">Chapter12_5</span></code><span class="koboSpan" id="kobo.1274.1"> folder </span><a id="_idTextAnchor302"/><span class="koboSpan" id="kobo.1275.1">by executing the following command:
        </span><pre class="programlisting con-one"><code class="hljs-con"><span class="koboSpan" id="kobo.1276.1">$ cp -R Chapter12_4 Chapter12_5
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1277.1">Open the new </span><code class="inlineCode"><span class="koboSpan" id="kobo.1278.1">Chapter12_5</span></code><span class="koboSpan" id="kobo.1279.1"> folder in VS Code.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1280.1">Install Vitest, the React</span><a id="_idIndexMarker603"/><span class="koboSpan" id="kobo.1281.1"> Testing Library, and jsdom,</span><a id="_idTextAnchor303"/><span class="koboSpan" id="kobo.1282.1"> by executing the following command:
        </span><pre class="programlisting con-one"><code class="hljs-con"><span class="koboSpan" id="kobo.1283.1">$ npm install --save-exact --save-dev vitest@3.0.5 @testing-library/react@16.2.0 jsdom@26.0.0
</span></code></pre>
</li>
</ol>
<p class="normal-one"><span class="koboSpan" id="kobo.1284.1">jsdom provides an </span><a id="_idIndexMarker604"/><span class="koboSpan" id="kobo.1285.1">environment to access the DOM in Node.js. </span><span class="koboSpan" id="kobo.1285.2">Since our tests are not actually running in </span><a id="_idIndexMarker605"/><span class="koboSpan" id="kobo.1286.1">a browser, it is necessary to provide such an environment to be able to render React components and test Hooks.</span></p>
<ol>
<li class="numberedList" value="4"><span class="koboSpan" id="kobo.1287.1">Edit </span><code class="inlineCode"><span class="koboSpan" id="kobo.1288.1">package.json</span></code><span class="koboSpan" id="kobo.1289.1"> and add a script for running Vitest:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-string"><span class="koboSpan" id="kobo.1290.1">"scripts"</span></span><span class="koboSpan" id="kobo.1291.1">: {
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1292.1">"test"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1293.1">: </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1294.1">"vitest"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1295.1">,</span></strong></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1296.1">Finally, edit </span><code class="inlineCode"><span class="koboSpan" id="kobo.1297.1">vite.config.js</span></code><span class="koboSpan" id="kobo.1298.1"> and add a config for Vitest at the end of the file:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="koboSpan" id="kobo.1299.1">        rewrite: </span><span class="hljs-function"><span class="koboSpan" id="kobo.1300.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1301.1">path</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1302.1">) =&gt;</span></span><span class="koboSpan" id="kobo.1303.1"> path.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1304.1">replace</span></span><span class="koboSpan" id="kobo.1305.1">(</span><span class="hljs-regexp"><span class="koboSpan" id="kobo.1306.1">/^\/api/</span></span><span class="koboSpan" id="kobo.1307.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.1308.1">''</span></span><span class="koboSpan" id="kobo.1309.1">),
      },
    },
  },
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1310.1">test</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1311.1">: {</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1312.1">environment</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1313.1">: </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1314.1">'jsdom'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1315.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1316.1">  },</span></strong></span><span class="koboSpan" id="kobo.1317.1">
})
</span></code></pre>
</li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.1318.1">Now that </span><a id="_idIndexMarker606"/><span class="koboSpan" id="kobo.1319.1">we have successfully</span><a id="_idIndexMarker607"/><span class="koboSpan" id="kobo.1320.1"> set up Vitest, we can start testing Hooks!</span></p>
<h2 class="heading-2" id="_idParaDest-266"><a id="_idTextAnchor304"/><span class="koboSpan" id="kobo.1321.1">Testing a simple Hook</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1322.1">First of all, we are </span><a id="_idIndexMarker608"/><span class="koboSpan" id="kobo.1323.1">going to test a very simple Hook that does not make use </span><a id="_idIndexMarker609"/><span class="koboSpan" id="kobo.1324.1">of contexts or asynchronous code such as timeouts. </span><span class="koboSpan" id="kobo.1324.2">To do this, we are going to create a new Hook called </span><code class="inlineCode"><span class="koboSpan" id="kobo.1325.1">useCounter</span></code><span class="koboSpan" id="kobo.1326.1">. </span><span class="koboSpan" id="kobo.1326.2">Then, we are going to test various parts of the Hook.</span></p>
<h3 class="heading-3" id="_idParaDest-267"><a id="_idTextAnchor305"/><span class="koboSpan" id="kobo.1327.1">Creating the Counter Hook</span></h3>
<p class="normal"><span class="koboSpan" id="kobo.1328.1">The Counter Hook is</span><a id="_idIndexMarker610"/><span class="koboSpan" id="kobo.1329.1"> going to provide a current </span><code class="inlineCode"><span class="koboSpan" id="kobo.1330.1">count</span></code><span class="koboSpan" id="kobo.1331.1"> and</span><a id="_idIndexMarker611"/><span class="koboSpan" id="kobo.1332.1"> functions to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1333.1">increment</span></code><span class="koboSpan" id="kobo.1334.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1335.1">reset</span></code><span class="koboSpan" id="kobo.1336.1"> the counter. </span><span class="koboSpan" id="kobo.1336.2">Follow these steps to create it:</span></p>
<ol>
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1337.1">Create a new </span><code class="inlineCode"><span class="koboSpan" id="kobo.1338.1">src/hooks/counter.js</span></code> <a id="_idTextAnchor306"/><a id="_idTextAnchor307"/><span class="koboSpan" id="kobo.1339.1">file.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1340.1">Inside it, import the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1341.1">useState</span></code><span class="koboSpan" id="kobo.1342.1"> function:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1343.1">import</span></span><span class="koboSpan" id="kobo.1344.1"> { useState } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1345.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1346.1">'react'</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1347.1">Then, define a Counter Hook, which takes an </span><code class="inlineCode"><span class="koboSpan" id="kobo.1348.1">initialCount</span></code><span class="koboSpan" id="kobo.1349.1"> as argument:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1350.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1351.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1352.1">useCounter</span></span><span class="koboSpan" id="kobo.1353.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.1354.1">initialCount = </span></span><span class="hljs-number"><span class="koboSpan" id="kobo.1355.1">0</span></span><span class="koboSpan" id="kobo.1356.1">) {
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1357.1">Define a State Hook for the count:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1358.1">const</span></span><span class="koboSpan" id="kobo.1359.1"> [count, setCount] = </span><span class="hljs-title"><span class="koboSpan" id="kobo.1360.1">useState</span></span><span class="koboSpan" id="kobo.1361.1">(initialCount)
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1362.1">Now, define a function to increment the count by 1:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1363.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1364.1">increment</span></span><span class="koboSpan" id="kobo.1365.1">() {
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1366.1">setCount</span></span><span class="koboSpan" id="kobo.1367.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.1368.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1369.1">count</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1370.1">) =&gt;</span></span><span class="koboSpan" id="kobo.1371.1"> count + </span><span class="hljs-number"><span class="koboSpan" id="kobo.1372.1">1</span></span><span class="koboSpan" id="kobo.1373.1">)
  }
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1374.1">Next, define a function to reset the counter to the initial count:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1375.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1376.1">reset</span></span><span class="koboSpan" id="kobo.1377.1">() {
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1378.1">setCount</span></span><span class="koboSpan" id="kobo.1379.1">(initialCount)
  }
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1380.1">Return the current count and the two functions:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1381.1">return</span></span><span class="koboSpan" id="kobo.1382.1"> { count, increment, reset }
}
</span></code></pre>
</li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.1383.1">Now that we have</span><a id="_idIndexMarker612"/><span class="koboSpan" id="kobo.1384.1"> defined a simple Hook, we can start writing our first</span><a id="_idIndexMarker613"/><span class="koboSpan" id="kobo.1385.1"> tests.</span></p>
<h3 class="heading-3" id="_idParaDest-268"><a id="_idTextAnchor308"/><span class="koboSpan" id="kobo.1386.1">Creating unit tests for the Counter Hook</span></h3>
<p class="normal"><span class="koboSpan" id="kobo.1387.1">Let’s now write unit tests for the </span><a id="_idIndexMarker614"/><span class="koboSpan" id="kobo.1388.1">Counter Hook by following these st</span><a id="_idTextAnchor309"/><span class="koboSpan" id="kobo.1389.1">eps:</span></p>
<ol>
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1390.1">Create a new </span><code class="inlineCode"><span class="koboSpan" id="kobo.1391.1">src/hooks/counter.test.js</span></code><span class="koboSpan" id="kobo.1392.1"> file.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1393.1">Inside it, import the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1394.1">describe</span></code><span class="koboSpan" id="kobo.1395.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1396.1">test</span></code><span class="koboSpan" id="kobo.1397.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1398.1">expect</span></code><span class="koboSpan" id="kobo.1399.1"> functions from Vitest, as well as </span><span class="hljs-params"><span class="koboSpan" id="kobo.1400.1">the</span></span> <code class="inlineCode"><span class="koboSpan" id="kobo.1401.1">renderHook</span></code><span class="koboSpan" id="kobo.1402.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1403.1">act</span></code><span class="koboSpan" id="kobo.1404.1"> functions from the React Testing Library:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1405.1">import</span></span><span class="koboSpan" id="kobo.1406.1"> { describe, test, expect } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1407.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1408.1">'vitest'</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1409.1">import</span></span><span class="koboSpan" id="kobo.1410.1"> { renderHook, act } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1411.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1412.1">'@testing-library/react'</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1413.1">Also, import the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1414.1">useCounter</span></code><span class="koboSpan" id="kobo.1415.1"> function, which we are going to write tests for:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1416.1">import</span></span><span class="koboSpan" id="kobo.1417.1"> { useCounter } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1418.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1419.1">'./counter.js'</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1420.1">Now, we can start defining tests. </span><span class="koboSpan" id="kobo.1420.2">In Vitest, we can use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1421.1">describe</span></code><span class="koboSpan" id="kobo.1422.1"> function to define a group of tests. </span><span class="koboSpan" id="kobo.1422.2">The first argument is a name for the group, the second argument is an options object to configure the test (we leave this as an empty object), and the third argument is a function in which we can define our various tests. </span><span class="koboSpan" id="kobo.1422.3">Here, we create a group of tests for the Counter Hook, so let’s call it that:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.1423.1">describe</span></span><span class="koboSpan" id="kobo.1424.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1425.1">'Counter Hook'</span></span><span class="koboSpan" id="kobo.1426.1">, {}, </span><span class="hljs-function"><span class="koboSpan" id="kobo.1427.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1428.1"> {
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1429.1">Inside the group, we can now define our tests. </span><span class="koboSpan" id="kobo.1429.2">To define a test, we use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1430.1">test</span></code><span class="koboSpan" id="kobo.1431.1"> function. </span><span class="koboSpan" id="kobo.1431.2">The first argument is the name of the test, the second argument the test options, and the third argument is a function to be executed as the test. </span><span class="koboSpan" id="kobo.1431.3">In our first test, we check if the Hook returns 0 by default:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-title"><span class="koboSpan" id="kobo.1432.1">test</span></span><span class="koboSpan" id="kobo.1433.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1434.1">'should return 0 by default'</span></span><span class="koboSpan" id="kobo.1435.1">, {}, </span><span class="hljs-function"><span class="koboSpan" id="kobo.1436.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1437.1"> {
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1438.1">In this test, we use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1439.1">renderHook</span></code><span class="koboSpan" id="kobo.1440.1"> function to </span><a id="_idIndexMarker615"/><span class="koboSpan" id="kobo.1441.1">simulate the Hook being rendered in a React component. </span><span class="koboSpan" id="kobo.1441.2">It returns an object for us, which includes a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1442.1">result</span></code><span class="koboSpan" id="kobo.1443.1">:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1444.1">const</span></span><span class="koboSpan" id="kobo.1445.1"> { result } = </span><span class="hljs-title"><span class="koboSpan" id="kobo.1446.1">renderHook</span></span><span class="koboSpan" id="kobo.1447.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.1448.1">() =&gt;</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1449.1">useCounter</span></span><span class="koboSpan" id="kobo.1450.1">())
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1451.1">We can now access the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1452.1">count</span></code><span class="koboSpan" id="kobo.1453.1"> by getting it from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1454.1">result.current</span></code><span class="koboSpan" id="kobo.1455.1"> object, and check if it is 0:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-title"><span class="koboSpan" id="kobo.1456.1">expect</span></span><span class="koboSpan" id="kobo.1457.1">(result.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1458.1">current</span></span><span class="koboSpan" id="kobo.1459.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1460.1">count</span></span><span class="koboSpan" id="kobo.1461.1">).</span><span class="hljs-title"><span class="koboSpan" id="kobo.1462.1">toBe</span></span><span class="koboSpan" id="kobo.1463.1">(</span><span class="hljs-number"><span class="koboSpan" id="kobo.1464.1">0</span></span><span class="koboSpan" id="kobo.1465.1">)
  })
</span></code></pre>
</li>
</ol>
<p class="normal-one"><span class="koboSpan" id="kobo.1466.1">With the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1467.1">expect</span></code><span class="koboSpan" id="kobo.1468.1"> function we can do tests on values. </span><span class="koboSpan" id="kobo.1468.2">It works as follows: </span><code class="inlineCode"><span class="koboSpan" id="kobo.1469.1">expect(actualValue).toBe(expectedValue)</span></code><span class="koboSpan" id="kobo.1470.1">. </span><span class="koboSpan" id="kobo.1470.2">If the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1471.1">actualValue</span></code><span class="koboSpan" id="kobo.1472.1"> matches the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1473.1">expectedValue</span></code><span class="koboSpan" id="kobo.1474.1">, the test will succeed. </span><span class="koboSpan" id="kobo.1474.2">Otherwise, it will fail.</span></p>
<div class="note-one">
<p class="normal"><span class="koboSpan" id="kobo.1475.1">There are many kinds of matchers to be used with </span><code class="inlineCode"><span class="koboSpan" id="kobo.1476.1">expect</span></code><span class="koboSpan" id="kobo.1477.1"> – </span><code class="inlineCode"><span class="koboSpan" id="kobo.1478.1">toBe</span></code><span class="koboSpan" id="kobo.1479.1"> is just one of them! </span><span class="koboSpan" id="kobo.1479.2">For a full list of matche</span><a id="_idTextAnchor310"/><span class="koboSpan" id="kobo.1480.1">rs, please check out the Vitest API documentation: </span><a href="https://vitest.dev/api/expect.html"><span class="url"><span class="koboSpan" id="kobo.1481.1">https://vitest.dev/api/expect.html</span></span></a></p>
<p class="normal"><span class="koboSpan" id="kobo.1482.1">If you have worked with Jest before, you will notice that the Vitest API is fully compatible with it, so all these functions will be familiar to you.</span></p>
</div>
<ol>
<li class="numberedList" value="8"><span class="koboSpan" id="kobo.1483.1">Next, let’s define a test that checks if the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1484.1">initialCount</span></code><span class="koboSpan" id="kobo.1485.1"> argument works:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-title"><span class="koboSpan" id="kobo.1486.1">test</span></span><span class="koboSpan" id="kobo.1487.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1488.1">'should initially return initial count'</span></span><span class="koboSpan" id="kobo.1489.1">, {}, </span><span class="hljs-function"><span class="koboSpan" id="kobo.1490.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1491.1"> {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1492.1">const</span></span><span class="koboSpan" id="kobo.1493.1"> { result } = </span><span class="hljs-title"><span class="koboSpan" id="kobo.1494.1">renderHook</span></span><span class="koboSpan" id="kobo.1495.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.1496.1">() =&gt;</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1497.1">useCounter</span></span><span class="koboSpan" id="kobo.1498.1">(</span><span class="hljs-number"><span class="koboSpan" id="kobo.1499.1">123</span></span><span class="koboSpan" id="kobo.1500.1">))
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1501.1">expect</span></span><span class="koboSpan" id="kobo.1502.1">(result.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1503.1">current</span></span><span class="koboSpan" id="kobo.1504.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1505.1">count</span></span><span class="koboSpan" id="kobo.1506.1">).</span><span class="hljs-title"><span class="koboSpan" id="kobo.1507.1">toBe</span></span><span class="koboSpan" id="kobo.1508.1">(</span><span class="hljs-number"><span class="koboSpan" id="kobo.1509.1">123</span></span><span class="koboSpan" id="kobo.1510.1">)
  })
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1511.1">Now, we define a test that checks if the increment function increments the counter:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-title"><span class="koboSpan" id="kobo.1512.1">test</span></span><span class="koboSpan" id="kobo.1513.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1514.1">'should increment counter when increment() is called'</span></span><span class="koboSpan" id="kobo.1515.1">, {}, </span><span class="hljs-function"><span class="koboSpan" id="kobo.1516.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1517.1"> {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1518.1">const</span></span><span class="koboSpan" id="kobo.1519.1"> { result } = </span><span class="hljs-title"><span class="koboSpan" id="kobo.1520.1">renderHook</span></span><span class="koboSpan" id="kobo.1521.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.1522.1">() =&gt;</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1523.1">useCounter</span></span><span class="koboSpan" id="kobo.1524.1">(</span><span class="hljs-number"><span class="koboSpan" id="kobo.1525.1">0</span></span><span class="koboSpan" id="kobo.1526.1">))
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1527.1">We can use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1528.1">act</span></code><span class="koboSpan" id="kobo.1529.1"> function to trigger an action from the Hook. </span><span class="koboSpan" id="kobo.1529.2">This function tells the React Testing </span><a id="_idIndexMarker616"/><span class="koboSpan" id="kobo.1530.1">Library that something is being triggered inside the Hook, causing the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1531.1">result.current</span></code><span class="koboSpan" id="kobo.1532.1"> value from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1533.1">renderHook</span></code><span class="koboSpan" id="kobo.1534.1"> function to be updated:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-title"><span class="koboSpan" id="kobo.1535.1">act</span></span><span class="koboSpan" id="kobo.1536.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.1537.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1538.1"> result.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1539.1">current</span></span><span class="koboSpan" id="kobo.1540.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1541.1">increment</span></span><span class="koboSpan" id="kobo.1542.1">())
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1543.1">Then, we can check if the new count is 1:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-title"><span class="koboSpan" id="kobo.1544.1">expect</span></span><span class="koboSpan" id="kobo.1545.1">(result.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1546.1">current</span></span><span class="koboSpan" id="kobo.1547.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1548.1">count</span></span><span class="koboSpan" id="kobo.1549.1">).</span><span class="hljs-title"><span class="koboSpan" id="kobo.1550.1">toBe</span></span><span class="koboSpan" id="kobo.1551.1">(</span><span class="hljs-number"><span class="koboSpan" id="kobo.1552.1">1</span></span><span class="koboSpan" id="kobo.1553.1">)
  })
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1554.1">Next, let’s do a test that simulates the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1555.1">initialCount</span></code><span class="koboSpan" id="kobo.1556.1"> passed to the Counter Hook b</span><a id="_idTextAnchor311"/><span class="koboSpan" id="kobo.1557.1">eing changed by a prop change of a React component:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-title"><span class="koboSpan" id="kobo.1558.1">test</span></span><span class="koboSpan" id="kobo.1559.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1560.1">'should reset to initial value'</span></span><span class="koboSpan" id="kobo.1561.1">, {}, </span><span class="hljs-function"><span class="koboSpan" id="kobo.1562.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1563.1"> {
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1564.1">To simulate a React prop, we simply define a variable, then we define the Hook:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1565.1">let</span></span><span class="koboSpan" id="kobo.1566.1"> initial = </span><span class="hljs-number"><span class="koboSpan" id="kobo.1567.1">0</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1568.1">const</span></span><span class="koboSpan" id="kobo.1569.1"> { result, rerender } = </span><span class="hljs-title"><span class="koboSpan" id="kobo.1570.1">renderHook</span></span><span class="koboSpan" id="kobo.1571.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.1572.1">() =&gt;</span></span>
<span class="hljs-keyword"> </span><span class="hljs-title"><span class="koboSpan" id="kobo.1573.1">useCounter</span></span><span class="koboSpan" id="kobo.1574.1">(initial))
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1575.1">We can now change the prop by changing the variable and manually triggering a re-render of the React component, by using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1576.1">rerender</span></code><span class="koboSpan" id="kobo.1577.1"> function returned from </span><code class="inlineCode"><span class="koboSpan" id="kobo.1578.1">renderHook</span></code><span class="koboSpan" id="kobo.1579.1">:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="koboSpan" id="kobo.1580.1">    initial = </span><span class="hljs-number"><span class="koboSpan" id="kobo.1581.1">123</span></span>
<span class="hljs-title"><span class="koboSpan" id="kobo.1582.1">rerender</span></span><span class="koboSpan" id="kobo.1583.1">()
</span></code></pre>
</li>
</ol>
<p class="normal-one"><span class="koboSpan" id="kobo.1584.1">As we have learned before, the React Testing Library creates a dummy component, which is used for testing the Hook. </span><span class="koboSpan" id="kobo.1584.2">We can</span><a id="_idIndexMarker617"/><span class="koboSpan" id="kobo.1585.1"> force this dummy component to rerender to simulate what would happen when props change in a real component.</span></p>
<ol>
<li class="numberedList" value="15"><span class="koboSpan" id="kobo.1586.1">Now, we call the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1587.1">reset</span></code><span class="koboSpan" id="kobo.1588.1"> function and check if the count was reset to the new initial count:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-title"><span class="koboSpan" id="kobo.1589.1">act</span></span><span class="koboSpan" id="kobo.1590.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.1591.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1592.1"> result.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1593.1">current</span></span><span class="koboSpan" id="kobo.1594.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1595.1">reset</span></span><span class="koboSpan" id="kobo.1596.1">())
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1597.1">expect</span></span><span class="koboSpan" id="kobo.1598.1">(result.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1599.1">current</span></span><span class="koboSpan" id="kobo.1600.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1601.1">count</span></span><span class="koboSpan" id="kobo.1602.1">).</span><span class="hljs-title"><span class="koboSpan" id="kobo.1603.1">toBe</span></span><span class="koboSpan" id="kobo.1604.1">(</span><span class="hljs-number"><span class="koboSpan" id="kobo.1605.1">123</span></span><span class="koboSpan" id="kobo.1606.1">)
  })
})
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1607.1">Run the tests, by executing the following command:
        </span><pre class="programlisting con-one"><code class="hljs-con"><span class="koboSpan" id="kobo.1608.1">$ npm test
</span></code></pre>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.1609.1">Remember, for special scripts, such as </span><code class="inlineCode"><span class="koboSpan" id="kobo.1610.1">start</span></code><span class="koboSpan" id="kobo.1611.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1612.1">test</span></code><span class="koboSpan" id="kobo.1613.1">, we do not need to execute </span><code class="inlineCode"><span class="koboSpan" id="kobo.1614.1">npm run test</span></code><span class="koboSpan" id="kobo.1615.1">; we can simply execute </span><code class="inlineCode"><span class="koboSpan" id="kobo.1616.1">npm test</span></code><span class="koboSpan" id="kobo.1617.1">.</span></p>
</div>
</li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.1618.1">The following screenshot shows the result after executing </span><code class="inlineCode"><span class="koboSpan" id="kobo.1619.1">npm test</span></code><span class="koboSpan" id="kobo.1620.1">:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1621.1"><img alt="Figure 12.1 – Running Vitest in watch mode" src="../Images/B31327_12_01.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1622.1">Figure 12.1 – Running Vitest in watch mode</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1623.1">You will see that Vitest automatically</span><a id="_idIndexMarker618"/><span class="koboSpan" id="kobo.1624.1"> runs the watch mode. </span><span class="koboSpan" id="kobo.1624.2">This means that it will wait for file changes and automatically re-run tests for you. </span><span class="koboSpan" id="kobo.1624.3">You can just keep running it in that mode throughout the rest of this chapter to see your tests executing as you write them.</span></p>
<h2 class="heading-2" id="_idParaDest-269"><a id="_idTextAnchor312"/><span class="koboSpan" id="kobo.1625.1">Testing the Theme Hook</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1626.1">Using the React Hooks</span><a id="_idIndexMarker619"/><span class="koboSpan" id="kobo.1627.1"> Testing Library, we can also test more complex Hooks, such as those Hooks that make use of context. </span><span class="koboSpan" id="kobo.1627.2">To test Hooks that make use of context, we</span><a id="_idIndexMarker620"/><span class="koboSpan" id="kobo.1628.1"> first have to create a context wrapper, and then we can test the Hook.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1629.1">Let’s get started writing tests for the Theme Hook now:</span></p>
<ol>
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1630.1">Create a new </span><code class="inlineCode"><span class="koboSpan" id="kobo.1631.1">src/hooks/theme.test.jsx</span></code><span class="koboSpan" id="kobo.1632.1"> file. </span><span class="koboSpan" id="kobo.1632.2">Please note that the file extension needs to be </span><code class="inlineCode"><span class="koboSpan" id="kobo.1633.1">.jsx</span></code><span class="koboSpan" id="kobo.1634.1">, not just </span><code class="inlineCode"><span class="koboSpan" id="kobo.1635.1">.js</span></code><span class="koboSpan" id="kobo.1636.1">, as we will be using JSX in that file.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1637.1">Inside it, import the relevant functions from Vitest, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1638.1">renderHook</span></code><span class="koboSpan" id="kobo.1639.1"> function, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1640.1">ThemeContext</span></code><span class="koboSpan" id="kobo.1641.1">, and the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1642.1">useTheme</span></code><span class="koboSpan" id="kobo.1643.1"> function:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1644.1">import</span></span><span class="koboSpan" id="kobo.1645.1"> { describe, test, expect } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1646.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1647.1">'vitest'</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1648.1">import</span></span><span class="koboSpan" id="kobo.1649.1"> { renderHook } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1650.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1651.1">'@testing-library/react'</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1652.1">import</span></span><span class="koboSpan" id="kobo.1653.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.1654.1">ThemeContext</span></span><span class="koboSpan" id="kobo.1655.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1656.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1657.1">'@/contexts/ThemeContext.js'</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1658.1">import</span></span><span class="koboSpan" id="kobo.1659.1"> { useTheme } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1660.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1661.1">'./theme.js'</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1662.1">Now, define a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1663.1">ThemeContextWrapper</span></code><span class="koboSpan" id="kobo.1664.1"> component, which will set up the context provider for testing:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1665.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1666.1">ThemeContextWrapper</span></span><span class="koboSpan" id="kobo.1667.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.1668.1">{ children }</span></span><span class="koboSpan" id="kobo.1669.1">) {
</span></code></pre>
</li>
</ol>
<p class="normal-one"><span class="koboSpan" id="kobo.1670.1">The wrapper accepts </span><code class="inlineCode"><span class="koboSpan" id="kobo.1671.1">children</span></code><span class="koboSpan" id="kobo.1672.1"> as a prop, which is a special property of React components. </span><span class="koboSpan" id="kobo.1672.2">It will </span><a id="_idIndexMarker621"/><span class="koboSpan" id="kobo.1673.1">contain all other components defined inside the wrapper, such as </span><code class="inlineCode"><span class="koboSpan" id="kobo.1674.1">&lt;ThemeContextWrapper&gt;{children}&lt;/ThemeContextWrapper&gt;</span></code><span class="koboSpan" id="kobo.1675.1">.</span></p>
<ol>
<li class="numberedList" value="4"><span class="koboSpan" id="kobo.1676.1">Inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1677.1">wrapper</span></code><span class="koboSpan" id="kobo.1678.1"> component, define the context provider and a value for </span><code class="inlineCode"><span class="koboSpan" id="kobo.1679.1">primaryColor</span></code><span class="koboSpan" id="kobo.1680.1">:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1681.1">return</span></span><span class="koboSpan" id="kobo.1682.1"> (
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1683.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1684.1">ThemeContext.Provider</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1685.1">value</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1686.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1687.1">{{</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1688.1">primaryColor:</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1689.1"> '</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1690.1">deepskyblue</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1691.1">' }}&gt;</span></span><span class="koboSpan" id="kobo.1692.1">
      {children}
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1693.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1694.1">ThemeContext.Provider</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1695.1">&gt;</span></span><span class="koboSpan" id="kobo.1696.1">
  )
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1697.1">Now, we can begin </span><a id="_idIndexMarker622"/><span class="koboSpan" id="kobo.1698.1">writing test</span><a id="_idTextAnchor313"/><span class="koboSpan" id="kobo.1699.1">s for the Theme Hook. </span><span class="koboSpan" id="kobo.1699.2">We start by creating a test group:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.1700.1">describe</span></span><span class="koboSpan" id="kobo.1701.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1702.1">'Theme Hook'</span></span><span class="koboSpan" id="kobo.1703.1">, {}, </span><span class="hljs-function"><span class="koboSpan" id="kobo.1704.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1705.1"> {
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1706.1">Inside the group, we define a test which checks for the primary color:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-title"><span class="koboSpan" id="kobo.1707.1">test</span></span><span class="koboSpan" id="kobo.1708.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1709.1">'should return the primaryColor defined by the context'</span></span><span class="koboSpan" id="kobo.1710.1">,
</span><span class="hljs-title"> </span><span class="koboSpan" id="kobo.1711.1">{}, </span><span class="hljs-function"><span class="koboSpan" id="kobo.1712.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1713.1"> {
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1714.1">Then render the Hook, passing the wrapper component to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1715.1">renderHook</span></code><span class="koboSpan" id="kobo.1716.1"> function:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1717.1">const</span></span><span class="koboSpan" id="kobo.1718.1"> { result } = </span><span class="hljs-title"><span class="koboSpan" id="kobo.1719.1">renderHook</span></span><span class="koboSpan" id="kobo.1720.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.1721.1">() =&gt;</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1722.1">useTheme</span></span><span class="koboSpan" id="kobo.1723.1">(), {
      </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1724.1">wrapper</span></span><span class="koboSpan" id="kobo.1725.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.1726.1">ThemeContextWrapper</span></span><span class="koboSpan" id="kobo.1727.1">,
    })
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1728.1">Now, check if the primary color is the same as we defined in the wrapper component:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.1729.1">    expect</span></span><span class="koboSpan" id="kobo.1730.1">(result.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1731.1">current</span></span><span class="koboSpan" id="kobo.1732.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1733.1">primaryColor</span></span><span class="koboSpan" id="kobo.1734.1">).</span><span class="hljs-title"><span class="koboSpan" id="kobo.1735.1">toBe</span></span><span class="koboSpan" id="kobo.1736.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1737.1">'deepskyblue'</span></span><span class="koboSpan" id="kobo.1738.1">)
  })
})
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1739.1">If you kept Vitest running in </span><a id="_idIndexMarker623"/><span class="koboSpan" id="kobo.1740.1">watch mode, you should see it successfully executing the test we just wrote! </span><span class="koboSpan" id="kobo.1740.2">If not, start Vitest again by executing the following command:
        </span><pre class="programlisting con-one"><code class="hljs-con"><span class="koboSpan" id="kobo.1741.1">$ npm test
</span></code></pre>
</li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.1742.1">The following image shows how Vitest automatically executes our newly defined test in watch mode:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1743.1"><img alt="Figure 12.2 – Vitest automatically executing our newly defined test" src="../Images/B31327_12_02.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1744.1">Figure 12.2 – Vitest automatically executing our newly defined test</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1745.1">Now that we have successfully</span><a id="_idIndexMarker624"/><span class="koboSpan" id="kobo.1746.1"> written a test for the Theme Hook, let’s move on</span><a id="_idIndexMarker625"/><span class="koboSpan" id="kobo.1747.1"> to the slightly more complex User Hook.</span></p>
<h2 class="heading-2" id="_idParaDest-270"><a id="_idTextAnchor314"/><span class="koboSpan" id="kobo.1748.1">Testing the User Hook</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1749.1">The User Hook internally uses a Local Storage</span><a id="_idIndexMarker626"/><span class="koboSpan" id="kobo.1750.1"> Hook now. </span><span class="koboSpan" id="kobo.1750.2">Thankfully, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1751.1">jsdom</span></code><span class="koboSpan" id="kobo.1752.1"> environment handles mocking the LocalStorage API for us already, so we do not need to do any</span><a id="_idIndexMarker627"/><span class="koboSpan" id="kobo.1753.1"> setup for that.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1754.1">Let’s get started writing tests for the User Hook now:</span></p>
<ol>
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1755.1">Create a new </span><code class="inlineCode"><span class="koboSpan" id="kobo.1756.1">src/hooks/user.test.js</span></code><span class="koboSpan" id="kobo.1757.1"> file.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1758.1">Inside it, import the relevant functions from V</span><a id="_idTextAnchor315"/><span class="koboSpan" id="kobo.1759.1">itest, as well as the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1760.1">renderHook</span></code><span class="koboSpan" id="kobo.1761.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1762.1">act</span></code><span class="koboSpan" id="kobo.1763.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1764.1">useUser</span></code><span class="koboSpan" id="kobo.1765.1"> functions:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1766.1">import</span></span><span class="koboSpan" id="kobo.1767.1"> { describe, test, expect } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1768.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1769.1">'vitest'</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1770.1">import</span></span><span class="koboSpan" id="kobo.1771.1"> { renderHook, act } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1772.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1773.1">'@testing-library/react'</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1774.1">import</span></span><span class="koboSpan" id="kobo.1775.1"> { useUser } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1776.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1777.1">'./user.js'</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1778.1">Then, define a test group for the User Hook:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.1779.1">describe</span></span><span class="koboSpan" id="kobo.1780.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1781.1">'User Hook'</span></span><span class="koboSpan" id="kobo.1782.1">, {}, </span><span class="hljs-function"><span class="koboSpan" id="kobo.1783.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1784.1"> {
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1785.1">For our first test, we ensure that the user is not logged in by default:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-title"><span class="koboSpan" id="kobo.1786.1">test</span></span><span class="koboSpan" id="kobo.1787.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1788.1">'should not be logged in by default'</span></span><span class="koboSpan" id="kobo.1789.1">, {}, </span><span class="hljs-function"><span class="koboSpan" id="kobo.1790.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1791.1"> {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1792.1">const</span></span><span class="koboSpan" id="kobo.1793.1"> { result } = </span><span class="hljs-title"><span class="koboSpan" id="kobo.1794.1">renderHook</span></span><span class="koboSpan" id="kobo.1795.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.1796.1">() =&gt;</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1797.1">useUser</span></span><span class="koboSpan" id="kobo.1798.1">())
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1799.1">expect</span></span><span class="koboSpan" id="kobo.1800.1">(result.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1801.1">current</span></span><span class="koboSpan" id="kobo.1802.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1803.1">isLoggedIn</span></span><span class="koboSpan" id="kobo.1804.1">).</span><span class="hljs-title"><span class="koboSpan" id="kobo.1805.1">toBe</span></span><span class="koboSpan" id="kobo.1806.1">(</span><span class="hljs-literal"><span class="koboSpan" id="kobo.1807.1">false</span></span><span class="koboSpan" id="kobo.1808.1">)
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1809.1">expect</span></span><span class="koboSpan" id="kobo.1810.1">(result.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1811.1">current</span></span><span class="koboSpan" id="kobo.1812.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1813.1">username</span></span><span class="koboSpan" id="kobo.1814.1">).</span><span class="hljs-title"><span class="koboSpan" id="kobo.1815.1">toBe</span></span><span class="koboSpan" id="kobo.1816.1">(</span><span class="hljs-literal"><span class="koboSpan" id="kobo.1817.1">null</span></span><span class="koboSpan" id="kobo.1818.1">)
  })
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1819.1">Then, we test the</span><a id="_idIndexMarker628"/><span class="koboSpan" id="kobo.1820.1"> registration functionality:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-title"><span class="koboSpan" id="kobo.1821.1">test</span></span><span class="koboSpan" id="kobo.1822.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1823.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1824.1">should be logged in after registering'</span></span><span class="koboSpan" id="kobo.1825.1">, {}, </span><span class="hljs-function"><span class="koboSpan" id="kobo.1826.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1827.1"> {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1828.1">const</span></span><span class="koboSpan" id="kobo.1829.1"> { result } = </span><span class="hljs-title"><span class="koboSpan" id="kobo.1830.1">renderHook</span></span><span class="koboSpan" id="kobo.1831.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.1832.1">() =&gt;</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1833.1">useUser</span></span><span class="koboSpan" id="kobo.1834.1">())
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1835.1">act</span></span><span class="koboSpan" id="kobo.1836.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.1837.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1838.1"> result.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1839.1">current</span></span><span class="koboSpan" id="kobo.1840.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1841.1">register</span></span><span class="koboSpan" id="kobo.1842.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1843.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1844.1">testuser'</span></span><span class="koboSpan" id="kobo.1845.1">))
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1846.1">expect</span></span><span class="koboSpan" id="kobo.1847.1">(result.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1848.1">current</span></span><span class="koboSpan" id="kobo.1849.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1850.1">isLoggedIn</span></span><span class="koboSpan" id="kobo.1851.1">).</span><span class="hljs-title"><span class="koboSpan" id="kobo.1852.1">toBe</span></span><span class="koboSpan" id="kobo.1853.1">(</span><span class="hljs-literal"><span class="koboSpan" id="kobo.1854.1">true</span></span><span class="koboSpan" id="kobo.1855.1">)
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1856.1">expect</span></span><span class="koboSpan" id="kobo.1857.1">(result.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1858.1">current</span></span><span class="koboSpan" id="kobo.1859.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1860.1">username</span></span><span class="koboSpan" id="kobo.1861.1">).</span><span class="hljs-title"><span class="koboSpan" id="kobo.1862.1">toBe</span></span><span class="koboSpan" id="kobo.1863.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1864.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1865.1">testuser'</span></span><span class="koboSpan" id="kobo.1866.1">)
  })
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1867.1">Next, we test the</span><a id="_idIndexMarker629"/><span class="koboSpan" id="kobo.1868.1"> login functionality:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-title"><span class="koboSpan" id="kobo.1869.1">test</span></span><span class="koboSpan" id="kobo.1870.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1871.1">'should be logged in after logging in'</span></span><span class="koboSpan" id="kobo.1872.1">, {}, </span><span class="hljs-function"><span class="koboSpan" id="kobo.1873.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1874.1"> {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1875.1">const</span></span><span class="koboSpan" id="kobo.1876.1"> { result } = </span><span class="hljs-title"><span class="koboSpan" id="kobo.1877.1">renderHook</span></span><span class="koboSpan" id="kobo.1878.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.1879.1">() =&gt;</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1880.1">useUser</span></span><span class="koboSpan" id="kobo.1881.1">())
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1882.1">act</span></span><span class="koboSpan" id="kobo.1883.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.1884.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1885.1"> result.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1886.1">current</span></span><span class="koboSpan" id="kobo.1887.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1888.1">login</span></span><span class="koboSpan" id="kobo.1889.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1890.1">'testuser'</span></span><span class="koboSpan" id="kobo.1891.1">))
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1892.1">expect</span></span><span class="koboSpan" id="kobo.1893.1">(result.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1894.1">current</span></span><span class="koboSpan" id="kobo.1895.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1896.1">isLoggedIn</span></span><span class="koboSpan" id="kobo.1897.1">).</span><span class="hljs-title"><span class="koboSpan" id="kobo.1898.1">toBe</span></span><span class="koboSpan" id="kobo.1899.1">(</span><span class="hljs-literal"><span class="koboSpan" id="kobo.1900.1">true</span></span><span class="koboSpan" id="kobo.1901.1">)
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1902.1">expect</span></span><span class="koboSpan" id="kobo.1903.1">(result.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1904.1">current</span></span><span class="koboSpan" id="kobo.1905.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1906.1">username</span></span><span class="koboSpan" id="kobo.1907.1">).</span><span class="hljs-title"><span class="koboSpan" id="kobo.1908.1">toBe</span></span><span class="koboSpan" id="kobo.1909.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1910.1">'testuser'</span></span><span class="koboSpan" id="kobo.1911.1">)
  })
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1912.1">For the final test, we make two actions, calling login first, then logout, and then we check if the user is logged out:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-title"><span class="koboSpan" id="kobo.1913.1">test</span></span><span class="koboSpan" id="kobo.1914.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1915.1">'should be logged out after logout'</span></span><span class="koboSpan" id="kobo.1916.1">, {}, </span><span class="hljs-function"><span class="koboSpan" id="kobo.1917.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1918.1"> {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1919.1">const</span></span><span class="koboSpan" id="kobo.1920.1"> { result } = </span><span class="hljs-title"><span class="koboSpan" id="kobo.1921.1">renderHook</span></span><span class="koboSpan" id="kobo.1922.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.1923.1">() =&gt;</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1924.1">useUser</span></span><span class="koboSpan" id="kobo.1925.1">())
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1926.1">act</span></span><span class="koboSpan" id="kobo.1927.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.1928.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1929.1"> result.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1930.1">current</span></span><span class="koboSpan" id="kobo.1931.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1932.1">login</span></span><span class="koboSpan" id="kobo.1933.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1934.1">'testuser'</span></span><span class="koboSpan" id="kobo.1935.1">))
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1936.1">act</span></span><span class="koboSpan" id="kobo.1937.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.1938.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1939.1"> result.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1940.1">current</span></span><span class="koboSpan" id="kobo.1941.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1942.1">logout</span></span><span class="koboSpan" id="kobo.1943.1">())
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1944.1">expect</span></span><span class="koboSpan" id="kobo.1945.1">(result.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1946.1">current</span></span><span class="koboSpan" id="kobo.1947.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1948.1">isLoggedIn</span></span><span class="koboSpan" id="kobo.1949.1">).</span><span class="hljs-title"><span class="koboSpan" id="kobo.1950.1">toBe</span></span><span class="koboSpan" id="kobo.1951.1">(</span><span class="hljs-literal"><span class="koboSpan" id="kobo.1952.1">false</span></span><span class="koboSpan" id="kobo.1953.1">)
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1954.1">expect</span></span><span class="koboSpan" id="kobo.1955.1">(result.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1956.1">current</span></span><span class="koboSpan" id="kobo.1957.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1958.1">username</span></span><span class="koboSpan" id="kobo.1959.1">).</span><span class="hljs-title"><span class="koboSpan" id="kobo.1960.1">toBe</span></span><span class="koboSpan" id="kobo.1961.1">(</span><span class="hljs-literal"><span class="koboSpan" id="kobo.1962.1">null</span></span><span class="koboSpan" id="kobo.1963.1">)
  })
})
</span></code></pre>
</li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.1964.1">You will see that </span><a id="_idIndexMarker630"/><span class="koboSpan" id="kobo.1965.1">Vitest executed all our tests and they are all passing! </span><span class="koboSpan" id="kobo.1965.2">Now, let’s </span><a id="_idIndexMarker631"/><span class="koboSpan" id="kobo.1966.1">move on to the Debounced History State Hook.</span></p>
<h2 class="heading-2" id="_idParaDest-271"><a id="_idTextAnchor316"/><span class="koboSpan" id="kobo.1967.1">Testing asynchronous Hooks</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1968.1">Sometimes we need to</span><a id="_idIndexMarker632"/><span class="koboSpan" id="kobo.1969.1"> test Hooks that perform asynchronous actions. </span><span class="koboSpan" id="kobo.1969.2">This means that we need to wait a certain amount of time until we check the result.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1970.1">To write tests for these kind of Hooks, we can use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1971.1">waitFor</span></code><span class="koboSpan" id="kobo.1972.1"> function from the React Testing Library. </span><span class="koboSpan" id="kobo.1972.2">This function</span><a id="_idIndexMarker633"/><span class="koboSpan" id="kobo.1973.1"> can be used to wait for the condition to be met, instead of trying to match it immediately. </span><span class="koboSpan" id="kobo.1973.2">It can thus be used to test asynchronous operations in React components and Hooks. </span><span class="koboSpan" id="kobo.1973.3">If the condition fails to match even after a certain amount of time (which can be specified with an optional timeout parameter), the test will fail.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1974.1">Earlier in this chapter, we created the Debounced History State Hook, which only stores changes in the history after a certain amount of time, thus making it an asynchronous Hook. </span><span class="koboSpan" id="kobo.1974.2">We are now going to use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1975.1">waitFor</span></code><span class="koboSpan" id="kobo.1976.1"> function to test the debouncing in the Debounced History Sta</span><a id="_idTextAnchor317"/><span class="koboSpan" id="kobo.1977.1">te Hook.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1978.1">Follow these steps to get started:</span></p>
<ol>
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1979.1">Create a new </span><code class="inlineCode"><span class="koboSpan" id="kobo.1980.1">src/hooks/debouncedHistoryState.test.js</span></code><span class="koboSpan" id="kobo.1981.1"> file.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1982.1">Inside it, import the relevant functions from Vitest, as well as the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1983.1">renderHook</span></code><span class="koboSpan" id="kobo.1984.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1985.1">act</span></code><span class="koboSpan" id="kobo.1986.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1987.1">waitFor</span></code><span class="koboSpan" id="kobo.1988.1"> functions from the React </span><a id="_idTextAnchor318"/><span class="koboSpan" id="kobo.1989.1">Testing Library, as well as the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1990.1">useDebouncedHistoryState</span></code><span class="koboSpan" id="kobo.1991.1"> function:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1992.1">import</span></span><span class="koboSpan" id="kobo.1993.1"> { describe, test, expect } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1994.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1995.1">'vitest'</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1996.1">import</span></span><span class="koboSpan" id="kobo.1997.1"> { renderHook, act, waitFor } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1998.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1999.1">'@testing-library/react'</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2000.1">import</span></span><span class="koboSpan" id="kobo.2001.1"> { useDebouncedHistoryState } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2002.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2003.1">'./debouncedHistoryState.js'</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2004.1">Define a test</span><a id="_idIndexMarker634"/><span class="koboSpan" id="kobo.2005.1"> group and a first test, which just checks the initial value:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.2006.1">describe</span></span><span class="koboSpan" id="kobo.2007.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2008.1">'Debounced History State Hook'</span></span><span class="koboSpan" id="kobo.2009.1">, {}, </span><span class="hljs-function"><span class="koboSpan" id="kobo.2010.1">() =&gt;</span></span><span class="koboSpan" id="kobo.2011.1"> {
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.2012.1">test</span></span><span class="koboSpan" id="kobo.2013.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2014.1">'should return initial state as content'</span></span><span class="koboSpan" id="kobo.2015.1">, {}, </span><span class="hljs-function"><span class="koboSpan" id="kobo.2016.1">() =&gt;</span></span><span class="koboSpan" id="kobo.2017.1"> {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2018.1">const</span></span><span class="koboSpan" id="kobo.2019.1"> { result } = </span><span class="hljs-title"><span class="koboSpan" id="kobo.2020.1">renderHook</span></span><span class="koboSpan" id="kobo.2021.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.2022.1">() =&gt;</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2023.1">useDebouncedHistoryState</span></span><span class="koboSpan" id="kobo.2024.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2025.1">''</span></span><span class="koboSpan" id="kobo.2026.1">, </span><span class="hljs-number"><span class="koboSpan" id="kobo.2027.1">10</span></span><span class="koboSpan" id="kobo.2028.1">))
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.2029.1">expect</span></span><span class="koboSpan" id="kobo.2030.1">(result.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2031.1">current</span></span><span class="koboSpan" id="kobo.2032.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2033.1">content</span></span><span class="koboSpan" id="kobo.2034.1">).</span><span class="hljs-title"><span class="koboSpan" id="kobo.2035.1">toBe</span></span><span class="koboSpan" id="kobo.2036.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2037.1">''</span></span><span class="koboSpan" id="kobo.2038.1">)
  })
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2039.1">Now, we define </span><a id="_idIndexMarker635"/><span class="koboSpan" id="kobo.2040.1">a test that checks if the content is updated immediately:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-title"><span class="koboSpan" id="kobo.2041.1">test</span></span><span class="koboSpan" id="kobo.2042.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2043.1">'should update content immediately'</span></span><span class="koboSpan" id="kobo.2044.1">, {}, </span><span class="hljs-function"><span class="koboSpan" id="kobo.2045.1">() =&gt;</span></span><span class="koboSpan" id="kobo.2046.1"> {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2047.1">const</span></span><span class="koboSpan" id="kobo.2048.1"> { result } = </span><span class="hljs-title"><span class="koboSpan" id="kobo.2049.1">renderHook</span></span><span class="koboSpan" id="kobo.2050.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.2051.1">() =&gt;</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2052.1">useDebouncedHistoryState</span></span><span class="koboSpan" id="kobo.2053.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2054.1">''</span></span><span class="koboSpan" id="kobo.2055.1">,
</span><span class="hljs-keyword"><a id="_idTextAnchor319"/> </span><span class="hljs-number"><span class="koboSpan" id="kobo.2056.1">10</span></span><span class="koboSpan" id="kobo.2057.1">))
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.2058.1">act</span></span><span class="koboSpan" id="kobo.2059.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.2060.1">() =&gt;</span></span><span class="koboSpan" id="kobo.2061.1">
      result.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2062.1">current</span></span><span class="koboSpan" id="kobo.2063.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2064.1">handleContentChange</span></span><span class="koboSpan" id="kobo.2065.1">({ </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2066.1">target</span></span><span class="koboSpan" id="kobo.2067.1">: {
         </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2068.1">value</span></span><span class="koboSpan" id="kobo.2069.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.2070.1">'new content'</span></span><span class="koboSpan" id="kobo.2071.1"> } }),
    )
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.2072.1">expect</span></span><span class="koboSpan" id="kobo.2073.1">(result.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2074.1">current</span></span><span class="koboSpan" id="kobo.2075.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2076.1">content</span></span><span class="koboSpan" id="kobo.2077.1">).</span><span class="hljs-title"><span class="koboSpan" id="kobo.2078.1">toBe</span></span><span class="koboSpan" id="kobo.2079.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2080.1">'new content'</span></span><span class="koboSpan" id="kobo.2081.1">)
  })
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2082.1">For the final test, we check if the Hook updates the history only after a debounce:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-title"><span class="koboSpan" id="kobo.2083.1">test</span></span><span class="koboSpan" id="kobo.2084.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2085.1">'should only update history state after debounce'</span></span><span class="koboSpan" id="kobo.2086.1">, {},
</span><span class="hljs-title"> </span> <span class="hljs-title"><span class="koboSpan" id="kobo.2087.1">async</span></span><span class="koboSpan" id="kobo.2088.1"> () =&gt; {
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2089.1">In this test, we first </span><a id="_idIndexMarker636"/><span class="koboSpan" id="kobo.2090.1">define the Hook:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2091.1">const</span></span><span class="koboSpan" id="kobo.2092.1"> { result } = </span><span class="hljs-title"><span class="koboSpan" id="kobo.2093.1">renderHook</span></span><span class="koboSpan" id="kobo.2094.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.2095.1">() =&gt;</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2096.1">useDebouncedHistoryState</span></span><span class="koboSpan" id="kobo.2097.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2098.1">''</span></span><span class="koboSpan" id="kobo.2099.1">,
</span><span class="hljs-keyword"> </span><span class="hljs-number"><span class="koboSpan" id="kobo.2100.1">10</span></span><span class="koboSpan" id="kobo.2101.1">))
</span></code></pre>
</li>
</ol>
<p class="normal-one"><span class="koboSpan" id="kobo.2102.1">We kept the debounce timeout as 10ms to avoid unnecessarily slowing down our test.</span></p>
<ol>
<li class="numberedList" value="7"><span class="koboSpan" id="kobo.2103.1">Now, we trigger a content update:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-title"><span class="koboSpan" id="kobo.2104.1">act</span></span><span class="koboSpan" id="kobo.2105.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.2106.1">() =&gt;</span></span><span class="koboSpan" id="kobo.2107.1">
      result.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2108.1">current</span></span><span class="koboSpan" id="kobo.2109.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2110.1">handleContentChange</span></span><span class="koboSpan" id="kobo.2111.1">({ </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2112.1">target</span></span><span class="koboSpan" id="kobo.2113.1">: {
        </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2114.1">value</span></span><span class="koboSpan" id="kobo.2115.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.2116.1">'new content'</span></span><span class="koboSpan" id="kobo.2117.1"> } }),
    )
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2118.1">Before debouncing, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2119.1">canUndo</span></code><span class="koboSpan" id="kobo.2120.1"> value</span><a id="_idIndexMarker637"/><span class="koboSpan" id="kobo.2121.1"> should be </span><code class="inlineCode"><span class="koboSpan" id="kobo.2122.1">false</span></code><span class="koboSpan" id="kobo.2123.1">, as there is nothing stored in the history state yet:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-title"><span class="koboSpan" id="kobo.2124.1">expect</span></span><span class="koboSpan" id="kobo.2125.1">(result.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2126.1">current</span></span><span class="koboSpan" id="kobo.2127.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2128.1">canUndo</span></span><span class="koboSpan" id="kobo.2129.1">).</span><span class="hljs-title"><span class="koboSpan" id="kobo.2130.1">toBe</span></span><span class="koboSpan" id="kobo.2131.1">(</span><span class="hljs-literal"><span class="koboSpan" id="kobo.2132.1">false</span></span><span class="koboSpan" id="kobo.2133.1">)
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2134.1">Now we use </span><code class="inlineCode"><span class="koboSpan" id="kobo.2135.1">waitFor</span></code><span class="koboSpan" id="kobo.2136.1"> to wait for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2137.1">canUndo</span></code><span class="koboSpan" id="kobo.2138.1"> value to be true, which should happen after the debounce timeout (10ms):
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2139.1">await</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2140.1">waitFor</span></span><span class="koboSpan" id="kobo.2141.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.2142.1">() =&gt;</span></span><span class="koboSpan" id="kobo.2143.1"> {
      </span><span class="hljs-title"><span class="koboSpan" id="kobo.2144.1">expect</span></span><span class="koboSpan" id="kobo.2145.1">(result.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2146.1">current</span></span><span class="koboSpan" id="kobo.2147.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2148.1">canUndo</span></span><span class="koboSpan" id="kobo.2149.1">).</span><span class="hljs-title"><span class="koboSpan" id="kobo.2150.1">toBe</span></span><span class="koboSpan" id="kobo.2151.1">(</span><span class="hljs-literal"><span class="koboSpan" id="kobo.2152.1">true</span></span><span class="koboSpan" id="kobo.2153.1">)
    })
  })
})
</span></code></pre>
</li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.2154.1">Vitest will automatically run our new tests and we can see that they all succeed!</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.2155.1">In this case, we have a very simple timeout. </span><span class="koboSpan" id="kobo.2155.2">However, there may be more advanced cases where we have to wait for a longer time. </span><span class="koboSpan" id="kobo.2155.3">For more control over dates and timers when testing Hooks, you can mock the system time using fake timers in Vitest. </span><span class="koboSpan" id="kobo.2155.4">Check out the mocking guide on the official Vitest docs for more information: </span><a href="https://vitest.dev/guide/mocking.html#dates"><span class="url"><span class="koboSpan" id="kobo.2156.1">https://vitest.dev/guide/mocking.html#dates</span></span></a></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.2157.1">We are not testing the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2158.1">undo</span></code><span class="koboSpan" id="kobo.2159.1">/</span><code class="inlineCode"><span class="koboSpan" id="kobo.2160.1">redo</span></code><span class="koboSpan" id="kobo.2161.1">/</span><code class="inlineCode"><span class="koboSpan" id="kobo.2162.1">clear</span></code><span class="koboSpan" id="kobo.2163.1"> functionality, because those come from the History State Hook from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2164.1">useHooks</span></code><span class="koboSpan" id="kobo.2165.1"> library, so it is out of scope for our custom Hook. </span><span class="koboSpan" id="kobo.2165.2">In most cases, it is enough to only test the logic that we added in our own implementation.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2166.1">Since the API Hooks are mostly </span><a id="_idIndexMarker638"/><span class="koboSpan" id="kobo.2167.1">wrappers for TanStack Query</span><a id="_idIndexMarker639"/><span class="koboSpan" id="kobo.2168.1"> Hooks and do not add their own logic, it also does not make much sense to write tests for them.</span></p>
<h2 class="heading-2" id="_idParaDest-272"><a id="_idTextAnchor320"/><span class="koboSpan" id="kobo.2169.1">Running all tests</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2170.1">To verify that all our tests </span><a id="_idIndexMarker640"/><span class="koboSpan" id="kobo.2171.1">are succeeding now, let’s quit the Vitest watch mode by pressing the </span><em class="italic"><span class="koboSpan" id="kobo.2172.1">q</span></em><span class="koboSpan" id="kobo.2173.1"> key. </span><span class="koboSpan" id="kobo.2173.2">Then, run Vitest again by executing the following command:</span></p>
<pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2174.1">$ npm test
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2175.1">As we can see, Vitest executed all our tests again, and they are all passing:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2176.1"><img alt="Figure 12.3 – All our tests are passing!" src="../Images/B31327_12_03.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2177.1">Figure 12.3 – All our tests are passing!</span></p>
<div class="note">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.2178.1">Example code</span></strong></p>
<p class="normal"><span class="koboSpan" id="kobo.2179.1">The example code for this section can be found in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2180.1">Chapter12/Chapter12_5</span></code><span class="koboSpan" id="kobo.2181.1"> folder. </span><span class="koboSpan" id="kobo.2181.2">Check the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2182.1">README.md</span></code><span class="koboSpan" id="kobo.2183.1"> file inside the</span><a id="_idIndexMarker641"/><span class="koboSpan" id="kobo.2184.1"> folder for instructions on how to set up and run the example.</span></p>
</div>
<h1 class="heading-1" id="_idParaDest-273"><a id="_idTextAnchor321"/><span class="koboSpan" id="kobo.2185.1">Summary</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.2186.1">In this chapter, we first learned how to extract custom Hooks from existing code in our blog app. </span><span class="koboSpan" id="kobo.2186.2">We defined the Theme Hook to easily access the context, then we defined the User Hook, which manages user state and provides functions to register/login/logout. </span><span class="koboSpan" id="kobo.2186.3">Then, we created API Hooks and a more advanced Hook for the debounced history state functionality. </span><span class="koboSpan" id="kobo.2186.4">Finally, we learned about writing tests for our custom Hooks using Vitest and the React Testing Library.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2187.1">Knowing when and how to extract custom Hooks is a very important skill in React development. </span><span class="koboSpan" id="kobo.2187.2">In a larger project, you are probably going to define many custom Hooks, specifically tailored to your project’s needs. </span><span class="koboSpan" id="kobo.2187.3">Custom Hooks can also make it easier to maintain the application, as we only need to adjust functionality in one place. </span><span class="koboSpan" id="kobo.2187.4">Testing custom Hooks is very important, because if we refactor our custom Hooks later on, we want to make sure that they still work properly.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2188.1">In the next chapter, we are going to learn how to migrate from class components to a Hook-based system. </span><span class="koboSpan" id="kobo.2188.2">We first create a small project using class components and then we replace them with Hooks, taking a closer look at the differences between the two solutions.</span></p>
<h1 class="heading-1" id="_idParaDest-274"><a id="_idTextAnchor322"/><span class="koboSpan" id="kobo.2189.1">Questions</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.2190.1">To recap what we have learned in this chapter, try to answer the following questions:</span></p>
<ol>
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.2191.1">How can we extract a custom Hook from existing code?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2192.1">What is the advantage of creating custom Hooks?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2193.1">When should we extract functionality into a custom Hook?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2194.1">How do we use custom Hooks?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2195.1">Which library can we use to test custom Hooks?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2196.1">How are actions performed by Hooks tested?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2197.1">How can we test Hooks that make use of React Context?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2198.1">How can we test Hooks that perform asynchronous operations?</span></li>
</ol>
<h1 class="heading-1" id="_idParaDest-275"><a id="_idTextAnchor323"/><span class="koboSpan" id="kobo.2199.1">Further reading</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.2200.1">If you are interested in more information about the concepts that we have learned in this chapter, take a look at the following link</span><a id="_idTextAnchor324"/><span class="koboSpan" id="kobo.2201.1">s:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.2202.1">Guide on “Reusing Logic with Custom Hooks” in the official React docs: </span><a href="https://react.dev/learn/reusing-logic-with-custom-hooks"><span class="url"><span class="koboSpan" id="kobo.2203.1">https://react.dev/learn/reusing-logic-with-custom-hooks</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2204.1">Vitest documentation: </span><a href="https://vitest.dev/ "><span class="url"><span class="koboSpan" id="kobo.2205.1">https://vitest.dev/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2206.1">React Testing Library documentation: </span><a href="https://testing-library.com/docs/react-testing-library/intro/"><span class="url"><span class="koboSpan" id="kobo.2207.1">https://testing-library.com/docs/react-testing-library/intro/</span></span></a></li>
</ul>
<h1 class="heading-1"><span class="koboSpan" id="kobo.2208.1">Learn more on Discord</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.2209.1">To join the Discord community for this book – where you can share feedback, ask questions to the author, and learn about new releases – follow the QR code below:</span></p>
<p class="normal"><a href="Chapter_12.xhtml"><span class="url"><span class="koboSpan" id="kobo.2210.1">https://packt.link/wnXT0</span></span></a></p>
<p class="normal"><span class="koboSpan" id="kobo.2211.1"><img alt="" src="../Images/image_%283%29.png"/></span></p>
</div>
</body></html>