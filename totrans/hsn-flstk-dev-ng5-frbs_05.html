<html><head></head><body>
        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Creating a User Profile Page</h1>
                
            
            <article>
                
<p class="calibre2">In this chapter, we will write a user profile component. We will cover <strong class="calibre1">RxJS</strong> (<strong class="calibre1">ReactiveX</strong>), which is a popular library for asynchronous programming. In this section, we will use the <kbd class="calibre11">Observable</kbd> of RxJS to pass the domain model from the component of the authentication module to the component of the user module. We will use this passed user model to populate the user profile component. We will edit the user data and update the Firebase authentication and database. As a part of edit, we will implement a reusable edit component, which uses bootstrap modal for taking user input. Finally, we will see the Firebase session token's life cycle when the password is changed.</p>
<p class="calibre2">In this chapter, <span>we will cover the following topics</span>:</p>
<ul class="calibre7">
<li class="calibre8">Introduction to RxJS</li>
<li class="calibre8">Passing data between module components</li>
<li class="calibre8">Introduction to SASS</li>
<li class="calibre8">Creating a user profile component</li>
<li class="calibre8">Enhancing services for the update operation</li>
<li class="calibre8">Creating an edit dialog component</li>
<li class="calibre8">Firebase session for the update operation</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Introduction to RxJS</h1>
                
            
            <article>
                
<p class="calibre2">RxJS is a popular library for asynchronous and event-based programming. In this section, we will cover only the basics about this library so that you understand the real reason for using this library. For more details, you can refer to the official site of<span> RxJS at</span> <a href="http://reactivex.io/rxjs/" target="_blank" class="calibre10">http://reactivex.io/rxjs/</a>.</p>
<p class="calibre2">Here are a few of this library's key terms:</p>
<ul class="calibre7">
<li class="calibre8"><kbd class="calibre11">observable</kbd>: This is a collection of values or events that can be consumed. For example, <kbd class="calibre11">observable</kbd> could be a collection of an array of numbers:</li>
</ul>
<pre class="calibre18"><span>let observable </span><span>=</span><span> </span><span>Rx</span><span>.</span><span>Observable</span><span>.</span><span>from</span><span>([</span><span>1</span><span>,</span><span> </span><span>2</span><span>,</span><span> </span><span>3</span><span>]);</span></pre>
<ul class="calibre7">
<li class="calibre8">
<p class="calibre9"><kbd class="calibre11">subscription</kbd>: To read data from the <kbd class="calibre11">observable</kbd>, we subscribe and then the event or values are delivered using observer: </p>
</li>
</ul>
<pre class="calibre18"><span>let subscription </span><span>=</span><span> observable</span><span>.</span><span>subscribe</span><span>(</span><span>x </span><span>=&gt;</span><span> console</span><span>.</span><span>log</span><span>(</span><span>x</span><span>));</span></pre>
<ul class="calibre7">
<li class="calibre8">
<p class="calibre9"><kbd class="calibre11">subject</kbd>: This is an extension of the observable and is used to broadcast events or values to multiple observers. This example will be covered in our application's use case. <span>This is a very basic understanding of the RxJS library.</span></p>
</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Passing data between module components</h1>
                
            
            <article>
                
<p class="calibre2">We have completed our authentication module in the preceding chapter. In this section, we will cover passing data between module components, which is an important part of our application development. While implementing a web application, we always face the problem of how to pass data from one component module to another component module. Our initial thought will be to store the model in a common application class, such as a singleton class, and then retrieve it in other components. Angular provides many ways to pass the data, and we have already touched upon Angular binding. This method is useful when we have components with a parent-child relationship in the same module.</p>
<div class="packt_infobox"><span class="calibre20">Singleton class is a software design pattern that restricts the instantiation of class to one object. This single object is available to all the components of the application.</span></div>
<p class="calibre2">We use <kbd class="calibre11">subject</kbd> of the RxJS library in the <kbd class="calibre11">service</kbd> class t<span>o pass the data to the component of the different module. This design helps to</span> create an independent module.</p>
<p class="calibre2">Perform the following steps to pass the data from authentication module to user module:</p>
<ol class="calibre13">
<li class="calibre8" value="1"><strong class="calibre1">Store user model</strong>: The first step is to store the data using <kbd class="calibre11">subject</kbd> in the <kbd class="calibre11">service</kbd> class. We store the user model in the user service. We use <kbd class="calibre11">BehaviorSubject</kbd>, which is an extension of the <kbd class="calibre11">subject</kbd> class to store the user model.</li>
</ol>
<div class="packt_infobox"><br class="calibre44"/>
The behavior subject of RxJS emits the latest data to the subscriber. </div>
<p class="mce-root">We declare the <kbd class="calibre11">BehaviorSubject</kbd> variable in our user service, as shown in the following code snippet; the initial value is declared as <kbd class="calibre11">null</kbd>, and this will be populated with the latest user model: </p>
<pre class="calibre18"><span>private </span><span>subject</span>: BehaviorSubject&lt;User&gt; = <span>new </span>BehaviorSubject(<span>null</span>);</pre>
<p class="mce-root">We save the user model in <kbd class="calibre11">subject</kbd>. We call this method from the Login and Sign up component:</p>
<pre class="calibre18"><span>public </span><span>saveUser</span>(user: User){<br class="title-page-name"/>    <span>this</span>.<span>subject</span>.<span>next</span>(user);<br class="title-page-name"/>}</pre>
<ol start="2" class="calibre13">
<li value="2" class="calibre8"><strong class="calibre1">Create method in service class</strong>: We can create <kbd class="calibre11">getSavedUser()</kbd> in the <kbd class="calibre11">UserService</kbd> class. This method returns the <kbd class="calibre11">subject</kbd>, and the caller needs to subscribe or use the <kbd class="calibre11">getValue()</kbd> method to retrieve the saved <kbd class="calibre11">User</kbd> object:</li>
</ol>
<pre class="calibre18"><span>public </span><span>getSavedUser</span>(): BehaviorSubject&lt;User&gt;{<br class="title-page-name"/>    <span>return this</span>.<span>subject</span>;<br class="title-page-name"/>}</pre>
<ol start="3" class="calibre13">
<li class="calibre8" value="3"><strong class="calibre1">Retrieve user model in component class</strong>: We can retrieve the value from the <kbd class="calibre11">subject</kbd> using the <kbd class="calibre11">getValue()</kbd> method. You can also subscribe and retrieve the user model:</li>
</ol>
<pre class="calibre18"><span>ngOnInit</span>() {<br class="title-page-name"/>    <span>this</span>.<span>user </span>= <span>this</span>.userService.<span>getSavedUser</span>().<span>getValue</span>();<br class="title-page-name"/>}</pre>
<p class="mce-root"><span>Here's the complete <kbd class="calibre11">user.service.ts</kbd> </span><span>as of now:</span></p>
<pre class="calibre18"><span>import </span>{Injectable} <span>from </span><span>'@angular/core'</span>;<br class="title-page-name"/><span>import </span>{AngularFireDatabase} <span>from </span><span>'angularfire2/database'</span>;<br class="title-page-name"/><span>import </span>{User} <span>from </span><span>'./user'</span>;<br class="title-page-name"/><span>import </span>{<span>USERS_CHILD</span>} <span>from </span><span>'./database-constants'</span>;<br class="title-page-name"/><span>import </span>{Observable} <span>from </span><span>'rxjs/Observable'</span>;<br class="title-page-name"/><span>import </span>{BehaviorSubject} <span>from </span><span>'rxjs/BehaviorSubject'</span>;<br class="title-page-name"/><br class="title-page-name"/><span>/**<br class="title-page-name"/></span><span> * User service<br class="title-page-name"/></span><span> *<br class="title-page-name"/></span><span> */<br class="title-page-name"/></span>@<span>Injectable</span>()<br class="title-page-name"/><span>export class </span>UserService {<br class="title-page-name"/><br class="title-page-name"/>  <span>private </span><span>subject</span>: BehaviorSubject&lt;User&gt; = <span>new <br class="title-page-name"/></span>  BehaviorSubject(<span>null</span>);<br class="title-page-name"/><br class="title-page-name"/>  <span>/**<br class="title-page-name"/></span><span>   * Constructor<br class="title-page-name"/></span><span>   *<br class="title-page-name"/></span><span>   * </span><span>@param </span><span>{AngularFireDatabase} fireDb provides the functionality <br class="title-page-name"/>   for Firebase Database<br class="title-page-name"/></span><span>   */<br class="title-page-name"/></span><span>   </span><span>constructor</span>(<span>private </span>fireDb: AngularFireDatabase) {<br class="title-page-name"/>  }<br class="title-page-name"/><br class="title-page-name"/>  <span>public </span><span>addUser</span>(user: User): <span>void </span>{<br class="title-page-name"/>    <span>this</span>.fireDb.<span>object</span>(<span>`</span>${<span>USERS_CHILD</span>}<span>/</span>${user.<span>uid</span>}<span>`</span>).<span>set</span>(user);<br class="title-page-name"/>    <span>this</span>.<span>saveUser</span>(user);<br class="title-page-name"/>  }<br class="title-page-name"/><br class="title-page-name"/>  <span>public </span><span>getUser</span>(uid: <span>string</span>): Observable&lt;User&gt; {<br class="title-page-name"/>    <span>return this</span>.fireDb.<span>object</span>&lt;User&gt;<br class="title-page-name"/>   (<span>`</span>${<span>USERS_CHILD</span>}<span>/</span>${uid}<span>`</span>).<span>valueChanges</span>();<br class="title-page-name"/>  }<br class="title-page-name"/><br class="title-page-name"/>  <span>public </span><span>saveUser</span>(user: User) {<br class="title-page-name"/>    <span>this</span>.<span>subject</span>.<span>next</span>(user);<br class="title-page-name"/>  }<br class="title-page-name"/><br class="title-page-name"/>  <span>public </span><span>getSavedUser</span>(): BehaviorSubject&lt;User&gt; {<br class="title-page-name"/>    <span>return this</span>.<span>subject</span>;<br class="title-page-name"/>  }<br class="title-page-name"/><br class="title-page-name"/><br class="title-page-name"/>  <span>public </span><span>updateEmail</span>(user: User, newEmail: <span>string</span>): <span>void </span>{<br class="title-page-name"/>    <span>this</span>.fireDb.<span>object</span>(<span>`</span>${<span>USERS_CHILD</span>}<span>/'</span>${user.<span>uid</span>}<span>`</span>).<span>update</span>({<span>email</span>: <br class="title-page-name"/>    newEmail});<br class="title-page-name"/>    <span>this</span>.<span>saveUser</span>(user);<br class="title-page-name"/>  }<br class="title-page-name"/><br class="title-page-name"/>  <span>public </span><span>updateMobile</span>(user: User, mobile: <span>string</span>): <span>void </span>{<br class="title-page-name"/>    <br class="title-page-name"/><span>  this</span>.fireDb.<span>object</span>(<span>`</span>${<span>USERS_CHILD</span>}<span>/'</span>${user.<span>uid</span>}<span>`</span>).<span>update</span>({<span>mobile</span>: <br class="title-page-name"/>  mobile});<br class="title-page-name"/>    <span>this</span>.<span>saveUser</span>(user);<br class="title-page-name"/>  }<br class="title-page-name"/><br class="title-page-name"/>  <span>public </span><span>updateName</span>(user: User, name: <span>string</span>): <span>void </span>{<br class="title-page-name"/>    <span>this</span>.fireDb.<span>object</span>(<span>`</span>${<span>USERS_CHILD</span>}<span>/'</span>${user.<span>uid</span>}<span>`</span>).<span>update</span>({<span>name</span>: <br class="title-page-name"/>    name});<br class="title-page-name"/>    <span>this</span>.<span>saveUser</span>(user);<br class="title-page-name"/>  }<br class="title-page-name"/><br class="title-page-name"/>}</pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Introduction to SASS</h1>
                
            
            <article>
                
<p class="calibre2"><strong class="calibre1">SASS</strong> (<strong class="calibre1">Systematically Awesome Style Sheets</strong>) is a CSS preprocessor, which adds more functionality to the existing CSS. It helps to add variables, nested rules, mixins, inheritance, and many more. This feature helps to organize our style sheets in a more systematic way. </p>
<p class="calibre2">SASS provides two flavors:</p>
<ul class="calibre7">
<li class="calibre8">SASS</li>
<li class="calibre8">SCSS</li>
</ul>
<p class="calibre2"><span>SASS is the older of the two syntaxes, and SCSS is the more commonly used one. I</span>n this book, we have used the SCSS format. A few of the supported features are as follows:</p>
<ul class="calibre7">
<li class="calibre8"><strong class="calibre1">Partial</strong><span>: Partial is a reusable CSS element, which can be included in other SCSS files. This helps to modularize our CSS into smaller reusable elements across SCSS files. A partial filename contains a leading underscore so that the compiler knows that this is a partial file and does not convert to a CSS file, for example,</span> <kbd class="calibre11">_shared.scss</kbd>. We can import a partial file into other components using the <kbd class="calibre11">@import</kbd> <span>directive.</span></li>
</ul>
<p class="mce-root">The following is an example to include a partial in other SCSS files, as follows:</p>
<pre class="calibre18"><span>@import </span><span>"../../shared/shared"</span>;<br class="title-page-name"/>.<span>chat-message-main-container </span>{<br class="title-page-name"/>}</pre>
<ul class="calibre7">
<li class="calibre8"><strong class="calibre1">Extend</strong>: This is similar to inheritance in high-level programming languages. We will write CSS properties in the common class selector and then extend this in other class selectors.</li>
</ul>
<p class="mce-root">  The following is an example of <kbd class="calibre11">@extend</kbd>:</p>
<pre class="calibre18">.<span>user-profile</span>{<br class="title-page-name"/>   <span>margin-top</span>: <span>10</span><span>px</span>;<br class="title-page-name"/>}<br class="title-page-name"/><br class="title-page-name"/>.<span>user-profile-name</span>{<br class="title-page-name"/>   <span>@extend </span>.<span>user-profile</span>;<br class="title-page-name"/>   <span>border-color</span>: <span>green</span>;<br class="title-page-name"/>}</pre>
<ul class="calibre7">
<li class="calibre8"><strong class="calibre1">Mixin</strong>: This is used to group declarations that can be used throughout our application. This is similar to method signature in a class:</li>
</ul>
<pre class="calibre18"><span>@mixin </span><span>message-pointer</span>(<span>$rotate </span>, <span>$skew</span>) {<br class="title-page-name"/>    <span>transform</span>: <span>rotate</span>(<span>$rotate</span>) <span>skew</span>(<span>$skew</span>);<br class="title-page-name"/>    <span>-moz-transform</span>: <span>rotate</span>(<span>$rotate</span>) <span>skew</span>(<span>$skew</span>);<br class="title-page-name"/>    <span>-ms-transform</span>: <span>rotate</span>(<span>$rotate</span>) <span>skew</span>(<span>$skew</span>);<br class="title-page-name"/>    <span>-o-transform</span>: <span>rotate</span>(<span>$rotate</span>) <span>skew</span>(<span>$skew</span>);<br class="title-page-name"/>    <span>-webkit-transform</span>: <span>rotate</span>(<span>$rotate</span>) <span>skew</span>(<span>$skew</span>);<br class="title-page-name"/>}</pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Creating a user profile component</h1>
                
            
            <article>
                
<p class="calibre2">In this section, we will create a user profile component. <span>After a successful login or signup, the user is directed to their </span>profile page<span>. </span>This component displays the user information, such as name and email, and provides edit functionalities to change user information. The following are the steps to create a user profile component:</p>
<ol class="calibre13">
<li value="1" class="calibre8"><strong class="calibre1">Creating a user profile template</strong>: The first step is to create the template for the user profile page. In this template, we will display the name, email, mobile, and password. Each of these pieces of information has an <span>E</span><span>dit</span> button. </li>
</ol>
<p class="mce-root">First, we create a <kbd class="calibre11">div</kbd> container that contains all the user information elements. We use <kbd class="calibre11">*ngIf</kbd> to check the user data:</p>
<pre class="calibre18"><span>&lt;</span><span>div </span><span>class=</span><span>"user-profile" </span><span>*ngIf=</span><span>"</span><span>user</span><span>"</span><span>&gt;<br class="title-page-name"/></span>&lt;/div&gt;</pre>
<p class="mce-root">Second, we create <kbd class="calibre11">div</kbd> for each of the user information in <kbd class="calibre11">div</kbd> with <kbd class="calibre11">label</kbd>, <kbd class="calibre11">user.name</kbd>, and <kbd class="calibre11">Edit</kbd> buttons:</p>
<pre class="calibre18"><span>&lt;</span><span>div </span><span>class=</span><span>"user-profile-name"</span><span>&gt;</span><br class="title-page-name"/>    <span>&lt;</span><span>label</span><span>&gt;</span>Name: <span>&lt;/</span><span>label</span><span>&gt;</span><br class="title-page-name"/>    <span>&lt;</span><span>div </span><span>class=</span><span>"user-profile-name-value"</span><span>&gt;</span>{{<span>user</span>?.<span>name</span>}}<span>&lt;/</span><span>div</span><span>&gt;</span><br class="title-page-name"/>    <span>&lt;</span><span>button </span><span>(click)=</span><span>"</span><span>onNameChange</span><span>()" </span><span>type=</span><span>"button" </span><span>class=</span><span>"btn btn-<br class="title-page-name"/>    default btn-sm user-profile-name-btn"</span><span>&gt;</span><br class="title-page-name"/>    Edit<br class="title-page-name"/>    <span>&lt;/</span><span>button</span><span>&gt;</span><br class="title-page-name"/><span>&lt;/</span><span>div</span><span>&gt;</span></pre>
<p class="mce-root"><span>Here's the complete <kbd class="calibre11">user-profile.component.html</kbd></span><span>:</span></p>
<pre class="calibre17"><span>&lt;</span><span>div </span><span>class=</span><span>"user-profile" </span><span>*ngIf=</span><span>"</span><span>user</span><span>"</span><span>&gt;</span><br class="title-page-name"/>    <span>&lt;</span><span>div </span><span>class=</span><span>"person-icon"</span><span>&gt;</span><br class="title-page-name"/>        <span>&lt;</span><span>img </span><span>[src]=</span><span>"</span><span>profileImage</span><span>" </span><span>style=</span><span>"</span><span>max-width</span>: <span>100</span>%; <span>max-height</span>:  <br class="title-page-name"/><span>         100</span>%;<span>"</span><span>&gt;</span><br class="title-page-name"/>    <span>&lt;/</span><span>div</span><span>&gt;</span><br class="title-page-name"/>    <span>&lt;</span><span>div </span><span>class=</span><span>"user-profile-name"</span><span>&gt;</span><br class="title-page-name"/>        <span>&lt;</span><span>label</span><span>&gt;</span>Name: <span>&lt;/</span><span>label</span><span>&gt;</span><br class="title-page-name"/>        <span>&lt;</span><span>div </span><span>class=</span><span>"user-profile-name-value"</span><span>&gt;</span>{{<span>user</span>?.<span>name</span>}}<span>&lt;/</span><span>div</span><span>&gt;</span><br class="title-page-name"/>        <span>&lt;</span><span>button </span><span>(click)=</span><span>"</span><span>onNameChange</span><span>()" </span><span>data-toggle=</span><span>"modal" </span><span>data-<br class="title-page-name"/>         target=</span><span>"#editModal" </span><span>type=</span><span>"button"<br class="title-page-name"/></span><span>         </span><span>class=</span><span>"btn btn-default btn-sm user-profile-name-btn"</span><span>&gt;</span><br class="title-page-name"/>            Edit<br class="title-page-name"/>        <span>&lt;/</span><span>button</span><span>&gt;</span><br class="title-page-name"/>    <span>&lt;/</span><span>div</span><span>&gt;</span><br class="title-page-name"/>    <span>&lt;</span><span>div </span><span>class=</span><span>"user-profile-email"</span><span>&gt;</span><br class="title-page-name"/>        <span>&lt;</span><span>label</span><span>&gt;</span>Email: <span>&lt;/</span><span>label</span><span>&gt;</span><br class="title-page-name"/>        <span>&lt;</span><span>div </span><span>class=</span><span>"user-profile-email-value"</span><span>&gt;</span>{{<span>user</span>?.<span>email</span>}}<span>&lt;/</span><span>div</span><span>&gt;</span><br class="title-page-name"/>        <span>&lt;</span><span>button </span><span>(click)=</span><span>"</span><span>onEmailChange</span><span>()" </span><span>data-toggle=</span><span>"modal" </span><span>data-<br class="title-page-name"/>        target=</span><span>"#editModal" </span><span>type=</span><span>"button"<br class="title-page-name"/></span><span>        </span><span>class=</span><span>"btn btn-default btn-sm"</span><span>&gt;</span><br class="title-page-name"/>            Edit<br class="title-page-name"/>        <span>&lt;/</span><span>button</span><span>&gt;</span><br class="title-page-name"/>    <span>&lt;/</span><span>div</span><span>&gt;</span><br class="title-page-name"/>    <span>&lt;</span><span>div </span><span>class=</span><span>"user-profile-mobile"</span><span>&gt;</span><br class="title-page-name"/>        <span>&lt;</span><span>label</span><span>&gt;</span>Mobile: <span>&lt;/</span><span>label</span><span>&gt;</span><br class="title-page-name"/>        <span>&lt;</span><span>div </span><span>class=</span><span>"user-profile-mobile-value"</span><span>&gt;</span>{{<span>user</span>?.<span>mobile</span>}}<span>&lt;/</span><span>div</span><span>&gt;</span><br class="title-page-name"/>        <span>&lt;</span><span>button </span><span>(click)=</span><span>"</span><span>onMobileChange</span><span>()" </span><span>data-toggle=</span><span>"modal" </span><span>data- <br class="title-page-name"/>         target=</span><span>"#editModal" </span><span>type=</span><span>"button"<br class="title-page-name"/></span><span>         </span><span>class=</span><span>"btn btn-default btn-sm user-profile-mobile-btn"</span><span>&gt;</span><br class="title-page-name"/>            Edit<br class="title-page-name"/>        <span>&lt;/</span><span>button</span><span>&gt;</span><br class="title-page-name"/>    <span>&lt;/</span><span>div</span><span>&gt;</span><br class="title-page-name"/><br class="title-page-name"/>    <span>&lt;</span><span>div </span><span>class=</span><span>"user-profile-password"</span><span>&gt;</span><br class="title-page-name"/>        <span>&lt;</span><span>label</span><span>&gt;</span>Password: <span>&lt;/</span><span>label</span><span>&gt;</span><br class="title-page-name"/>        <span>&lt;</span><span>div </span><span>class=</span><span>"user-profile-password-value"</span><span>&gt;</span>****<span>&lt;/</span><span>div</span><span>&gt;</span><br class="title-page-name"/>        <span>&lt;</span><span>button </span><span>(click)=</span><span>"</span><span>onPasswordChange</span><span>()" </span><span>data-toggle=</span><span>"modal" </span><span>data-<br class="title-page-name"/>        target=</span><span>"#editModal" </span><span>type=</span><span>"button"<br class="title-page-name"/></span><span>        </span><span>class=</span><span>"btn btn-default btn-sm user-profile-password-btn"</span><span>&gt;</span><br class="title-page-name"/>            Edit<br class="title-page-name"/>        <span>&lt;/</span><span>button</span><span>&gt;</span><br class="title-page-name"/>    <span>&lt;/</span><span>div</span><span>&gt;</span><br class="title-page-name"/>    <span>&lt;</span><span>div </span><span>class=</span><span>"user-profile-btn"</span><span>&gt;</span><br class="title-page-name"/>        <span>&lt;</span><span>button </span><span>type=</span><span>"button" </span><span>(click)=</span><span>'</span><span>onLogout</span><span>()' </span><span>class=</span><span>"btn btn-<br class="title-page-name"/>        info"</span><span>&gt;</span>LOGOUT<span>&lt;/</span><span>button</span><span>&gt;</span><br class="title-page-name"/>    <span>&lt;/</span><span>div</span><span>&gt;</span><br class="title-page-name"/><span>&lt;/</span><span>div</span><span>&gt;</span></pre>
<p class="mce-root">User information is aligned using the style sheets. We use nesting of SCSS for class selector from the container to the child selectors: </p>
<pre class="calibre18">.<span>user-profile</span>{<br class="title-page-name"/>    <span>width</span>: <span>50</span>%;<br class="title-page-name"/>    <span>margin-left</span>: <span>24</span><span>px</span>;<br class="title-page-name"/>    <span>margin-top</span>: <span>10</span><span>px</span>;<br class="title-page-name"/>    .<span>user-profile-name</span>{<br class="title-page-name"/>        <span>text-align</span>: <span>left</span>;<br class="title-page-name"/>        <span>margin-top</span>: <span>10</span><span>px</span>;<br class="title-page-name"/>        .<span>user-profile-name-value</span>{<br class="title-page-name"/>            <span>display</span>: <span>inline-block</span>;<br class="title-page-name"/>            <span>margin-left</span>: <span>10</span><span>px</span>;<br class="title-page-name"/>        }<br class="title-page-name"/>        .<span>user-profile-name-btn</span>{<br class="title-page-name"/>            <span>margin-left</span>: <span>100</span><span>px</span>;<br class="title-page-name"/>        }<br class="title-page-name"/>    }<br class="title-page-name"/>}</pre>
<p class="mce-root"><span>The following is the complete <kbd class="calibre11">user-profile.component.scss</kbd> code</span><span>:</span></p>
<pre class="calibre18">.<span>user-profile</span>{<br class="title-page-name"/>    <span>width</span>: <span>50</span>%;<br class="title-page-name"/>    <span>margin-left</span>: <span>24</span><span>px</span>;<br class="title-page-name"/>    <span>margin-top</span>: <span>10</span><span>px</span>;<br class="title-page-name"/>    .<span>user-profile-name</span>{<br class="title-page-name"/>        <span>text-align</span>: <span>left</span>;<br class="title-page-name"/>        <span>margin-top</span>: <span>10</span><span>px</span>;<br class="title-page-name"/>        .<span>user-profile-name-value</span>{<br class="title-page-name"/>            <span>display</span>: <span>inline-block</span>;<br class="title-page-name"/>            <span>margin-left</span>: <span>10</span><span>px</span>;<br class="title-page-name"/>        }<br class="title-page-name"/>        .<span>user-profile-name-btn</span>{<br class="title-page-name"/>            <span>margin-left</span>: <span>100</span><span>px</span>;<br class="title-page-name"/>        }<br class="title-page-name"/>    }<br class="title-page-name"/>    .<span>user-profile-email</span>{<br class="title-page-name"/>        <span>text-align</span>: <span>left</span>;<br class="title-page-name"/>        <span>margin-top</span>: <span>20</span><span>px</span>;<br class="title-page-name"/>        .<span>user-profile-email-value</span>{<br class="title-page-name"/>            <span>display</span>: <span>inline-block</span>;<br class="title-page-name"/>            <span>margin-left</span>: <span>10</span><span>px</span>;<br class="title-page-name"/>        }<br class="title-page-name"/>    }<br class="title-page-name"/>    .<span>user-profile-mobile</span>{<br class="title-page-name"/>        <span>text-align</span>: <span>left</span>;<br class="title-page-name"/>        <span>margin-top</span>: <span>20</span><span>px</span>;<br class="title-page-name"/>        .<span>user-profile-mobile-value</span>{<br class="title-page-name"/>            <span>display</span>: <span>inline-block</span>;<br class="title-page-name"/>            <span>margin-left</span>: <span>10</span><span>px</span>;<br class="title-page-name"/>        }<br class="title-page-name"/>        .<span>user-profile-mobile-btn</span>{<br class="title-page-name"/>            <span>margin-left</span>: <span>110</span><span>px</span>;<br class="title-page-name"/>        }<br class="title-page-name"/>    }<br class="title-page-name"/>    .<span>user-profile-password</span>{<br class="title-page-name"/>        <span>text-align</span>: <span>left</span>;<br class="title-page-name"/>        <span>margin-top</span>: <span>20</span><span>px</span>;<br class="title-page-name"/>        .<span>user-profile-password-value</span>{<br class="title-page-name"/>            <span>display</span>: <span>inline-block</span>;<br class="title-page-name"/>            <span>margin-left</span>: <span>10</span><span>px</span>;<br class="title-page-name"/>        }<br class="title-page-name"/>        .<span>user-profile-password-btn</span>{<br class="title-page-name"/>            <span>margin-left</span>: <span>154</span><span>px</span>;<br class="title-page-name"/>        }<br class="title-page-name"/>    }<br class="title-page-name"/>    .<span>user-profile-btn</span>{<br class="title-page-name"/>        <span>margin-top</span>: <span>20</span><span>px</span>;<br class="title-page-name"/>    }<br class="title-page-name"/>}</pre>
<ol start="2" class="calibre13">
<li value="2" class="calibre8"><strong class="calibre1">Creating the user profile component</strong>: We will define our logic to retrieve the user model and handle the events in the component.</li>
</ol>
<p class="mce-root">The first step is to retrieve the user model from the <kbd class="calibre11">service</kbd> <span>class. We implement an </span><kbd class="calibre11">onInit</kbd> <span>interface and override</span> <kbd class="calibre11">ngOnInit</kbd> <span>to retrieve the user model, as follows: </span></p>
<pre class="calibre18"><span>export class </span>UserProfileComponent <span>implements </span>OnInit {<br class="title-page-name"/>    <span>private </span><span>user</span>: User;<br class="title-page-name"/>    <span>constructor</span>(<span>private </span>authService: AuthenticationService,<br class="title-page-name"/>                <span>private </span>userService: UserService,<br class="title-page-name"/>                <span>private </span>router: Router) {<br class="title-page-name"/>    }<br class="title-page-name"/>    <span>ngOnInit</span>() {<br class="title-page-name"/>        <span>this</span>.<span>user </span>= <span>this</span>.userService.<span>getSavedUser</span>().<span>getValue</span>();<br class="title-page-name"/>    }<br class="title-page-name"/>}</pre>
<div class="packt_infobox"><kbd class="calibre21">OnInit</kbd><span class="calibre20"> is a life cycle hook interface, which is managed by Angular framework. It has a </span><kbd class="calibre21">ngOnInit()</kbd><span class="calibre20"> method, which is called when the component and the directive are fully initialized.</span></div>
<p class="mce-root"><span>The following is the complete <kbd class="calibre11">user-profile.component.ts</kbd> </span><span>as of now:</span></p>
<pre class="calibre18"><span>import </span>{Component, OnInit, ViewChild} <span>from </span><span>'@angular/core'</span>;<br class="title-page-name"/><span>import </span>{AuthenticationService} <span>from </span><span>'../../services/authentication.service'</span>;<br class="title-page-name"/><span>import </span>{Router} <span>from </span><span>'@angular/router'</span>;<br class="title-page-name"/><span>import </span>{User} <span>from </span><span>'../../services/user'</span>;<br class="title-page-name"/><span>import </span>{UserService} <span>from </span><span>'../../services/user.service'</span>;<br class="title-page-name"/><span>import </span>{EditDialogComponent} <span>from </span><span>'../../edit-dialog/edit-dialog.component'</span>;<br class="title-page-name"/><span>import </span>{EditType} <span>from </span><span>'../../edit-dialog/edit-details'</span>;<br class="title-page-name"/><br class="title-page-name"/>@<span>Component</span>({<br class="title-page-name"/>    <span>selector</span>: <span>'app-friends-userprofile'</span>,<br class="title-page-name"/>    <span>styleUrls</span>: [<span>'user-profile.component.scss'</span>],<br class="title-page-name"/>    <span>templateUrl</span>: <span>'user-profile.component.html'<br class="title-page-name"/></span>})<br class="title-page-name"/><span>export class </span>UserProfileComponent <span>implements </span>OnInit {<br class="title-page-name"/><br class="title-page-name"/>    <span>profileImage</span>: <span>any </span>= <span>'../../../assets/images/person_edit.png'</span>;<br class="title-page-name"/><br class="title-page-name"/>    <span>user</span>: User;<br class="title-page-name"/><br class="title-page-name"/>    @<span>ViewChild</span>(EditDialogComponent) <span>editDialog</span>: EditDialogComponent;<br class="title-page-name"/><br class="title-page-name"/>    <span>constructor</span>(<span>private </span>authService: AuthenticationService,<br class="title-page-name"/>                <span>private </span>userService: UserService,<br class="title-page-name"/>                <span>private </span>router: Router) {<br class="title-page-name"/>    }<br class="title-page-name"/><br class="title-page-name"/>    <span>ngOnInit</span>() {<br class="title-page-name"/>        <span>this</span>.<span>user </span>= <span>this</span>.userService.<span>getSavedUser</span>().<span>getValue</span>();<br class="title-page-name"/>    }<br class="title-page-name"/><br class="title-page-name"/>    <span>onLogout</span>(): <span>void </span>{<br class="title-page-name"/>        <span>this</span>.authService.<span>signout</span>().<span>then</span>(() =&gt; {<br class="title-page-name"/>            <span>this</span>.<span>navigateToLogin</span>();<br class="title-page-name"/>        });<br class="title-page-name"/>    }<br class="title-page-name"/><br class="title-page-name"/>    <span>navigateToLogin</span>() {<br class="title-page-name"/>        <span>this</span>.router.<span>navigateByUrl</span>(<span>'/app-friends-login'</span>);<br class="title-page-name"/>    }<br class="title-page-name"/>}</pre>
<p class="mce-root">Our user profile page view should be as follows:</p>
<div class="cdpaligncenter"><img src="../images/00023.jpeg" class="calibre45"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Enhancing services for update operation</h1>
                
            
            <article>
                
<p class="calibre2">In this section, we will enhance our existing services to provide updates for user information. As a part of this exercise, we will discus how to update the Firebase authentication and database.</p>
<p class="calibre2">We will update the following user information:</p>
<ul class="calibre7">
<li class="calibre8"><strong class="calibre1">Username</strong>: This data is stored in the Firebase database, so we add new <kbd class="calibre11">update</kbd> API to perform this operation. We add the <kbd class="calibre11">updateName()</kbd> <span>method in our user service and update the stored user data in Firebase:</span></li>
</ul>
<pre class="calibre18"><span>public </span>updateName(user: User, name: string): <span>void </span>{<br class="title-page-name"/>    <span>this</span>.fireDb.object(<span>`</span>${USERS_CHILD}<span>/'</span>${user.uid}<span>`</span>).update({name: <br class="title-page-name"/>    name});<br class="title-page-name"/>    <span>this</span>.saveUser(user);<br class="title-page-name"/>}</pre>
<ul class="calibre7">
<li class="calibre8"><strong class="calibre1">User email</strong>: This data is stored in the Firebase authentication and database, so we will need to update it in both places. </li>
</ul>
<p class="mce-root">We will need to add a <kbd class="calibre11">changeEmail()</kbd> method in our authentication service: </p>
<pre class="calibre18"><span>public </span><span>changeEmail</span>(email: <span>string</span>): Promise&lt;<span>any</span>&gt; {<br class="title-page-name"/>    <span>return this</span>.<span>angularFireAuth</span>.<span>auth</span>.<span>currentUser</span>.<span>updateEmail</span>(email);<br class="title-page-name"/>}</pre>
<p class="mce-root">Once this has been done in the authentication service, we can update a new email in our Firebase database using user services:</p>
<pre class="calibre18"><span>public </span><span>updateEmail</span>(user: User, newEmail: <span>string</span>): <span>void </span>{<br class="title-page-name"/>    <span>this</span>.<span>fireDb</span>.<span>object</span>(<span>`</span>${<span>USERS_CHILD</span>}<span>/'</span>${user.<span>uid</span>}<span>`</span>).<span>update</span>({<span>email</span>: <br class="title-page-name"/>    newEmail});<br class="title-page-name"/>    <span>this</span>.<span>saveUser</span>(user);<br class="title-page-name"/>}</pre>
<p class="mce-root">Now editing the mobile password is the same as the  preceding code, and you can follow the following code. The updated version of <kbd class="calibre11">authentication.service.ts</kbd> and <kbd class="calibre11">user.service.ts</kbd> is as follows:</p>
<pre class="calibre18"><span>import </span>{Injectable} <span>from </span><span>'@angular/core'</span>;<br class="title-page-name"/><span>import </span>{AngularFireAuth} <span>from </span><span>'angularfire2/auth'</span>;<br class="title-page-name"/><br class="title-page-name"/><span>/**<br class="title-page-name"/></span><span> * Authentication service<br class="title-page-name"/></span><span> *<br class="title-page-name"/></span><span> */<br class="title-page-name"/></span><span>@Injectable</span>()<br class="title-page-name"/><span>export class </span>AuthenticationService {<br class="title-page-name"/><br class="title-page-name"/>    <span>/**<br class="title-page-name"/></span><span>     * Constructor<br class="title-page-name"/></span><span>     *<br class="title-page-name"/></span><span>     * </span><span>@param </span><span>{AngularFireAuth} angularFireAuth provides the <br class="title-page-name"/>       functionality related to authentication<br class="title-page-name"/></span><span>     */<br class="title-page-name"/></span><span>    </span><span>constructor</span>(<span>private </span><span>angularFireAuth</span>: AngularFireAuth) {<br class="title-page-name"/>    }<br class="title-page-name"/><br class="title-page-name"/>    <span>public </span><span>signup</span>(email: <span>string</span>, password: <span>string</span>): Promise&lt;<span>any</span>&gt; {<br class="title-page-name"/>        <span>return <br class="title-page-name"/>        this</span>.<span>angularFireAuth</span>.<span>auth</span>.<span>createUserWithEmailAndPassword</span>(<br class="title-page-name"/>        email, password);<br class="title-page-name"/>    }<br class="title-page-name"/><br class="title-page-name"/>    <span>public </span><span>login</span>(email: <span>string</span>, password: <span>string</span>): Promise&lt;<span>any</span>&gt; {<br class="title-page-name"/>        <span>return this</span>.<span>angularFireAuth</span>.<span>auth</span>.<span>signInWithEmailAndPassword</span>(<br class="title-page-name"/>        email, password);<br class="title-page-name"/>    }<br class="title-page-name"/><br class="title-page-name"/>    <span>public </span><span>resetPassword</span>(email: <span>string</span>): Promise&lt;<span>any</span>&gt; {<br class="title-page-name"/>        <span>return <br class="title-page-name"/>        this</span>.<span>angularFireAuth</span>.<span>auth</span>.<span>sendPasswordResetEmail</span>(email);<br class="title-page-name"/>    }<br class="title-page-name"/><br class="title-page-name"/>    <span>public </span><span>isAuthenticated</span>(): <span>boolean </span>{<br class="title-page-name"/>        <span>const </span><span>user </span>= <span>this</span>.<span>angularFireAuth</span>.<span>auth</span>.<span>currentUser</span>;<br class="title-page-name"/>        <span>return </span><span>user </span>? <span>true </span>: <span>false</span>;<br class="title-page-name"/>    }<br class="title-page-name"/><br class="title-page-name"/>    <span>public </span><span>signout</span>(): Promise&lt;<span>any</span>&gt;{<br class="title-page-name"/>        <span>return this</span>.<span>angularFireAuth</span>.<span>auth</span>.<span>signOut</span>();<br class="title-page-name"/>    }<br class="title-page-name"/><br class="title-page-name"/>    <span>public </span><span>changeEmail</span>(email: <span>string</span>): Promise&lt;<span>any</span>&gt; {<br class="title-page-name"/>        <span>return <br class="title-page-name"/>        this</span>.<span>angularFireAuth</span>.<span>auth</span>.<span>currentUser</span>.<span>updateEmail</span>(email);<br class="title-page-name"/>    }<br class="title-page-name"/><br class="title-page-name"/>    <span>public </span><span>changePassword</span>(password: <span>string</span>): Promise&lt;<span>any</span>&gt; {<br class="title-page-name"/>        <span>return <br class="title-page-name"/>        this</span>.<span>angularFireAuth</span>.<span>auth</span>.<span>currentUser</span>.<span>updatePassword<br class="title-page-name"/></span>        (password);<br class="title-page-name"/>    }<br class="title-page-name"/>}</pre>
<p class="mce-root">The following is the updated <kbd class="calibre11">user.service.ts</kbd> file:</p>
<pre class="calibre18"><span>import </span>{Injectable} <span>from </span><span>'@angular/core'</span>;<br class="title-page-name"/><span>import </span>{AngularFireDatabase} <span>from </span><span>'angularfire2/database'</span>;<br class="title-page-name"/><span>import </span>{User} <span>from </span><span>'./user'</span>;<br class="title-page-name"/><span>import </span>{<span>USERS_CHILD</span>} <span>from </span><span>'./database-constants'</span>;<br class="title-page-name"/><span>import </span>{Observable} <span>from </span><span>'rxjs/Observable'</span>;<br class="title-page-name"/><span>import </span>{BehaviorSubject} <span>from </span><span>'rxjs/BehaviorSubject'</span>;<br class="title-page-name"/><br class="title-page-name"/><span>/**<br class="title-page-name"/></span><span> * User service<br class="title-page-name"/></span><span> *<br class="title-page-name"/></span><span> */<br class="title-page-name"/></span>@<span>Injectable</span>()<br class="title-page-name"/><span>export class </span>UserService {<br class="title-page-name"/><br class="title-page-name"/>  <span>private </span><span>subject</span>: BehaviorSubject&lt;User&gt; = <span>new </span>BehaviorSubject(<span>null</span>);<br class="title-page-name"/><br class="title-page-name"/>  <span>/**<br class="title-page-name"/></span><span>   * Constructor<br class="title-page-name"/></span><span>   *<br class="title-page-name"/></span><span>   * </span><span>@param </span><span>{AngularFireDatabase} fireDb provides the functionality <br class="title-page-name"/>     for Firebase Database<br class="title-page-name"/></span><span>   */<br class="title-page-name"/></span><span>  </span><span>constructor</span>(<span>private </span>fireDb: AngularFireDatabase) {<br class="title-page-name"/>  }<br class="title-page-name"/><br class="title-page-name"/>  <span>public </span><span>addUser</span>(user: User): <span>void </span>{<br class="title-page-name"/>    <span>this</span>.fireDb.<span>object</span>(<span>`</span>${<span>USERS_CHILD</span>}<span>/</span>${user.<span>uid</span>}<span>`</span>).<span>set</span>(user);<br class="title-page-name"/>    <span>this</span>.<span>saveUser</span>(user);<br class="title-page-name"/>  }<br class="title-page-name"/><br class="title-page-name"/>  <span>public </span><span>getUser</span>(uid: <span>string</span>): Observable&lt;User&gt; {<br class="title-page-name"/>    <span>return this</span>.fireDb.<span>object</span>&lt;User&gt;<br class="title-page-name"/>   (<span>`</span>${<span>USERS_CHILD</span>}<span>/</span>${uid}<span>`</span>).<span>valueChanges</span>();<br class="title-page-name"/>  }<br class="title-page-name"/><br class="title-page-name"/>  <span>public </span><span>saveUser</span>(user: User) {<br class="title-page-name"/>    <span>this</span>.<span>subject</span>.<span>next</span>(user);<br class="title-page-name"/>  }<br class="title-page-name"/><br class="title-page-name"/>  <span>public </span><span>getSavedUser</span>(): BehaviorSubject&lt;User&gt; {<br class="title-page-name"/>    <span>return this</span>.<span>subject</span>;<br class="title-page-name"/>  }<br class="title-page-name"/><br class="title-page-name"/><br class="title-page-name"/>  <span>public </span><span>updateEmail</span>(user: User, newEmail: <span>string</span>): <span>void </span>{<br class="title-page-name"/>    <span>this</span>.fireDb.<span>object</span>(<span>`</span>${<span>USERS_CHILD</span>}<span>/'</span>${user.<span>uid</span>}<span>`</span>).<span>update</span>({<span>email</span>:  <br class="title-page-name"/>    newEmail});<br class="title-page-name"/>    <span>this</span>.<span>saveUser</span>(user);<br class="title-page-name"/>  }<br class="title-page-name"/><br class="title-page-name"/>  <span>public </span><span>updateMobile</span>(user: User, mobile: <span>string</span>): <span>void </span>{<br class="title-page-name"/>    <br class="title-page-name"/><span>  this</span>.fireDb.<span>object</span>(<span>`</span>${<span>USERS_CHILD</span>}<span>/'</span>${user.<span>uid</span>}<span>`</span>).<span>update</span>({<span>mobile</span>:   <br class="title-page-name"/>   mobile});<br class="title-page-name"/>    <span>this</span>.<span>saveUser</span>(user);<br class="title-page-name"/>  }<br class="title-page-name"/><br class="title-page-name"/>  <span>public </span><span>updateName</span>(user: User, name: <span>string</span>): <span>void </span>{<br class="title-page-name"/>    <span>this</span>.fireDb.<span>object</span>(<span>`</span>${<span>USERS_CHILD</span>}<span>/'</span>${user.<span>uid</span>}<span>`</span>).<span>update</span>({<span>name</span>: <br class="title-page-name"/>    name});<br class="title-page-name"/>    <span>this</span>.<span>saveUser</span>(user);<br class="title-page-name"/>  }<br class="title-page-name"/><br class="title-page-name"/>}</pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Creating an edit dialog component</h1>
                
            
            <article>
                
<p class="calibre2">The edit dialog component is used to take user input to update user information in Firebase. The same component is reused to take the information of all other user details, such as name, email, mobile, and password. This component is included in the user profile component, and the edit dialog box appears when a user clicks on the <span>Edit</span> button. </p>
<p class="calibre2">The following are the steps involved in creating an edit <kbd class="calibre11">dialog</kbd> component:</p>
<ol class="calibre13">
<li value="1" class="calibre8"><strong class="calibre1">Creating the edit dialog template</strong>: The first step is to create the template for the edit dialog. This template contains a header, title for the text, and an input box.</li>
</ol>
<p class="mce-root">We use bootstrap modal to create an edit dialog. It has an input box to receive the user input.</p>
<p class="mce-root">The first step is to create the <kbd class="calibre11">div</kbd><span> container </span>with an <kbd class="calibre11">isVisible</kbd> <span>condition, </span>and this variable changes dynamically when the user clicks on the <span>Edit</span> button:</p>
<pre class="calibre18"><span>&lt;</span><span>div </span><span>*ngIf=</span><span>"</span><span>isVisible</span><span>" </span><span>class=</span><span>"modal fade show in danger" </span><span>id=</span><span>"editModal" </span><span>role=</span><span>"dialog" /</span><span>&gt;</span></pre>
<p class="mce-root">We use form element to take the user input, which has a <kbd class="calibre11">submit</kbd> button, as follows:</p>
<pre class="calibre18"><span>&lt;</span><span>div </span><span>class=</span><span>"modal-dialog"</span><span>&gt;</span><br class="title-page-name"/>    <span>&lt;</span><span>form </span><span>name=</span><span>"form" </span><span>(ngSubmit)=</span><span>"</span><span>onSubmit</span><span>(</span><span>editFormData</span><span>)" <br class="title-page-name"/></span><span>     #editFormData=</span><span>'ngForm'</span><span>&gt;</span><br class="title-page-name"/>&lt;/form&gt;<br class="title-page-name"/>&lt;/div&gt;</pre>
<p class="mce-root">Because the preceding template is also used for different editing purposes, we will need to dynamically change the text of the header, title, and so on. We can use a one-way Angular binding to assign a variable: </p>
<pre class="calibre18"><span>&lt;</span><span>p</span><span>&gt;</span>This will change your {{<span>bodyTitle</span>}}<span>&lt;/</span><span>p</span><span>&gt;</span></pre>
<p class="mce-root">The following is the complete <kbd class="calibre11">edit-dialog.component.html</kbd> file:</p>
<pre class="calibre18"><span>&lt;</span><span>div </span><span>*ngIf=</span><span>"isVisible" </span><span>class=</span><span>"modal fade in" </span><span>id=</span><span>"editModal" </span><span>role=</span><span>"dialog"</span><span>&gt;</span><br class="title-page-name"/>    <span>&lt;</span><span>div </span><span>class=</span><span>"modal-dialog"</span><span>&gt;</span><br class="title-page-name"/>        <span>&lt;</span><span>form </span><span>name=</span><span>"form" </span><span>(ngSubmit)=</span><span>"</span><span>onSubmit</span><span>(</span><span>editFormData</span><span>)" <br class="title-page-name"/></span><span>        #editFormData=</span><span>'ngForm'</span><span>&gt;</span><br class="title-page-name"/>            <span>&lt;</span><span>div </span><span>class=</span><span>"modal-content"</span><span>&gt;</span><br class="title-page-name"/>                <span>&lt;</span><span>div </span><span>class=</span><span>"modal-header"</span><span>&gt;</span><br class="title-page-name"/>                    <span>&lt;</span><span>button </span><span>type=</span><span>"button" </span><span>class=</span><span>"close" </span><span>data-<br class="title-page-name"/>                    dismiss=</span><span>"modal"</span><span>&gt;</span><span>&amp;times;</span><span>&lt;/</span><span>button</span><span>&gt;</span><br class="title-page-name"/>                    <span>&lt;</span><span>h4 </span><span>class=</span><span>"modal-title"</span><span>&gt;</span>{{<span>titleMessage</span>}}<span>&lt;/</span><span>h4</span><span>&gt;</span><br class="title-page-name"/>                <span>&lt;/</span><span>div</span><span>&gt;</span><br class="title-page-name"/>                <span>&lt;</span><span>div </span><span>class=</span><span>"modal-body"</span><span>&gt;</span><br class="title-page-name"/>                    <span>&lt;</span><span>p</span><span>&gt;</span>This will change your {{<span>bodyTitle</span>}}<span>&lt;/</span><span>p</span><span>&gt;</span><br class="title-page-name"/><br class="title-page-name"/>                    <span>&lt;</span><span>div </span><span>class=</span><span>"form-group"</span><span>&gt;</span><br class="title-page-name"/>                        <span>&lt;</span><span>label </span><span>for=</span><span>"editDetail"</span><span>&gt;</span>{{<span>bodyLabel</span>}}<br class="title-page-name"/><span>                        &lt;/</span><span>label</span><span>&gt;</span><br class="title-page-name"/>                        <span>&lt;</span><span>input </span><span>type=</span><span>"text" </span><span>class=</span><span>"form-control" <br class="title-page-name"/></span><span>                        name=</span><span>"editValue" </span><span>(ngModel)=</span><span>"editValue"<br class="title-page-name"/></span><span>                        </span><span>id=</span><span>"editDetail"</span><span>/&gt;</span><br class="title-page-name"/>                    <span>&lt;/</span><span>div</span><span>&gt;</span><br class="title-page-name"/>                <span>&lt;/</span><span>div</span><span>&gt;</span><br class="title-page-name"/>                <span>&lt;</span><span>div </span><span>class=</span><span>"modal-footer form-group"</span><span>&gt;</span><br class="title-page-name"/>                    <span>&lt;</span><span>button </span><span>type=</span><span>"submit" </span><span>class=</span><span>"btn btn-default" <br class="title-page-name"/></span><span>                   [disabled]=</span><span>"!</span><span>editFormData</span><span>.</span><span>form</span><span>.</span><span>valid</span><span>"&gt;<br class="title-page-name"/></span><span>                    </span>Edit<br class="title-page-name"/>                    <span>&lt;/</span><span>button</span><span>&gt;</span><br class="title-page-name"/>                    <span>&lt;</span><span>button </span><span>type=</span><span>"button" </span><span>class=</span><span>"btn btn-default" <br class="title-page-name"/>                    data-dismiss="modal" <br class="title-page-name"/></span><span>                   (click)=</span><span>"</span><span>hide</span><span>()"</span><span>&gt;</span>Close<span>&lt;/</span><span>button</span><span>&gt;</span><br class="title-page-name"/>                <span>&lt;/</span><span>div</span><span>&gt;</span><br class="title-page-name"/>            <span>&lt;/</span><span>div</span><span>&gt;</span><br class="title-page-name"/>        <span>&lt;/</span><span>form</span><span>&gt;</span><br class="title-page-name"/>    <span>&lt;/</span><span>div</span><span>&gt;</span><br class="title-page-name"/><span>&lt;/</span><span>div</span><span>&gt;</span></pre>
<ol start="2" class="calibre13">
<li class="calibre8" value="2">
<p class="calibre9"><strong class="calibre1">Creating an edit dialog component</strong>: This component takes a variable input from the user profile component when the user clicks on the <span>Edit</span> button. It takes a user input in the dialog box and passes it to the <kbd class="calibre11">EditDetails</kbd> class to update the information.</p>
</li>
</ol>
<p class="mce-root">We will use builder pattern to take input<span> variables</span> from <kbd class="calibre11">UserProfileComponent</kbd>. </p>
<div class="packt_infobox">Builder pattern is a creational pattern that is used to create complex objects. This is basically used when a constructor in a class accepts many parameters. This reduces the complexity of the constructor.</div>
<p class="mce-root">In our case, we will need parameters to dynamically change the title, <kbd class="calibre11">label</kbd>. We will create multiple methods for each variable input—for example, for title, we will create a <kbd class="calibre11">setTitle()</kbd> method and return <kbd class="calibre11">this</kbd>, which is the instance of the class. This helps in chaining the method calls in a single line:</p>
<pre class="calibre18"><span>public </span><span>setTitle</span>(title: <span>string</span>): EditDialogComponent {<br class="title-page-name"/>    <span>this</span>.<span>titleMessage </span>= title;<br class="title-page-name"/>    <span>return this</span>;<br class="title-page-name"/>}</pre>
<p class="mce-root">We will then need to toggle the <kbd class="calibre11">isVisible</kbd> variables using the <kbd class="calibre11">show</kbd> and <kbd class="calibre11">hide</kbd> methods, as follows:</p>
<pre class="calibre18"><span>public </span><span>show</span>() {<br class="title-page-name"/>    <span>this</span>.<span>isVisible </span>= <span>true</span>;<br class="title-page-name"/>}<br class="title-page-name"/><br class="title-page-name"/><span>public </span><span>hide</span>() {<br class="title-page-name"/>    <span>this</span>.<span>isVisible </span>= <span>false</span>;<br class="title-page-name"/>}</pre>
<p class="mce-root"><span>Here's the complete </span><kbd class="calibre11">edit-dialog.component.ts</kbd><span> file </span><span>as of now:</span></p>
<pre class="calibre18"><span>import </span>{Component, ViewChild} <span>from </span><span>'@angular/core'</span>;<br class="title-page-name"/><span>import </span>{AuthenticationService} <span>from </span><span>'../services/authentication.service'</span>;<br class="title-page-name"/><span>import </span>{UserService} <span>from </span><span>'../services/user.service'</span>;<br class="title-page-name"/><span>import </span>{User} <span>from </span><span>'../services/user'</span>;<br class="title-page-name"/><span>import </span>{EditDetails, EditType} <span>from </span><span>'./edit-details'</span>;<br class="title-page-name"/><br class="title-page-name"/>@<span>Component</span>({<br class="title-page-name"/>   <span>selector</span>: <span>'app-edit-dialog'</span>,<br class="title-page-name"/>   <span>templateUrl</span>: <span>'./edit-dialog.component.html'</span>,<br class="title-page-name"/>})<br class="title-page-name"/><span>export class </span>EditDialogComponent {<br class="title-page-name"/>   <span>isVisible</span>: <span>boolean</span>;<br class="title-page-name"/><br class="title-page-name"/>   <span>titleMessage</span>: <span>string</span>;<br class="title-page-name"/><br class="title-page-name"/>   <span>bodyTitle</span>: <span>string</span>;<br class="title-page-name"/><br class="title-page-name"/>   <span>bodyLabel</span>: <span>string</span>;<br class="title-page-name"/><br class="title-page-name"/>   <span>editType</span>: EditType;<br class="title-page-name"/><br class="title-page-name"/>   <span>editDetails</span>: EditDetails;<br class="title-page-name"/><br class="title-page-name"/>   <span>constructor</span>(<span>private </span>authService: AuthenticationService,<br class="title-page-name"/>            <span>private </span>userService: UserService) {<br class="title-page-name"/>      <span>this</span>.<span>editDetails </span>= <span>new </span>EditDetails(authService, userService);<br class="title-page-name"/>   }<br class="title-page-name"/><br class="title-page-name"/>   <span>public </span><span>setTitle</span>(title: <span>string</span>): EditDialogComponent {<br class="title-page-name"/>      <span>this</span>.<span>titleMessage </span>= title;<br class="title-page-name"/>      <span>return this</span>;<br class="title-page-name"/>   }<br class="title-page-name"/><br class="title-page-name"/>   <span>public </span><span>setBodyTitle</span>(bodyTitle: <span>string</span>): EditDialogComponent {<br class="title-page-name"/>      <span>this</span>.<span>bodyTitle </span>= bodyTitle;<br class="title-page-name"/>      <span>return this</span>;<br class="title-page-name"/>   }<br class="title-page-name"/><br class="title-page-name"/>   <span>public </span><span>setBodyLabel</span>(bodyLabel: <span>string</span>): EditDialogComponent {<br class="title-page-name"/>      <span>this</span>.<span>bodyLabel </span>= bodyLabel;<br class="title-page-name"/>      <span>return this</span>;<br class="title-page-name"/>   }<br class="title-page-name"/><br class="title-page-name"/>   <span>public </span><span>setEditType</span>(editType: EditType): EditDialogComponent {<br class="title-page-name"/>      <span>this</span>.<span>editType </span>= editType;<br class="title-page-name"/>      <span>return this</span>;<br class="title-page-name"/>   }<br class="title-page-name"/><br class="title-page-name"/><br class="title-page-name"/>   <span>public </span><span>show</span>() {<br class="title-page-name"/>      <span>this</span>.<span>isVisible </span>= <span>true</span>;<br class="title-page-name"/>   }<br class="title-page-name"/><br class="title-page-name"/>   <span>public </span><span>hide</span>() {<br class="title-page-name"/>      <span>this</span>.<span>isVisible </span>= <span>false</span>;<br class="title-page-name"/>   }<br class="title-page-name"/><br class="title-page-name"/>   <span>private </span><span>onSubmit</span>(editFormData): <span>void {</span><br class="title-page-name"/>      <span>this</span>.<span>editDetails</span>.<span>edit</span>(<span>this</span>.<span>editType</span>, <br class="title-page-name"/>      editFormData.<span>value</span>.editValue);<br class="title-page-name"/>   }<br class="title-page-name"/>}</pre>
<ol start="3" class="calibre13">
<li class="calibre8" value="3"><strong class="calibre1">Creating an update operation</strong>: When a user provides the new data for updating and clicks on <kbd class="calibre11">submit</kbd>, the <kbd class="calibre11">onSubmit()</kbd> method is called. For each of the update operations, we will call <kbd class="calibre11">edit()</kbd> of the <kbd class="calibre11">EditDetails</kbd> class. </li>
</ol>
<p class="mce-root"><span>Here's the complete <kbd class="calibre11">edit-details.ts</kbd> file </span><span>as of now:</span></p>
<pre class="calibre18"><span>import </span>{AuthenticationService} <span>from </span><span>'../services/authentication.service'</span>;<br class="title-page-name"/><span>import </span>{UserService} <span>from </span><span>'../services/user.service'</span>;<br class="title-page-name"/><span>import </span>{User} <span>from </span><span>'../services/user'</span>;<br class="title-page-name"/><br class="title-page-name"/><span>export enum </span>EditType {<br class="title-page-name"/>   <span>NAME</span>,<br class="title-page-name"/>   <span>EMAIL</span>,<br class="title-page-name"/>   <span>MOBILE</span>,<br class="title-page-name"/>   <span>PASSWORD<br class="title-page-name"/></span>}<br class="title-page-name"/><br class="title-page-name"/><span>export class </span>EditDetails {<br class="title-page-name"/><br class="title-page-name"/>   <span>constructor</span>(<span>private </span>authService: AuthenticationService,<br class="title-page-name"/>            <span>private </span>userService: UserService) {<br class="title-page-name"/>   }<br class="title-page-name"/><br class="title-page-name"/>   <span>public </span><span>edit</span>(editType: EditType, value: <span>string</span>) {<br class="title-page-name"/>      <span>switch </span>(editType) {<br class="title-page-name"/>         <span>case </span>EditType.<span>NAME</span>:<br class="title-page-name"/>            <span>this</span>.<span>editName</span>(value);<br class="title-page-name"/>            <span>break</span>;<br class="title-page-name"/><br class="title-page-name"/>         <span>case </span>EditType.<span>EMAIL</span>:<br class="title-page-name"/>            <span>this</span>.<span>editEmail</span>(value);<br class="title-page-name"/>            <span>break</span>;<br class="title-page-name"/><br class="title-page-name"/>         <span>case </span>EditType.<span>MOBILE</span>:<br class="title-page-name"/>            <span>this</span>.<span>editMobile</span>(value);<br class="title-page-name"/>            <span>break</span>;<br class="title-page-name"/><br class="title-page-name"/>         <span>case </span>EditType.<span>PASSWORD</span>:<br class="title-page-name"/>            <span>this</span>.<span>editPassword</span>(value);<br class="title-page-name"/>            <span>break</span>;<br class="title-page-name"/>      }<br class="title-page-name"/>   }<br class="title-page-name"/><br class="title-page-name"/>   <span>private </span><span>editName</span>(name: <span>string</span>) {<br class="title-page-name"/>      <span>const </span><span>user</span>: User = <span>this</span>.userService.<span>getSavedUser</span>().<span>getValue</span>();<br class="title-page-name"/>      <span>user</span>.<span>name </span>= name;<br class="title-page-name"/>      <span>this</span>.userService.<span>updateName</span>(<span>user</span>, name);<br class="title-page-name"/>      <span>alert</span>(<span>'Name changed successfully'</span>);<br class="title-page-name"/>   }<br class="title-page-name"/><br class="title-page-name"/>   <span>private </span><span>editEmail</span>(newEmail: <span>string</span>) {<br class="title-page-name"/>      <span>this</span>.authService.<span>changeEmail</span>(newEmail).<span>then</span>(() =&gt; {<br class="title-page-name"/>         <span>const </span><span>user</span>: User =   <br class="title-page-name"/><span>         this</span>.userService.<span>getSavedUser</span>().<span>getValue</span>();<br class="title-page-name"/>         <span>user</span>.<span>email </span>= newEmail;<br class="title-page-name"/>         <span>this</span>.userService.<span>updateEmail</span>(<span>user</span>, newEmail);<br class="title-page-name"/>         <span>alert</span>(<span>'Email changed successfully'</span>);<br class="title-page-name"/>      }).<span>catch</span>(<span>function </span>(error) {<br class="title-page-name"/>         <span>const </span><span>errorMessage </span>= error.<span>message</span>;<br class="title-page-name"/>         <span>alert</span>(<span>errorMessage</span>);<br class="title-page-name"/>      });<br class="title-page-name"/>   }<br class="title-page-name"/><br class="title-page-name"/>   <span>private </span><span>editMobile</span>(mobile: <span>string</span>) {<br class="title-page-name"/>      <span>const </span><span>user</span>: User = <span>this</span>.userService.<span>getSavedUser</span>().<span>getValue</span>();<br class="title-page-name"/>      <span>user</span>.<span>mobile </span>= mobile;<br class="title-page-name"/>      <span>this</span>.userService.<span>updateMobile</span>(<span>user</span>, mobile);<br class="title-page-name"/>      <span>alert</span>(<span>'Mobile changed successfully'</span>);<br class="title-page-name"/>   }<br class="title-page-name"/><br class="title-page-name"/>   <span>private </span><span>editPassword</span>(value: <span>string</span>) {<br class="title-page-name"/>      <span>const </span><span>newPassword</span>: <span>string </span>= value;<br class="title-page-name"/>      <span>this</span>.authService.<span>changePassword</span>(<span>newPassword</span>).<span>then</span>(() =&gt; {<br class="title-page-name"/>         <span>alert</span>(<span>'Password changed successfully'</span>);<br class="title-page-name"/>      }).<span>catch</span>(<span>function </span>(error) {<br class="title-page-name"/>         <span>const </span><span>errorMessage </span>= error.<span>message</span>;<br class="title-page-name"/>         <span>alert</span>(<span>errorMessage</span>);<br class="title-page-name"/>      });<br class="title-page-name"/>   }<br class="title-page-name"/>}</pre>
<ol start="4" class="calibre13">
<li class="calibre8" value="4"><strong class="calibre1">Using the edit dialog component</strong>: Finally, we will use the edit dialog component in our user profile component. The first step will be to include this component in the <kbd class="calibre11">user-profile.component.html</kbd><span><span>, as follows:</span></span></li>
</ol>
<pre class="calibre18"><span>&lt;</span><span>div </span><span>class=</span><span>"user-profile" </span><span>*ngIf=</span><span>"</span><span>user</span><span>"</span><span>&gt;</span><br class="title-page-name"/><span>...<br class="title-page-name"/>&lt;/</span><span>div</span><span>&gt;</span><br class="title-page-name"/><span>&lt;</span><span>app-edit-dialog</span><span>&gt;&lt;/</span><span>app-edit-dialog&gt;</span></pre>
<p class="mce-root">The second step will be to initialize the edit dialog component in the <kbd class="calibre11">user-profile.component.ts</kbd>, as follows:</p>
<pre class="calibre18"><span>export class </span>UserProfileComponent <span>implements </span>OnInit {<br class="title-page-name"/>   @<span>ViewChild</span>(EditDialogComponent) <span>editDialog</span>: EditDialogComponent;<br class="title-page-name"/>...<br class="title-page-name"/>}</pre>
<p class="mce-root">When the user clicks on any of the <span>Edit</span> buttons, we will need to initialize the variables and call the <kbd class="calibre11">show()</kbd> method:</p>
<pre class="calibre18"><span>onNameChange</span>() {<br class="title-page-name"/>   <span>this</span>.<span>editDialog</span>.<span>setTitle</span>(<span>'Do you want to edit name?'</span>)<br class="title-page-name"/>      .<span>setBodyTitle</span>(<span>'name'</span>)<br class="title-page-name"/>      .<span>setBodyLabel</span>(<span>'Enter new name'</span>)<br class="title-page-name"/>      .<span>setEditType</span>(EditType.<span>NAME</span>)<br class="title-page-name"/>      .<span>show</span>();<br class="title-page-name"/>}</pre>
<p class="mce-root">The following are other methods for other update operations in the <kbd class="calibre11">user-profile.component.ts</kbd>:</p>
<pre class="calibre18"><span>onEmailChange</span>() {<br class="title-page-name"/>   <span>this</span>.<span>editDialog</span>.<span>setTitle</span>(<span>'Do you want to edit email?'</span>)<br class="title-page-name"/>      .<span>setBodyTitle</span>(<span>'email'</span>)<br class="title-page-name"/>      .<span>setBodyLabel</span>(<span>'Enter new email'</span>)<br class="title-page-name"/>      .<span>setEditType</span>(EditType.<span>EMAIL</span>)<br class="title-page-name"/>      .<span>show</span>();<br class="title-page-name"/>}<br class="title-page-name"/><br class="title-page-name"/><span>onMobileChange</span>() {<br class="title-page-name"/>   <span>this</span>.<span>editDialog</span>.<span>setTitle</span>(<span>'Do you want to edit mobile?'</span>)<br class="title-page-name"/>      .<span>setBodyTitle</span>(<span>'mobile'</span>)<br class="title-page-name"/>      .<span>setBodyLabel</span>(<span>'Enter new mobile'</span>)<br class="title-page-name"/>      .<span>setEditType</span>(EditType.<span>MOBILE</span>)<br class="title-page-name"/>      .<span>show</span>();<br class="title-page-name"/>}<br class="title-page-name"/><br class="title-page-name"/><span>onPasswordChange</span>() {<br class="title-page-name"/>   <span>this</span>.<span>editDialog</span>.<span>setTitle</span>(<span>'Do you want to edit password?'</span>)<br class="title-page-name"/>      .<span>setBodyTitle</span>(<span>'password'</span>)<br class="title-page-name"/>      .<span>setBodyLabel</span>(<span>'Enter new password'</span>)<br class="title-page-name"/>      .<span>setEditType</span>(EditType.<span>PASSWORD</span>)<br class="title-page-name"/>      .<span>show</span>();<br class="title-page-name"/>}</pre>
<p class="mce-root">Finally, we configure the edit component in our user module, as follows:</p>
<pre class="calibre18"><span>import </span>{NgModule} <span>from </span><span>'@angular/core'</span>;<br class="title-page-name"/><span>import </span>{EditDialogComponent} <span>from </span><span>'../edit-dialog/edit-dialog.component'</span>;<br class="title-page-name"/><br class="title-page-name"/><span>/**<br class="title-page-name"/></span><span> * User Module<br class="title-page-name"/></span><span> */<br class="title-page-name"/></span>@<span>NgModule</span>({<br class="title-page-name"/>    <span>imports</span>: [<br class="title-page-name"/>        ...<br class="title-page-name"/>    ],<br class="title-page-name"/>    <span>declarations</span>: [<br class="title-page-name"/>        ...<br class="title-page-name"/>        EditDialogComponent<br class="title-page-name"/>    ]<br class="title-page-name"/>})<br class="title-page-name"/><span>export class </span>UserModule {<br class="title-page-name"/>}</pre>
<p class="mce-root">Now, when the user clicks on the <span>E</span><span>dit</span> button, the following edit dialog will appear:</p>
<div class="cdpaligncenter"><img src="../images/00024.jpeg" class="calibre46"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Firebase session for the update operation</h1>
                
            
            <article>
                
<p class="calibre2">When a user edits their email and password, Firebase asks for the user to log in again. Firebase throws an error when we call the <kbd class="calibre11">updatePassword()</kbd> method in <kbd class="calibre11">AngularFireAuth</kbd>, and this error is added for security reasons.</p>
<div class="title-page-name"><kbd class="calibre47">This operation is sensitive and requires recent authentication. Log in again before retrying this request.</kbd></div>
<p class="calibre2">The preceding message is shown in the alert dialog in our application, and to edit the email or password, we need to log out and refresh the session immediately and then perform the action.</p>
<p class="calibre2"><span> The best way t</span>o enhance the user experience is to ask the user to log out using the popup and refresh the token. We are not implementing this behavior as a part of this book, so you can take this as an exercise.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Summary</h1>
                
            
            <article>
                
<p class="calibre2">Congratulations on completing this chapter! This is one of the most advanced chapters. We covered many important concepts related to programming paradigm. We discussed passing the data from one module component to another module component. As a part of this, we developed two independent modules using the least dependencies. We covered RxJS library. We developed an edit component and included it in the user profile component. Finally, we covered a Firebase security feature, which expires the session while editing sensitive information, such as an email or a password.</p>
<p class="calibre2">In the next chapter, we will enhance our friends application to add the user's friends features. We will also retrieve the list of friends and display them in the list. We will add pagination to navigate to the friend list.</p>


            </article>

            
        </section>
    </body></html>