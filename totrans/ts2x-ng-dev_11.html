<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Working with Real Hosted Data</h1>
                </header>
            
            <article>
                
<p class="mce-root">Modern web applications are usually data-driven. More often than not, we need to CRUD (create, read, update, and delete) data from various resources, or consume APIs. Angular makes it easy for us to work with data from external sources for use in our components.</p>
<p>Angular provides a simple HTTP API that grants our applications HTTP functionality. It is built on the native XMLHttpRequest interface exposed by modern browsers, and with it, we can carry out any of these HTTP operations:</p>
<ul>
<li>Get: Requests data from a resource</li>
<li>Post: Submits data to a resource</li>
<li>Put: Modifies data in a resource</li>
<li>Delete: Deletes a specified resource</li>
</ul>
<p>In this chapter, we will learn how to work with Angular to consume APIs and make our applications data-driven.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Observables</h1>
                </header>
            
            <article>
                
<p><strong>Observables</strong>, similar to promises, help handle asynchronous events in an application. The key differences between Observables and promises are:</p>
<ul>
<li>Observables can handle multiple values over time, while promises are called once and return one value</li>
<li>Observables are cancellable, while promises are not</li>
</ul>
<p>To make use of Observables, Angular utilizes the <strong>Reactive Extensions for JavaScript</strong> (<strong>RxJs</strong>) Observables library. Angular makes extensive use of Observables in handling HTTP requests and responses; we will learn more about them in this chapter.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The HTTP module</h1>
                </header>
            
            <article>
                
<p>To get started with using HTTP in your components, you need to install the <kbd>HttpModule</kbd> that provides it in your application module. First, import the module:</p>
<pre><strong>import { HttpModule } from '@angular/http';</strong></pre>
<p>Next, you include the module in the array of imports registered in your application, right after <kbd>BrowserModule</kbd>:</p>
<pre>// app.module.ts<br/>@NgModule({<br/>imports: [<br/>BrowserModule,<br/>HttpModule,<br/>],<br/>})</pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Building a simple todo demo app</h1>
                </header>
            
            <article>
                
<p>Let us build a simple <kbd>todo</kbd> app to better understand how to work with data in an Angular app.</p>
<p>Angular-CLI will be used to quickly scaffold the application. The API for the application will be built with Express.js, and our Angular app will connect to this API to CRUD todo data.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Project setup</h1>
                </header>
            
            <article>
                
<p>To create a new project using the CLI:</p>
<pre><strong>ng new [project name]</strong></pre>
<div class="packt_infobox"> The <kbd>ng new</kbd> command creates a new angular application</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Building the API</h1>
                </header>
            
            <article>
                
<p>From the command line, install express, body-parser, and cors as dependencies via npm:</p>
<pre><strong>npm install express body-parser cors</strong></pre>
<div class="packt_tip">If you use npm 5, you don't need to specify the <kbd>-S</kbd> or <kbd>--save</kbd> flag to save as a dependency in your <kbd>package.json</kbd> file.</div>
<p>Next, we will create a <kbd>server.js</kbd> file in the root folder of the Angular project which will hold all our API logic:</p>
<pre>// server.js<br/>const express = require('express');<br/>const path = require('path');<br/>const http = require('http');<br/>const bodyParser = require('body-parser');<br/>const cors = require('cors');<br/>const app = express();<br/>// Get API routes<br/>const route = require('./routes/index');<br/>// Parser for POST data<br/>app.use(bodyParser.json());<br/>app.use(bodyParser.urlencoded({ extended: false }));<br/>// Use CORS<br/>app.use(cors());<br/>// Declare API routes<br/>app.use('/api', route);<br/>/**<br/>* Get port from environment. Default is 3000<br/>*/<br/>const port = process.env.PORT || '3000';<br/>/**<br/>* Create HTTP server.<br/>*/<br/>const server = http.createServer(app);<br/>/**<br/>* Listen on port<br/>*/<br/>app.listen(port, function () {<br/>console.log(`API running on port ${port}`)<br/>} );</pre>
<div class="packt_tip">This file uses new versions of ES6 so you should watch in cases where your code editors don't recognize it immediately.</div>
<p>The <kbd>/api</kbd> routes point to the <kbd>./routes/index.js</kbd> file, but we do not have it yet. In this next step, we will create it. Still in the <kbd>root</kbd> directory, create a folder named <kbd>routes</kbd> and in it a file called <kbd>index.js</kbd>:</p>
<pre>// routes/index.js<br/>const express = require('express');<br/>// create a new router object<br/>const router = express.Router();<br/>/* GET api listing. */<br/>router.get('/', (req, res) =&gt; {<br/>res.send('api works');<br/>});<br/>module.exports = router;</pre>
<p>To start the server, enter the following command:</p>
<pre>node server.js</pre>
<p>Here is the output when the server starts running:</p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-418 image-border" height="165" src="assets/7d5e1721-fed9-4540-80ce-6dc1f3e6d69b.jpg" width="427"/></div>
<p>Here we can see that the server is running and it listens on port 3000.</p>
<p>Open up your browser and visit <kbd>localhost:3000/api/</kbd>:</p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-419 image-border" height="365" src="assets/2c0f4bae-65a6-4d08-ac67-7d710127414e.jpg" width="882"/></div>
<p>If you can see the response in the preceding image, then the API works. Now we can introduce more complex logic so we have actual data to work with.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Installing diskdb</h1>
                </header>
            
            <article>
                
<p><strong>Diskdb</strong> is a lightweight disk-based JSON database with a MongoDB-like API for Node. We can install diskdb with this command:</p>
<pre><strong>npm install diskdb</strong></pre>
<p>Create a <kbd>todos.json</kbd> file at the root of the directory. This file will serve as our database collection where we have our todo items. You can learn more about diskdb here <a href="https://www.npmjs.com/package/diskdb">https://www.npmjs.com/package/diskdb</a>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Updating API endpoints</h1>
                </header>
            
            <article>
                
<p>Let us update the <kbd>routes/index.js</kbd> file with the new logic for working with our todos:</p>
<pre>// routes/index.js<br/>const express = require('express');<br/>const router = express.Router();<br/>// require diskdb<br/>const db = require('diskdb');<br/>db.connect(__dirname, ['todos']);<br/>// store Todo<br/>router.post('/todo', function(req, res, next) {<br/>var todo = req.body;<br/>if (!todo.action || !(todo.isDone + '')) {<br/>res.status(400);<br/>res.json({<br/>error: 'bad data'<br/>});<br/>} else {<br/>db.todos.save(todo);<br/>res.json(todo);<br/>}<br/>});<br/>// get Todos<br/>router.get('/todos', function(req, res, next) {<br/>const todos = db.todos.find();<br/>res.json(todos);<br/>});<br/>// update Todo<br/>router.put('/todo/:id', function(req, res, next) {<br/>const todo = req.body;<br/>db.todos.update({_id: req.params.id}, todo);<br/>res.json({ msg: `${req.params.id} updated`});<br/>});<br/>// delete Todo<br/>router.delete('/todo/:id', function(req, res, next) {<br/>db.todos.remove({<br/>_id: req.params.id<br/>});<br/>res.json({ msg: `${req.params.id} deleted` });<br/>});<br/>module.exports = router;</pre>
<p>In the preceding code, we were able to update our API with <kbd>get</kbd>, <kbd>post</kbd>, <kbd>put</kbd>, and <kbd>delete</kbd> endpoints.</p>
<p>Next, we will seed our database with some data. Updating the <kbd>todos.json</kbd> file:</p>
<pre>[{<br/>"action":"write more code",<br/>"isDone":false,"<br/>_id":"97a8ee67b6064e06aac803662d98a46c"<br/>},{<br/>"action":"help the old lady",<br/>"isDone":false,"<br/>_id":"3d14ad8d528549fc9819d8b54e4d2836"<br/>},{</pre>
<pre>"action":"study",<br/>"isDone":true,"<br/>_id":"e77cb6d0efcb4b5aaa6f16f7adf41ed6"<br/>}]</pre>
<p>Now we can restart our server and visit <kbd>localhost:3000/api/todos</kbd> to see our API in action:</p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-420 image-border" height="270" src="assets/981a9500-2ef5-416f-80dd-793714c333e2.jpg" width="1142"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">List of Todos from the database.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating an Angular component</h1>
                </header>
            
            <article>
                
<p>Next, we will create a <kbd>todo</kbd> component. We can easily do that with the Angular-CLI, with this command:</p>
<pre><strong>ng generate component todos</strong></pre>
<p>This generates the following files: <kbd>todos.component.ts</kbd>, <kbd>todos.component.html</kbd>, and <kbd>todos.component.ts</kbd>. The todos component is also automatically imported into <kbd>app.module.ts</kbd>:</p>
<pre>// app.module.ts<br/>import { BrowserModule } from '@angular/platform-browser';<br/>import { NgModule } from '@angular/core';<br/>import { AppComponent } from './app.component';<br/>import { TodosComponent } from './todos/todos.component';<br/>@NgModule({<br/>declarations: [<br/>AppComponent,<br/>TodosComponent<br/>],<br/>imports: [<br/>BrowserModule<br/>],<br/>providers: [],<br/>bootstrap: [AppComponent]<br/>})<br/>export class AppModule { }</pre>
<p>We should be sure to add a <kbd>&lt;base href="/"&gt;</kbd> within the <kbd>src/index.html</kbd> head tag. This is to tell the router how to compose navigation URLs. The <kbd>index.html</kbd> file was created automatically when we used Angular-CLI to generate the angular project:</p>
<pre>&lt;!-- index.html --&gt;<br/>&lt;!doctype html&gt;<br/>&lt;html lang="en"&gt;<br/>&lt;head&gt;<br/>&lt;meta charset="utf-8"&gt;<br/>&lt;title&gt;Data&lt;/title&gt;<br/>&lt;base href="/"&gt;<br/>&lt;meta name="viewport" content="width=device-width, initial-scale=1"&gt;<br/>&lt;link rel="icon" type="image/x-icon" href="favicon.ico"&gt;<br/>&lt;/head&gt;<br/>&lt;body&gt;<br/>&lt;app-root&gt;&lt;/app-root&gt;<br/>&lt;/body&gt;<br/>&lt;/html&gt;</pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating application routes</h1>
                </header>
            
            <article>
                
<p>Next, we will create a <kbd>/todos</kbd> route and have our app redirect to it by default.</p>
<p>First, import <kbd>RouterModule</kbd> from <kbd>@angular/router</kbd> and add it to the <kbd>AppModule</kbd> imports array:</p>
<pre>import { RouterModule } from '@angular/router';<br/>...<br/>imports: [<br/>...<br/>RouterModule.forRoot(ROUTES)<br/>],</pre>
<p>Create a <kbd>ROUTES</kbd> array just above <kbd>ngModule</kbd> declarations and add the following route definitions to it:</p>
<pre>const ROUTES = [<br/>{<br/>path: '',<br/>redirectTo: 'todos',<br/>pathMatch: 'full'<br/>},<br/>{<br/>path: 'todos',<br/>component: TodosComponent<br/>}<br/>]</pre>
<p>In the <kbd>app.component.html</kbd> file, let's add a router-outlet where we want to render the route:</p>
<pre>&lt;div style="text-align:center"&gt;<br/>&lt;h1&gt;<br/>Welcome to {{ title }}!<br/>&lt;/h1&gt;<br/>&lt;router-outlet&gt;&lt;/router-outlet&gt;</pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating a todos service</h1>
                </header>
            
            <article>
                
<p>Next, we will create a service which will handle the calls and connect our component to the express API. To generate the service with Angular-CLI:</p>
<pre><strong>ng generate service todos</strong></pre>
<p>The service is created but not registered—to register it in our app, we need to add it to the providers section of the main application module.</p>
<div class="packt_infobox">Angular-CLI does not automatically register services.</div>
<p>Add the TodosService to the providers array:</p>
<p class="mce-root"/>
<pre>import {TodosService} from './todos.service';<br/>...<br/>providers: [TodosService],<br/>...<br/>})<br/>export class AppModule { }</pre>
<p>Now, within our service, we will make HTTP calls to the express server to execute our CRUD operations. First, we will import <kbd>HTTP</kbd>, <kbd>Headers</kbd>, and <kbd>rxjs/add/operator/map</kbd>:</p>
<pre>import { Injectable } from '@angular/core';<br/>import { Http, Headers} from '@angular/http';<br/>import 'rxjs/add/operator/map';<br/>@Injectable()<br/>export class TodosService {<br/>// constructor and methods to execute the crud operations will go in here<br/>}</pre>
<p>Define a constructor and inject the HTTP service:</p>
<pre>import { Injectable } from '@angular/core';<br/>import { Http, Headers } from '@angular/http';<br/>import 'rxjs/add/operator/map';<br/>@Injectable()<br/>export class TodosService {<br/>constructor(private http: Http) {}<br/>}<br/>Next, we will define a method that will fetch all todos from the API. Updating todos.service.ts:<br/>// todo.service.ts<br/>...<br/>export class TodosService {<br/>isDone: false;<br/>constructor(private http: Http) {}<br/>// Get all todos<br/>getTodos() {<br/>return this.http<br/>.get('http://localhost:3000/api/todos')<br/>.map(res =&gt; res.json());<br/>}<br/>}</pre>
<p>In the preceding code, we make use of the <kbd>HttpModule</kbd> to make a simple <kbd>get</kbd> request to our API to retrieve a list of Todos. The response from the request is then returned in JSON format.</p>
<p>Next, we will write a method to store todo items, named <kbd>addTodos()</kbd>. This method will be used to make post requests for storing todos.</p>
<pre>// todo.service.ts<br/>...<br/>addTodos(todo) {<br/>let headers = new Headers();<br/>headers.append('Content-Type', 'application/json');<br/>return this.http<br/>.post('http://localhost:3000/api/todo', JSON.stringify(todo), { headers })<br/>.map(res =&gt; res.json());<br/>}<br/>}</pre>
<p>In the preceding code, we set up new headers and also set <kbd>Content-Type</kbd> to tell the server what type of content it will receive (<kbd>'application/json'</kbd>).</p>
<p>We made use of the <kbd>http.post()</kbd> method to make a post request. The parameter, <kbd>JSON.stringify(todo)</kbd> indicates that we want to send the new todo as a JSON encoded string. Finally, we can return the response from the API in JSON format.</p>
<p>Next, we will define a delete method called <kbd>deleteTodo()</kbd>. This method will be used to make delete requests. This enables us to delete todos from the todos list. Once again, update <kbd>todos.service.ts</kbd>:</p>
<pre>import { Injectable } from '@angular/core';<br/>import { Http, Headers } from '@angular/http';<br/>import 'rxjs/add/operator/map';<br/>@Injectable()<br/>export class TodosService {<br/>constructor(private http: Http) {}<br/>getTodos() {<br/>return this.http<br/>.get('http://localhost:3000/api/todos')<br/>.map(res =&gt; res.json());<br/>}<br/>addTodos(todo) {<br/>let headers = new Headers();<br/>headers.append('Content-Type', 'application/json');<br/>return this.http<br/>.post('http://localhost:3000/api/todo', JSON.stringify(todo), { headers })<br/>.map(res =&gt; res.json());<br/>}<br/>deleteTodo(id) {<br/>return this.http<br/>.delete(`http://localhost:3000/api/todo/${id}`)<br/>.map(res =&gt; res.json());<br/>}<br/>}</pre>
<p>In the preceding code, we defined the <kbd>deleteTodo()</kbd> method which takes the <kbd>id</kbd> of the post to be deleted as its only parameter. This method makes a delete request to the API to remove the specified todo from the database. The response from the API is also returned as JSON.</p>
<p>Finally, we will define a method called <kbd>updateStatus()</kbd>. This method will be used to make a <kbd>put</kbd> request to change the state of a todos item.</p>
<pre>import { Injectable } from '@angular/core';<br/>import { Http, Headers } from '@angular/http';<br/>import 'rxjs/add/operator/map';<br/>@Injectable()<br/>export class TodosService {<br/>isDone: false;<br/>constructor(private http: Http) {}<br/>getTodos() {<br/>return this.http<br/>.get('http://localhost:3000/api/todos')<br/>.map(res =&gt; res.json());<br/>}<br/>addTodos(todo) {<br/>let headers = new Headers();<br/>headers.append('Content-Type', 'application/json');<br/>return this.http<br/>.post('http://localhost:3000/api/todo', JSON.stringify(todo), { headers })<br/>.map(res =&gt; res.json());<br/>}<br/>deleteTodo(id) {<br/>return this.http<br/>.delete(`http://localhost:3000/api/todo/${id}`)<br/>.map(res =&gt; res.json());<br/>}<br/>updateStatus(todo) {<br/>let headers = new Headers();<br/>headers.append('Content-Type', 'application/json');<br/>return this.http<br/>.put('http://localhost:3000/api/todo/' + todo._id, JSON.stringify(todo), {<br/>headers: headers<br/>})<br/>.map(res =&gt; res.json());<br/>}<br/>}</pre>
<p>In the preceding code, we created an <kbd>updateStatus()</kbd> method which is similar to <kbd>addTodos()</kbd> method. The difference here is that the <kbd>updateStatus()</kbd> method makes a <kbd>put</kbd> request. We also concatenated <kbd>todo._id</kbd> to the API endpoint being called. This enables us to modify the state of a single item from the todos list.</p>
<p>Remember, we are making use of the HTTP API in our service, hence, we should import <kbd>HttpModule</kbd> in <kbd>app.module.ts</kbd> and include it in the imports array:</p>
<pre>import {HttpModule} from '@angular/http';<br/>...<br/>imports: [<br/>HttpModule,<br/>BrowserModule,<br/>RouterModule.forRoot(ROUTES)<br/>],<br/>...</pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Connecting the service with our todos component</h1>
                </header>
            
            <article>
                
<p>First, we have to import todos service in todos component:</p>
<pre>import {TodosService} from '../todos.service';</pre>
<p>Then add the <kbd>TodosService</kbd> class in the component's constructor:</p>
<pre>constructor(private todoService: TodosService) { }</pre>
<p>Now, we will make use of the todo service to <kbd>get</kbd>, <kbd>create</kbd>, <kbd>delete</kbd>, and <kbd>update</kbd> todos.</p>
<p>This is what our todos component should look like:</p>
<pre>import { Component, OnInit } from '@angular/core';<br/>import { TodosService } from '../todos.service';<br/>@Component({<br/>selector: 'app-todos',<br/>templateUrl: './todos.component.html',<br/>styleUrls: ['./todos.component.css']<br/>})<br/>export class TodosComponent implements OnInit {<br/>//define data types<br/>todos: any = [];<br/>todo: any;<br/>action: any;<br/>name: any;<br/>isDone: boolean;<br/>constructor(private todoService: TodosService) {}<br/>ngOnInit() {<br/>this.todoService.getTodos().subscribe(todos =&gt; {<br/>this.todos = todos;<br/>});<br/>}<br/>addTodos(event) {<br/>event.preventDefault();<br/>let newTodo = {<br/>name: this.name,<br/>action: this.action,<br/>isDone: false<br/>};<br/>this.todoService.addTodos(newTodo).subscribe(todo =&gt; {<br/>this.todos.push(todo);<br/>this.name = '';<br/>this.action = '';<br/>});<br/>}<br/>deleteTodo(id) {<br/>let todos = this.todos;<br/>this.todoService.deleteTodo(id).subscribe(data =&gt; {<br/>const index = this.todos.findIndex(todo =&gt; todo._id == id);<br/>todos.splice(index, 1)<br/>});<br/>}<br/>updateStatus(todo) {<br/>var _todo = {<br/>_id: todo._id,<br/>action: todo.action,<br/>isDone: !todo.isDone<br/>};<br/>this.todoService.updateStatus(_todo).subscribe(data =&gt; {<br/>const index = this.todos.findIndex(todo =&gt; todo._id == _todo._id)<br/>this.todos[index] = _todo;<br/>});<br/>}<br/>choice(todo) {<br/>console.log(todo);<br/>return todo.isDone;<br/>}<br/>}</pre>
<p>We just enabled communication between the service and the component. The <kbd>component.ts</kbd> file can now make use of the service and the methods in it.</p>
<p>Now that we have connected the service and component, we have to display the todos operations in the browser, and this will be done in <kbd>todos.component.html</kbd>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Implementing the view</h1>
                </header>
            
            <article>
                
<p>To display todos, we shall make use of:</p>
<ul>
<li>Angular's <kbd>*ngFor</kbd> directive, which iterates over the todos array and renders an instance of this template for each todo in that array</li>
<li>Angular's interpolation binding syntax, <kbd>{{}}</kbd></li>
</ul>
<p>Update <kbd>todos.component.html</kbd>:</p>
<pre>&lt;div class="container"&gt;<br/>&lt;form (submit) = "addTodos($event)"&gt;<br/>&lt;input type="text"<br/>class="form-control" placeholder="action"<br/>[(ngModel)] ="action" name="action"&gt;<br/>&lt;button type="submit"&gt;&lt;h4&gt;Submit&lt;/h4&gt;&lt;/button&gt;<br/>&lt;/form&gt;<br/>&lt;div *ngFor="let todo of todos"&gt;<br/>&lt;div class="container"&gt;<br/>&lt;p (click)="updateStatus(todo)" [ngStyle]="{ 'text-decoration': todo.isDone ? 'line-through' : ''}" &gt;Action: {{todo.action}}&lt;/p&gt;<br/>{{todo.isDone}}<br/>&lt;button (click) ="deleteTodo(todo._id)" &gt;Delete&lt;/button&gt;<br/>&lt;/div&gt;<br/>&lt;/div&gt;<br/>&lt;/div&gt;</pre>
<p>To make our app look better, we will make use of bootstrap. <strong>Bootstrap</strong> is a powerful front-end framework for creating web and user interface components like forms, modals, accordions, carousels, and tabs:</p>
<pre>&lt;!-- Index.html --&amp;gt;<br/>&lt;!doctype html&gt;<br/>&lt;html lang="en"&gt;<br/>&lt;head&gt;<br/>&lt;link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous"&gt;<br/>&lt;meta charset="utf-8"&gt;<br/>&lt;title&gt;Data&lt;/title&gt;<br/>&lt;base href="/"&gt;<br/>&lt;meta name="viewport" content="width=device-width, initial-scale=1"&gt;<br/>&lt;link rel="icon" type="image/x-icon" href="favicon.ico"&gt;<br/>&lt;/head&gt;<br/>&lt;body&gt;<br/>&lt;app-root&gt;&lt;/app-root&gt;<br/>&lt;/body&gt;<br/>&lt;/html&gt;</pre>
<p>Update <kbd>todos.component.html</kbd>:</p>
<pre>&lt;form (submit) = "addTodos($event)"&gt;<br/>&lt;input type="text" class="form-control" placeholder="action" [(ngModel)] ="action" name="action"&gt;<br/>&lt;button class="btn btn-primary" type="submit"&gt;&lt;h4&gt;Submit&lt;/h4&gt;&lt;/button&gt;<br/>&lt;/form&gt;<br/>&lt;div class="card pos" style="width: 20rem;" *ngFor="let todo of todos"&gt;<br/>&lt;div class="card-body"&gt;<br/>&lt;h4 class="card-title" (click)="updateStatus(todo)" [ngStyle]="{ 'text-decoration': todo.isDone ? 'line-through' : ''}"&gt;{{todo.action}}&lt;/h4&gt;<br/>&lt;p class="card-text"&gt;{{todo.isDone}}&lt;/p&gt;<br/>&lt;button (click) ="deleteTodo(todo._id)" class="btn btn-danger"&gt;Delete&lt;/button&gt;<br/>&lt;/div&gt;<br/>&lt;/div&gt;<br/>We'll also update app.component.css file to add some optional extra styling.<br/>// app.component.css<br/>.isDone{<br/>text-decoration: line-through;<br/>}<br/>.pos{<br/>margin-left: 40%;<br/>margin-top: 10px;<br/>}</pre>
<p>Open up a command line/terminal and navigate to the project folder. Run node <kbd>server.js</kbd> to start the server. Open another terminal window in the <kbd>project</kbd> folder and run <kbd>ng serve</kbd> to serve the Angular app.</p>
<p>Open up the browser and visit <kbd>localhost:4200</kbd>. This is what the result should look like the following screenshot:</p>
<div class="CDPAlignCenter CDPAlign"><img class="alignnone size-full wp-image-463 image-border" height="698" src="assets/06388fbe-6640-4e52-a8a6-d751eca2cb6c.jpg" width="1358"/></div>
<p>We have succeeded in creating a todo app by making HTTP requests to the node server through the service and then rendering the result to the DOM through the component. You can add a todo, delete a todo, get all todos and when you click on a todo, the boolean value changes and a strikethrough appears across that particular todo. When you reload the browser, you can see that the changes made to the todo list persist.</p>
<p>Let us take a brief recap of all that we have done:</p>
<ul>
<li>First, we created an Angular application using the Angular-CLI</li>
<li>Then we created a server file, where we required our dependencies, created an express app, set our API routes, declared a port for our server to listen to, added parsers for post data, and so on</li>
<li>We then defined our source of data which was a <kbd>.json</kbd> file of todos communicating with <strong>diskdb</strong></li>
<li>Created an Angular component</li>
<li>Created a service with <kbd>get</kbd>, <kbd>post</kbd>, <kbd>put</kbd>, and <kbd>delete</kbd> methods that communicate with the REST API</li>
</ul>
<p>Let us look at another example. We'll create a simple app to display a list of users together with their emails, and phone numbers. The users will also have a true or false state, indicating whether they are available or unavailable.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Build a user directory with Angular</h1>
                </header>
            
            <article>
                
<p>The application we are about to build will have a REST API which will be created during the course of this example. In this simple example, we'll be creating a <kbd>users</kbd> app which will be quite simple. The app will basically be a table which contains a list of users together with their email addresses and phone numbers. Each user in the table will have an <em>active</em> state whose value is a boolean. We will be able to change the <em>active</em> state of a particular user from false to true and vice versa. The app will give us the ability to add new users and also delete users from the table. Just like the previous example, diskDB will be used as the database for this example. We will have an Angular service which contains methods that will be responsible for communicating with the REST end points. These methods will be responsible for making <kbd>get</kbd>, <kbd>post</kbd>, <kbd>put</kbd>, and <kbd>delete</kbd> requests to the REST API. The first method in the service will be responsible for making a <kbd>get</kbd> request to the API. This will enable us to retrieve all the users from the back end. Next, we will have another method that makes a <kbd>post</kbd> request to the API. This will enable us to add new users to the array of existing users.</p>
<p>The next method we shall have will be responsible for making a <kbd>delete</kbd> request to the API in order to enable the deletion of a user. Finally, we shall have a method that makes a <kbd>put</kbd> request to the API. This will be the method that gives us the ability to edit/modify the state of a user. In order to make these requests to the REST API, we will have to make use of the HttpModule. The aim of this section is to solidify your knowledge of HTTP. As a JavaScript and, in fact, an Angular developer, you are bound to make interactions with APIs and web servers almost all the time. So much data used by developers today is in form of APIs and in order to make interactions with these APIs, we need to constantly make use of HTTP requests. As a matter of fact, HTTP is the foundation of data communication for the web.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Create a new Angular app</h1>
                </header>
            
            <article>
                
<p>As shown previously, to start a new Angular app, run the following command:</p>
<pre><strong>ng new user</strong></pre>
<p>This creates the Angular 2 user app.</p>
<p>Install the following dependencies:</p>
<ul>
<li>Express</li>
<li>Body-parser</li>
<li>Cors</li>
</ul>
<pre><strong>npm install express body-parser cors --save</strong></pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Create a Node server</h1>
                </header>
            
            <article>
                
<p>Create a file called <kbd>server.js</kbd> at the root of the project directory. This will be our node server.</p>
<p>Populate <kbd>server.js</kbd> with the following block of code:</p>
<pre>// Require dependencies<br/>const express = require('express');<br/>const path = require('path');<br/>const http = require('http');<br/>const cors = require('cors');<br/>const bodyParser = require('body-parser');<br/>// Get our API routes<br/>const route = require('./route');<br/>const app = express();<br/>app.use(bodyParser.json());<br/>app.use(bodyParser.urlencoded({ extended: false }));<br/>// Use CORS<br/>app.use(cors());<br/>// Set our api routes<br/>app.use('/api', route);<br/>/**<br/>* Get port from environment.<br/>*/<br/>const port = process.env.PORT || '3000';<br/>/**<br/>* Create HTTP server.<br/>*/<br/>const server = http.createServer(app);<br/>//Listen on provided port<br/>app.listen(port);<br/>console.log('server is listening');</pre>
<p>What's going on here is pretty simple:</p>
<ul>
<li>We required and made use of the dependencies</li>
<li>We defined and set the API routes</li>
<li>We set a port for our server to listen to</li>
</ul>
<p>The API routes are being required from <kbd>./route</kbd>, but this path does not exist yet. Let's quickly create it.</p>
<p>At the root of the project directory, create a file called <kbd>route.js</kbd>. This is where the API routes will be made. We need to have a form of a database from where we can fetch, post, delete, and modify data.</p>
<p>Just as in the previous example, we will make use of diskdb. The route will pretty much have the same pattern as in the first example.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Install diskDB</h1>
                </header>
            
            <article>
                
<p>Run the following in the project folder to install diskdb:</p>
<pre><strong>npm install diskdb</strong></pre>
<p>Create a <kbd>users.json</kbd> file at the root of the project directory to serve as our database collection where we have our users' details.</p>
<p>Populate <kbd>users.json</kbd> with the following:</p>
<pre>[{"name": "Marcel", "email": "test1@gmail.com", "phone_number":"08012345", "isOnline":false}]</pre>
<p>Now, update <kbd>route.js</kbd>.</p>
<pre>route.js<br/>const express = require('express');<br/>const router = express.Router();<br/>const db = require('diskdb');<br/>db.connect(__dirname, ['users']);<br/>//save<br/>router.post('/users', function(req, res, next) {<br/>var user = req.body;<br/>if (!user.name &amp;&amp; !(user.email + '') &amp;&amp; !(user.phone_number + '') &amp;&amp; !(user.isActive + '')) {<br/>res.status(400);<br/>res.json({<br/>error: 'error'<br/>});<br/>} else {<br/>console.log('ds');<br/>db.users.save(todo);<br/>res.json(todo);<br/>}<br/>});<br/>//get<br/>router.get('/users', function(req, res, next) {<br/>var foundUsers = db.users.find();<br/>console.log(foundUsers);<br/>res.json(foundUsers);<br/>foundUsers = db.users.find();<br/>console.log(foundUsers);<br/>});<br/>//updateUsers<br/>router.put('/user/:id', function(req, res, next) {<br/>var updUser = req.body;<br/>console.log(updUser, req.params.id)<br/>db.users.update({_id: req.params.id}, updUser);<br/>res.json({ msg: req.params.id + ' updated' });<br/>});<br/>//delete<br/>router.delete('/user/:id', function(req, res, next) {<br/>console.log(req.params);<br/>db.users.remove({<br/>_id: req.params.id<br/>});<br/>res.json({ msg: req.params.id + ' deleted' });<br/>});<br/>module.exports = router;</pre>
<p>We've created a REST API with the API routes, using diskDB as the database.</p>
<p>Start the server using the following command:</p>
<pre><strong>node server.js</strong></pre>
<p>The server is running and it is listening to the assigned port. Now, open up the browser and go to <kbd>http://localhost:3000/api/users</kbd>.</p>
<p>Here, we can see the data that we imputed to the <kbd>users.json</kbd> file. This shows that our routes are working and we are getting data from the database.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Create a new component</h1>
                </header>
            
            <article>
                
<p>Run the following command to create a new component:</p>
<pre><strong>ng g component user</strong></pre>
<p>This creates <kbd>user.component.ts</kbd>, <kbd>user.component.html</kbd>, <kbd>user.component.css</kbd> and <kbd>user.component.spec.ts</kbd> files. <kbd>User.component.spec.ts</kbd> is used for testing, therefore we will not be making use of it in this chapter. The newly created component is automatically imported into <kbd>app.module.ts</kbd>. We have to tell the root component about the user component. We'll do this by importing the selector from <kbd>user.component.ts</kbd> into the root template component (<kbd>app.component.html</kbd>):</p>
<pre>&lt;div style="text-align:center"&gt;<br/>&lt;app-user&gt;&lt;/app-user&gt;<br/>&lt;/div&gt;</pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Create a service</h1>
                </header>
            
            <article>
                
<p>The next step is to create a service that interacts with the API that we created earlier:</p>
<pre><strong>ng generate service user</strong></pre>
<p>This creates a user service called the <kbd>user.service.ts</kbd>. Next, import <kbd>UserService</kbd> class into <kbd>app.module.ts</kbd> and include it to the providers array:</p>
<pre>Import rxjs/add/operator/map in the imports section.<br/>import { Injectable } from '@angular/core';<br/>import { Http, Headers } from '@angular/http';<br/>import 'rxjs/add/operator/map';<br/>Within the UserService class, define a constructor and pass in the angular 2 HTTP service.<br/>import { Injectable } from '@angular/core';<br/>import { Http, Headers } from '@angular/http';<br/>import 'rxjs/add/operator/map';<br/>@Injectable()<br/>export class UserService {<br/>constructor(private http: Http) {}<br/>}</pre>
<p>Within the service class, write a method that makes a <kbd>get</kbd> request to fetch all users and their details from the API:</p>
<pre>getUser() {<br/>return this.http<br/>.get('http://localhost:3000/api/users')<br/>.map(res =&gt; res.json());<br/>}</pre>
<p>Write the method that makes a <kbd>post</kbd> request and creates a new todo:</p>
<pre>addUser(newUser) {<br/>var headers = new Headers();<br/>headers.append('Content-Type', 'application/json');<br/>return this.http<br/>.post('http://localhost:3000/api/user', JSON.stringify(newUser), {<br/>headers: headers<br/>})<br/>.map(res =&gt; res.json());<br/>}</pre>
<p>Write another method that makes a <kbd>delete</kbd> request. This will enable us to delete a user from the collection of users:</p>
<pre>deleteUser(id) {<br/>return this.http<br/>.delete('http://localhost:3000/api/user/' + id)<br/>.map(res =&gt; res.json());<br/>}</pre>
<p>Finally, write a method that makes a <kbd>put</kbd> request. This method will enable us to modify the state of a user:</p>
<pre>updateUser(user) {<br/>var headers = new Headers();<br/>headers.append('Content-Type', 'application/json');<br/>return this.http<br/>.put('http://localhost:3000/api/user/' + user._id, JSON.stringify(user), {<br/>headers: headers<br/>})<br/>.map(res =&gt; res.json());<br/>}</pre>
<p>Update <kbd>app.module.ts</kbd> to import <kbd>HttpModule</kbd> and <kbd>FormsModule</kbd> and include them to the imports array:</p>
<pre>import { HttpModule } from '@angular/http';<br/>import { FormsModule } from '@angular/forms';<br/>.....<br/>imports: [<br/>.....<br/>HttpModule,<br/>FormsModule<br/>]</pre>
<p>The next thing to do is to teach the user component to use the service:</p>
<pre>Import UserService in user.component.ts.<br/>import {UserService} from '../user.service';<br/>Next, include the service class in the user component constructor.<br/>constructor(private userService: UserService) { }.<br/>Just below the exported UserComponent class, add the following properties and define their data types:<br/>users: any = [];<br/>user: any;<br/>name: any;<br/>email: any;<br/>phone_number: any;<br/>isOnline: boolean;</pre>
<p>Now, we can make use of the methods from the user service in the user component.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Updating user.component.ts</h1>
                </header>
            
            <article>
                
<p>Within the <kbd>ngOnInit</kbd> method, make use of the user service to <kbd>get</kbd> all users from the API:</p>
<pre>ngOnInit() {<br/>this.userService.getUser().subscribe(users =&gt; {<br/>console.log(users);<br/>this.users = users;<br/>});<br/>}</pre>
<p>Below the <kbd>ngOnInit</kbd> method, write a method that makes use of the <kbd>post</kbd> method in the user service to add new users:</p>
<pre>addUser(event) {<br/>event.preventDefault();<br/>var newUser = {<br/>name: this.name,<br/>email: this.email,<br/>phone_number: this.phone_number,<br/>isOnline: false<br/>};<br/>this.userService.addUser(newUser).subscribe(user =&gt; {<br/>this.users.push(user);<br/>this.name = '';<br/>this.email = '';<br/>this.phone_number = '';<br/>});<br/>}</pre>
<p>Let's make use of the <kbd>delete</kbd> method from the user service to enable us to delete users:</p>
<pre>deleteUser(id) {<br/>var users = this.users;<br/>this.userService.deleteUser(id).subscribe(data =&gt; {<br/>console.log(id);<br/>const index = this.users.findIndex(user =&gt; user._id == id);<br/>users.splice(index, 1)<br/>});<br/>}</pre>
<p>Finally, we'll make use of user service to make <kbd>put</kbd> requests to the API:</p>
<pre>updateUser(user) {<br/>var _user = {<br/>_id: user._id,<br/>name: user.name,<br/>email: user.email,<br/>phone_number: user.phone_number,<br/>isActive: !user.isActive<br/>};<br/>this.userService.updateUser(_user).subscribe(data =&gt; {<br/>const index = this.users.findIndex(user =&gt; user._id == _user._id)<br/>this.users[index] = _user;<br/>});<br/>}</pre>
<p>We have all our communication with the API, service, and component. We have to update <kbd>user.component.html</kbd> in order to illustrate all that we have done in the browser.</p>
<p>We'll be making use of bootstrap for styling. So, we have to import the bootstrap CDN in <kbd>index.html</kbd>:</p>
<pre>&lt;!doctype html&gt;<br/>&lt;html lang="en"&gt;<br/>&lt;head&gt;<br/>//bootstrap CDN<br/>&lt;link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous"&gt;<br/>&lt;meta charset="utf-8"&gt;<br/>&lt;title&gt;User&lt;/title&gt;<br/>&lt;base href="/"&gt;<br/>&lt;meta name="viewport" content="width=device-width, initial-scale=1"&gt;<br/>&lt;link rel="icon" type="image/x-icon" href="favicon.ico"&gt;<br/>&lt;/head&gt;<br/>&lt;body&gt;<br/>&lt;app-root&gt;&lt;/app-root&gt;<br/>&lt;/body&gt;<br/>&lt;/html&gt;</pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Updating user.component.html</h1>
                </header>
            
            <article>
                
<p>Here is the component template for the user component:</p>
<pre>&lt;form class="form-inline" (submit) = "addUser($event)"&gt;<br/>&lt;div class="form-row"&gt;<br/>&lt;div class="col"&gt;<br/>&lt;input type="text" class="form-control" [(ngModel)] ="name" name="name"&gt;<br/>&lt;/div&gt;<br/>&lt;div class="col"&gt;<br/>&lt;input type="text" class="form-control" [(ngModel)] ="email" name="email"&gt;<br/>&lt;/div&gt;<br/>&lt;div class="col"&gt;<br/>&lt;input type="text" class="form-control" [(ngModel)] ="phone_number" name="phone_number"&gt;<br/>&lt;/div&gt;<br/>&lt;/div&gt; &lt;br&gt;<br/>&lt;button class="btn btn-primary" type="submit" (click) = "addUser($event)"&gt;&lt;h4&gt;Add User&lt;/h4&gt;&lt;/button&gt;<br/>&lt;/form&gt;<br/>&lt;table class="table table-striped" &gt;<br/>&lt;thead&gt;<br/>&lt;tr&gt;<br/>&lt;th&gt;Name&lt;/th&gt;<br/>&lt;th&gt;Email&lt;/th&gt;<br/>&lt;th&gt;Phone_Number&lt;/th&gt;<br/>&lt;th&gt;Active&lt;/th&gt;<br/>&lt;/tr&gt;<br/>&lt;/thead&gt;<br/>&lt;tbody *ngFor="let user of users"&gt;<br/>&lt;tr&gt;<br/>&lt;td&gt;{{user.name}}&lt;/td&gt;<br/>&lt;td&gt;{{user.email}}&lt;/td&gt;<br/>&lt;td&gt;{{user.phone_number}}&lt;/td&gt;<br/>&lt;td&gt;{{user.isActive}}&lt;/td&gt;<br/>&lt;td&gt;&lt;input type="submit" class="btn btn-warning" value="Update Status" (click)="updateUser(user)" [ngStyle]="{ 'text-decoration-color:': user.isActive ? 'blue' : ''}"&gt;&lt;/td&gt;<br/>&lt;td&gt;&lt;button (click) ="deleteUser(user._id)" class="btn btn-danger"&gt;Delete&lt;/button&gt;&lt;/td&gt;<br/>&lt;/tr&gt;<br/>&lt;/tbody&gt;<br/>&lt;/table&gt;</pre>
<p>A lot is going on in the preceding code, let's drill down into the code block:</p>
<ul>
<li>We have a form which takes in three inputs and a submit button which triggers the <kbd>addUser()</kbd> method when clicked</li>
<li>There is a <span class="packt_screen">delete</span> button which triggers the <kbd>delete</kbd> method when it is clicked</li>
<li>There is also an update status input element that triggers the <kbd>updateUser()</kbd> method when clicked</li>
<li>We created a table in which our users' details will be displayed utilizing Angular's <kbd>*ngFor</kbd> directive and Angular's interpolation binding syntax, <kbd>{{}}</kbd></li>
</ul>
<p>Some extra styling will be added to the project. Go to <kbd>user.component.css</kbd> and add the following:</p>
<pre>form{<br/>margin-top: 20px;<br/>margin-left: 20%;<br/>size: 50px;<br/>}<br/>table{<br/>margin-top:20px;<br/>height: 50%;<br/>width: 50%;<br/>margin-left: 20%;<br/>}<br/>button{<br/>margin-left: 20px;<br/>}</pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Running the app</h1>
                </header>
            
            <article>
                
<p>Open up two command line interfaces/terminals. In both of them, navigate to the project directory. Run node <kbd>server.js</kbd> to start the server in one. Run <kbd>ng serve</kbd> in the other to serve the Angular 2 app.</p>
<p>Open up the browser and go to <kbd>localhost:4200</kbd>.</p>
<p>In this simple users app, we can perform all CRUD operations. We can create new users, get users, delete users, and update the state of users.</p>
<p>By default, a newly added user's active state is false. That can be changed by clicking on the <span class="packt_screen">change state</span> button.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>Working with actual data from a database or from an API is quite important when developing any application. HTTP along with observables and Rxjs made it possible to work with the desired set of data from an API, and also perform all CRUD operations.</p>
<p>In the next chapter, we'll be taking a look at writing unit tests and debugging.</p>
<p> </p>


            </article>

            
        </section>
    </body></html>