<html><head></head><body>
        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">AWS S3 for Image Upload and Wrapping Up Key Application Features</h1>
            

            <article>
                
<p class="calibre2">Currently we have an app that works but is missing some key features. Our focus for this chapter will include the following feature implementations/improvements:</p>
<ul class="calibre14">
<li class="calibre15">Opening a new AWS account</li>
<li class="calibre15">Creating <strong class="calibre1">Identity and Access Management</strong> (<strong class="calibre1">IAM</strong>) for your AWS account</li>
<li class="calibre15">Setting up an AWS S3 bucket</li>
<li class="calibre15">Adding the ability to upload a photo for an article (add and edit article covers)</li>
<li class="calibre15">Adding the ability to set up a title, subtitle, and "overlay subtitle" (on the add/edit article views)</li>
</ul>
<p class="calibre2">Articles on the dashboard currently have HTML in the content; we need to improve that:</p>
<div class="packt_figure"><img class="image-border48" src="../images/00053.jpeg"/></div>
<p class="calibre2">We need to finish this stuff. After we are done with these improvements, we will do some refactoring.</p>


            </article>

            <footer class="calibre4">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">AWS S3 - an introduction</h1>
            

            <article>
                
<p class="calibre2">Amazon's AWS S3 is a simple storage service for static assets such as images on Amazon's servers. It helps you host safe, secure, and highly scalable objects (as images) in the cloud.</p>
<p class="calibre2">This approach of storingÂ static assets online is quite convenient and easy--this is why we will use it throughout our book.</p>
<p class="calibre2">We will use it in our application, as it gives us many scalability features that wouldn't be so easy to access when hosting image assets on our own Node.js server.</p>
<p class="calibre2">In general, Node.js shouldn't be used for hosting assets larger than what we use it for now. Don't even think of implementing an image-upload mechanism (not recommended at all) on the Node.js server--we will employ Amazon's services for that.</p>


            </article>

            <footer class="calibre4">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">Generating keys (access key ID and secret key)</h1>
            

            <article>
                
<p class="calibre2">Before we start adding a new S3 bucket, we need to generate keys for our AWS account (<kbd class="calibre11">accessKeyId</kbd> and <kbd class="calibre11">secretAccessKey</kbd>).</p>
<p class="calibre2">An example set of details that we will need to keep in our Node.js app is as follows:</p>
<pre class="calibre22">
const awsConfig = { <br class="title-page-name"/>  accessKeyId: 'EXAMPLE_LB7XH_KEY_BGTCA', <br class="title-page-name"/>  secretAccessKey: 'ExAMpLe+KEY+FYliI9J1nvky5g2bInN26TCU+FiY', <br class="title-page-name"/>  region: 'us-west-2', <br class="title-page-name"/>  bucketKey: 'your-bucket-name-' <br class="title-page-name"/>};
</pre>
<p class="calibre2">What is a bucket in Amazon S3? A <strong class="calibre1">bucket</strong> is a kind of namespace for files that you have in Amazon S3. You can have several buckets associated with different projects. As you can see, our next steps will be creating the <kbd class="calibre11">accessKeyId</kbd> and <kbd class="calibre11">secretAccessKey</kbd> associated with your <kbd class="calibre11">accountDefine</kbd> and <kbd class="calibre11">bucketKey</kbd> (kind of a namespace for the pictures for our articles). Define a region where you want to keep the files physically. If your project has a target specified for a location, it will speed up the loading of images and, in general, limit the latency because an image will be hosted closer to the client/user of our publishing application.</p>
<p class="calibre2">To create an AWS account, go to <a href="https://aws.amazon.com/" class="calibre6"><span>https://aws.amazon.com/</span></a>:</p>
<div class="packt_figure"><img class="image-border49" src="../images/00054.jpeg"/></div>
<p class="calibre2">Create an account or sign in to your account:</p>
<div class="packt_figure"><img class="image-border50" src="../images/00055.jpeg"/></div>
<p class="calibre2">The next step is to create the IAM, described in detail in the next section.</p>
<div class="packt_infobox"><strong class="calibre26">Regarding AWS creation<br class="calibre24"/></strong>After you create an account for a certain region, if you want to create an S3 bucket, you need to choose the same region your account is assigned to; otherwise, you may have problems while setting up S3 in the following pages.</div>


            </article>

            <footer class="calibre4">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">IAM</h1>
            

            <article>
                
<p class="calibre2">Let's prepare our new <kbd class="calibre11">accessKeyId</kbd> and <kbd class="calibre11">secretAccessKey</kbd>. You need to visit the IAM page in your Amazon console. You can find it in the <span>Services</span> list:</p>
<div class="packt_figure"><img class="image-border51" src="../images/00056.jpeg"/></div>
<p class="calibre2">The IAM page looks like this (<a href="https://console.aws.amazon.com/iam/home?#home" class="calibre6"><span>https://console.aws.amazon.com/iam/home?#home</span></a>):</p>
<div class="packt_figure"><img class="image-border52" src="../images/00057.jpeg"/></div>
<p class="calibre2">Go to <span>IAM Resources</span> | <span>Users</span>:</p>
<div class="packt_figure"><img class="image-border53" src="../images/00058.jpeg"/></div>
<p class="calibre2">On the next page, you will see a button; click on it:</p>
<div class="packt_figure"><img class="image-border54" src="../images/00059.jpeg"/></div>
<p class="calibre2">After clicking, you will see a form. Fill it in with at least one user, as in this screenshot (the screenshots are giving you the exact steps that you must accomplish, even if AWS's UX has been changed in the meantime):</p>
<div class="packt_figure"><img class="image-border55" src="../images/00060.jpeg"/></div>
<p class="calibre2">After clicking on the <span>Create</span> button, copy the keys to a safe place (we will use them in a moment):</p>
<div class="packt_figure"><img class="image-border56" src="../images/00061.jpeg"/></div>
<div class="packt_infobox">Do not forget to copy the keys (access key ID and secret access key). You will learn where to put them in the code in order to use S3 services later in the book. Of course, the ones in the screenshot aren't active. They are only examples; you need to have your own.</div>


            </article>

            <footer class="calibre4">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">Setting up S3 permissions for the user</h1>
            

            <article>
                
<p class="calibre2">The last thing is to add AmazonS3FullAccess permissions with the following steps:</p>
<ol class="calibre17">
<li value="1" class="calibre15">Go to the <span>Permissions</span> tab:</li>
</ol>
<div class="packt_figure"><img class="image-border57" src="../images/00062.jpeg"/></div>
<ol start="2" class="calibre17">
<li value="2" class="calibre15">Click on <span>Attach Policy</span> and choose <span>AmazonS3FullAccessAfter</span>. After attaching it, it will be listed as in the following example:</li>
</ol>
<div class="packt_figure"><img class="image-border58" src="../images/00063.jpeg"/></div>
<p class="calibre2">Now we'll move on to creating a new bucket for the image files.</p>
<ol class="calibre17">
<li value="1" class="calibre15">You are done with the keys and you have granted the S3 policy for the keys; now, we need to prepare the bucket that will keep the images. First of all, you need to go to the AWS console main page, which looks as follows (<a href="https://console.aws.amazon.com/console/home" class="calibre6"><span>https://console.aws.amazon.com/console/home</span></a>):</li>
</ol>
<div class="packt_figure"><img class="image-border59" src="../images/00064.jpeg"/></div>
<ol start="2" class="calibre17">
<li value="2" class="calibre15">You will see something like <span>AWS Services SHOW ALL SERVICES</span> (alternatively, find it from the <span>Services</span> list the same way as <span>IAM</span>):</li>
</ol>
<div class="packt_figure"><img class="image-border60" src="../images/00065.jpeg"/></div>
<ol start="3" class="calibre17">
<li value="3" class="calibre15">Click on <span>S3 - Scalable Storage in the Cloud</span> (as in the previous screenshot). After that, you will see a view similar to this (I have six buckets; you will have zero when you have a new account):</li>
</ol>
<div class="packt_figure"><img class="image-border61" src="../images/00066.jpeg"/></div>
<p class="calibre28">In that bucket, we will keep the static images of our articles (you will learn how exactly in the coming pages).</p>
<ol start="4" class="calibre17">
<li value="4" class="calibre15">Create a bucket by clicking on the <span>Create Bucket</span> button:</li>
</ol>
<div class="packt_figure"><img class="image-border62" src="../images/00067.jpeg"/></div>
<ol start="5" class="calibre17">
<li value="5" class="calibre15">Choose the<span>publishing-app</span> name (or another that works for you).</li>
</ol>
<div class="packt_figure"><img class="image-border63" src="../images/00068.jpeg"/></div>
<div class="packt_infobox">In the screenshot, we have chosen <span class="packt_screen">Frankfurt</span>. But if, for example, when you create an account and your URL shows <kbd class="calibre23">"?region=us-west-2"</kbd>, then choose <span class="packt_screen">Oregon</span>. It's important to create the S3 bucket in the region that you have assigned your account to.</div>
<ol start="6" class="calibre17">
<li value="6" class="calibre15">After the bucket has been created, click on it from the bucket list:</li>
</ol>
<div class="packt_figure"><img class="image-border64" src="../images/00069.jpeg"/></div>
<ol start="7" class="calibre17">
<li value="7" class="calibre15">The empty bucket with the <span>publishing-app</span> name will look as follows:</li>
</ol>
<div class="packt_figure"><img class="image-border65" src="../images/00070.jpeg"/></div>
<ol start="8" class="calibre17">
<li value="8" class="calibre15">When you are in this view, the URL in the browser tells you the exact region and bucket (so you can use it later when performing configuration on the backend):</li>
</ol>
<pre class="calibre22">
        // just an example link to the bucket <br class="title-page-name"/>        https://console.aws.amazon.com/s3/home?region=eu-central-  <br class="title-page-name"/>        1&amp;bucket=publishing-app&amp;prefix=
</pre>
<ol start="9" class="calibre17">
<li value="9" class="calibre15">The last thing is to make sure that the <span>CORS</span> configuration for the <span>publishing-app</span> bucket is correct. Click on the <span>Properties</span> tab in that view, and you will get a detailed view of it:</li>
</ol>
<div class="packt_figure"><img class="image-border66" src="../images/00071.jpeg"/></div>
<ol start="10" class="calibre17">
<li value="10" class="calibre15">Then, click on the <span>Add CORS</span> button:</li>
</ol>
<div class="packt_figure"><img class="image-border67" src="../images/00072.jpeg"/></div>
<ol start="11" class="calibre17">
<li value="11" class="calibre15">After that, paste the following into the text areaÂ  (the following is the cross-origin resource sharing definition; it defines a way for the Pub app which is loaded in one domain to interact with resources in a different domain within the AWS services):</li>
</ol>
<pre class="calibre22">
        &lt;?xml version="1.0" encoding="UTF-8"?&gt; <br class="title-page-name"/>        &lt;CORSConfiguration title-page-name"/&gt;         /doc/2006-03-01/"&gt; <br class="title-page-name"/>            &lt;CORSRule&gt; <br class="title-page-name"/>                &lt;AllowedOrigin&gt;*&lt;/AllowedOrigin&gt; <br class="title-page-name"/>                &lt;AllowedMethod&gt;GET&lt;/AllowedMethod&gt; <br class="title-page-name"/>                &lt;AllowedMethod&gt;POST&lt;/AllowedMethod&gt; <br class="title-page-name"/>                &lt;AllowedMethod&gt;PUT&lt;/AllowedMethod&gt; <br class="title-page-name"/>                &lt;MaxAgeSeconds&gt;3000&lt;/MaxAgeSeconds&gt; <br class="title-page-name"/>                &lt;AllowedHeader&gt;*&lt;/AllowedHeader&gt; <br class="title-page-name"/>            &lt;/CORSRule&gt; <br class="title-page-name"/>        &lt;/CORSConfiguration&gt;
</pre>
<ol start="12" class="calibre17">
<li value="12" class="calibre15">It will now look like the following example:</li>
</ol>
<div class="packt_figure"><img class="image-border68" src="../images/00073.jpeg"/></div>
<ol start="13" class="calibre17">
<li value="13" class="calibre15">Click on the <span>SaveÂ </span>button. After all the steps are done, we can start with coding the image upload feature.</li>
</ol>


            </article>

            <footer class="calibre4">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">Coding the image upload feature in the AddArticleView</h1>
            

            <article>
                
<p class="calibre2">Before you are able to continue, you need to have your access details for your S3 bucket that you created in the previous pages. <kbd class="calibre11">AWS_ACCESS_KEY_ID</kbd> comes from a previous subsection, where we created a user while being in that view:</p>
<div class="packt_figure"><img class="image-border69" src="../images/00074.jpeg"/></div>
<p class="calibre2"><kbd class="calibre11">AWS_SECRET_ACCESS_KEY</kbd> is the same as the AWS access key (as you can already guess by the name itself). <kbd class="calibre11">AWS_BUCKET_NAME</kbd> is the name of your bucket (in our book, we've called it <span>publishing-app</span>). For <kbd class="calibre11">AWS_REGION_NAME</kbd>, we will use <kbd class="calibre11">eu-central-1</kbd>.</p>
<div class="packt_infobox">The easiest way to find <kbd class="calibre23">AWS_BUCKET_NAME</kbd> and <kbd class="calibre23">AWS_REGION_NAME</kbd> is to look at the URL while you are in that view (described in the previous subsection).</div>
<div class="packt_figure"><img class="image-border70" src="../images/00075.jpeg"/></div>
<p class="calibre2">Check the browser's URL in that view: <kbd class="calibre11">https://console.aws.amazon.com/s3/home?region=eu-central-1#&amp;bucket=publishing-app&amp;prefix=</kbd></p>
<p class="calibre2">The region and bucket names are clearly in that URL (I want to make this very clear as your region and bucket name can be different, depending on where you live).</p>
<div class="packt_infobox">Also, make sure that your CORS are set up correctly and your permissions/attach policy is done exactly as described above. Otherwise, you can have problems with everything described in the following subsections.</div>


            </article>

            <footer class="calibre4">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">Environment variables in Node.js</h1>
            

            <article>
                
<p class="calibre2">We will pass all four parameters (<kbd class="calibre11">AWS_ACCESS_KEY_ID</kbd>, <kbd class="calibre11">AWS_SECRET_ACCESS_KEY</kbd>, <kbd class="calibre11">AWS_BUCKET_NAME</kbd>, and <kbd class="calibre11">AWS_REGION_NAME</kbd>) via the node's environment variables.</p>
<p class="calibre2">First, let's install a node library that will create environment variables from a file so that we will be able to use them within our localhost:</p>
<pre class="calibre22">
<strong class="calibre1">npm i -save node-env-file@0.1.8</strong>
</pre>
<p class="calibre2">What are these environment variables? In general, we will use them to pass the variables of some sensitive data to the app--we are talking here specifically about AWS secret keys and MongoDB's login/password information for the current environment setup (if it is development or production).</p>
<p class="calibre2">You can read those environment variables via accessing them, like in the following examples:</p>
<pre class="calibre22">
// this is how we will access the variables in <br class="title-page-name"/>//the server.js for example: <br class="title-page-name"/>env.process.AWS_ACCESS_KEY_ID <br class="title-page-name"/>env.process.AWS_SECRET_ACCESS_KEY <br class="title-page-name"/>env.process.AWS_BUCKET_NAME <br class="title-page-name"/>env.process.AWS_REGION_NAME
</pre>
<p class="calibre2">In our local development environment, we will keep that information in the server's directory, so do this from your command prompt:</p>
<pre class="calibre22">
<strong class="calibre1">$ [[you are in the server/ directory of your project]]</strong><br class="title-page-name"/><strong class="calibre1">$ touch .env</strong>
</pre>
<p class="calibre2">You have created a <kbd class="calibre11">server/.env</kbd> file; the next step is to put content in it (from this file, the <kbd class="calibre11">node-env-file</kbd> will read the environment variables when our app is running):</p>
<pre class="calibre22">
AWS_ACCESS_KEY_ID=_*_*_*_*_ACCESS_KEY_HERE_*_*_*_*_ <br class="title-page-name"/>AWS_SECRET_ACCESS_KEY=_*_*_*_*_SECRET_KEY_HERE_*_*_*_*_ <br class="title-page-name"/>AWS_BUCKET_NAME=publishing-app <br class="title-page-name"/>AWS_REGION_NAME=eu-central-1
</pre>
<p class="calibre2">Here, you can see the structure of a node's environment file. Each new line comes with a key and value. There, you need to paste the keys you created while reading this chapter. Replace those values with your own: <kbd class="calibre11">*_*_ACCESS_KEY_HERE_*_</kbd> and <kbd class="calibre11">_*_SECRET_KEY_HERE_**_</kbd>.</p>
<p class="calibre2">After you have created the <kbd class="calibre11">server/.env</kbd> file, install the required dependency that will abstract the whole gig with the image upload; use <kbd class="calibre11">npm</kbd> for this when in the project's directory:</p>
<pre class="calibre22">
<strong class="calibre1">npm i --save react-s3-uploader@3.0.3</strong>
</pre>
<p class="calibre2"><a class="calibre6">The</a> <kbd class="calibre11">react-s3-uploader</kbd> component works quite well for our use case, and it abstracts the <kbd class="calibre11">aws-sdk</kbd> features for us quite well. The main point here is that we need to have configured the <kbd class="calibre11">.env</kbd> file well (with the correct variables) and the <kbd class="calibre11">react-s3-uploader</kbd> will do the job at the backend and frontend for us (as you will see soon).</p>


            </article>

            <footer class="calibre4">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">Improving our Mongoose article schema</h1>
            

            <article>
                
<p class="calibre2">We need to improve the schema, so we will have a place in our article collection for storing the URL of an image. Edit the old article schema:</p>
<pre class="calibre22">
// this is old codebase to improve: <br class="title-page-name"/>var articleSchema = new Schema({ <br class="title-page-name"/>    articleTitle: String, <br class="title-page-name"/>    articleContent: String, <br class="title-page-name"/>    articleContentJSON: Object <br class="title-page-name"/>  },  <br class="title-page-name"/>  {  <br class="title-page-name"/>    minimize: false  <br class="title-page-name"/>  } <br class="title-page-name"/>);
</pre>
<p class="calibre2">Change it to the new, improved version:</p>
<pre class="calibre22">
var articleSchema = new Schema({ <br class="title-page-name"/>    articleTitle: String, <br class="title-page-name"/>    articleContent: String, <br class="title-page-name"/>    articleContentJSON: Object, <br class="title-page-name"/>    articlePicUrl: { type: String, default: <br class="title-page-name"/>     '/static/placeholder.png' } <br class="title-page-name"/>  },  <br class="title-page-name"/>  {  <br class="title-page-name"/>    minimize: false  <br class="title-page-name"/>  } <br class="title-page-name"/>);
</pre>
<p class="calibre2">As you can see, we have introduced the <kbd class="calibre11">articlePicUrl</kbd> with a default value of <kbd class="calibre11">/static/placeholder.png</kbd>. Now, we will be able to save an article with a picture's URL variable in the article's object.</p>
<div class="packt_infobox">If you forgot to update the Mongoose model, then it won't let you save that value into the database.</div>


            </article>

            <footer class="calibre4">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">Adding routes for S3's upload</h1>
            

            <article>
                
<p class="calibre2">We need to import one new library into the <kbd class="calibre11">server/server.js</kbd> file:</p>
<pre class="calibre22">
import s3router from 'react-s3-uploader/s3router';
</pre>
<p class="calibre2">We'll end up with something like the following:</p>
<pre class="calibre22">
// don't write it, this is how your server/server.js <br class="title-page-name"/> //file should look like: <br class="title-page-name"/>import http from 'http'; <br class="title-page-name"/>import express from 'express'; <br class="title-page-name"/>import cors from 'cors'; <br class="title-page-name"/>import bodyParser from 'body-parser'; <br class="title-page-name"/>import falcor from 'falcor'; <br class="title-page-name"/>import falcorExpress from 'falcor-express'; <br class="title-page-name"/>import FalcorRouter from 'falcor-router'; <br class="title-page-name"/>import routes from './routes.js'; <br class="title-page-name"/><br class="title-page-name"/>import React from 'react' <br class="title-page-name"/>import { createStore } from 'redux' <br class="title-page-name"/>import { Provider } from 'react-redux' <br class="title-page-name"/>import { renderToStaticMarkup } from 'react-dom/server' <br class="title-page-name"/>import ReactRouter from 'react-router'; <br class="title-page-name"/>import { RoutingContext, match } from 'react-router'; <br class="title-page-name"/>import * as hist  from 'history'; <br class="title-page-name"/>import rootReducer from '../src/reducers'; <br class="title-page-name"/>import reactRoutes from '../src/routes'; <br class="title-page-name"/>import fetchServerSide from './fetchServerSide'; <br class="title-page-name"/><br class="title-page-name"/>import s3router from 'react-s3-uploader/s3router'; <br class="title-page-name"/><br class="title-page-name"/><br class="title-page-name"/>var app = express(); <br class="title-page-name"/>app.server = http.createServer(app); <br class="title-page-name"/><br class="title-page-name"/>// CORS - 3rd party middleware <br class="title-page-name"/>app.use(cors()); <br class="title-page-name"/><br class="title-page-name"/>// This is required by falcor-express middleware <br class="title-page-name"/>// to work correctly with falcor-browser <br class="title-page-name"/>app.use(bodyParser.json({extended: false})); <br class="title-page-name"/>app.use(bodyParser.urlencoded({extended: false}));
</pre>
<p class="calibre2">I'm putting all this here so you can make sure that your <kbd class="calibre11">server/server.js</kbd> file matches this.</p>
<p class="calibre2">One more thing to do is to modify the <kbd class="calibre11">server/index.js</kbd> file. Find this:</p>
<pre class="calibre22">
require('babel-core/register'); <br class="title-page-name"/>require('babel-polyfill'); <br class="title-page-name"/>require('./server');
</pre>
<p class="calibre2">Change it to the following improved version:</p>
<pre class="calibre22">
var env = require('node-env-file'); <br class="title-page-name"/>// Load any undefined ENV variables form a specified file. <br class="title-page-name"/>env(__dirname + '/.env'); <br class="title-page-name"/><br class="title-page-name"/>require('babel-core/register'); <br class="title-page-name"/>require('babel-polyfill'); <br class="title-page-name"/>require('./server');
</pre>
<p class="calibre2">Just for clarification, <kbd class="calibre11">env(__dirname + '/.env');</kbd> is telling us the location of the <kbd class="calibre11">.env</kbd> file in our structure (you can find from <kbd class="calibre11">console.log</kbd> that the <kbd class="calibre11">__dirname</kbd> variable is a system location of a server's file--this must match the real <kbd class="calibre11">.env</kbd> file's location so it can be found by the system).</p>
<p class="calibre2">The next part is to add this to our <kbd class="calibre11">server/server.js</kbd> file:</p>
<pre class="calibre22">
app.use('/s3', s3router({ <br class="title-page-name"/>  bucket: process.env.AWS_BUCKET_NAME, <br class="title-page-name"/>  region: process.env.AWS_REGION_NAME, <br class="title-page-name"/>  signatureVersion: 'v4', <br class="title-page-name"/>  headers: {'Access-Control-Allow-Origin': '*'},  <br class="title-page-name"/>  ACL: 'public-read' <br class="title-page-name"/>}));
</pre>
<p class="calibre2">As you can see here, we have started using the environment variable that we defined in the <kbd class="calibre11">server/.env</kbd> file. For me, the <kbd class="calibre11">process.env.AWS_BUCKET_NAME</kbd> is equal to <kbd class="calibre11">publishing-app</kbd>, but if you have defined it differently, then it will retrieve another value from <kbd class="calibre11">server/.env</kbd> (thanks to the <kbd class="calibre11">env</kbd> express middleware that we just defined).</p>
<p class="calibre2">Based on that backend configuration (environment variables and setting up <kbd class="calibre11">s3router</kbd> with <kbd class="calibre11">import s3router from 'react-s3-uploader/s3router'</kbd>), we will be able to use the AWS S3 bucket. We need to prepare the frontend, which first will be implemented on the add-an-article view.</p>


            </article>

            <footer class="calibre4">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">Creating the ImgUploader component on the frontend</h1>
            

            <article>
                
<p class="calibre2">We will create a dump component called <kbd class="calibre11">ImgUploader</kbd>. This component will use the <kbd class="calibre11">react-s3-uploader</kbd> library, which does the job of abstracting the upload to Amazon S3. On a callback, you receive <kbd class="calibre11">information:onProgress</kbd>, and you can find the progress in percent with that callback, so a user can see the status of an <kbd class="calibre11">uploadonError</kbd>. This callback is fired when an error <kbd class="calibre11">occursonFinish</kbd>: this callback sends us back the location of a file that has been uploaded to S3.</p>
<p class="calibre2">You will learn more details further in the chapter; let's create a file first:</p>
<pre class="calibre22">
    <strong class="calibre1">$ [[you are in the src/components/articles directory of your   <br class="title-page-name"/>    project]]</strong><br class="title-page-name"/><strong class="calibre1">$ touch ImgUploader.js</strong>
</pre>
<p class="calibre2">You have created the <kbd class="calibre11">src/components/articles/ImgUploader.js</kbd> file, and the next step is to prepare the imports. So to the top of the <kbd class="calibre11">ImgUploader</kbd> file, add the following:</p>
<pre class="calibre22">
import React from 'react'; <br class="title-page-name"/>import ReactS3Uploader from 'react-s3-uploader'; <br class="title-page-name"/>import {Paper} from 'material-ui'; <br class="title-page-name"/><br class="title-page-name"/><br class="title-page-name"/>class ImgUploader extends React.Component { <br class="title-page-name"/>  constructor(props) { <br class="title-page-name"/>    super(props); <br class="title-page-name"/>    this.uploadFinished = this.uploadFinished.bind(this); <br class="title-page-name"/><br class="title-page-name"/>    this.state = { <br class="title-page-name"/>      uploadDetails: null, <br class="title-page-name"/>      uploadProgress: null, <br class="title-page-name"/>      uploadError: null, <br class="title-page-name"/>      articlePicUrl: props.articlePicUrl <br class="title-page-name"/>    }; <br class="title-page-name"/>  } <br class="title-page-name"/><br class="title-page-name"/>  uploadFinished(uploadDetails) { <br class="title-page-name"/>    // here will be more code in a moment <br class="title-page-name"/>  } <br class="title-page-name"/><br class="title-page-name"/>  render () { <br class="title-page-name"/>    return &lt;div&gt;S3 Image uploader placeholder&lt;/div&gt;; <br class="title-page-name"/>  } <br class="title-page-name"/>} <br class="title-page-name"/><br class="title-page-name"/>ImgUploader.propTypes = {  <br class="title-page-name"/>  updateImgUrl: React.PropTypes.func.isRequired  <br class="title-page-name"/>}; <br class="title-page-name"/>export default ImgUploader;
</pre>
<p class="calibre2">As you can see here, we have initiated the <kbd class="calibre11">ImgUploader</kbd> component with <kbd class="calibre11">div</kbd> that returns a temporary placeholder in the <kbd class="calibre11">render</kbd> function.</p>
<p class="calibre2">We have also prepared <kbd class="calibre11">propTypes</kbd> with a required property called <kbd class="calibre11">updateImgUrl</kbd>. This will be a callback function that will send a final, uploaded image's location (which has to be saved in the database--we will use this <kbd class="calibre11">updateImgUrl</kbd> props in a moment).</p>
<p class="calibre2">In the state of that <kbd class="calibre11">ImgUploader</kbd> component, we have the following:</p>
<pre class="calibre22">
// this is already in your codebase: <br class="title-page-name"/>this.state = { <br class="title-page-name"/>  uploadDetails: null, <br class="title-page-name"/>  uploadProgress: null, <br class="title-page-name"/>  uploadError: null, <br class="title-page-name"/>  articlePicUrl: props.articlePicUrl <br class="title-page-name"/>};
</pre>
<p class="calibre2">In these variables, we will store all the states of our components, depending on the current status and <kbd class="calibre11">props.articlePicUrl</kbd>, and we'll send the URL details up to the <kbd class="calibre11">AddArticleView</kbd> component (we will do it later in the chapter, after finishing the <kbd class="calibre11">ImgUploader</kbd> component).</p>


            </article>

            <footer class="calibre4">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">Wrapping up the ImgUploader component</h1>
            

            <article>
                
<p class="calibre2">The next step is to improve the <kbd class="calibre11">uploadFinished</kbd> function in our <kbd class="calibre11">ImgUploader</kbd>, so find the old empty function:</p>
<pre class="calibre22">
 uploadFinished(uploadDetails) { <br class="title-page-name"/>    // here will be more code in a moment <br class="title-page-name"/>  }
</pre>
<p class="calibre2">Replace it with the following:</p>
<pre class="calibre22">
 uploadFinished(uploadDetails) { <br class="title-page-name"/>    let articlePicUrl = '/s3/img/'+uploadDetails.filename; <br class="title-page-name"/>    this.setState({  <br class="title-page-name"/>      uploadProgress: null, <br class="title-page-name"/>      uploadDetails:  uploadDetails, <br class="title-page-name"/>      articlePicUrl: articlePicUrl <br class="title-page-name"/>    }); <br class="title-page-name"/>    this.props.updateImgUrl(articlePicUrl); <br class="title-page-name"/>  }
</pre>
<p class="calibre2">As you can see, the <kbd class="calibre11">uploadDetails.filename</kbd> variable comes from the <kbd class="calibre11">ReactS3Uploader</kbd> component, which we have imported on top of the <kbd class="calibre11">ImgUploader</kbd> file. After a successful upload, we set the <kbd class="calibre11">uploadProgress</kbd> back to <kbd class="calibre11">null</kbd>, set the details of our upload, and send back the details via the callback using <kbd class="calibre11">this.props.updateImgUrl(articlePicUrl)</kbd>.</p>
<p class="calibre2">The next step is to improve our <kbd class="calibre11">render</kbd> function in <kbd class="calibre11">ImgUploader</kbd>:</p>
<pre class="calibre22">
 render () { <br class="title-page-name"/>    let imgUploadProgressJSX; <br class="title-page-name"/>    let uploadProgress = this.state.uploadProgress; <br class="title-page-name"/>    if(uploadProgress) { <br class="title-page-name"/>      imgUploadProgressJSX = ( <br class="title-page-name"/>          &lt;div&gt; <br class="title-page-name"/>            {uploadProgress.uploadStatusText} <br class="title-page-name"/><a class="calibre25">({uploadProgress.progressInPercent}%)</a> <br class="title-page-name"/>          &lt;/div&gt; <br class="title-page-name"/>        ); <br class="title-page-name"/>    } else if(this.state.articlePicUrl) { <br class="title-page-name"/>      let articlePicStyles = { <br class="title-page-name"/>        maxWidth: 200,  <br class="title-page-name"/>        maxHeight: 200,  <br class="title-page-name"/>        margin: 'auto' <br class="title-page-name"/>      }; <br class="title-page-name"/>      imgUploadProgressJSX = &lt;img src={this.state.articlePicUrl} <br class="title-page-name"/>       style={articlePicStyles} /&gt;; <br class="title-page-name"/>    } <br class="title-page-name"/><br class="title-page-name"/>    return &lt;div&gt;S3 Image uploader placeholder&lt;/div&gt;; <br class="title-page-name"/>  }
</pre>
<p class="calibre2">This render is incomplete, but let's describe what we have added so far. The code is simply all about getting information about <kbd class="calibre11">uploadProgress</kbd> via <kbd class="calibre11">this.state</kbd> (the first <kbd class="calibre11">if</kbd> statement). The <kbd class="calibre11">else if(this.state.articlePicUrl)</kbd> is all about rendering the image after the upload is complete. Okay, but where we will get that information? Here is the rest:</p>
<pre class="calibre22">
   let uploaderJSX = ( <br class="title-page-name"/>        &lt;ReactS3Uploader <br class="title-page-name"/>        signingUrl='/s3/sign' <br class="title-page-name"/>        accept='image/*' <br class="title-page-name"/>          onProgress={(progressInPercent, uploadStatusText) =&gt; { <br class="title-page-name"/>            this.setState({  <br class="title-page-name"/>              uploadProgress: { progressInPercent,  <br class="title-page-name"/>              uploadStatusText },  <br class="title-page-name"/>              uploadError: null <br class="title-page-name"/>            }); <br class="title-page-name"/>          }}  <br class="title-page-name"/>          onError={(errorDetails) =&gt; { <br class="title-page-name"/>            this.setState({  <br class="title-page-name"/>              uploadProgress: null, <br class="title-page-name"/>              uploadError: errorDetails <br class="title-page-name"/>            }); <br class="title-page-name"/>          }} <br class="title-page-name"/>          onFinish={(uploadDetails) =&gt; { <br class="title-page-name"/>            this.uploadFinished(uploadDetails); <br class="title-page-name"/>          }} /&gt; <br class="title-page-name"/>      );
</pre>
<p class="calibre2">The <kbd class="calibre11">uploaderJSX</kbd> variable is the exact same as our <kbd class="calibre11">react-s3-uploader</kbd> library. As you can see from the code, for progress, we set the state with <kbd class="calibre11">uploadProgress: { progressInPercent, uploadStatusText }</kbd> and we set up <kbd class="calibre11">uploadError: null</kbd> (in case the user receives an error message). On error, we set the state, so we can tell the user. On finish, we run the <kbd class="calibre11">uploadFinished</kbd> function, which was described in detail previously.</p>
<p class="calibre2">The complete <kbd class="calibre11">render</kbd> function of <kbd class="calibre11">ImgUploader</kbd> will look as follows:</p>
<pre class="calibre22">
 render () { <br class="title-page-name"/>    let imgUploadProgressJSX; <br class="title-page-name"/>    let uploadProgress = this.state.uploadProgress; <br class="title-page-name"/>    if(uploadProgress) { <br class="title-page-name"/>      imgUploadProgressJSX = ( <br class="title-page-name"/>          &lt;div&gt; <br class="title-page-name"/>            {uploadProgress.uploadStatusText} <br class="title-page-name"/>             ({uploadProgress.progressInPercent}%) <br class="title-page-name"/>          &lt;/div&gt; <br class="title-page-name"/>        ); <br class="title-page-name"/>    } else if(this.state.articlePicUrl) { <br class="title-page-name"/>      let articlePicStyles = { <br class="title-page-name"/>        maxWidth: 200,  <br class="title-page-name"/>        maxHeight: 200,  <br class="title-page-name"/>        margin: 'auto' <br class="title-page-name"/>      }; <br class="title-page-name"/>      imgUploadProgressJSX = &lt;img src={this.state.articlePicUrl} <br class="title-page-name"/>       style={articlePicStyles} /&gt;; <br class="title-page-name"/>    } <br class="title-page-name"/><br class="title-page-name"/>    let uploaderJSX = ( <br class="title-page-name"/>        &lt;ReactS3Uploader <br class="title-page-name"/>        signingUrl='/s3/sign' <br class="title-page-name"/>        accept='image/*' <br class="title-page-name"/>          onProgress={(progressInPercent, uploadStatusText) =&gt; { <br class="title-page-name"/>            this.setState({  <br class="title-page-name"/>              uploadProgress: { progressInPercent, <br class="title-page-name"/>               uploadStatusText },  <br class="title-page-name"/>              uploadError: null <br class="title-page-name"/>            }); <br class="title-page-name"/>          }}  <br class="title-page-name"/>          onError={(errorDetails) =&gt; { <br class="title-page-name"/>            this.setState({  <br class="title-page-name"/>              uploadProgress: null, <br class="title-page-name"/>              uploadError: errorDetails <br class="title-page-name"/>            }); <br class="title-page-name"/>          }} <br class="title-page-name"/>          onFinish={(uploadDetails) =&gt; { <br class="title-page-name"/>            this.uploadFinished(uploadDetails); <br class="title-page-name"/>          }} /&gt; <br class="title-page-name"/>      ); <br class="title-page-name"/><br class="title-page-name"/>    return ( <br class="title-page-name"/>      &lt;Paper zDepth={1} style={{padding: 32, margin: 'auto', <br class="title-page-name"/>       width: 300}}&gt; <br class="title-page-name"/>        {imgUploadProgressJSX} <br class="title-page-name"/>        {uploaderJSX} <br class="title-page-name"/>      &lt;/Paper&gt; <br class="title-page-name"/>    ); <br class="title-page-name"/>  }
</pre>
<p class="calibre2">As you can see, this is the whole render of <kbd class="calibre11">ImgUploader</kbd>. We use an inline-styled <kbd class="calibre11">Paper</kbd> component (from <kbd class="calibre11">material-ui</kbd>), so the whole thing will look better to an article's end user/editor.</p>


            </article>

            <footer class="calibre4">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">AddArticleView improvements</h1>
            

            <article>
                
<p class="calibre2">We need to add the <kbd class="calibre11">ImgUploader</kbd> component to <kbd class="calibre11">AddArticleView</kbd>; first, we need to import it into the <kbd class="calibre11">src/views/articles/AddArticleView.js</kbd> file, like this:</p>
<pre class="calibre22">
import ImgUploader from '../../components/articles/ImgUploader';
</pre>
<p class="calibre2">Next, in the constructor of <kbd class="calibre11">AddArticleView</kbd>, find this old code:</p>
<pre class="calibre22">
// this is old, don't write it: <br class="title-page-name"/>class AddArticleView extends React.Component { <br class="title-page-name"/>  constructor(props) { <br class="title-page-name"/>    super(props); <br class="title-page-name"/>    this._onDraftJSChange = this._onDraftJSChange.bind(this); <br class="title-page-name"/>    this._articleSubmit = this._articleSubmit.bind(this); <br class="title-page-name"/><br class="title-page-name"/>    this.state = { <br class="title-page-name"/>      title: 'test', <br class="title-page-name"/>      contentJSON: {}, <br class="title-page-name"/>      htmlContent: '', <br class="title-page-name"/>      newArticleID: null <br class="title-page-name"/>    }; <br class="title-page-name"/>  }
</pre>
<p class="calibre2">Change it to the following improved version:</p>
<pre class="calibre22">
class AddArticleView extends React.Component { <br class="title-page-name"/>  constructor(props) { <br class="title-page-name"/>    super(props); <br class="title-page-name"/>    this._onDraftJSChange = this._onDraftJSChange.bind(this); <br class="title-page-name"/>    this._articleSubmit = this._articleSubmit.bind(this); <br class="title-page-name"/>    this.updateImgUrl = this.updateImgUrl.bind(this); <br class="title-page-name"/><br class="title-page-name"/>    this.state = { <br class="title-page-name"/>      title: 'test', <br class="title-page-name"/>      contentJSON: {}, <br class="title-page-name"/>      htmlContent: '', <br class="title-page-name"/>      newArticleID: null, <br class="title-page-name"/>      articlePicUrl: '/static/placeholder.png' <br class="title-page-name"/>    }; <br class="title-page-name"/>  }
</pre>
<p class="calibre2">As you can see, we have bound this to the <kbd class="calibre11">updateImgUrl</kbd> function and added a new state variable called <kbd class="calibre11">articlePicUrl</kbd> (by default, we will point toÂ <kbd class="calibre11">/static/placeholder.png</kbd> in case a user doesn't choose a cover).</p>
<p class="calibre2">Let's improve the functions of this component:</p>
<pre class="calibre22">
// this is old codebase, just for your reference: <br class="title-page-name"/>  async _articleSubmit() { <br class="title-page-name"/>    let newArticle = { <br class="title-page-name"/>      articleTitle: this.state.title, <br class="title-page-name"/>      articleContent: this.state.htmlContent, <br class="title-page-name"/>      articleContentJSON: this.state.contentJSON <br class="title-page-name"/>    } <br class="title-page-name"/><br class="title-page-name"/>    let newArticleID = await falcorModel <br class="title-page-name"/>      .call( <br class="title-page-name"/>            'articles.add', <br class="title-page-name"/>            [newArticle] <br class="title-page-name"/>          ). <br class="title-page-name"/>      then((result) =&gt; { <br class="title-page-name"/>        return falcorModel.getValue( <br class="title-page-name"/>            ['articles', 'newArticleID'] <br class="title-page-name"/>          ).then((articleID) =&gt; { <br class="title-page-name"/>            return articleID; <br class="title-page-name"/>          }); <br class="title-page-name"/>      }); <br class="title-page-name"/><br class="title-page-name"/>    newArticle['_id'] = newArticleID; <br class="title-page-name"/>    this.props.articleActions.pushNewArticle(newArticle); <br class="title-page-name"/>    this.setState({ newArticleID: newArticleID}); <br class="title-page-name"/>  }
</pre>
<p class="calibre2">Change this code to the following:</p>
<pre class="calibre22">
 async _articleSubmit() { <br class="title-page-name"/>    let newArticle = { <br class="title-page-name"/>      articleTitle: this.state.title, <br class="title-page-name"/>      articleContent: this.state.htmlContent, <br class="title-page-name"/>      articleContentJSON: this.state.contentJSON, <br class="title-page-name"/>      articlePicUrl: this.state.articlePicUrl <br class="title-page-name"/>    } <br class="title-page-name"/><br class="title-page-name"/>    let newArticleID = await falcorModel <br class="title-page-name"/>      .call( <br class="title-page-name"/>            'articles.add', <br class="title-page-name"/>            [newArticle] <br class="title-page-name"/>          ). <br class="title-page-name"/>      then((result) =&gt; { <br class="title-page-name"/>        return falcorModel.getValue( <br class="title-page-name"/>            ['articles', 'newArticleID'] <br class="title-page-name"/>          ).then((articleID) =&gt; { <br class="title-page-name"/>            return articleID; <br class="title-page-name"/>          }); <br class="title-page-name"/>      }); <br class="title-page-name"/><br class="title-page-name"/>    newArticle['_id'] = newArticleID; <br class="title-page-name"/>    this.props.articleActions.pushNewArticle(newArticle); <br class="title-page-name"/>    this.setState({ newArticleID: newArticleID }); <br class="title-page-name"/>  } <br class="title-page-name"/><br class="title-page-name"/>  updateImgUrl(articlePicUrl) { <br class="title-page-name"/>    this.setState({  <br class="title-page-name"/>      articlePicUrl: articlePicUrl <br class="title-page-name"/>    }); <br class="title-page-name"/>  }
</pre>
<p class="calibre2">As you can see, we have added <kbd class="calibre11">articlePicUrl: this.state.articlePicUrl</kbd> to the <kbd class="calibre11">newArticle</kbd> object. We have also introduced a new function called <kbd class="calibre11">updateImgUrl</kbd>, which is simply a callback that sets a new state with the <kbd class="calibre11">articlePicUrl</kbd> variable (in <kbd class="calibre11">this.state.articlePicUrl</kbd>, we keep the image URL of the current article that is going to be saved to the database).</p>
<p class="calibre2">The only thing to improve in <kbd class="calibre11">src/views/articles/AddArticleView.js</kbd> is our current render. Here is the old one:</p>
<pre class="calibre22">
// your current old codebase to improve: <br class="title-page-name"/>    return ( <br class="title-page-name"/>      &lt;div style={{height: '100%', width: '75%', margin: 'auto'}}&gt; <br class="title-page-name"/>        &lt;h1&gt;Add Article&lt;/h1&gt; <br class="title-page-name"/>        &lt;WYSIWYGeditor <br class="title-page-name"/>          name='addarticle' <br class="title-page-name"/>          title='Create an article' <br class="title-page-name"/>          onChangeTextJSON={this._onDraftJSChange} /&gt; <br class="title-page-name"/>          &lt;RaisedButton <br class="title-page-name"/>            onClick={this._articleSubmit} <br class="title-page-name"/>            secondary={true} <br class="title-page-name"/>            type='submit' <br class="title-page-name"/>            style={{margin: '10px auto', display: 'block', <br class="title-page-name"/>             width: 150}} <br class="title-page-name"/>            label={'Submit Article'} /&gt; <br class="title-page-name"/>      &lt;/div&gt; <br class="title-page-name"/>    ); <br class="title-page-name"/>  }
</pre>
<p class="calibre2">We need to improve this code using <kbd class="calibre11">ImgUploader</kbd>:</p>
<pre class="calibre22">
   return ( <br class="title-page-name"/>      &lt;div style={{height: '100%', width: '75%', margin: 'auto'}}&gt; <br class="title-page-name"/>        &lt;h1&gt;Add Article&lt;/h1&gt; <br class="title-page-name"/>        &lt;WYSIWYGeditor <br class="title-page-name"/>          name='addarticle' <br class="title-page-name"/>          title='Create an article' <br class="title-page-name"/>          onChangeTextJSON={this._onDraftJSChange} /&gt; <br class="title-page-name"/><br class="title-page-name"/>        &lt;div style={{margin: '10px 10px 10px 10px'}}&gt;  <br class="title-page-name"/>          &lt;ImgUploader  <br class="title-page-name"/>              updateImgUrl={this.updateImgUrl}  <br class="title-page-name"/>              articlePicUrl={this.state.articlePicUrl} /&gt; <br class="title-page-name"/>        &lt;/div&gt; <br class="title-page-name"/><br class="title-page-name"/>        &lt;RaisedButton <br class="title-page-name"/>          onClick={this._articleSubmit} <br class="title-page-name"/>          secondary={true} <br class="title-page-name"/>          type='submit' <br class="title-page-name"/>          style={{margin: '10px auto', display: 'block', <br class="title-page-name"/>           width: 150}} <br class="title-page-name"/>          label={'Submit Article'} /&gt; <br class="title-page-name"/>      &lt;/div&gt; <br class="title-page-name"/>    ); <br class="title-page-name"/>  }
</pre>
<p class="calibre2">You can see that we use the properties for sending down the current <kbd class="calibre11">articlePicUrl</kbd> (this will be handy later and also give us the default <kbd class="calibre11">placeholder.png</kbd> location) and the callback to update the <kbd class="calibre11">img</kbd> URL, called <kbd class="calibre11">updateImgUrl</kbd>.</p>
<p class="calibre2">If you visit <kbd class="calibre11">http://localhost:3000/add-article</kbd>, you will see a new image picker between the WYSIWYG box and the <span>SUBMIT ARTICLE</span> button (check the screenshot):</p>
<div class="packt_figure"><img class="image-border71" src="../images/00076.jpeg"/></div>
<p class="calibre2">Of course, if you followed all the instructions correctly, after clicking on <span>Choose File</span>, you will be able to upload a new image to the S3 bucket, and the image in the thumbnail will be replaced, as in the following example:</p>
<div class="packt_figure"><img class="image-border72" src="../images/00077.jpeg"/></div>
<p class="calibre2">As you can see, we can upload an image. The next step is to unmock viewing them so we can see that our article has a dog on the cover (and the dog's image comes from our article collection in the DB).</p>


            </article>

            <footer class="calibre4">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">Some remaining tweaks for PublishingApp, ArticleCard, and DashboardView</h1>
            

            <article>
                
<p class="calibre2">We can add an article. We need to unmock the image URLs in our views so we can see the real URL from the database (instead mocked in an <kbd class="calibre11">img src</kbd> property).</p>
<p class="calibre2">Let's start with <kbd class="calibre11">src/layouts/PublishingApp.js</kbd> and improve the old <kbd class="calibre11">_fetch</kbd> function:</p>
<pre class="calibre22">
// old codebase to improve: <br class="title-page-name"/>  async _fetch() { <br class="title-page-name"/>    let articlesLength = await falcorModel. <br class="title-page-name"/>      getValue('articles.length'). <br class="title-page-name"/>      then((length) =&gt;  length); <br class="title-page-name"/><br class="title-page-name"/>    let articles = await falcorModel. <br class="title-page-name"/>      get(['articles', {from: 0, to: articlesLength-1}, <br class="title-page-name"/>      ['_id','articleTitle', 'articleContent', <br class="title-page-name"/>      'articleContentJSON']]).  <br class="title-page-name"/>      then((articlesResponse) =&gt; {   <br class="title-page-name"/>        return articlesResponse.json.articles; <br class="title-page-name"/>      }).catch(e =&gt; { <br class="title-page-name"/>        return 500; <br class="title-page-name"/>      }); <br class="title-page-name"/><br class="title-page-name"/>    if(articles === 500) { <br class="title-page-name"/>      return; <br class="title-page-name"/>    } <br class="title-page-name"/><br class="title-page-name"/>    this.props.articleActions.articlesList(articles); <br class="title-page-name"/>  }
</pre>
<p class="calibre2">Replace this code with the following:</p>
<pre class="calibre22">
 async _fetch() { <br class="title-page-name"/>    let articlesLength = await falcorModel. <br class="title-page-name"/>      getValue('articles.length'). <br class="title-page-name"/>      then((length) =&gt; length); <br class="title-page-name"/><br class="title-page-name"/>    let articles = await falcorModel. <br class="title-page-name"/>      get(['articles', {from: 0, to: articlesLength-1}, <br class="title-page-name"/>       ['_id','articleTitle', 'articleContent', <br class="title-page-name"/>       'articleContentJSON', 'articlePicUrl']]).  <br class="title-page-name"/>      then((articlesResponse) =&gt; {   <br class="title-page-name"/>        return articlesResponse.json.articles; <br class="title-page-name"/>      }).catch(e =&gt; { <br class="title-page-name"/>        console.debug(e); <br class="title-page-name"/>        return 500; <br class="title-page-name"/>      }); <br class="title-page-name"/><br class="title-page-name"/>    if(articles === 500) { <br class="title-page-name"/>      return; <br class="title-page-name"/>    } <br class="title-page-name"/><br class="title-page-name"/>    this.props.articleActions.articlesList(articles); <br class="title-page-name"/>  }
</pre>
<p class="calibre2">As you can see, we have started to fetch <kbd class="calibre11">articlePicUrl</kbd> via the <kbd class="calibre11">falcorModel.get</kbd> method.</p>
<p class="calibre2">The next step, also in the <kbd class="calibre11">PublishingApp</kbd> file, is to improve the <kbd class="calibre11">render</kbd> function, so you need to improve the following code:</p>
<pre class="calibre22">
// old code: <br class="title-page-name"/>    this.props.article.forEach((articleDetails, articleKey) =&gt; { <br class="title-page-name"/>      let currentArticleJSX = ( <br class="title-page-name"/>        &lt;div key={articleKey}&gt; <br class="title-page-name"/>          &lt;ArticleCard  <br class="title-page-name"/>            title={articleDetails.articleTitle} <br class="title-page-name"/>            content={articleDetails.articleContent} /&gt; <br class="title-page-name"/>        &lt;/div&gt; <br class="title-page-name"/>      );
</pre>
<p class="calibre2">Add to it a new property, which will pass down the image URL:</p>
<pre class="calibre22">
   this.props.article.forEach((articleDetails, articleKey) =&gt; { <br class="title-page-name"/>      let currentArticleJSX = ( <br class="title-page-name"/>        &lt;div key={articleKey}&gt; <br class="title-page-name"/>          &lt;ArticleCard  <br class="title-page-name"/>            title={articleDetails.articleTitle} <br class="title-page-name"/>            content={articleDetails.articleContent}  <br class="title-page-name"/>            articlePicUrl={articleDetails.articlePicUrl} /&gt; <br class="title-page-name"/>        &lt;/div&gt; <br class="title-page-name"/>      );
</pre>
<p class="calibre2">As you can see, we are passing the fetched <kbd class="calibre11">articlePicUrl</kbd> to the <kbd class="calibre11">ArticleCard</kbd> component.</p>


            </article>

            <footer class="calibre4">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">Improving the ArticleCard component</h1>
            

            <article>
                
<p class="calibre2">After we pass the <kbd class="calibre11">articlePicUrl</kbd> variable via properties, we need to improve the following (<kbd class="calibre11">src/components/ArticleCard.js</kbd>):</p>
<pre class="calibre22">
// old code to improve: <br class="title-page-name"/>  render() { <br class="title-page-name"/>    let title = this.props.title || 'no title provided'; <br class="title-page-name"/>    let content = this.props.content || 'no content provided'; <br class="title-page-name"/><br class="title-page-name"/>    let paperStyle = { <br class="title-page-name"/>      padding: 10,  <br class="title-page-name"/>      width: '100%',  <br class="title-page-name"/>      height: 300 <br class="title-page-name"/>    }; <br class="title-page-name"/><br class="title-page-name"/>    let leftDivStyle = { <br class="title-page-name"/>      width: '30%',  <br class="title-page-name"/>      float: 'left' <br class="title-page-name"/>    } <br class="title-page-name"/><br class="title-page-name"/>    let rightDivStyle = { <br class="title-page-name"/>      width: '60%',  <br class="title-page-name"/>      float: 'left',  <br class="title-page-name"/>      padding: '10px 10px 10px 10px' <br class="title-page-name"/>    } <br class="title-page-name"/><br class="title-page-name"/>    return ( <br class="title-page-name"/>      &lt;Paper style={paperStyle}&gt; <br class="title-page-name"/>        &lt;CardHeader <br class="title-page-name"/>          title={this.props.title} <br class="title-page-name"/>          subtitle='Subtitle' <br class="title-page-name"/>          avatar='/static/avatar.png' <br class="title-page-name"/>        /&gt; <br class="title-page-name"/><br class="title-page-name"/>        &lt;div style={leftDivStyle}&gt; <br class="title-page-name"/>          &lt;Card &gt; <br class="title-page-name"/>            &lt;CardMedia <br class="title-page-name"/>              overlay={&lt;CardTitle title={title} <br class="title-page-name"/>               subtitle='Overlay subtitle' /&gt;}&gt; <br class="title-page-name"/>              &lt;img src='/static/placeholder.png' height='190' /&gt; <br class="title-page-name"/>            &lt;/CardMedia&gt; <br class="title-page-name"/>          &lt;/Card&gt; <br class="title-page-name"/>        &lt;/div&gt; <br class="title-page-name"/>        &lt;div style={rightDivStyle}&gt; <br class="title-page-name"/>          &lt;div dangerouslySetInnerHTML={{__html: content}} /&gt; <br class="title-page-name"/>        &lt;/div&gt; <br class="title-page-name"/>      &lt;/Paper&gt;); <br class="title-page-name"/>  }
</pre>
<p class="calibre2">Change it to the following:</p>
<pre class="calibre22">
 render() { <br class="title-page-name"/>    let title = this.props.title || 'no title provided'; <br class="title-page-name"/>    let content = this.props.content || 'no content provided'; <br class="title-page-name"/>    let articlePicUrl = this.props.articlePicUrl || <br class="title-page-name"/>     '/static/placeholder.png'; <br class="title-page-name"/><br class="title-page-name"/>    let paperStyle = { <br class="title-page-name"/>      padding: 10,  <br class="title-page-name"/>      width: '100%',  <br class="title-page-name"/>      height: 300 <br class="title-page-name"/>    }; <br class="title-page-name"/><br class="title-page-name"/>    let leftDivStyle = { <br class="title-page-name"/>      width: '30%',  <br class="title-page-name"/>      float: 'left' <br class="title-page-name"/>    } <br class="title-page-name"/><br class="title-page-name"/>    let rightDivStyle = { <br class="title-page-name"/>      width: '60%',  <br class="title-page-name"/>      float: 'left',  <br class="title-page-name"/>      padding: '10px 10px 10px 10px' <br class="title-page-name"/>    } <br class="title-page-name"/><br class="title-page-name"/>    return ( <br class="title-page-name"/>      &lt;Paper style={paperStyle}&gt; <br class="title-page-name"/>        &lt;CardHeader <br class="title-page-name"/>          title={this.props.title} <br class="title-page-name"/>          subtitle='Subtitle' <br class="title-page-name"/>          avatar='/static/avatar.png' <br class="title-page-name"/>        /&gt; <br class="title-page-name"/><br class="title-page-name"/>        &lt;div style={leftDivStyle}&gt; <br class="title-page-name"/>          &lt;Card &gt; <br class="title-page-name"/>            &lt;CardMedia <br class="title-page-name"/>              overlay={&lt;CardTitle title={title} <br class="title-page-name"/>               subtitle='Overlay subtitle' /&gt;}&gt; <br class="title-page-name"/>              &lt;img src={articlePicUrl} height='190' /&gt; <br class="title-page-name"/>            &lt;/CardMedia&gt; <br class="title-page-name"/>          &lt;/Card&gt; <br class="title-page-name"/>        &lt;/div&gt; <br class="title-page-name"/>        &lt;div style={rightDivStyle}&gt; <br class="title-page-name"/>          &lt;div dangerouslySetInnerHTML={{__html: content}} /&gt; <br class="title-page-name"/>        &lt;/div&gt; <br class="title-page-name"/>      &lt;/Paper&gt;); <br class="title-page-name"/>  }
</pre>
<p class="calibre2">At the beginning of <kbd class="calibre11">render</kbd>, we use <kbd class="calibre11">let articlePicUrl = this.props.articlePicUrl || '/static/placeholder.png';</kbd>, and later, we use that in our image's JSX (<kbd class="calibre11">img src={articlePicUrl} height='190'</kbd>).</p>
<p class="calibre2">After these two changes, you can see the article with a real cover, like this:</p>
<div class="packt_figure"><img class="image-border73" src="../images/00078.jpeg"/></div>


            </article>

            <footer class="calibre4">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">Improving the DashboardView component</h1>
            

            <article>
                
<p class="calibre2">Let's improve the dashboard with the cover, so in <kbd class="calibre11">src/views/DashboardView.js</kbd>, find the following code:</p>
<pre class="calibre22">
// old code: <br class="title-page-name"/>  render () { <br class="title-page-name"/>    let articlesJSX = []; <br class="title-page-name"/>    this.props.article.forEach((articleDetails, articleKey) =&gt; { <br class="title-page-name"/>      let currentArticleJSX = ( <br class="title-page-name"/>        &lt;Link  <br class="title-page-name"/>          to={&amp;grave;/edit-article/${articleDetails['_id']}&amp;grave;}  <br class="title-page-name"/>          key={articleKey}&gt; <br class="title-page-name"/>          &lt;ListItem <br class="title-page-name"/><br class="title-page-name"/>            leftAvatar={&lt;img src='/static/placeholder.png'   <br class="title-page-name"/>                                    width='50'  <br class="title-page-name"/>                                    height='50' /&gt;} <br class="title-page-name"/>            primaryText={articleDetails.articleTitle} <br class="title-page-name"/>            secondaryText={articleDetails.articleContent} <br class="title-page-name"/>          /&gt; <br class="title-page-name"/>        &lt;/Link&gt; <br class="title-page-name"/>      ); <br class="title-page-name"/><br class="title-page-name"/>      articlesJSX.push(currentArticleJSX); <br class="title-page-name"/>    }); <br class="title-page-name"/>    // below is rest of the render's function
</pre>
<p class="calibre2">Replace it with the following:</p>
<pre class="calibre22">
 render () { <br class="title-page-name"/>    let articlesJSX = []; <br class="title-page-name"/>    this.props.article.forEach((articleDetails, articleKey) =&gt; { <br class="title-page-name"/>      let articlePicUrl = articleDetails.articlePicUrl || <br class="title-page-name"/>       '/static/placeholder.png'; <br class="title-page-name"/>      let currentArticleJSX = ( <br class="title-page-name"/>        &lt;Link  <br class="title-page-name"/>                to={&amp;grave;/edit-article/${articleDetails['_id']}&amp;grave;}  <br class="title-page-name"/><a class="calibre25">key={articleKey}&gt;</a> <br class="title-page-name"/>          &lt;ListItem <br class="title-page-name"/><br class="title-page-name"/>            leftAvatar={&lt;img src={articlePicUrl} width='50' <br class="title-page-name"/>             height='50' /&gt;} <br class="title-page-name"/>            primaryText={articleDetails.articleTitle} <br class="title-page-name"/>            secondaryText={articleDetails.articleContent} <br class="title-page-name"/>          /&gt; <br class="title-page-name"/>        &lt;/Link&gt; <br class="title-page-name"/>      ); <br class="title-page-name"/><br class="title-page-name"/>      articlesJSX.push(currentArticleJSX); <br class="title-page-name"/>    }); <br class="title-page-name"/>    // below is rest of the render's function
</pre>
<p class="calibre2">As you can see, we have replaced the mocked placeholder with a real cover photo, so on our articles dashboard (which is available after login) we will find real images in the thumbnails.</p>


            </article>

            <footer class="calibre4">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">Editing an article's cover photo</h1>
            

            <article>
                
<p class="calibre2">Regarding the article's photo, we need to make some improvements in the <kbd class="calibre11">src/views/articles/EditArticleView.js</kbd> file, such as importing <kbd class="calibre11">ImgUploader</kbd>:</p>
<pre class="calibre22">
import ImgUploader from '../../components/articles/ImgUploader';
</pre>
<p class="calibre2">After you have imported <kbd class="calibre11">ImgUploader</kbd>, improve the constructor of <kbd class="calibre11">EditArticleView</kbd>. Find the following code:</p>
<pre class="calibre22">
// old code to improve: <br class="title-page-name"/>class EditArticleView extends React.Component { <br class="title-page-name"/>  constructor(props) { <br class="title-page-name"/>    super(props); <br class="title-page-name"/>    this._onDraftJSChange = this._onDraftJSChange.bind(this); <br class="title-page-name"/>    this._articleEditSubmit = this._articleEditSubmit.bind(this); <br class="title-page-name"/>    this._fetchArticleData = this._fetchArticleData.bind(this); <br class="title-page-name"/>    this._handleDeleteTap = this._handleDeleteTap.bind(this); <br class="title-page-name"/>    this._handleDeletion = this._handleDeletion.bind(this); <br class="title-page-name"/>    this._handleClosePopover = <br class="title-page-name"/>     this._handleClosePopover.bind(this); <br class="title-page-name"/><br class="title-page-name"/>    this.state = { <br class="title-page-name"/>      articleFetchError: null, <br class="title-page-name"/>      articleEditSuccess: null, <br class="title-page-name"/>      editedArticleID: null, <br class="title-page-name"/>      articleDetails: null, <br class="title-page-name"/>      title: 'test', <br class="title-page-name"/>      contentJSON: {}, <br class="title-page-name"/>      htmlContent: '', <br class="title-page-name"/>      openDelete: false, <br class="title-page-name"/>      deleteAnchorEl: null <br class="title-page-name"/>    }; <br class="title-page-name"/>  }
</pre>
<p class="calibre2">Replace it with the new, improved constructor:</p>
<pre class="calibre22">
class EditArticleView extends React.Component { <br class="title-page-name"/>  constructor(props) { <br class="title-page-name"/>    super(props); <br class="title-page-name"/>    this._onDraftJSChange = this._onDraftJSChange.bind(this); <br class="title-page-name"/>    this._articleEditSubmit = this._articleEditSubmit.bind(this); <br class="title-page-name"/>    this._fetchArticleData = this._fetchArticleData.bind(this); <br class="title-page-name"/>    this._handleDeleteTap = this._handleDeleteTap.bind(this); <br class="title-page-name"/>    this._handleDeletion = this._handleDeletion.bind(this); <br class="title-page-name"/>    this._handleClosePopover = <br class="title-page-name"/>     this._handleClosePopover.bind(this); <br class="title-page-name"/>    this.updateImgUrl = this.updateImgUrl.bind(this); <br class="title-page-name"/><br class="title-page-name"/>    this.state = { <br class="title-page-name"/>      articleFetchError: null, <br class="title-page-name"/>      articleEditSuccess: null, <br class="title-page-name"/>      editedArticleID: null, <br class="title-page-name"/>      articleDetails: null, <br class="title-page-name"/>      title: 'test', <br class="title-page-name"/>      contentJSON: {}, <br class="title-page-name"/>      htmlContent: '', <br class="title-page-name"/>      openDelete: false, <br class="title-page-name"/>      deleteAnchorEl: null, <br class="title-page-name"/>      articlePicUrl: '/static/placeholder.png' <br class="title-page-name"/>    }; <br class="title-page-name"/>  }
</pre>
<p class="calibre2">As you can see, we have bound this to the new <kbd class="calibre11">updateImgUrl</kbd> function (which will be the <kbd class="calibre11">ImgUploader</kbd> callback), and we create a new default state for the <kbd class="calibre11">articlePicUrl</kbd>.</p>
<p class="calibre2">The next step is to improve the current <kbd class="calibre11">_fetchArticleData</kbd> function:</p>
<pre class="calibre22">
// this is old already in your codebase: <br class="title-page-name"/>  _fetchArticleData() { <br class="title-page-name"/>    let articleID = this.props.params.articleID; <br class="title-page-name"/>    if(typeof window !== 'undefined' &amp;&amp; articleID) { <br class="title-page-name"/>        let articleDetails = this.props.article.get(articleID); <br class="title-page-name"/>        if(articleDetails) { <br class="title-page-name"/>          this.setState({  <br class="title-page-name"/>            editedArticleID: articleID,  <br class="title-page-name"/>            articleDetails: articleDetails <br class="title-page-name"/>          }); <br class="title-page-name"/>        } else { <br class="title-page-name"/>          this.setState({ <br class="title-page-name"/>            articleFetchError: true <br class="title-page-name"/>          }) <br class="title-page-name"/>        } <br class="title-page-name"/>    } <br class="title-page-name"/>  }
</pre>
<p class="calibre2">Replace it with the following improved code:</p>
<pre class="calibre22">
 _fetchArticleData() { <br class="title-page-name"/>    let articleID = this.props.params.articleID; <br class="title-page-name"/>    if(typeof window !== 'undefined' &amp;&amp; articleID) { <br class="title-page-name"/>        let articleDetails = this.props.article.get(articleID); <br class="title-page-name"/>        if(articleDetails) { <br class="title-page-name"/>          this.setState({  <br class="title-page-name"/>            editedArticleID: articleID,  <br class="title-page-name"/>            articleDetails: articleDetails, <br class="title-page-name"/>            articlePicUrl: articleDetails.articlePicUrl, <br class="title-page-name"/>            contentJSON: articleDetails.articleContentJSON, <br class="title-page-name"/>            htmlContent: articleDetails.articleContent <br class="title-page-name"/>          }); <br class="title-page-name"/>        } else { <br class="title-page-name"/>          this.setState({ <br class="title-page-name"/>            articleFetchError: true <br class="title-page-name"/>          }) <br class="title-page-name"/>        } <br class="title-page-name"/>    } <br class="title-page-name"/>  }
</pre>
<p class="calibre2">Here, we have added to an initial fetch some new <kbd class="calibre11">this.setState</kbd> variables, such as <kbd class="calibre11">articlePicUrl</kbd>, <kbd class="calibre11">contentJSON</kbd>, and <kbd class="calibre11">htmlContent</kbd>. The article fetch is here because we need to set up a cover in the <kbd class="calibre11">ImgUploader</kbd> of a current image that might potentially be changed. The <kbd class="calibre11">contentJSON</kbd> and <kbd class="calibre11">htmlContent</kbd> is here in case the user doesn't edit anything in the WYSIWYG editor and we need to have a default value from the database (otherwise, the edit button would save empty values into the database and break the whole editing experience).</p>
<p class="calibre2">Let's improve the <kbd class="calibre11">_articleEditSubmit</kbd> function. This is the old code:</p>
<pre class="calibre22">
// old code to improve: <br class="title-page-name"/>  async _articleEditSubmit() { <br class="title-page-name"/>    let currentArticleID = this.state.editedArticleID; <br class="title-page-name"/>    let editedArticle = { <br class="title-page-name"/>      _id: currentArticleID, <br class="title-page-name"/>      articleTitle: this.state.title, <br class="title-page-name"/>      articleContent: this.state.htmlContent, <br class="title-page-name"/>      articleContentJSON: this.state.contentJSON <br class="title-page-name"/>    // striped code for our convience
</pre>
<p class="calibre2">Change to the following improved version:</p>
<pre class="calibre22">
  async _articleEditSubmit() { <br class="title-page-name"/>    let currentArticleID = this.state.editedArticleID; <br class="title-page-name"/>    let editedArticle = { <br class="title-page-name"/>      _id: currentArticleID, <br class="title-page-name"/>      articleTitle: this.state.title, <br class="title-page-name"/>      articleContent: this.state.htmlContent, <br class="title-page-name"/>      articleContentJSON: this.state.contentJSON, <br class="title-page-name"/>      articlePicUrl: this.state.articlePicUrl <br class="title-page-name"/>    } <br class="title-page-name"/>    // striped code for our convenience
</pre>
<p class="calibre2">The next step is to add a new function to the <kbd class="calibre11">EditArticleView</kbd> component:</p>
<pre class="calibre22">
 updateImgUrl(articlePicUrl) { <br class="title-page-name"/>    this.setState({  <br class="title-page-name"/>      articlePicUrl: articlePicUrl <br class="title-page-name"/>    }); <br class="title-page-name"/>  }
</pre>
<p class="calibre2">The last step in order to finish the article-editing cover is to improve the old render:</p>
<pre class="calibre22">
// old code to improve: <br class="title-page-name"/>    let initialWYSIWYGValue = <br class="title-page-name"/>     this.state.articleDetails.articleContentJSON; <br class="title-page-name"/><br class="title-page-name"/>    return ( <br class="title-page-name"/>      &lt;div style={{height: '100%', width: '75%', margin: 'auto'}}&gt; <br class="title-page-name"/>        &lt;h1&gt;Edit an existing article&lt;/h1&gt; <br class="title-page-name"/>        &lt;WYSIWYGeditor <br class="title-page-name"/>          initialValue={initialWYSIWYGValue} <br class="title-page-name"/>          name='editarticle' <br class="title-page-name"/>          title='Edit an article' <br class="title-page-name"/>          onChangeTextJSON={this._onDraftJSChange} /&gt; <br class="title-page-name"/><br class="title-page-name"/>        &lt;RaisedButton <br class="title-page-name"/>          onClick={this._articleEditSubmit} <br class="title-page-name"/>          secondary={true} <br class="title-page-name"/>          type='submit' <br class="title-page-name"/>          style={{margin: '10px auto', <br class="title-page-name"/>           display: 'block', width: 150}} <br class="title-page-name"/>          label={'Submit Edition'} /&gt; <br class="title-page-name"/>        &lt;hr /&gt;
</pre>
<p class="calibre2">Replace it with the following:</p>
<pre class="calibre22">
   let initialWYSIWYGValue = <br class="title-page-name"/>    this.state.articleDetails.articleContentJSON; <br class="title-page-name"/><br class="title-page-name"/>    return ( <br class="title-page-name"/>      &lt;div style={{height: '100%', width: '75%', margin: 'auto'}}&gt; <br class="title-page-name"/>        &lt;h1&gt;Edit an existing article&lt;/h1&gt; <br class="title-page-name"/>        &lt;WYSIWYGeditor <br class="title-page-name"/>          initialValue={initialWYSIWYGValue} <br class="title-page-name"/>          name='editarticle' <br class="title-page-name"/>          title='Edit an article' <br class="title-page-name"/>          onChangeTextJSON={this._onDraftJSChange} /&gt; <br class="title-page-name"/><br class="title-page-name"/>        &lt;div style={{margin: '10px 10px 10px 10px'}}&gt;  <br class="title-page-name"/>          &lt;ImgUploader updateImgUrl={this.updateImgUrl} <br class="title-page-name"/>           articlePicUrl={this.state.articlePicUrl} /&gt; <br class="title-page-name"/>        &lt;/div&gt; <br class="title-page-name"/><br class="title-page-name"/>        &lt;RaisedButton <br class="title-page-name"/>          onClick={this._articleEditSubmit} <br class="title-page-name"/>          secondary={true} <br class="title-page-name"/>          type='submit' <br class="title-page-name"/>          style={{margin: '10px auto', <br class="title-page-name"/>           display: 'block', width: 150}} <br class="title-page-name"/>          label={'Submit Edition'} /&gt; <br class="title-page-name"/>        &lt;hr/&gt;
</pre>
<p class="calibre2">As you can see, we have added <kbd class="calibre11">ImgUploader</kbd> and styled it exactly the same way as in <kbd class="calibre11">AddArticleView</kbd>. The rest of <kbd class="calibre11">ImgUploader</kbd> does the job for us in order to allow our users to edit article photos.</p>
<div class="packt_figure"><img class="image-border74" src="../images/00079.jpeg"/></div>
<div class="title-page-name">In this screenshot, you can see how the edit view should look after all the recent improvements.</div>


            </article>

            <footer class="calibre4">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">Adding the ability to add/edit the title and subtitle of an article</h1>
            

            <article>
                
<p class="calibre2">In general, we shall improve the article's model in the <kbd class="calibre11">server/configMongoose.js</kbd> file. Start by finding the following code:</p>
<pre class="calibre22">
// old codebase: <br class="title-page-name"/>var articleSchema = new Schema({ <br class="title-page-name"/>    articleTitle: String, <br class="title-page-name"/>    articleContent: String, <br class="title-page-name"/>    articleContentJSON: Object, <br class="title-page-name"/>    articlePicUrl: { type: String, default: <br class="title-page-name"/>     '/static/placeholder.png' } <br class="title-page-name"/>  },  <br class="title-page-name"/>  {  <br class="title-page-name"/>    minimize: false  <br class="title-page-name"/>  } <br class="title-page-name"/>);
</pre>
<p class="calibre2">Replace it with the improved code, as follows:</p>
<pre class="calibre22">
var defaultDraftJSobject = { <br class="title-page-name"/>    'blocks' : [], <br class="title-page-name"/>    'entityMap' : {} <br class="title-page-name"/>} <br class="title-page-name"/><br class="title-page-name"/>var articleSchema = new Schema({ <br class="title-page-name"/>    articleTitle: { type: String, required: true, default: <br class="title-page-name"/>     'default article title' }, <br class="title-page-name"/>    articleSubTitle: { type: String, required: true, default: <br class="title-page-name"/>     'default subtitle' }, <br class="title-page-name"/>    articleContent: { type: String, required: true, default: <br class="title-page-name"/>     'default content' }, <br class="title-page-name"/>    articleContentJSON: { type: Object, required: true, default: <br class="title-page-name"/>     defaultDraftJSobject }, <br class="title-page-name"/>    articlePicUrl: { type: String, required: true, default: <br class="title-page-name"/>     '/static/placeholder.png' } <br class="title-page-name"/>  },  <br class="title-page-name"/>  {  <br class="title-page-name"/>    minimize: false  <br class="title-page-name"/>  } <br class="title-page-name"/>);
</pre>
<p class="calibre2">As you can see, we have added a lot of required properties in our model; this will affect the ability to save incomplete objects, so in general, our model will be more consistent throughout the life of our publishing app.</p>
<p class="calibre2">We have also added a new property to our model called <kbd class="calibre11">articleSubTitle</kbd>, which we will be using later in this chapter.</p>


            </article>

            <footer class="calibre4">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">AddArticleView improvements</h1>
            

            <article>
                
<p class="calibre2">In general, we will add two <kbd class="calibre11">DefaultInput</kbd> components (title and subtitle), and the whole form will be using <kbd class="calibre11">formsy-react</kbd>, so in <kbd class="calibre11">src/views/articles/AddArticleView.js</kbd>, add new imports:</p>
<pre class="calibre22">
import DefaultInput from '../../components/DefaultInput'; <br class="title-page-name"/>import Formsy from 'formsy-react';
</pre>
<p class="calibre2">The next step is to improve <kbd class="calibre11">async _articleSubmit</kbd>, so change the old code:</p>
<pre class="calibre22">
// old code to improve: <br class="title-page-name"/>  async _articleSubmit() { <br class="title-page-name"/>    let newArticle = { <br class="title-page-name"/>      articleTitle: articleModel.title, <br class="title-page-name"/>      articleContent: this.state.htmlContent, <br class="title-page-name"/>      articleContentJSON: this.state.contentJSON, <br class="title-page-name"/>      articlePicUrl: this.state.articlePicUrl <br class="title-page-name"/>    } <br class="title-page-name"/><br class="title-page-name"/>    let newArticleID = await falcorModel <br class="title-page-name"/>      .call( <br class="title-page-name"/>            'articles.add', <br class="title-page-name"/>            [newArticle] <br class="title-page-name"/>          ). <br class="title-page-name"/>          // rest code below is striped
</pre>
<p class="calibre2">Replace it with the following:</p>
<pre class="calibre22">
  async _articleSubmit(articleModel) { <br class="title-page-name"/>    let newArticle = { <br class="title-page-name"/>      articleTitle: articleModel.title, <br class="title-page-name"/>      articleSubTitle: articleModel.subTitle, <br class="title-page-name"/>      articleContent: this.state.htmlContent, <br class="title-page-name"/>      articleContentJSON: this.state.contentJSON, <br class="title-page-name"/>      articlePicUrl: this.state.articlePicUrl <br class="title-page-name"/>    } <br class="title-page-name"/><br class="title-page-name"/>    let newArticleID = await falcorModel <br class="title-page-name"/>      .call( <br class="title-page-name"/>            'articles.add', <br class="title-page-name"/>            [newArticle] <br class="title-page-name"/>          ).
</pre>
<p class="calibre2">As you can see, we have added <kbd class="calibre11">articleModel</kbd> in the <kbd class="calibre11">_articleSubmit</kbd> arguments; this will come from <kbd class="calibre11">formsy-react</kbd>, the same way we implemented it in the <kbd class="calibre11">LoginView</kbd> and <kbd class="calibre11">RegisterView</kbd>. We have also added the <kbd class="calibre11">articleSubTitle</kbd> property to the <kbd class="calibre11">newArticle</kbd> object.</p>
<p class="calibre2">The old <kbd class="calibre11">render</kbd> function return looks like this:</p>
<pre class="calibre22">
// old code below: <br class="title-page-name"/>    return ( <br class="title-page-name"/>      &lt;div style={{height: '100%', width: '75%', margin: 'auto'}}&gt; <br class="title-page-name"/>        &lt;h1&gt;Add Article&lt;/h1&gt; <br class="title-page-name"/>        &lt;WYSIWYGeditor <br class="title-page-name"/>          name='addarticle' <br class="title-page-name"/>          title='Create an article' <br class="title-page-name"/>          onChangeTextJSON={this._onDraftJSChange} /&gt; <br class="title-page-name"/><br class="title-page-name"/>        &lt;div style={{margin: '10px 10px 10px 10px'}}&gt;  <br class="title-page-name"/>          &lt;ImgUploader updateImgUrl={this.updateImgUrl} <br class="title-page-name"/>           articlePicUrl={this.state.articlePicUrl} /&gt; <br class="title-page-name"/>        &lt;/div&gt; <br class="title-page-name"/><br class="title-page-name"/>        &lt;RaisedButton <br class="title-page-name"/>          onClick={this._articleSubmit} <br class="title-page-name"/>          secondary={true} <br class="title-page-name"/>          type='submit' <br class="title-page-name"/>          style={{margin: '10px auto', <br class="title-page-name"/>           display: 'block', width: 150}} <br class="title-page-name"/>          label={'Submit Article'} /&gt; <br class="title-page-name"/>      &lt;/div&gt; <br class="title-page-name"/>    );
</pre>
<p class="calibre2">Change it to the following:</p>
<pre class="calibre22">
   return ( <br class="title-page-name"/>      &lt;div style={{height: '100%', width: '75%', margin: 'auto'}}&gt; <br class="title-page-name"/>        &lt;h1&gt;Add Article&lt;/h1&gt; <br class="title-page-name"/><br class="title-page-name"/>        &lt;Formsy.Form onSubmit={this._articleSubmit}&gt; <br class="title-page-name"/>          &lt;DefaultInput  <br class="title-page-name"/>            onChange={(event) =&gt; {}}  <br class="title-page-name"/>            name='title'  <br class="title-page-name"/>            title='Article Title (required)' required /&gt; <br class="title-page-name"/><br class="title-page-name"/>          &lt;DefaultInput  <br class="title-page-name"/>            onChange={(event) =&gt; {}}  <br class="title-page-name"/>            name='subTitle'  <br class="title-page-name"/>            title='Article Subtitle' /&gt; <br class="title-page-name"/><br class="title-page-name"/>          &lt;WYSIWYGeditor <br class="title-page-name"/>            name='addarticle' <br class="title-page-name"/>            title='Create an article' <br class="title-page-name"/>            onChangeTextJSON={this._onDraftJSChange} /&gt; <br class="title-page-name"/><br class="title-page-name"/>          &lt;div style={{margin: '10px 10px 10px 10px'}}&gt;  <br class="title-page-name"/>            &lt;ImgUploader updateImgUrl={this.updateImgUrl} <br class="title-page-name"/>             articlePicUrl={this.state.articlePicUrl} /&gt; <br class="title-page-name"/>          &lt;/div&gt; <br class="title-page-name"/><br class="title-page-name"/>          &lt;RaisedButton <br class="title-page-name"/>            secondary={true} <br class="title-page-name"/>            type='submit' <br class="title-page-name"/>            style={{margin: '10px auto', <br class="title-page-name"/>             display: 'block', width: 150}} <br class="title-page-name"/>            label={'Submit Article'} /&gt; <br class="title-page-name"/>        &lt;/Formsy.Form&gt; <br class="title-page-name"/>      &lt;/div&gt; <br class="title-page-name"/>    );
</pre>
<p class="calibre2">In this code snippet, we have added <kbd class="calibre11">Formsy.Form</kbd> the same way as in the <kbd class="calibre11">LoginView</kbd>, so I won't describe it in detail. The most important thing to notice is that with <kbd class="calibre11">onSubmit</kbd>, we call the <kbd class="calibre11">this._articleSubmit</kbd> function. We have also added two <kbd class="calibre11">DefaultInput</kbd> components (title and subtitle): the data from those two inputs will be used in <kbd class="calibre11">async _articleSubmit(articleModel)</kbd> (as you already know based on previous implementations in this book).</p>
<p class="calibre2">Based on the changes in the Mongoose config and in the <kbd class="calibre11">AddArticleView</kbd> component, you are now able to add a title and subtitle to a new article, as in the following screenshot:</p>
<div class="packt_figure"><img class="image-border75" src="../images/00080.jpeg"/></div>
<p class="calibre2">We're still missing the ability to edit the title and subtitle, so let's implement that now.</p>


            </article>

            <footer class="calibre4">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">Ability to edit an article title and subtitle</h1>
            

            <article>
                
<p class="calibre2">Go to the <kbd class="calibre11">src/views/articles/EditArticleView.js</kbd> file and add new imports (in a similar way to the <kbd class="calibre11">add</kbd> view):</p>
<pre class="calibre22">
import DefaultInput from '../../components/DefaultInput'; <br class="title-page-name"/>import Formsy from 'formsy-react';
</pre>
<p class="calibre2">Improve the old <kbd class="calibre11">_articleEditSubmit</kbd> function from the current version:</p>
<pre class="calibre22">
// old code: <br class="title-page-name"/>  async _articleEditSubmit() { <br class="title-page-name"/>    let currentArticleID = this.state.editedArticleID; <br class="title-page-name"/>    let editedArticle = { <br class="title-page-name"/>      _id: currentArticleID, <br class="title-page-name"/>      articleTitle: this.state.title, <br class="title-page-name"/>      articleContent: this.state.htmlContent, <br class="title-page-name"/>      articleContentJSON: this.state.contentJSON, <br class="title-page-name"/>      articlePicUrl: this.state.articlePicUrl <br class="title-page-name"/>    } <br class="title-page-name"/>    // rest of the function has been striped below
</pre>
<p class="calibre2">Change it to the following:</p>
<pre class="calibre22">
 async _articleEditSubmit(articleModel) { <br class="title-page-name"/>    let currentArticleID = this.state.editedArticleID; <br class="title-page-name"/>    let editedArticle = { <br class="title-page-name"/>      _id: currentArticleID, <br class="title-page-name"/>      articleTitle: articleModel.title, <br class="title-page-name"/>      articleSubTitle: articleModel.subTitle, <br class="title-page-name"/>      articleContent: this.state.htmlContent, <br class="title-page-name"/>      articleContentJSON: this.state.contentJSON, <br class="title-page-name"/>      articlePicUrl: this.state.articlePicUrl <br class="title-page-name"/>    } <br class="title-page-name"/>    // rest of the function has been striped below
</pre>
<p class="calibre2">As you can see, we do the same thing as in the <kbd class="calibre11">AddArticleView</kbd>, so you should be familiar with it. The last thing to do is update <kbd class="calibre11">render</kbd> so that we are able to input the title and subtitle that will be sent as a callback to <kbd class="calibre11">_articleEditSubmit</kbd> with data in the <kbd class="calibre11">articleModel</kbd>. The old return in the <kbd class="calibre11">render</kbd> function is as follows:</p>
<pre class="calibre22">
// old code: <br class="title-page-name"/>    return ( <br class="title-page-name"/>      &lt;div style={{height: '100%', width: '75%', margin: 'auto'}}&gt; <br class="title-page-name"/>        &lt;h1&gt;Edit an existing article&lt;/h1&gt; <br class="title-page-name"/>        &lt;WYSIWYGeditor <br class="title-page-name"/>          initialValue={initialWYSIWYGValue} <br class="title-page-name"/>          name='editarticle' <br class="title-page-name"/>          title='Edit an article' <br class="title-page-name"/>          onChangeTextJSON={this._onDraftJSChange} /&gt; <br class="title-page-name"/>        &lt;div style={{margin: '10px 10px 10px 10px'}}&gt;  <br class="title-page-name"/>          &lt;ImgUploader updateImgUrl={this.updateImgUrl} <br class="title-page-name"/>           articlePicUrl={this.state.articlePicUrl} /&gt; <br class="title-page-name"/>        &lt;/div&gt; <br class="title-page-name"/>        &lt;RaisedButton <br class="title-page-name"/>          onClick={this._articleEditSubmit} <br class="title-page-name"/>          secondary={true} <br class="title-page-name"/>          type='submit' <br class="title-page-name"/>          style={{margin: '10px auto', <br class="title-page-name"/>           display: 'block', width: 150}} <br class="title-page-name"/>          label={'Submit Edition'} /&gt; <br class="title-page-name"/>        &lt;hr /&gt; <br class="title-page-name"/>        {/* striped below */}
</pre>
<p class="calibre2">The new improved return in the <kbd class="calibre11">render</kbd> function is as follows:</p>
<pre class="calibre22">
   return ( <br class="title-page-name"/>      &lt;div style={{height: '100%', width: '75%', margin: 'auto'}}&gt; <br class="title-page-name"/>        &lt;h1&gt;Edit an existing article&lt;/h1&gt; <br class="title-page-name"/>        &lt;Formsy.Form onSubmit={this._articleEditSubmit}&gt; <br class="title-page-name"/>          &lt;DefaultInput  <br class="title-page-name"/>            onChange={(event) =&gt; {}} <br class="title-page-name"/>            name='title'  <br class="title-page-name"/>            value={this.state.articleDetails.articleTitle} <br class="title-page-name"/>            title='Article Title (required)' required /&gt; <br class="title-page-name"/><br class="title-page-name"/>          &lt;DefaultInput  <br class="title-page-name"/>            onChange={(event) =&gt; {}} <br class="title-page-name"/>            name='subTitle'  <br class="title-page-name"/>            value={this.state.articleDetails.articleSubTitle} <br class="title-page-name"/>            title='Article Subtitle' /&gt; <br class="title-page-name"/><br class="title-page-name"/>          &lt;WYSIWYGeditor <br class="title-page-name"/>            initialValue={initialWYSIWYGValue} <br class="title-page-name"/>            name='editarticle' <br class="title-page-name"/>            title='Edit an article' <br class="title-page-name"/>            onChangeTextJSON={this._onDraftJSChange} /&gt; <br class="title-page-name"/><br class="title-page-name"/>          &lt;div style={{margin: '10px 10px 10px 10px'}}&gt;  <br class="title-page-name"/>            &lt;ImgUploader updateImgUrl={this.updateImgUrl} <br class="title-page-name"/>             articlePicUrl={this.state.articlePicUrl} /&gt; <br class="title-page-name"/>          &lt;/div&gt; <br class="title-page-name"/><br class="title-page-name"/>          &lt;RaisedButton <br class="title-page-name"/>            onClick={this._articleEditSubmit} <br class="title-page-name"/>            secondary={true} <br class="title-page-name"/>            type='submit' <br class="title-page-name"/>            style={{margin: '10px auto', <br class="title-page-name"/>             display: 'block', width: 150}} <br class="title-page-name"/>            label={'Submit Edition'} /&gt; <br class="title-page-name"/>        &lt;/Formsy.Form&gt; <br class="title-page-name"/>        {/* striped below */}
</pre>
<p class="calibre2">We are doing the same thing here as we did in the <kbd class="calibre11">AddArticleView</kbd>. We are introducing <kbd class="calibre11">Formsy.Form</kbd>, which is calling back the article's title and subtitle when a user hits the submit button (<span>SUBMIT EDITION</span>).</p>
<p class="calibre2">Here is an example of how it should look:</p>
<div class="packt_figure"><img class="image-border76" src="../images/00081.jpeg"/></div>


            </article>

            <footer class="calibre4">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">ArticleCard and PublishingApp improvements</h1>
            

            <article>
                
<p class="calibre2">Improve the <kbd class="calibre11">render</kbd> function in <kbd class="calibre11">ArticleCard</kbd> so it will also show the subtitle (currently, it's mocked). The <kbd class="calibre11">src/components/ArticleCard.js</kbd> file's old content is as follows:</p>
<pre class="calibre22">
// old code: <br class="title-page-name"/>  render() { <br class="title-page-name"/>    let title = this.props.title || 'no title provided'; <br class="title-page-name"/>    let content = this.props.content || 'no content provided'; <br class="title-page-name"/>    let articlePicUrl = this.props.articlePicUrl || <br class="title-page-name"/>     '/static/placeholder.png'; <br class="title-page-name"/><br class="title-page-name"/>    let paperStyle = { <br class="title-page-name"/>      padding: 10,  <br class="title-page-name"/>      width: '100%',  <br class="title-page-name"/>      height: 300 <br class="title-page-name"/>    }; <br class="title-page-name"/><br class="title-page-name"/>    let leftDivStyle = { <br class="title-page-name"/>      width: '30%',  <br class="title-page-name"/>      float: 'left' <br class="title-page-name"/>    } <br class="title-page-name"/><br class="title-page-name"/>    let rightDivStyle = { <br class="title-page-name"/>      width: '60%',  <br class="title-page-name"/>      float: 'left',  <br class="title-page-name"/>      padding: '10px 10px 10px 10px' <br class="title-page-name"/>    } <br class="title-page-name"/><br class="title-page-name"/>    return ( <br class="title-page-name"/>      &lt;Paper style={paperStyle}&gt; <br class="title-page-name"/>        &lt;CardHeader <br class="title-page-name"/>          title={this.props.title} <br class="title-page-name"/>          subtitle='Subtitle' <br class="title-page-name"/>          avatar='/static/avatar.png' <br class="title-page-name"/>        /&gt; <br class="title-page-name"/><br class="title-page-name"/>        &lt;div style={leftDivStyle}&gt; <br class="title-page-name"/>          &lt;Card &gt; <br class="title-page-name"/>            &lt;CardMedia <br class="title-page-name"/>              overlay={&lt;CardTitle title={title} <br class="title-page-name"/>               subtitle='Overlay subtitle' /&gt;}&gt; <br class="title-page-name"/>              &lt;img src={articlePicUrl} height='190' /&gt; <br class="title-page-name"/>            &lt;/CardMedia&gt; <br class="title-page-name"/>          &lt;/Card&gt; <br class="title-page-name"/>        &lt;/div&gt; <br class="title-page-name"/>        &lt;div style={rightDivStyle}&gt; <br class="title-page-name"/>          &lt;div dangerouslySetInnerHTML={{__html: content}} /&gt; <br class="title-page-name"/>        &lt;/div&gt; <br class="title-page-name"/>      &lt;/Paper&gt;); <br class="title-page-name"/>  }
</pre>
<p class="calibre2">Let's change this to the following:</p>
<pre class="calibre22">
 render() { <br class="title-page-name"/>    let title = this.props.title || 'no title provided'; <br class="title-page-name"/>    let subTitle = this.props.subTitle || ''; <br class="title-page-name"/>    let content = this.props.content || 'no content provided'; <br class="title-page-name"/>    let articlePicUrl = this.props.articlePicUrl || <br class="title-page-name"/>     '/static/placeholder.png'; <br class="title-page-name"/><br class="title-page-name"/>    let paperStyle = { <br class="title-page-name"/>      padding: 10,  <br class="title-page-name"/>      width: '100%',  <br class="title-page-name"/>      height: 300 <br class="title-page-name"/>    }; <br class="title-page-name"/><br class="title-page-name"/>    let leftDivStyle = { <br class="title-page-name"/>      width: '30%',  <br class="title-page-name"/>      float: 'left' <br class="title-page-name"/>    } <br class="title-page-name"/><br class="title-page-name"/>    let rightDivStyle = { <br class="title-page-name"/>      width: '60%',  <br class="title-page-name"/>      float: 'left',  <br class="title-page-name"/>      padding: '10px 10px 10px 10px' <br class="title-page-name"/>    } <br class="title-page-name"/><br class="title-page-name"/>    return ( <br class="title-page-name"/>      &lt;Paper style={paperStyle}&gt; <br class="title-page-name"/>        &lt;CardHeader <br class="title-page-name"/>          title={this.props.title} <br class="title-page-name"/>          subtitle={subTitle} <br class="title-page-name"/>          avatar='/static/avatar.png' <br class="title-page-name"/>        /&gt; <br class="title-page-name"/><br class="title-page-name"/>        &lt;div style={leftDivStyle}&gt; <br class="title-page-name"/>          &lt;Card &gt; <br class="title-page-name"/>            &lt;CardMedia <br class="title-page-name"/>              overlay={&lt;CardTitle title={title} <br class="title-page-name"/>               subtitle={subTitle} /&gt;}&gt; <br class="title-page-name"/>              &lt;img src={articlePicUrl} height='190' /&gt; <br class="title-page-name"/>            &lt;/CardMedia&gt; <br class="title-page-name"/>          &lt;/Card&gt; <br class="title-page-name"/>        &lt;/div&gt; <br class="title-page-name"/>        &lt;div style={rightDivStyle}&gt; <br class="title-page-name"/>          &lt;div dangerouslySetInnerHTML={{__html: content}} /&gt; <br class="title-page-name"/>        &lt;/div&gt; <br class="title-page-name"/>      &lt;/Paper&gt;); <br class="title-page-name"/>  }
</pre>
<p class="calibre2">As you can see, we have defined a new <kbd class="calibre11">subTitle</kbd> variable and have then used it in the <kbd class="calibre11">CardHeader</kbd> and <kbd class="calibre11">CardMedia</kbd> components, so now it will show the subtitle as well.</p>
<p class="calibre2">Another thing to do is to make the <kbd class="calibre11">PublishingApp</kbd> also fetch the subtitle that has been introduced in the chapter, so we need to improve the following old code:</p>
<pre class="calibre22">
// old code: <br class="title-page-name"/>  async _fetch() { <br class="title-page-name"/>    let articlesLength = await falcorModel. <br class="title-page-name"/>      getValue('articles.length'). <br class="title-page-name"/>      then((length) =&gt; length); <br class="title-page-name"/><br class="title-page-name"/>    let articles = await falcorModel. <br class="title-page-name"/>      get(['articles', {from: 0, to: articlesLength-1}, <br class="title-page-name"/>       ['_id','articleTitle', 'articleContent', <br class="title-page-name"/>       'articleContentJSON', 'articlePicUrl']]).  <br class="title-page-name"/>      then((articlesResponse) =&gt; {   <br class="title-page-name"/>        return articlesResponse.json.articles; <br class="title-page-name"/>      }).catch(e =&gt; { <br class="title-page-name"/>        console.debug(e); <br class="title-page-name"/>        return 500; <br class="title-page-name"/>      }); <br class="title-page-name"/>    // no changes below, striped
</pre>
<p class="calibre2">Replace it with the following:</p>
<pre class="calibre22">
 async _fetch() { <br class="title-page-name"/>    let articlesLength = await falcorModel. <br class="title-page-name"/>      getValue('articles.length'). <br class="title-page-name"/>      then((length) =&gt; length); <br class="title-page-name"/><br class="title-page-name"/>    let articles = await falcorModel. <br class="title-page-name"/>      get(['articles', {from: 0, to: articlesLength-1}, ['_id', <br class="title-page-name"/>       'articleTitle', 'articleSubTitle','articleContent', <br class="title-page-name"/>       'articleContentJSON', 'articlePicUrl']]).  <br class="title-page-name"/>      then((articlesResponse) =&gt; {   <br class="title-page-name"/>        return articlesResponse.json.articles; <br class="title-page-name"/>      }).catch(e =&gt; { <br class="title-page-name"/>        console.debug(e); <br class="title-page-name"/>        return 500; <br class="title-page-name"/>      });
</pre>
<p class="calibre2">As you can see, we have started <kbd class="calibre11">falcorModel.get</kbd> with the <kbd class="calibre11">articleSubTitle</kbd> property.</p>
<p class="calibre2">Of course, we need to pass this <kbd class="calibre11">subTitle</kbd> property to the <kbd class="calibre11">ArticleCard</kbd> component in the <kbd class="calibre11">PublishingApp</kbd> class's <kbd class="calibre11">render</kbd> function:</p>
<pre class="calibre22">
// old code: <br class="title-page-name"/>    this.props.article.forEach((articleDetails, articleKey) =&gt; { <br class="title-page-name"/>      let currentArticleJSX = ( <br class="title-page-name"/>        &lt;div key={articleKey}&gt; <br class="title-page-name"/>          &lt;ArticleCard  <br class="title-page-name"/>            title={articleDetails.articleTitle} <br class="title-page-name"/>            content={articleDetails.articleContent} <br class="title-page-name"/>      articlePicUrl={articleDetails.articlePicUrl} /&gt; <br class="title-page-name"/>        &lt;/div&gt; <br class="title-page-name"/>      );
</pre>
<p class="calibre2">In the end, we will get the following:</p>
<pre class="calibre22">
   this.props.article.forEach((articleDetails, articleKey) =&gt; { <br class="title-page-name"/>      let currentArticleJSX = ( <br class="title-page-name"/>        &lt;div key={articleKey}&gt; <br class="title-page-name"/>          &lt;ArticleCard  <br class="title-page-name"/>            title={articleDetails.articleTitle} <br class="title-page-name"/>            content={articleDetails.articleContent}  <br class="title-page-name"/>            articlePicUrl={articleDetails.articlePicUrl} <br class="title-page-name"/>      subTitle={articleDetails.articleSubTitle} /&gt; <br class="title-page-name"/>        &lt;/div&gt; <br class="title-page-name"/>      );
</pre>
<p class="calibre2">After all these changes on the main page, you can find an edited article with the title, subtitle, cover photo, and content (created by our WYSIWYG editor):</p>
<div class="packt_figure"><img class="image-border77" src="../images/00082.jpeg"/></div>


            </article>

            <footer class="calibre4">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">Dashboard improvement (now we can strip the remaining HTML)</h1>
            

            <article>
                
<p class="calibre2">The last step in this chapter is to improve the dashboard. It will string the HTML from the props in order to make a better look and feel when a user will browse our application. Find the following code:</p>
<pre class="calibre22">
// old code: <br class="title-page-name"/>    this.props.article.forEach((articleDetails, articleKey) =&gt; { <br class="title-page-name"/>      let articlePicUrl = articleDetails.articlePicUrl || <br class="title-page-name"/>       '/static/placeholder.png'; <br class="title-page-name"/>      let currentArticleJSX = ( <br class="title-page-name"/>        &lt;Link to={&amp;grave;/edit-article/${articleDetails['_id']}&amp;grave;} <br class="title-page-name"/>         key={articleKey}&gt; <br class="title-page-name"/>          &lt;ListItem <br class="title-page-name"/><br class="title-page-name"/>            leftAvatar={&lt;img src={articlePicUrl} width='50' <br class="title-page-name"/>             height='50' /&gt;} <br class="title-page-name"/>            primaryText={articleDetails.articleTitle} <br class="title-page-name"/>            secondaryText={articleDetails.articleContent} <br class="title-page-name"/>          /&gt; <br class="title-page-name"/>        &lt;/Link&gt; <br class="title-page-name"/>      );
</pre>
<p class="calibre2">Replace it with the following:</p>
<pre class="calibre22">
   this.props.article.forEach((articleDetails, articleKey) =&gt; { <br class="title-page-name"/>      let articlePicUrl = articleDetails.articlePicUrl || <br class="title-page-name"/>       '/static/placeholder.png'; <br class="title-page-name"/>      let articleContentPlanText = <br class="title-page-name"/>       articleDetails.articleContent.replace(/&lt;/?[^&gt;]+(&gt;|$)/g, <br class="title-page-name"/>       ''); <br class="title-page-name"/>      let currentArticleJSX = ( <br class="title-page-name"/>        &lt;Link to={&amp;grave;/edit-article/${articleDetails['_id']}&amp;grave;} <br class="title-page-name"/>         key={articleKey}&gt; <br class="title-page-name"/>          &lt;ListItem <br class="title-page-name"/><br class="title-page-name"/>            leftAvatar={&lt;img src={articlePicUrl} width='50' <br class="title-page-name"/>             height='50' /&gt;} <br class="title-page-name"/>            primaryText={articleDetails.articleTitle} <br class="title-page-name"/>            secondaryText={articleContentPlanText} <br class="title-page-name"/>          /&gt; <br class="title-page-name"/>        &lt;/Link&gt; <br class="title-page-name"/>      );
</pre>
<p class="calibre2">As you can see, we simply strip the HTML tags from the HTML so that we will get better <kbd class="calibre11">secondaryText</kbd> without the HTML markup, as in this example:</p>
<div class="packt_figure"><img class="image-border78" src="../images/00083.jpeg"/></div>


            </article>

            <footer class="calibre4">
                
            </footer>

        </section>
    

        <section>

            <header>
                </header><h1 class="header-title" id="calibre_pb_0">Summary</h1>
            

            <article>
                
<p class="calibre2">We have implemented all of the features that are within the book's scope. The next step is to start working on the deployment of this application.</p>
<p class="calibre2">If you want to improve your coding skills, it's a good idea to implement some features completely on your own. These are some ideas for features that are still missing from our publishing app.</p>
<p class="calibre2">We could have a separate link to a certain article so you can share it with a friend. This could be useful if you want to create a human-readable unique slug associated with a certain article in the database. So, instead of linking to something such as <a href="http://reactjs.space/570b6e26ae357d391c6ebc1d" class="calibre6"><span>http://reactjs.space/570b6e26ae357d391c6ebc1d</span></a> (<kbd class="calibre11">reactjs.space</kbd> is a domain that we will use on our production server), a user can share a link such as <a href="http://reactjs.space/an-article-about-a-dog" class="calibre6"><span>http://reactjs.space/an-article-about-a-dog</span></a>.</p>
<p class="calibre2">There could be a way to associate an article with the editor who posted it. Currently, it's mocked. You can unmock it.</p>
<p class="calibre2">A user can't change their user details while they are logged in--this could be a good way to practice more full-stack development.</p>
<p class="calibre2">A user can't set up their avatar's image--you can add this feature in a similar way to how we implemented the image cover.</p>
<p class="calibre2">Create a more robust Draft.JS WYSIWYG editor with plugins. Robust plugins are easy to implement for mentions, stickers, emoji, hashtags, undo/redo, and more. Visit <a href="https://www.draft-js-plugins.com/" class="calibre6"><span>https://www.draft-js-plugins.com/</span></a> for more details about them. Implement one or two that you like the most.</p>
<p class="calibre2">In the next chapter, we will start deploying our MongoDB instance online using <a href="http://www.mLab.com" class="calibre6">www.mLab.com</a>, which is a Database-as-a-Service provider and helps us build scalable MongoDB nodes with ease.</p>
<p class="calibre2">Let's start with the deployment fun!</p>


            </article>

            <footer class="calibre4">
                
            </footer>

        </section>
    </body></html>