

# 第十三章：技巧与展望

本章分为两部分。在第一部分，我收集了关于如何使你的 React Native 项目成功的最有用的技巧。这些技巧来自于我在作为开发者、顾问、软件架构师或产品所有者参与的大量不同的 React Native 项目中所学到的知识。我还将 React Native 作为我自己的公司中的技术栈，我负责业务方面，因此我也了解这一方面的需求和痛点。

第二部分是对我认为 React Native、其社区及其生态系统未来如何发展的展望。这是基于其技术发展以及社区中不同大玩家的承诺。

这意味着你将在本章学习以下内容：

+   理解使你的 React Native 项目成功的重要因素

+   光明的未来

# 技术要求

由于这是一个完全理论性的章节，因此没有技术要求。

# 理解使你的 React Native 项目成功的重要因素

在这本书中，你学到了很多关于如何确保 React Native 项目成功的专业技术基础。但如果你已经参与过生产项目，你知道软件项目永远不会像书中描述的那样工作。总会有突如其来的障碍和问题，以及看似不可能实现的截止日期。

这些技巧将确保你能够克服这些障碍，解决问题，并在现实世界的软件项目中最终取得成功。所以，让我们立即开始介绍这些技巧。

## 技巧 1 – 找到一个你永远不需要绕过的流程

我参与过的许多项目一开始都有明确的过程定义，但通常会出现有人绕过流程的情况。一个非常常见的例子如下：

*业务方面需要将功能或错误修复包含在今天的版本中，导致测试减少，审查不够详细，甚至直接提交到发布分支。*

这是我在很多项目中都经历过的事情。问题是，在几乎所有我经历的情况中，这最终导致了更多的工作。测试必须延后进行，发现的错误必须修复，直接的提交必须稍后合并或选择，大多数时候代码必须重构，在最坏的情况下，一个错误可能导致需要稍后修复的数据损坏。因此，这种行为的额外工作可能会使你按照流程进行的工作量增加 10 倍或更多。

所以，简单的回答可能是对业务方面说“不”，但这种情况并不总是可能的，因为业务方面可能有一个合理的担忧。想象一下，**首席执行官**（CEO）向一个重要客户承诺了一个功能，并担心由于下一个版本只在一周后发布，他们可能无法按时交付。

这是一个你必须调整你的流程以实现更快的发布周期或允许紧急发布的例子，以消除 CEO 的担忧。

这只是一个例子，也是针对这个具体例子的一个具体解决方案。还有许多其他场景，团队成员可能会对流程失去信心，并试图绕过它。

有时，解释过程背后的**原因**就足够了；在其他时候，则需要适应。但本小节的要点是：*找到你信任的过程，永远不要绕过它*。

## 提示 2 – 计划尽可能灵活，使用无存储发布更新的策略

项目团队越大，出现影响发布计划的问题的可能性就越大。再次强调，我想用一个例子来开始这个提示。我正在开发的一个应用程序被翻译成了 36 种语言。这意味着在每次发布之前，所有引入到**用户界面**（**UI**）的文本都会被传递给翻译人员。

他们有 36 小时的时间翻译和验证这些文本，并将它们上传到我们的翻译服务。在这 36 小时之后，我们运行了发布管道，并将包含翻译的二进制文件发布的应用程序发布出去。

这导致了两个问题。首先，我们必须等待 36 小时才能将发布版本提交给苹果/谷歌进行审查。其次，大多数时候，至少有一位翻译人员迟到，导致新文本在该语言中直到下一次发布才可用。

我们通过为我们的应用程序添加所有翻译的更新功能来解决此问题。此功能在下图中展示：

![图 13.1 – 无存储发布更新

![图片/B16694_13_01.jpg]

图 13.1 – 无存储发布更新

我们仍然将翻译文件打包到二进制文件中，并带有这些翻译的发布版本发送出去。但在应用程序启动时，我们会在我们的服务器上搜索更新的翻译。如果我们找到任何，我们会获取并持久化它们，以确保用户设备上始终有最新版本可用。更详细的解释可以在这里找到：[`bit.ly/prn-update-translations`](https://bit.ly/prn-update-translations)。

这个流程不仅适用于翻译，也适用于任何应本地可用且频繁更改的数据类型。

你甚至可以更进一步，使用如 Microsoft CodePush 或 Expo Updates 之类的空中更新工具。这些工具利用了 React Native 应用程序是一个包含 JavaScript 包的原生应用程序的事实，通过提供一种在空中更新整个 JavaScript 包的解决方案。

基本上，你的应用程序连接到工具的服务器并搜索更新的 JavaScript 包。如果找到更新包，它将被下载，你的应用程序将启动/重启。

虽然这些工具对于修复 bug 甚至改进功能非常有帮助，但根据 App Store 和 Google Play 的指南，不允许使用它们来引入新功能。此外，你必须记住，它们仅限于 JavaScript 包。

一旦你引入了新的原生功能、资产或其他内容，这些工具就无法提供此类更新。更糟糕的是，如果你尝试使用这些工具提供此类更新，你可能会在用户的设备上破坏你的应用程序，因为你试图访问不存在的原生功能。

因此，如果你使用这些工具，请务必小心。在这里，你可以阅读更多关于 CodePush 的信息（[`bit.ly/prn-ms-code-push`](https://bit.ly/prn-ms-code-push)），而在这里，你可以找到关于 Expo 更新的更多详细信息（[`bit.ly/prn-expo-updates`](https://bit.ly/prn-expo-updates)）。

所有这些想法只有一个目标：尽可能灵活，以便能够应对可能出现的任何要求。尽管苹果和谷歌通常在不到 1 天内完成审查，使得原生发布到 App Store 或 Google Play 不再是一个大问题，但了解即使苹果或谷歌延迟审查流程，也能提供更新是很好的。

所以，本小节的要点是：*制定一个策略，以便尽可能快和灵活地更新你的应用程序*。

## 小贴士 3 – 总是使用稳定性监控工具关注你的应用程序中发生的事情

在软件开发中，唯一确定的事情是，没有没有 bug 的软件。所以，你的应用程序将包含 bug，用户可能会遇到问题。唯一的问题是：你何时会注意到它？

在过去几年中，我学到的最重要的事情之一是，你对应用程序中发生的事情了解得越多，你就能越快地做出反应。最糟糕的情况是，你只是在用户对你的应用程序写差评后才发现了一个 bug。

有很多不同的稳定性监控工具作为**软件即服务**（**SaaS**）产品可用。在 React Native 应用程序中，最广泛使用的是 Bugsnag 和 Sentry。两者都提供了出色的 React Native 支持，通过提供 React Native **软件开发工具包**（**SDKs**）。

这些 SDK 收集原生崩溃以及 JavaScript 错误，添加有关设备类型和状态的有用信息，并将它们发送到服务器。服务器整合数据，这些工具提供了一个网络仪表板，你可以从中获取有关应用程序稳定性的信息。

你可以查看每一个崩溃和错误，甚至通过提供源映射来追踪错误回溯到代码中的特定行。

当出现以前未见过的 bug 时，你还可以将这些工具连接到你的项目管理工具，以自动创建问题。

还有其他解决方案可供选择，你甚至可以自己编写，但你应该确保实施任何解决方案来跟踪你应用的稳定性。所以，这个技巧的要点是：*使用稳定性监控工具*。

## 提示 4 – 让用户通过 A/B 测试进行测试

**A/B 测试**是现在在移动应用开发的许多领域都使用的一种方法，你绝对应该使用它。这意味着你将你的用户分成两组，并向他们提供应用的不同部分。然后，你等待一段时间，查看指标，以查看哪个用户组在你关心的指标中表现更好。

在移动开发中，A/B 测试最常见的使用案例是测试新功能。如果你不确定新功能是否有助于提高你的目标指标（例如提高留存率），你将只向一半的用户提供新功能。

你将这些用户标记为组 *A*。其他没有访问新功能的用户将被标记为组 *B*。然后，你会等待并收集数据。一段时间后，你可以比较哪个用户组在目标指标方面表现更好。

这可以通过功能、设计、措辞、图片等等来实现。但 A/B 测试也可以用于完全不同的案例。

使用 A/B 测试的另一个例子是将应用更新仅发布给一组人。这可能是一个测试组，或者在 Google Play 上，你甚至可以决定只将更新推广到你用户的一定百分比。然后，你可以比较旧版本和新版本的老化稳定性指标，以将更新推广给所有用户。

因此，A/B 测试可以帮助你在真实世界环境中获得所需的答案，这是唯一重要的环境。所以，这个技巧的关键要点是：*使用 A/B 测试收集信息，以便能够做出更好的决策*。

## 提示 5 – 使用 TypeScript 作为单一语言栈

TypeScript 是一种在移动、网页和后端上工作的类型化语言。当你使用这种单一语言栈设置项目时，这是一个巨大的优势。你的整个团队至少能够阅读和理解整个项目的代码。

如果需要，有才华的软件开发人员也可以从后端转移到前端或相反方向，你甚至可以在客户端和服务器之间共享代码。这在你有共享的数据类型或业务逻辑时尤其有趣，这些逻辑在移动客户端上运行，在网页服务器上运行。

为此代码有一个共享的基础可以保证数据类型和业务逻辑行为在移动、网页和服务器之间不会有所不同。

我在单一语言栈项目中经历了最佳的结果，最快的**上市时间**（**TTM**），以及最好的团队合作。所以，这个技巧的要点是：*使用 TypeScript 作为单一语言栈*。

## 提示 6 – 保持你的代码简单和清晰

这个技巧看似明显，但让我解释一下我的意思。有一些简单的想法可以使你的代码保持简单和清晰。

当使用 React 和 React Native 时，你通常有很多不同的选项来解决特定的问题。你必须做出的第一个选择是在功能组件和类组件之间。

但还有许多其他的选择要做。你将使用哪种状态管理解决方案？你将如何连接你的后端？你会编写自己的原生解决方案吗？如果是这样，你将使用哪种语言？

如果你做出了这些选择，你应该坚持你的选择。如果你为状态组件同时使用功能组件和类组件，这会使应用程序更加复杂。同样适用于所有其他选项。做出选择并坚持下去。

接下来，你应该始终将可重用的代码提取到组件中。大多数情况下，创建一个带有一些配置选项的组件，而不是多次编写几乎相同的代码，要容易得多。

最重要的是，永远不要重复代码。这不仅会增加引入错误或不一致的风险，而且在长期来看也会花费更多的时间。维护一个精简的代码库，其中所有内容都提取到组件中，要容易得多。

最后，尽量编写可读的代码。在完成一个功能后，总是看看你的代码，问问自己是否有其他开发者可以在不阅读任何文档或运行应用的情况下理解你所写的内容。如果不能，尝试重命名和重构你的代码，直到它变得可理解。如果代码没有这些注释就无法工作，那么请添加注释。

目标是让新加入的开发团队能够尽可能快地开始产生效益。所以，这里的关键要点是：*尽可能使用简单、清晰、易懂的代码，并尽量少使用不同的库。*

使用这些技巧，你应该不仅能够生存，而且能够在你的下一个 React Native 项目中取得成功。

作为这本书的最后一部分，我想简要地展望一下 React Native 的未来。

# 理解 React Native 的光明未来

在决定使用哪种技术时，它总是对未来技术的长期适用性起着重要作用。这在长期运行的大型企业项目中尤为重要。因此，我决定以一些论据结束这本书，以证明你可以绝对确信 React Native 是一个好的选择。

这尤其有趣，因为过去几年对 React Native 开发者来说并不总是容易。基于非常高效的二维（**2D**）图形引擎 Skia 的 Flutter，为跨平台开发提供了一种新的解决方案，并引发了巨大的炒作。

随着 Kotlin 和 Swift 的兴起，原生开发变得越来越舒适。与此同时，React Native 并没有太多的发展。长期承诺的重构（新架构），最初宣布于 2020 年，比预期的花费了更多的时间。一些开发者开始对 React Native 失去信心。

但这一切在 2022 年发生了变化。现在，React Native 的未来前所未有的光明。这有多个原因，我将在本书的最后一节中解释。

## 原因 1 – 新架构终于落地

如*第三章*中所述，*Hello React Native*，新架构为 React Native 应用程序和 React Native 社区带来了巨大的推动。以下是新架构带来的最重要的改进：

+   **通用性能**：用**JavaScript 接口**（**JSI**）替换旧的 React Native 桥接消除了 React Native 最大的性能瓶颈。在 JavaScript 和应用程序的本地部分之间传递数据时不再需要序列化/反序列化。这以及其他许多优化使得缩小与 Flutter 应用或原生应用的性能差距成为可能。

+   **启动时间**：新架构允许应用程序的原生模块进行懒加载，这大大提高了启动时间。

+   **同步通信**：随着新架构的引入，现在可以从 JavaScript 线程内部调用原生函数，这可以使得代码更加简洁和易于编写。

+   **编写原生模块**：CodeGen 和新的架构总体上使得编写原生模块变得更加容易。内置的类型安全还支持开发中最重要的功能之一。

我预计新架构的全面推广将在 2023 年初完成。这意味着大多数社区库都将进行适配，你可以在一个稳定的环境中从所有改进中受益。

再次强调，这个新架构真的是一个很大的事情，因为它反驳了大多数反对使用 React Native 的论点。

下一个原因是 React Native 有一个新的架构方法。一个社区项目使得在 React Native 中使用 Skia 成为可能，这同样是一个巨大的进步。

## 原因 2 – React Native Skia

正如我之前所解释的，Skia 是不仅为 Flutter 提供动力，也为 Google Chrome、Android、Firefox 以及更多产品提供动力的图形引擎。Skia 是这些产品之所以如此受欢迎的原因之一，因为它是一个极其强大且性能卓越的图形引擎。

过去曾有一些尝试利用 Skia 在 React Native 中的力量，但只有在新架构下才可能创建一个可工作的 React Native Skia 库。这对于 React Native 来说又是一个巨大的推动，因为它在屏幕绘制方面开辟了一个全新的世界。

要了解 React Native Skia 带来的新机会的广度，你必须看看 React Native 中渲染元素是如何工作的。正如在*第三章*“Hello React Native”中解释的那样，每个在 JavaScript 代码中使用的组件都将映射到一个原生组件。这也意味着你只能使用在原生端可用并且已映射到 React Native 组件的元素和属性。

React Native Skia 使用相同的概念，但创建了一个可以使用 Skia 图形引擎绘制的原生画布。然后它不在 React Native 中提供原生组件，而是在 Skia**应用程序编程接口**（**API**）中提供。

这意味着在未来，如果你更喜欢使用自己的图形引擎将 UI 绘制到屏幕上而不是使用原生组件，你不必再选择 Flutter。这也可以使用 React Native 实现。你甚至可以在同一个应用程序中使用这两个概念。

你绝对应该看看这个项目。它在 GitHub 上托管；你可以在这里找到所有信息：[`bit.ly/prn-rn-skia`](https://bit.ly/prn-rn-skia)。

React Native 拥有光明未来的下一个原因既简单又重要。该框架背后的社区仍在增长，包括许多对 React Native 下大注的大公司。

## 原因 3 – 社区

即使 React Native 最初是由 Facebook 创建的，但 React Native 已不再仅仅是 Meta（前身为 Facebook）。它还包括微软、Shopify、特斯拉、Salesforce、彭博社、Discord、Coinbase、Pinterest 以及许多其他公司。

这些公司也在大力押注 React Native。Meta 在 Facebook 应用中使用了超过 1,000 个屏幕，这仍然是世界上使用最广泛的应用之一。微软在他们的许多知名产品中使用 React Native，如 Microsoft Office 或 Microsoft Teams。Shopify 团队将他们的所有应用都重写为 React Native。

更好的是，这些公司中的大多数不仅使用 React Native，而且还在积极贡献。例如，微软为 Windows 和 macOS 创建了并维护 React Native。Shopify 赞助 React Native Skia，并支持多个其他社区项目，如 React Native FlashList。

而不仅仅是这些公司。这是全球成千上万的贡献者。这导致世界上最具活力的开发者社区之一，每天都在创建有用、高质量的开放源代码库和解决方案。

## 原因 4 – TypeScript 和 React

虽然它可能不是高性能计算任务的正确选择，但使用 TypeScript 作为移动应用程序的语言绝对是正确的选择。你可以在移动、Web 和服务器上运行它，以在这些平台之间共享代码。它易于学习和开始，新开发者可以非常快地变得高效。

如果你使用 TypeScript 作为你的单一语言栈，你将能够接触到最大的人才市场之一，这比 Dart（Flutter）、Kotlin（原生 Android）或 Swift（原生 iOS）开发者的市场要大得多。在信息技术人才非常稀缺的这些日子里，这一点尤为重要。

对于 React 来说，也是如此。它到目前为止是最受欢迎的 Web 框架。每一位 React 开发者都能够参与 React Native 项目，并且经过短短几天的培训后，也能非常高效地工作。这意味着你有一个非常大的人才库，你可以从中雇佣你的开发团队。

因此，当你决定在你的项目中使用 React Native 时，你不必感到害怕。对进一步开发这个框架有着巨大的承诺，你可以绝对确信它将会被长期积极地维护。许多大型公司都依赖于 React Native，他们这样做有很好的理由。所以，在我看来，它是编写移动应用的最佳选择。

# 概述

在展望了这些之后，现在是时候对这个章节做一个简短的总结了。在本章的第一部分，你学习了良好的开发过程是多么重要，如何尽可能灵活地发布，如何监控你应用的稳定性，如何利用 A/B 测试，如何在你的移动应用中使用 TypeScript，以及如何保持你的代码简单和整洁。在第二部分，你了解了 React Native 拥有光明未来的最重要的原因，并发现你可以绝对确信它是你移动应用的一个很好的选择。

现在，是时候给予最后的祝贺了。你已经完成了这本书的阅读，我希望你学到了许多新的、有用的东西。你现在应该已经理解了 React Native 是如何工作的，以及如何在大规模项目中使用它来构建适用于多个平台的高性能应用，这可以帮助你节省时间和金钱。
