<html><head></head><body>
<div id="_idContainer088">
<h1 class="chapterNumber"><a id="_idTextAnchor103"/><span class="koboSpan" id="kobo.1.1">4</span></h1>
<h1 class="chapterTitle" id="_idParaDest-100"><a id="_idTextAnchor104"/><span class="koboSpan" id="kobo.2.1">Using the Reducer and Effect Hooks</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.3.1">After developing our own blog application using the State Hook, we are now going to learn about two other very important Hooks that are provided by React—the </span><strong class="keyWord"><span class="koboSpan" id="kobo.4.1">Reducer</span></strong><span class="koboSpan" id="kobo.5.1"> and </span><strong class="keyWord"><span class="koboSpan" id="kobo.6.1">Effect</span></strong><span class="koboSpan" id="kobo.7.1"> Hooks. </span><span class="koboSpan" id="kobo.7.2">We will first learn when we should use a Reducer Hook instead of a State Hook. </span><span class="koboSpan" id="kobo.7.3">Then, we will learn how to turn our existing State Hook into a Reducer Hook to get a grasp on the concept in practice. </span><span class="koboSpan" id="kobo.7.4">Finally, we are going to learn about Effect Hooks and what they are used for and implement them in our blog application.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.8.1">The following topics will be covered in this chapter:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.9.1">Reducer Hooks versus State Hooks</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.10.1">Using Reducer Hooks</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.11.1">Using Effect Hooks</span></li>
</ul>
<h1 class="heading-1" id="_idParaDest-101"><a id="_idTextAnchor105"/><span class="koboSpan" id="kobo.12.1">Technical requirements</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.13.1">A fairly recent version of Node.js should already be installed. </span><span class="koboSpan" id="kobo.13.2">The Node Package Manager (</span><code class="inlineCode"><span class="koboSpan" id="kobo.14.1">npm</span></code><span class="koboSpan" id="kobo.15.1">) also needs to be installed (it should come with Node.js). </span><span class="koboSpan" id="kobo.15.2">For more information on how to install Node.js, please check out their official website: </span><a href="https://nodejs.org/"><span class="url"><span class="koboSpan" id="kobo.16.1">https://nodejs.org/</span></span></a><span class="koboSpan" id="kobo.17.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.18.1">We are going to use </span><strong class="keyWord"><span class="koboSpan" id="kobo.19.1">Visual Studio Code</span></strong><span class="koboSpan" id="kobo.20.1"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.21.1">VS Code</span></strong><span class="koboSpan" id="kobo.22.1">) for the guides in this book, but everything should work similarly in any other editor. </span><span class="koboSpan" id="kobo.22.2">For more information on how to install VS Code, please refer to their official website: </span><a href="https://code.visualstudio.com"><span class="url"><span class="koboSpan" id="kobo.23.1">https://code.visualstudio.com</span></span></a><span class="koboSpan" id="kobo.24.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.25.1">In this book, we use the following versions:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.26.1">Node.js v22.14.0</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.27.1">npm v10.9.2</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.28.1">Visual Studio Code v1.97.2</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.29.1">While installing a newer version should not be an issue, please note that certain steps might work differently on a newer version. </span><span class="koboSpan" id="kobo.29.2">If you are having an issue with the code and steps provided in this book, please try using the mentioned versions.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.30.1">You can find the code for this chapter on GitHub: </span><a href="https://github.com/PacktPublishing/Learn-React-Hooks-Second-Edition/tree/main/Chapter04"><span class="url"><span class="koboSpan" id="kobo.31.1">https://github.com/PacktPublishing/Learn-React-Hooks-Second-Edition/tree/main/Chapter04</span></span></a><span class="koboSpan" id="kobo.32.1">.</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.33.1">It is highly recommended that you write the code on your own. </span><span class="koboSpan" id="kobo.33.2">Do not simply run the code examples that are provided in the book. </span><span class="koboSpan" id="kobo.33.3">It is important to write the code yourself to be able to learn and understand it properly. </span><span class="koboSpan" id="kobo.33.4">However, if you run into any issues, you can always refer to the code examples.</span></p>
</div>
<h1 class="heading-1" id="_idParaDest-102"><a id="_idTextAnchor106"/><span class="koboSpan" id="kobo.34.1">Reducer Hooks versus State Hooks</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.35.1">In the previous chapter, we learned about dealing with local and global states. </span><span class="koboSpan" id="kobo.35.2">We used State Hooks for both cases, which is fine for simple state changes. </span><span class="koboSpan" id="kobo.35.3">However, if our state logic becomes more complicated, we are going to need to ensure that we keep the state consistent. </span><span class="koboSpan" id="kobo.35.4">To do so, we should use a Reducer Hook, instead of multiple State Hooks, because it is harder to maintain synchronicity between multiple State </span><a id="_idIndexMarker176"/><span class="koboSpan" id="kobo.36.1">Hooks that depend on each other. </span><span class="koboSpan" id="kobo.36.2">As an alternative, we could </span><a id="_idIndexMarker177"/><span class="koboSpan" id="kobo.37.1">keep all states in one State Hook, but then we have to make sure that we don’t accidentally overwrite parts of our state.</span></p>
<h2 class="heading-2" id="_idParaDest-103"><a id="_idTextAnchor107"/><span class="koboSpan" id="kobo.38.1">Limitations of the State Hook</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.39.1">The State Hook already supports passing </span><a id="_idIndexMarker178"/><span class="koboSpan" id="kobo.40.1">complex objects and arrays to it, and it can handle their state changes perfectly fine. </span><span class="koboSpan" id="kobo.40.2">However, we are always going to have to change the state directly, which means that we need to use a lot of destructuring to make sure that we are not overwriting other parts of the state. </span><span class="koboSpan" id="kobo.40.3">For example, imagine that we have a State Hook like the following:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.41.1">const</span></span><span class="koboSpan" id="kobo.42.1"> [config, setConfig] = </span><span class="hljs-title"><span class="koboSpan" id="kobo.43.1">useState</span></span><span class="koboSpan" id="kobo.44.1">({
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.45.1">filter</span></span><span class="koboSpan" id="kobo.46.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.47.1">'all'</span></span><span class="koboSpan" id="kobo.48.1">,
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.49.1">expandPosts</span></span><span class="koboSpan" id="kobo.50.1">: </span><span class="hljs-literal"><span class="koboSpan" id="kobo.51.1">true</span></span><span class="koboSpan" id="kobo.52.1">,
})
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.53.1">Now, let’s say we want to change the filter, as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.54.1">setConfig</span></span><span class="koboSpan" id="kobo.55.1">({
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.56.1">filter</span></span><span class="koboSpan" id="kobo.57.1">: {
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.58.1">author</span></span><span class="koboSpan" id="kobo.59.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.60.1">'Daniel Bugl'</span></span><span class="koboSpan" id="kobo.61.1">,
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.62.1">fromDate</span></span><span class="koboSpan" id="kobo.63.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.64.1">'2024-10-02'</span></span><span class="koboSpan" id="kobo.65.1">,
  },
})
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.66.1">If we simply did this, we would be removing the </span><code class="inlineCode"><span class="koboSpan" id="kobo.67.1">expandPosts</span></code><span class="koboSpan" id="kobo.68.1"> setting from our state object! </span><span class="koboSpan" id="kobo.68.2">So, we need to use the spread operator, as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.69.1">setConfig</span></span><span class="koboSpan" id="kobo.70.1">(</span><span class="code-highlight"><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.71.1">config</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.72.1"> =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.73.1"> (</span></strong></span><span class="koboSpan" id="kobo.74.1">{
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.75.1">  ...config,</span></strong></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.76.1">filter</span></span><span class="koboSpan" id="kobo.77.1">: {
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.78.1">author</span></span><span class="koboSpan" id="kobo.79.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.80.1">'Daniel Bugl'</span></span><span class="koboSpan" id="kobo.81.1">,
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.82.1">fromDate</span></span><span class="koboSpan" id="kobo.83.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.84.1">'2024-10-02'</span></span><span class="koboSpan" id="kobo.85.1">,
  }
}</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.86.1">)</span></strong></span><span class="koboSpan" id="kobo.87.1">)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.88.1">Now, if we wanted to change the </span><code class="inlineCode"><span class="koboSpan" id="kobo.89.1">fromDate</span></code><span class="koboSpan" id="kobo.90.1"> filter to a different date, we would need to use the spread operator twice, to avoid</span><a id="_idIndexMarker179"/><span class="koboSpan" id="kobo.91.1"> accidentally removing the </span><code class="inlineCode"><span class="koboSpan" id="kobo.92.1">author</span></code><span class="koboSpan" id="kobo.93.1"> filter:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.94.1">setConfig</span></span><span class="koboSpan" id="kobo.95.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.96.1">config</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.97.1"> =&gt;</span></span><span class="koboSpan" id="kobo.98.1"> ({
  ...config,
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.99.1">filter</span></span><span class="koboSpan" id="kobo.100.1">: {
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.101.1">    ...config.</span></strong></span><span class="hljs-property"><span class="koboSpan" id="kobo.102.1">filter</span></span><span class="koboSpan" id="kobo.103.1">,
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.104.1">fromDate</span></span><span class="koboSpan" id="kobo.105.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.106.1">'2024-10-03'</span></span><span class="koboSpan" id="kobo.107.1">,
  }
}))
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.108.1">But what happens if we do this when the </span><code class="inlineCode"><span class="koboSpan" id="kobo.109.1">filter</span></code><span class="koboSpan" id="kobo.110.1"> state is still a string, as it was in the original object (</span><code class="inlineCode"><span class="koboSpan" id="kobo.111.1">filter: 'all'</span></code><span class="koboSpan" id="kobo.112.1">)? </span><span class="koboSpan" id="kobo.112.2">We are going to get the following result:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.113.1">{
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.114.1">filter</span></span><span class="koboSpan" id="kobo.115.1">: {
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.116.1">'0'</span></span><span class="koboSpan" id="kobo.117.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.118.1">'a'</span></span><span class="koboSpan" id="kobo.119.1">,
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.120.1">'1'</span></span><span class="koboSpan" id="kobo.121.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.122.1">'l'</span></span><span class="koboSpan" id="kobo.123.1">,
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.124.1">'2'</span></span><span class="koboSpan" id="kobo.125.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.126.1">'l'</span></span><span class="koboSpan" id="kobo.127.1">,
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.128.1">fromDate</span></span><span class="koboSpan" id="kobo.129.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.130.1">'2024-10-03'</span></span><span class="koboSpan" id="kobo.131.1">,
  },
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.132.1">expandPosts</span></span><span class="koboSpan" id="kobo.133.1">: </span><span class="hljs-literal"><span class="koboSpan" id="kobo.134.1">true</span></span><span class="koboSpan" id="kobo.135.1">
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.136.1">What? </span><span class="koboSpan" id="kobo.136.2">Why are there suddenly three new keys—</span><code class="inlineCode"><span class="koboSpan" id="kobo.137.1">'0'</span></code><span class="koboSpan" id="kobo.138.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.139.1">'1'</span></code><span class="koboSpan" id="kobo.140.1">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.141.1">'2'</span></code><span class="koboSpan" id="kobo.142.1">? </span><span class="koboSpan" id="kobo.142.2">The answer is, the spread operator also works on strings, which are spread in a way where each letter gets a key, based on its index in the string.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.143.1">As you can imagine, using the spread operator and changing the state object directly can become very tedious for larger state objects. </span><span class="koboSpan" id="kobo.143.2">Additionally, we always need to make sure that we don’t introduce any bugs, and we need to check for bugs in multiple places across our app.</span></p>
<h2 class="heading-2" id="_idParaDest-104"><a id="_idTextAnchor108"/><span class="koboSpan" id="kobo.144.1">Reducers</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.145.1">Instead of changing the state directly, we</span><a id="_idIndexMarker180"/><span class="koboSpan" id="kobo.146.1"> could make a function that deals with state changes. </span><span class="koboSpan" id="kobo.146.2">Such a function is called a </span><strong class="keyWord"><span class="koboSpan" id="kobo.147.1">reducer</span></strong><span class="koboSpan" id="kobo.148.1">, and works as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.149.1">const</span></span><span class="koboSpan" id="kobo.150.1"> newState = </span><span class="hljs-title"><span class="koboSpan" id="kobo.151.1">reducer</span></span><span class="koboSpan" id="kobo.152.1">(currentState, action)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.153.1">As you can see, instead of directly </span><a id="_idIndexMarker181"/><span class="koboSpan" id="kobo.154.1">changing the state object, we are calling a function that takes the current state and an action object and returns a new state object. </span><span class="koboSpan" id="kobo.154.2">Before we define the function, let’s first take a closer look at actions.</span></p>
<h2 class="heading-2" id="_idParaDest-105"><a id="_idTextAnchor109"/><span class="koboSpan" id="kobo.155.1">Actions</span></h2>
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.156.1">Actions</span></strong><span class="koboSpan" id="kobo.157.1"> are objects that</span><a id="_idIndexMarker182"/><span class="koboSpan" id="kobo.158.1"> have a </span><code class="inlineCode"><span class="koboSpan" id="kobo.159.1">type</span></code><span class="koboSpan" id="kobo.160.1"> property that contains the action name, and optionally some</span><a id="_idIndexMarker183"/><span class="koboSpan" id="kobo.161.1"> additional info about the action.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.162.1">Let’s revisit our state object from earlier:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.163.1">{
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.164.1">filter</span></span><span class="koboSpan" id="kobo.165.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.166.1">'all'</span></span><span class="koboSpan" id="kobo.167.1">,
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.168.1">expandPosts</span></span><span class="koboSpan" id="kobo.169.1">: </span><span class="hljs-literal"><span class="koboSpan" id="kobo.170.1">true</span></span><span class="koboSpan" id="kobo.171.1">,
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.172.1">If we wanted to change the </span><code class="inlineCode"><span class="koboSpan" id="kobo.173.1">expandPosts</span></code><span class="koboSpan" id="kobo.174.1"> state, we would use a </span><code class="inlineCode"><span class="koboSpan" id="kobo.175.1">TOGGLE_EXPAND</span></code><span class="koboSpan" id="kobo.176.1"> action, which does not need any additional info. </span><span class="koboSpan" id="kobo.176.2">The action would then look as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.177.1">{ </span><span class="hljs-attr"><span class="koboSpan" id="kobo.178.1">type</span></span><span class="koboSpan" id="kobo.179.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.180.1">'TOGGLE_EXPAND'</span></span><span class="koboSpan" id="kobo.181.1"> }
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.182.1">If we would like to change the filter instead, we would use a </span><code class="inlineCode"><span class="koboSpan" id="kobo.183.1">CHANGE_FILTER</span></code><span class="koboSpan" id="kobo.184.1"> action, which additionally contains information about the filter that should be changed. </span><span class="koboSpan" id="kobo.184.2">For example, we could use the following actions to change the filter in different ways:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.185.1">{ </span><span class="hljs-attr"><span class="koboSpan" id="kobo.186.1">type</span></span><span class="koboSpan" id="kobo.187.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.188.1">'CHANGE_FILTER'</span></span><span class="koboSpan" id="kobo.189.1">, </span><span class="hljs-attr"><span class="koboSpan" id="kobo.190.1">all</span></span><span class="koboSpan" id="kobo.191.1">: </span><span class="hljs-literal"><span class="koboSpan" id="kobo.192.1">true</span></span><span class="koboSpan" id="kobo.193.1"> }
{ </span><span class="hljs-attr"><span class="koboSpan" id="kobo.194.1">type</span></span><span class="koboSpan" id="kobo.195.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.196.1">'CHANGE_FILTER'</span></span><span class="koboSpan" id="kobo.197.1">, </span><span class="hljs-attr"><span class="koboSpan" id="kobo.198.1">fromDate</span></span><span class="koboSpan" id="kobo.199.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.200.1">'2024-10-02'</span></span><span class="koboSpan" id="kobo.201.1"> }
{ </span><span class="hljs-attr"><span class="koboSpan" id="kobo.202.1">type</span></span><span class="koboSpan" id="kobo.203.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.204.1">'CHANGE_FILTER'</span></span><span class="koboSpan" id="kobo.205.1">, </span><span class="hljs-attr"><span class="koboSpan" id="kobo.206.1">author</span></span><span class="koboSpan" id="kobo.207.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.208.1">'Daniel'</span></span><span class="koboSpan" id="kobo.209.1"> }
{ </span><span class="hljs-attr"><span class="koboSpan" id="kobo.210.1">type</span></span><span class="koboSpan" id="kobo.211.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.212.1">'CHANGE_FILTER'</span></span><span class="koboSpan" id="kobo.213.1">, </span><span class="hljs-attr"><span class="koboSpan" id="kobo.214.1">fromDate</span></span><span class="koboSpan" id="kobo.215.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.216.1">'2024-10-03'</span></span><span class="koboSpan" id="kobo.217.1"> }
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.218.1">The second, third, and fourth actions would change the </span><code class="inlineCode"><span class="koboSpan" id="kobo.219.1">filter</span></code><span class="koboSpan" id="kobo.220.1"> state from a string to an object and then set the respective key. </span><span class="koboSpan" id="kobo.220.2">If the object already exists, it would simply adjust the keys that were defined in the action. </span><span class="koboSpan" id="kobo.220.3">After each of these actions, the state would change as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.221.1">{ </span><span class="hljs-attr"><span class="koboSpan" id="kobo.222.1">filter</span></span><span class="koboSpan" id="kobo.223.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.224.1">'all'</span></span><span class="koboSpan" id="kobo.225.1"> }
{ </span><span class="hljs-attr"><span class="koboSpan" id="kobo.226.1">filter</span></span><span class="koboSpan" id="kobo.227.1">: { </span><span class="hljs-attr"><span class="koboSpan" id="kobo.228.1">fromDate</span></span><span class="koboSpan" id="kobo.229.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.230.1">'2024-10-02'</span></span><span class="koboSpan" id="kobo.231.1"> } }
{ </span><span class="hljs-attr"><span class="koboSpan" id="kobo.232.1">filter</span></span><span class="koboSpan" id="kobo.233.1">: { </span><span class="hljs-attr"><span class="koboSpan" id="kobo.234.1">fromDate</span></span><span class="koboSpan" id="kobo.235.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.236.1">'2024-10-02'</span></span><span class="koboSpan" id="kobo.237.1">, </span><span class="hljs-attr"><span class="koboSpan" id="kobo.238.1">author</span></span><span class="koboSpan" id="kobo.239.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.240.1">'Daniel'</span></span><span class="koboSpan" id="kobo.241.1"> } }
{ </span><span class="hljs-attr"><span class="koboSpan" id="kobo.242.1">filter</span></span><span class="koboSpan" id="kobo.243.1">: { </span><span class="hljs-attr"><span class="koboSpan" id="kobo.244.1">fromDate</span></span><span class="koboSpan" id="kobo.245.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.246.1">'2024-10-03'</span></span><span class="koboSpan" id="kobo.247.1">, </span><span class="hljs-attr"><span class="koboSpan" id="kobo.248.1">author</span></span><span class="koboSpan" id="kobo.249.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.250.1">'Daniel'</span></span><span class="koboSpan" id="kobo.251.1"> } }
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.252.1">Now let’s imagine that we applied the following action:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.253.1">{ </span><span class="hljs-attr"><span class="koboSpan" id="kobo.254.1">type</span></span><span class="koboSpan" id="kobo.255.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.256.1">'CHANGE_FILTER'</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.257.1">all</span></span><span class="koboSpan" id="kobo.258.1">: </span><span class="hljs-literal"><span class="koboSpan" id="kobo.259.1">true</span></span><span class="koboSpan" id="kobo.260.1"> }
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.261.1">After this action, the filter would go back to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.262.1">'all'</span></code><span class="koboSpan" id="kobo.263.1"> string, as it was in its initial state.</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.264.1">If you have worked with the </span><a id="_idIndexMarker184"/><span class="koboSpan" id="kobo.265.1">Redux library before, you will already be familiar with the concepts </span><a id="_idIndexMarker185"/><span class="koboSpan" id="kobo.266.1">of state, actions, and reducers.</span></p>
</div>
<h2 class="heading-2" id="_idParaDest-106"><a id="_idTextAnchor110"/><span class="koboSpan" id="kobo.267.1">Defining reducers</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.268.1">A reducer function for the actions we</span><a id="_idIndexMarker186"/><span class="koboSpan" id="kobo.269.1"> defined could look as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.270.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.271.1">reducer</span></span><span class="koboSpan" id="kobo.272.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.273.1">state, action</span></span><span class="koboSpan" id="kobo.274.1">) {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.275.1">switch</span></span><span class="koboSpan" id="kobo.276.1"> (action.</span><span class="hljs-property"><span class="koboSpan" id="kobo.277.1">type</span></span><span class="koboSpan" id="kobo.278.1">) {
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.279.1">Here, we defined the function and are deciding what to do to the state based on the </span><code class="inlineCode"><span class="koboSpan" id="kobo.280.1">action.type</span></code><span class="koboSpan" id="kobo.281.1">. </span><span class="koboSpan" id="kobo.281.2">First, we handle the </span><code class="inlineCode"><span class="koboSpan" id="kobo.282.1">TOGGLE_EXPAND</span></code><span class="koboSpan" id="kobo.283.1"> action:</span></p>
<pre class="programlisting code"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.284.1">case</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.285.1">'TOGGLE_EXPAND'</span></span><span class="koboSpan" id="kobo.286.1">:
      </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.287.1">return</span></span><span class="koboSpan" id="kobo.288.1"> { ...state, </span><span class="hljs-attr"><span class="koboSpan" id="kobo.289.1">expandPosts</span></span><span class="koboSpan" id="kobo.290.1">: !state.</span><span class="hljs-property"><span class="koboSpan" id="kobo.291.1">expandPosts</span></span><span class="koboSpan" id="kobo.292.1"> }
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.293.1">Now, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.294.1">CHANGE_FILTER</span></code><span class="koboSpan" id="kobo.295.1"> function is handled, where we reset the filter to the string </span><code class="inlineCode"><span class="koboSpan" id="kobo.296.1">'all'</span></code><span class="koboSpan" id="kobo.297.1"> if the action defined the </span><code class="inlineCode"><span class="koboSpan" id="kobo.298.1">all: true</span></code><span class="koboSpan" id="kobo.299.1"> filter:</span></p>
<pre class="programlisting code"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.300.1">if</span></span><span class="koboSpan" id="kobo.301.1"> (action.</span><span class="hljs-property"><span class="koboSpan" id="kobo.302.1">all</span></span><span class="koboSpan" id="kobo.303.1">) {
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.304.1">return</span></span><span class="koboSpan" id="kobo.305.1"> { ...state, </span><span class="hljs-attr"><span class="koboSpan" id="kobo.306.1">filter</span></span><span class="koboSpan" id="kobo.307.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.308.1">'all'</span></span><span class="koboSpan" id="kobo.309.1"> }
      }
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.310.1">If the filter is still a string, we initialize an empty object; otherwise, we reuse the existing object:</span></p>
<pre class="programlisting code"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.311.1">let</span></span><span class="koboSpan" id="kobo.312.1"> filter = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.313.1">typeof</span></span><span class="koboSpan" id="kobo.314.1"> state.</span><span class="hljs-property"><span class="koboSpan" id="kobo.315.1">filter</span></span><span class="koboSpan" id="kobo.316.1"> === </span><span class="hljs-string"><span class="koboSpan" id="kobo.317.1">'string'</span></span><span class="koboSpan" id="kobo.318.1"> ? </span><span class="koboSpan" id="kobo.318.2">{} : state.</span><span class="hljs-property"><span class="koboSpan" id="kobo.319.1">filter</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.320.1">Now we can set the </span><code class="inlineCode"><span class="koboSpan" id="kobo.321.1">fromDate</span></code><span class="koboSpan" id="kobo.322.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.323.1">author</span></code><span class="koboSpan" id="kobo.324.1"> filters, depending on which ones were defined in the action:</span></p>
<pre class="programlisting code"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.325.1">if</span></span><span class="koboSpan" id="kobo.326.1"> (action.</span><span class="hljs-property"><span class="koboSpan" id="kobo.327.1">fromDate</span></span><span class="koboSpan" id="kobo.328.1">) {
        filter.</span><span class="hljs-property"><span class="koboSpan" id="kobo.329.1">fromDate</span></span><span class="koboSpan" id="kobo.330.1"> = action.</span><span class="hljs-property"><span class="koboSpan" id="kobo.331.1">fromDate</span></span><span class="koboSpan" id="kobo.332.1">
      }
      </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.333.1">if</span></span><span class="koboSpan" id="kobo.334.1"> (action.</span><span class="hljs-property"><span class="koboSpan" id="kobo.335.1">author</span></span><span class="koboSpan" id="kobo.336.1">) {
        filter.</span><span class="hljs-property"><span class="koboSpan" id="kobo.337.1">author</span></span><span class="koboSpan" id="kobo.338.1"> = action.</span><span class="hljs-property"><span class="koboSpan" id="kobo.339.1">author</span></span><span class="koboSpan" id="kobo.340.1">
      }
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.341.1">Finally, the state is returned with the new filter:</span></p>
<pre class="programlisting code"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.342.1">return</span></span><span class="koboSpan" id="kobo.343.1"> { ...state, filter }
    }
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.344.1">In the case where an action type is unknown, we throw an error:</span></p>
<pre class="programlisting code"><code class="hljs-code"> <span class="hljs-attr"><span class="koboSpan" id="kobo.345.1">default</span></span><span class="koboSpan" id="kobo.346.1">:
      </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.347.1">throw</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.348.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.349.1">Error</span></span><span class="koboSpan" id="kobo.350.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.351.1">'unknown action'</span></span><span class="koboSpan" id="kobo.352.1">)
  }
}
</span></code></pre>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.353.1">Throwing an error in the default case is different from what we would do with Redux reducers, where we would simply return the current state in the default case. </span><span class="koboSpan" id="kobo.353.2">React Reducer Hooks do not store all states in one global object and we </span><a id="_idIndexMarker187"/><span class="koboSpan" id="kobo.354.1">are only going to handle certain actions for certain state objects, so we can throw an error for unknown action types.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.355.1">While we are still using some spread operators in the reducer function, it is not as deeply nested. </span><span class="koboSpan" id="kobo.355.2">Additionally, all the state handling is in one place and we are only changing one part of the state at a time through actions, making the code much easier to maintain and less error-prone.</span></p>
<h2 class="heading-2" id="_idParaDest-107"><a id="_idTextAnchor111"/><span class="koboSpan" id="kobo.356.1">The Reducer Hook</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.357.1">Now that we have a reducer function, we just</span><a id="_idIndexMarker188"/><span class="koboSpan" id="kobo.358.1"> need to define an initial state:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.359.1">const</span></span><span class="koboSpan" id="kobo.360.1"> initialState = { </span><span class="hljs-attr"><span class="koboSpan" id="kobo.361.1">filter</span></span><span class="koboSpan" id="kobo.362.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.363.1">'all'</span></span><span class="koboSpan" id="kobo.364.1"> }
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.365.1">With the reducer function and the initial state, we can create a Reducer Hook:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.366.1">const</span></span><span class="koboSpan" id="kobo.367.1"> [state, dispatch] = </span><span class="hljs-title"><span class="koboSpan" id="kobo.368.1">useReducer</span></span><span class="koboSpan" id="kobo.369.1">(reducer, initialState)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.370.1">The current state can now be accessed via the </span><code class="inlineCode"><span class="koboSpan" id="kobo.371.1">state</span></code><span class="koboSpan" id="kobo.372.1"> object returned from the Hook. </span><span class="koboSpan" id="kobo.372.2">Using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.373.1">dispatch</span></code><span class="koboSpan" id="kobo.374.1"> function allows us to invoke the reducer function that we passed to the Reducer Hook. </span><span class="koboSpan" id="kobo.374.2">Actions can be </span><strong class="keyWord"><span class="koboSpan" id="kobo.375.1">dispatched</span></strong><span class="koboSpan" id="kobo.376.1"> via the </span><code class="inlineCode"><span class="koboSpan" id="kobo.377.1">dispatch</span></code><span class="koboSpan" id="kobo.378.1"> function. </span><span class="koboSpan" id="kobo.378.2">For example:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.379.1">dispatch</span></span><span class="koboSpan" id="kobo.380.1">({ </span><span class="hljs-attr"><span class="koboSpan" id="kobo.381.1">type</span></span><span class="koboSpan" id="kobo.382.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.383.1">'TOGGLE_EXPAND'</span></span><span class="koboSpan" id="kobo.384.1"> })
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.385.1">Dispatching an action will call the reducer function with the current state and the dispatched action, and set the returned state as the new state of the Reducer Hook.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.386.1">If we want to add additional info to the action, we can simply add it to the object:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.387.1">dispatch</span></span><span class="koboSpan" id="kobo.388.1">({ </span><span class="hljs-attr"><span class="koboSpan" id="kobo.389.1">type</span></span><span class="koboSpan" id="kobo.390.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.391.1">'CHANGE_FILTER'</span></span><span class="koboSpan" id="kobo.392.1">, </span><span class="hljs-attr"><span class="koboSpan" id="kobo.393.1">fromDate</span></span><span class="koboSpan" id="kobo.394.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.395.1">'2024-10-03'</span></span><span class="koboSpan" id="kobo.396.1"> })
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.397.1">As we can see, dealing with state changes using actions and reducers is much easier to read and maintain than having to adjust the state object directly.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.398.1">Now that we have learned about Reducer Hooks and when to use them instead of State Hooks, let’s get started with </span><a id="_idIndexMarker189"/><span class="koboSpan" id="kobo.399.1">using them.</span></p>
<h1 class="heading-1" id="_idParaDest-108"><a id="_idTextAnchor112"/><span class="koboSpan" id="kobo.400.1">Using Reducer Hooks</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.401.1">After learning about actions, reducers, and the Reducer Hook, we are going to use it in our blog app. </span><span class="koboSpan" id="kobo.401.2">Any existing State Hook can be turned into</span><a id="_idIndexMarker190"/><span class="koboSpan" id="kobo.402.1"> a Reducer Hook when the state or state changes become too complex.</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.403.1">If there are multiple </span><code class="inlineCode"><span class="koboSpan" id="kobo.404.1">setState</span></code><span class="koboSpan" id="kobo.405.1"> functions that are always called at the same time, it is a good hint that they should be grouped together in a single Reducer Hook.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.406.1">Global state is usually a good candidate for using a Reducer Hook, rather than a State Hook, because changes to it can happen anywhere in the app. </span><span class="koboSpan" id="kobo.406.2">It is much easier to deal with state changes when they only get processed in one function and the components dispatch actions instead of directly modifying the state. </span><span class="koboSpan" id="kobo.406.3">Having all the state-changing logic in one place makes it easier to maintain and fix bugs, without introducing new ones by forgetting to update the logic everywhere.</span></p>
<h2 class="heading-2" id="_idParaDest-109"><a id="_idTextAnchor113"/><span class="koboSpan" id="kobo.407.1">Turning a State Hook into a Reducer Hook</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.408.1">In our blog app, we have two global State Hooks:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.409.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.410.1">username</span></code><span class="koboSpan" id="kobo.411.1"> state – containing the username of the currently logged-in user</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.412.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.413.1">posts</span></code><span class="koboSpan" id="kobo.414.1"> state – containing all the posts in our feed</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.415.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.416.1">username</span></code><span class="koboSpan" id="kobo.417.1"> state is quite simple, it</span><a id="_idIndexMarker191"/><span class="koboSpan" id="kobo.418.1"> only contains a string of the </span><a id="_idIndexMarker192"/><span class="koboSpan" id="kobo.419.1">username. </span><span class="koboSpan" id="kobo.419.2">So, at the moment, it does not make sense to turn this into a Reducer Hook, as the state changes are straightforward:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.420.1">On login/register: Set the username</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.421.1">On logout: Clear the username</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.422.1">For the </span><code class="inlineCode"><span class="koboSpan" id="kobo.423.1">posts</span></code><span class="koboSpan" id="kobo.424.1"> state, however, we already needed to use the spread operator to avoid accidentally removing posts from the feed when creating a new post. </span><span class="koboSpan" id="kobo.424.2">So, it seems like a good candidate for a Reducer Hook, especially considering that it might be extended in the future (fetching new posts, updating posts, deleting posts, etc.).</span></p>
<p class="normal"><span class="koboSpan" id="kobo.425.1">Now, let’s get started with replacing the </span><code class="inlineCode"><span class="koboSpan" id="kobo.426.1">posts</span></code><span class="koboSpan" id="kobo.427.1"> State Hook with a Reducer Hook.</span></p>
<h3 class="heading-3" id="_idParaDest-110"><a id="_idTextAnchor114"/><span class="koboSpan" id="kobo.428.1">Defining actions</span></h3>
<p class="normal"><span class="koboSpan" id="kobo.429.1">We start by defining actions for our </span><a id="_idIndexMarker193"/><span class="koboSpan" id="kobo.430.1">Reducer Hook. </span><span class="koboSpan" id="kobo.430.2">For now, we are only going to consider a </span><code class="inlineCode"><span class="koboSpan" id="kobo.431.1">CREATE_POST</span></code><span class="koboSpan" id="kobo.432.1"> action:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.433.1">{
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.434.1">type</span></span><span class="koboSpan" id="kobo.435.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.436.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.437.1">CREATE_POST'</span></span><span class="koboSpan" id="kobo.438.1">,
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.439.1">post</span></span><span class="koboSpan" id="kobo.440.1">: {
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.441.1">title</span></span><span class="koboSpan" id="kobo.442.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.443.1">'React Hooks'</span></span><span class="koboSpan" id="kobo.444.1">,
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.445.1">content</span></span><span class="koboSpan" id="kobo.446.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.447.1">'The greatest thing since sliced bread!'</span></span><span class="koboSpan" id="kobo.448.1">,
</span><span class="hljs-attr"><span class="koboSpan" id="kobo.449.1">    author</span></span><span class="koboSpan" id="kobo.450.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.451.1">'Daniel Bugl'</span></span><span class="koboSpan" id="kobo.452.1">,
  },
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.453.1">Next, we are going to</span><a id="_idIndexMarker194"/><span class="koboSpan" id="kobo.454.1"> implement the reducer function.</span></p>
<h3 class="heading-3" id="_idParaDest-111"><a id="_idTextAnchor115"/><span class="koboSpan" id="kobo.455.1">Implementing the reducer</span></h3>
<p class="normal"><span class="koboSpan" id="kobo.456.1">For now, we are going to place our reducer in a </span><code class="inlineCode"><span class="koboSpan" id="kobo.457.1">src/reducers.js</span></code><span class="koboSpan" id="kobo.458.1"> file. </span><span class="koboSpan" id="kobo.458.2">Later, if we have many reducers, it might make</span><a id="_idIndexMarker195"/><span class="koboSpan" id="kobo.459.1"> sense to create a separate </span><code class="inlineCode"><span class="koboSpan" id="kobo.460.1">src/reducers/</span></code><span class="koboSpan" id="kobo.461.1"> folder, with separate files for each reducer function.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.462.1">Let’s get started with implementing the reducer function:</span></p>
<ol>
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.463.1">Copy the </span><code class="inlineCode"><span class="koboSpan" id="kobo.464.1">Chapter03_2</span></code><span class="koboSpan" id="kobo.465.1"> folder to a new </span><code class="inlineCode"><span class="koboSpan" id="kobo.466.1">Chapter04_1</span></code><span class="koboSpan" id="kobo.467.1"> folder by executing the following command:
        </span><pre class="programlisting con-one"><code class="hljs-con"><span class="koboSpan" id="kobo.468.1">$ cp -R Chapter03_2 Chapter04_1
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.469.1">Open the new </span><code class="inlineCode"><span class="koboSpan" id="kobo.470.1">Chapter04_1</span></code><span class="koboSpan" id="kobo.471.1"> folder in VS Code.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.472.1">Create a new </span><code class="inlineCode"><span class="koboSpan" id="kobo.473.1">src/reducers.js</span></code><span class="koboSpan" id="kobo.474.1"> file, in which we define and export the </span><code class="inlineCode"><span class="koboSpan" id="kobo.475.1">postsReducer</span></code><span class="koboSpan" id="kobo.476.1"> function:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.477.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.478.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.479.1">postsReducer</span></span><span class="koboSpan" id="kobo.480.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.481.1">state, action</span></span><span class="koboSpan" id="kobo.482.1">) {
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.483.1">We use a </span><code class="inlineCode"><span class="koboSpan" id="kobo.484.1">switch</span></code><span class="koboSpan" id="kobo.485.1"> statement to handle the different action types:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.486.1">switch</span></span><span class="koboSpan" id="kobo.487.1"> (action.</span><span class="hljs-property"><span class="koboSpan" id="kobo.488.1">type</span></span><span class="koboSpan" id="kobo.489.1">) {
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.490.1">Next, handle the </span><code class="inlineCode"><span class="koboSpan" id="kobo.491.1">CREATE_POST</span></code><span class="koboSpan" id="kobo.492.1"> action, inserting the new post (from </span><code class="inlineCode"><span class="koboSpan" id="kobo.493.1">action.post</span></code><span class="koboSpan" id="kobo.494.1">) into the beginning of the array, as follows:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.495.1">case</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.496.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.497.1">CREATE_POST'</span></span><span class="koboSpan" id="kobo.498.1">:
      </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.499.1">return</span></span><span class="koboSpan" id="kobo.500.1"> [action.</span><span class="hljs-property"><span class="koboSpan" id="kobo.501.1">post</span></span><span class="koboSpan" id="kobo.502.1">, ...state]
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.503.1">For now, this will be the only action type that we handle, so we can define the </span><code class="inlineCode"><span class="koboSpan" id="kobo.504.1">default</span></code><span class="koboSpan" id="kobo.505.1"> statement now, throwing an error when we encounter an unknown action type:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-attr"><span class="koboSpan" id="kobo.506.1">default</span></span><span class="koboSpan" id="kobo.507.1">:
      </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.508.1">throw</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.509.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.510.1">Error</span></span><span class="koboSpan" id="kobo.511.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.512.1">'Unknown action type'</span></span><span class="koboSpan" id="kobo.513.1">)
  }
}
</span></code></pre>
</li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.514.1">After defining the reducer function, we can now use it to define a Reducer Hook.</span></p>
<h3 class="heading-3" id="_idParaDest-112"><a id="_idTextAnchor116"/><span class="koboSpan" id="kobo.515.1">Defining the Reducer Hook</span></h3>
<p class="normal"><span class="koboSpan" id="kobo.516.1">To define a Reducer Hook, follow</span><a id="_idIndexMarker196"/><span class="koboSpan" id="kobo.517.1"> these steps:</span></p>
<ol>
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.518.1">Edit </span><code class="inlineCode"><span class="koboSpan" id="kobo.519.1">src/App.jsx</span></code><span class="koboSpan" id="kobo.520.1"> and import the </span><code class="inlineCode"><span class="koboSpan" id="kobo.521.1">useReducer</span></code><span class="koboSpan" id="kobo.522.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.523.1">postsReducer</span></code><span class="koboSpan" id="kobo.524.1"> functions:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.525.1">import</span></span><span class="koboSpan" id="kobo.526.1"> { useState</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.527.1">, useReducer</span></strong></span><span class="koboSpan" id="kobo.528.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.529.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.530.1">'react'</span></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.531.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.532.1"> { postsReducer } </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.533.1">from</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.534.1">'./reducers.js'</span></strong></span>
</code></pre>
</li>
<li class="numberedList"><em class="italic"><span class="koboSpan" id="kobo.535.1">Remove</span></em><span class="koboSpan" id="kobo.536.1"> the following State Hook:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.537.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.538.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.539.1">App</span></span><span class="koboSpan" id="kobo.540.1">() {
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.541.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.542.1"> [posts, setPosts] = </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.543.1">useState</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.544.1">(defaultPosts)</span></strong></span>
</code></pre>
</li>
</ol>
<p class="normal-one"><em class="italic"><span class="koboSpan" id="kobo.545.1">Replace</span></em><span class="koboSpan" id="kobo.546.1"> it with a Reducer Hook:</span></p>
<pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.547.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.548.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.549.1">App</span></span><span class="koboSpan" id="kobo.550.1">() {
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.551.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.552.1"> [posts, dispatch] = </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.553.1">useReducer</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.554.1">(postsReducer, defaultPosts)</span></strong></span>
</code></pre>
<ol>
<li class="numberedList" value="3"><span class="koboSpan" id="kobo.555.1">Then, instead of </span><code class="inlineCode"><span class="koboSpan" id="kobo.556.1">setPosts</span></code><span class="koboSpan" id="kobo.557.1">, pass the </span><code class="inlineCode"><span class="koboSpan" id="kobo.558.1">dispatch</span></code><span class="koboSpan" id="kobo.559.1"> function to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.560.1">CreatePost</span></code><span class="koboSpan" id="kobo.561.1"> component, and </span><em class="italic"><span class="koboSpan" id="kobo.562.1">remove</span></em><span class="koboSpan" id="kobo.563.1"> the </span><code class="inlineCode"><span class="koboSpan" id="kobo.564.1">setPosts</span></code><span class="koboSpan" id="kobo.565.1"> prop:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="koboSpan" id="kobo.566.1">      {username &amp;&amp; </span><span class="hljs-tag"><span class="koboSpan" id="kobo.567.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.568.1">CreatePost</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.569.1">username</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.570.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.571.1">{username}</span></span><span class="hljs-tag"> </span><span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.572.1">dispatch</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.573.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.574.1">{dispatch}</span></strong></span><span class="hljs-tag"><span class="koboSpan" id="kobo.575.1"> /&gt;</span></span><span class="koboSpan" id="kobo.576.1">}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.577.1">Next, edit </span><code class="inlineCode"><span class="koboSpan" id="kobo.578.1">src/post/CreatePost.jsx</span></code><span class="koboSpan" id="kobo.579.1"> and </span><em class="italic"><span class="koboSpan" id="kobo.580.1">replace</span></em><span class="koboSpan" id="kobo.581.1"> the </span><code class="inlineCode"><span class="koboSpan" id="kobo.582.1">setPosts</span></code><span class="koboSpan" id="kobo.583.1"> prop with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.584.1">dispatch</span></code><span class="koboSpan" id="kobo.585.1"> prop:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.586.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.587.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.588.1">CreatePost</span></span><span class="koboSpan" id="kobo.589.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.590.1">{ username, </span></span><span class="code-highlight"><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.591.1">dispatch</span></strong></span><span class="hljs-params"><span class="koboSpan" id="kobo.592.1"> }</span></span><span class="koboSpan" id="kobo.593.1">) {
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.594.1">Instead of imperatively adding the new post, we dispatch an action inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.595.1">handleSubmit</span></code><span class="koboSpan" id="kobo.596.1"> function now:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.597.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.598.1">handleSubmit</span></span><span class="koboSpan" id="kobo.599.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.600.1">e</span></span><span class="koboSpan" id="kobo.601.1">) {
    e.</span><span class="hljs-title"><span class="koboSpan" id="kobo.602.1">preventDefault</span></span><span class="koboSpan" id="kobo.603.1">()
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.604.1">const</span></span><span class="koboSpan" id="kobo.605.1"> form = e.</span><span class="hljs-property"><span class="koboSpan" id="kobo.606.1">target</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.607.1">const</span></span><span class="koboSpan" id="kobo.608.1"> title = form.</span><span class="hljs-property"><span class="koboSpan" id="kobo.609.1">elements</span></span><span class="koboSpan" id="kobo.610.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.611.1">title</span></span><span class="koboSpan" id="kobo.612.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.613.1">value</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.614.1">const</span></span><span class="koboSpan" id="kobo.615.1"> content = form.</span><span class="hljs-property"><span class="koboSpan" id="kobo.616.1">elements</span></span><span class="koboSpan" id="kobo.617.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.618.1">content</span></span><span class="koboSpan" id="kobo.619.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.620.1">value</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.621.1">const</span></span><span class="koboSpan" id="kobo.622.1"> newPost = { title, content, </span><span class="hljs-attr"><span class="koboSpan" id="kobo.623.1">author</span></span><span class="koboSpan" id="kobo.624.1">: username }
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.625.1">dispatch</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.626.1">({ </span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.627.1">type</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.628.1">: </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.629.1">'CREATE_POST'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.630.1">, </span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.631.1">post</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.632.1">: newPost })</span></strong></span><span class="koboSpan" id="kobo.633.1">
    form.</span><span class="hljs-title"><span class="koboSpan" id="kobo.634.1">reset</span></span><span class="koboSpan" id="kobo.635.1">()
  }
</span></code></pre>
</li>
</ol>
<div class="packt_tip">
<p class="normal"><span class="koboSpan" id="kobo.636.1">For more complex actions, it might make sense to define functions that will create the action object, so-called </span><strong class="keyWord"><span class="koboSpan" id="kobo.637.1">action creators</span></strong><span class="koboSpan" id="kobo.638.1">. </span><span class="koboSpan" id="kobo.638.2">For example, a </span><code class="inlineCode"><span class="koboSpan" id="kobo.639.1">createPostAction(post)</span></code><span class="koboSpan" id="kobo.640.1"> function could create and return the </span><code class="inlineCode"><span class="koboSpan" id="kobo.641.1">CREATE_POST</span></code><span class="koboSpan" id="kobo.642.1"> action object. </span><span class="koboSpan" id="kobo.642.2">Action creators can help ensure a consistent structure of action objects, make it easier for us to create them, and allow for this structure to be adjusted easily in the future.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.643.1">Now the </span><code class="inlineCode"><span class="koboSpan" id="kobo.644.1">posts</span></code><span class="koboSpan" id="kobo.645.1"> state uses a Reducer Hook instead of a State Hook, but it works the same way as before! </span><span class="koboSpan" id="kobo.645.2">If we want to add more</span><a id="_idIndexMarker197"/><span class="koboSpan" id="kobo.646.1"> logic for managing posts later, such as deleting and editing posts, it will be much easier to do so now.</span></p>
<div class="note">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.647.1">Example code</span></strong></p>
<p class="normal"><span class="koboSpan" id="kobo.648.1">The example code for this section can be found in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.649.1">Chapter04/Chapter04_1</span></code><span class="koboSpan" id="kobo.650.1"> folder. </span><span class="koboSpan" id="kobo.650.2">Check the </span><code class="inlineCode"><span class="koboSpan" id="kobo.651.1">README.md</span></code><span class="koboSpan" id="kobo.652.1"> file inside the folder for instructions on how to set up and run the example.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.653.1">After learning about the Reducer Hook, let’s continue learning about the Effect Hook.</span></p>
<h1 class="heading-1" id="_idParaDest-113"><a id="_idTextAnchor117"/><span class="koboSpan" id="kobo.654.1">Using Effect Hooks</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.655.1">The Effect Hook is an important Hook to synchronize your components with external systems, such as external APIs or the browser APIs. </span><span class="koboSpan" id="kobo.655.2">However, it is often overused in React code. </span><span class="koboSpan" id="kobo.655.3">If there is no external system involved, you should not use an Effect Hook.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.656.1">In the case of our blog, we are going</span><a id="_idIndexMarker198"/><span class="koboSpan" id="kobo.657.1"> to implement a way to check whether the user has an admin role in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.658.1">Logout</span></code><span class="koboSpan" id="kobo.659.1"> component. </span><span class="koboSpan" id="kobo.659.2">For simplicity, and to focus on the Effect Hook itself, we are simply going to mock this check, but imagine that this is being done by an external API.</span></p>
<h2 class="heading-2" id="_idParaDest-114"><a id="_idTextAnchor118"/><span class="koboSpan" id="kobo.660.1">Remember componentDidMount and componentDidUpdate?</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.661.1">If you have worked with older React versions before, you have probably used the </span><code class="inlineCode"><span class="koboSpan" id="kobo.662.1">componentDidMount</span></code><span class="koboSpan" id="kobo.663.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.664.1">componentDidUpdate</span></code><span class="koboSpan" id="kobo.665.1"> life cycle methods. </span><span class="koboSpan" id="kobo.665.2">For example, if we wanted to set the title of a web page</span><a id="_idIndexMarker199"/><span class="koboSpan" id="kobo.666.1"> to a given prop using React class components, we</span><a id="_idIndexMarker200"/><span class="koboSpan" id="kobo.667.1"> would need to add the following life cycle method:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.668.1">import</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.669.1">React</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.670.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.671.1">'react'</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.672.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.673.1">App</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.674.1">extends</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.675.1">React.Component</span></span><span class="koboSpan" id="kobo.676.1"> {
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.677.1">componentDidMount</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.678.1">() {</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.679.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.680.1"> { title } = </span></strong><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.681.1">this</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.682.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.683.1">props</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.684.1">document</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.685.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.686.1">title</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.687.1"> = title</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.688.1">  }</span></strong></span>
<span class="hljs-title"><span class="koboSpan" id="kobo.689.1">render</span></span><span class="koboSpan" id="kobo.690.1">() {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.691.1">return</span></span> <span class="hljs-tag"><span class="koboSpan" id="kobo.692.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.693.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.694.1">&gt;</span></span><span class="koboSpan" id="kobo.695.1">Example App</span><span class="hljs-tag"><span class="koboSpan" id="kobo.696.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.697.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.698.1">&gt;</span></span><span class="koboSpan" id="kobo.699.1">
  }
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.700.1">This works fine. </span><span class="koboSpan" id="kobo.700.2">However, when the </span><code class="inlineCode"><span class="koboSpan" id="kobo.701.1">title</span></code><span class="koboSpan" id="kobo.702.1"> prop updates, the change does not get reflected in the title of our web page. </span><span class="koboSpan" id="kobo.702.2">To solve this problem, we need to define the </span><code class="inlineCode"><span class="koboSpan" id="kobo.703.1">componentDidUpdate</span></code><span class="koboSpan" id="kobo.704.1"> life cycle method, as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.705.1">import</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.706.1">React</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.707.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.708.1">'react'</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.709.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.710.1">App</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.711.1">extends</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.712.1">React.Component</span></span><span class="koboSpan" id="kobo.713.1"> {
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.714.1">componentDidMount</span></span><span class="koboSpan" id="kobo.715.1">() {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.716.1">const</span></span><span class="koboSpan" id="kobo.717.1"> { title } = </span><span class="hljs-variable"><span class="koboSpan" id="kobo.718.1">this</span></span><span class="koboSpan" id="kobo.719.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.720.1">props</span></span>
<span class="hljs-variable"><span class="koboSpan" id="kobo.721.1">document</span></span><span class="koboSpan" id="kobo.722.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.723.1">title</span></span><span class="koboSpan" id="kobo.724.1"> = title
  }
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.725.1">componentDidUpdate</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.726.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.727.1">prevProps</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.728.1">) {</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.729.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.730.1"> { title } = </span></strong><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.731.1">this</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.732.1">.</span></strong></span><span class="hljs-property"><span class="koboSpan" id="kobo.733.1">props</span></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.734.1">if</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.735.1"> (title !== prevProps.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.736.1">title</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.737.1">) {</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.738.1">document</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.739.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.740.1">title</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.741.1"> = title</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.742.1">    }</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.743.1">  }</span></strong></span>
<span class="hljs-title"><span class="koboSpan" id="kobo.744.1">render</span></span><span class="koboSpan" id="kobo.745.1">() {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.746.1">return</span></span> <span class="hljs-tag"><span class="koboSpan" id="kobo.747.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.748.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.749.1">&gt;</span></span><span class="koboSpan" id="kobo.750.1">Example App</span><span class="hljs-tag"><span class="koboSpan" id="kobo.751.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.752.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.753.1">&gt;</span></span><span class="koboSpan" id="kobo.754.1">
  }
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.755.1">You might have noticed that we are doing the exact same thing twice; therefore, we could create a new method to deal with </span><a id="_idIndexMarker201"/><span class="koboSpan" id="kobo.756.1">updates to the title, and then call it from both life cycle </span><a id="_idIndexMarker202"/><span class="koboSpan" id="kobo.757.1">methods. </span><span class="koboSpan" id="kobo.757.2">In the following code block, the updated code is highlighted in bold:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.758.1">import</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.759.1">React</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.760.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.761.1">'react'</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.762.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.763.1">App</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.764.1">extends</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.765.1">React.Component</span></span><span class="koboSpan" id="kobo.766.1"> {
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.767.1">updateTitle</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.768.1">() {</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.769.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.770.1"> { title } = </span></strong><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.771.1">this</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.772.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.773.1">props</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.774.1">document</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.775.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.776.1">title</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.777.1"> = title</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.778.1">  }</span></strong></span>
<span class="hljs-title"><span class="koboSpan" id="kobo.779.1">componentDidMount</span></span><span class="koboSpan" id="kobo.780.1">() {
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.781.1">this</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.782.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.783.1">updateTitle</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.784.1">()</span></strong></span><span class="koboSpan" id="kobo.785.1">
  }
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.786.1">componentDidUpdate</span></span><span class="koboSpan" id="kobo.787.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.788.1">prevProps</span></span><span class="koboSpan" id="kobo.789.1">) {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.790.1">if</span></span><span class="koboSpan" id="kobo.791.1"> (</span><span class="hljs-variable"><span class="koboSpan" id="kobo.792.1">this</span></span><span class="koboSpan" id="kobo.793.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.794.1">props</span></span><span class="koboSpan" id="kobo.795.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.796.1">title</span></span><span class="koboSpan" id="kobo.797.1"> !== prevProps.</span><span class="hljs-property"><span class="koboSpan" id="kobo.798.1">title</span></span><span class="koboSpan" id="kobo.799.1">) {
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.800.1">this</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.801.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.802.1">updateTitle</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.803.1">()</span></strong></span><span class="koboSpan" id="kobo.804.1">
    }
  }
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.805.1">render</span></span><span class="koboSpan" id="kobo.806.1">() {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.807.1">return</span></span> <span class="hljs-tag"><span class="koboSpan" id="kobo.808.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.809.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.810.1">&gt;</span></span><span class="koboSpan" id="kobo.811.1">Example App</span><span class="hljs-tag"><span class="koboSpan" id="kobo.812.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.813.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.814.1">&gt;</span></span><span class="koboSpan" id="kobo.815.1">
  }
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.816.1">However, we still need to call </span><code class="inlineCode"><span class="koboSpan" id="kobo.817.1">this.updateTitle()</span></code><span class="koboSpan" id="kobo.818.1"> twice. </span><span class="koboSpan" id="kobo.818.2">When we update the code later on, and, for example, pass an argument to </span><code class="inlineCode"><span class="koboSpan" id="kobo.819.1">this.updateTitle()</span></code><span class="koboSpan" id="kobo.820.1">, we always need to remember to pass it to both calls to the</span><a id="_idIndexMarker203"/><span class="koboSpan" id="kobo.821.1"> function. </span><span class="koboSpan" id="kobo.821.2">If we forget to update one of the life cycle methods, we </span><a id="_idIndexMarker204"/><span class="koboSpan" id="kobo.822.1">might introduce bugs. </span><span class="koboSpan" id="kobo.822.2">Additionally, we need to add an </span><code class="inlineCode"><span class="koboSpan" id="kobo.823.1">if</span></code><span class="koboSpan" id="kobo.824.1"> condition to </span><code class="inlineCode"><span class="koboSpan" id="kobo.825.1">componentDidUpdate</span></code><span class="koboSpan" id="kobo.826.1">, in order to avoid calling </span><code class="inlineCode"><span class="koboSpan" id="kobo.827.1">this.updateTitle()</span></code><span class="koboSpan" id="kobo.828.1"> when the </span><code class="inlineCode"><span class="koboSpan" id="kobo.829.1">title</span></code><span class="koboSpan" id="kobo.830.1"> prop did not change.</span></p>
<h2 class="heading-2" id="_idParaDest-115"><a id="_idTextAnchor119"/><span class="koboSpan" id="kobo.831.1">From life cycle methods to Effect Hooks</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.832.1">In the world of Hooks, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.833.1">componentDidMount</span></code><span class="koboSpan" id="kobo.834.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.835.1">componentDidUpdate</span></code><span class="koboSpan" id="kobo.836.1"> life cycle methods are combined in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.837.1">useEffect</span></code><span class="koboSpan" id="kobo.838.1"> Hook, which—when not specifying a </span><strong class="keyWord"><span class="koboSpan" id="kobo.839.1">dependency array</span></strong><span class="koboSpan" id="kobo.840.1">—triggers on every</span><a id="_idIndexMarker205"/><span class="koboSpan" id="kobo.841.1"> re-render. </span><span class="koboSpan" id="kobo.841.2">We </span><a id="_idIndexMarker206"/><span class="koboSpan" id="kobo.842.1">will learn more about the dependency array in the next sub-section.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.843.1">So, instead of using a class component, we can now define a function component with an Effect Hook, which would do the same thing as before:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.844.1">import</span></span><span class="koboSpan" id="kobo.845.1"> { useEffect } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.846.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.847.1">'react'</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.848.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.849.1">App</span></span><span class="koboSpan" id="kobo.850.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.851.1">{ title }</span></span><span class="koboSpan" id="kobo.852.1">) {
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.853.1">useEffect</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.854.1">(</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.855.1">() =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.856.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.857.1">document</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.858.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.859.1">title</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.860.1"> = title</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.861.1">  })</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.862.1">return</span></span> <span class="hljs-tag"><span class="koboSpan" id="kobo.863.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.864.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.865.1">&gt;</span></span><span class="koboSpan" id="kobo.866.1">Example App</span><span class="hljs-tag"><span class="koboSpan" id="kobo.867.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.868.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.869.1">&gt;</span></span><span class="koboSpan" id="kobo.870.1">
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.871.1">And that’s all we need to do! </span><span class="koboSpan" id="kobo.871.2">The Effect Hook will call the provided function every time when the component re-renders.</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.872.1">Since React 19, it is possible to change the title (or any metadata tags) of a web page by defining a </span><code class="inlineCode"><span class="koboSpan" id="kobo.873.1">&lt;title&gt;</span></code><span class="koboSpan" id="kobo.874.1"> (or </span><code class="inlineCode"><span class="koboSpan" id="kobo.875.1">&lt;link&gt;</span></code><span class="koboSpan" id="kobo.876.1"> or </span><code class="inlineCode"><span class="koboSpan" id="kobo.877.1">&lt;meta&gt;</span></code><span class="koboSpan" id="kobo.878.1">) element in any component. </span><span class="koboSpan" id="kobo.878.2">These elements will then automatically be hoisted up into the </span><code class="inlineCode"><span class="koboSpan" id="kobo.879.1">&lt;head&gt;</span></code><span class="koboSpan" id="kobo.880.1"> section.</span></p>
</div>
<h2 class="heading-2" id="_idParaDest-116"><a id="_idTextAnchor120"/><span class="koboSpan" id="kobo.881.1">Triggering an effect only when certain props change</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.882.1">If we want to make sure that our effect function only gets called when the </span><code class="inlineCode"><span class="koboSpan" id="kobo.883.1">title</span></code><span class="koboSpan" id="kobo.884.1"> prop changes, we can specify which values</span><a id="_idIndexMarker207"/><span class="koboSpan" id="kobo.885.1"> should trigger the changes, as a second argument to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.886.1">useEffect</span></code><span class="koboSpan" id="kobo.887.1"> Hook—the dependency array:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.888.1">useEffect</span></span><span class="koboSpan" id="kobo.889.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.890.1">() =&gt;</span></span><span class="koboSpan" id="kobo.891.1"> {
  </span><span class="hljs-variable"><span class="koboSpan" id="kobo.892.1">document</span></span><span class="koboSpan" id="kobo.893.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.894.1">title</span></span><span class="koboSpan" id="kobo.895.1"> = title
}</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.896.1">, [title]</span></strong></span><span class="koboSpan" id="kobo.897.1">)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.898.1">The dependency array is not just restricted to props; we can use any value that is available from inside the component body here, even variables defined inside the component and values from other Hooks, such as a State Hook or a Reducer Hook:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.899.1">const</span></span><span class="koboSpan" id="kobo.900.1"> [title, setTitle] = </span><span class="hljs-title"><span class="koboSpan" id="kobo.901.1">useState</span></span><span class="koboSpan" id="kobo.902.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.903.1">''</span></span><span class="koboSpan" id="kobo.904.1">)
</span><span class="hljs-title"><span class="koboSpan" id="kobo.905.1">useEffect</span></span><span class="koboSpan" id="kobo.906.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.907.1">() =&gt;</span></span><span class="koboSpan" id="kobo.908.1"> {
  </span><span class="hljs-variable"><span class="koboSpan" id="kobo.909.1">document</span></span><span class="koboSpan" id="kobo.910.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.911.1">title</span></span><span class="koboSpan" id="kobo.912.1"> = title
}, [title])
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.913.1">As we can see, using an Effect Hook is much more straightforward than dealing with life cycle methods. </span><span class="koboSpan" id="kobo.913.2">All we need to specify is which values the Effect Hook should depend on. </span><span class="koboSpan" id="kobo.913.3">Whenever any of these values change, the effect function automatically gets called again.</span></p>
<h2 class="heading-2" id="_idParaDest-117"><a id="_idTextAnchor121"/><span class="koboSpan" id="kobo.914.1">Triggering an effect only on mount</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.915.1">If we want to replicate the behavior of only adding a </span><code class="inlineCode"><span class="koboSpan" id="kobo.916.1">componentDidMount</span></code><span class="koboSpan" id="kobo.917.1"> life cycle Hook, without triggering when</span><a id="_idIndexMarker208"/><span class="koboSpan" id="kobo.918.1"> the props change, we can do this by passing an empty array as the second argument to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.919.1">useEffect</span></code><span class="koboSpan" id="kobo.920.1"> Hook:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.921.1">useEffect</span></span><span class="koboSpan" id="kobo.922.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.923.1">() =&gt;</span></span><span class="koboSpan" id="kobo.924.1"> {
  </span><span class="hljs-variable"><span class="koboSpan" id="kobo.925.1">document</span></span><span class="koboSpan" id="kobo.926.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.927.1">title</span></span><span class="koboSpan" id="kobo.928.1"> = title
}, </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.929.1">[]</span></strong></span><span class="koboSpan" id="kobo.930.1">)
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.931.1">Passing an empty array means that our effect function will only trigger once when the component mounts, and it will not trigger when props change. </span><span class="koboSpan" id="kobo.931.2">However, instead of thinking about the mounting of components, with Hooks, we should think about the dependencies of the effects. </span><span class="koboSpan" id="kobo.931.3">In this case, the effect does not have any dependencies, which means it will only trigger once. </span><span class="koboSpan" id="kobo.931.4">If an effect has dependencies specified, it will trigger again when any of the dependencies change.</span></p>
<h2 class="heading-2" id="_idParaDest-118"><a id="_idTextAnchor122"/><span class="koboSpan" id="kobo.932.1">Cleaning up effects</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.933.1">Sometimes effects need to be </span><a id="_idIndexMarker209"/><span class="koboSpan" id="kobo.934.1">cleaned up when the component unmounts. </span><span class="koboSpan" id="kobo.934.2">To do so, we can return a function from the Effect Hook. </span><span class="koboSpan" id="kobo.934.3">This returned function works similarly to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.935.1">componentWillUnmount</span></code><span class="koboSpan" id="kobo.936.1"> life cycle method:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.937.1">useEffect</span></span><span class="koboSpan" id="kobo.938.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.939.1">() =&gt;</span></span><span class="koboSpan" id="kobo.940.1"> {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.941.1">const</span></span><span class="koboSpan" id="kobo.942.1"> updateInterval = </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.943.1">setInterval</span></span><span class="koboSpan" id="kobo.944.1">(
    </span><span class="hljs-function"><span class="koboSpan" id="kobo.945.1">() =&gt;</span></span> <span class="hljs-variable"><span class="koboSpan" id="kobo.946.1">console</span></span><span class="koboSpan" id="kobo.947.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.948.1">log</span></span><span class="koboSpan" id="kobo.949.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.950.1">'fetching update'</span></span><span class="koboSpan" id="kobo.951.1">),
    updateTime,
  )
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.952.1">return</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.953.1">() =&gt;</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.954.1">clearInterval</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.955.1">(updateInterval)</span></strong></span><span class="koboSpan" id="kobo.956.1">
}, [updateTime])
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.957.1">The highlighted code is called the </span><strong class="keyWord"><span class="koboSpan" id="kobo.958.1">cleanup function</span></strong><span class="koboSpan" id="kobo.959.1">. </span><span class="koboSpan" id="kobo.959.2">The cleanup function will be called when the component unmounts and before running the effect again. </span><span class="koboSpan" id="kobo.959.3">This avoids bugs when, for example, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.960.1">updateTime</span></code><span class="koboSpan" id="kobo.961.1"> prop</span><a id="_idIndexMarker210"/><span class="koboSpan" id="kobo.962.1"> changes. </span><span class="koboSpan" id="kobo.962.2">In that case, the previous effect will be cleaned up and an interval with the new </span><code class="inlineCode"><span class="koboSpan" id="kobo.963.1">updateTime</span></code><span class="koboSpan" id="kobo.964.1"> will be defined.</span></p>
<h2 class="heading-2" id="_idParaDest-119"><a id="_idTextAnchor123"/><span class="koboSpan" id="kobo.965.1">Implementing an Effect Hook in our blog app</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.966.1">Now that we have learned how the Effect Hook works, we are going to use it in our blog app, to implement a way to check the</span><a id="_idIndexMarker211"/><span class="koboSpan" id="kobo.967.1"> user role when the user is already logged in.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.968.1">Let’s implement an Effect Hook by following these steps:</span></p>
<ol>
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.969.1">Copy the </span><code class="inlineCode"><span class="koboSpan" id="kobo.970.1">Chapter04_1</span></code><span class="koboSpan" id="kobo.971.1"> folder to a new </span><code class="inlineCode"><span class="koboSpan" id="kobo.972.1">Chapter04_2</span></code><span class="koboSpan" id="kobo.973.1"> folder by executing the following command:
        </span><pre class="programlisting con-one"><code class="hljs-con"><span class="koboSpan" id="kobo.974.1">$ cp -R Chapter04_1 Chapter04_2
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.975.1">Open the new </span><code class="inlineCode"><span class="koboSpan" id="kobo.976.1">Chapter04_2</span></code><span class="koboSpan" id="kobo.977.1"> folder in VS Code.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.978.1">Edit </span><code class="inlineCode"><span class="koboSpan" id="kobo.979.1">src/user/Logout.jsx</span></code><span class="koboSpan" id="kobo.980.1"> and import the </span><code class="inlineCode"><span class="koboSpan" id="kobo.981.1">useState</span></code><span class="koboSpan" id="kobo.982.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.983.1">useEffect</span></code><span class="koboSpan" id="kobo.984.1"> functions:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.985.1">import</span></span><span class="koboSpan" id="kobo.986.1"> { useState, useEffect } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.987.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.988.1">'react'</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.989.1">Then, define a function that simulates an external API that checks the role of a user:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.990.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.991.1">getRole</span></span><span class="koboSpan" id="kobo.992.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.993.1">username</span></span><span class="koboSpan" id="kobo.994.1">) {
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.995.1">For the sake of simplicity, we say that any user called </span><code class="inlineCode"><span class="koboSpan" id="kobo.996.1">admin</span></code><span class="koboSpan" id="kobo.997.1"> has the </span><code class="inlineCode"><span class="koboSpan" id="kobo.998.1">admin</span></code><span class="koboSpan" id="kobo.999.1"> role. </span><span class="koboSpan" id="kobo.999.2">All others have the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1000.1">user</span></code><span class="koboSpan" id="kobo.1001.1"> role:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1002.1">if</span></span><span class="koboSpan" id="kobo.1003.1"> (username === </span><span class="hljs-string"><span class="koboSpan" id="kobo.1004.1">'admin'</span></span><span class="koboSpan" id="kobo.1005.1">) </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1006.1">return</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1007.1">'admin'</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1008.1">return</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1009.1">'user'</span></span><span class="koboSpan" id="kobo.1010.1">
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1011.1">Now, we need to define a State Hook for the role:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1012.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1013.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1014.1">Logout</span></span><span class="koboSpan" id="kobo.1015.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.1016.1">{ username, setUsername }</span></span><span class="koboSpan" id="kobo.1017.1">) {
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1018.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1019.1"> [role, setRole] = </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1020.1">useState</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1021.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1022.1">'user'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1023.1">)</span></strong></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1024.1">Next, define an Effect Hook that sets the role by calling the “external API” and using its response:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-title"><span class="koboSpan" id="kobo.1025.1">useEffect</span></span><span class="koboSpan" id="kobo.1026.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.1027.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1028.1"> {
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1029.1">setRole</span></span><span class="koboSpan" id="kobo.1030.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.1031.1">getRole</span></span><span class="koboSpan" id="kobo.1032.1">(username))
  }, [username])
</span></code></pre>
</li>
</ol>
<div class="packt_tip-one">
<p class="normal"><span class="koboSpan" id="kobo.1033.1">It is best practice to list all values (and functions) that are used within an Effect Hook in the dependency array. </span><span class="koboSpan" id="kobo.1033.2">This ensures</span><a id="_idIndexMarker212"/><span class="koboSpan" id="kobo.1034.1"> that there are no accidental bugs when values that seem static at the moment become dynamic later on. </span><span class="koboSpan" id="kobo.1034.2">Thankfully, the React Hooks ESLint plugin (which is already set up in our project) will warn us if we forget to add a dependency.</span></p>
</div>
<ol>
<li class="numberedList" value="8"><span class="koboSpan" id="kobo.1035.1">Finally, we display the role if a user has a special role:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1036.1">return</span></span><span class="koboSpan" id="kobo.1037.1"> (
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1038.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1039.1">form</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1040.1">onSubmit</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1041.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1042.1">{handleSubmit}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1043.1">&gt;</span></span><span class="koboSpan" id="kobo.1044.1">
      Logged in as: </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1045.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1046.1">b</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1047.1">&gt;</span></span><span class="koboSpan" id="kobo.1048.1">{username}</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1049.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1050.1">b</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1051.1">&gt;</span></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1052.1">{role !== </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1053.1">'user'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1054.1"> ? </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1055.1">` (role:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-subst-slc"><span class="koboSpan" id="kobo.1056.1">${role}</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1057.1">)`</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1058.1"> : </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1059.1">''</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1060.1">}</span></strong></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1061.1">Start the blog app by executing the following command:
        </span><pre class="programlisting con-one"><code class="hljs-con"><span class="koboSpan" id="kobo.1062.1">$ npm run dev
</span></code></pre>
</li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.1063.1">Try logging in with the username </span><code class="inlineCode"><span class="koboSpan" id="kobo.1064.1">admin</span></code><span class="koboSpan" id="kobo.1065.1">. </span><span class="koboSpan" id="kobo.1065.2">You will see that the role is now being displayed next to the username!</span></p>
<div class="note">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.1066.1">Example code</span></strong></p>
<p class="normal"><span class="koboSpan" id="kobo.1067.1">The example code for this section can be found in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1068.1">Chapter04/Chapter04_2</span></code><span class="koboSpan" id="kobo.1069.1"> folder. </span><span class="koboSpan" id="kobo.1069.2">Check the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1070.1">README.md</span></code><span class="koboSpan" id="kobo.1071.1"> file inside the folder for instructions on how to set up and run the example.</span></p>
</div>
<h1 class="heading-1" id="_idParaDest-120"><a id="_idTextAnchor124"/><span class="koboSpan" id="kobo.1072.1">Summary</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1073.1">In this chapter, we first learned about actions, reducers, and Reducer Hooks. </span><span class="koboSpan" id="kobo.1073.2">We also learned when we should use Reducer Hooks instead of State Hooks. </span><span class="koboSpan" id="kobo.1073.3">Then, we replaced our existing global State Hook for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1074.1">posts</span></code><span class="koboSpan" id="kobo.1075.1"> state with a Reducer Hook. </span><span class="koboSpan" id="kobo.1075.2">Next, we learned about Effect Hooks, and how they can be used instead of </span><code class="inlineCode"><span class="koboSpan" id="kobo.1076.1">componentDidMount</span></code><span class="koboSpan" id="kobo.1077.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1078.1">componentDidUpdate</span></code><span class="koboSpan" id="kobo.1079.1"> life cycle methods. </span><span class="koboSpan" id="kobo.1079.2">Finally, we implemented role verification in our blog app by using an Effect Hook.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1080.1">In the next chapter, we are going to learn about React Context, and how to use it with Hooks. </span><span class="koboSpan" id="kobo.1080.2">Then, we are going to add Context Hooks to our app, to avoid having to pass down props over multiple layers of components.</span></p>
<h1 class="heading-1" id="_idParaDest-121"><a id="_idTextAnchor125"/><span class="koboSpan" id="kobo.1081.1">Questions</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1082.1">To recap what we have learned in this chapter, try to answer the following questions:</span></p>
<ol>
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1083.1">What are the common problems with State Hooks?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1084.1">What are actions?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1085.1">What are reducers?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1086.1">When should we use a Reducer Hook instead of a State Hook?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1087.1">Which steps are needed to turn a State Hook into a Reducer Hook?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1088.1">How could we create actions more easily?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1089.1">What is the equivalent of Effect Hooks in class components?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1090.1">What are the advantages of using an Effect Hook, versus class components?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1091.1">What is the dependency array and how does it work?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1092.1">How can cleanup functions be used with Effect Hooks?</span></li>
</ol>
<h1 class="heading-1" id="_idParaDest-122"><a id="_idTextAnchor126"/><span class="koboSpan" id="kobo.1093.1">Further reading</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1094.1">If you are interested in learning more about the concepts that we have learned in this chapter, take a look at the following links:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.1095.1">Official docs regarding the Reducer Hook: </span><a href="https://react.dev/reference/react/useReducer"><span class="url"><span class="koboSpan" id="kobo.1096.1">https://react.dev/reference/react/useReducer</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1097.1">Official docs and tips for using Effect Hooks: </span><a href="https://react.dev/reference/react/hooks#effect-hooks"><span class="url"><span class="koboSpan" id="kobo.1098.1">https://react.dev/reference/react/hooks#effect-hooks</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1099.1">More information on when an Effect Hook should not be used: </span><a href="https://react.dev/learn/you-might-not-need-an-effect"><span class="url"><span class="koboSpan" id="kobo.1100.1">https://react.dev/learn/you-might-not-need-an-effect</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1101.1">More information about Redux, a library that offers a more extensive version of actions and reducers: </span><a href="https://redux.js.org"><span class="url"><span class="koboSpan" id="kobo.1102.1">https://redux.js.org</span></span></a></li>
</ul>
<h1 class="heading-1"><span class="koboSpan" id="kobo.1103.1">Learn more on Discord</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1104.1">To join the Discord community for this book – where you can share feedback, ask questions to the author, and learn about new releases – follow the QR code below:</span></p>
<p class="normal"><a href="Chapter_04.xhtml"><span class="url"><span class="koboSpan" id="kobo.1105.1">https://packt.link/wnXT0</span></span></a></p>
<p class="normal"><span class="koboSpan" id="kobo.1106.1"><img alt="" src="../Images/image_%283%29.png"/></span></p>
</div>
</body></html>