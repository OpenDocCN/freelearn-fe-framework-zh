- en: '11'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Handling Application Errors
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Application errors are an integral part of the lifetime of a web application.
    They can occur either during runtime or while developing the application. Possible
    causes of a runtime error are an HTTP request that failed or an incomplete HTML
    form. A web application must handle runtime errors and mitigate unwanted effects
    to ensure a smooth user experience.
  prefs: []
  type: TYPE_NORMAL
- en: Development errors usually happen when we do not properly use a programming
    language or framework according to its semantics. In this case, errors may override
    the compiler and surface in the application while running. Development errors
    can be mitigated by following best practices and recommended coding techniques.
  prefs: []
  type: TYPE_NORMAL
- en: 'In this chapter, we will learn how to handle different types of errors in an
    Angular application and understand errors from the framework itself. We will explore
    the following concepts in more detail:'
  prefs: []
  type: TYPE_NORMAL
- en: Handling runtime errors
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Demystifying framework errors
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Technical requirements
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The code samples described in this chapter can be found in the `ch11` folder
    of the following GitHub repository:'
  prefs: []
  type: TYPE_NORMAL
- en: '[https://www.github.com/PacktPublishing/Learning-Angular-Fifth-Edition](https://www.github.com/PacktPublishing/Learning-Angular-Fifth-Edition
    )'
  prefs: []
  type: TYPE_NORMAL
- en: Handling runtime errors
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'The most common runtime errors in an Angular application come from the interaction
    with an HTTP API. Entering the wrong login credentials or sending data in the
    wrong format can result in an HTTP error. An Angular application can handle HTTP
    errors in the following ways:'
  prefs: []
  type: TYPE_NORMAL
- en: Explicitly during the execution of a particular HTTP request
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Globally in the global error handler of the application
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Centrally using an HTTP interceptor
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: In the following section, we will explore how to handle an HTTP error in a specific
    HTTP request.
  prefs: []
  type: TYPE_NORMAL
- en: Catching HTTP request errors
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Handling errors in HTTP requests typically requires manually inspecting the
    information returned in the error response object. RxJS provides the `catchError`
    operator to simplify that. It can catch potential errors when initiating an HTTP
    request with the `pipe` operator.
  prefs: []
  type: TYPE_NORMAL
- en: You will need the source code of the Angular application we created in *Chapter
    10* , *Collecting User Data with Forms* , to follow along with the rest of the
    chapter.
  prefs: []
  type: TYPE_NORMAL
- en: 'Let’s see how we could use the `catchError` operator to catch HTTP errors while
    fetching the product list in our application:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Open the `products.service.ts` file and import the `catchError` and `throwError`
    operators from the `rxjs` npm package:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Import the `HttpErrorResponse` interface from the `@angular/common/http` namespace:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Modify the `getProducts` method accordingly:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: The signature of the `catchError` operator contains the actual `HttpErrorResponse`
    object that is returned from the server. After catching the error, we use the
    `throwError` operator, which re-throws the error as an observable.
  prefs: []
  type: TYPE_NORMAL
- en: Alternatively, we could have used the `throw` keyword from the standard web
    API methods to throw the error. However the `throwError` method is, most of the
    time, overkill. Please use it accordingly.
  prefs: []
  type: TYPE_NORMAL
- en: This way, we ensure that the application execution will continue and complete
    without causing a potential memory leak.
  prefs: []
  type: TYPE_NORMAL
- en: 'In a real-world scenario, we would probably create a helper method to log the
    error in a more solid tracking system and return something meaningful according
    to the cause of the error:'
  prefs: []
  type: TYPE_NORMAL
- en: 'In the same file, `products.service.ts` , import the `HttpStatusCode` enumeration
    from the `@angular/common/http` namespace:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: '`HttpStatusCode` is an enumeration that contains a list of all HTTP response
    status codes.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Create the following method in the `ProductsService` class:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: The preceding method logs a different message in the browser console according
    to the error status. It uses a `switch` statement to differentiate between internal
    server errors and bad requests. For any other errors, it falls back to the `default`
    statement, which logs a generic message in the console.
  prefs: []
  type: TYPE_NORMAL
- en: 'Refactor the `getProducts` method to use the `handleError` method to catch
    errors:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'The `handleError` method currently manages HTTP errors originating only from
    the HTTP response. However, other errors can occur in an Angular application from
    the client side, such as a request that did not reach the server due to a network
    error or an exception thrown in an RxJS operator. To handle any of the previous
    errors, we should add a new `case` statement in the `handleError` method:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: In the preceding snippet, an error with a status of `0` indicates that it is
    an error that occurred on the client side of the application.
  prefs: []
  type: TYPE_NORMAL
- en: 'Error handling in HTTP requests could be combined with a mechanism that retries
    a given HTTP call a specific amount of times before handling the error. There
    is an RxJS operator for nearly everything, even one for retrying HTTP requests.
    It accepts the number of retries where the particular request has to be executed
    until it completes successfully:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: We learned that we use the `catchError` RxJS operator to capture errors. The
    way we handle it depends on the scenario. In our case, we created a `handleError`
    method for all HTTP calls in a service. In a real-world scenario, we would follow
    the same approach of error handling in other Angular services of an application.
    Creating one method for each service would not be convenient and does not scale
    well.
  prefs: []
  type: TYPE_NORMAL
- en: Alternatively, we could utilize the global error handler that Angular provides
    to handle errors in a central place. We will learn how to create a global error
    handler in the next section.
  prefs: []
  type: TYPE_NORMAL
- en: Creating a global error handler
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The Angular framework provides the `ErrorHandler` class for handling errors
    globally in an Angular application. The default implementation of the `ErrorHandler`
    class prints error messages in the browser console window.
  prefs: []
  type: TYPE_NORMAL
- en: 'To create a custom error handler for our application, we need to sub-class
    the `ErrorHandler` class and provide our tailored implementation for error logging:'
  prefs: []
  type: TYPE_NORMAL
- en: Create a file named `app-error-handler.ts` in the `src\app` folder of the Angular
    CLI workspace.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Open the file and add the following `import` statements:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Create a TypeScript class that implements the `ErrorHandler` interface:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: The `AppErrorHandler` class must be decorated with the `@Injectable()` decorator
    because we will provide it later in the application configuration file.
  prefs: []
  type: TYPE_NORMAL
- en: 'Implement the `handleError` method from the `ErrorHandler` interface as follows:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: In the preceding method, we check if the `error` object contains a `rejection`
    property. Errors originating from the **Zone.js** library, which is responsible
    for the change detection in Angular, encapsulate the actual error inside that
    property.
  prefs: []
  type: TYPE_NORMAL
- en: After extracting the error in the `err` variable, we check to see if it is an
    HTTP error using the `HttpErrorResponse` type. This check will eventually catch
    any errors from HTTP calls using the `throwError` RxJS operator. All other errors
    are treated as application errors that occur on the client side.
  prefs: []
  type: TYPE_NORMAL
- en: 'Open the `app.config.ts` file and import the `ErrorHandler` class from the
    `@angular/core` npm package:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Import the custom error handler we created in the `app-error-handler.ts` file:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE12]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Register the `AppErrorHandler` class as the global error handler of the application
    by adding it to the `providers` array of the `appConfig` variable:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE13]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'To investigate the behavior of the global application error handler, execute
    the following steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Run the `ng serve` command to start the application.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Disconnect your computer from the internet.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Navigate to `http://localhost:4200` .
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Open the browser developer tools and inspect the output of the console window:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![img](img/B21418_11_01.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 11.1: Application error'
  prefs: []
  type: TYPE_NORMAL
- en: One of the most common HTTP errors in a web enterprise application is the **401
    Unauthorized** response error. We will learn how to handle this specific error
    in the following section.
  prefs: []
  type: TYPE_NORMAL
- en: Responding to the 401 Unauthorized error
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'The 401 Unauthorized error in an Angular application can occur in the following
    cases:'
  prefs: []
  type: TYPE_NORMAL
- en: The user does not provide the correct credentials while logging in to the application
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The authentication token provided when the user logged in to the application
    has expired
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'A good place to handle the 401 Unauthorized error is inside an HTTP interceptor
    responsible for authentication. In *Chapter 8* , *Communicating with Data Services
    over HTTP* , we learned how to create an authentication interceptor for passing
    the authorization token to every HTTP request. To handle the 401 Unauthorized
    error, the `auth.interceptor.ts` file could be modified as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE14]'
  prefs: []
  type: TYPE_PRE
- en: The interceptor will call the `logout` method of the `AuthService` class when
    a 401 Unauthorized error occurs and return an `EMPTY` observable to stop emitting
    data. It will use the `throwError` operator to bubble the error to the global
    error handler in all other errors. As we have already seen, the global error handler
    will examine the returned error and take action according to the status code.
  prefs: []
  type: TYPE_NORMAL
- en: As we saw in the global error handler we created in the previous section, some
    errors are unrelated to the interaction with the HTTP client. There are application
    errors that occur on the client side, and we will learn how to understand them
    in the following section.
  prefs: []
  type: TYPE_NORMAL
- en: Demystifying framework errors
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Application errors that originate on the client side in an Angular application
    can have many causes. One of them is the interaction of our source code with the
    Angular framework. Developers like to try new things and approaches while building
    applications. Sometimes, things will go well but, other times, they may cause
    errors in an application.
  prefs: []
  type: TYPE_NORMAL
- en: 'The Angular framework provides a mechanism for reporting some of these common
    errors with the following format:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE15]'
  prefs: []
  type: TYPE_PRE
- en: 'Let’s analyze the preceding error format:'
  prefs: []
  type: TYPE_NORMAL
- en: '`NG` : Indicates that it is an Angular error to differentiate between other
    errors originating from TypeScript and the browser'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`W` : A single-digit number that indicates the type of the error. 0 represents
    a runtime error, and all other numbers from 1 to 9 represent a compiler error'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`X` : A single-digit number that indicates the category of the framework runtime
    area, such as change detection, dependency injection, and template'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`YZ` : A two-digit code used to index the specific error'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`{Error message}` : The actual error message'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`<Link>` : A link to the Angular documentation that provides more information
    about the specified error'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Error messages that conform to the preceding format are displayed in the browser
    console as they happen. Let’s see an error example using the `ExpressionChangedAfterChecked`
    error, the most famous error in Angular applications:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Open the `app.component.ts` file and import the `AfterViewInit` artifact from
    the `@angular/core` npm package:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE16]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Add the `AfterViewInit` in the list of implemented interfaces:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE17]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Create the following `title` property in the `AppComponent` class:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE18]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Implement the `ngAfterViewInit` method and change the `title` property inside
    the method body:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE19]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: 'Open the `app.component.html` file and bind the `title` property to the `<h2>`
    HTML element:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE20]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: Run the `ng serve` command and navigate to `http://localhost:4200` .
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Initially, everything looks to work correctly. The value of the `title` property
    is displayed on the page correctly.
  prefs: []
  type: TYPE_NORMAL
- en: 'Open the browser developer tools and inspect the console window:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE21]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: The preceding message indicates that changing the value of the `title` property
    caused the error.
  prefs: []
  type: TYPE_NORMAL
- en: Clicking on the [https://angular.dev/errors/NG0100](https://angular.dev/errors/NG0100)
    link will redirect us to the appropriate error guide in the Angular documentation
    for more information. The error guide explains the specific error and describes
    how to fix the problem in our application code.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: When we understand the error messages that originate from the Angular framework,
    we can fix them easily.
  prefs: []
  type: TYPE_NORMAL
- en: Summary
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Handling errors during runtime or development is crucial for every Angular application.
    In this chapter, we learned how to handle errors that occur during the runtime
    of an Angular application, such as HTTP or client-side errors. We also learned
    how to understand and fix application errors thrown by the Angular framework.
  prefs: []
  type: TYPE_NORMAL
- en: In the next chapter, we will learn how to skin our application to look more
    beautiful with the help of Angular Material. Angular Material has many components
    and styles that are ready for you to use in your projects. So, let’s give your
    Angular project the love it deserves.
  prefs: []
  type: TYPE_NORMAL
