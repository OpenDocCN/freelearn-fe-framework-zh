<html><head></head><body>
<div id="_idContainer048">
<h1 class="chapter-number" id="_idParaDest-104"><a id="_idTextAnchor207"/><a id="_idTextAnchor208"/><span class="koboSpan" id="kobo.1.1">7</span></h1>
<h1 id="_idParaDest-105"><a id="_idTextAnchor209"/><span class="koboSpan" id="kobo.2.1">Routes and Routers</span></h1>
<p><span class="koboSpan" id="kobo.3.1">A </span><strong class="bold"><span class="koboSpan" id="kobo.4.1">single-page application</span></strong><span class="koboSpan" id="kobo.5.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.6.1">SPA</span></strong><span class="koboSpan" id="kobo.7.1">) is </span><a id="_idIndexMarker288"/><span class="koboSpan" id="kobo.8.1">one in which the user originally receives only one </span><strong class="source-inline"><span class="koboSpan" id="kobo.9.1">index.html</span></strong><span class="koboSpan" id="kobo.10.1"> page and, from there, all the content of the web application is rendered </span><span class="No-Break"><span class="koboSpan" id="kobo.11.1">using JavaScript.</span></span></p>
<p><span class="koboSpan" id="kobo.12.1">From the user’s perspective, however, they are interacting with the application on different interfaces (or pages) such as the login screen, the home page, and the purchase form. </span><span class="koboSpan" id="kobo.12.2">Technically, they are all rendered on the </span><strong class="source-inline"><span class="koboSpan" id="kobo.13.1">index.html</span></strong><span class="koboSpan" id="kobo.14.1"> page but, for the user, they are </span><span class="No-Break"><span class="koboSpan" id="kobo.15.1">different experiences.</span></span></p>
<p><span class="koboSpan" id="kobo.16.1">The mechanism responsible for this flow of interfaces that the client interacts with in a SPA is the routing engine. </span><span class="koboSpan" id="kobo.16.2">The Angular framework has this feature out of the box and, in this chapter, we will explore it </span><span class="No-Break"><span class="koboSpan" id="kobo.17.1">in detail.</span></span></p>
<p><span class="koboSpan" id="kobo.18.1">We will cover the following topics in </span><span class="No-Break"><span class="koboSpan" id="kobo.19.1">this chapter:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.20.1">Routes </span><span class="No-Break"><span class="koboSpan" id="kobo.21.1">and navigation</span></span></li>
<li><span class="koboSpan" id="kobo.22.1">Defining an error page </span><span class="No-Break"><span class="koboSpan" id="kobo.23.1">and title</span></span></li>
<li><span class="koboSpan" id="kobo.24.1">Dynamic routes – wildcards </span><span class="No-Break"><span class="koboSpan" id="kobo.25.1">and parameters</span></span></li>
<li><span class="koboSpan" id="kobo.26.1">Securing routes – </span><span class="No-Break"><span class="koboSpan" id="kobo.27.1">guards</span></span></li>
<li><span class="koboSpan" id="kobo.28.1">Optimizing the experience – </span><span class="No-Break"><span class="koboSpan" id="kobo.29.1">Resolve</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.30.1">By the end of the chapter, you will be able to use Angular’s routing mechanisms to create navigation flows that will improve your </span><span class="No-Break"><span class="koboSpan" id="kobo.31.1">users’ experience.</span></span><a id="_idTextAnchor210"/></p>
<h1 id="_idParaDest-106"><a id="_idTextAnchor211"/><span class="koboSpan" id="kobo.32.1">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.33.1">To follow the instructions in this chapter, you’ll need </span><span class="No-Break"><span class="koboSpan" id="kobo.34.1">the following:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.35.1">Visual Studio </span><span class="No-Break"><span class="koboSpan" id="kobo.36.1">Code (</span></span><a href="https://code.visualstudio.com/Download"><span class="No-Break"><span class="koboSpan" id="kobo.37.1">https://code.visualstudio.com/Download</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.38.1">)</span></span></li>
<li><span class="koboSpan" id="kobo.39.1">Node.js 18 or </span><span class="No-Break"><span class="koboSpan" id="kobo.40.1">higher (</span></span><a href="https://nodejs.org/en/download/"><span class="No-Break"><span class="koboSpan" id="kobo.41.1">https://nodejs.org/en/download/</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.42.1">)</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.43.1">The code files for this chapter are available </span><span class="No-Break"><span class="koboSpan" id="kobo.44.1">at </span></span><a href="https://github.com/PacktPublishing/Angular-Design-Patterns-and-Best-Practices/tree/main/ch7"><span class="No-Break"><span class="koboSpan" id="kobo.45.1">https://github.com/PacktPublishing/Angular-Design-Patterns-and-Best-Practices/tree/main/ch7</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.46.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.47.1">While following this chapter, remember to run the backend of the application found in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.48.1">gym-diary-backend</span></strong><span class="koboSpan" id="kobo.49.1"> folder with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.50.1">npm </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.51.1">start</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.52.1"> command.</span></span><a id="_idTextAnchor212"/></p>
<h1 id="_idParaDest-107"><a id="_idTextAnchor213"/><span class="koboSpan" id="kobo.53.1">Routes and navigation</span></h1>
<p><span class="koboSpan" id="kobo.54.1">Let’s improve our project by creating a home page with a simplified menu for our interface, thereby exploring the possibilities we can have with Angular</span><a id="_idIndexMarker289"/><span class="koboSpan" id="kobo.55.1"> routes. </span><span class="koboSpan" id="kobo.55.2">In the command line, we’ll use the Angular CLI</span><a id="_idIndexMarker290"/><span class="koboSpan" id="kobo.56.1"> to create a new module</span><a id="_idIndexMarker291"/><span class="koboSpan" id="kobo.57.1"> and the </span><span class="No-Break"><span class="koboSpan" id="kobo.58.1">component page:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.59.1">
ng g m home --routing</span></pre> <p><span class="koboSpan" id="kobo.60.1">In the preceding snippet, we first create a new module, and by using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.61.1">--routing</span></strong><span class="koboSpan" id="kobo.62.1"> parameter, we instruct the Angular CLI to create the module along with the routing file. </span><span class="koboSpan" id="kobo.62.2">The following command creates the component we are </span><span class="No-Break"><span class="koboSpan" id="kobo.63.1">working on:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.64.1">
ng g c home</span></pre> <p><span class="koboSpan" id="kobo.65.1">For more details about the Angular CLI and modules, you can refer to </span><a href="B19562_02.xhtml#_idTextAnchor081"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.66.1">Chapter 2</span></em></span></a><span class="koboSpan" id="kobo.67.1">, </span><em class="italic"><span class="koboSpan" id="kobo.68.1">Organizing </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.69.1">Your Application</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.70.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.71.1">First, let’s create the template in the HTML file of the component we </span><span class="No-Break"><span class="koboSpan" id="kobo.72.1">just created:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.73.1">
&lt;div class="flex h-screen"&gt;
  &lt;aside class="w-1/6 bg-blue-500 text-white"&gt;
    &lt;nav class="mt-8"&gt;
      &lt;ul class="flex flex-col items-center space-y-4"&gt;
        &lt;li&gt;
          &lt;a class="flex items-center space-x-2 text-white"&gt;
            &lt;span&gt;Diary&lt;/span&gt;
          &lt;/a&gt;
        &lt;/li&gt;
        &lt;li&gt;
          &lt;a class="flex items-center space-x-2 text-white"&gt;
            &lt;span&gt;New Entry&lt;/span&gt;
          &lt;/a&gt;
        &lt;/li&gt;
      &lt;/ul&gt;
    &lt;/nav&gt;
  &lt;/aside&gt;
  &lt;main class="flex-1 bg-gray-200 p-4"&gt;
    &lt;router-outlet&gt;&lt;/router-outlet&gt;
  &lt;/main&gt;
&lt;/div&gt;</span></pre> <p><span class="koboSpan" id="kobo.74.1">In this template example, we are using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.75.1">&lt;aside&gt;</span></strong><span class="koboSpan" id="kobo.76.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.77.1">&lt;main&gt;</span></strong><span class="koboSpan" id="kobo.78.1"> HTML elements to create the menu and the area where the selected pages will be projected. </span><span class="koboSpan" id="kobo.78.2">For this purpose, we are using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.79.1">&lt;router-outlet&gt;</span></strong><span class="koboSpan" id="kobo.80.1"> directive to</span><a id="_idIndexMarker292"/><span class="koboSpan" id="kobo.81.1"> indicate the correct area </span><span class="No-Break"><span class="koboSpan" id="kobo.82.1">to Angular.</span></span></p>
<p><span class="koboSpan" id="kobo.83.1">To make the home page the main page, we need to modify the main routing module of our application in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.84.1">app-routing.module.ts</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.85.1"> file:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.86.1">
. </span><span class="koboSpan" id="kobo.86.2">. </span><span class="koboSpan" id="kobo.86.3">.
</span><span class="koboSpan" id="kobo.86.4">const routes: Routes = [
  { path: '', pathMatch: 'full', redirectTo: 'home' },
  {
    path: 'home',
    loadChildren: () =&gt;
      import('./home/home.module').then((file) =&gt; file.HomeModule),
  },
];
. </span><span class="koboSpan" id="kobo.86.5">. </span><span class="koboSpan" id="kobo.86.6">.
</span><span class="koboSpan" id="kobo.86.7">export class AppRoutingModule {}</span></pre> <p><span class="koboSpan" id="kobo.87.1">The </span><a id="_idIndexMarker293"/><strong class="source-inline"><span class="koboSpan" id="kobo.88.1">routes</span></strong><span class="koboSpan" id="kobo.89.1"> array is the main element of the Angular routing mechanism. </span><span class="koboSpan" id="kobo.89.2">We define objects in it that correspond to the routes our users will have access to. </span><span class="koboSpan" id="kobo.89.3">In this example, we defined that the root route (</span><strong class="source-inline"><span class="koboSpan" id="kobo.90.1">"/"</span></strong><span class="koboSpan" id="kobo.91.1">) of our application will redirect the user to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.92.1">home</span></strong><span class="koboSpan" id="kobo.93.1"> route using the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.94.1">redirectTo</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.95.1"> property.</span></span></p>
<p><span class="koboSpan" id="kobo.96.1">Here, we should use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.97.1">pathMatch</span></strong><span class="koboSpan" id="kobo.98.1"> property with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.99.1">"full"</span></strong><span class="koboSpan" id="kobo.100.1"> value. </span><span class="koboSpan" id="kobo.100.2">This is because it determines whether the Angular route engine will match the first route that matches the pattern (the default behavior, which is </span><strong class="source-inline"><span class="koboSpan" id="kobo.101.1">"prefix"</span></strong><span class="koboSpan" id="kobo.102.1">), or whether it will match the </span><span class="No-Break"><span class="koboSpan" id="kobo.103.1">entire route.</span></span></p>
<p><span class="koboSpan" id="kobo.104.1">In the second object, we are defining the </span><strong class="source-inline"><span class="koboSpan" id="kobo.105.1">home</span></strong><span class="koboSpan" id="kobo.106.1"> route and loading the </span><strong class="source-inline"><span class="koboSpan" id="kobo.107.1">Home</span></strong><span class="koboSpan" id="kobo.108.1"> module lazily. </span><span class="koboSpan" id="kobo.108.2">For more details about lazy loading, you can refer to </span><a href="B19562_02.xhtml#_idTextAnchor081"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.109.1">Chapter 2</span></em></span></a><span class="koboSpan" id="kobo.110.1">, </span><em class="italic"><span class="koboSpan" id="kobo.111.1">Organizing </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.112.1">Your Application</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.113.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.114.1">When running our application, we have the menu and the area where the pages of our workout diary will </span><span class="No-Break"><span class="koboSpan" id="kobo.115.1">be displayed.</span></span></p>
<p><span class="koboSpan" id="kobo.116.1">To include the workout diary on the home page, we need to modify the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.117.1">HomeRoutingModule</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.118.1"> module:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.119.1">
import { NgModule } from '@angular/core';
import { RouterModule, Routes } from '@angular/router';
import { HomeComponent } from './home.component';
const routes: Routes = [
  {
    path: '',
    component: HomeComponent,
    children: [
      {
        path: 'diary',
        loadChildren: () =&gt;
          import('../diary/diary.module').then((file) =&gt; file.DiaryModule),
      },
      {
        path: '',
        redirectTo: 'diary',
        pathMatch: 'full',
      },
    ],
  },
];
@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule],
})
export class HomeRoutingModule {}</span></pre> <p><span class="koboSpan" id="kobo.120.1">In this routes file, similar to the previous one, we</span><a id="_idIndexMarker294"/><span class="koboSpan" id="kobo.121.1"> define that the main route will direct to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.122.1">HomeComponent</span></strong><span class="koboSpan" id="kobo.123.1"> component. </span><span class="koboSpan" id="kobo.123.2">However, here, we want the routes and modules to be rendered in the </span><em class="italic"><span class="koboSpan" id="kobo.124.1">router outlet</span></em><span class="koboSpan" id="kobo.125.1"> of the component instead </span><span class="No-Break"><span class="koboSpan" id="kobo.126.1">of </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.127.1">AppModule</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.128.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.129.1">Here, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.130.1">children</span></strong><span class="koboSpan" id="kobo.131.1"> property comes into play in which we will define the nested routes for this module. </span><span class="koboSpan" id="kobo.131.2">Since we want to use </span><strong class="source-inline"><span class="koboSpan" id="kobo.132.1">DiaryComponent</span></strong><span class="koboSpan" id="kobo.133.1">, we are performing lazy loading of its module. </span><span class="koboSpan" id="kobo.133.2">This follows the Angular best practice of separating functional modules in </span><span class="No-Break"><span class="koboSpan" id="kobo.134.1">the application.</span></span></p>
<p><span class="koboSpan" id="kobo.135.1">Now, when running our </span><a id="_idIndexMarker295"/><span class="koboSpan" id="kobo.136.1">application again, we have the diary </span><span class="No-Break"><span class="koboSpan" id="kobo.137.1">page back.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer044">
<span class="koboSpan" id="kobo.138.1"><img alt="Figure 7.1 – Gym Diary home page with Diary" src="image/B19562_07_1.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.139.1">Figure 7.1 – Gym Diary home page with Diary</span></p>
<p><span class="koboSpan" id="kobo.140.1">To conclude this session, let’s add the links for the new exercise entry in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.141.1">Home</span></strong><span class="koboSpan" id="kobo.142.1"> template. </span><span class="koboSpan" id="kobo.142.2">Make the </span><span class="No-Break"><span class="koboSpan" id="kobo.143.1">following modification:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.144.1">
&lt;li&gt;
  &lt;a routerLink="./diary" class="flex items-center space-x-2 text-white"&gt;
    &lt;span&gt;Diary&lt;/span&gt;
  &lt;/a&gt;
&lt;/li&gt;
&lt;li&gt;
  &lt;a routerLink="./diary/new-reactive" class="flex items-center space-x-2 text-white"&gt;
    &lt;span&gt;New Entry&lt;/span&gt;
  &lt;/a&gt;
&lt;/li&gt;</span></pre> <p><span class="koboSpan" id="kobo.145.1">We are using the </span><a id="_idIndexMarker296"/><span class="koboSpan" id="kobo.146.1">Angular </span><strong class="source-inline"><span class="koboSpan" id="kobo.147.1">routerLink</span></strong><span class="koboSpan" id="kobo.148.1"> directive to create the link in the template, specifying the URL it should </span><span class="No-Break"><span class="koboSpan" id="kobo.149.1">navigate to.</span></span></p>
<p><span class="koboSpan" id="kobo.150.1">An important detail to note is that we are using the relative path of the project to create the link using </span><strong class="source-inline"><span class="koboSpan" id="kobo.151.1">./</span></strong><span class="koboSpan" id="kobo.152.1">. </span><span class="koboSpan" id="kobo.152.2">Since the entry form route is located in the diary module, Angular interprets that the module has already been loaded and allows the link without requiring an additional declaration in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.153.1">HomeRoutingModule</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.154.1"> component.</span></span></p>
<p><span class="koboSpan" id="kobo.155.1">In the next section, let’s explore how to handle a scenario in which the user enters a date that does </span><span class="No-Break"><span class="koboSpan" id="kobo.156.1">not</span><a id="_idTextAnchor214"/><span class="koboSpan" id="kobo.157.1"> exist.</span></span></p>
<h1 id="_idParaDest-108"><a id="_idTextAnchor215"/><span class="koboSpan" id="kobo.158.1">Defining an error page and title</span></h1>
<p><span class="koboSpan" id="kobo.159.1">In our </span><a id="_idIndexMarker297"/><span class="koboSpan" id="kobo.160.1">current project, if the user enters a path that does not have a mapped route, they will be faced with a blank screen. </span><span class="koboSpan" id="kobo.160.2">This is not a good </span><strong class="bold"><span class="koboSpan" id="kobo.161.1">user experience</span></strong><span class="koboSpan" id="kobo.162.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.163.1">UX</span></strong><span class="koboSpan" id="kobo.164.1">) practice; ideally, we need to handle this error by presenting an error page for it to be redirected to the </span><span class="No-Break"><span class="koboSpan" id="kobo.165.1">correct page.</span></span></p>
<p><span class="koboSpan" id="kobo.166.1">First, let’s create the component using the </span><span class="No-Break"><span class="koboSpan" id="kobo.167.1">Angular CLI:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.168.1">
ng generate component ErrorPage</span></pre> <p><span class="koboSpan" id="kobo.169.1">Here, we are creating the component directly in </span><strong class="source-inline"><span class="koboSpan" id="kobo.170.1">AppModule</span></strong><span class="koboSpan" id="kobo.171.1"> because we want to give this treatment to our entire system and not to a specific </span><span class="No-Break"><span class="koboSpan" id="kobo.172.1">functional module.</span></span></p>
<p><span class="koboSpan" id="kobo.173.1">Let’s create the template for this component with the </span><span class="No-Break"><span class="koboSpan" id="kobo.174.1">error message:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.175.1">
&lt;div class="flex h-screen flex-col items-center justify-center"&gt;
  &lt;h1 class="mb-4 text-6xl font-bold text-red-500"&gt;Oops!&lt;/h1&gt;
  &lt;h2 class="mb-2 text-3xl font-bold text-gray-800"&gt;Looks like you're lost!&lt;/h2&gt;
  &lt;p class="mb-6 text-gray-600"&gt;
    We couldn't find the page you're looking for.
</span><span class="koboSpan" id="kobo.175.2">  &lt;/p&gt;
  &lt;p class="text-gray-600"&gt;
    But don't worry! </span><span class="koboSpan" id="kobo.175.3">Go back to the Gym Diary and continue your progress!
</span><span class="koboSpan" id="kobo.175.4">  &lt;/p&gt;
  &lt;a
    routerLink="/home"
    class="mt-4 rounded bg-blue-500 px-4 py-2 font-bold text-white hover:bg-blue-600"
  &gt;
    Go back to the Gym Diary
  &lt;/a&gt;
&lt;/div&gt;</span></pre> <p><span class="koboSpan" id="kobo.176.1">Note that we have the link to the home page as a call to action for the user to return to the </span><span class="No-Break"><span class="koboSpan" id="kobo.177.1">home page.</span></span></p>
<p><span class="koboSpan" id="kobo.178.1">The next step is</span><a id="_idIndexMarker298"/><span class="koboSpan" id="kobo.179.1"> to update the </span><strong class="source-inline"><span class="koboSpan" id="kobo.180.1">AppRoutingModule</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.181.1">routes file:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.182.1">
. </span><span class="koboSpan" id="kobo.182.2">. </span><span class="koboSpan" id="kobo.182.3">.
</span><span class="koboSpan" id="kobo.182.4">import { ErrorPageComponent } from './error-page/error-page.component';
const routes: Routes = [
  { path: '', pathMatch: 'full', redirectTo: 'home' },
  {
    path: 'home',
    loadChildren: () =&gt;
      import('./home/home.module').then((file) =&gt; file.HomeModule),
  },
  { path: 'error', component: ErrorPageComponent },
  { path: '**', redirectTo: '/error' },
];
. </span><span class="koboSpan" id="kobo.182.5">. </span><span class="koboSpan" id="kobo.182.6">.</span></pre> <p><span class="koboSpan" id="kobo.183.1">At this point, Angular will do its job. </span><span class="koboSpan" id="kobo.183.2">Just by defining the error page route and then creating another entry in the array, we have defined the </span><strong class="source-inline"><span class="koboSpan" id="kobo.184.1">'**'</span></strong><span class="koboSpan" id="kobo.185.1"> path and redirected it to the </span><span class="No-Break"><span class="koboSpan" id="kobo.186.1">error route.</span></span></p>
<p><span class="koboSpan" id="kobo.187.1">When we run our project, if the</span><a id="_idIndexMarker299"/><span class="koboSpan" id="kobo.188.1"> user enters an incorrect page, the following message will </span><span class="No-Break"><span class="koboSpan" id="kobo.189.1">be displayed:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer045">
<span class="koboSpan" id="kobo.190.1"><img alt="Figure 7.2 – Incorrect route error page" src="image/B19562_07_2.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.191.1">Figure 7.2 – Incorrect route error page</span></p>
<p><span class="koboSpan" id="kobo.192.1">Another point that we can improve in our application is the title of the page in the </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.193.1">Browser</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.194.1"> tab.</span></span></p>
<p><span class="koboSpan" id="kobo.195.1">For this, we can once again use Angular’s routing mechanisms. </span><span class="koboSpan" id="kobo.195.2">In </span><strong class="source-inline"><span class="koboSpan" id="kobo.196.1">DiaryRoutingModule</span></strong><span class="koboSpan" id="kobo.197.1">, we need to change the following </span><span class="No-Break"><span class="koboSpan" id="kobo.198.1">code snippet:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.199.1">
. </span><span class="koboSpan" id="kobo.199.2">. </span><span class="koboSpan" id="kobo.199.3">.
</span><span class="koboSpan" id="kobo.199.4">const routes: Routes = [
  {
    path: '',
    component: DiaryComponent,
    title: 'Diary',
  },
  {
    path: 'new-template',
    component: NewEntryFormTemplateComponent,
  },
  {
    path: 'new-reactive',
    component: NewEntryFormReactiveComponent,
    title: 'Entry Form',
  },
];
. </span><span class="koboSpan" id="kobo.199.5">. </span><span class="koboSpan" id="kobo.199.6">.</span></pre> <p><span class="koboSpan" id="kobo.200.1">To change the title, we</span><a id="_idIndexMarker300"/><span class="koboSpan" id="kobo.201.1"> just need to inform the </span><strong class="source-inline"><span class="koboSpan" id="kobo.202.1">title</span></strong><span class="koboSpan" id="kobo.203.1"> property in the route definition. </span><span class="koboSpan" id="kobo.203.2">Another approach that is possible (but longer) is to use Angular’s </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.204.1">Title</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.205.1"> service.</span></span></p>
<p><span class="koboSpan" id="kobo.206.1">Let’s exemplify this in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.207.1">NewEntryFormTemplateComponent</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.208.1"> component:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.209.1">
import { Title } from '@angular/platform-browser';
. </span><span class="koboSpan" id="kobo.209.2">. </span><span class="koboSpan" id="kobo.209.3">.
</span><span class="koboSpan" id="kobo.209.4">export class NewEntryFormTemplateComponent implements OnInit {
. </span><span class="koboSpan" id="kobo.209.5">. </span><span class="koboSpan" id="kobo.209.6">.
</span><span class="koboSpan" id="kobo.209.7">  private titleService = inject(Title);
. </span><span class="koboSpan" id="kobo.209.8">. </span><span class="koboSpan" id="kobo.209.9">.
</span><span class="koboSpan" id="kobo.209.10">  ngOnInit(): void {
    this.titleService.setTitle('Template Form');
  }
. </span><span class="koboSpan" id="kobo.209.11">. </span><span class="koboSpan" id="kobo.209.12">.
</span><span class="koboSpan" id="kobo.209.13">}</span></pre> <p><span class="koboSpan" id="kobo.210.1">After </span><a id="_idIndexMarker301"/><span class="koboSpan" id="kobo.211.1">injecting the </span><strong class="source-inline"><span class="koboSpan" id="kobo.212.1">Title</span></strong><span class="koboSpan" id="kobo.213.1"> service, we are using it in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.214.1">OnInit</span></strong><span class="koboSpan" id="kobo.215.1"> lifecycle hook. </span><span class="koboSpan" id="kobo.215.2">Although the route approach is much simpler and more intuitive, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.216.1">Title</span></strong><span class="koboSpan" id="kobo.217.1"> service can be used if the title can </span><span class="No-Break"><span class="koboSpan" id="kobo.218.1">change dynamically.</span></span></p>
<p><span class="koboSpan" id="kobo.219.1">We will now learn how to pass information from one route to another in the </span><span class="No-Break"><span class="koboSpan" id="kobo.220.1">ne</span><a id="_idTextAnchor216"/><span class="koboSpan" id="kobo.221.1">xt section.</span></span></p>
<h1 id="_idParaDest-109"><a id="_idTextAnchor217"/><span class="koboSpan" id="kobo.222.1">Dynamic routes – wildcards and parameters</span></h1>
<p><span class="koboSpan" id="kobo.223.1">We want to</span><a id="_idIndexMarker302"/><span class="koboSpan" id="kobo.224.1"> change the function of the </span><strong class="bold"><span class="koboSpan" id="kobo.225.1">New Rep</span></strong><span class="koboSpan" id="kobo.226.1"> button so that instead of adding a rep to the entry, the user can actually edit the entry, opening the form with the </span><a id="_idIndexMarker303"/><span class="koboSpan" id="kobo.227.1">data </span><span class="No-Break"><span class="koboSpan" id="kobo.228.1">filled in.</span></span></p>
<p><span class="koboSpan" id="kobo.229.1">First, let’s add a new method to the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.230.1">ExerciseSetsService</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.231.1"> service:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.232.1">
export class ExerciseSetsService {
 . </span><span class="koboSpan" id="kobo.232.2">. </span><span class="koboSpan" id="kobo.232.3">.
</span><span class="koboSpan" id="kobo.232.4">  updateItem(id: string, item: Partial&lt;ExerciseSet&gt;): Observable&lt;ExerciseSet&gt; {
    return this.httpClient.put&lt;ExerciseSet&gt;(`${this.url}/${id}`, item);
  }
  getItem(id: string): Observable&lt;ExerciseSet&gt; {
    return this.httpClient.get&lt;ExerciseSet&gt;(`${this.url}/${id}`);
  }
}</span></pre> <p><span class="koboSpan" id="kobo.233.1">In addition to creating the new method by getting a specific item, we also prepared the </span><strong class="source-inline"><span class="koboSpan" id="kobo.234.1">update</span></strong><span class="koboSpan" id="kobo.235.1"> method to accept </span><strong class="source-inline"><span class="koboSpan" id="kobo.236.1">Partial</span></strong><span class="koboSpan" id="kobo.237.1"> of the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.238.1">ExerciseSet</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.239.1"> object.</span></span></p>
<p><span class="koboSpan" id="kobo.240.1">The form for editing the diary entry will be the same as for adding a new entry, with the difference that it will be filled in and will call the </span><strong class="source-inline"><span class="koboSpan" id="kobo.241.1">update</span></strong><span class="koboSpan" id="kobo.242.1"> method. </span><span class="koboSpan" id="kobo.242.2">So, let’s reuse the </span><strong class="source-inline"><span class="koboSpan" id="kobo.243.1">NewEntryFormReactiveComponent</span></strong><span class="koboSpan" id="kobo.244.1"> component </span><span class="No-Break"><span class="koboSpan" id="kobo.245.1">for this.</span></span></p>
<p><span class="koboSpan" id="kobo.246.1">We’ll start by</span><a id="_idIndexMarker304"/><span class="koboSpan" id="kobo.247.1"> editing the </span><strong class="source-inline"><span class="koboSpan" id="kobo.248.1">DiaryRoutingModule</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.249.1">routes file:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.250.1">
const routes: Routes = [
. </span><span class="koboSpan" id="kobo.250.2">. </span><span class="koboSpan" id="kobo.250.3">.
</span><span class="koboSpan" id="kobo.250.4">. </span><span class="koboSpan" id="kobo.250.5">. </span><span class="koboSpan" id="kobo.250.6">.
</span><span class="koboSpan" id="kobo.250.7">  {
    path: 'entry',
    component: NewEntryFormReactiveComponent,
    title: 'Entry Form',
  },
  {
    path: 'entry/:id',
    component: NewEntryFormReactiveComponent,
    title: 'Edit Entry',
  },
];</span></pre> <p><span class="koboSpan" id="kobo.251.1">In the </span><strong class="source-inline"><span class="koboSpan" id="kobo.252.1">route</span></strong><span class="koboSpan" id="kobo.253.1"> array, we change the route of the new form to </span><strong class="source-inline"><span class="koboSpan" id="kobo.254.1">entry</span></strong><span class="koboSpan" id="kobo.255.1"> and create the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.256.1">entry/:id</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.257.1"> route.</span></span></p>
<p><span class="koboSpan" id="kobo.258.1">This route is </span><a id="_idIndexMarker305"/><span class="koboSpan" id="kobo.259.1">pointing to the same component, but note that </span><strong class="source-inline"><span class="koboSpan" id="kobo.260.1">:id</span></strong><span class="koboSpan" id="kobo.261.1"> tells Angular that it is a dynamic route – that is, it will receive a variable value that must be directed to </span><span class="No-Break"><span class="koboSpan" id="kobo.262.1">the route.</span></span></p>
<p><span class="koboSpan" id="kobo.263.1">With this change, we need to refactor some parts of our application. </span><span class="koboSpan" id="kobo.263.2">In the </span><strong class="source-inline"><span class="koboSpan" id="kobo.264.1">HomeComponent</span></strong><span class="koboSpan" id="kobo.265.1"> menu, let’s adjust the </span><span class="No-Break"><span class="koboSpan" id="kobo.266.1">application route:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.267.1">
&lt;li&gt;
  &lt;a
    </span><strong class="bold"><span class="koboSpan" id="kobo.268.1">routerLink="./diary/entry"</span></strong><span class="koboSpan" id="kobo.269.1">
    class="flex items-center space-x-2 text-white"
  &gt;
    &lt;span&gt;New Entry&lt;/span&gt;
  &lt;/a&gt;
&lt;/li&gt;</span></pre> <p><span class="koboSpan" id="kobo.270.1">We also need to </span><a id="_idIndexMarker306"/><span class="koboSpan" id="kobo.271.1">adjust the journal and input components to call the new route instead of increasing the number of repetitions. </span><span class="koboSpan" id="kobo.271.2">In the </span><strong class="source-inline"><span class="koboSpan" id="kobo.272.1">EntryItemComponent</span></strong><span class="koboSpan" id="kobo.273.1"> component, we are going to adjust the component’s method and </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.274.1">Output</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.275.1"> instances:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.276.1">
export class EntryItemComponent {
  @Input('exercise-set') exerciseSet!: ExerciseSet;
  @Output() editEvent = new EventEmitter&lt;ExerciseSet&gt;();
  @Output() deleteEvent = new EventEmitter&lt;string&gt;();
  delete() {
    this.deleteEvent.emit(this.exerciseSet.id);
  }
  editEntry() {
    this.editEvent.emit(this.exerciseSet);
  }
}</span></pre> <p><span class="koboSpan" id="kobo.277.1">Here, we remove the treatment and just emit the event. </span><span class="koboSpan" id="kobo.277.2">In the template, we will adjust the </span><span class="No-Break"><span class="koboSpan" id="kobo.278.1">HTML content:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.279.1">
. </span><span class="koboSpan" id="kobo.279.2">. </span><span class="koboSpan" id="kobo.279.3">.
</span><span class="koboSpan" id="kobo.279.4">&lt;button
  class="rounded bg-blue-500 px-4 py-2 font-bold text-white hover:bg-blue-700"
  (click)="editEntry()"
&gt;
  Edit
&lt;/button&gt;
. </span><span class="koboSpan" id="kobo.279.5">. </span><span class="koboSpan" id="kobo.279.6">.</span></pre> <p><span class="koboSpan" id="kobo.280.1">We will also</span><a id="_idIndexMarker307"/><span class="koboSpan" id="kobo.281.1"> adjust the </span><strong class="source-inline"><span class="koboSpan" id="kobo.282.1">ListEntriesComponent</span></strong><span class="koboSpan" id="kobo.283.1"> component to properly </span><span class="No-Break"><span class="koboSpan" id="kobo.284.1">propagate </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.285.1">editEvent</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.286.1">:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.287.1">
export class ListEntriesComponent {
  @Input() exerciseList!: ExerciseSetList;
  @Output() </span><strong class="bold"><span class="koboSpan" id="kobo.288.1">editEvent</span></strong><span class="koboSpan" id="kobo.289.1"> = new EventEmitter&lt;ExerciseSet&gt;();
  @Output() deleteEvent = new EventEmitter&lt;string&gt;();
. </span><span class="koboSpan" id="kobo.289.2">. </span><span class="koboSpan" id="kobo.289.3">.
</span><span class="koboSpan" id="kobo.289.4">}
&lt;app-entry-item
  [exercise-set]="item"
  (deleteEvent)="deleteEvent.emit($event)"
  (editEvent)="editEvent.emit($event)"
/&gt;</span></pre> <p><span class="koboSpan" id="kobo.290.1">We’ll make a small change to the diary to reflect the new route. </span><span class="koboSpan" id="kobo.290.2">We’ll do this in the </span><span class="No-Break"><span class="koboSpan" id="kobo.291.1">template first:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.292.1">
&lt;app-list-entries
  [exerciseList]="exerciseList"
  (deleteEvent)="deleteItem($event)"
  (editEvent)="editEntry($event)"
/&gt;</span></pre> <p><span class="koboSpan" id="kobo.293.1">In the component, we will change the </span><strong class="source-inline"><span class="koboSpan" id="kobo.294.1">newRep</span></strong><span class="koboSpan" id="kobo.295.1"> method, which, in addition to the name change, will redirect to the </span><span class="No-Break"><span class="koboSpan" id="kobo.296.1">new route:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.297.1">
addExercise(newSet: ExerciseSet) {
  this.router.navigate(['/home/diary/entry']);
}
deleteItem(id: string) {
  this.exerciseSetsService.deleteItem(id).subscribe();
}
editEntry(updateSet: ExerciseSet) {
  const id = updateSet.id ?? </span><span class="koboSpan" id="kobo.297.2">'';
  this.router.navigate([`/home/diary/entry/${id}`]);
}</span></pre> <p><span class="koboSpan" id="kobo.298.1">To redirect to the </span><a id="_idIndexMarker308"/><span class="koboSpan" id="kobo.299.1">new route, we are doing string interpolation to include </span><strong class="source-inline"><span class="koboSpan" id="kobo.300.1">id</span></strong><span class="koboSpan" id="kobo.301.1"> that was emitted by the output of the list item. </span><span class="koboSpan" id="kobo.301.2">Finally, let’s focus our attention on the form. </span><span class="koboSpan" id="kobo.301.3">In the </span><strong class="source-inline"><span class="koboSpan" id="kobo.302.1">NewEntryFormReactiveComponent</span></strong><span class="koboSpan" id="kobo.303.1"> component, let’s adjust the </span><strong class="source-inline"><span class="koboSpan" id="kobo.304.1">button</span></strong><span class="koboSpan" id="kobo.305.1"> label in </span><span class="No-Break"><span class="koboSpan" id="kobo.306.1">the template:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.307.1">
&lt;button
  type="submit"
  [disabled]="entryForm.invalid"
  [class.opacity-50]="entryForm.invalid"
  class="rounded bg-blue-500 px-4 py-2 font-bold text-white hover:bg-blue-700"
&gt;
  Add Entry
&lt;/button&gt;</span></pre> <p><span class="koboSpan" id="kobo.308.1">In the </span><strong class="source-inline"><span class="koboSpan" id="kobo.309.1">NewEntryFormReactiveComponent</span></strong><span class="koboSpan" id="kobo.310.1"> component, we </span><a id="_idIndexMarker309"/><span class="koboSpan" id="kobo.311.1">will adapt it to now be the form for creating and editing entries in </span><span class="No-Break"><span class="koboSpan" id="kobo.312.1">our application:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.313.1">
. </span><span class="koboSpan" id="kobo.313.2">. </span><span class="koboSpan" id="kobo.313.3">.
</span><span class="koboSpan" id="kobo.313.4">export class NewEntryFormReactiveComponent implements OnInit {
. </span><span class="koboSpan" id="kobo.313.5">. </span><span class="koboSpan" id="kobo.313.6">.
</span><span class="koboSpan" id="kobo.313.7">  private route = inject(ActivatedRoute);
  private entryId?: string | null;
. </span><span class="koboSpan" id="kobo.313.8">. </span><span class="koboSpan" id="kobo.313.9">.
</span><span class="koboSpan" id="kobo.313.10">  ngOnInit(): void {
    this.entryId = this.route.snapshot.paramMap.get('id');
    if (this.entryId) {
      this.exerciseSetsService
        .getItem(this.entryId)
        .subscribe((entry) =&gt; this.updateForm(entry));
    }
  }
  updateForm(entry: ExerciseSet): void {
    let { id: _, ...entryForm } = entry;
    this.entryForm.setValue(entryForm);
  }
. </span><span class="koboSpan" id="kobo.313.11">. </span><span class="koboSpan" id="kobo.313.12">.
</span><span class="koboSpan" id="kobo.313.13">}</span></pre> <p><span class="koboSpan" id="kobo.314.1">In the example, we </span><a id="_idIndexMarker310"/><span class="koboSpan" id="kobo.315.1">use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.316.1">OnInit</span></strong><span class="koboSpan" id="kobo.317.1"> lifecycle hook to configure the form according to the route it was called. </span><span class="koboSpan" id="kobo.317.2">For this, Angular has a service </span><span class="No-Break"><span class="koboSpan" id="kobo.318.1">called </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.319.1">ActivatedRoute</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.320.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.321.1">In the </span><strong class="source-inline"><span class="koboSpan" id="kobo.322.1">ngOnInit</span></strong><span class="koboSpan" id="kobo.323.1"> method, we capture the parameter of the route that called our application and, if the component receives the ID, it will fetch the entry from the backend and update the form according to </span><span class="No-Break"><span class="koboSpan" id="kobo.324.1">the return.</span></span></p>
<p><span class="koboSpan" id="kobo.325.1">One detail here is that we are using the destructuring assignment to remove the </span><strong class="source-inline"><span class="koboSpan" id="kobo.326.1">id</span></strong><span class="koboSpan" id="kobo.327.1"> field from the object because it does not exist in the form’s </span><span class="No-Break"><span class="koboSpan" id="kobo.328.1">data model.</span></span></p>
<p><span class="koboSpan" id="kobo.329.1">In the same component, we need to change the recording of the </span><span class="No-Break"><span class="koboSpan" id="kobo.330.1">diary entry:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.331.1">
newEntry() {
  if (this.entryForm.valid) {
    const newEntry = { ...this.entryForm.value };
    if (this.entryId) {
      this.exerciseSetsService
        .updateItem(this.entryId, newEntry)
        .subscribe((entry) =&gt; this.router.navigate(['/home']));
    } else {
      this.exerciseSetsService
        .addNewItem(newEntry)
        .subscribe((entry) =&gt; this.router.navigate(['/home']));
    }
  }
}</span></pre> <p><span class="koboSpan" id="kobo.332.1">In the </span><strong class="source-inline"><span class="koboSpan" id="kobo.333.1">newEntry</span></strong><span class="koboSpan" id="kobo.334.1"> method, if the component has received the object’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.335.1">id</span></strong><span class="koboSpan" id="kobo.336.1"> via the route, it will behave as an edition and call the corresponding method of the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.337.1">exerciseSetsService</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.338.1"> service.</span></span></p>
<p><span class="koboSpan" id="kobo.339.1">When we run the project, we now have the input </span><span class="No-Break"><span class="koboSpan" id="kobo.340.1">edit form.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer046">
<span class="koboSpan" id="kobo.341.1"><img alt="Figure 7.3 – Gym Diary edit entry form" src="image/B19562_07_3.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.342.1">Figure 7.3 – Gym Diary edit entry form</span></p>
<p><span class="koboSpan" id="kobo.343.1">From</span><a id="_idIndexMarker311"/><span class="koboSpan" id="kobo.344.1"> version 16 of Angular, we have an improvement in the use of route parameters. </span><span class="koboSpan" id="kobo.344.2">In addition to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.345.1">ActivatedRoute</span></strong><span class="koboSpan" id="kobo.346.1"> service, we can map the inputs of page components directly to route variables in </span><span class="No-Break"><span class="koboSpan" id="kobo.347.1">our applications.</span></span></p>
<p><span class="koboSpan" id="kobo.348.1">Let’s refactor our example to this; first, change the main routing </span><span class="No-Break"><span class="koboSpan" id="kobo.349.1">module, </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.350.1">AppRoutingModule</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.351.1">:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.352.1">
. </span><span class="koboSpan" id="kobo.352.2">. </span><span class="koboSpan" id="kobo.352.3">.
</span><span class="koboSpan" id="kobo.352.4">@NgModule({
  imports: [
    RouterModule.forRoot(routes, {
      bindToComponentInputs: true,
    }),
  ],
  exports: [RouterModule],
})
export class AppRoutingModule {}</span></pre> <p><span class="koboSpan" id="kobo.353.1">To use this resource, we need to add the </span><strong class="source-inline"><span class="koboSpan" id="kobo.354.1">bindToComponentInputs</span></strong><span class="koboSpan" id="kobo.355.1"> attribute in the general configuration of the </span><span class="No-Break"><span class="koboSpan" id="kobo.356.1">application’s route.</span></span></p>
<p><span class="koboSpan" id="kobo.357.1">In our</span><a id="_idIndexMarker312"/><span class="koboSpan" id="kobo.358.1"> form page, we will refactor </span><span class="No-Break"><span class="koboSpan" id="kobo.359.1">as follows:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.360.1">
export class NewEntryFormReactiveComponent implements OnInit {
  @Input('id') entryId?: string;
. </span><span class="koboSpan" id="kobo.360.2">. </span><span class="koboSpan" id="kobo.360.3">.
</span><span class="koboSpan" id="kobo.360.4">  ngOnInit(): void {
    if (this.entryId) {
      this.exerciseSetsService
        .getItem(this.entryId)
        .subscribe((entry) =&gt; this.updateForm(entry</span><a id="_idTextAnchor218"/><span class="koboSpan" id="kobo.361.1">));
    }
  }
. </span><span class="koboSpan" id="kobo.361.2">. </span><span class="koboSpan" id="kobo.361.3">.
</span><span class="koboSpan" id="kobo.361.4">}</span></pre> <p><span class="koboSpan" id="kobo.362.1">We create </span><strong class="source-inline"><span class="koboSpan" id="kobo.363.1">Input</span></strong><span class="koboSpan" id="kobo.364.1"> for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.365.1">entryId</span></strong><span class="koboSpan" id="kobo.366.1"> property and define that the route’s wildcard variable will be </span><strong class="source-inline"><span class="koboSpan" id="kobo.367.1">id</span></strong><span class="koboSpan" id="kobo.368.1">. </span><span class="koboSpan" id="kobo.368.2">We did this to prevent needing to refactor the rest of the component, but we could also change the property name to also be </span><strong class="source-inline"><span class="koboSpan" id="kobo.369.1">id</span></strong><span class="koboSpan" id="kobo.370.1">, as in </span><span class="No-Break"><span class="koboSpan" id="kobo.371.1">this example:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.372.1">
 @Input() id?: string;</span></pre> <p><span class="koboSpan" id="kobo.373.1">The important thing</span><a id="_idIndexMarker313"/><span class="koboSpan" id="kobo.374.1"> here is that Angular automatically binds the information that comes from the route in the attribute, simplifying even more the passing of parameters via the URL to </span><span class="No-Break"><span class="koboSpan" id="kobo.375.1">the component.</span></span></p>
<p><span class="koboSpan" id="kobo.376.1">In the next section, we will learn how to protect the route from being incorrectly accessed by </span><a id="_idTextAnchor219"/><span class="koboSpan" id="kobo.377.1">studying </span><span class="No-Break"><span class="koboSpan" id="kobo.378.1">route guards.</span></span></p>
<h1 id="_idParaDest-110"><a id="_idTextAnchor220"/><span class="koboSpan" id="kobo.379.1">Securing routes – guards</span></h1>
<p><span class="koboSpan" id="kobo.380.1">So far, we’ve seen </span><a id="_idIndexMarker314"/><span class="koboSpan" id="kobo.381.1">how to take </span><a id="_idIndexMarker315"/><span class="koboSpan" id="kobo.382.1">data through the route to determine the behavior of a </span><strong class="source-inline"><span class="koboSpan" id="kobo.383.1">page</span></strong><span class="koboSpan" id="kobo.384.1"> component. </span><span class="koboSpan" id="kobo.384.2">However, the routing created in Angular is versatile and also allows you to shape the customer’s journey by conditioning resources based on a </span><span class="No-Break"><span class="koboSpan" id="kobo.385.1">business rule.</span></span></p>
<p><span class="koboSpan" id="kobo.386.1">To illustrate this feature, we are going to create a login screen with a simplified authentication mechanism. </span><span class="koboSpan" id="kobo.386.2">To create the components, we are going to use the </span><span class="No-Break"><span class="koboSpan" id="kobo.387.1">Angular CLI.</span></span></p>
<p><span class="koboSpan" id="kobo.388.1">At the command prompt of your operating system, use the </span><span class="No-Break"><span class="koboSpan" id="kobo.389.1">following commands:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.390.1">
ng g m login --routing
ng g c login
ng g s login/auth</span></pre> <p><span class="koboSpan" id="kobo.391.1">The first command creates a </span><strong class="source-inline"><span class="koboSpan" id="kobo.392.1">Login</span></strong><span class="koboSpan" id="kobo.393.1"> module with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.394.1">routes</span></strong><span class="koboSpan" id="kobo.395.1"> file. </span><span class="koboSpan" id="kobo.395.2">The second creates the </span><strong class="source-inline"><span class="koboSpan" id="kobo.396.1">login</span></strong><span class="koboSpan" id="kobo.397.1"> page component and, finally, we have the service that will manage the interaction with the authentication of </span><span class="No-Break"><span class="koboSpan" id="kobo.398.1">our backend.</span></span></p>
<p><span class="koboSpan" id="kobo.399.1">In the </span><strong class="source-inline"><span class="koboSpan" id="kobo.400.1">Login</span></strong><span class="koboSpan" id="kobo.401.1"> module, we will configure the dependencies of the </span><span class="No-Break"><span class="koboSpan" id="kobo.402.1">new module:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.403.1">
. </span><span class="koboSpan" id="kobo.403.2">. </span><span class="koboSpan" id="kobo.403.3">.
</span><span class="koboSpan" id="kobo.403.4">@NgModule({
  declarations: [
    LoginComponent
  ],
  imports: [
    CommonModule,
    LoginRoutingModule,
    ReactiveFormsModule
  ]
})
export class LoginModule { }</span></pre> <p><span class="koboSpan" id="kobo.404.1">Next, let’s add the </span><a id="_idIndexMarker316"/><span class="koboSpan" id="kobo.405.1">new</span><a id="_idIndexMarker317"/><span class="koboSpan" id="kobo.406.1"> module </span><span class="No-Break"><span class="koboSpan" id="kobo.407.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.408.1">AppRoutingModule</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.409.1">:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.410.1">
const routes: Routes = [
  { path: '', pathMatch: 'full', redirectTo: 'home' },
  {
    path: 'home',
    loadChildren: () =&gt;
      import('./home/home.module').then((file) =&gt; file.HomeModule),
  },
  {
    path: 'login',
    loadChildren: () =&gt;
      import('./login/login.module').then((file) =&gt; file.LoginModule),
  },
  { path: 'error', component: ErrorPageComponent },
  { path: '**', redirectTo: '/error' },
];</span></pre> <p><span class="koboSpan" id="kobo.411.1">In the </span><strong class="source-inline"><span class="koboSpan" id="kobo.412.1">LoginRoutingModule</span></strong><span class="koboSpan" id="kobo.413.1"> module, we will configure the component </span><span class="No-Break"><span class="koboSpan" id="kobo.414.1">we created:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.415.1">
const routes: Routes = [
  { path: '', component: LoginComponent },
];
@NgModule({
  imports: [RouterModule.forChild(routes)],
  exports: [RouterModule]
})
export class LoginRoutingModule { }</span></pre> <p><span class="koboSpan" id="kobo.416.1">To </span><a id="_idIndexMarker318"/><span class="koboSpan" id="kobo.417.1">simplify the handling of the request and response payload of our authentication service, let’s</span><a id="_idIndexMarker319"/><span class="koboSpan" id="kobo.418.1"> create an interface with the </span><span class="No-Break"><span class="koboSpan" id="kobo.419.1">new types:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.420.1">
export interface LoginForm {
  username: string;
  password: string;
}
export interface Token {
  access_token: string;
}</span></pre> <p><span class="koboSpan" id="kobo.421.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.422.1">LoginForm</span></strong><span class="koboSpan" id="kobo.423.1"> interface corresponds to the data that we are going to send and the </span><strong class="source-inline"><span class="koboSpan" id="kobo.424.1">Token</span></strong><span class="koboSpan" id="kobo.425.1"> interface is the API return, which is basically the access token that the application will send the </span><span class="No-Break"><span class="koboSpan" id="kobo.426.1">client’s JWT.</span></span></p>
<p><span class="koboSpan" id="kobo.427.1">With the interface created, let’s create a service that will orchestrate the interaction with </span><span class="No-Break"><span class="koboSpan" id="kobo.428.1">the backend:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.429.1">
export class AuthService {
  private httpClient = inject(HttpClient);
  private url = 'http://localhost:3000/auth/login';
  private token?: Token;
  login(loginForm: Partial&lt;LoginForm&gt;): Observable&lt;Token&gt; {
    return this.httpClient
      .post&lt;Token&gt;(this.url, loginForm)
      .pipe(tap((token) =&gt; (this.token = token)));
  }
  get isLogged() {
    return this.token ? </span><span class="koboSpan" id="kobo.429.2">true : false;
  }
  logout() {
    this.token = undefined;
  }
}</span></pre> <p><span class="koboSpan" id="kobo.430.1">In this service, we </span><a id="_idIndexMarker320"/><span class="koboSpan" id="kobo.431.1">make the request to the backend using</span><a id="_idIndexMarker321"/><span class="koboSpan" id="kobo.432.1"> the </span><strong class="source-inline"><span class="koboSpan" id="kobo.433.1">HttpClient</span></strong><span class="koboSpan" id="kobo.434.1"> service (for more details, read </span><a href="B19562_05.xhtml#_idTextAnchor163"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.435.1">Chapter 5</span></em></span></a><span class="koboSpan" id="kobo.436.1">, </span><em class="italic"><span class="koboSpan" id="kobo.437.1">Angular Services and the Singleton Pattern</span></em><span class="koboSpan" id="kobo.438.1">). </span><span class="koboSpan" id="kobo.438.2">We are using the RxJS tap operator so that as soon as the request is successful, it saves the token in a </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.439.1">service</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.440.1"> variable.</span></span></p>
<p><span class="koboSpan" id="kobo.441.1">It is through this </span><a id="_idIndexMarker322"/><span class="koboSpan" id="kobo.442.1">variable that we create the </span><strong class="source-inline"><span class="koboSpan" id="kobo.443.1">isLogged</span></strong><span class="koboSpan" id="kobo.444.1"> property, which will be important for controlling</span><a id="_idIndexMarker323"/><span class="koboSpan" id="kobo.445.1"> the route. </span><span class="koboSpan" id="kobo.445.2">With the services created, we can develop the </span><strong class="source-inline"><span class="koboSpan" id="kobo.446.1">Login</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.447.1">page template:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.448.1">
&lt;div class="flex justify-center items-center h-screen bg-blue-500"&gt;
  &lt;div class="bg-blue-200 rounded shadow p-6"&gt;
    &lt;h2 class="text-2xl font-bold text-gray-800 mb-6"&gt;Login&lt;/h2&gt;
    &lt;form class="space-y-4"
    [formGroup]="loginForm"
    (ngSubmit)="login()"
    &gt;
    &lt;div&gt;
      &lt;label for="username" class="text-gray-700"&gt;Username&lt;/label&gt;
      &lt;input type="text" id="username" class="block w-full rounded border-gray-300 p-2 focus:border-blue-500 focus:outline-none" formControlName="username"&gt;
    &lt;/div&gt;
    &lt;div&gt;
      &lt;label for="password" class="text-gray-700"&gt;Password&lt;/label&gt;
      &lt;input type="password" id="password" class="block w-full rounded border-gray-300 p-2 focus:border-blue-500 focus:outline-none" formControlName="password"&gt;
    &lt;/div&gt;
    &lt;div&gt;
      &lt;button
        type="submit"
        class="bg-blue-500 text-white rounded px-4 py-2 w-full"
        [disabled]="loginForm.invalid"
        [class.opacity-50]="loginForm.invalid"
        &gt;Login&lt;/button&gt;
    &lt;/div&gt;
    &lt;/form&gt;
  &lt;/div&gt;
&lt;/div&gt;</span></pre> <p><span class="koboSpan" id="kobo.449.1">When creating </span><strong class="source-inline"><span class="koboSpan" id="kobo.450.1">Login</span></strong><span class="koboSpan" id="kobo.451.1"> pages, an</span><a id="_idIndexMarker324"/><span class="koboSpan" id="kobo.452.1"> important point is to correctly use the HTML </span><strong class="source-inline"><span class="koboSpan" id="kobo.453.1">input</span></strong><span class="koboSpan" id="kobo.454.1"> field types for the correct UX treatment </span><span class="No-Break"><span class="koboSpan" id="kobo.455.1">and accessibility.</span></span></p>
<p><span class="koboSpan" id="kobo.456.1">With the template </span><a id="_idIndexMarker325"/><span class="koboSpan" id="kobo.457.1">completed, let’s develop </span><span class="No-Break"><span class="koboSpan" id="kobo.458.1">the component:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.459.1">
export class LoginComponent {
  private formBuilder = inject(NonNullableFormBuilder);
  private loginService = inject(AuthService);
  private router = inject(Router);
  public loginForm = this.formBuilder.group({
    username: ['', [Validators.required]],
    password: ['', [Validators.required]],
  });
  login() {
    const loginValue = { ...this.loginForm.value };
    this.loginService.login(loginValue).subscribe({
      next: (_) =&gt; {
        this.router.navigate(['/home']);
      },
      error: (e) =&gt; alert('User not Found'),
    });
  }
}</span></pre> <p><span class="koboSpan" id="kobo.460.1">In this example, we are</span><a id="_idIndexMarker326"/><span class="koboSpan" id="kobo.461.1"> creating the</span><a id="_idIndexMarker327"/><span class="koboSpan" id="kobo.462.1"> reactive form, and in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.463.1">login</span></strong><span class="koboSpan" id="kobo.464.1"> method, we are using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.465.1">AuthService</span></strong><span class="koboSpan" id="kobo.466.1"> service. </span><span class="koboSpan" id="kobo.466.2">Run the project and, in </span><strong class="source-inline"><span class="koboSpan" id="kobo.467.1">url /login</span></strong><span class="koboSpan" id="kobo.468.1">, we will have our login screen. </span><span class="koboSpan" id="kobo.468.2">To use the screen, we have the username </span><strong class="source-inline"><span class="koboSpan" id="kobo.469.1">mario</span></strong><span class="koboSpan" id="kobo.470.1"> and </span><span class="No-Break"><span class="koboSpan" id="kobo.471.1">password </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.472.1">1234</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.473.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer047">
<span class="koboSpan" id="kobo.474.1"><img alt="Figure 7.4 – Login page" src="image/B19562_07_4.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.475.1">Figure 7.4 – Login page</span></p>
<p><span class="koboSpan" id="kobo.476.1">To create the </span><a id="_idIndexMarker328"/><span class="koboSpan" id="kobo.477.1">logout treatment, we will create a link in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.478.1">HomeComponent</span></strong><span class="koboSpan" id="kobo.479.1"> component menu and</span><a id="_idIndexMarker329"/><span class="koboSpan" id="kobo.480.1"> create the </span><strong class="source-inline"><span class="koboSpan" id="kobo.481.1">logout</span></strong><span class="koboSpan" id="kobo.482.1"> method in it, redirecting to the </span><span class="No-Break"><span class="koboSpan" id="kobo.483.1">login page:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.484.1">
&lt;li&gt;
  &lt;a
    (click)="logout()"
    class="flex items-center space-x-2 text-white"
  &gt;
    &lt;span&gt;Logout&lt;/span&gt;
  &lt;/a&gt;
&lt;/li&gt;
export class HomeComponent {
  private authService = inject(AuthService);
  private router = inject(Router);
  logout() {
    this.authService.logout();
    this.router.navigate(['./login']);
  }
}</span></pre> <p><span class="koboSpan" id="kobo.485.1">With the page created, now</span><a id="_idIndexMarker330"/><span class="koboSpan" id="kobo.486.1"> we need a way to guarantee access to the diary only if the user is logged in. </span><span class="koboSpan" id="kobo.486.2">For this type of route checking, we should use Angular’s </span><strong class="bold"><span class="koboSpan" id="kobo.487.1">route </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.488.1">guard</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.489.1"> feature.</span></span></p>
<p><span class="koboSpan" id="kobo.490.1">To create it, we can </span><a id="_idIndexMarker331"/><span class="koboSpan" id="kobo.491.1">count on the help of the Angular CLI; in the command line, use the </span><span class="No-Break"><span class="koboSpan" id="kobo.492.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.493.1">
ng g guard login/auth</span></pre> <p><span class="koboSpan" id="kobo.494.1">A selection list will be presented; choose </span><strong class="bold"><span class="koboSpan" id="kobo.495.1">CanActivate</span></strong><span class="koboSpan" id="kobo.496.1">. </span><span class="koboSpan" id="kobo.496.2">In the new file, let’s create the </span><span class="No-Break"><span class="koboSpan" id="kobo.497.1">following function:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.498.1">
export const authGuard: CanActivateFn = (route, state) =&gt; {
  const authService = inject(AuthService);
  const router = inject(Router);
  if (authService.isLogged) {
    return true;
  } else {
    return router.parseUrl('/login');
  }
};</span></pre> <p><span class="koboSpan" id="kobo.499.1">Since version 14, the recommended way to create route guards is through functions and </span><span class="No-Break"><span class="koboSpan" id="kobo.500.1">not classes.</span></span></p>
<p><span class="koboSpan" id="kobo.501.1">We are </span><a id="_idIndexMarker332"/><span class="koboSpan" id="kobo.502.1">creating the </span><strong class="source-inline"><span class="koboSpan" id="kobo.503.1">authGuard</span></strong><span class="koboSpan" id="kobo.504.1"> function that has the </span><strong class="source-inline"><span class="koboSpan" id="kobo.505.1">CanActivateFn</span></strong><span class="koboSpan" id="kobo.506.1"> interface, which is a function that expects a Boolean return or an object of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.507.1">UrlTree</span></strong><span class="koboSpan" id="kobo.508.1"> class to redirect the user to the </span><span class="No-Break"><span class="koboSpan" id="kobo.509.1">indicated route.</span></span></p>
<p><span class="koboSpan" id="kobo.510.1">In the function, we first inject the </span><strong class="source-inline"><span class="koboSpan" id="kobo.511.1">AuthService</span></strong><span class="koboSpan" id="kobo.512.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.513.1">Router</span></strong><span class="koboSpan" id="kobo.514.1"> services; notice that the </span><strong class="source-inline"><span class="koboSpan" id="kobo.515.1">inject</span></strong><span class="koboSpan" id="kobo.516.1"> function in this context is mandatory because, in a function, we don’t have a constructor to inject </span><span class="No-Break"><span class="koboSpan" id="kobo.517.1">the services.</span></span></p>
<p><span class="koboSpan" id="kobo.518.1">With the services configured, we make an </span><strong class="source-inline"><span class="koboSpan" id="kobo.519.1">if</span></strong><span class="koboSpan" id="kobo.520.1"> statement evaluating the </span><strong class="source-inline"><span class="koboSpan" id="kobo.521.1">isLogged</span></strong><span class="koboSpan" id="kobo.522.1"> service property. </span><span class="koboSpan" id="kobo.522.2">We return </span><strong class="source-inline"><span class="koboSpan" id="kobo.523.1">true</span></strong><span class="koboSpan" id="kobo.524.1"> if the user is logged in, allowing the route to be navigated. </span><span class="koboSpan" id="kobo.524.2">Otherwise, we return an object of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.525.1">UrlTree</span></strong><span class="koboSpan" id="kobo.526.1"> class with the login </span><span class="No-Break"><span class="koboSpan" id="kobo.527.1">page route.</span></span></p>
<p><span class="koboSpan" id="kobo.528.1">To use the guard, let’s</span><a id="_idIndexMarker333"/> <span class="No-Break"><span class="koboSpan" id="kobo.529.1">change </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.530.1">DiaryRoutingModule</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.531.1">:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.532.1">
const routes: Routes = [
  {
    path: '',
    component: DiaryComponent,
    title: 'Diary',
    canActivate: [authGuard],
  },
  {
    path: 'new-template',
    component: NewEntryFormTemplateComponent,
  },
  {
    path: 'entry',
    component: NewEntryFormReactiveComponent,
    title: 'Entry Form',
  },
  {
    path: 'entry/:id',
    component: NewEntryFormReactiveComponent,
    title: 'Edit Entry',
  },
];</span></pre> <p><span class="koboSpan" id="kobo.533.1">By using </span><a id="_idIndexMarker334"/><span class="koboSpan" id="kobo.534.1">the </span><strong class="source-inline"><span class="koboSpan" id="kobo.535.1">canActivate</span></strong><span class="koboSpan" id="kobo.536.1"> attribute, we</span><a id="_idIndexMarker335"/><span class="koboSpan" id="kobo.537.1"> can pass one or more </span><span class="No-Break"><span class="koboSpan" id="kobo.538.1">route guards.</span></span></p>
<p><span class="koboSpan" id="kobo.539.1">Running the application, we can see that we are directed to the login page. </span><span class="koboSpan" id="kobo.539.2">But if we directly call the </span><strong class="source-inline"><span class="koboSpan" id="kobo.540.1">/home/diary/entry</span></strong><span class="koboSpan" id="kobo.541.1"> route, we realize that it is not protected. </span><span class="koboSpan" id="kobo.541.2">This happens because we set </span><strong class="source-inline"><span class="koboSpan" id="kobo.542.1">guard</span></strong><span class="koboSpan" id="kobo.543.1"> only on the </span><strong class="source-inline"><span class="koboSpan" id="kobo.544.1">/</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.545.1">diary</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.546.1"> route.</span></span></p>
<p><span class="koboSpan" id="kobo.547.1">To fix this, we can set the </span><strong class="source-inline"><span class="koboSpan" id="kobo.548.1">canActivate</span></strong><span class="koboSpan" id="kobo.549.1"> attribute on all routes, but a more effective way would be to change the type of the route </span><span class="No-Break"><span class="koboSpan" id="kobo.550.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.551.1">CanActivateChild</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.552.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.553.1">Going back to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.554.1">route</span></strong><span class="koboSpan" id="kobo.555.1"> function, let’s change </span><span class="No-Break"><span class="koboSpan" id="kobo.556.1">its type:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.557.1">
export const authGuard: CanActivateChildFn = (route, state) =&gt; {
. </span><span class="koboSpan" id="kobo.557.2">. </span><span class="koboSpan" id="kobo.557.3">.
</span><span class="koboSpan" id="kobo.557.4">};</span></pre> <p><span class="koboSpan" id="kobo.558.1">We now</span><a id="_idIndexMarker336"/><span class="koboSpan" id="kobo.559.1"> need to </span><a id="_idIndexMarker337"/><span class="No-Break"><span class="koboSpan" id="kobo.560.1">refactor </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.561.1">DiaryRoutingModule</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.562.1">:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.563.1">
const routes: Routes = [
  {
    path: '',
    children: [
      {
        path: '',
        component: DiaryComponent,
        title: 'Diary',
      },
      {
        path: 'new-template',
        component: NewEntryFormTemplateComponent,
      },
      {
        path: 'entry',
        component: NewEntryFormReactiveComponent,
        title: 'Entry Form',
      },
      {
        path: 'entry/:id',
        component: NewEntryFormReactiveComponent,
        title: 'Edit Entry',
      },
    ],
    canActivateChild: [authGuard],
  },
];</span></pre> <p><span class="koboSpan" id="kobo.564.1">Here, we are using a component-less route pattern; basically, we create a </span><a id="_idIndexMarker338"/><span class="koboSpan" id="kobo.565.1">route without a component </span><a id="_idIndexMarker339"/><span class="koboSpan" id="kobo.566.1">and put all the routes as children </span><span class="No-Break"><span class="koboSpan" id="kobo.567.1">of it.</span></span></p>
<p><span class="koboSpan" id="kobo.568.1">Then, we use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.569.1">canActivateChild</span></strong><span class="koboSpan" id="kobo.570.1"> attribute to call the route’s guard, so we don’t need to repeat all the routes in </span><span class="No-Break"><span class="koboSpan" id="kobo.571.1">this module.</span></span></p>
<p><span class="koboSpan" id="kobo.572.1">The </span><a id="_idIndexMarker340"/><span class="koboSpan" id="kobo.573.1">route guard</span><a id="_idIndexMarker341"/><span class="koboSpan" id="kobo.574.1"> feature can do more for your application than flow control; we can improve its perceiv</span><a id="_idTextAnchor221"/><span class="koboSpan" id="kobo.575.1">ed performance, as we’ll see in the </span><span class="No-Break"><span class="koboSpan" id="kobo.576.1">next section.</span></span></p>
<h1 id="_idParaDest-111"><a id="_idTextAnchor222"/><span class="koboSpan" id="kobo.577.1">Optimizing the experience – Resolve</span></h1>
<p><span class="koboSpan" id="kobo.578.1">Performance</span><a id="_idIndexMarker342"/><span class="koboSpan" id="kobo.579.1"> is one of the biggest variables that impact the experience and satisfaction</span><a id="_idIndexMarker343"/><span class="koboSpan" id="kobo.580.1"> of our users; therefore, optimal performance should be a constant goal for the </span><span class="No-Break"><span class="koboSpan" id="kobo.581.1">web developer.</span></span></p>
<p><span class="koboSpan" id="kobo.582.1">Perceived perception is the game we want to win, and we have plenty of options in the Angular ecosystem. </span><span class="koboSpan" id="kobo.582.2">We can load the information that our page will require before it renders and, for that, we will use the Resolveroute </span><span class="No-Break"><span class="koboSpan" id="kobo.583.1">saver resource.</span></span></p>
<p><span class="koboSpan" id="kobo.584.1">Unlike the guard we studied earlier, its purpose is to return information needed by the page being directed by </span><span class="No-Break"><span class="koboSpan" id="kobo.585.1">the route.</span></span></p>
<p><span class="koboSpan" id="kobo.586.1">We will create this guard using the Angular CLI. </span><span class="koboSpan" id="kobo.586.2">In your command prompt, use the </span><span class="No-Break"><span class="koboSpan" id="kobo.587.1">following command:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.588.1">
ng g resolver diary/diary</span></pre> <p><span class="koboSpan" id="kobo.589.1">In the new file created, let’s change the function that the Angular </span><span class="No-Break"><span class="koboSpan" id="kobo.590.1">CLI generated:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.591.1">
export const diaryResolver: ResolveFn&lt;ExerciseSetListAPI&gt; = (route, state) =&gt; {
  const exerciseSetsService = inject(ExerciseSetsService);
  return exerciseSetsService.getInitialList();
};</span></pre> <p><span class="koboSpan" id="kobo.592.1">The function injects the </span><strong class="source-inline"><span class="koboSpan" id="kobo.593.1">ExerciseSetsService</span></strong><span class="koboSpan" id="kobo.594.1"> service and returns the observable returned by the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.595.1">getInitialList</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.596.1"> method.</span></span></p>
<p><span class="koboSpan" id="kobo.597.1">We will configure </span><strong class="source-inline"><span class="koboSpan" id="kobo.598.1">DiaryRoutingModule</span></strong><span class="koboSpan" id="kobo.599.1"> with this </span><span class="No-Break"><span class="koboSpan" id="kobo.600.1">new resolver:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.601.1">
{
  path: '',
  component: DiaryComponent,
  title: 'Diary',
  resolve: { diaryApi: diaryResolver },
},</span></pre> <p><span class="koboSpan" id="kobo.602.1">We are </span><a id="_idIndexMarker344"/><span class="koboSpan" id="kobo.603.1">using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.604.1">resolve</span></strong><span class="koboSpan" id="kobo.605.1"> property, much like configuring a route guide, with the difference that we associate an object with the function, which will be</span><a id="_idIndexMarker345"/><span class="koboSpan" id="kobo.606.1"> important for the component to consume the data generated </span><span class="No-Break"><span class="koboSpan" id="kobo.607.1">by it.</span></span></p>
<p><span class="koboSpan" id="kobo.608.1">In the </span><strong class="source-inline"><span class="koboSpan" id="kobo.609.1">DiaryComponent</span></strong><span class="koboSpan" id="kobo.610.1"> component, we will refactor the component to consume data from the resolver instead of fetching the information from the </span><span class="No-Break"><span class="koboSpan" id="kobo.611.1">service directly:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.612.1">
. </span><span class="koboSpan" id="kobo.612.2">. </span><span class="koboSpan" id="kobo.612.3">.
</span><span class="koboSpan" id="kobo.612.4">private route = inject(ActivatedRoute);
. </span><span class="koboSpan" id="kobo.612.5">. </span><span class="koboSpan" id="kobo.612.6">.
</span><span class="koboSpan" id="kobo.612.7">  ngOnInit(): void {
    this.route.data.subscribe(({ diaryApi }) =&gt; {
      this.exerciseList = diaryApi.items;
    });
  }
. </span><span class="koboSpan" id="kobo.612.8">. </span><span class="koboSpan" id="kobo.612.9">.</span></pre> <p><span class="koboSpan" id="kobo.613.1">The component is now consuming the </span><strong class="source-inline"><span class="koboSpan" id="kobo.614.1">data</span></strong><span class="koboSpan" id="kobo.615.1"> attribute of the route. </span><span class="koboSpan" id="kobo.615.2">It returns an observable that has an object with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.616.1">diaryApi</span></strong><span class="koboSpan" id="kobo.617.1"> attribute – the same one we configured in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.618.1">routes</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.619.1"> module.</span></span></p>
<p><span class="koboSpan" id="kobo.620.1">When we run our project again, we see that the behavior of the screen does not change externally; however, internally, we are fetching information from the gym diary before the component is loaded. </span><span class="koboSpan" id="kobo.620.2">This change in our example may have been imperceptible, but in a larger and more complex application, it could be the difference that you and your team are </span><span class="No-Break"><span class="koboSpan" id="kobo.621.1">looking for.</span></span></p>
<p><span class="koboSpan" id="kobo.622.1">It is important to bear </span><a id="_idIndexMarker346"/><span class="koboSpan" id="kobo.623.1">in mind that this will not speed up the request to the backend. </span><span class="koboSpan" id="kobo.623.2">It will take the same time as before, but the performance perception that your user will have may </span><span class="No-Break"><span class="koboSpan" id="kobo.624.1">be impacted.</span></span></p>
<p><span class="koboSpan" id="kobo.625.1">We will do this same treatment to load the diary entry edit page; in the same </span><strong class="source-inline"><span class="koboSpan" id="kobo.626.1">resolve</span></strong><span class="koboSpan" id="kobo.627.1"> file, we will create a </span><span class="No-Break"><span class="koboSpan" id="kobo.628.1">new function:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.629.1">
export const entryResolver: ResolveFn&lt;ExerciseSet&gt; = (route, state) =&gt; {
  const entryId = route.paramMap.get('id')!;
  const exerciseSetsService = inject(ExerciseSetsService);
  return exerciseSetsService.getItem(entryId);
};</span></pre> <p><span class="koboSpan" id="kobo.630.1">The function injects the service but, this time, we are using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.631.1">route</span></strong><span class="koboSpan" id="kobo.632.1"> parameter to extract the </span><strong class="source-inline"><span class="koboSpan" id="kobo.633.1">id</span></strong><span class="koboSpan" id="kobo.634.1"> of the entry to load it. </span><span class="koboSpan" id="kobo.634.2">This parameter is offered by Angular so that you can extract any attribute from the route in which you will configure </span><span class="No-Break"><span class="koboSpan" id="kobo.635.1">the resolver.</span></span></p>
<p><span class="koboSpan" id="kobo.636.1">In the </span><strong class="source-inline"><span class="koboSpan" id="kobo.637.1">route</span></strong><span class="koboSpan" id="kobo.638.1"> module, we will add the </span><strong class="source-inline"><span class="koboSpan" id="kobo.639.1">resolve</span></strong><span class="koboSpan" id="kobo.640.1"> function to the </span><span class="No-Break"><span class="koboSpan" id="kobo.641.1">edit route:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.642.1">
{
  path: 'entry/:id',
  component: NewEntryFormReactiveComponent,
  title: 'Edit Entry',
  resolve: { entry: entryResolver },
},</span></pre> <p><span class="koboSpan" id="kobo.643.1">Now, we need to </span><a id="_idIndexMarker347"/><span class="koboSpan" id="kobo.644.1">refactor the </span><a id="_idIndexMarker348"/><span class="koboSpan" id="kobo.645.1">component to use the route </span><span class="No-Break"><span class="koboSpan" id="kobo.646.1">guard information:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.647.1">
  private route = inject(ActivatedRoute);
. </span><span class="koboSpan" id="kobo.647.2">. </span><span class="koboSpan" id="kobo.647.3">.
</span><span class="koboSpan" id="kobo.647.4">  ngOnInit(): void {
    if (this.entryId) {
      this.route.data.subscribe(({ entry }) =&gt; {
        this.updateForm(entry);
      });
    }
  }</span></pre> <p><span class="koboSpan" id="kobo.648.1">In the same way as we did with the diary page, here, we are replacing the consu</span><a id="_idTextAnchor223"/><span class="koboSpan" id="kobo.649.1">mption of the service with the consumption of </span><span class="No-Break"><span class="koboSpan" id="kobo.650.1">the route.</span></span></p>
<h1 id="_idParaDest-112"><a id="_idTextAnchor224"/><span class="koboSpan" id="kobo.651.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.652.1">In this chapter, we worked with routes and their resources to guide and organize user flows in our application. </span><span class="koboSpan" id="kobo.652.2">We learned about the router concept in the Angular framework and created an error page in case a user uses a route that does not exist. </span><span class="koboSpan" id="kobo.652.3">We created our edit diary entry page by reusing a form and, with the dynamic route feature, we learned how to capture route data for </span><span class="No-Break"><span class="koboSpan" id="kobo.653.1">page setup.</span></span></p>
<p><span class="koboSpan" id="kobo.654.1">Finally, we learned about the route guards feature, created our simplified login flow, and saw how to optimize the user experience by loading the backend information before the page loads using the guard </span><span class="No-Break"><span class="koboSpan" id="kobo.655.1">resolve feature.</span></span></p>
<p><span class="koboSpan" id="kobo.656.1">In the next chapter, we will learn how to use a resource to streamline our requests to the backend using the interceptor </span><span class="No-Break"><span class="koboSpan" id="kobo.657.1">design pattern.</span></span></p>
</div>
</body></html>