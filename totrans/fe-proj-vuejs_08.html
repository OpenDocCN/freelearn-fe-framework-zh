<html><head></head><body>
		<div>
			<div id="_idContainer262" class="Content">
			</div>
		</div>
		<div id="_idContainer263" class="Content">
			<h1 id="_idParaDest-187"><a id="_idTextAnchor263"/>8. The State of Vue.js State Management</h1>
		</div>
		<div id="_idContainer298" class="Content">
			<p class="callout-heading"><a id="_idTextAnchor264"/>Overview</p>
			<p class="callout">By the end of this chapter, you will be able to use and contrast approaches for sharing state and holding global state in a Vue.js application. To this end, you will use a shared ancestor to hold state required by components that do not have a parent-child relationship (sibling components). You will also gain familiarity with an event bus in the context of a Vue.js application. As we proceed, you will understand how and when to leverage Vuex for state management, and its strengths and weaknesses when compared to other solutions such as event buses or Redux. Towards the end of the chapter, you will become comfortable with selecting which parts of state should be stored globally and locally and how to combine them to build a scalable and performant Vue.js application.</p>
			<p class="callout">In this chapter, we will look at the state of Vue.js state management, from local state to component-based state sharing patterns to more advanced concepts such as leveraging event buses or global state management solutions like Vuex.</p>
			<h1 id="_idParaDest-188"><a id="_idTextAnchor265"/>Introduction</h1>
			<p>In this chapter, we'll explore the concept of state management in Vue.</p>
			<p>In previous chapters, we have seen how to use local state and <strong class="source-inline">props</strong> to hold state and share it in a <strong class="bold">parent-child</strong> component hierarchy.</p>
			<p>We will begin by showing how to leverage <strong class="source-inline">state</strong>, <strong class="source-inline">props</strong>, and <strong class="source-inline">events</strong> to share state between components that are not in a <strong class="bold">parent-child</strong> configuration. These types of components are called <strong class="bold">siblings</strong>.</p>
			<div>
				<div id="_idContainer264" class="IMG---Figure">
					<img src="image/B15218_08_01.jpg" alt="Figure 8.1: Child 1 and Child 2 are &quot;sibling&quot; components&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.1: Child 1 and Child 2 are "sibling" components</p>
			<p>Throughout the chapter, we will be building a <strong class="bold">profile card generator</strong> app that demonstrates how state flows down the component tree as props in an application, and how updates are propagated back up using events, event buses, and store updates.</p>
			<p>Given that we want to build a <strong class="bold">profile card generator</strong>, we can break the application down into three sections: a <strong class="source-inline">Header</strong>, where we will have global controls and display the title of the page; a <strong class="source-inline">ProfileForm</strong>, where we will capture data; and finally, a <strong class="source-inline">ProfileDisplay</strong>, where we will display the profile card.</p>
			<div>
				<div id="_idContainer265" class="IMG---Figure">
					<img src="image/B15218_08_02.jpg" alt="Figure 8.2: Representation of a profile card application component tree&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.2: Representation of a profile card application component tree</p>
			<p>We have now seen how to reason about a component tree and how our application can be structured in a component tree.</p>
			<h1 id="_idParaDest-189">Ho<a id="_idTextAnchor266"/>lding State in a Common Ancestor Component</h1>
			<p>To hold state only with component state and props and update it with events, we will store it in the nearest common ancestor component.</p>
			<p>State is propagated only through <strong class="source-inline">props</strong> and is updated only through <strong class="source-inline">events</strong>. In this case, all the <strong class="source-inline">state</strong> will live in a shared ancestor of the components that require state. The App component, since it is the root component, is a good default for holding shared state.</p>
			<div>
				<div id="_idContainer266" class="IMG---Figure">
					<img src="image/B15218_08_03.jpg" alt="Figure 8.3: Common ancestor component holds state with props and event propagation&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.3: Common ancestor component holds state with props and event propagation</p>
			<p>To change the <strong class="source-inline">state</strong>, a component needs to emit an <strong class="source-inline">event</strong> up to the component holding state (the shared ancestor). The shared ancestor needs to update <strong class="source-inline">state</strong> according to the event data and type. This in turn causes a re-render, during which the ancestor component passes updated <strong class="source-inline">props</strong> to the component reading the <strong class="source-inline">state</strong>.</p>
			<div>
				<div id="_idContainer267" class="IMG---Figure">
					<img src="image/B15218_08_04.jpg" alt="Figure 8.4: Updating a sibling component when the ancestor holds state&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.4: Updating a sibling component when the ancestor holds state</p>
			<p>To build a header, we need to create an <strong class="source-inline">AppHeader</strong> component in the <strong class="source-inline">AppHeader.vue</strong> file, which will contain a template and an <strong class="source-inline">h2</strong> heading with TailwindCSS classes:</p>
			<p class="source-code">&lt;template&gt;</p>
			<p class="source-code">  &lt;header class="w-full block p-4 border-b bg-blue-300     border-gray-700"&gt;</p>
			<p class="source-code">    &lt;h2 class="text-xl text-gray-800"&gt;Profile Card Generator&lt;/h2&gt;</p>
			<p class="source-code">  &lt;/header&gt;</p>
			<p class="source-code">&lt;/template&gt;</p>
			<p>We will then import it, register it, and render it in the <strong class="source-inline">App.vue</strong> file:</p>
			<p class="source-code">&lt;template&gt;</p>
			<p class="source-code">  &lt;div id="app"&gt;</p>
			<p class="source-code">    &lt;AppHeader /&gt;</p>
			<p class="source-code">  &lt;/div&gt;</p>
			<p class="source-code">&lt;/template&gt;</p>
			<p class="source-code">&lt;script&gt;</p>
			<p class="source-code">import AppHeader from './components/AppHeader.vue'</p>
			<p class="source-code">export default {</p>
			<p class="source-code">  components: {</p>
			<p class="source-code">    AppHeader</p>
			<p class="source-code">  }</p>
			<p class="source-code">}</p>
			<p class="source-code">&lt;/script&gt;</p>
			<p>The output of the preceding code will be as follows:</p>
			<div>
				<div id="_idContainer268" class="IMG---Figure">
					<img src="image/B15218_08_05.jpg" alt="Figure 8.5: AppHeader displayed in the profile card generator&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.5: AppHeader displayed in the profile card generator</p>
			<p>We will similarly create an <strong class="source-inline">AppProfileForm</strong> file:</p>
			<p class="source-code">&lt;template&gt;</p>
			<p class="source-code">  &lt;section class="md:w-2/3 h-64 bg-red-200 flex"&gt;</p>
			<p class="source-code">  &lt;!-- Inputs --&gt;</p>
			<p class="source-code">  &lt;/section&gt;</p>
			<p class="source-code">&lt;/template&gt;</p>
			<p>We will create an <strong class="source-inline">AppProfileDisplay</strong> file with the following initial content:</p>
			<p class="source-code">&lt;template&gt;</p>
			<p class="source-code">  &lt;section class="md:w-1/3 h-64 bg-blue-200 flex"&gt;</p>
			<p class="source-code">  &lt;!-- Profile Card --&gt;</p>
			<p class="source-code">  &lt;/section&gt;</p>
			<p class="source-code">&lt;/template&gt;</p>
			<p>Both of our containers (<strong class="source-inline">AppProfileForm</strong> and <strong class="source-inline">AppProfileDisplay</strong>) can now be imported and rendered in <strong class="source-inline">App</strong>:</p>
			<p class="source-code">&lt;template&gt;</p>
			<p class="source-code">    &lt;!-- rest of template, including AppHeader --&gt;</p>
			<p class="source-code">    &lt;div class="flex flex-col md:flex-row"&gt;</p>
			<p class="source-code">      &lt;AppProfileForm /&gt;</p>
			<p class="source-code">      &lt;AppProfileDisplay /&gt;</p>
			<p class="source-code">    &lt;/div&gt;</p>
			<p class="source-code">    &lt;!-- rest of template --&gt;</p>
			<p class="source-code">&lt;/template&gt;</p>
			<p class="source-code">&lt;script&gt;</p>
			<p class="source-code">// other imports</p>
			<p class="source-code">import AppProfileForm from './components/AppProfileForm.vue'</p>
			<p class="source-code">import AppProfileDisplay from './components/AppProfileDisplay.vue'</p>
			<p class="source-code">export default {</p>
			<p class="source-code">  components: {</p>
			<p class="source-code">    // other component definitions</p>
			<p class="source-code">    AppProfileForm,</p>
			<p class="source-code">    AppProfileDisplay,</p>
			<p class="source-code">  }</p>
			<p class="source-code">}</p>
			<p class="source-code">&lt;/script&gt;</p>
			<p>The output of the preceding code will be as follows:</p>
			<div>
				<div id="_idContainer269" class="IMG---Figure">
					<img src="image/B15218_08_06.jpg" alt="Figure 8.6: App skeleton with AppHeader, AppProfileForm, and AppProfileDisplay&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.6: App skeleton with AppHeader, AppProfileForm, and AppProfileDisplay</p>
			<p>To add a form field, in this case <strong class="source-inline">name</strong>, we will start by adding an input to <strong class="source-inline">AppProfileForm</strong>:</p>
			<p class="source-code">&lt;template&gt;</p>
			<p class="source-code">  &lt;section class="md:w-2/3 h-64 bg-red-200 flex flex-col p-12     items-center"&gt;</p>
			<p class="source-code">    &lt;!-- Inputs --&gt;</p>
			<p class="source-code">    &lt;div class="flex flex-col"&gt;</p>
			<p class="source-code">      &lt;label class="flex text-gray-800 mb-2" for="name"&gt;Name</p>
			<p class="source-code">      &lt;/label&gt;</p>
			<p class="source-code">      &lt;input</p>
			<p class="source-code">        id="name"</p>
			<p class="source-code">        type="text"</p>
			<p class="source-code">        name="name"</p>
			<p class="source-code">        class="border-2 border-solid border-blue-200 rounded           px-2 py-1"</p>
			<p class="source-code">      /&gt;</p>
			<p class="source-code">    &lt;/div&gt;</p>
			<p class="source-code">  &lt;/section&gt;</p>
			<p class="source-code">&lt;/template&gt;</p>
			<p>The preceding code will display as follows:</p>
			<div>
				<div id="_idContainer270" class="IMG---Figure">
					<img src="image/B15218_08_07.jpg" alt="Figure 8.7: AppProfileForm with a name field and label&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.7: AppProfileForm with a name field and label</p>
			<p>To keep track of the name input data, we will add a two-way binding to it using <strong class="source-inline">v-model</strong> and set a <strong class="source-inline">name</strong> property in the component's <strong class="source-inline">data</strong> initializer:</p>
			<p class="source-code">&lt;template&gt;</p>
			<p class="source-code">      &lt;!-- rest of the template --&gt;</p>
			<p class="source-code">      &lt;input</p>
			<p class="source-code">        id="name"</p>
			<p class="source-code">        type="text"</p>
			<p class="source-code">        name="name"</p>
			<p class="source-code">        class="border-2 border-solid border-blue-200 rounded           px-2 py-1"</p>
			<p class="source-code">        v-model="name"</p>
			<p class="source-code">      /&gt;</p>
			<p class="source-code">      &lt;!-- rest of the template --&gt;</p>
			<p class="source-code">&lt;/template&gt;</p>
			<p class="source-code">&lt;script&gt;</p>
			<p class="source-code">export default {</p>
			<p class="source-code">  data() {</p>
			<p class="source-code">    return {</p>
			<p class="source-code">      name: '',</p>
			<p class="source-code">    }</p>
			<p class="source-code">  }</p>
			<p class="source-code">}</p>
			<p class="source-code">&lt;/script&gt;</p>
			<p>We will also need a <strong class="source-inline">submit</strong> button that, on click, sends the form data to the parent by emitting a <strong class="source-inline">submit</strong> event with the form's contents:</p>
			<p class="source-code">&lt;template&gt;</p>
			<p class="source-code">    &lt;!-- rest of template --&gt;</p>
			<p class="source-code">    &lt;div class="flex flex-row mt-12"&gt;</p>
			<p class="source-code">      &lt;button type="submit" @click="submitForm()"&gt;Submit&lt;/button&gt;</p>
			<p class="source-code">    &lt;/div&gt;</p>
			<p class="source-code">    &lt;!-- rest of template --&gt;</p>
			<p class="source-code">&lt;/template&gt;</p>
			<p class="source-code">&lt;script&gt;</p>
			<p class="source-code">export default {</p>
			<p class="source-code">  // rest of component</p>
			<p class="source-code">  methods: {</p>
			<p class="source-code">    submitForm() {</p>
			<p class="source-code">      this.$emit('submit', {</p>
			<p class="source-code">        name: this.name</p>
			<p class="source-code">      })</p>
			<p class="source-code">    }</p>
			<p class="source-code">  }</p>
			<p class="source-code">}</p>
			<p class="source-code">&lt;/script&gt;</p>
			<p>This will display as follows:</p>
			<div>
				<div id="_idContainer271" class="IMG---Figure">
					<img src="image/B15218_08_08.jpg" alt="Figure 8.8: AppProfileForm with a wired-up submit button&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.8: AppProfileForm with a wired-up submit button</p>
			<p>The next step is to store the form's state in the <strong class="source-inline">App</strong> component. It is a good candidate for storing form state since it is a common ancestor to <strong class="source-inline">AppProfileForm</strong> and <strong class="source-inline">AppProfileDisplay</strong>.</p>
			<p>To begin with, we will need a <strong class="source-inline">formData</strong> attribute returned from <strong class="source-inline">data()</strong>. We will also need a way to update <strong class="source-inline">formData</strong>. Hence, we will add an <strong class="source-inline">update(formData)</strong> method:</p>
			<p class="source-code">&lt;script&gt;</p>
			<p class="source-code">export default {</p>
			<p class="source-code">  // rest of component</p>
			<p class="source-code">  data() {</p>
			<p class="source-code">    return {</p>
			<p class="source-code">      formData: {}</p>
			<p class="source-code">    }</p>
			<p class="source-code">  },</p>
			<p class="source-code">  methods: {</p>
			<p class="source-code">    update(formData) {</p>
			<p class="source-code">      this.formData = formData</p>
			<p class="source-code">    }</p>
			<p class="source-code">  }</p>
			<p class="source-code">  // rest of component</p>
			<p class="source-code">}</p>
			<p class="source-code">&lt;/script&gt;</p>
			<p>Next, we need to bind <strong class="source-inline">update()</strong> to the <strong class="source-inline">submit</strong> event emitted by <strong class="source-inline">AppProfileForm</strong>. We will do this using the <strong class="source-inline">@submit</strong> shorthand and with the magic event object notation as <strong class="source-inline">update($event)</strong>:</p>
			<p class="source-code">&lt;template&gt;</p>
			<p class="source-code">    &lt;!-- rest of template --&gt;</p>
			<p class="source-code">      &lt;AppProfileForm @submit="update($event)" /&gt;</p>
			<p class="source-code">    &lt;!-- rest of template --&gt;</p>
			<p class="source-code">&lt;/template&gt;</p>
			<p>To display the name inside of <strong class="source-inline">AppProfileDisplay</strong>, we will need to add <strong class="source-inline">formData</strong> as a prop:</p>
			<p class="source-code">&lt;script&gt;</p>
			<p class="source-code">export default {</p>
			<p class="source-code">  props: {</p>
			<p class="source-code">    formData: {</p>
			<p class="source-code">      type: Object,</p>
			<p class="source-code">      default() {</p>
			<p class="source-code">        return {}</p>
			<p class="source-code">      }</p>
			<p class="source-code">    }</p>
			<p class="source-code">  }</p>
			<p class="source-code">}</p>
			<p class="source-code">&lt;/script&gt;</p>
			<p>We will also need to display the name using <strong class="source-inline">formData.name</strong>. We will add a <strong class="source-inline">p-12</strong> class to the container to improve the appearance of the component:</p>
			<p class="source-code">&lt;template&gt;</p>
			<p class="source-code">  &lt;section class="md:w-1/3 h-64 bg-blue-200 flex p-12"&gt;</p>
			<p class="source-code">    &lt;!-- Profile Card --&gt;</p>
			<p class="source-code">    &lt;h3 class="font-bold font-lg"&gt;{{ formData.name }}&lt;/h3&gt;</p>
			<p class="source-code">  &lt;/section&gt;</p>
			<p class="source-code">&lt;/template&gt;</p>
			<p>Finally, <strong class="source-inline">App</strong> needs to pass <strong class="source-inline">formData</strong> to <strong class="source-inline">AppProfileDisplay</strong> as a prop:</p>
			<p class="source-code">&lt;template&gt;</p>
			<p class="source-code">    &lt;!-- rest of template --&gt;</p>
			<p class="source-code">      &lt;AppProfileDisplay :form-data="formData" /&gt;</p>
			<p class="source-code">    &lt;!-- rest of template --&gt;</p>
			<p class="source-code">&lt;/template&gt;</p>
			<p>We are now able to update the name on the form. When you click on the <strong class="source-inline">Submit</strong> button, it will show the name in the profile card display as follows:</p>
			<div>
				<div id="_idContainer272" class="IMG---Figure">
					<img src="image/B15218_08_09.jpg" alt="Figure 8.9: App storing state, passing as props to AppProfileDisplay&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.9: App storing state, passing as props to AppProfileDisplay</p>
			<p>We have now seen how to store shared state on the <strong class="source-inline">App</strong> component and how to update it from the <strong class="source-inline">AppProfileForm</strong> and display it in <strong class="source-inline">AppProfileDisplay</strong>.</p>
			<p>In the next topic, we will see how to add an additional field to the profile card generator.</p>
			<h2 id="_idParaDest-190">Exercise <a id="_idTextAnchor267"/>8.01: Adding an Occupation Field to the Profile Card Generator</h2>
			<p>Following on from the example of storing the <strong class="source-inline">name</strong> shared state, another field that would be interesting to capture in a <strong class="source-inline">profile card</strong> is the occupation of the individual. To this end, we will add an <strong class="source-inline">occupation</strong> field to <strong class="source-inline">AppProfileForm</strong> to capture this extra piece of state, and we'll display it in <strong class="source-inline">AppProfileDisplay</strong>.</p>
			<p>To access the code files for this exercise, refer to <a href="https://packt.live/32VUbuH">https://packt.live/32VUbuH</a>.</p>
			<ol>
				<li>The first place to start is by adding the new <strong class="source-inline">occupation</strong> field to <strong class="source-inline">src/components/AppProfileForm</strong>. We'll also take this opportunity to get rid of the <strong class="source-inline">h-64</strong> and <strong class="source-inline">bg-red-200</strong> classes from the <strong class="source-inline">section</strong> element (if they're present), which will mean the form displays without a background and without a set height:<p class="source-code">&lt;template&gt;</p><p class="source-code">  &lt;section class="md:w-2/3 flex flex-col p-12 items-center"&gt;</p><p class="source-code">    &lt;!-- rest of template --&gt;</p><p class="source-code">    &lt;div class="flex flex-col mt-2"&gt;</p><p class="source-code">      &lt;label class="flex text-gray-800 mb-2" for="occupation"&gt;Occupation&lt;/label&gt;</p><p class="source-code">      &lt;input</p><p class="source-code">        id="occupation"</p><p class="source-code">        type="text"</p><p class="source-code">        name="occupation"</p><p class="source-code">        class="border-2 border-solid border-blue-200 rounded           px-2 py-1"</p><p class="source-code">      /&gt;</p><p class="source-code">    &lt;/div&gt;</p><p class="source-code">    &lt;!-- rest of template --&gt;</p><p class="source-code">  &lt;/section&gt;</p><p class="source-code">&lt;/template&gt;</p><p>The output of the preceding code will be as follows:</p><div id="_idContainer273" class="IMG---Figure"><img src="image/B15218_08_10.jpg" alt="Figure 8.10: AppProfileForm with the new Occupation field&#13;&#10;"/></div><p class="figure-caption">Figure 8.10: AppProfileForm with the new Occupation field</p></li>
				<li>To track the value of <strong class="source-inline">occupation</strong> with a two-way data binding, we will add a new property to the output of the <strong class="source-inline">data()</strong> property:<p class="source-code">&lt;script&gt;</p><p class="source-code">export default {</p><p class="source-code">  // rest of component</p><p class="source-code">  data() {</p><p class="source-code">    return {</p><p class="source-code">      // other data properties</p><p class="source-code">      occupation: '',</p><p class="source-code">    }</p><p class="source-code">  },</p><p class="source-code">  // rest of component</p><p class="source-code">}</p></li>
				<li>We will now apply a two-way data binding from the <strong class="source-inline">occupation</strong> reactive data property to the <strong class="source-inline">occupation</strong> input using <strong class="source-inline">v-model</strong>:<p class="source-code">&lt;template&gt;</p><p class="source-code">  &lt;!-- rest of template --&gt;</p><p class="source-code">      &lt;input</p><p class="source-code">        id="occupation"</p><p class="source-code">        type="text"</p><p class="source-code">        name="occupation"</p><p class="source-code"><strong class="bold">        v-model="occupation"</strong></p><p class="source-code">        class="border-2 border-solid border-blue-200 rounded           px-2 py-1"</p><p class="source-code">      /&gt;</p><p class="source-code">  &lt;!-- rest of template --&gt;</p><p class="source-code">&lt;/template&gt;</p></li>
				<li>For the <strong class="source-inline">occupation</strong> value to be transmitted when <strong class="source-inline">submit</strong> is clicked, we will need to add it to the <strong class="source-inline">submitForm</strong> method as a property of the <strong class="source-inline">submit</strong> event payload:<p class="source-code">&lt;script&gt;</p><p class="source-code">export default {</p><p class="source-code">  // rest of component</p><p class="source-code">  methods: {</p><p class="source-code">    submitForm() {</p><p class="source-code">      this.$emit('submit', {</p><p class="source-code">        // rest of event payload</p><p class="source-code">        occupation: this.occupation</p><p class="source-code">      })</p><p class="source-code">    }</p><p class="source-code">  }</p><p class="source-code">}</p><p class="source-code">&lt;/script&gt;</p></li>
				<li>The final step of adding this field is to display it in the <strong class="source-inline">AppProfileDisplay</strong> component. We add a paragraph with a couple of styling classes. We'll also take this opportunity to remove the <strong class="source-inline">h-64</strong> and <strong class="source-inline">bg-blue-200</strong> classes from the container (if they are present):<p class="source-code">&lt;template&gt;</p><p class="source-code">  &lt;section class="md:w-1/3 flex flex-col p-12"&gt;</p><p class="source-code">    &lt;!-- rest of template --&gt;</p><p class="source-code">    &lt;p class="mt-2"&gt;{{ formData.occupation }}&lt;/p&gt;</p><p class="source-code">  &lt;/section&gt;</p><p class="source-code">&lt;/template&gt;</p><p>Our browser should look as follows:</p><div id="_idContainer274" class="IMG---Figure"><img src="image/B15218_08_11.jpg" alt="Figure 8.11: AppProfileForm&#13;&#10;"/></div></li>
			</ol>
			<p class="figure-caption">Figure 8.11: AppProfileForm</p>
			<p>As we have just seen, adding a new field using the common ancestor to manage state is a case of passing the data up in an event and back down in the props to the reading component.</p>
			<p>We will now see how we can reset the form and profile display with a <strong class="source-inline">Clear</strong> button.</p>
			<h2 id="_idParaDest-191">Exercise 8.<a id="_idTextAnchor268"/>02: Adding a Clear Button to the Profile Card Generator </h2>
			<p>When creating a new profile with our application, it is useful to be able to reset the profile. To this end, we will add a <strong class="source-inline">Clear</strong> button.</p>
			<p>A <strong class="source-inline">Clear</strong> button should reset the data in the form but also in <strong class="source-inline">AppProfileDisplay</strong>. To access the code files for this exercise, refer to <a href="https://packt.live/2INsE7R">https://packt.live/2INsE7R</a>.</p>
			<p>Now let's look at the steps to perform this exercise:</p>
			<ol>
				<li value="1">We want a <strong class="source-inline">Clear</strong> button to be displayed. We will take this opportunity to improve the styling of both the <strong class="source-inline">Clear</strong> and <strong class="source-inline">Submit</strong> buttons (in <strong class="source-inline">src/components/AppProfileForm.vue</strong>):<p class="source-code">&lt;template&gt;</p><p class="source-code">  &lt;!-- rest of template --&gt;</p><p class="source-code">    &lt;div class="w-1/2 flex md:flex-row mt-12"&gt;</p><p class="source-code">      &lt;button</p><p class="source-code">        class="flex md:w-1/2 justify-center"</p><p class="source-code">        type="button"</p><p class="source-code">      &gt;</p><p class="source-code">        Clear</p><p class="source-code">      &lt;/button&gt;</p><p class="source-code">      &lt;button</p><p class="source-code">        class="flex md:w-1/2 justify-center"</p><p class="source-code">        type="submit"</p><p class="source-code">        @click="submitForm()"</p><p class="source-code">      &gt;</p><p class="source-code">        Submit</p><p class="source-code">      &lt;/button&gt;</p><p class="source-code">    &lt;/div&gt;</p><p class="source-code">  &lt;!-- rest of template --&gt;</p><p class="source-code">&lt;/template&gt;</p></li>
				<li>To clear the form, we need to reset the <strong class="source-inline">name</strong> and <strong class="source-inline">occupation</strong> fields. We can create a <strong class="source-inline">clear</strong> method that will do this (in <strong class="source-inline">src/components/AppProfileForm.vue</strong>):<p class="source-code">&lt;script&gt;</p><p class="source-code">export default {</p><p class="source-code">  // rest of the component</p><p class="source-code">  methods: {</p><p class="source-code">    // other methods</p><p class="source-code">    clear() {</p><p class="source-code">      this.name = ''</p><p class="source-code">      this.occupation = ''</p><p class="source-code">    }</p><p class="source-code">  }</p><p class="source-code">  // rest of the component</p><p class="source-code">}</p></li>
				<li>We want to bind the <strong class="source-inline">clear</strong> method to <strong class="source-inline">click</strong> events on the <strong class="source-inline">Clear</strong> button to reset the form (in <strong class="source-inline">src/components/AppProfileForm.vue</strong>):<p class="source-code">&lt;template&gt;</p><p class="source-code">  &lt;!-- rest of template --&gt;</p><p class="source-code">      &lt;button</p><p class="source-code">        class="flex md:w-1/2 justify-center"</p><p class="source-code"><strong class="bold">        type="button"</strong></p><p class="source-code"><strong class="bold">        @click="clear()"</strong></p><p class="source-code">      &gt;</p><p class="source-code">        Clear</p><p class="source-code">      &lt;/button&gt;</p><p class="source-code">  &lt;!-- rest of template --&gt;</p><p class="source-code">&lt;/template&gt;</p><p>Thus, we can now enter data into the form and submit it as per the following screenshot:</p><div id="_idContainer275" class="IMG---Figure"><img src="image/B15218_08_12.jpg" alt="Figure 8.12: AppProfileForm with Name and Occupation fields filled in&#13;&#10;"/></div><p class="figure-caption">Figure 8.12: AppProfileForm with Name and Occupation fields filled in</p><p>On clicking the <strong class="source-inline">Submit</strong> button, it will propagate data to <strong class="source-inline">AppProfileDisplay</strong> as follows:</p><div id="_idContainer276" class="IMG---Figure"><img src="image/B15218_08_13.jpg" alt="Figure 8.13: AppProfileForm and AppProfileDisplay with data filled in &#13;&#10;and submitted with a Clear button&#13;&#10;"/></div><p class="figure-caption">Figure 8.13: AppProfileForm and AppProfileDisplay with data filled in and submitted with a Clear button</p><p>Unfortunately, <strong class="source-inline">AppProfileDisplay</strong> still has stale data, as shown in the following screenshot:</p><div id="_idContainer277" class="IMG---Figure"><img src="image/B15218_08_14.jpg" alt="Figure 8.14: AppProfileForm and AppProfileDisplay with only AppProfileForm cleared AppProfileDisplay still has stale data&#13;&#10;"/></div><p class="figure-caption">Figure 8.14: AppProfileForm and AppProfileDisplay with only AppProfileForm cleared AppProfileDisplay still has stale data</p></li>
				<li>To also clear the contents of <strong class="source-inline">AppProfileDisplay</strong>, we will need to update <strong class="source-inline">formData</strong> in <strong class="source-inline">App.vue</strong> by emitting a <strong class="source-inline">submit</strong> event with an empty payload in <strong class="source-inline">src/components/AppProfileForm.vue</strong>:<p class="source-code">&lt;script&gt;</p><p class="source-code">export default {</p><p class="source-code">  // rest of component</p><p class="source-code">  methods: {</p><p class="source-code">    // other methods</p><p class="source-code">    clear() {</p><p class="source-code">      // rest of the clear() method</p><p class="source-code">      this.$emit('submit', {})</p><p class="source-code">    }</p><p class="source-code">  }</p><p class="source-code">}</p><p class="source-code">&lt;/script&gt;</p><p>When we fill out the form and submit it, it will look as follows:</p><div id="_idContainer278" class="IMG---Figure"><img src="image/B15218_08_15.jpg" alt="Figure 8.15: AppProfileForm and AppProfileDisplay with data filled out &#13;&#10;and submitted with a Clear button&#13;&#10;"/></div></li>
			</ol>
			<p class="figure-caption">Figure 8.15: AppProfileForm and AppProfileDisplay with data filled out and submitted with a Clear button</p>
			<p>We can click <strong class="source-inline">Clear</strong> and reset the data displayed in both <strong class="source-inline">AppProfileDisplay</strong> and <strong class="source-inline">AppProfileForm</strong> as per the following screenshot:</p>
			<div>
				<div id="_idContainer279" class="IMG---Figure">
					<img src="image/B15218_08_16.jpg" alt="Figure 8.16: AppProfileForm and AppProfileDisplay after data &#13;&#10;is cleared (using the Clear button)&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.16: AppProfileForm and AppProfileDisplay after data is cleared (using the Clear button)</p>
			<p>We have now seen how to set up communication between sibling components through a common ancestor.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">There is quite a bit of bookkeeping and mental work required to keep track of all the bits of state that need to stay in sync across the application.</p>
			<p>In the next section, we will look at what an event bus is and how it can help alleviate some of the issues we have encountered.</p>
			<h2 id="_idParaDest-192"><a id="_idTextAnchor269"/>The Event Bus</h2>
			<p>Th<a id="_idTextAnchor270"/>e second scenario we will look at is when there is a global event bus.</p>
			<p>The <strong class="bold">event bus</strong> is an entity on which we can publish and subscribe to events. This allows all the different parts of the application to hold their own state and keep it in sync without passing events up to or props down from the common ancestors.</p>
			<div>
				<div id="_idContainer280" class="IMG---Figure">
					<img src="image/B15218_08_17.jpg" alt="Figure 8.17: Sequence diagram of a reader component and an updating component leveraging an event bus&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.17: Sequence diagram of a reader component and an updating component leveraging an event bus</p>
			<p>To provide this, our event bus needs to provide a <strong class="source-inline">subscribe</strong> method and <strong class="source-inline">publish</strong> method. It's also useful to be able to unsubscribe.</p>
			<p>The Vue instance is an event bus since it provides three crucial operations: <strong class="bold">publish</strong>, <strong class="bold">subscribe</strong>, and <strong class="bold">unsubscribe</strong>. We can create an event bus as follows in the <strong class="source-inline">main.js</strong> file:</p>
			<p class="source-code">import Vue from 'vue'</p>
			<p class="source-code">const eventBus = new Vue()</p>
			<p>Our event bus has a few methods, namely <strong class="source-inline">$on</strong>, which is the <strong class="bold">subscribe</strong> operation, supporting two parameters—the name of the event to subscribe to (as a string) and a callback to which the event will be passed through a <strong class="bold">publish</strong> operation. We can add a subscriber using <strong class="source-inline">$on(eventName, callback)</strong>:</p>
			<p class="source-code">// rest of main.js file</p>
			<p class="source-code">console.log('Registering subscriber to "fieldChanged"')</p>
			<p class="source-code">eventBus.$on('fieldChanged', (event) =&gt; {</p>
			<p class="source-code">  console.log(`Received event: ${JSON.stringify(event)}`)</p>
			<p class="source-code">})</p>
			<p>We can then use <strong class="source-inline">$emit</strong> to trigger the subscriber callback. <strong class="source-inline">$emit(eventName, payload)</strong> is the event bus' <strong class="bold">publish</strong> operation. <strong class="source-inline">$emit</strong> supports two parameters—the name of the event (as a string) and a payload, which is optional and can be any object. It can be used as follows:</p>
			<p class="source-code">// rest of main.js file</p>
			<p class="source-code">console.log('Triggering "fieldChanged" for "name"')</p>
			<p class="source-code">eventBus.$emit('fieldChanged', {</p>
			<p class="source-code">  name: 'name',</p>
			<p class="source-code">  value: 'John Doe'</p>
			<p class="source-code">})</p>
			<p class="source-code">console.log('Triggering "fieldChanged" for "occupation"')</p>
			<p class="source-code">eventBus.$emit('fieldChanged', {</p>
			<p class="source-code">  name: 'occupation',</p>
			<p class="source-code">  value: 'Developer'</p>
			<p class="source-code">})</p>
			<p>Running this file in the browser will yield the following console output, where the subscriber is registered first, and the callback is then triggered on every <strong class="source-inline">$emit</strong>:</p>
			<div>
				<div id="_idContainer281" class="IMG---Figure">
					<img src="image/B15218_08_18.jpg" alt="Figure 18.18: Console output from a Vue.js instance being used as an event bus with a subscriber and two event publications&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 18.18: Console output from a Vue.js instance being used as an event bus with a subscriber and two event publications</p>
			<p><strong class="source-inline">$off</strong>, the <strong class="bold">unsubscribe</strong> operation, needs to be called with the same parameters with which the <strong class="bold">subscribe</strong> operation was called. Namely, two parameters, the event name (as a string) and the callback (which is run with the event as a parameter on every event publication). To use it properly, we need to register a subscriber using a reference to a function (as opposed to an inline anonymous function):</p>
			<p class="source-code">// rest of main.js, including other subscriber</p>
			<p class="source-code">const subscriber = (event) =&gt; {</p>
			<p class="source-code">  console.log('Subscriber 2 received event: ${JSON.stringify     (event)}')</p>
			<p class="source-code">}</p>
			<p class="source-code">console.log('Registering subscriber 2')</p>
			<p class="source-code">eventBus.$on('fieldChanged', subscriber)</p>
			<p class="source-code">console.log('Triggering "fieldChanged" for "company"')</p>
			<p class="source-code">eventBus.$emit('fieldChanged', {</p>
			<p class="source-code">  name: 'company',</p>
			<p class="source-code">  value: 'Developer'</p>
			<p class="source-code">})</p>
			<p class="source-code">console.log('Unregistering subscriber 2')</p>
			<p class="source-code">eventBus.$off('fieldChanged', subscriber)</p>
			<p class="source-code">console.log('Triggering "fieldChanged" for "occupation"')</p>
			<p class="source-code">eventBus.$emit('fieldChanged', {</p>
			<p class="source-code">  name: 'occupation',</p>
			<p class="source-code">  value: 'Senior Developer'</p>
			<p class="source-code">})</p>
			<p>Note that once <strong class="source-inline">$off</strong> is called, the second subscriber does not trigger but the initial one does. Your console output when run in the browser will look as follows:</p>
			<div>
				<div id="_idContainer282" class="IMG---Figure">
					<img src="image/B15218_08_19.jpg" alt="Figure 8.19: Console output showing the effect of $off&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.19: Console output showing the effect of $off</p>
			<p>By setting an event bus in the <strong class="source-inline">event-bus.js</strong> file, we can avoid the confusion of having to send data up to the <strong class="source-inline">App</strong> component (the common ancestor):</p>
			<p class="source-code">import Vue from 'vue'</p>
			<p class="source-code">export default new Vue()</p>
			<p>We can <strong class="source-inline">$emit</strong> <strong class="source-inline">profileUpdate</strong> events to the event bus from the <strong class="source-inline">AppProfileForm.vue</strong> file on form submission instead of using <strong class="source-inline">this.$emit</strong>:</p>
			<p class="source-code">&lt;script&gt;</p>
			<p class="source-code">import eventBus from '../event-bus'</p>
			<p class="source-code">export default {</p>
			<p class="source-code">  // rest of component</p>
			<p class="source-code">  methods: {</p>
			<p class="source-code">    submitForm() {</p>
			<p class="source-code">      eventBus.$emit('profileUpdate', {</p>
			<p class="source-code">        name: this.name,</p>
			<p class="source-code">        occupation: this.occupation</p>
			<p class="source-code">      })</p>
			<p class="source-code">    },</p>
			<p class="source-code">    clear() {</p>
			<p class="source-code">      this.name = ''</p>
			<p class="source-code">      this.occupation = ''</p>
			<p class="source-code">      eventBus.$emit('profileUpdate', {})</p>
			<p class="source-code">    }</p>
			<p class="source-code">  }</p>
			<p class="source-code">}</p>
			<p class="source-code">&lt;/script&gt;</p>
			<p>In the <strong class="source-inline">AppProfileDisplay.vue</strong> file, we can subscribe to <strong class="source-inline">profileUpdate</strong> events using <strong class="source-inline">$on</strong> and update <strong class="source-inline">formData</strong> in state. Note that we have removed the <strong class="source-inline">formData</strong> prop. We use the <strong class="source-inline">mounted()</strong> and <strong class="source-inline">beforeDestroy()</strong> hooks to subscribe to and unsubscribe from the event bus:</p>
			<p class="source-code">&lt;script&gt;</p>
			<p class="source-code">import eventBus from '../event-bus'</p>
			<p class="source-code">export default {</p>
			<p class="source-code">  mounted() {</p>
			<p class="source-code">    eventBus.$on('profileUpdate', this.update)</p>
			<p class="source-code">  },</p>
			<p class="source-code">  beforeDestroy() {</p>
			<p class="source-code">    eventBus.$off('profileUpdate', this.update)</p>
			<p class="source-code">  },</p>
			<p class="source-code">  data() {</p>
			<p class="source-code">    return {</p>
			<p class="source-code">      formData: {}</p>
			<p class="source-code">    }</p>
			<p class="source-code">  },</p>
			<p class="source-code">  methods: {</p>
			<p class="source-code">    update(formData) {</p>
			<p class="source-code">      this.formData = formData</p>
			<p class="source-code">    }</p>
			<p class="source-code">  }</p>
			<p class="source-code">}</p>
			<p class="source-code">&lt;/script&gt;</p>
			<p>The application works as expected. The following screenshot displays how your screen will look:</p>
			<div>
				<div id="_idContainer283" class="IMG---Figure">
					<img src="image/B15218_08_20.jpg" alt="Figure 8.20: AppProfileForm and AppProfileDisplay communicating with an event bus&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.20: AppProfileForm and AppProfileDisplay communicating with an event bus</p>
			<p>Since we have removed the <strong class="source-inline">formData</strong> prop for <strong class="source-inline">AppProfileDisplay</strong>, we can stop passing it in the <strong class="source-inline">App.vue</strong> file. Since we are not relying on <strong class="source-inline">submit</strong> events from <strong class="source-inline">AppProfileForm</strong>, we can also remove that binding:</p>
			<p class="source-code">&lt;template&gt;</p>
			<p class="source-code">  &lt;!-- rest of template --&gt;</p>
			<p class="source-code">      &lt;AppProfileForm /&gt;</p>
			<p class="source-code">      &lt;AppProfileDisplay /&gt;</p>
			<p class="source-code">  &lt;!-- rest of template --&gt;</p>
			<p class="source-code">&lt;/template&gt;</p>
			<p>We can also remove the unused <strong class="source-inline">App update</strong> and <strong class="source-inline">data</strong> methods from the <strong class="source-inline">App.vue</strong> file, which means the whole <strong class="source-inline">App</strong> script section is as follows (only registers <strong class="source-inline">components</strong>, not state or handlers):</p>
			<p class="source-code">&lt;script&gt;</p>
			<p class="source-code">import AppHeader from './components/AppHeader.vue'</p>
			<p class="source-code">import AppProfileForm from './components/AppProfileForm.vue'</p>
			<p class="source-code">import AppProfileDisplay from './components/AppProfileDisplay.vue'</p>
			<p class="source-code">export default {</p>
			<p class="source-code">  components: {</p>
			<p class="source-code">    AppHeader,</p>
			<p class="source-code">    AppProfileForm,</p>
			<p class="source-code">    AppProfileDisplay,</p>
			<p class="source-code">  }</p>
			<p class="source-code">}</p>
			<p class="source-code">&lt;/script&gt;</p>
			<p>We have now simplified the application data flow by using an event bus instead of storing shared state in a common ancestor component. Now, we will see how to move the <strong class="source-inline">Clear</strong> button to the application header in the profile card generator.</p>
			<h2 id="_idParaDest-193">Exercise 8.03: Moving <a id="_idTextAnchor271"/>the Clear Button to the Application Header Profile Card Generator</h2>
			<p>In our profile card generator application, the <strong class="source-inline">Clear</strong> button clears the state in the whole application. Its presence inside the form makes the <strong class="source-inline">Clear</strong> button's functionality unclear since it looks like it might only affect the form. </p>
			<p>To reflect the fact that the <strong class="source-inline">Clear</strong> button is global functionality, we will move it into the header.</p>
			<p>To access the code files for this exercise, refer to <a href="https://packt.live/2UzFvwZ">https://packt.live/2UzFvwZ</a>.</p>
			<p>The following steps will help us perform this exercise:</p>
			<ol>
				<li value="1">We will start by creating a <strong class="source-inline">button</strong> in <strong class="source-inline">src/components/AppHeader.vue</strong>:<p class="source-code">&lt;template&gt;</p><p class="source-code">  &lt;header class="w-full flex flex-row p-4 border-b     bg-blue-300 border-gray-700"&gt;</p><p class="source-code">    &lt;h2 class="text-xl flex text-gray-800"&gt;Profile Card       Generator&lt;/h2&gt;</p><p class="source-code">    &lt;button class="flex ml-auto text-gray-800 items-center"&gt;</p><p class="source-code">      Reset</p><p class="source-code">    &lt;/button&gt;</p><p class="source-code">  &lt;/header&gt;</p><p class="source-code">&lt;/template&gt;</p></li>
				<li>We can import the event bus and create a <strong class="source-inline">clear()</strong> handler in <strong class="source-inline">AppHeader</strong>, in which we'll trigger an update event with an empty payload (in <strong class="source-inline">src/components/AppHeader.vue</strong>):<p class="source-code">&lt;script&gt;</p><p class="source-code">import eventBus from '../event-bus'</p><p class="source-code">export default {</p><p class="source-code">  methods: {</p><p class="source-code">    clear() {</p><p class="source-code">      eventBus.$emit('profileUpdate', {})</p><p class="source-code">    }</p><p class="source-code">  }</p><p class="source-code">}</p><p class="source-code">&lt;/script&gt;</p></li>
				<li>We should bind the <strong class="source-inline">clear()</strong> function to the <strong class="source-inline">button</strong> (in <strong class="source-inline">src/components/AppHeader.vue</strong>):<p class="source-code">&lt;template&gt;</p><p class="source-code">  &lt;!-- rest of template --&gt;</p><p class="source-code">    &lt;button</p><p class="source-code">      @click="clear()"</p><p class="source-code">      class="flex ml-auto text-gray-800 items-center"</p><p class="source-code">    &gt;</p><p class="source-code">      Reset</p><p class="source-code">    &lt;/button&gt;</p><p class="source-code">  &lt;!-- rest of template --&gt;</p><p class="source-code">&lt;/template&gt;</p><p>At this stage, we should be able to fill out the form and a <strong class="source-inline">Reset</strong> button should appear as follows:</p><div id="_idContainer284" class="IMG---Figure"><img src="image/B15218_08_21.jpg" alt="Figure 8.21: Form filled out and the Reset button in the header&#13;&#10;"/></div><p class="figure-caption">Figure 8.21: Form filled out and the Reset button in the header</p><p>The <strong class="source-inline">Reset</strong> button only resets the <strong class="source-inline">AppProfileDisplay</strong> data:</p><div id="_idContainer285" class="IMG---Figure"><img src="image/B15218_08_22.jpg" alt="Figure 8.22: Form filled out, but the card section has been cleared&#13;&#10;"/></div><p class="figure-caption">Figure 8.22: Form filled out, but the card section has been cleared</p></li>
				<li>For <strong class="source-inline">Reset</strong> to clear the form, we need to subscribe to the <strong class="source-inline">profileUpdate</strong> events in the mounted life cycle method of <strong class="source-inline">AppProfileForm</strong> and react to said events by resetting the form (using <strong class="source-inline">handleProfileUpdate</strong>):<p class="source-code">&lt;script&gt;</p><p class="source-code">import eventBus from '../event-bus'</p><p class="source-code">export default {</p><p class="source-code">  mounted() {</p><p class="source-code">    eventBus.$on('profileUpdate', this.handleProfileUpdate)</p><p class="source-code">  },</p><p class="source-code">  beforeDestroy() {</p><p class="source-code">    eventBus.$off('profileUpdate', this.handleProfileUpdate)</p><p class="source-code">  },</p><p class="source-code">  // rest of component</p><p class="source-code">  methods: {</p><p class="source-code">    // other methods</p><p class="source-code">    handleProfileUpdate(formData) {</p><p class="source-code">      this.name = formData.name || ''</p><p class="source-code">      this.occupation = formData.occupation || ''</p><p class="source-code">    }</p><p class="source-code">  }</p><p class="source-code">}</p><p class="source-code">&lt;/script&gt;</p></li>
				<li>We also take this opportunity to delete the <strong class="source-inline">Clear</strong> button and adjust the <strong class="source-inline">Submit</strong> button:<p class="source-code">&lt;template&gt;</p><p class="source-code">  &lt;!-- rest of template --&gt;</p><p class="source-code">    &lt;div class="flex align-center mt-12"&gt;</p><p class="source-code">      &lt;button</p><p class="source-code">        type="submit"</p><p class="source-code">        @click="submitForm()"</p><p class="source-code">      &gt;</p><p class="source-code">        Submit</p><p class="source-code">      &lt;/button&gt;</p><p class="source-code">    &lt;/div&gt;</p><p class="source-code">  &lt;!-- rest of template --&gt;</p><p class="source-code">&lt;/template&gt;</p><p>The form looks as follows when it gets filled out and submitted:</p><div id="_idContainer286" class="IMG---Figure"><img src="image/B15218_08_23.jpg" alt="Figure 8.23: Filled-out and submitted form&#13;&#10;"/></div></li>
			</ol>
			<p class="figure-caption">Figure 8.23: Filled-out and submitted form</p>
			<p>Resetting the form now clears the form fields as well as <strong class="source-inline">AppProfileDisplay</strong>:</p>
			<div>
				<div id="_idContainer287" class="IMG---Figure">
					<img src="image/B15218_08_24.jpg" alt="Figure 8.24: Resetting the form and the display using the Reset button&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.24: Resetting the form and the display using the Reset button</p>
			<p>This final step using the event bus, triggering an event and listening for the same event, is part of the basis of the Vuex pattern where events and state updates are encapsulated.</p>
			<h1 id="_idParaDest-194">Using the Vuex Pattern i<a id="_idTextAnchor272"/>n Contrast with Other Patterns Such as Redux</h1>
			<p>The final scenario we will look at is using the Vuex pattern. In this case, all state is held in a single store. Any updates to the state are dispatched to this store. Components read shared and/or global state from the store.</p>
			<p>Vuex is both a state management pattern and a library implementation from the Vue.js core team. The pattern aims to alleviate issues found when global state is shared by different parts of the application. The state of the store cannot be directly manipulated. <strong class="bold">Mutations</strong> are used to update store state and, since store state is reactive, any consumers of the Vuex store will automatically update.</p>
			<p>Vuex draws inspiration from previous work in the JavaScript state management space such as the <strong class="bold">Flux</strong> architecture, which popularized the concept of unidirectional data flow, and <strong class="bold">Redux</strong>, which is a single-store implementation of Flux.</p>
			<p>Vuex is not just another Flux implementation. It is a Vue.js-specific state management library. It can therefore leverage Vue.js-specific things such as reactivity to improve the performance of updates. The following diagram shows a hierarchy of the props and the state updates:</p>
			<div>
				<div id="_idContainer288" class="IMG---Figure">
					<img src="image/B15218_08_25.jpg" alt="Figure 8.25: Vuex props and state updates hierarchy&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.25: Vuex props and state updates hierarchy</p>
			<p>To update pieces of global state, components trigger an update called a mutation in the store. The store knows how to handle this update. It updates state and propagates props back down accordingly through Vue.js reactivity:</p>
			<div>
				<div id="_idContainer289" class="IMG---Figure">
					<img src="image/B15218_08_26.jpg" alt="Figure 8.26: Sequence diagram of a global state update with Vuex&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.26: Sequence diagram of a global state update with Vuex</p>
			<p>We can extend the existing application using Vuex.</p>
			<p>First, we need to add the <strong class="source-inline">vuex</strong> module using <strong class="source-inline">yarn add vuex</strong> or <strong class="source-inline">npm install --save vuex</strong>.</p>
			<p>Next, we need to register Vuex with Vue using <strong class="source-inline">Vue.use()</strong> in the <strong class="source-inline">store.js</strong> file:</p>
			<p class="source-code">import Vue from 'vue'</p>
			<p class="source-code">import Vuex from 'vuex'</p>
			<p class="source-code">Vue.use(Vuex)</p>
			<p>Finally, we create a Vuex store with a default state. This state includes the same <strong class="source-inline">formData</strong> object we have been using in the <strong class="source-inline">store.js</strong> file. We then export it using <strong class="source-inline">export default</strong>:</p>
			<p class="source-code">export default new Vuex.Store({</p>
			<p class="source-code">  state: {</p>
			<p class="source-code">    formData: {</p>
			<p class="source-code">      name: '',</p>
			<p class="source-code">      occupation: ''</p>
			<p class="source-code">    }</p>
			<p class="source-code">  },</p>
			<p class="source-code">})</p>
			<p>Finally, we need to register our store with our main application instance of Vue.js in the <strong class="source-inline">main.js</strong> file:</p>
			<p class="source-code">// other imports</p>
			<p class="source-code">import store from './store'</p>
			<p class="source-code">// other imports and code</p>
			<p class="source-code">new Vue({</p>
			<p class="source-code">  render: h =&gt; h(App),</p>
			<p class="source-code">  store</p>
			<p class="source-code">}).$mount('#app')</p>
			<p>The great thing is that every component has a reference to the store under <strong class="source-inline">this.$store</strong>. For example, to access <strong class="source-inline">formData</strong>, we can use <strong class="source-inline">this.$store.state.formData</strong>. Using this, we can replace the event bus subscription and local state updates in the script section of the <strong class="source-inline">AppProfileDisplay.vue</strong> file with a single computed property:</p>
			<p class="source-code">&lt;script&gt;</p>
			<p class="source-code">export default {</p>
			<p class="source-code">  computed: {</p>
			<p class="source-code">    formData() {</p>
			<p class="source-code">      return this.$store.state.formData</p>
			<p class="source-code">    }</p>
			<p class="source-code">  }</p>
			<p class="source-code">}</p>
			<p class="source-code">&lt;/script&gt;</p>
			<p>To trigger state updates, we need to define some mutations. In this case, we need <strong class="source-inline">profileUpdate</strong> in the <strong class="source-inline">store.js</strong> file. Mutations receive <strong class="source-inline">state</strong> (the current state) and <strong class="source-inline">payload</strong> (the store <strong class="source-inline">commit</strong> payload) as properties.</p>
			<p class="source-code">export default new Vuex.Store({</p>
			<p class="source-code">  // other store properties</p>
			<p class="source-code">  mutations: {</p>
			<p class="source-code">    profileUpdate(state, payload) {</p>
			<p class="source-code">      state.formData = {</p>
			<p class="source-code">        name: payload.name || '',</p>
			<p class="source-code">        occupation: payload.occupation || ''</p>
			<p class="source-code">      }</p>
			<p class="source-code">    }</p>
			<p class="source-code">  }</p>
			<p class="source-code">})</p>
			<p>Now that we have got a <strong class="source-inline">profileUpdate</strong> mutation, we can update the <strong class="source-inline">Reset</strong> button in the <strong class="source-inline">AppHeader.vue</strong> file to use the Vuex <strong class="source-inline">$store.commit()</strong> function:</p>
			<p class="source-code">&lt;script&gt;</p>
			<p class="source-code">export default {</p>
			<p class="source-code">  methods: {</p>
			<p class="source-code">    clear() {</p>
			<p class="source-code">      this.$store.commit('profileUpdate', {})</p>
			<p class="source-code">    }</p>
			<p class="source-code">  }</p>
			<p class="source-code">}</p>
			<p class="source-code">&lt;/script&gt;</p>
			<p>We should also update the <strong class="source-inline">AppProfileForm.vue</strong> file to commit to the <strong class="source-inline">$store</strong> instead of emitting to the event bus:</p>
			<p class="source-code">&lt;script&gt;</p>
			<p class="source-code">export default {</p>
			<p class="source-code">  // rest of component</p>
			<p class="source-code">  methods: {</p>
			<p class="source-code">    submitForm() {</p>
			<p class="source-code">      this.$store.commit('profileUpdate', {</p>
			<p class="source-code">        name: this.name,</p>
			<p class="source-code">        occupation: this.occupation</p>
			<p class="source-code">      })</p>
			<p class="source-code">    },</p>
			<p class="source-code">    // other methods</p>
			<p class="source-code">  }</p>
			<p class="source-code">}</p>
			<p class="source-code">&lt;/script&gt;</p>
			<p>The application will now support updating the name and occupation:</p>
			<div>
				<div id="_idContainer290" class="IMG---Figure">
					<img src="image/B15218_08_27.jpg" alt="Figure 8.27: Application with AppProfileForm filled out and submitted&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.27: Application with AppProfileForm filled out and submitted</p>
			<p>Unfortunately, the <strong class="source-inline">Reset</strong> button does not clear the form:</p>
			<div>
				<div id="_idContainer291" class="IMG---Figure">
					<img src="image/B15218_08_28.jpg" alt="Figure 8.28: Application with AppProfileForm not clearing on Reset button click&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.28: Application with AppProfileForm not clearing on Reset button click</p>
			<p>To reset more efficiently, we will add a <strong class="source-inline">profileClear</strong> mutation in the <strong class="source-inline">store.js</strong> file:</p>
			<p class="source-code">export default new Vuex.Store({</p>
			<p class="source-code">  // other store properties</p>
			<p class="source-code">  mutations: {</p>
			<p class="source-code">    // other mutations</p>
			<p class="source-code">    profileClear(state) {</p>
			<p class="source-code">      state.formData = {</p>
			<p class="source-code">        name: '',</p>
			<p class="source-code">        occupation: ''</p>
			<p class="source-code">      }</p>
			<p class="source-code">    }</p>
			<p class="source-code">  }</p>
			<p class="source-code">})</p>
			<p>We will commit this action instead of <strong class="source-inline">profileUpdate</strong> in the <strong class="source-inline">AppHeader.vue</strong> file. Using <strong class="source-inline">profileClear</strong> instead of <strong class="source-inline">profileUpdate</strong> with empty data makes our code cleared:</p>
			<p class="source-code">&lt;script&gt;</p>
			<p class="source-code">export default {</p>
			<p class="source-code">  methods: {</p>
			<p class="source-code">    clear() {</p>
			<p class="source-code">      this.$store.commit('profileClear')</p>
			<p class="source-code">    }</p>
			<p class="source-code">  }</p>
			<p class="source-code">}</p>
			<p class="source-code">&lt;/script&gt;</p>
			<p>Finally, we will need to subscribe to store changes and reset the local state when <strong class="source-inline">profileClear</strong> is committed to the store in the <strong class="source-inline">AppProfileForm</strong> file:</p>
			<p class="source-code">&lt;script&gt;</p>
			<p class="source-code">export default {</p>
			<p class="source-code">  created() {</p>
			<p class="source-code">    this.$store.subscribe((mutation) =&gt; {</p>
			<p class="source-code">      if (mutation.type === 'profileClear') {</p>
			<p class="source-code">        this.resetProfileForm()</p>
			<p class="source-code">      }</p>
			<p class="source-code">    })</p>
			<p class="source-code">  },</p>
			<p class="source-code">  // other component properties</p>
			<p class="source-code">  methods: {</p>
			<p class="source-code">    // other methods</p>
			<p class="source-code">    resetProfileForm() {</p>
			<p class="source-code">      this.name = ''</p>
			<p class="source-code">      this.occupation = ''</p>
			<p class="source-code">    }</p>
			<p class="source-code">  }</p>
			<p class="source-code">}</p>
			<p class="source-code">&lt;/script&gt;</p>
			<p>Now the application's <strong class="source-inline">Reset</strong> button will work correctly with Vuex. Our screen should display as follows:</p>
			<div>
				<div id="_idContainer292" class="IMG---Figure">
					<img src="image/B15218_08_29.jpg" alt="Figure 8.29: Application Reset button clearing both the form and the display&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.29: Application Reset button clearing both the form and the display</p>
			<p>We have now seen how to use the Vuex store to store global state in our application.</p>
			<h2 id="_idParaDest-195">Exercise 8.04: Adding an Organiz<a id="_idTextAnchor273"/>ation Field to the Profile Generator </h2>
			<p>In a <strong class="source-inline">profile card generator</strong>, in addition to the name and occupation of an individual, it's also useful to know where they work, in other words, their organization.</p>
			<p>To do this, we will add an <strong class="source-inline">organization</strong> field in <strong class="source-inline">AppProfileForm</strong> and <strong class="source-inline">AppProfileDisplay</strong>. To access the code files for this exercise, refer to <a href="https://packt.live/3lIHJGe">https://packt.live/3lIHJGe</a>.</p>
			<ol>
				<li value="1">We can start by adding a new text input and label to <strong class="source-inline">AppProfileForm</strong>:<p class="source-code">&lt;template&gt;</p><p class="source-code">  &lt;!-- rest of template --&gt;</p><p class="source-code">    &lt;div class="flex flex-col mt-2"&gt;</p><p class="source-code">      &lt;label class="flex text-gray-800 mb-2"         for="organization"&gt;Organization&lt;/label&gt;</p><p class="source-code">      &lt;input</p><p class="source-code">        id="occupation"</p><p class="source-code">        type="text"</p><p class="source-code">        name="organization"</p><p class="source-code">        class="border-2 border-solid border-blue-200           rounded px-2 py-1"</p><p class="source-code">      /&gt;</p><p class="source-code">    &lt;/div&gt;</p><p class="source-code">  &lt;!-- rest of template --&gt;</p><p class="source-code">&lt;/template&gt;</p><p>The new field looks as follows:</p><div id="_idContainer293" class="IMG---Figure"><img src="image/B15218_08_30.jpg" alt="Figure 8.30: Application with a new Organization field&#13;&#10;"/></div><p class="figure-caption">Figure 8.30: Application with a new Organization field</p></li>
				<li>We can then add the <strong class="source-inline">organization</strong> field to the initial state and mutations in <strong class="source-inline">src/store.js</strong> so that <strong class="source-inline">organization</strong> gets initialized, set during <strong class="source-inline">profileUpdate</strong>, and reset during <strong class="source-inline">profileClear</strong>:<p class="source-code">// imports &amp; Vuex setup</p><p class="source-code">export default new Vuex.Store({</p><p class="source-code">  state: {</p><p class="source-code">    formData: {</p><p class="source-code">      // rest of formData fields</p><p class="source-code">      organization: ''</p><p class="source-code">    }</p><p class="source-code">  },</p><p class="source-code">  mutations: {</p><p class="source-code">    profileUpdate(state, payload) {</p><p class="source-code">      state.formData = {</p><p class="source-code">        // rest of formData fields</p><p class="source-code">        organization: payload.organization || '',</p><p class="source-code">      }</p><p class="source-code">    },</p><p class="source-code">    profileClear(state) {</p><p class="source-code">      state.formData = {</p><p class="source-code">        // rest of formData fields</p><p class="source-code">        organization: ''</p><p class="source-code">      }</p><p class="source-code">    }</p><p class="source-code">  }</p><p class="source-code">})</p></li>
				<li>We need to track <strong class="source-inline">organization</strong> in the local state of the <strong class="source-inline">src/components/AppProfileForm.vue</strong> component using <strong class="source-inline">v-model</strong> and initializing it in the <strong class="source-inline">data()</strong> function:<p class="source-code">&lt;template&gt;</p><p class="source-code">  &lt;!-- rest of template --&gt;</p><p class="source-code">    &lt;div class="flex flex-col mt-2"&gt;</p><p class="source-code">      &lt;label class="flex text-gray-800 mb-2"         for="organization"&gt;Organization&lt;/label&gt;</p><p class="source-code">      &lt;input</p><p class="source-code">        id="occupation"</p><p class="source-code">        type="text"</p><p class="source-code">        name="organization"</p><p class="source-code"><strong class="bold">        v-model="organization"</strong></p><p class="source-code">        class="border-2 border-solid border-blue-200 rounded           px-2 py-1"</p><p class="source-code">      /&gt;</p><p class="source-code">    &lt;/div&gt;</p><p class="source-code">  &lt;!-- rest of template --&gt;</p><p class="source-code">&lt;/template&gt;</p><p class="source-code">&lt;script&gt;</p><p class="source-code">export default {</p><p class="source-code">  // rest of component</p><p class="source-code">  data() {</p><p class="source-code">    return {</p><p class="source-code">      // other data properties</p><p class="source-code">      organization: ''</p><p class="source-code">    }</p><p class="source-code">  }</p><p class="source-code">}</p><p class="source-code">&lt;/script&gt;</p></li>
				<li>For the payload of the mutation to contain <strong class="source-inline">organization</strong>, we'll need to add it to the <strong class="source-inline">$store.commit('profileUpdate')</strong> payload and also reset it in the form when a component triggers a <strong class="source-inline">profileClear</strong> mutation:<p class="source-code">&lt;script&gt;</p><p class="source-code">export default {</p><p class="source-code">  // rest of component</p><p class="source-code">  methods: {</p><p class="source-code">    submitForm() {</p><p class="source-code">      this.$store.commit('profileUpdate', {</p><p class="source-code">        // rest of payload</p><p class="source-code">        organization: this.organization</p><p class="source-code">      })</p><p class="source-code">    },</p><p class="source-code">    resetProfileForm() {</p><p class="source-code">      // other resets</p><p class="source-code">      this.organization = ''</p><p class="source-code">    }</p><p class="source-code">  }</p><p class="source-code">}</p><p class="source-code">&lt;/script&gt;</p></li>
				<li>For <strong class="source-inline">organization</strong> to display, we need to render it in <strong class="source-inline">src/components/AppProfileDisplay.vue</strong> using a conditional span (to hide <strong class="source-inline">at</strong> when there is no <strong class="source-inline">organization</strong> set):<p class="source-code">&lt;template&gt;</p><p class="source-code">  &lt;!-- rest of template --&gt;</p><p class="source-code">    &lt;p class="mt-2"&gt;</p><p class="source-code">      {{ formData.occupation }}</p><p class="source-code">      &lt;span v-if="formData.organization"&gt;</p><p class="source-code">        at {{ formData.organization }}</p><p class="source-code">      &lt;/span&gt;</p><p class="source-code">    &lt;/p&gt;</p><p class="source-code">  &lt;!-- rest of template --&gt;</p><p class="source-code">&lt;/template&gt;</p><p>The application will now allow us to capture an <strong class="source-inline">organization</strong> field and display it.</p><div id="_idContainer294" class="IMG---Figure"><img src="image/B15218_08_31.jpg" alt="Figure 8.31: Profile Card Generator with Organization field support, filled out and submitted&#13;&#10;"/></div></li>
			</ol>
			<p class="figure-caption">Figure 8.31: Profile Card Generator with Organization field support, filled out and submitted</p>
			<p>It will allow us to clear the profile without any issues too:</p>
			<div>
				<div id="_idContainer295" class="IMG---Figure">
					<img src="image/B15218_08_32.jpg" alt="Figure 8.32: Profile Card Generator with Organization field support, after Reset button click&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 8.32: Profile Card Generator with Organization field support, after Reset button click</p>
			<p>We've now seen how to add a field to an application that uses Vuex. One of the biggest benefits of Vuex over an event bus or storing state in an ancestor component is that it scales as you add more data and operations. The following activity will showcase this strength.</p>
			<h2 id="_idParaDest-196">Activity 8.01: Adding Email and <a id="_idTextAnchor274"/><a id="_idTextAnchor275"/>Phone Number to a Profile Card Generator</h2>
			<p>In a profile generator, you look at a profile to find some information about the individual. Email and phone number are often the most crucial pieces of information looked for on a profile card. This activity is about adding these details to a profile card generator.</p>
			<p>To do this, we will add <strong class="source-inline">Email</strong> and <strong class="source-inline">Phone Number</strong> fields in <strong class="source-inline">AppProfileForm</strong> and <strong class="source-inline">AppProfileDisplay</strong>:</p>
			<ol>
				<li value="1">We can start by adding a new <strong class="source-inline">email</strong> input field and label to <strong class="source-inline">AppProfileForm</strong> for the <strong class="source-inline">Email</strong> field.</li>
				<li>We can then add a new <strong class="source-inline">phone</strong> input field (of type <strong class="source-inline">tel</strong>) and a label to <strong class="source-inline">AppProfileForm</strong> for the <strong class="source-inline">Phone Number</strong> field:<p>The new fields look as follows:</p><div id="_idContainer296" class="IMG---Figure"><img src="image/B15218_08_33.jpg" alt="Figure 8.33: Application with new Email and Phone Number fields&#13;&#10;"/></div><p class="figure-caption">Figure 8.33: Application with new Email and Phone Number fields</p></li>
				<li>We can then add the <strong class="source-inline">email</strong> and <strong class="source-inline">phone</strong> fields to the initial state and mutations in <strong class="source-inline">src/store.js</strong> so that organization gets initialized, set during <strong class="source-inline">profileUpdate</strong>, and reset during <strong class="source-inline">profileClear</strong>.</li>
				<li>We need to track <strong class="source-inline">email</strong> in the local state of the <strong class="source-inline">src/components/AppProfileForm.vue</strong> component using <strong class="source-inline">v-model</strong> and initialize it in the <strong class="source-inline">data()</strong> function.</li>
				<li>We need to track <strong class="source-inline">phone</strong> in the local state of the <strong class="source-inline">src/components/AppProfileForm.vue</strong> component using <strong class="source-inline">v-model</strong> and initialize it in the <strong class="source-inline">data()</strong> function.</li>
				<li>For the payload of the mutation to contain <strong class="source-inline">email</strong> and <strong class="source-inline">phone</strong>, we'll need to add it to the <strong class="source-inline">$store.commit('profileUpdate')</strong> payload. We'll also want to reset it in the form when a component triggers a <strong class="source-inline">profileClear</strong> mutation.</li>
				<li>For <strong class="source-inline">email</strong> to display, we need to render it in <strong class="source-inline">src/components/AppProfileDisplay.vue</strong> using a conditional paragraph (to hide the <strong class="source-inline">Email</strong> label when there is no email set).</li>
				<li>For <strong class="source-inline">phone</strong> to display, we need to render it in <strong class="source-inline">src/components/AppProfileDisplay.vue</strong> using a conditional span (to hide the <strong class="source-inline">Phone Number</strong> label when there is no phone set).<p>The application should look as follows when the form is filled out and submitted:</p><div id="_idContainer297" class="IMG---Figure"><img src="image/B15218_08_34.jpg" alt="Figure 8.34: Application with Email and Phone Number fields&#13;&#10;"/></div></li>
			</ol>
			<p class="figure-caption">Figure 8.34: Application with Email and Phone Number fields</p>
			<p class="callout-heading">Note</p>
			<p class="callout">The solution for this activity can be found via <a href="B15218_Solution_Final_SZ_ePub.xhtml#_idTextAnchor397">this link</a>.</p>
			<h1 id="_idParaDest-197">When to Use Local State and When t<a id="_idTextAnchor276"/>o Save to Global State</h1>
			<p>As we have seen through the common ancestor, event bus, and Vuex examples, the Vue.js ecosystem has solutions for managing shared and global state. What we will look at now is how to decide whether something belongs in local state or global state.</p>
			<p>A good rule of thumb is that if a prop is passed through a depth of three components, it is probably best to put that piece of state in global state and access it that way.</p>
			<p>The second way to decide whether something is local or global is to ask the question <em class="italic">when the page reloads, does the user expect this information to persist?</em>. Why does this matter? Well, global state is a lot easier to save and persist than local state. This is due to global state's nature as <em class="italic">just a JavaScript object</em> as opposed to component state, which is more closely tied to the component tree and Vue.js.</p>
			<p>Another key idea to bear in mind is that it is very much possible to mix Vuex and local state in a component. As we have seen with the <strong class="source-inline">AppProfileForm</strong> examples, exercises, and activity, we can selectively sync data from mutations into a component using <strong class="source-inline">$store.subscribe</strong>.</p>
			<p>At the end of the day, there is nothing wrong with wrapping a Vue.js data property in a computed property and accessing the computed property to make a potential transition to Vuex easier. In this scenario, since all access is already done through the computed property, it is just a change from <strong class="source-inline">this.privateData</strong> to <strong class="source-inline">this.$store.state.data</strong>.</p>
			<h1 id="_idParaDest-198"><a id="_idTextAnchor277"/>Summary</h1>
			<p>Throughout this chapter, w<a id="_idTextAnchor278"/>e have looked at different approaches to shared and global state management in a Vue.js application.</p>
			<p>State in a shared ancestor allows data sharing between sibling components through props and events.</p>
			<p>An event bus has three operations—<strong class="bold">subscribe</strong>, <strong class="bold">publish</strong>, and <strong class="bold">unsubscribe</strong>—that can be leveraged to propagate state updates in a <strong class="source-inline">Vue.js</strong> application. We have also seen how a <strong class="source-inline">Vue.js</strong> instance can be used as an event bus.</p>
			<p>You know what the Vuex pattern and library entail, how they differ from Redux and Flux, as well as the benefits of using a Vuex store over a shared ancestor or event bus.</p>
			<p>Finally, we have had a look at what criteria can be used to decide whether state should live in local component state or a more global or shared state solution such as Vuex. This chapter was an introduction to the state management landscape in <strong class="source-inline">Vue.js</strong>.</p>
			<p>The next chapter will be a deep-dive into writing large-scale <strong class="source-inline">Vue.js</strong> applications with Vuex.</p>
		</div>
		<div>
			<div id="_idContainer299" class="Content">
			</div>
		</div>
	</body></html>