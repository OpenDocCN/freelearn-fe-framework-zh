<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Building a Web-Based Classroom Application</h1>
                </header>
            
            <article>
                
<p>As the world is moving to the internet, so are our tools for learning and acquiring knowledge in different disciplines. Right now on the web, there is a plethora of online platforms that offer both educators and students options to teach and learn different topics remotely, without the necessity to be physically co-located in a classroom.</p>
<p>In this chapter, we will build a simple online classroom application, by extending the MERN stack skeleton application. This classroom application will support multiple user roles, the addition of course content and lessons, student enrollments, progress tracking, and course enrollment statistics. While building out this application, we will <span>uncover more capabilities of this stack, such as how to implement role-based access to resources and actions, how to combine multiple schemas, and how to run different query operations in order to gather stats. </span>By the end of this chapter, you will be familiar with the techniques that are needed to easily integrate new full-stack features in any MERN-based application. </p>
<p>We will build out the online classroom application by covering the following topics in this chapter:</p>
<ul>
<li>Introducing MERN Classroom</li>
<li>Adding an educator role to users</li>
<li>Adding courses to the classroom</li>
<li>Updating courses with lessons</li>
<li>Publishing courses</li>
<li>Enrolling in courses</li>
<li>Tracking progress and enrollment stats</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Introducing MERN Classroom</h1>
                </header>
            
            <article>
                
<p>MERN Classroom is a <span>simple online classroom application, which allows educators to add courses that are made up of various lessons, while students can enroll on these courses. Additionally, the application will allow students to track their progress throughout the course, whereas instructors can monitor how many students have enrolled in/on a course, and how many have completed each course.</span> The completed application, with all these features, will end up with a home page as shown in the following screenshot:</p>
<div class="packt_figref CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-794 image-border" src="assets/9a0f61eb-7fe0-494b-ab32-f1a3e10736e0.png" style="width:41.75em;height:33.42em;"/></div>
<div class="packt_tip">The code for the complete MERN Classroom application is available on GitHub in the repository at <a href="https://github.com/PacktPublishing/Full-Stack-React-Projects-Second-Edition/tree/master/Chapter06/mern-classroom" target="_blank">https://github.com/PacktPublishing/Full-Stack-React-Projects-Second-Edition/tree/master/Chapter06/mern-classroom</a>. You can clone this code and run the application as you go through the code explanations for the rest of this chapter.</div>
<p><span>The views needed for the MERN Classroom application will be developed by extending and modifying the existing React </span><span>components</span><span> in the MERN skeleton application. The component tree in the following diagram lays out all the custom React components that make up the MERN Classroom frontend, and also exposes the composition structure that we will use to build out the views in the rest of the chapter:</span></p>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-795 image-border" src="assets/fdd3351a-8071-4d24-9dcd-9613f12b396a.png" style="width:40.25em;height:22.17em;"/></p>
<p>We will add new React components that are related to courses, lessons, and enrollments; and we will also modify existing components such as the EditProfile, Menu, and Home components as we build out the different features of the MERN Classroom application in the rest of the chapter. Most of these features in the Classroom application will depend on the user's ability to become an educator. In the next section, we will begin implementing the MERN Classroom application by updating the user in order to give them the option to choose an educator role.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Updating the user with an educator role</h1>
                </header>
            
            <article>
                
<p>Users who sign up to the MERN Classroom application will have the choice to become an educator on the platform by selecting this option in the <kbd>EditProfile</kbd> form component. This option in the form will look as follows—showing when the user isn't an educator, versus when they choose to be an educator:</p>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-796 image-border" src="assets/ffc9060b-799a-4479-bfe3-57365f5da18d.png" style="width:17.67em;height:5.67em;"/></p>
<p>When a user chooses to be an educator, in contrast to being a regular user, they will be allowed to create and manage their own courses. A<span>s pictured in the following </span>screenshot, MERN Classroom will display a <span class="packt_screen">TEACH</span> option in the navigation menu f<span>or educators only</span>, that is, it won't be shown to regular users:</p>
<div class="mce-root CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-797 image-border" src="assets/81570225-e6d1-4cbd-9a56-459173144b09.png" style="width:15.08em;height:1.58em;"/></div>
<p>In the following sections, we will add this educator feature, by first updating the user model, then the EditProfile view, and finally by adding a<span> </span><span class="packt_screen">T</span><span class="packt_screen">EACH</span><span> </span>link to the menu that will only be visible to educators.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Adding a role to the user model</h1>
                </header>
            
            <article>
                
<p>The existing user model in the MERN skeleton application will need an educator value that will be set to<span> </span><kbd>false</kbd><span> </span>by default in order to represent regular users, but that can be set to<span> </span><kbd>true</kbd><span> </span>to represent the users who are also educators. To add this new field to the user schema, we will add the following code.</p>
<p><kbd>mern-classroom/server/models/user.model.js</kbd>:</p>
<pre>educator: {<br/>    type: Boolean,<br/>    default: false<br/>}</pre>
<p><span>This <kbd>educator</kbd> value must be sent to the frontend, with the user details received once the user has successfully signed in, so that the view can be rendered accordingly to show information that is relevant to the educator. To make this change, we need to update the response that was sent back in the <kbd>signin</kbd> controller method as highlighted in the following code:</span></p>
<p><kbd><span>mern-classroom/server/controllers/auth.controller.js</span></kbd></p>
<pre><span>...<br/>l<br/>      token,<br/>      user: {<br/>        _id: user._id,<br/>        name: user.name,<br/>        email: user.email,<br/>        <strong>educator: user.educator</strong><br/>      }<br/>    })<br/>...<br/>} </span></pre>
<p>By sending this <kbd>educator</kbd> field value back in the response, we can render the frontend views with role-specific authorization considerations.</p>
<p>But before getting to these conditionally rendered views, we first need to implement the option to select an educator role in the <kbd>EditProfile</kbd> view, as discussed in the next section. </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Updating the EditProfile view</h1>
                </header>
            
            <article>
                
<p>In order to become an educator in the MERN Classroom application, a signed-in user will need to update their profile. They will see a toggle in the EditProfile view, which will either activate or deactivate the educator feature. To implement this, first, we will update the<span> </span><kbd>EditProfile</kbd><span> </span>component in order to add a<span> </span>Material-UI<span> </span><kbd>Switch</kbd><span> </span>component in <kbd>FormControlLabel</kbd>, as shown in the following code.</p>
<p><kbd>mern-classroom/client/user/EditProfile.js</kbd>:</p>
<pre>&lt;Typography variant="subtitle1" className={classes.subheading}&gt;<br/>     I am an Educator<br/>&lt;/Typography&gt;<br/>&lt;FormControlLabel<br/>     control={<br/>             &lt;Switch classes={{<br/>                                checked: classes.checked,<br/>                                bar: classes.bar,<br/>                              }}<br/>                      checked={values.educator}<br/>                      onChange={handleCheck}<br/>             /&gt;}<br/>     label={values.educator? 'Yes' : 'No'}<br/>/&gt;</pre>
<p>Any changes to the switch will be set to the value of the<span> </span><kbd>educator</kbd><span> variable </span>in the state by calling the<span> </span><kbd>handleCheck</kbd><span> </span>method, as defined in the following code.</p>
<p><kbd><span>mern-classroom/client/user/EditProfile.js</span></kbd>:</p>
<pre>const handleCheck = (event, checked) =&gt; {<br/>   setValues({...values, 'educator': checked})<br/>} </pre>
<p>The <kbd>handleCheck</kbd> method receives the <kbd>checked</kbd> Boolean value to indicate whether the switch has been selected or not, and this value is set to <kbd>educator</kbd>.</p>
<p>On form submit, the<span> </span><kbd>educator</kbd><span> </span>value is added to the details that were sent in the update to the server, as highlighted in the following code.</p>
<p><kbd><span>mern-classroom/client/user/EditProfile.js</span></kbd>:</p>
<pre>clickSubmit = () =&gt; {<br/>    const jwt = auth.isAuthenticated() <br/>    const <strong>user</strong> = {<br/>      name: this.state.name || undefined,<br/>      email: this.state.email || undefined,<br/>      password: this.state.password || undefined,<br/>      <strong>educator: values.educator || undefined</strong><br/>    }<br/>    update({<br/>      userId: this.match.params.userId<br/>    }, {<br/>      t: jwt.token<br/>    }, <strong>user</strong>).then((data) =&gt; {<br/>      if (data.error) {<br/>        this.setState({error: data.error})<br/>      } else {<br/>        <strong>auth.updateUser(data, ()=&gt; {</strong><br/><strong>          setValues({...values, userId: data._id, redirectToProfile: true})</strong><br/><strong>        })</strong><br/>      }<br/>    })<br/>  }</pre>
<p>Once the EditProfile view has been successfully updated, the user details that are stored in<span> </span><kbd>sessionStorage</kbd><span> </span>for auth purposes should also be updated. The <kbd>auth.updateUser</kbd><span> </span>method is called to do this<span> </span><kbd>sessionStorage</kbd><span> </span>update. It is defined with the other<span> </span><kbd>auth-helper.js</kbd><span> </span>methods, and the parameters that are passed are the updated user data and a callback function that updates the view. This <kbd>updateUser</kbd> method is defined as follows.</p>
<p><kbd>mern-classroom/client/auth/auth-helper.js</kbd>:</p>
<pre>updateUser(user, cb) {<br/>  if(typeof window !== "undefined"){<br/>    if(sessionStorage.getItem('jwt')){<br/>       let auth = JSON.parse(sessionStorage.getItem('jwt'))<br/>       auth.user = user<br/>       sessionStorage.setItem('jwt', JSON.stringify(auth))<br/>       cb()<br/>     }<br/>  }<br/>}</pre>
<p>Once the updated educator role is available in the frontend, we can use it to render the frontend accordingly. In the next section, we will see how to render the menu differently, based on whether an educator or a regular user is viewing the application. </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Rendering an option to teach </h1>
                </header>
            
            <article>
                
<p>In the frontend of the classroom application, we can render different options based on whether an educator is currently browsing the application. In this section, we will add the code to conditionally display a link to<span> </span><em><span class="packt_screen">TEACH</span></em> on the <span>navigation bar,</span> which will only be visible to the signed-in users who are also educators.</p>
<p>We will update the<span> </span><kbd>Menu</kbd><span> </span>component, as follows, within the previous code that only renders when a user is signed in.</p>
<p><kbd>mern-classroom/client/core/Menu.js</kbd>:</p>
<pre>{auth.isAuthenticated() &amp;&amp; (&lt;span&gt;<br/>    {<strong>auth.isAuthenticated().user.educator</strong> &amp;&amp; <br/>       (&lt;Link to="/teach/courses"&gt;<br/>           &lt;Button style={isPartActive(history, "/teach/")}&gt;<br/>               &lt;Library/&gt; <strong>Teach</strong> &lt;/Button&gt;<br/>        &lt;/Link&gt;)<br/>    }<br/>    ...<br/>}</pre>
<p>This link, which is only visible to educators, will take them to the educator dashboard view, where they can manage the courses that they are instructing.</p>
<p>This section has taught us how to update a user role to an educator role in the application, and we can now begin incorporating features that will allow an educator to add courses to the classroom.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Adding courses to the classroom</h1>
                </header>
            
            <article>
                
<p>Educators in the MERN Classroom can create courses and add lessons to each course. In this section, we will walk through the implementations of the course-related features, such as adding new courses, listing courses by a specific instructor, and displaying the details of a single course. To store the course data and enable course management, we will start by implementing a Mongoose schema for courses, then backend APIs to create and list the courses, along with frontend views for both authorized educators and for regular users interacting with courses in the application.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Defining a Course model</h1>
                </header>
            
            <article>
                
<p>The Course schema—defined in<span> </span><kbd>server/models/course.model.js</kbd><span>—</span>will have simple fields to store course details, along with with an image, a category, whether the course is published or not, and a reference to the user who created the course. The code defining the course fields are given in the following list with explanations:</p>
<ul>
<li><strong>Course name and description</strong>: <kbd>name</kbd> and <kbd>description</kbd> f<span>ields will have string types, with <kbd>name</kbd> as a required field:<br/></span></li>
</ul>
<pre style="padding-left: 60px">name: { <br/>    type: String, <br/>    trim: true, <br/>    required: 'Name is required' <br/>},<br/>description: { <br/>    type: String, <br/>    trim: true <br/>},</pre>
<ul>
<li><strong>Course image</strong>: <span>The <kbd>image</kbd> field will store the course image file to be uploaded by the user as binary data in the MongoDB database:</span></li>
</ul>
<pre style="padding-left: 60px">image: { <br/>    data: Buffer, <br/>    contentType: String <br/>},</pre>
<ul>
<li><strong>Course category</strong>: <span>The <kbd>category</kbd> field will store the category value of the course as a string, and it will be a required field:</span></li>
</ul>
<pre style="padding-left: 60px">category: {<br/>  type: String,<br/>  required: 'Category is required'<br/>},</pre>
<ul>
<li><strong>Course published state</strong>: <span>The <kbd>published</kbd> field will be a Boolean value, indicating whether the course is published or not:</span></li>
</ul>
<pre style="padding-left: 60px">published: {<br/>  type: Boolean,<br/>  default: false<br/>},</pre>
<ul>
<li><strong>Course instructor</strong>: <span>The <kbd>instructor</kbd> field will reference the user who created the course:</span></li>
</ul>
<pre style="padding-left: 60px">instructor: {<br/>    type: mongoose.Schema.ObjectId, <br/>    ref: 'User'<br/>}</pre>
<ul>
<li><strong>Created and updated at times</strong>: <span>The</span><span> </span><kbd>created</kbd><span> </span><span>and</span><span> </span><kbd>updated</kbd><span> </span><span>fields will be <kbd>Date</kbd> types, with</span><span> </span><kbd>created</kbd><span> </span><span>generated when a new course is added, and</span><span> </span><kbd>updated</kbd><span> </span><span>changed when any course details are modified:</span></li>
</ul>
<pre style="padding-left: 60px">updated: Date,<br/>created: { <br/>    type: Date, <br/>    default: Date.now <br/>},</pre>
<p><span>The fields in this schema definition will enable us to implement the course-related features in MERN Classroom. To start off these features, in the next section, we will implement the full-stack slice that will allow educators to create new courses.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating a new course</h1>
                </header>
            
            <article>
                
<p><span>In MERN Classroom, a</span> user who is signed in—and who is also an educator—will be able to create new courses. To implement this feature, in the following sections we will add a create course API in the backend, along with a way to fetch this API in the frontend, and a create new course form view that takes user input for course fields.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The create course API</h1>
                </header>
            
            <article>
                
<p>In order to start the implementation of the create course API in the backend, we will add a <kbd>POST</kbd> route that verifies that the current user is an educator, and then creates a new course with the course data passed in the request body. The route is defined as follows:</p>
<p><kbd>mern-classroom/server/routes/course.routes.js</kbd>:</p>
<pre>router.route('/api/courses/by/:userId')<br/>  .post(authCtrl.requireSignin, authCtrl.hasAuthorization, <br/>         userCtrl.isEducator, <br/>          courseCtrl.create)</pre>
<p>The<span> </span><kbd>course.routes.js</kbd><span> </span>file will be very similar to the<span> </span><kbd>user.routes</kbd><span> </span>file, and to load these new routes in the Express app, we need to mount the course routes in<span> </span><kbd>express.js</kbd>, in the same way that we did for the auth and user routes, as shown in the following code:</p>
<p><kbd>mern-classroom/server/express.js</kbd>:</p>
<pre>app.use('/', courseRoutes)</pre>
<p>Next, we will update the user controller to add the<span> </span><kbd>isEducator</kbd><span> </span>method—which will ensure that the current user is actually an educator—before creating the new course. The <kbd>isEducator</kbd> method is defined as follows:</p>
<p><kbd>mern-classroom/server/controllers/user.controller.js</kbd>:</p>
<pre>const isEducator = (req, res, next) =&gt; {<br/>  const isEducator = req.profile &amp;&amp; req.profile.educator<br/>  if (!isEducator) {<br/>     return res.status('403').json({<br/>        error: "User is not an educator"<br/>     })<br/>  }<br/>  next()<br/>}</pre>
<p>The<span> </span><kbd>create</kbd><span> </span>method, in the course controller, uses the<span> </span><kbd>formidable</kbd><span> </span>Node module to parse the multipart request that may contain an image file that has been uploaded by the user for the course image. If there is a file,<span> </span><kbd>formidable</kbd><span> </span>will store it temporarily in the filesystem, and we will read it using the<span> </span><kbd>fs</kbd><span> </span>module to retrieve the file type and data, and then it will be stored to the<span> </span><kbd>image</kbd><span> </span>field in the course document. The <kbd>create</kbd> controller method will look as shown in the following code:</p>
<p><kbd>mern-classroom/server/controllers/course.controller.js</kbd>:</p>
<pre>const create = (req, res) =&gt; {<br/>  let form = new formidable.IncomingForm()<br/>  form.keepExtensions = true<br/>  form.parse(req, async (err, fields, files) =&gt; {<br/>    if (err) {<br/>      return res.status(400).json({<br/>        error: "Image could not be uploaded"<br/>      })<br/>    }<br/>    let course = new Course(fields)<br/>    course.instructor= req.profile<br/>    if(files.image){<br/>      course.image.data = fs.readFileSync(files.image.path)<br/>      course.image.contentType = files.image.type<br/>    }<br/>    try {<br/>      let result = await course.save()<br/>      res.json(result)<br/>    }catch (err){<br/>      return res.status(400).json({<br/>        error: errorHandler.getErrorMessage(err)<br/>      })<br/>    }<br/>  })<br/>}</pre>
<p><span>The image file for the course, if uploaded by the user, is stored in MongoDB as data. Then, in order to be shown in the views, it is retrieved from the database as an image file at a separate <kbd>GET</kbd> API route. The <kbd>GET</kbd> API is set up as an Express route at <kbd>/api/courses/photo/:courseId</kbd>, which gets the image data from MongoDB and sends it as a file in the response. The implementation steps for file upload, storage, and retrieval are outlined in detail in the <em>Upload profile photo</em> section in</span><span> </span><a href="" target="_blank">Chapter 5</a><span>,</span><span> </span><em>Starting with a Simple Social Media Application</em><span>.</span></p>
<p>With the create course API endpoint ready on the server, next, we can add a <kbd>fetch</kbd> method in the frontend in order to utilize it.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Fetching the create API in the view</h1>
                </header>
            
            <article>
                
<p><span>In order to use the create API in the frontend,</span> <span>we will set up a <kbd>fetch</kbd> method on the client- side</span> to make a <kbd>POST</kbd> request to the create API, by passing the multipart form data, as shown in the following code:</p>
<p><kbd><span>mern-classroom/client/course/api-course.js</span></kbd></p>
<pre>const create = async (params, credentials, course) =&gt; {<br/>    try {<br/>        let response = await fetch('/api/courses/by/'+ params.userId, {<br/>          method: 'POST',<br/>          headers: {<br/>            'Accept': 'application/json',<br/>            'Authorization': 'Bearer ' + credentials.t<br/>          },<br/>          body: course<br/>        })<br/>          return response.json()<br/>        } catch(err) { <br/>          console.log(err)<br/>        }<br/>}</pre>
<p>This method will be used in the new course form view to submit the user-entered course details to the backend to create a new course in the database. In the next section, we will implement this new course form view in a React component. </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The NewCourse component</h1>
                </header>
            
            <article>
                
<p>In order to allow educators to create new courses, we will add a React component that contains a form to the frontend of the application. This form view will look as shown in the following screenshot:</p>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-798 image-border" src="assets/fc891e11-0c2b-4764-bf1d-cd1f167a3ef1.png" style="width:15.17em;height:14.33em;"/></p>
<p>The form will contain an option to upload the course image, input fields for entering the course <span class="packt_screen">Name</span>, <span class="packt_screen">Description</span>, and <span class="packt_screen">Category</span>; and the <span class="packt_screen">SUBMIT</span> button, which will save the details that have been entered into the database.</p>
<p><span>We will define the <kbd>NewCourse</kbd> React component in order to implement this form. As shown next, we first initialize the state by using the</span> <kbd>useState</kbd> <span>hook; with empty input field values, an empty error message, and a <kbd>redirect</kbd> variable that is initialized to <kbd>false</kbd>.</span></p>
<p><kbd>mern-classroom/client/course/NewCourse.js</kbd><span>:</span></p>
<pre>export default function NewCourse() {<br/>  ...  <br/>  const [values, setValues] = useState({<br/>    name: '',<br/>    description: '',<br/>    image: '',<br/>    category: '',<br/>    redirect: false,<br/>    error: ''<br/>  })<br/>  ...<br/>}</pre>
<p>In the form view, we first give the user an option to upload a course image file. To render this option, we will add the file upload elements <span>using a Material-UI button and an HTML5 file input element in the return</span> <span>function</span> <span>for <kbd>NewCourse</kbd>, as shown in the following code.</span></p>
<p><kbd>mern-classroom/client/course/NewCourse.js</kbd><span>:</span></p>
<pre>&lt;input accept="image/*" onChange={handleChange('image')} <br/>                        type="file" style={display:'none'} /&gt;<br/>&lt;label htmlFor="icon-button-file"&gt;<br/>     &lt;Button variant="contained" color="secondary" component="span"&gt;<br/>         Upload Photo &lt;FileUpload/&gt;<br/>     &lt;/Button&gt;<br/>&lt;/label&gt; <br/>&lt;span&gt;{values.image ? values.image.name : ''}&lt;/span&gt;<br/>          </pre>
<p><span>Then, we add the <kbd>name</kbd>, <kbd>description</kbd>,</span> and <kbd>category</kbd> form fields usi<span>ng the <kbd>TextField</kbd> components from Material-UI.</span></p>
<p><kbd>mern-classroom/client/course/NewCourse.js</kbd><span>:</span></p>
<pre>&lt;TextField <br/>    id="name" <br/>    label="Name" <br/>    value={values.name} onChange={handleChange('name')}/&gt; &lt;br/&gt;<br/>&lt;TextField<br/>    id="multiline-flexible"<br/>    label="Description"<br/>    multiline<br/>    rows="2"<br/>    value={values.description}<br/>    onChange={handleChange('description')}/&gt; &lt;br/&gt;<br/>&lt;TextField <br/>    id="category" <br/>    label="Category" <br/>    value={values.category} <br/>    onChange={handleChange('category')}/&gt; </pre>
<p><span>We will define a handler function in <kbd>NewCourse</kbd> so that we can track changes to these fields in the form view.  The <kbd>handleChange</kbd> function will be defined as shown in the following code:</span></p>
<p><kbd>mern-classroom/client/course/NewCourse.js</kbd></p>
<pre>const handleChange = name =&gt; event =&gt; {<br/>    const value = name === 'image'<br/>      ? event.target.files[0]<br/>      : event.target.value<br/>    setValues({...values, [name]: value })<br/>}</pre>
<p><span>This</span><span> </span><kbd>handleChange</kbd><span> </span><span>function takes the new value that has been entered into the input field and sets it to</span><span> </span><span>state, including the name of the file if one is uploaded by the user.</span></p>
<p>Finally, in the view, you can add the <span class="packt_screen">Submit</span> button, which, when clicked, should call a click-handling function. We will define a function for this purpose in <kbd>NewCourse</kbd> as follows.</p>
<p><kbd>mern-classroom/client/course/NewCourse.js</kbd><span>:</span></p>
<pre>const clickSubmit = () =&gt; {<br/>    let courseData = new FormData()<br/>    values.name &amp;&amp; courseData.append('name', values.name)<br/>    values.description &amp;&amp; courseData.append('description',<br/>       values.description)<br/>    values.image &amp;&amp; courseData.append('image', values.image)<br/>    values.category &amp;&amp; courseData.append('category', values.category)<br/>    create({<br/>      userId: jwt.user._id<br/>    }, {<br/>      t: jwt.token<br/>    }, courseData).then((data) =&gt; {<br/>      if (data.error) {<br/>        setValues({...values, error: data.error})<br/>      } else {<br/>        setValues({...values, error: '', redirect: true})<br/>      }<br/>    })<br/>}</pre>
<p><span>This</span><span> </span><kbd>clickSubmit</kbd><span> </span><span>function will be called when the form is submitted. It first takes the input values from the state and sets it to a <kbd>FormData</kbd> object. This ensures that the data is stored in the correct format that is needed for the <kbd>multipart/form-data</kbd> encoding type that is necessary for sending requests containing file uploads. Then, the</span><span> </span><kbd>create</kbd><span> </span><span>fetch method is called to create a new course in the backend. Finally, depending on the response from the server, either an error message is shown, or the user is redirected to the <kbd>MyCourses</kbd> view with the following code.</span></p>
<p><kbd>mern-classroom/client/course/NewCourse.js</kbd><span>:</span></p>
<pre>if (values.redirect) {<br/>      return (&lt;Redirect to={'/teach/courses'}/&gt;)<br/>}</pre>
<p>The<span> </span><kbd>NewCourse</kbd><span> </span>component can only be viewed by a signed-in user who is also an educator. So, we will add a <kbd>PrivateRoute</kbd> to the<span> </span><kbd>MainRouter</kbd><span> </span>component, which will render this form only for authorized users at<span> </span><kbd>/teach/course/new</kbd>.</p>
<p><kbd>mern-classroom/client/MainRouter.js</kbd>:</p>
<pre>&lt;PrivateRoute path="/teach/course/new" component={NewCourse}/&gt;</pre>
<p>This link can be added to any of the view components that may be accessed by the educator, such as the <kbd>MyCourses</kbd> view, which will be implemented in the next section in order to list the courses that have been created by an educator.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Listing courses by educator</h1>
                </header>
            
            <article>
                
<p><span>Authorized educa</span>tors will be able to see <span>a list of the courses that they have created on the platform. In order to implement this feature, in the following sections we will add a backend API that retrieves the list of courses for a specific instructor, and then we will call this API in the frontend to render this data in a React component.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The list course API</h1>
                </header>
            
            <article>
                
<p>In order to implement the API to return the list of courses that have been created by a specific instructor, first, we<span> </span>will<span> </span>add a route in<span> the backend </span>to retrieve all the courses that have been created by a given user when the server receives a <kbd>GET</kbd> request at<span> </span><span><kbd>/api/courses/by/:userId</kbd>. This route will be declared as shown next.</span></p>
<p><span><kbd>mern-classroom/server/routes/course.routes.js</kbd>:</span></p>
<pre>router.route('/api/courses/by/:userId')<br/>  .get(authCtrl.requireSignin, <br/>            authCtrl.hasAuthorization, <br/>               courseCtrl.listByInstructor)</pre>
<p>To process the <kbd>:userId</kbd><span> </span>param in the route and retrieve the associated user from the database, we will utilize the<span> </span><kbd>userByID</kbd><span> </span>method in our user controller. We will add the following code to the<span> </span>Course<span> </span>routes in<span> </span><kbd>course.routes.js</kbd>, so that the user is available in the<span> </span><kbd>request</kbd><span> </span>object as<span> </span><kbd>profile</kbd>.</p>
<p><kbd><span>mern-classroom/server/routes/course.routes.js</span></kbd>:</p>
<pre>router.param('userId', userCtrl.userByID) </pre>
<p>The<span> </span><kbd>listByInstructor</kbd><span> </span>controller method in<span> </span><kbd>course.controller.js</kbd><span> </span>will query the<span> </span><kbd>Course</kbd><span> </span>collection in the database in order to get the matching courses, as shown next.</p>
<p><kbd>mern-classroom/server/controllers/course.controller.js</kbd>:</p>
<pre>const listByInstructor = (req, res) =&gt; {<br/>  Course.find({instructor: req.profile._id}, (err, courses) =&gt; {<br/>    if (err) {<br/>      return res.status(400).json({<br/>        error: errorHandler.getErrorMessage(err)<br/>      })<br/>    }<br/>    res.json(courses)<br/>  }).populate('instructor', '_id name')<br/>}</pre>
<p><span>In the query to the Course collection, we find all the courses that have an</span> <kbd>instructor</kbd><span> field that matches the user specified with the </span><kbd>userId</kbd><span> param. Then, the resulting courses are sent back in the response to the client. In the next section, we will see how to call this API from the frontend.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Fetching the list API in the view</h1>
                </header>
            
            <article>
                
<p>In order to use the list API in the frontend, we will define a <kbd>fetch</kbd> <span>method that can be used by the React components to load this list of courses. The <kbd>fetch</kbd> method that is needed in order to retrieve a list of courses by a specific instructor will be defined as follows.</span></p>
<p><kbd><span>mern-classroom/client/course/api-course.js</span></kbd></p>
<pre>const listByInstructor = async (params, credentials, signal) =&gt; {<br/>    try {<br/>      let response = await fetch('/api/courses/by/'+params.userId, {<br/>        method: 'GET',<br/>        signal: signal,<br/>        headers: {<br/>          'Accept': 'application/json',<br/>          'Authorization': 'Bearer ' + credentials.t<br/>        }<br/>      })<br/>      return response.json()<br/>    } catch(err) {<br/>      console.log(err)<br/>    }<br/>}</pre>
<p>This <kbd>listByInstructor</kbd> method will take the <kbd>userId</kbd> value in order to generate the API route to be called, and will receive the list of courses that were created by the user associated with the provided <kbd>userId</kbd> value. In the classroom application, we will utilize this method in the <kbd>MyCourses</kbd> component, which is discussed in the next section.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The MyCourses component</h1>
                </header>
            
            <article>
                
<p><span>In the </span><kbd>MyCourses</kbd><span> component, w</span>e will<span> render the list of courses in a Material-UI</span> <kbd>List</kbd>, <span>after fetching the data from the server using the <kbd>listByInstructor</kbd> API. This component, as pictured in the following image, will function as the educator's dashboard, where their courses are listed and they have an option to add new courses:</span></p>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-799 image-border" src="assets/6c44b751-0834-4c07-8dd9-41679c40d520.png" style="width:26.17em;height:17.92em;"/></p>
<p>In order to implement this component, we first need to fetch and render the list of courses. We will make the fetch API call in the <kbd>useEffect</kbd> hook, and set the received courses array in the state, as shown next.</p>
<p><kbd><span>mern-classroom/client/course/MyCourses.js</span></kbd></p>
<pre>export default function MyCourses(){<br/>  <strong>const [courses, setCourses] = useState([])</strong><br/>  const [redirectToSignin, setRedirectToSignin] = useState(false)<br/>  const jwt = auth.isAuthenticated()<br/><br/> <strong> useEffect</strong>(() =&gt; {<br/>    const abortController = new AbortController()<br/>    const signal = abortController.signal<br/>    <strong>listByInstructor</strong>({<br/>      userId: jwt.user._id<br/>    }, {t: jwt.token}, signal).then((data) =&gt; {<br/>      if (data.error) {<br/>        <strong>setRedirectToSignin(true)</strong><br/>      } else {<br/>        <strong>setCourses(data)</strong><br/>      }<br/>    })<br/>    return function cleanup(){<br/>      abortController.abort()<br/>    }<br/>  }, [])<br/>  if (redirectToSignin) {<br/>    return &lt;Redirect to='/signin'/&gt;<br/>  }<br/>  ...<br/>}</pre>
<p>When the <kbd>listByInstructor</kbd> API is fetched, we pass the currently signed-in user's auth token to check for authorization on the server- side. Users should only be able to see their own courses, and if the current user is not authorized to make this fetch call, the view will be redirected to the sign-in page. Otherwise, the list of courses will be returned and displayed in the view.</p>
<p><span>In this </span><kbd>MyCourses</kbd><span> component's view, we will render the retrieved courses array by iterating over it using </span><kbd>map</kbd><span>, with each course data rendered in the view in a Material-UI</span> <kbd>ListItem</kbd><span>. Each </span><kbd>ListItem</kbd><span> will also be linked to the individual course view, as shown in the following code:</span></p>
<p><kbd>mern-classroom/client/course/MyCourses.js</kbd></p>
<pre>{courses.map((course, i) =&gt; {<br/>   return &lt;Link to={"/teach/course/"+course._id} key={i}&gt;<br/>            &lt;ListItem button&gt;<br/>              &lt;ListItemAvatar&gt;<br/>                &lt;Avatar src={'/api/courses/photo/'+course._id+"?" + <br/>                                        new Date().getTime()}/&gt;<br/>              &lt;/ListItemAvatar&gt;<br/>              &lt;ListItemText primary={course.name} <br/>                            secondary={course.description}/&gt;<br/>            &lt;/ListItem&gt;<br/>            &lt;Divider/&gt;<br/>          &lt;/Link&gt;}<br/>       )<br/>}</pre>
<p>The<span> </span><kbd>MyCourses</kbd><span> </span>component can only be viewed by a signed-in user who is also an educator. So, we will add a<span> </span><kbd>PrivateRoute</kbd><span> </span>in the<span> </span><kbd>MainRouter</kbd><span> </span>component, which will render this component only for authorized users, at<span> </span><kbd>/seller/courses</kbd>.</p>
<p><kbd>mern-classroom/client/MainRouter.js</kbd>:</p>
<pre>&lt;PrivateRoute path="/seller/courses" component={MyCourses}/&gt;</pre>
<p>We use this frontend route in the <q><span class="packt_screen">TEACH</span></q> link on the menu, which directs a signed-in educator to this <kbd>MyCourses</kbd> view. In this view, users can click on each course in the list, and go to the page that shows the details of a specific course. I<span>n the next section, w</span>e will implement the feature to render an individual course.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Display a course</h1>
                </header>
            
            <article>
                
<p><span>Users on the MERN Classroom application, including visitors, signed-in students, and educators alike, will</span> <span>all</span> <span>be able to</span> br<span>owse through course pages, with interactions that are specific to their authorization level. In the following sections, we will start implementing the individual course view feature by adding a read course API to the backend, a way to call this API from the frontend, and the React component that will house the course detail view.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">A read course API</h1>
                </header>
            
            <article>
                
<p><span>In order to implement a read course API in the backend, we will start by declaring the <kbd>GET</kbd> route and the parameter-handling trigger, as shown in the following code.</span></p>
<p><kbd>mern-classroom/server/routes/course.routes.js</kbd><span>:</span></p>
<pre>router.route('/api/courses/:courseId')<br/>  .get(courseCtrl.read)<br/>router.param('courseId', courseCtrl.courseByID)</pre>
<p><span>We are adding this <kbd>GET</kbd> route to query the <kbd>Course</kbd> collection with an ID and return the corresponding course in the response. The </span><kbd>:courseId</kbd><span> param in the route URL will call the </span><kbd>courseByID</kbd><span> controller method, which is similar to the </span><kbd>userByID</kbd><span> controller method. It retrieves the course from the database, and attaches it to the request object that is to be used in the </span><kbd>next</kbd><span> method, as shown in the following code.</span></p>
<p><kbd>mern-classroom/server/controllers/course.controller.js</kbd><span>:</span></p>
<pre>const courseByID = async (req, res, next, id) =&gt; {<br/>  try {<br/>    let course = await Course.findById(id)<br/>                             .populate('instructor', '_id name')<br/>    if (!course)<br/>      return res.status('400').json({<br/>        error: "Course not found"<br/>      })<br/>    req.course = course<br/>    next()<br/>  } catch (err) {<br/>    return res.status('400').json({<br/>      error: "Could not retrieve course"<br/>    })<br/>  }<br/>}</pre>
<p>The course object that is queried from the database will also contain the name and ID details of the instructor, as we specified in the <kbd>populate()</kbd> method. The call to <kbd>next()</kbd> after this course object is attached to the request object invokes the <kbd>read</kbd> controller method. The<span> </span><kbd>read</kbd><span> </span>controller method then returns this<span> </span><kbd>course</kbd><span> </span>object in the response to the client, as shown in the following code.</p>
<p><kbd>mern-classroom/server/controllers/course.controller.js</kbd>:</p>
<pre>const read = (req, res) =&gt; {<br/>  req.course.image = undefined<br/>  return res.json(req.course)<br/>}</pre>
<p>We are removing the image field before sending the response, since images will be retrieved as files in separate routes. With this API ready in the backend, you can now add the implementation in order to call it in the frontend, by adding a <kbd>fetch</kbd> method in <kbd>api-course.js</kbd>, which is similar to other <kbd>fetch</kbd> methods that have already been added. We will use the <kbd>fetch</kbd> method to call the read course API in the React component that will render the course details, as discussed in the next section.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The Course component</h1>
                </header>
            
            <article>
                
<p>The <kbd>Course</kbd> component will render the individual course-specific details and user interactions, as pictured in the following screenshot:</p>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-800 image-border" src="assets/fffdec46-3596-46b0-b702-846913f132cd.png" style="width:24.83em;height:24.50em;"/></p>
<p class="mce-root">The completed <kbd>Course</kbd> component will contain the following parts:</p>
<ul>
<li>A section showing course details, which is visible to all visitors to this page. We will implement this part in this section.</li>
<li>A <q>Lessons</q> section, which contains a list of lessons and is visible to all visitors, and the option to add a new lesson, which will be visible only to the instructor of this course. We will implement the lessons part in the next section.</li>
<li><span class="packt_screen">Edit</span>, <span class="packt_screen">delete</span>, and <span class="packt_screen">publish</span> options, which are visible only to the instructor. This will be discussed later in the chapter.</li>
<li>An <q>Enroll</q> option, not pictured in the previous image,  which will only be visible after the course has been published by the instructor. This will be implemented later in the chapter.</li>
</ul>
<p>To start off the implementation of this <kbd>Course</kbd> component, we will first retrieve the course details with a fetch call to the read API in a <kbd>useEffect</kbd> hook, and then we will set the received values to state, as shown in the following code.</p>
<p><kbd><span>mern-classroom/client/course/Course.js</span></kbd></p>
<pre>export default function Course ({match}) {  <br/>  const [course, setCourse] = useState({instructor:{}})<br/>  const [values, setValues] = useState({<br/>      error: ''<br/>  }) <br/>  useEffect(() =&gt; {<br/>      const abortController = new AbortController()<br/>      const signal = abortController.signal<br/>  <br/>      read({courseId: match.params.courseId}, signal).then((data) =&gt; {<br/>        if (data.error) {<br/>          setValues({...values, error: data.error})<br/>        } else {<br/>          setCourse(data)<br/>        }<br/>      })<br/>    return function cleanup(){<br/>      abortController.abort()<br/>    }<br/>  }, [match.params.courseId])<br/>...<br/>}</pre>
<p><kbd>useEffect</kbd> will only run when <kbd>courseId</kbd> changes in the route params.</p>
<p>In the view, we will render the received details, such as course name, description, category, image, and a link to the instructor's user profile in a Material-UI <kbd>Card</kbd> component, as shown in the following code:</p>
<p><kbd><span>mern-classroom/client/course/Course.js</span></kbd></p>
<pre>&lt;Card&gt;<br/>    &lt;CardHeader<br/>          title={course.name}<br/>          subheader={&lt;div&gt;<br/>                        &lt;Link to={"/user/"+course.instructor._id}&gt;<br/>                           By {course.instructor.name}<br/>                        &lt;/Link&gt;<br/>                        &lt;span&gt;{course.category}&lt;/span&gt;<br/>                     &lt;/div&gt;<br/>                    }<br/>    /&gt;<br/>    &lt;CardMedia image={imageUrl} title={course.name} /&gt;<br/>    &lt;div&gt;<br/>         &lt;Typography variant="body1"&gt;<br/>              {course.description}<br/>         &lt;/Typography&gt;<br/>    &lt;/div&gt;<br/>&lt;/Card&gt;</pre>
<p><kbd>imageUrl</kbd> consists of the route that will retrieve the course image as a file response, and it is constructed as follows:</p>
<p><kbd><span>mern-classroom/client/course/Course.js</span></kbd></p>
<pre>const imageUrl = course._id<br/>          ? `/api/courses/photo/${course._id}?${new Date().getTime()}`<br/>          : '/api/courses/defaultphoto'</pre>
<p>When the course instructor is signed in and views the course page, we will render the edit and other course data-modifying options in the Course component. For now, we will only look at how the <kbd>edit</kbd> option is added conditionally to the view code: </p>
<p><kbd><span>mern-classroom/client/course/Course.js</span></kbd></p>
<pre>{auth.isAuthenticated().user &amp;&amp; auth.isAuthenticated().user._id == course.instructor._id &amp;&amp;<br/>    (&lt;span&gt;&lt;Link to={"/teach/course/edit/" + course._id}&gt;<br/>               &lt;IconButton aria-label="Edit" color="secondary"&gt;<br/>                  &lt;Edit/&gt;<br/>               &lt;/IconButton&gt;<br/>           &lt;/Link&gt;<br/>     &lt;/span&gt;)<br/>}</pre>
<p>If the current user is signed in, and their ID matches with the course instructor's ID, only then will the <q><span class="packt_screen">Edit</span></q> option be rendered. This part will be edited further in upcoming sections, in order to show the publish and delete options. </p>
<p>In order to load this Course component in the frontend, we will add a route to <kbd>MainRouter</kbd> as follows:</p>
<pre>&lt;Route path="/course/:courseId" component={Course}/&gt;</pre>
<p>This route URL (<kbd>/course/:courseId</kbd>) can now be added into any component to link to a specific course, with the <kbd>:courseId</kbd> param replaced with the course's ID value. Clicking on the link will take the user to the corresponding Course view. </p>
<p>We now have the <span>r</span><span>elevant backend model and API endpoints integrated with the frontend views,</span> <span>meaning that we have a functioning implementation of</span> the new course creation, a course listing by the instructor, and single-course display features. We can now move on to extending these implementations further, giving instructors the ability to add lessons to each course and update the course as desired, before publishing it.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Updating courses with lessons</h1>
                </header>
            
            <article>
                
<p>Each course in the MERN Classroom will contain a list of lessons that make up the course content and what the students need to cover when they enroll. We will keep the lesson structure simple for this application, putting more emphasis on the implementation of managing lessons and allowing students to go through lessons in order to complete a course. In the following sections, we will focus on the implementation of managing lessons for a course, and we will also look at how to update an existing course—either to edit details or to delete the course. First, we will look into how to store lesson details, then we will implement the full-stack features to allow instructors to add lessons, update lessons, update details of the course, and delete a course.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Storing lessons</h1>
                </header>
            
            <article>
                
<p><span>We need to define the lesson data structure and associate it with the course data structure before we can store and retrieve lesson details for each course.</span></p>
<p><span>We will start by defining the Lesson model, with a schema containing the title,</span> <span>the</span> <span>content, and the resource URL fields of the string</span> <span>type</span><span>, as shown in the following code.</span><span> </span></p>
<p><kbd>mern-classroom/server/models/course.model.js</kbd></p>
<pre>const LessonSchema = new mongoose.Schema({<br/>  title: String,<br/>  content: String,<br/>  resource_url: String<br/>})<br/>const Lesson = mongoose.model('Lesson', LessonSchema)</pre>
<p><span>These schemas will let educators create and store basic lessons for their courses. To integrate lessons with the course structure, we will add a field called <kbd>lessons</kbd> in the Course model, which will store an array of lesson documents, as shown in the following code:</span></p>
<p><kbd><span>mern-classroom/server/models/course.model.js</span></kbd></p>
<pre style="padding-left: 60px">lessons: [LessonSchema]</pre>
<p>With this updated Course schema and model, we can now proceed with the implementations that will allow educators to add lessons to their course, as discussed in the next section.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Adding new lessons</h1>
                </header>
            
            <article>
                
<p>Educators on the MERN Classroom application will be able to add new lessons to the courses that they are still building and have not yet published. In the following sections, we will make this feature possible, first by implementing a backend API that adds lessons to an existing course, then by creating a frontend form view for entering and sending the new lesson details, and finally, by displaying the newly added lessons on the Course page.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Adding a lesson API</h1>
                </header>
            
            <article>
                
<p>In order to implement a backend API that will allow us to add and store new lessons for a given course, we first need to declare a <kbd>PUT</kbd> route as follows:</p>
<p><kbd>mern-classroom/server/routes/course.routes.js</kbd><span>:</span></p>
<pre>router.route('/api/courses/:courseId/lesson/new')<br/>  .put(authCtrl.requireSignin, <br/>                    courseCtrl.isInstructor,         <br/>                          courseCtrl.newLesson)</pre>
<p>When this route gets a <kbd>PUT</kbd> request with the course ID in the URL, we will first use the <kbd>isInstructor</kbd> method to check whether the current user is the instructor for the course, and then we will save the lesson in the database with the <kbd>newLesson</kbd> method. The <span><kbd>isInstructor</kbd> controller method will be defined as follows:</span></p>
<p><kbd>mern-classroom/server/controllers/course.controller.js</kbd><span>:</span></p>
<pre>const isInstructor = (req, res, next) =&gt; {<br/>    const isInstructor = req.course &amp;&amp; req.auth &amp;&amp;     <br/>                         req.course.instructor._id == req.auth._id<br/>    if(!isInstructor){<br/>      return res.status('403').json({<br/>        error: "User is not authorized"<br/>      })<br/>    }<br/>    next()<br/>}</pre>
<p>With the <kbd>isInstructor</kbd> method, we first check whether the signed-in user has the same user ID as the instructor of the given course. If the user is not authorized, an error is returned in the response, otherwise the <kbd>next()</kbd> middleware is invoked in order to execute the <kbd>newLesson</kbd> method. This <kbd>newLesson</kbd> controller method is defined as follows:</p>
<p><kbd>mern-classroom/server/controllers/course.controller.js</kbd><span>:</span></p>
<pre>const newLesson = async (req, res) =&gt; {<br/>  try {<br/>    let lesson = req.body.lesson<br/>    let result = await Course.findByIdAndUpdate(req.course._id, <br/>                                              {$push: {lessons: lesson}, <br/>                                                updated: Date.now()}, <br/>                                                {new: true})<br/>                            .populate('instructor', '_id name')<br/>                            .exec()<br/>    res.json(result)<br/>  } catch (err) {<br/>    return res.status(400).json({<br/>      error: errorHandler.getErrorMessage(err)<br/>    })<br/>  }<br/>}</pre>
<p>In this <kbd>newLesson</kbd> controller method, we use <kbd>findByIdAndUpdate</kbd> (from MongoDB) to find the corresponding course document, and we update its <kbd>lessons</kbd> array field by pushing the new lesson object that was received in the request body. </p>
<p>In order to access this API to add a new lesson in the frontend, you will also need to add a corresponding fetch method, as we did for other API implementations. </p>
<p>This API will be used in a form-based component that will take input from the user for each new lesson and then send it to the backend. We will implement this form-based component in the next section.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The NewLesson component</h1>
                </header>
            
            <article>
                
<p>In each course, while it is still unpublished, the instructor will be able to add a lesson by filling out a form. In order to implement this form view to add new lessons, we will create a React component called <kbd>NewLesson</kbd>, which will be added to the <kbd>Course</kbd> component. This component will render the following form in a dialog box in the Course page:</p>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-801 image-border" src="assets/0e088ba9-d2de-4436-8286-8d24dd7d0cc0.png" style="width:14.42em;height:10.83em;"/></p>
<p>While defining the <kbd>NewLesson</kbd> component<span>, </span>we will first initialize the form values in the state with the <kbd>useState</kbd> hook. This component will also receive <kbd>props</kbd> from the Course component, as shown in the following code.</p>
<p><kbd><span>mern-classroom/client/course/NewLesson.js</span></kbd></p>
<pre>export default function NewLesson(props) {<br/>  const [open, setOpen] = useState(false)<br/>  const [values, setValues] = useState({<br/>    title: '',<br/>    content: '',<br/>    resource_url: ''<br/>  })<br/>...<br/>}<br/>NewLesson.propTypes = {<br/>    courseId: PropTypes.string.isRequired,<br/>    addLesson: PropTypes.func.isRequired<br/>}</pre>
<p>The <kbd>NewLesson</kbd> component will receive the <kbd>courseId</kbd> value and an <kbd>addLesson</kbd> function as <kbd>props</kbd> from the parent component to which it will be added; in this case from the <kbd>Course</kbd> component. We make these required props by adding <kbd>PropTypes</kbd> validation to <kbd>NewLesson</kbd>. These <kbd>props</kbd> will be needed in this component when the form is submitted.</p>
<p>Next, we will add the button to toggle the dialog that will contain the form, as shown in the following code.</p>
<p><kbd><span>mern-classroom/client/course/NewLesson.js</span></kbd></p>
<pre>&lt;Button aria-label="Add Lesson" color="primary" variant="contained" <br/>        onClick={handleClickOpen}&gt;<br/>   &lt;Add/&gt; New Lesson<br/>&lt;/Button&gt;<br/>&lt;Dialog open={open} onClose={handleClose} aria-labelledby="form-dialog-   title"&gt;<br/>   &lt;div className={classes.form}&gt;<br/>      &lt;DialogTitle id="form-dialog-title"&gt;Add New Lesson&lt;/DialogTitle&gt;<br/>            ...<br/>      &lt;DialogActions&gt;<br/>        &lt;Button onClick={handleClose} <br/>           color="primary" variant="contained"&gt;<br/>            Cancel<br/>        &lt;/Button&gt;<br/>        &lt;Button onClick={clickSubmit} <br/>            color="secondary" variant="contained"&gt;<br/>            Add<br/>        &lt;/Button&gt;<br/>      &lt;/DialogActions&gt;<br/>   &lt;/div&gt;<br/>&lt;/Dialog&gt;</pre>
<p>The Material-UI <kbd>Dialog</kbd> component stays open or closed, depending on the state of the <kbd>open</kbd> variable. We update the <kbd>open</kbd> value in the following functions, which are called on dialog open and close actions.</p>
<p><kbd><span>mern-classroom/client/course/NewLesson.js</span></kbd></p>
<pre>const handleClickOpen = () =&gt; {<br/>   setOpen(true)<br/>}<br/><br/>const handleClose = () =&gt; {<br/>   setOpen(false)<br/>}</pre>
<p>The form fields for entering the new lesson's title, content, and resource URL values are added inside the <kbd>Dialog</kbd> component using <kbd>TextFields</kbd> in <kbd>DialogContent</kbd>, as shown with the following code: </p>
<p><kbd><span>mern-classroom/client/course/NewLesson.js</span></kbd></p>
<pre>&lt;DialogContent&gt;<br/>     &lt;TextField label="Title" type="text" fullWidth<br/>                value={values.title} onChange={handleChange('title')} /&gt;<br/>     &lt;br/&gt;<br/>     &lt;TextField label="Content" type="text" multiline rows="5" fullWidth<br/>             value={values.content} onChange={handleChange('content')}/&gt;<br/>     &lt;br/&gt;<br/>     &lt;TextField label="Resource link" type="text" fullWidth<br/>                value={values.resource_url} <br/>                onChange={handleChange('resource_url')} /&gt;<br/>     &lt;br/&gt;<br/>&lt;/DialogContent&gt;</pre>
<p>Values that are entered in the input fields are captured with the <kbd>handleChange</kbd> function, which is defined as follows:</p>
<p><kbd><span>mern-classroom/client/course/NewLesson.js</span></kbd></p>
<pre>const handleChange = name =&gt; event =&gt; {<br/>    setValues({ ...values, [name]: event.target.value })<br/>}</pre>
<p>Finally, when the form is submitted, we will send the new lesson details to the server in the <kbd>clickSubmit</kbd> function, as shown in the following code.</p>
<p><kbd><span>mern-classroom/client/course/NewLesson.js</span></kbd></p>
<pre>const clickSubmit = () =&gt; {<br/>    const jwt = auth.isAuthenticated()<br/>    const lesson = {<br/>      title: values.title || undefined,<br/>      content: values.content || undefined,<br/>      resource_url: values.resource_url || undefined<br/>    }<br/>    newLesson({<br/>      courseId: props.courseId<br/>    }, {<br/>      t: jwt.token<br/>    }, lesson).then((data) =&gt; {<br/>      if (data &amp;&amp; data.error) {<br/>        setValues({...values, error: data.error})<br/>      } else {<br/>          props.addLesson(data)<br/>          setValues({...values, title: '',<br/>          content: '',<br/>          resource_url: ''})<br/>          setOpen(false)<br/>      }<br/>    })<br/>  }</pre>
<p>The lesson details are sent in the request to the add lesson API with the course ID received as a prop from the Course component.  On a successful update response from the server, besides <span>emptying the form fields, </span>the <kbd>addLesson</kbd> update function, which was passed as a prop, is executed to render the latest lessons in the Course component. The <kbd>addLesson</kbd> function to be passed in from the <kbd>Course</kbd> component is defined as follows:</p>
<p><kbd><span>mern-classroom/client/course/Course.js</span></kbd></p>
<pre>const addLesson = (course) =&gt; {<br/>    setCourse(course)<br/>}</pre>
<p>The <kbd>NewLesson</kbd> component that is added to the Course component should only render if the current user is the instructor of the course, and if the course is still unpublished. To do this check and conditionally render the <kbd>NewLesson</kbd> component, we can add the following code to the Course component:</p>
<p><kbd><span>mern-classroom/client/course/Course.js</span></kbd></p>
<pre>{ auth.isAuthenticated().user &amp;&amp; <br/>  auth.isAuthenticated().user._id == course.instructor._id &amp;&amp; <br/>  !course.published &amp;&amp;<br/>            (&lt;NewLesson courseId={course._id} addLesson={addLesson}/&gt;)<br/>}</pre>
<p>This will allow educators on the application to add lessons to their courses. Next, we will add the code to render these lessons on the Course page. </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Displaying lessons</h1>
                </header>
            
            <article>
                
<p>The lessons for a specific course will be rendered in a list—along with a tally of the total number of lessons—on the Course page below the other course details, as pictured in the following screenshot:</p>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-802 image-border" src="assets/08138368-6b29-470f-906c-6496f7bee367.png" style="width:11.42em;height:12.83em;"/></p>
<p>To render this list of lessons, we will update the <kbd>Course</kbd> component to iterate over the array of lessons with a <kbd>map</kbd> function, and each lesson will be displayed in a Material-UI <kbd>ListItem</kbd> component, as shown in the following code.</p>
<p><kbd><span>mern-classroom/client/course/Course.js</span></kbd></p>
<pre>&lt;List&gt;<br/>    {course.lessons &amp;&amp; course.lessons.map((lesson, index) =&gt; {<br/>       return(&lt;span key={index}&gt;<br/>                   &lt;ListItem&gt;<br/>                      &lt;ListItemAvatar&gt;<br/>                        &lt;Avatar&gt; {index+1} &lt;/Avatar&gt;<br/>                      &lt;/ListItemAvatar&gt;<br/>                      &lt;ListItemText primary={lesson.title} /&gt;<br/>                   &lt;/ListItem&gt;<br/>                   &lt;Divider variant="inset" component="li" /&gt;<br/>              &lt;/span&gt;)<br/>    })}<br/>&lt;/List&gt;</pre>
<p>The number beside each list item is calculated using the current index value of the array. The total number of lessons can also be displayed by accessing <kbd>course.lessons.length</kbd>. </p>
<p>Now that instructors can add and view lessons for each course, <span>in the next section </span>we will implement the ability to update these added lessons, besides modifying other course details. </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Editing a course </h1>
                </header>
            
            <article>
                
<p>Once a course has been added by an educator and there are more updates to be incorporated, the educator will be able to edit the details of the course as its instructor. Editing a course includes the ability to update its lessons, as well. To implement this capability in the application, first, we will have to create a backend API that allows the update operation on a given course.</p>
<p>Then, this updated API needs to be accessed in frontend with the changed details of the course and its lessons. In the following sections, we will build this backend API and the <kbd>EditCourse</kbd> React component, which will allow instructors to change the course details and lessons.   </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Updating the course API</h1>
                </header>
            
            <article>
                
<p>In the backend, we will need an API that allows an existing course to be updated if the user who is making the request is the authorized instructor of the given course. We will first declare the PUT route that accepts the update request from the client, as follows:</p>
<p><kbd>mern-classroom/server/routes/course.routes.js</kbd><span>:</span></p>
<pre>router.route('/api/courses/:courseId')<br/>  .put(authCtrl.requireSignin, courseCtrl.isInstructor, <br/>            courseCtrl.update)</pre>
<p>A <kbd>PUT</kbd> request that is received at the <kbd>/api/courses/:courseId</kbd> route first checks if the signed-in user is the instructor of the course that is associated with the <kbd>courseId</kbd> provided in the URL. If the user is found to be authorized, the <kbd>update</kbd> controller is invoked. The <kbd>update</kbd> method in the course controller is defined as shown in the following code.</p>
<p><kbd>mern-classroom/server/controllers/course.controller.js</kbd><span>:</span></p>
<pre>const update = (req, res) =&gt; {<br/>  let form = new formidable.IncomingForm()<br/>  form.keepExtensions = true<br/>  form.parse(req, async (err, fields, files) =&gt; {<br/>    if (err) {<br/>      return res.status(400).json({<br/>        error: "Photo could not be uploaded"<br/>      })<br/>    }<br/>    let course = req.course<br/>    course = extend(course, fields)<br/>    <strong>if(fields.lessons){</strong><br/><strong>      course.lessons = JSON.parse(fields.lessons)</strong><br/><strong>    }</strong><br/>    course.updated = Date.now()<br/>    if(files.image){<br/>      course.image.data = fs.readFileSync(files.image.path)<br/>      course.image.contentType = files.image.type<br/>    }<br/>    try {<br/>      await course.save()<br/>      res.json(course)<br/>    } catch (err) {<br/>      return res.status(400).json({<br/>        error: errorHandler.getErrorMessage(err)<br/>      })<br/>    }<br/>  })<br/>}<br/><br/></pre>
<p>As the request body may contain a file upload, we are using <kbd>formidable</kbd> here to parse the multipart data. The lessons array is an array of nested objects, and we need to specifically parse and assign the lessons array to the course before saving it. As we will see in the next section, the lessons array that is sent from the frontend will be stringified before sending, so in this controller, we need to additionally check whether the lessons field was received, and assign it separately after parsing it. </p>
<p>To use this API in the frontend, you will need to define a fetch method that takes the course ID, user auth credentials, and the updated course details, in order to make the fetch call to this update course API—as we have done for other API implementations.</p>
<p>We now have a course update API that can be used in the frontend to update details of a course. We will use this in the <kbd>EditCourse</kbd> component, which is discussed next.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The EditCourse component </h1>
                </header>
            
            <article>
                
<p>In the frontend, we will add a view for editing a course and it will have two sections. The first part will let the user change the course details, including the name, category, description, and image; and the second part will allow the modification of the lessons for the course. The first part of this course is pictured in the following screenshot:</p>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-803 image-border" src="assets/e38bfc81-5f6a-4667-a47b-3c28cbb33443.png" style="width:23.92em;height:17.83em;"/></p>
<p>To implement this view, we will define a React component named <kbd>EditCourse</kbd>. This component will first load the course details by calling the <kbd>read</kbd> fetch method in the <kbd>useEffect</kbd> hook, as shown in the following code. </p>
<p><kbd><span>mern-classroom/client/course/EditCourse.js</span></kbd></p>
<pre>  useEffect(() =&gt; {<br/>      const abortController = new AbortController()<br/>      const signal = abortController.signal<br/>  <br/>      read({courseId: match.params.courseId}, signal).then((data) =&gt; {<br/>        if (data.error) {<br/>          setValues({...values, error: data.error})<br/>        } else {<br/>          setCourse(data)<br/>        }<br/>      })<br/>    return function cleanup(){<br/>      abortController.abort()<br/>    }<br/>  }, [match.params.courseId])</pre>
<p>After successfully receiving the course data in the response, it will be set to the <kbd>course</kbd> variable in the state by calling <kbd>setCourse</kbd>, and it will be used to populate the view. The first part of this view will render the course details similar to the Course view but using <kbd>TextFields</kbd> instead, with an option to upload a new image and a <span class="packt_screen">Save</span> button to make the update call, as shown in the following code.</p>
<p><kbd><span>mern-classroom/client/course/EditCourse.js</span></kbd></p>
<pre>&lt;CardHeader title={&lt;<strong>TextField</strong> label="Title" type="text" fullWidth<br/>    value={course.name} onChange={handleChange('name')}/&gt;}<br/>            subheader={&lt;div&gt;&lt;Link to={"/user/"+course.instructor._id}&gt;<br/>                               By {course.instructor.name}<br/>                            &lt;/Link&gt;<br/>  {&lt;<strong>TextField</strong> label="Category" type="text" fullWidth<br/>      value={course.category} <br/>        onChange={handleChange('category')}/&gt;}<br/>                       &lt;/div&gt;}<br/>            action={&lt;Button variant="contained" color="secondary" <br/>                            onClick={updateCourse}&gt;<strong>Save</strong>&lt;/Button&gt;}<br/>/&gt;<br/>&lt;div className={classes.flex}&gt;<br/>   &lt;CardMedia image={imageUrl} title={course.name}/&gt;<br/>   &lt;div className={classes.details}&gt;<br/>      &lt;<strong>TextField</strong> multiline rows="5" label="Description" type="text"<br/>                 value={course.description} <br/>                 onChange={handleChange('description')} /&gt;&lt;br/&gt;<br/>      &lt;input accept="image/*" <br/>         onChange={handleChange('image')}  type="file" /&gt;<br/>      &lt;label htmlFor="icon-button-file"&gt;<br/>        &lt;Button variant="outlined" color="secondary" component="span"&gt;<br/>          <strong>Change Photo</strong><br/>          &lt;FileUpload/&gt;<br/>        &lt;/Button&gt;<br/>      &lt;/label&gt; &lt;span&gt;{course.image ? course.image.name : ''}&lt;/span&gt;&lt;br/&gt;<br/>   &lt;/div&gt;<br/>&lt;/div&gt;</pre>
<p>The changes to the input fields will be handled in order to capture the newly entered values with the <kbd>handleChange</kbd> method, which is defined as follows.</p>
<p><kbd><span>mern-classroom/client/course/EditCourse.js</span></kbd></p>
<pre>  const handleChange = name =&gt; event =&gt; {<br/>    const value = name === 'image'<br/>    ? event.target.files[0]<br/>    : event.target.value<br/>    setCourse({ ...course, [name]: value })<br/>  }</pre>
<p>When the <span class="packt_screen">Save</span> button is clicked, we will get all the course details and set it to <kbd>FormData</kbd>, which will be sent <span>in the multipart format </span>to the backend using the course update API. The <kbd>clickSubmit</kbd> function that is called on saving will be defined as follows:</p>
<p><kbd><span>mern-classroom/client/course/EditCourse.js</span></kbd></p>
<pre>const clickSubmit = () =&gt; {<br/>    let courseData = new FormData()<br/>    course.name &amp;&amp; courseData.append('name', course.name)<br/>    course.description &amp;&amp; courseData.append('description'<br/>        , course.description)<br/>    course.image &amp;&amp; courseData.append('image', course.image)<br/>    course.category &amp;&amp; courseData.append('category', course.category)<br/>    courseData.append('lessons', JSON.stringify(course.lessons))<br/>    update({<br/>        courseId: match.params.courseId<br/>      }, {<br/>        t: jwt.token<br/>      }, courseData).then((data) =&gt; {<br/>        if (data &amp;&amp; data.error) {<br/>            console.log(data.error)<br/>          setValues({...values, error: data.error})<br/>        } else {<br/>          setValues({...values, redirect: true})<br/>        }<br/>      })<br/>  }</pre>
<p>The course lessons are also sent in this <kbd>FormData</kbd>, but <span>as lessons are stored as an array of nested objects and</span> <kbd>FormData</kbd> only accepts simple key-value pairs, we stringify the <kbd>lessons</kbd> value before assigning it.</p>
<p>In order to load <kbd>EditCourse</kbd> in the frontend of the application, we need to declare a frontend route for it. This component can only be viewed by a signed-in user who is also the instructor of the course. So, we will add a <kbd>PrivateRoute</kbd><span> </span>in the<span> </span><kbd>MainRouter</kbd><span> </span>component, which will render this view only for authorized users at <kbd>/teach/course/edit/:courseId</kbd>.</p>
<p><kbd>mern-marketplace/client/MainRouter.js</kbd>:</p>
<pre>&lt;PrivateRoute path="/teach/course/edit/:courseId" component={EditCourse}/&gt;</pre>
<p>This link is added in the Course view in order to allow access to the <kbd>EditCourse</kbd> page.</p>
<p>We have looked at how to update and send the course details, along with all the lessons to the backend on saving, but we are left with the interface for editing the course lessons. In the following section, we will finish up the <kbd>EditCourse</kbd> component by looking into the implementation for updating course lessons. </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Updating lessons</h1>
                </header>
            
            <article>
                
<p>In order to allow instructors to update the lessons that they have added to a course, we will add the following section in the <kbd>EditCourse</kbd> component, which will allow the user to edit the lesson details, rearrange the order of the lessons, and delete a lesson:</p>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-804 image-border" src="assets/ba607512-7c5f-4c46-a33c-602a1c8e0601.png" style="width:29.25em;height:24.83em;"/></p>
<p>The implementation of these lesson update features will mostly rely on array manipulation techniques. In the following sections, we will add the interface for an individual lesson in the list, and discuss how the edit, move, and delete functionalities are implemented. </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Editing lesson details</h1>
                </header>
            
            <article>
                
<p>Users will be able to edit the details of each field in a lesson in the <kbd>EditCourse</kbd> component. In the view, each item in the list of lessons will contain three <kbd>TextFields</kbd> for each of the fields in a lesson. These will be prepopulated with the existing values of the fields as shown in the following code. </p>
<p><kbd><span>mern-classroom/client/course/EditCourse.js</span></kbd></p>
<pre>&lt;ListItemText<br/>  primary={&lt;&gt;&lt;TextField label="Title" type="text" fullWidth<br/>                        value={lesson.title} <br/>                        onChange={handleLessonChange('title', index)} /&gt;<br/>                        &lt;br/&gt;<br/>            &lt;TextField multiline rows="5" label="Content" type="text"<br/>                       fullWidth value={lesson.content} <br/>                       onChange={handleLessonChange('content', index)}/&gt;<br/>                       &lt;br/&gt;<br/>             &lt;TextField label="Resource link" type="text" fullWidth<br/>                        value={lesson.resource_url} <br/>                  onChange={handleLessonChange('resource_url', index)}/&gt;<br/>                  &lt;br/&gt;<br/>          &lt;/&gt;}<br/>/&gt;</pre>
<p>In order to handle the changes made to the values in each field, we will define a <kbd>handleLessonChange</kbd> method, which will take the field name and the corresponding lesson's index in the array. The <span><kbd>handleLessonChange</kbd> method will be defined as follows:</span></p>
<p><kbd><span>mern-classroom/client/course/EditCourse.js</span></kbd></p>
<pre>const handleLessonChange = (name, index) =&gt; event =&gt; {<br/>    const lessons = course.lessons<br/>    lessons[index][name] = event.target.value<br/>    setCourse({ ...course, lessons: lessons })<br/>}</pre>
<p>The lessons array in the course is updated in the state, after setting the value in the specified field of the lesson at the provided index. This updated course with the modified lesson will get saved to the database when the user clicks <span class="packt_screen">Save</span> in the <kbd>EditCourse</kbd> view. Next, we will look at how we can allow the user to rearrange the order of the lessons.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Moving the lessons to rearrange the order</h1>
                </header>
            
            <article>
                
<p>While updating lessons, the user will also be able to reorder each lesson on the list. There will be an up arrow button for each lesson, except for the very first lesson. This button will be added to each lesson item in the view as follows: </p>
<p><kbd><span>mern-classroom/client/course/EditCourse.js</span></kbd></p>
<pre>{ index != 0 &amp;&amp; <br/>    &lt;IconButton color="primary" onClick={moveUp(index)}&gt;<br/>         &lt;ArrowUp /&gt;<br/>    &lt;/IconButton&gt;<br/>}</pre>
<p>When the user clicks this button, the lesson in the current index will be moved up, and the lesson above it will be moved to its place in the array. The <kbd>moveUp</kbd> function will implement this behavior as follows:</p>
<p><kbd><span>mern-classroom/client/course/EditCourse.js</span></kbd></p>
<pre>const moveUp = index =&gt; event =&gt; {<br/>      const lessons = course.lessons<br/>      const moveUp = lessons[index]<br/>      lessons[index] = lessons[index-1]<br/>      lessons[index-1] = moveUp<br/>      setCourse({ ...course, lessons: lessons })<br/>}</pre>
<p>The rearranged lessons array is then updated in the state, and will be saved to the database when the user saves the changes in the <kbd>EditCourse</kbd> page. Next, we will implement the option to delete a lesson from the list.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Deleting a lesson</h1>
                </header>
            
            <article>
                
<p>In the <kbd>EditCourse</kbd> page, each item rendered in the lessons list will have a delete option. The <span class="packt_screen">Delete</span> button will be added in the view to each list item as follows:</p>
<p><kbd><span>mern-classroom/client/course/EditCourse.js</span></kbd></p>
<pre>&lt;ListItemSecondaryAction&gt;<br/>     &lt;IconButton edge="end" aria-label="up" color="primary" <br/>                onClick={deleteLesson(index)}&gt;<br/>           &lt;DeleteIcon /&gt;<br/>     &lt;/IconButton&gt;<br/>&lt;/ListItemSecondaryAction&gt;}</pre>
<p>When the <span class="packt_screen">Delete</span> button is clicked, we will take the index of the lesson that is being deleted and remove it from the <kbd>lessons</kbd> array. The <kbd>deleteLesson</kbd> function, which is called when the button is clicked, is defined as follows:</p>
<p><kbd><span>mern-classroom/client/course/EditCourse.js</span></kbd></p>
<pre>const deleteLesson = index =&gt; event =&gt; {<br/>    const lessons = course.lessons<br/>    lessons.splice(index, 1)<br/>    setCourse({...course, lessons:lessons})<br/>}</pre>
<p>In this function, we are splicing the array to remove the lesson from the given index, then adding the updated array in the course in the state. This new lesson array will be sent to the database with the course object when the user clicks the <span class="packt_screen">Save</span> button in the <kbd>EditCourse</kbd> page. </p>
<p>This wraps up the three different ways an instructor can change the lessons for their course. With these implementations using array manipulation techniques integrated with the React component's features, the users can now edit the details, rearrange the order, and delete a lesson. In the next section, we will discuss the only remaining feature for modifying a course, which is the ability to delete it from the database.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Deleting a course</h1>
                </header>
            
            <article>
                
<p>In the MERN Classroom application, instructors will be able to permanently delete courses if the course has not been published already. In order to allow an instructor to delete a course, first, we will define a backend API for course deletion from the database, and then implement a React component that makes use of this API when the user interacts with the frontend to perform this deletion.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The delete course API</h1>
                </header>
            
            <article>
                
<p>In order to implement a backend API that takes a request to delete a specified course from the database, we will first define a DELETE route as shown in the following code.</p>
<p><kbd>mern-classroom/server/routes/course.routes.js</kbd><span>:</span></p>
<pre>router.route('/api/courses/:courseId')<br/>  .delete(authCtrl.requireSignin, courseCtrl.isInstructor, <br/>            courseCtrl.remove)</pre>
<p>This DELETE route takes the course ID as a URL parameter and checks if the current user is signed in and authorized to perform this delete, before proceeding to the <kbd>remove</kbd> controller method, which is defined in the following code.</p>
<p><kbd>mern-classroom/server/controllers/course.controller.js</kbd><span>:</span></p>
<pre>const remove = async (req, res) =&gt; {<br/>  try {<br/>    let course = req.course<br/>    let deleteCourse = await course.remove()<br/>    res.json(deleteCourse)<br/>  } catch (err) {<br/>    return res.status(400).json({<br/>      error: errorHandler.getErrorMessage(err)<br/>    })<br/>  }<br/>}</pre>
<p>The <kbd>remove</kbd> method simply deletes the course document that corresponds to the provided ID from the Courses collection in the database. To access this backend API in the frontend, you will also need a fetch method with this route; similar to other API implementations. The fetch method will need to take the course ID and current user's auth credentials, then call the delete API with these values.</p>
<p>The fetch method will be used when the user performs the delete operation by clicking a button on the interface. In the next section, we will discuss a React component called <kbd>DeleteCourse</kbd>, which is where this interaction will take place.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The DeleteCourse component</h1>
                </header>
            
            <article>
                
<p><span>The instructor for a course will see a delete option on the Course page when they are logged in and they are viewing an unpublished course. This delete option will be implemented in its own React component called <kbd>DeleteCourse</kbd>, and this component will be added to the <kbd>Course</kbd> component. The </span><kbd>DeleteCourse</kbd><span> component</span> <span>is basically a button, which, when clicked, opens a </span><kbd>Dialog</kbd><span> component asking the user to confi</span><span>rm the </span><kbd>delete</kbd><span> action, as shown in the following screenshot: </span></p>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-805 image-border" src="assets/68180458-7c68-41a3-b3c3-36ddb3099636.png" style="width:19.83em;height:7.50em;"/></p>
<p>The implementation of the <kbd>DeleteCourse</kbd> component is similar to the <kbd>DeleteUser</kbd> component, as discussed in <a href="6f2ca10a-8079-4e3a-9d42-a3db8e85b9d9.xhtml" target="_blank">Chapter 4</a>, <em>Adding a React Frontend to Complete MERN</em>. Instead of a user ID, the <kbd>DeleteCourse</kbd> component will take the course ID and the <kbd>onRemove</kbd> function definition from the <kbd>Course</kbd> component as props, when it is added to <kbd>Course</kbd>, as shown in the following code:</p>
<p><kbd><span>mern-classroom/client/course/Course.js</span></kbd></p>
<pre>&lt;DeleteCourse course={course} onRemove={removeCourse}/&gt;</pre>
<p>With this implementation, course instructors will be able to remove a course from the platform. </p>
<p>In this section, we added the ability to add lessons to a course by extending the Course model and implementing a Lesson model. Then, we added the necessary backend APIs and user interface updates to be able to add lessons, modify course details and lessons, and delete lessons and courses. The course module is now ready for us to implement the ability to publish a course and make it available on the application for enrollment. We will discuss this publishing feature in the next section. </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Publishing courses</h1>
                </header>
            
            <article>
                
<p>In the MERN Classroom, only courses that are published will be available to other users on the platform for enrollment. Once an instructor has created the course and updated it with lessons, they will have the option to publish it. Published courses will be listed on the home page, and all visitors will be able to view them. In the rest of this section, we will look into the implementation of allowing instructors to publish a course and listing these published courses in the frontend.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Implementing the publish option</h1>
                </header>
            
            <article>
                
<p>Instructors for each course will be given the option to publish their course after they have added at least one lesson to the course. Publishing a course will also mean that the course can no longer be deleted, new lessons cannot be added, and existing lessons cannot be deleted. So, when the instructors choose to publish, they will be asked to confirm the action. In this section, we will look at how to use and extend the existing course module in order to integrate this publishing feature. </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Publish button states</h1>
                </header>
            
            <article>
                
<p>In the course view, when the instructor is logged in, they will see the <span class="packt_screen">PUBLISH</span> button in three states, depending on whether the course can be published or not, and whether it is already published, as shown in the following screenshot:</p>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-806 image-border" src="assets/69f3873d-af19-467c-8b4c-b4fbf2bba923.png" style="width:35.25em;height:2.75em;"/></p>
<p>The states of this button will primarily depend on whether the <kbd>published</kbd> attribute of the course document is set to <kbd>true</kbd> or <kbd>false</kbd>, and on the length of the <kbd>lessons</kbd> array. The button will be added to the <kbd>Course</kbd> component, as shown in the following code:</p>
<p><kbd><span>mern-classroom/client/course/Course.js</span></kbd></p>
<pre>{ <strong>!course.published</strong> ? <br/>            (&lt;&gt; &lt;Button color="secondary" variant="outlined" <br/>                        onClick={clickPublish}&gt;<br/>                   { <strong>course.lessons.length == 0</strong> ? <br/>                           "Add atleast 1 lesson to publish" <br/>                           : "Publish" }<br/>                &lt;/Button&gt;<br/>                &lt;DeleteCourse course={course} onRemove={removeCourse}/&gt;<br/>            &lt;/&gt;) : (<br/>                  &lt;Button color="primary" <br/>                          variant="outlined"&gt;Published&lt;/Button&gt;<br/>            )<br/>}</pre>
<p>The delete option will only be rendered if the course is not already published. When the <span class="packt_screen">PUBLISH</span> button is clicked, we will open a dialog asking the user for confirmation. The <kbd>clickPublish</kbd> function will be called when the button is clicked, and is defined as follows:</p>
<p><kbd><span>mern-classroom/client/course/Course.js</span></kbd></p>
<pre>const clickPublish = () =&gt; {<br/>    if(course.lessons.length &gt; 0){ <br/>      setOpen(true)<br/>    }<br/>  }</pre>
<p>The <kbd>clickPublish</kbd> function will only open the dialog box if the length of the lessons array is more than zero; preventing the instructor from publishing a course without any lessons. Next, we will add the dialog box, which will let the instructor publish the course after confirmation.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Confirm to publish</h1>
                </header>
            
            <article>
                
<p>When the instructor clicks on the <span class="packt_screen">PUBLISH</span> button, they will see a dialog box informing them of the consequences of this action, and giving them the options to <span class="packt_screen">PUBLISH</span> the course or <span class="packt_screen">CANCEL</span> the action. The dialog box will look as follows:</p>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-807 image-border" src="assets/1b3f4aba-d4f8-4ed4-bb24-f3b8fa232b18.png" style="width:26.50em;height:8.92em;"/></p>
<p>To implement this dialog box, we will use the Material-UI <kbd>Dialog</kbd> component with the title and content text, and the <span class="packt_screen">PUBLISH</span> and <span class="packt_screen">CANCEL</span> buttons, as shown in the following code.</p>
<p><kbd><span>mern-classroom/client/course/Course.js</span></kbd></p>
<pre>&lt;Dialog open={open} onClose={handleClose} aria-labelledby="form-dialog-title"&gt;<br/>   &lt;DialogTitle id="form-dialog-title"&gt;Publish Course&lt;/DialogTitle&gt;<br/>   &lt;DialogContent&gt;<br/>      &lt;Typography variant="body1"&gt;<br/>         Publishing your course will make it live to students <br/>            for enrollment.            <br/>      &lt;/Typography&gt;<br/>      &lt;Typography variant="body1"&gt;<br/>         Make sure all lessons are added and ready for publishing.<br/>      &lt;/Typography&gt;<br/>   &lt;/DialogContent&gt;<br/>   &lt;DialogActions&gt;<br/>      &lt;Button onClick={handleClose} color="primary" variant="contained"&gt;<br/>         Cancel<br/>      &lt;/Button&gt;<br/>      &lt;Button onClick={publish} color="secondary" variant="contained"&gt;<br/>          Publish<br/>      &lt;/Button&gt;<br/>   &lt;/DialogActions&gt;<br/>&lt;/Dialog&gt;</pre>
<p>When the <span class="packt_screen">PUBLISH</span> button on the dialog is clicked by the user as confirmation to publish the course, we will make an update API call to the backend, with the <kbd>published</kbd> attribute of the course set to <kbd>true</kbd>. The <kbd>publish</kbd> function to make this update will be defined as follows:</p>
<p><kbd><span>mern-classroom/client/course/Course.js</span></kbd></p>
<pre>  const publish = () =&gt; {<br/>    let courseData = new FormData()<br/>      courseData.append('published', true)<br/>      update({<br/>          courseId: match.params.courseId<br/>        }, {<br/>          t: jwt.token<br/>        }, courseData).then((data) =&gt; {<br/>          if (data &amp;&amp; data.error) {<br/>            setValues({...values, error: data.error})<br/>          } else {<br/>            setCourse({...course, published: true})<br/>            setOpen(false)<br/>          }<br/>      })<br/>  }</pre>
<p>In this function, we are using the same update API that has already been defined and used for saving modifications to other course details from the <kbd>EditCourse</kbd> view. Once the backend is successfully updated with the <kbd>published</kbd> value, it is also updated in the state of the <kbd>Course</kbd> component.</p>
<p>This <kbd>published</kbd> attribute in the course can be used to conditionally hide the options to add a new lesson, delete a course, and delete a lesson in both the <kbd>Course</kbd> and <kbd>EditCourse</kbd> components, in order to prevent the instructor from performing these actions after the course is already published. As courses are published by instructors, these courses will be listed in a view for all users on the platform, as discussed in the following section.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Listing published courses</h1>
                </header>
            
            <article>
                
<p>All visitors to the MERN Classroom application will be able to access the published courses. In order to present these published courses, we will add the feature to retrieve all the published courses from the database, and display the courses in a list on the home page. In the following sections, we will implement this feature by first defining the backend API, which will take a request and return the list of published courses. Then, we will implement the frontend component that will fetch this API and render the courses.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The published courses API</h1>
                </header>
            
            <article>
                
<p>In order to retrieve the list of published courses from the database, we will implement an API in the backend, by first declaring the route that will take a GET request at <kbd>'/api/courses/published'</kbd>, as shown in the following code:</p>
<p><kbd>mern-classroom/server/routes/course.routes.js</kbd><span>:</span></p>
<pre>router.route('/api/courses/published')<br/>  .get(courseCtrl.listPublished)</pre>
<p>A GET request to this route will <span>invoke the <kbd>listPublished</kbd> controller method, which </span>initiates a query to the Course collection for courses that have the <kbd>published</kbd> attribute's value as <kbd>true</kbd>. Then, the resulting courses are returned in the response. The <kbd>listPublished</kbd> controller method is defined as follows: </p>
<p><kbd>mern-classroom/server/controllers/course.controller.js</kbd><span>:</span></p>
<pre>const listPublished = (req, res) =&gt; {<br/>  Course.find({published: true}, (err, courses) =&gt; {<br/>    if (err) {<br/>      return res.status(400).json({<br/>        error: errorHandler.getErrorMessage(err)<br/>      })<br/>    }<br/>    res.json(courses)<br/>  }).populate('instructor', '_id name')<br/>}</pre>
<p>To use this list API in the frontend, we also need to define a fetch method on the client- side, as we did for all the other API calls. Then, the fetch method will be used in the component, which will retrieve and display the published courses.<span> In the next section, w</span>e will look into the implementation of rendering the retrieved course list in a React component. </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The Courses component</h1>
                </header>
            
            <article>
                
<p>For displaying the list of published courses, we will design a component that takes the array of courses as props from the parent component that it is added to. In the MERN Classroom application, we will render the published courses on the home page, as pictured in the next screenshot:</p>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-808 image-border" src="assets/c58f4d6c-3188-4561-82f7-7f7a7e54e7cf.png" style="width:30.92em;height:26.00em;"/></p>
<p>In the <kbd>Home</kbd> component, we will retrieve the list of published courses from the backend in a <kbd>useEffect</kbd> hook, as shown in the following code:</p>
<p><kbd><span>mern-classroom/client/core/Home.js</span></kbd></p>
<pre>  useEffect(() =&gt; {<br/>    const abortController = new AbortController()<br/>    const signal = abortController.signal<br/>    listPublished(signal).then((data) =&gt; {<br/>      if (data.error) {<br/>        console.log(data.error)<br/>      } else {<br/>        setCourses(data)<br/>      }<br/>    })<br/>    return function cleanup(){<br/>      abortController.abort()<br/>    }<br/>  }, [])</pre>
<p>Once the list of courses is received, it is set to the <kbd>courses</kbd> variable in the state. We will pass this <kbd>courses</kbd> array to the <kbd>Courses</kbd> component as props when it is added to the <kbd>Home</kbd> component, as follows:</p>
<p><kbd><span>mern-classroom/client/core/Home.js</span></kbd></p>
<pre>&lt;Courses courses={courses} /&gt;</pre>
<p>This <kbd>Courses</kbd> component will take these props and iterate through the array to render each course in a <kbd>GridList</kbd> component from Material-UI. The <kbd>Courses</kbd> component is defined as shown in the following code:</p>
<p><kbd><span>mern-classroom/client/course/Courses.js</span></kbd></p>
<pre>export default function Courses(props){<br/>  return (<br/>    &lt;GridList cellHeight={220} cols={2}&gt;<br/>       {props.courses.map((course, i) =&gt; {<br/>          return (<br/>            &lt;GridListTile key={i} style={{padding:0}}&gt;<br/>              &lt;Link to={"/course/"+course._id}&gt;<br/>                &lt;img src={'/api/courses/photo/'+course._id} <br/>                            alt={course.name} /&gt;<br/>              &lt;/Link&gt;<br/>              &lt;GridListTileBar <br/>                 title={&lt;Link to={"/course/"+course._id}&gt;<br/>                            {course.name}&lt;/Link&gt;}<br/>                 subtitle={&lt;span&gt;{course.category}&lt;/span&gt;}<br/>                 actionIcon={auth.isAuthenticated() ? <br/>                                &lt;Enroll courseId={course._id}/&gt; : <br/>                                &lt;Link to="/signin"&gt;<br/>                                    Sign in to Enroll&lt;/Link&gt;<br/>                            }<br/>              /&gt;<br/>            &lt;/GridListTile&gt;)<br/>       })}<br/>    &lt;/GridList&gt;<br/>  )<br/>}<br/>Courses.propTypes = {<br/>  courses: PropTypes.array.isRequired<br/>}</pre>
<p>Each course in the list will display its name, category, and image, and will be linked to the individual course page. The <span class="packt_screen">Enroll</span> option, which will be implemented in its own component, will also be shown for each course, but only to the users who are <span>signed in, and are</span> browsing through the home page. </p>
<p>With courses now publishable by instructors and viewable by all visitors to the application, we can now start the implementation for enrollment on courses. </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Enrolling on courses </h1>
                </header>
            
            <article>
                
<p>All visitors to the MERN Classroom application will have the option to sign in and then enroll on any of the published courses. Enrolling on a course would give them access to the lesson details and would allow them to go through the lessons systematically to complete the course. In order to implement this feature, in this section, we will first define an Enrollment model to store enrollment details in the database. Then, we will add the backend API to create new enrollments when end users interact with the <kbd>Enroll</kbd> component that will be added to the frontend. Finally, we will implement the view that enables a student to see and interact with the content from the course on which they are enrolled.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Defining an Enrollment model</h1>
                </header>
            
            <article>
                
<p>We will define an Enrollment schema and model in order to store the details of each enrollment in the application. <span>It</span> will have fields to store the reference to the course being enrolled in and the user who is enrolling as a student. It will also store an array corresponding to the lessons in the associated course, which will store the completion status of each of the lessons for this student. Additionally, we will store three timestamp values; the first value will signify when the student enrolled, the second value will indicate the last time that they completed a lesson or updated the enrollment, and finally, when they completed the course. This enrollment model will be <span>defined in </span><kbd>server/models/enrollment.model.js</kbd><span>, and t</span>he code defining the enrollment fields are given in the following list with explanations:</p>
<ul>
<li><strong>Course reference</strong>: The <kbd>course</kbd> field will store the reference to the course document with which this enrollment is associated:</li>
</ul>
<pre style="padding-left: 60px">course: {<br/>    type: mongoose.Schema.ObjectId, <br/>    ref: 'Course'<br/>}</pre>
<ul>
<li><strong>Student reference</strong>: <span>The <kbd>student</kbd> field will store the reference to the user who created this enrollment by choosing to enroll on a course:</span></li>
</ul>
<pre style="padding-left: 60px">student: {<br/>    type: mongoose.Schema.ObjectId, <br/>    ref: 'User'<br/>}</pre>
<ul>
<li><strong>Lesson status</strong>: <span>The <kbd>lessonStatus</kbd> field will</span> <span>store an array with references to each lesson that is</span> <span>stored in the</span> <span>associated course</span> <span>in the <kbd>lessons</kbd> array. For each object in this <kbd>lessonStatus</kbd> array, we will add a <kbd>complete</kbd> field that will store a Boolean value that indicates whether the corresponding lesson has been completed or not:</span></li>
</ul>
<pre style="padding-left: 60px">lessonStatus: [{<br/>      lesson: {type: mongoose.Schema.ObjectId, ref: 'Lesson'}, <br/>      complete: Boolean<br/>}]</pre>
<ul>
<li><strong>Enrolled at</strong>: <span>The <kbd>enrolled</kbd> field will be a <kbd>Date</kbd> value indicating the time that the enrollment was created; in other words, when the student enrolled on the course:</span></li>
</ul>
<pre style="padding-left: 60px">enrolled: {<br/>    type: Date,<br/>    default: Date.now<br/>}</pre>
<ul>
<li><strong>Updated at</strong>: <span>The <kbd>updated</kbd> field will be another <kbd>Date</kbd> value, which will be updated every time a lesson is completed, indicating when was the last time that the user worked on the course lessons:</span></li>
</ul>
<pre style="padding-left: 60px">updated: Date</pre>
<ul>
<li><strong>Completed at</strong>: <span>The</span><span> </span><kbd>completed</kbd><span> </span><span>field will also be a <kbd>Date</kbd> type, which will only be set when all the lessons in the course have been completed:</span></li>
</ul>
<pre style="padding-left: 60px">completed: Date</pre>
<p><span>The fields in this schema definition will enable us to implement all the enrollment-related features in MERN Classroom. In the next section, we will implement the user's ability to enroll on a course, and store details of the enrollment using this Enrollment model.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The create Enrollment API</h1>
                </header>
            
            <article>
                
<p>When a user chooses to enroll in a course, we will create a new enrollment and store it in the backend. To implement this feature, we need to define a create enrollment API on the server, by first declaring a route that accepts a <kbd>POST</kbd> request at <kbd>'/api/enrollment/new/:courseId'</kbd>, as shown in the following code:</p>
<p><kbd>mern-classroom/server/routes/enrollment.routes.js</kbd><span>:</span></p>
<pre>router.route('/api/enrollment/new/:courseId')<br/>  .get(authCtrl.requireSignin, enrollmentCtrl.findEnrollment, enrollmentCtrl.create)<br/>router.param('courseId', courseCtrl.courseByID)</pre>
<p><span><span>This route</span></span> takes the course ID as a parameter in the URL. Hence, we also add the <kbd>courseByID</kbd> controller method from the course controllers in order to process this parameter and retrieve the corresponding course from the database. The user who initiates the request from the client- side is identified from the user auth credentials sent in the request. A <kbd>POST</kbd> request received at this route will first check whether the user is authenticated, and then check whether they are already enrolled on this course, before creating a new enrollment for this user in this course. </p>
<p><span>The <kbd>findEnrollment</kbd> controller method will query the <kbd>Enrollments</kbd> collection in the database in order to check whether there is already an enrollment with the given course ID and user ID. The <kbd>findEnrollment</kbd> method is defined as follows. </span></p>
<p><kbd>mern-classroom/server/controllers/enrollment.controller.js</kbd><span>:</span></p>
<pre>const findEnrollment = async (req, res, next) =&gt; {<br/>  try {<br/>    let enrollments = await Enrollment.find({course:req.course._id, <br/>                                             student: req.auth._id})<br/>    if(enrollments.length == 0){<br/>      next()<br/>    }else{<br/>      res.json(enrollments[0])<br/>    }<br/>  } catch (err) {<br/>    return res.status(400).json({<br/>      error: errorHandler.getErrorMessage(err)<br/>    })<br/>  }<br/>}</pre>
<p><span>If a matching result is returned from the query, then the resulting enrollment will be sent back in the response, otherwise, the <kbd>create</kbd> controller method will be invoked to create a new enrollment.</span></p>
<p><span>The <kbd>create</kbd> controller method generates a new enrollment object to be saved into the database from the course reference, user reference, and the lessons array in the given course. The <kbd>create</kbd> method is defined as shown in the following code.</span></p>
<p><kbd>mern-classroom/server/controllers/enrollment.controller.js</kbd><span>:</span></p>
<pre>const create = async (req, res) =&gt; {<br/>  let newEnrollment = {<br/>    course: req.course,<br/>    student: req.auth,<br/>  }<br/>  newEnrollment.lessonStatus = req.course.lessons.map((lesson)=&gt;{<br/>    return {lesson: lesson, complete:false}<br/>  })<br/>  const enrollment = new Enrollment(newEnrollment)<br/>  try {<br/>    let result = await enrollment.save()<br/>    return res.status(200).json(result)<br/>  } catch (err) {<br/>    return res.status(400).json({<br/>      error: errorHandler.getErrorMessage(err)<br/>    })<br/>  }<br/>}</pre>
<p>The <kbd>lessons</kbd> array in <kbd>course</kbd> is iterated over to generate the <kbd>lessonStatus</kbd> array of objects for the new enrollment document. Each object in the <kbd>lessonStatus</kbd> array has the <kbd>complete</kbd> value initialized to <kbd>false</kbd>. On successful saving of the new enrollment document based on these values, the new document is sent back in the response.</p>
<p>All the routes that are defined for enrollment APIs, such as this create API, are declared in the<span> </span><kbd>enrollment.routes.js</kbd><span> </span>file, and it will be similar to the other route files that have already been created in our application. As with the other routes, we need to load these new routes in the Express app by mounting the enrollment routes in<span> </span><kbd>express.js</kbd>. The enrollment-related routes are<span> </span>mounted as follows.</p>
<p><kbd>mern-social/server/express.js</kbd>:</p>
<pre>app.use('/', enrollmentRoutes)</pre>
<p>To access the create API in the frontend, you will also need to define a fetch method similar to other fetch methods that have been defined in the application. Using this fetch method, the <kbd>Enroll</kbd> component that is discussed in the next section will be able to call this create enrollment API. </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The Enroll component</h1>
                </header>
            
            <article>
                
<p>The <kbd>Enroll</kbd> component will simply contain a button that initiates the enrollment call to the backend, and redirects the user if the server returns successfully with the new enrollment document's ID. This component takes the ID of the associated course as a prop from the parent component from where it is added. This prop will be used while making the create enrollment API call. The <kbd>Enroll</kbd> component is defined as shown in the following code.</p>
<p><kbd><span>mern-classroom/client/enrollment/Enroll.js</span></kbd>:</p>
<pre>export default function Enroll(props) {<br/>  const [values, setValues] = useState({<br/>    enrollmentId: '',<br/>    error: '',<br/>    redirect: false<br/>  })<br/>  if(values.redirect){<br/>     return (&lt;Redirect to={'/learn/'+values.enrollmentId}/&gt;)<br/>  }<br/>  return (<br/>      &lt;Button variant="contained" color="secondary" <br/>              onClick={clickEnroll}&gt; Enroll &lt;/Button&gt;<br/>  )</pre>
<p>When the <span class="packt_screen">ENROLL</span> button is clicked, the create enrollment API will be fetched with the provided course ID to either retrieve an existing enrollment, or to create a new enrollment and receive it in the response. The <kbd>clickEnroll</kbd> function to be invoked when the button is clicked is defined as follows: </p>
<p><kbd><span>mern-classroom/client/enrollment/Enroll.js</span></kbd><span>:</span></p>
<pre> const clickEnroll = () =&gt; {<br/>    const jwt = auth.isAuthenticated()<br/>    create({<br/>      courseId: props.courseId<br/>    }, {<br/>      t: jwt.token<br/>    }).then((data) =&gt; {<br/>        console.log(data)<br/>      if (data &amp;&amp; data.error) {<br/>        setValues({...values, error: data.error})<br/>      } else {<br/>        setValues({...values, enrollmentId: data._id, redirect: true})<br/>      }<br/>    })<br/>  }</pre>
<p>When the server sends back an enrollment successfully, the user will be redirected to the view that will display the details of the specific enrollment.</p>
<p>Since the <kbd><span>Enrol</span><span>l</span></kbd> <span>component receives the course ID as a prop from the parent component, we also add</span> <kbd>PropType</kbd> <span>validation (as shown in the following code) for the component, as its functionality and implementation relies on this prop being passed.</span></p>
<p><kbd><span>mern-classroom/client/enrollment/Enroll.js</span></kbd><span>:</span></p>
<pre>Enroll.propTypes = {<br/>  courseId: PropTypes.string.isRequired<br/>}</pre>
<p>When a server responds successfully on the API call, the user is redirected to the enrolled course view, where they can go through the lesson content. We will work on implementing this view in the next section.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The Enrolled Course view</h1>
                </header>
            
            <article>
                
<p>For each course on which the user is enrolled, they will see a view that lists the details of the course, and each lesson in the course; with the option to complete each lesson. In the following sections we will implement this view, by first adding a backend API that returns a given enrollment's details, and then using this API in the frontend to build the enrolled course view. </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The read enrollment API</h1>
                </header>
            
            <article>
                
<p>The backend API which will return the enrollment details from the database will be defined as a GET route that accepts the request at <kbd>'/api/enrollment/:enrollmentId'</kbd>, and will be declared as follows:</p>
<p><kbd>mern-classroom/server/routes/enrollment.routes.js</kbd></p>
<pre>router.route('/api/enrollment/:enrollmentId')<br/>  .get(authCtrl.requireSignin, enrollmentCtrl.isStudent, <br/>               enrollmentCtrl.read)<br/>router.param('enrollmentId', enrollmentCtrl.enrollmentByID)</pre>
<p>A GET request at this route will first invoke the <kbd>enrollmentByID</kbd> method, since it contains the <kbd>enrollmentId</kbd> param in the URL declaration. The <kbd>enrolmentByID</kbd> method will query the <kbd>Enrollments</kbd> collection by the provided ID, and if a matching enrollment document is found, we ensure that the referenced course, the nested course instructor, and the referenced student details are also populated using the <kbd>populate</kbd> method from Mongoose. The <kbd>enrollmentByID</kbd> controller method is defined as shown in the following code:</p>
<p><kbd>mern-classroom/server/controllers/enrollment.controller.js</kbd><span>:</span></p>
<pre>const enrollmentByID = async (req, res, next, id) =&gt; {<br/>  try {<br/>    let enrollment = await Enrollment.findById(id)<br/>                          <strong>.populate({path: 'course', </strong><strong>populate:{ <br/>                                                   path: 'instructor'}})</strong><br/><strong>                          .populate('student', '_id name')</strong><br/>    if (!enrollment)<br/>      return res.status('400').json({<br/>        error: "Enrollment not found"<br/>      })<br/>    req.enrollment = enrollment<br/>    next()<br/>  } catch (err) {<br/>    return res.status('400').json({<br/>      error: "Could not retrieve enrollment"<br/>    })<br/>  }<br/>}</pre>
<p>The resulting enrollment object is attached to the request object and passed on to the next controller method. Before returning this enrollment object in the response to the client, we will check whether the currently signed-in user is the student who is associated with this specific enrollment in the <kbd>isStudent</kbd> method, as defined in the following code. </p>
<p><kbd>mern-classroom/server/controllers/enrollment.controller.js</kbd><span>:</span></p>
<pre>const isStudent = (req, res, next) =&gt; {<br/>  const isStudent = req.auth &amp;&amp; req.auth._id == <br/>                                req.enrollment.student._id<br/>  if (!isStudent) {<br/>    return res.status('403').json({<br/>      error: "User is not enrolled"<br/>    })<br/>  }<br/>  next()<br/>}</pre>
<p>The <kbd>isStudent</kbd> method checks whether the user who is identified by the auth credentials that were sent in the request matches the student who is referenced in the enrollment. If the two users don't match, a 403 status is returned with an error message, otherwise, the next controller method is invoked in order to return the enrollment object. The next controller method is the <kbd>read</kbd> method, and it is defined as follows:</p>
<p><kbd>mern-classroom/server/controllers/enrollment.controller.js</kbd><span>:</span></p>
<pre>const read = (req, res) =&gt; {<br/>  return res.json(req.enrollment)<br/>}</pre>
<p>To use this read enrollment API in the frontend, you will also need to define a corresponding fetch method, as implemented for all other APIs in this application. Then, this fetch method will be used to retrieve the enrollment details to be rendered in a React component that the student will interact with. We will implement this <kbd>Enrollment</kbd> component in the next section.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The Enrollment component</h1>
                </header>
            
            <article>
                
<p>The <kbd>Enrollment</kbd> component will load the details of the course and the lessons that were received from the read enrollment API. In this view, students will be able to go through each lesson in the course and mark each as complete. The lesson titles will be listed in a drawer, giving the student an overall idea of what the course contains, and how far they have progressed. Each item in the drawer will extend to reveal the details of the lesson, as pictured in the following screenshot:</p>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-809 image-border" src="assets/c917496f-4f45-4ee3-b968-6592b78183a5.png" style="width:35.58em;height:19.25em;"/></p>
<p>To implement this view, first, we need to make a fetch call to the read enrollment API in the <kbd>useEffect</kbd> hook in order to retrieve the details of the enrollment <span>and set it to state,</span> as shown in the following code.</p>
<p><kbd><span>mern-classroom/client/enrollment/Enrollment.js</span></kbd><span>:</span></p>
<pre>export default function Enrollment ({match}) {<br/>  const [enrollment, setEnrollment] = useState({course:{instructor:[]}, <br/>                                                lessonStatus: []})<br/>  const [values, setValues] = useState({<br/>      redirect: false,<br/>      error: '',<br/>      drawer: -1<br/>    })<br/>  const jwt = auth.isAuthenticated()<br/>  useEffect(() =&gt; {<br/>      const abortController = new AbortController()<br/>      const signal = abortController.signal<br/>      read({enrollmentId: match.params.enrollmentId}, <br/>           {t: jwt.token}, signal).then((data) =&gt; {<br/>             if (data.error) {<br/>              setValues({...values, error: data.error})<br/>             } else {<br/>              <strong>setEnrollment(data)</strong><br/>             }<br/>      })<br/>      return function cleanup(){<br/>          abortController.abort()<br/>      }<br/>  }, [match.params.enrollmentId])<br/>....</pre>
<p>We will implement the drawer layout using Material-UI's <kbd>Drawer</kbd> component. In the drawer, we keep the first item as the <span class="packt_screen">Course Overview</span>, which will give the user an overview of the course details, similar to the single course page. When the user enters this enrollment view, they will see the <span class="packt_screen">Course Overview</span> first.</p>
<p>In the following code, after adding this first drawer item, we create a separate section for the lessons, where the <kbd>lessonStatus</kbd> array is iterated over to list the lesson titles in the drawer.</p>
<p><kbd><span>mern-classroom/client/enrollment/Enrollment.js</span></kbd><span>:</span></p>
<pre>&lt;Drawer variant="permanent"&gt;<br/>    &lt;div className={classes.toolbar} /&gt;<br/>    &lt;List&gt;<br/>      &lt;ListItem button onClick={selectDrawer(-1)} <br/>        className={values.drawer == -1 ? <br/>                    classes.selectedDrawer : classes.unselected}&gt;<br/>        &lt;ListItemIcon&gt;&lt;Info /&gt;&lt;/ListItemIcon&gt;<br/>        &lt;ListItemText primary={"Course Overview"} /&gt;<br/>      &lt;/ListItem&gt;<br/>    &lt;/List&gt;<br/>    &lt;Divider /&gt;<br/>    &lt;List&gt;<br/>      &lt;ListSubheader component="div"&gt;<br/>          Lessons<br/>      &lt;/ListSubheader&gt;<br/>      {enrollment.lessonStatus.map((lesson, index) =&gt; (<br/>          &lt;ListItem button key={index} onClick={selectDrawer(index)} <br/>                    className={values.drawer == index ? <br/>                           classes.selectedDrawer : classes.unselected}&gt;<br/>            &lt;ListItemAvatar&gt; <br/>                &lt;Avatar&gt; {index+1} &lt;/Avatar&gt; <br/>            &lt;/ListItemAvatar&gt;<br/>            &lt;ListItemText <br/>                primary={enrollment.course.lessons[index].title} /&gt;<br/>            &lt;ListItemSecondaryAction&gt; { lesson.complete ? <br/>                &lt;CheckCircle/&gt; : &lt;RadioButtonUncheckedIcon /&gt;}<br/>            &lt;/ListItemSecondaryAction&gt;<br/>          &lt;/ListItem&gt;<br/>      ))}<br/>    &lt;/List&gt;<br/>    &lt;Divider /&gt;<br/>&lt;/Drawer&gt;</pre>
<p>Each of the items in the <span class="packt_screen">Lessons</span> section of the drawer will also give the user a visual indication of whether the lesson has been completed, or is still incomplete. These check or uncheck icons will be rendered based on the Boolean value of the <kbd>complete</kbd> field in each item in the <kbd>lessonStatus</kbd> array.</p>
<p>To determine which drawer is currently selected, we will utilize the initialized <kbd>drawer</kbd> value to state with a -1. The -1 value will be associated with the <span class="packt_screen">Course Overview</span> drawer item and view, whereas the index of each <kbd>lessonStatus</kbd> item will determine which lesson is displayed when selected from the drawer. When a drawer item is clicked, we will call the <kbd>selectDrawer</kbd> method, giving it either -1 or the index of the lesson clicked as its argument. The <kbd>selectDrawer</kbd> method is defined as follows:</p>
<p><kbd><span>mern-classroom/client/enrollment/Enrollment.js</span></kbd><span>:</span></p>
<pre>const selectDrawer = (index) =&gt; event =&gt; {<br/>   setValues({...values, drawer:index})<br/>}</pre>
<p>This <kbd>selectDrawer</kbd> method sets the <kbd>drawer</kbd> value in the state according to the item clicked on the drawer. The actual content view will also render conditionally, depending on this <kbd>drawer</kbd> value, according to the following structure:</p>
<pre>{ values.drawer == - 1 &amp;&amp; (Overview of course) }<br/>{ values.drawer != - 1 &amp;&amp; (Individual lesson content based on the index value represented in <strong>drawer</strong>) }</pre>
<p>The course overview section can be designed and implemented according to the Course page. In order to render the individual lesson details, we can use a <kbd>Card</kbd> component as follows:</p>
<p><kbd><span>mern-classroom/client/enrollment/Enrollment.js</span></kbd><span>:</span></p>
<pre>{values.drawer != -1 &amp;&amp; (&lt;&gt;<br/>     &lt;Typography variant="h5"&gt;{enrollment.course.name}&lt;/Typography&gt;<br/>     &lt;Card&gt; &lt;CardHeader <br/>              title={enrollment.course.lessons[values.drawer].title} <br/>            /&gt;<br/>            &lt;CardContent&gt; <br/>               &lt;Typography variant="body1"&gt;            <br/>                      {enrollment.course.lessons[values.drawer].content}<br/>               &lt;/Typography&gt;<br/>            &lt;/CardContent&gt;<br/>            &lt;CardActions&gt;<br/>               &lt;a href={enrollment.course.lessons[values.drawer].resource_url}&gt;                       <br/>                    &lt;Button variant="contained" color="primary"&gt;<br/>                        Resource Link&lt;/Button&gt;<br/>               &lt;/a&gt;<br/>            &lt;/CardActions&gt;<br/>     &lt;/Card&gt;<br/>  &lt;/&gt;<br/>)}</pre>
<p>This will render the details of the lesson that has been selected, which are the title, content, and resource URL values. With this implementation, we now have a way to let users enroll on courses and view the details of their enrollment. This enrollment data is initially created from the course details, but will also store details that are specific to the student who enrolled, and their progress in the lessons and the course overall. In order to be able to record and track this progress, and then display the related statistical information to both students and instructors, we will update this implementation further in the following section in order to add these capabilities. </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Tracking progress and enrollment stats</h1>
                </header>
            
            <article>
                
<p>In a classroom application such as MERN Classroom, it can be valuable to let students visualize their progress in enrolled courses, and let instructors see how many students enrolled and completed their courses.</p>
<p>In this application, once a student is enrolled on a course, they will be able to go through each lesson in it, and mark it complete until all the lessons are done, and the whole course is complete. The application will leave visual cues to let a student know the state of their enrollments in courses. <span>For instructors, once they publish a course, we will show the total number of students who enrolled on the course, and the total number of students who completed the course.</span></p>
<p>In the following sections, we will implement these capabilities, starting with letting users complete lessons and track their progress in a course, then listing their enrollments with indicators for which ones are complete and which are in progress, and finally, showing the enrollment stats for each published course.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Completing lessons</h1>
                </header>
            
            <article>
                
<p>We will have to extend both the enrollment APIs and the enrollment view implementation to allow students first to complete lessons, and then the whole course. We will add a lesson complete API in the backend and use this API in the frontend to mark a lesson as complete when the user performs this action. In the following sections, we will add this API, then modify the <kbd>Enrollment</kbd> component to use this API, and visually indicate which lessons are complete. </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Lessons completed API</h1>
                </header>
            
            <article>
                
<p>We will add a <kbd>complete</kbd> API endpoint in the backend for enrollments, which will mark specified lessons as complete, and will also mark the enrolled course as completed when all the lessons are done. To implement this API, we will start by declaring a PUT route, as shown in the following code:  </p>
<p><kbd><span>mern-classroom/server/routes/enrollment.routes.js</span></kbd></p>
<pre>router.route('/api/enrollment/complete/:enrollmentId')<br/>  .put(authCtrl.requireSignin, <br/>        enrollmentCtrl.isStudent, <br/>            enrollmentCtrl.complete)</pre>
<p>When a PUT request is received at the <kbd>'/api/enrollment/complete/:enrollmentId'</kbd> URL, we will first make sure that the signed-in user is the student who is associated with this enrollment record, and then we will call the <kbd>complete</kbd> enrollment controller method. The <kbd>complete</kbd> method is defined as follows:</p>
<p><kbd><span>mern-classroom/server/controllers/enrollment.controller.js</span></kbd></p>
<pre>const complete = async (req, res) =&gt; {<br/>  let updatedData = {}<br/>  updatedData['lessonStatus.$.complete']= req.body.complete <br/>  updatedData.updated = Date.now()<br/>  if(req.body.courseCompleted)<br/>    updatedData.completed = req.body.courseCompleted<br/>    try {<br/>      let enrollment = await <br/>                        Enrollment.updateOne({'lessonStatus._id':                                                <br/>                                               req.body.lessonStatusId}, <br/>                                             {'$set': updatedData})<br/>      res.json(enrollment)<br/>    } catch (err) {<br/>      return res.status(400).json({<br/>        error: errorHandler.getErrorMessage(err)<br/>      })<br/>    }<br/>}</pre>
<p>In this <kbd>complete</kbd> method, we use the <kbd>updateOne</kbd> action from MongoDB to update the enrollment document, which contains the <kbd>lessonStatus</kbd> object with the corresponding <kbd>lessonStatusId</kbd> value provided in the request.</p>
<p>In the resulting enrollment document, we update the <kbd>complete</kbd> field of the specific object in the <kbd>lessonStatus</kbd> array, and the <kbd>updated</kbd> field of the enrollment document. If a <kbd>courseCompleted</kbd> value is sent in the request, we also update the <kbd>completed</kbd> field in the enrollment document. Once the enrollment document is updated successfully, it is sent back in the response.</p>
<p>To use this <kbd>complete</kbd> API endpoint in the frontend, you also need to define a corresponding fetch method like we did for other API implementations. This fetch method should make a PUT request to the complete enrollment route with related values sent in the request. A<span>s discussed in the next section, we will use this implemented API in</span> the <kbd>Enrollment</kbd> component in order to allow students to complete lessons.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Completed lessons from the view</h1>
                </header>
            
            <article>
                
<p>In the <kbd>Enrollment</kbd> component, in which we are rendering each lesson's details in the drawer view, we will give the student the option to mark the lesson as completed. This option will render conditionally, depending on whether the given lesson is already completed or not. This option will be added to the <kbd>action</kbd> property in <kbd>CardHeader</kbd>, as shown in the following code:</p>
<p><kbd><span>mern-classroom/client/enrollment/Enrollment.js</span></kbd><span>:</span></p>
<pre>action={&lt;Button <br/>          onClick={markComplete} <br/>          variant={enrollment.lessonStatus[values.drawer].complete ?                                         <br/>                            'contained' : 'outlined'} color="secondary"&gt;<br/>          {enrollment.lessonStatus[values.drawer].complete ?<br/>                            "Completed" : "Mark as complete"}<br/>         &lt;/Button&gt;}</pre>
<p>If the given <kbd>lessonStatus</kbd> object has the <kbd>complete</kbd> attribute set to <kbd>true</kbd>, then we render a filled-out button with the text <span class="packt_screen">Completed</span>, otherwise an outlined button is rendered with the text <span class="packt_screen">Mark as complete</span>. Clicking on this button makes a call to the <kbd>markComplete</kbd> function, which will make the API call to update the enrollment in the database. This <kbd>markComplete</kbd> function is defined as follows:</p>
<p><kbd><span>mern-classroom/client/enrollment/Enrollment.js</span></kbd><span>:</span></p>
<pre>const markComplete = () =&gt; {<br/>   if(!enrollment.lessonStatus[values.drawer].complete){<br/>     const lessonStatus = enrollment.lessonStatus<br/>     lessonStatus[values.drawer].complete = true<br/>     let count = totalCompleted(lessonStatus)<br/>     let updatedData = {}<br/>     updatedData.lessonStatusId = lessonStatus[values.drawer]._id<br/>     updatedData.complete = true<br/>     if(count == lessonStatus.length){<br/>       updatedData.courseCompleted = Date.now()<br/>     }<br/>     complete({<br/>       enrollmentId: match.params.enrollmentId<br/>      }, {<br/>        t: jwt.token<br/>      }, updatedData).then((data) =&gt; {<br/>      if (data &amp;&amp; data.error) {<br/>        setValues({...values, error: data.error})<br/>      } else {<br/>        setEnrollment({...enrollment, lessonStatus: lessonStatus})<br/>      }<br/>     })<br/>   }<br/>}</pre>
<p>In this function, before making the API call to the backend, we prepare the values to be sent with the request in the <kbd>updatedData</kbd> object. We send the <kbd>lessonStatus</kbd> details, including the ID value and <kbd>complete</kbd> value set to <kbd>true</kbd> for the lesson that was completed by the user. We also calculate if the total number of completed lessons is equal to the total number of lessons, so that we can set and send the <kbd>courseCompleted</kbd> value in the request, as well.</p>
<p>The total number of completed lessons is calculated using the <kbd>totalCompleted</kbd> function, which is defined as follows:</p>
<p><kbd><span>mern-classroom/client/enrollment/Enrollment.js</span></kbd><span>:</span></p>
<pre>const totalCompleted = (lessons) =&gt; {<br/>  let count = lessons.reduce((total, lessonStatus) =&gt; {<br/>                   return total + (lessonStatus.complete ? 1 : 0)}, 0)<br/>  setTotalComplete(count)<br/>  return count<br/>}</pre>
<p>We use the array <kbd>reduce</kbd> function to find and tally the count for the completed lessons in the <kbd>lessonStatus</kbd> array. This count value is also stored in the state, so that it can be rendered in the view at the bottom of the drawer, as shown in the following screenshot:</p>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-810 image-border" src="assets/444a45f8-bc19-4b3a-88c2-ff62cbf78852.png" style="width:9.75em;height:23.58em;"/></p>
<p>The student's lessons will have a check icon next to them, as an indication of which lessons are either complete or incomplete. We also give the student a number tally of how many were completed out of the total. The course is considered completed when all the lessons are done. This gives the student an idea of their progress in the course. Next, we will add a feature that will allow users to see the state of all the courses on which they are enrolled.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Listing all enrollments for a user</h1>
                </header>
            
            <article>
                
<p>Once they are signed in to MERN Classroom, students will be able to view a list of all their enrollments on the home page. In order to implement this feature, we will first define a backend API, which returns the list of enrollments for a given user, and then use it in the frontend to render the list of enrollments to the user.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The list of enrollments API</h1>
                </header>
            
            <article>
                
<p>The list of enrollments API will take a GET request and query the <kbd>Enrollments</kbd> collection in order to find enrollments that have a student reference that matches with the user who is currently signed in. To implement this API, we will first declare the GET route for <kbd>'/api/enrollment/enrolled'</kbd>, as shown in the following code:</p>
<p><kbd><span>mern-classroom/server/routes/enrollment.routes.js</span></kbd></p>
<pre>router.route('/api/enrollment/enrolled')<br/>  .get(authCtrl.requireSignin, enrollmentCtrl.listEnrolled)</pre>
<p>A GET request to this route will invoke the <kbd>listEnrolled</kbd> controller method, which will query the database and return the results in the response to the client. The <kbd>listEnrolled</kbd> method is defined as follows:</p>
<p><kbd><span>mern-classroom/server/controllers/enrollment.controller.js</span></kbd></p>
<pre>const listEnrolled = async (req, res) =&gt; {<br/>  try {<br/>    let enrollments = await Enrollment.find({student: req.auth._id})<br/>                                            .sort({'completed': 1})<br/>                                            .populate('course', '_id name category')<br/>    res.json(enrollments)<br/>  } catch (err) {<br/>    console.log(err)<br/>    return res.status(400).json({<br/>      error: errorHandler.getErrorMessage(err)<br/>    })<br/>  }<br/>}</pre>
<p>The query to the <kbd>Enrollments</kbd> collection finds all enrollments with the student reference that matches the user ID that was received in the auth credentials of the currently signed-in user. The resulting enrollments will be populated with the referenced course's name and category values, and the list will be sorted so that the completed enrollments are placed after the incomplete enrollments.</p>
<p>By defining a corresponding fetch method for this API on the client- side, we can call it in the React component that will render these enrollments. We will look at the implementation of this component in the next section.  </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The Enrollments component</h1>
                </header>
            
            <article>
                
<p>The <kbd>Enrollments</kbd> component will be rendered on the <span class="packt_screen">Home</span> page, and it will take the list of enrollments as props from the <kbd>Home</kbd> component. The received list of enrollments will be rendered in this component in order to show the user the courses on which they are enrolled. We will also indicate if an enrolled course in the list has been completed, or is in progress, using representative icons for each state, as shown in the following screenshot: </p>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-811 image-border" src="assets/e9467437-d39f-4b02-ade4-9e4d5dc8bc5b.png" style="width:34.58em;height:7.00em;"/></p>
<p>This view for listing enrollments will be very similar to the <kbd>Courses</kbd> component, which lists the published courses. In <kbd>Enrollments</kbd>, instead of courses, the enrollments received from the <kbd>Home</kbd> component will be iterated over to render each enrollment, as shown in the following code:</p>
<p><kbd><span>mern-classroom/client/enrollment/Enrollments.js</span></kbd><span>:</span></p>
<pre>{props.enrollments.map((course, i) =&gt; (<br/>  &lt;GridListTile key={i}&gt;<br/>     &lt;Link to={"/learn/"+course._id}&gt;<br/>       &lt;img src={'/api/courses/photo/'+course.course._id} <br/>           alt= {course.course.name} /&gt;<br/>     &lt;/Link&gt;<br/>     &lt;GridListTileBar<br/>       title={&lt;Link to={"/learn/"+course._id}&gt;{course.course.name}&lt;/Link&gt;}<br/>       actionIcon={&lt;div&gt; <strong>{course.completed ? </strong><br/><strong>                             (&lt;CompletedIcon color="secondary"/&gt;)</strong><br/><strong>                           : (&lt;InProgressIcon/&gt;)</strong><br/><strong>                         }</strong><br/>                   &lt;/div&gt;}<br/>     /&gt;<br/>  &lt;/GridListTile&gt;<br/>))}</pre>
<p>Based on whether the individual enrollment already has a <kbd>complete</kbd> date value or not, we will render the icons conditionally. This will give the users an idea of which enrolled courses they have completed, and which they are yet to finish.</p>
<p>Now that we have implemented the features to allow students in this application to enroll on courses, complete lessons, and also track their progress, we can also provide enrollment stats about courses by extending on these implementations, as we will see next.  </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Enrollment stats</h1>
                </header>
            
            <article>
                
<p>Once the instructor publishes a course, and other users in the application start enrolling and completing lessons in the course, we will show the total number of enrollments and course completions as simple enrollment statistics for the course. To implement this feature, in the following sections we will first implement an API that returns the enrollment stats, and then show these stats in the view.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The enrollment stats API</h1>
                </header>
            
            <article>
                
<p class="mce-root">In order to implement a backend API that will query the <kbd>Enrollments</kbd> collection in the database to calculate the stats for a specific course, we first need to declare a GET route at <kbd>'/api/enrollment/stats/:courseId'</kbd>, as shown in the following code.</p>
<p><kbd><span>mern-classroom/server/routes/enrollment.routes.js</span></kbd></p>
<pre>router.route('/api/enrollment/stats/:courseId')<br/>  .get(enrollmentCtrl.enrollmentStats)</pre>
<p>A GET request at this URL will return a <kbd>stats</kbd> object containing the total enrollments and total completions for the course, as identified by the <kbd>courseId</kbd> provided in the URL parameter. This implementation is defined in the <kbd>enrollmentStats</kbd> controller method, as shown in the following code.</p>
<p><kbd><span>mern-classroom/server/controllers/enrollment.controller.js</span></kbd></p>
<pre>const enrollmentStats = async (req, res) =&gt; {<br/>  try {<br/>    let stats = {}<br/>    stats.totalEnrolled = await Enrollment.find({course:req.course._id})<br/>                                          .countDocuments()<br/>    stats.totalCompleted = await Enrollment.find({course:req.course._id})<br/>                                         .exists('completed', true)<br/>                                          .countDocuments()<br/>    res.json(stats)<br/>  } catch (err) {<br/>    return res.status(400).json({<br/>      error: errorHandler.getErrorMessage(err)<br/>    })<br/>  }<br/>} </pre>
<p>In this <kbd>enrollmentStats</kbd> method, we run two queries against the <kbd>Enrollments</kbd> collection using the course ID that is provided in the request. In the first query, we simply find all the enrollments for the given course, and count these results using MongoDB's <kbd>countDocuments()</kbd>. In the second query, we find all the enrollments for the given course, and also check whether the <kbd>completed</kbd> field exists in these enrollments. Then we finally get the count of these results. These numbers are sent back in the response to the client.</p>
<p>Similar to other API implementations, you will also need to define a corresponding fetch method on the client that will make the GET request to this route. Using this fetch method, we will retrieve and display these stats for each published course, as discussed in the next section. </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Displaying enrollment stats for a published course</h1>
                </header>
            
            <article>
                
<p>The enrollment stats can be retrieved from the backend and rendered in the Course view, as shown in the following image: </p>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-812 image-border" src="assets/ed43fbdb-ca66-4cc9-8a4b-ec1e5238dd9b.png" style="width:20.83em;height:3.75em;"/></p>
<p>To retrieve these enrollment stats, we will add a second <kbd>useEffect</kbd> hook in the <kbd>Course</kbd> component in order to make a fetch call to the enrollment stats API, as shown in the following code:</p>
<p><kbd><span>mern-classroom/client/course/Course.js</span></kbd></p>
<pre>  useEffect(() =&gt; {<br/>    const abortController = new AbortController()<br/>    const signal = abortController.signal<br/>    enrollmentStats({courseId: match.params.courseId}, <br/>                    {t:jwt.token}, signal).then((data) =&gt; {<br/>                      if (data.error) {<br/>                        setValues({...values, error: data.error})<br/>                      } else {<br/>                        setStats(data)<br/>                      }<br/>                   })<br/>    return function cleanup(){<br/>      abortController.abort()<br/>    }<br/>  }, [match.params.courseId])</pre>
<p>This will receive the enrollment stats for the given course and set it to the <kbd>stats</kbd> variable in state, and we can render it in the view, as shown in the following code:</p>
<p><kbd><span>mern-classroom/client/course/Course.js</span></kbd></p>
<pre>{course.published &amp;&amp; <br/>    (&lt;div&gt; &lt;span&gt; &lt;PeopleIcon /&gt; {stats.totalEnrolled} enrolled &lt;/span&gt;<br/>           &lt;span&gt; &lt;CompletedIcon/&gt; {stats.totalCompleted} completed &lt;/span&gt;<br/>     &lt;/div&gt;)<br/>}</pre>
<p>With this feature added to the Course component, to any visitor who is browsing through courses in the MERN Classroom application, a published course in the application will look as shown in the following image:</p>
<p class="CDPAlignCenter CDPAlign"><img class="aligncenter size-full wp-image-813 image-border" src="assets/a6f50642-a427-407d-82d7-7ebd783295af.png" style="width:39.58em;height:27.50em;"/></p>
<p>This screenshot of the Course page with the course details, enroll option, and enrollment stats, manages to capture all the features that we have implemented in this chapter in order to make this view possible. A user who signed up to the classroom application became an educator to create and publish this course with lessons. Then, other users enrolled in the course and completed the course lessons to generate the enrollment stats. We simply extended the MERN skeleton application to add more models, APIs, and React frontend components, which retrieved and then rendered the data received in order to build a complete classroom application.  </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Summary</h1>
                </header>
            
            <article>
                
<p>In this chapter, we developed a simple online classroom application called MERN Classroom, by extending the skeleton application. We incorporated functionality that allowed users to have multiple roles, including educator and student; to add and publish courses with lessons as an instructor; to enroll on courses and complete lessons as a student; and to keep track of course completion progress and enrollment statistics. </p>
<p>While implementing these features, we practiced how to extend the full-stack component slices that make up the frontend–backend-synced application. We added new features by simply implementing data schemas and models, adding new backend APIs, and integrating these with new React components in the frontend to complete the full-stack slice. By building this application up gradually from smaller units of implementation to complex and combined features, you should now have a better grasp of how to combine the different parts of a MERN-based full-stack application.</p>
<p>In order to learn how to integrate even more complex features, and find solutions to the tricky problems that you may face when developing advanced real-world applications with this stack, we will start building a MERN-based, feature-rich online marketplace application in the next chapter. </p>


            </article>

            
        </section>
    </body></html>