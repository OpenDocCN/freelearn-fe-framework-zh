<html><head></head><body>
  <div id="_idContainer683">
    <h1 class="chapterNumber">12</h1>
    <h1 class="chapterTitle" id="_idParaDest-418">Recipes – Master/Detail, Data Tables, and NgRx</h1>
    <p class="normal">In this chapter, we complete the router-first architecture implementation on LemonMart by implementing the top two most used features in business applications: master/detail views and data tables. I demonstrate data tables with server-side pagination, highlighting the integration between the frontend and backend using LemonMart and LemonMart Server.</p>
    <div class="note">
      <p class="Information-Box--PACKT-">Make sure to have your <strong class="bold">lemon-mart-server</strong> up and running as you implement the recipes outlined in this chapter. Refer to <em class="italics">Chapter 10</em>, <em class="italics">RESTful APIs and Full-Stack Implementation</em>, for more information.</p>
    </div>
    <p class="normal">We leverage the concept of router orchestration to orchestrate how our components load data or render. We use resolve guards to reduce boilerplate code when loading data before navigating to a component. We use auxiliary routes to lay out components through the router configuration. We reuse the same component in multiple contexts.</p>
    <p class="normal">We then dive into NgRx using the LocalCast Weather app and explore NgRx Data with LemonMart, so you can become familiar with more advanced application architecture concepts in Angular. By the end of this chapter, we will have touched upon most of the major functionality that Angular and Angular Material have to offer.</p>
    <p class="normal">This chapter covers a lot of ground. It is organized in a recipe format, so you can quickly refer to a particular implementation when you are working on your projects. I cover the architecture, design, and major components of the implementation. I highlight important pieces of code to explain how the solution comes together. Leveraging what you've learned so far, I expect the reader to fill in routine implementation and configuration details. However, you can always refer to the GitHub repo if you get stuck.</p>
    <p class="normal">In this chapter, you will learn about the following topics:</p>
    <ul>
      <li class="list">Loading data with resolve guards</li>
      <li class="list">Reusable components with route data</li>
      <li class="list">Master/detail views using auxiliary routes </li>
      <li class="list">Data tables with pagination</li>
      <li class="list">NgRx Store and Effects</li>
      <li class="list">NgRx Data Library</li>
    </ul>
    <p class="normal">The most up-to-date versions of the sample code for the book are on GitHub at the repository linked in the following list. The repository contains the final and completed state of the code. You can verify your progress at the end of this chapter by looking for the end-of-chapter snapshot of code under the <code class="Code-In-Text--PACKT-">projects</code> folder.</p>
    <p class="normal">To get set up for this chapter's examples based on <strong class="bold">lemon-mart</strong>, do the following:</p>
    <ol>
      <li class="list">Clone the repo at <a href="https://github.com/duluca/lemon-mart"><span class="url">https://github.com/duluca/lemon-mart</span></a></li>
      <li class="list">Execute <code class="Code-In-Text--PACKT-">npm install</code> on the root folder to install dependencies</li>
      <li class="list">The code sample for this chapter is under the following subfolder:
        <pre class="programlisting"><code class="hljs">projects/ch12
</code></pre>
      </li>
      <li class="list">To run the Angular app for this chapter, execute the following command:
        <pre class="programlisting"><code class="hljs nginx"><span class="hljs-attribute">npx</span> ng serve ch12
</code></pre>
      </li>
      <li class="list">To run Angular unit tests for this chapter, execute the following command:
        <pre class="programlisting"><code class="hljs bash">npx ng <span class="hljs-built_in">test</span> ch12 --watch=<span class="hljs-literal">false</span>
</code></pre>
      </li>
      <li class="list">To run Angular e2e tests for this chapter, execute the following command:
        <pre class="programlisting"><code class="hljs nginx"><span class="hljs-attribute">npx</span> ng e2e ch12
</code></pre>
      </li>
      <li class="list" value="7">To build a production-ready Angular app for this chapter, execute the following command:
        <pre class="programlisting"><code class="hljs ada">npx ng build ch12 <span class="hljs-comment">--prod</span>
</code></pre>
      </li>
    </ol>
    <div class="packt_tip">
      <p>Note that the <code class="Code-In-Text--PACKT-">dist/ch12</code> folder at the root of the repository will contain the compiled result.</p>
    </div>
    <p class="normal">To prepare for this chapter's examples based on <strong class="bold">local-weather-app</strong>, implement these steps:</p>
    <ol>
      <li class="list" value="1">Clone the repo at <a href="https://github.com/duluca/local-weather-app"><span class="url">https://github.com/duluca/local-weather-app</span></a></li>
      <li class="list">Execute <code class="Code-In-Text--PACKT-">npm install</code> on the root folder to install dependencies</li>
      <li class="list">The code sample for this chapter is under the following subfolder:
        <pre class="programlisting"><code class="hljs">projects/ch12
</code></pre>
      </li>
      <li class="list">To run the Angular app for this chapter, execute the following command:
        <pre class="programlisting"><code class="hljs nginx"><span class="hljs-attribute">npx</span> ng serve ch12
</code></pre>
      </li>
      <li class="list">To run Angular unit tests for this chapter, execute the following command:
        <pre class="programlisting"><code class="hljs bash">npx ng <span class="hljs-built_in">test</span> ch12 --watch=<span class="hljs-literal">false</span>
</code></pre>
      </li>
      <li class="list">To run Angular e2e tests for this chapter, execute the following command:
        <pre class="programlisting"><code class="hljs nginx"><span class="hljs-attribute">npx</span> ng e2e ch12
</code></pre>
      </li>
      <li class="list">To build a production-ready Angular app for this chapter, execute the following command:
        <pre class="programlisting"><code class="hljs ada">npx ng build ch12 <span class="hljs-comment">--prod</span>
</code></pre>
      </li>
    </ol>
    <div class="packt_tip">
      <p>Remember that the <code class="Code-In-Text--PACKT-">dist/ch12</code> folder at the root of the repository will contain the compiled result.</p>
    </div>
    <div class="note">
      <p class="Information-Box--PACKT-">Beware that the source code in the book or on GitHub may not always match the code generated by Angular CLI. There may also be slight differences in implementation between the code in the book and what's on GitHub because the ecosystem is ever-evolving. It is natural for the sample code to change over time. Also on GitHub, expect to find corrections, fixes to support newer versions of libraries, or side-by-side implementations of multiple techniques for the reader to observe. The reader is only expected to implement the ideal solution recommended in the book. If you find errors or have questions, please create an issue or submit a pull request on GitHub for the benefit of all readers.</p>
    </div>
    <div class="packt_tip">
      <p>You can read more about updating Angular in the <em class="italics">Appendix C</em>, <em class="italics">Keeping Angular and Tools Evergreen</em>. You can find this appendix online from <a href="https://static.packt-cdn.com/downloads/9781838648800_Appendix_C_Keeping_Angular_and_Tools_Evergreen."><span class="url">https://static.packt-cdn.com/downloads/9781838648800_Appendix_C_Keeping_Angular_and_Tools_Evergreen.pdf</span></a> or at <a href="https://expertlysimple.io/stay-evergreen"><span class="url">https://expertlysimple.io/stay-evergreen</span></a>.</p>
    </div>
    <p class="normal">In the next section, we will learn about resolve guards so that we can simplify our code and reduce the amount of boilerplate.</p>
    <h1 class="title" id="_idParaDest-419">Editing existing users</h1>
    <p class="normal">In <em class="italics">Chapter 11</em>, <em class="italics">Recipes – Reusability, Routing, and Caching</em>, we created a <code class="Code-In-Text--PACKT-">ViewUserComponent</code> with <a id="_idIndexMarker1364"/>an <code class="Code-In-Text--PACKT-">editUser</code> function. We need this functionality later in the chapter when implementing a master/detail view in the system, where a manager can see all users in the system and have the ability to edit them. Before <a id="_idIndexMarker1365"/>we can enable the <code class="Code-In-Text--PACKT-">editUser</code> functionality, we need to make sure that the <code class="Code-In-Text--PACKT-">ViewUserComponent</code> component alongside the <code class="Code-In-Text--PACKT-">ProfileComponent</code> can load any user given their ID.</p>
    <p class="normal">Let's start by implementing a resolve guard we can use for both components.</p>
    <h2 class="title" id="_idParaDest-420">Loading data with resolve guard</h2>
    <p class="normal">A resolve guard <a id="_idIndexMarker1366"/>is a type of router guard, as mentioned in <em class="italics">Chapter 8</em>, <em class="italics">Designing Authentication and Authorization</em>. A resolve guard can load <a id="_idIndexMarker1367"/>necessary data for a component by reading record IDs from <code class="Code-In-Text--PACKT-">route</code> parameters, asynchronously load the data, and have it ready by the time the component activates and initializes.</p>
    <p class="normal">The major advantages of a resolve guard include reusability of the loading logic, a reduction of boilerplate code, and the shedding of dependencies because the component can receive the data it needs without having to import any service:</p>
    <ol>
      <li class="list" value="1">Create a new <code class="Code-In-Text--PACKT-">user.resolve.ts</code> class under <code class="Code-In-Text--PACKT-">user/user</code>:
        <pre class="programlisting"><code class="hljs typescript"><strong>src/app/user/user/user.resolve.ts</strong>
<span class="hljs-keyword">import</span> { Injectable } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>
<span class="hljs-keyword">import</span> { ActivatedRouteSnapshot, Resolve } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/router'</span>
<span class="hljs-keyword">import</span> { catchError, map } <span class="hljs-keyword">from</span> <span class="hljs-string">'rxjs/operators'</span>
<span class="hljs-keyword">import</span> { transformError } <span class="hljs-keyword">from</span> <span class="hljs-string">'../../common/common'</span>
<span class="hljs-keyword">import</span> { IUser, User } <span class="hljs-keyword">from</span> <span class="hljs-string">'./user'</span>
<span class="hljs-keyword">import</span> { UserService } <span class="hljs-keyword">from</span> <span class="hljs-string">'./user.service'</span>
<span class="hljs-meta">@Injectable</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> UserResolve <span class="hljs-keyword">implements</span> Resolve&lt;IUser&gt; { <span class="hljs-keyword">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> userService: UserService</span>) {}
  resolve(route: ActivatedRouteSnapshot) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.userService
      .getUser(route.paramMap.get(<span class="hljs-string">'userId'</span>))
      .pipe(map(User.Build), catchError(transformError))
  }
}
</code></pre>
        <div class="packt_tip">
          <p>Note that similar to the <code class="Code-In-Text--PACKT-">updateUser</code> method in <code class="Code-In-Text--PACKT-">UserService</code>, we use <code class="Code-In-Text--PACKT-">map(User.Build)</code> to hydrate the <code class="Code-In-Text--PACKT-">user</code> object, so it is ready to be used when a component loads data from the <code class="Code-In-Text--PACKT-">route</code> snapshot, as we'll see next.</p>
        </div>
      </li>
      <li class="list">Provide <a id="_idIndexMarker1368"/>the resolver in <code class="Code-In-Text--PACKT-">user.module.ts</code>.<p class="Bullet-Without-Bullet-Within-Bullet--PACKT-">Next, let's <a id="_idIndexMarker1369"/>configure the <code class="Code-In-Text--PACKT-">router</code> and <code class="Code-In-Text--PACKT-">ProfileComponent</code> to be able to load an existing user.</p>
      </li>
      <li class="list">Modify <code class="Code-In-Text--PACKT-">user-routing.module.ts</code> to add a new path, <code class="Code-In-Text--PACKT-">profile/:userId</code>, with a route resolver and the <code class="Code-In-Text--PACKT-">canActivate AuthGuard</code>:
        <pre class="programlisting"><code class="hljs less"><strong><span class="hljs-selector-tag">src</span>/<span class="hljs-selector-tag">app</span>/<span class="hljs-selector-tag">user</span>/<span class="hljs-selector-tag">user-routing</span><span class="hljs-selector-class">.module</span><span class="hljs-selector-class">.ts</span></strong>
...
{
    <span class="hljs-attribute">path</span>: <span class="hljs-string">'profile/:userId'</span>,
    <span class="hljs-attribute">component</span>: ProfileComponent,
    <span class="hljs-attribute">resolve</span>: {
      <span class="hljs-attribute">user</span>: UserResolve,
    },
    <span class="hljs-attribute">canActivate</span>: [AuthGuard],
  },
  ...
</code></pre>
        <div class="packt_tip">
          <p>Remember to provide <code class="Code-In-Text--PACKT-">UserResolve</code> and <code class="Code-In-Text--PACKT-">AuthGuard</code> in <code class="Code-In-Text--PACKT-">user.module.ts</code>.</p>
        </div>
      </li>
      <li class="list">Update the <code class="Code-In-Text--PACKT-">profile</code> component to load the data from the <code class="Code-In-Text--PACKT-">route</code> if it exists:
        <pre class="programlisting"><code class="hljs kotlin"><strong>src/app/user/profile/profile.component.ts</strong>
...
  <span class="hljs-keyword">constructor</span>(
    ...
    <strong><span class="hljs-keyword">private</span> route: ActivatedRoute</strong>
  ) {
    <span class="hljs-keyword">super</span>()
  }
  ngOnInit() {
    <span class="hljs-keyword">this</span>.formGroup = <span class="hljs-keyword">this</span>.buildForm()
    <span class="hljs-keyword">if</span> (<strong><span class="hljs-keyword">this</span>.route.snapshot.<span class="hljs-keyword">data</span>.user</strong>) {
      <strong><span class="hljs-keyword">this</span>.patchUser(<span class="hljs-keyword">this</span>.route.snapshot.<span class="hljs-keyword">data</span>.user)</strong>
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">this</span>.subs.sink = combineLatest(
        [<span class="hljs-keyword">this</span>.loadFromCache(), 
         <span class="hljs-keyword">this</span>.authService.currentUser$]
       )
      .pipe(
        filter(
          ([cachedUser, me]) =&gt; 
            cachedUser != <span class="hljs-literal">null</span> || me != <span class="hljs-literal">null</span>
        ),
        tap(
          ([cachedUser, me]) =&gt; 
           <span class="hljs-keyword">this</span>.patchUser(cachedUser || me)
        )
      )
      .subscribe()
    }
  }
</code></pre>
      </li>
    </ol>
    <p class="normal">We first <a id="_idIndexMarker1370"/>check to see whether a user is present in the <code class="Code-In-Text--PACKT-">route</code> snapshot. If so, we call <code class="Code-In-Text--PACKT-">patchUser</code> to load this user. Otherwise, we fall back to <a id="_idIndexMarker1371"/>our conditional cache-loading logic. </p>
    <p class="normal">Note that the <code class="Code-In-Text--PACKT-">patchUser</code> method also sets the <code class="Code-In-Text--PACKT-">currentUserId</code> and <code class="Code-In-Text--PACKT-">nameInitialDate$</code> observables, as well as calling the <code class="Code-In-Text--PACKT-">patchUpdateData</code> base to update the form data.</p>
    <p class="normal">You can verify that the resolver is working by navigating to the profile with your user ID. Using the out-of-the-box settings, this URL will look something like <code class="Code-In-Text--PACKT-">http://localhost:5000/user/profile/5da01751da27cc462d265913</code>.</p>
    <h2 class="title" id="_idParaDest-421">Reusing components with binding and route data</h2>
    <p class="normal">Now, let's <a id="_idIndexMarker1372"/>refactor the <code class="Code-In-Text--PACKT-">viewUser</code> component so that we can reuse it in multiple contexts. User information is displayed <a id="_idIndexMarker1373"/>in two places in the app as per the mock-ups that were created.</p>
    <p class="normal">The first place is the <strong class="bold">Review</strong> step of the user profile that we implemented in the previous chapter. The second place is on the user management screen on the <code class="Code-In-Text--PACKT-">/manager/users</code> route, as follows:</p>
    <figure class="mediaobject"><img alt="" src="../Images/B14094_12_01.png"/></figure>
    <p class="packt_figref">Figure 12.1: Manager user management mock-up</p>
    <p class="normal">To maximize <a id="_idIndexMarker1374"/>code reuse, we need to <a id="_idIndexMarker1375"/>ensure that our shared <code class="Code-In-Text--PACKT-">ViewUser</code> component can be used in both contexts.</p>
    <p class="normal">For the <strong class="bold">Review</strong> step of the multi-step input form, we simply bind the current user to it. In the second use case, the component will need to load its own data using a resolve guard, so we don't need to implement additional logic to achieve our goal:</p>
    <ol>
      <li class="list" value="1">Update the <code class="Code-In-Text--PACKT-">viewUser</code> component to inject the <code class="Code-In-Text--PACKT-">ActivatedRoute</code> object and set <code class="Code-In-Text--PACKT-">currentUser$</code> from the route in <code class="Code-In-Text--PACKT-">ngOnInit()</code>:
        <pre class="programlisting"><code class="hljs kotlin"><strong>src/app/user/view-user/view-user.component.ts</strong>
...
<span class="hljs-keyword">import</span> { ActivatedRoute } from <span class="hljs-string">'@angular/router'</span>
export <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ViewUserComponent</span> <span class="hljs-title">implements</span> <span class="hljs-title">OnChanges</span>, <span class="hljs-type">OnInit {</span></span>
  ...
  <span class="hljs-keyword">constructor</span>(
    <span class="hljs-keyword">private</span> route: ActivatedRoute, <span class="hljs-keyword">private</span> router: Router
    ) {} 
  ngOnInit() {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.route.snapshot.<span class="hljs-keyword">data</span>.user) { 
      <span class="hljs-keyword">this</span>.currentUser$.next(<span class="hljs-keyword">this</span>.route.snapshot.<span class="hljs-keyword">data</span>.user)
    }
  }
  ...
}
</code></pre>
        <p class="Bullet-Without-Bullet-Within-Bullet--PACKT-"><code class="Code-In-Text--PACKT-">ngOnInit</code> will only fire once when the component is first initialized or has been routed to. In this case, if any data for the route has been resolved, then it'll be pushed to <code class="Code-In-Text--PACKT-">this.currentUser$</code> with the <code class="Code-In-Text--PACKT-">next()</code> function.</p>
        <p class="Bullet-Without-Bullet-Within-Bullet--PACKT-">We now <a id="_idIndexMarker1376"/>have two independent events to update data; one for <code class="Code-In-Text--PACKT-">ngOnChanges</code>, which handles updates to the <code class="Code-In-Text--PACKT-">@Input</code> value and pushes to it to <code class="Code-In-Text--PACKT-">BehaviorSubject currentUser$</code> if <code class="Code-In-Text--PACKT-">this.user</code> has been bound to.</p>
        <p class="Bullet-Without-Bullet-Within-Bullet--PACKT-">To be <a id="_idIndexMarker1377"/>able to use this component across multiple lazy loaded modules, we must wrap it in its own module:</p>
      </li>
      <li class="list">Create a new <code class="Code-In-Text--PACKT-">shared-components.module.ts</code> under <code class="Code-In-Text--PACKT-">src/app</code>:
        <pre class="programlisting"><code class="hljs coffeescript"><strong>src/app/shared-components.<span class="hljs-built_in">module</span>.ts</strong>
<span class="hljs-keyword">import</span> { CommonModule } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/common'</span>
<span class="hljs-keyword">import</span> { NgModule } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>
<span class="hljs-keyword">import</span> { FlexLayoutModule } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/flex-layout'</span>
<span class="hljs-keyword">import</span> { ReactiveFormsModule } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/forms'</span>
<span class="hljs-keyword">import</span> { AppMaterialModule } <span class="hljs-keyword">from</span> <span class="hljs-string">'./app-material.module'</span>
<span class="hljs-keyword">import</span> { 
  ViewUserComponent 
} <span class="hljs-keyword">from</span> <span class="hljs-string">'./user/view-user/view-user.component'</span>
@NgModule({
  imports: [
    CommonModule,
    ReactiveFormsModule,
    FlexLayoutModule,
    AppMaterialModule,
  ],
  declarations: [ViewUserComponent],
  exports: [ViewUserComponent],
})
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SharedComponentsModule</span> {}</span>
</code></pre>
        <p class="Bullet-Without-Bullet-Within-Bullet--PACKT-">Ensure that you import the <code class="Code-In-Text--PACKT-">SharedComponentsModule</code> module into each feature <a id="_idIndexMarker1378"/>module you intended to use <code class="Code-In-Text--PACKT-">ViewUserComponent</code> in. In our case, these will be <code class="Code-In-Text--PACKT-">UserModule</code> and <code class="Code-In-Text--PACKT-">ManagerModule</code>.</p>
      </li>
      <li class="list">Remove <code class="Code-In-Text--PACKT-">ViewUserComponent</code> from the <code class="Code-In-Text--PACKT-">User</code> module declarations</li>
      <li class="list">Similarly <a id="_idIndexMarker1379"/>declare and export <code class="Code-In-Text--PACKT-">NameInputComponent</code> in <code class="Code-In-Text--PACKT-">SharedComponentsModule</code>, and then clean up its other declarations</li>
      <li class="list" value="5">Import the modules necessary to support <code class="Code-In-Text--PACKT-">ViewUserComponent</code> and <code class="Code-In-Text--PACKT-">NameInputComponent</code> in <code class="Code-In-Text--PACKT-">SharedComponentsModule</code> as well, such as <code class="Code-In-Text--PACKT-">FieldErrorModule</code></li>
    </ol>
    <p class="normal">We now have the key pieces in place to begin implementation of the master/detail view. Let's go over this next.</p>
    <h1 class="title" id="_idParaDest-422">Master/detail view auxiliary routes</h1>
    <p class="normal">The true power of router-first architecture comes to fruition with the use of auxiliary routes, where <a id="_idIndexMarker1380"/>we can influence the layout of components solely through router configuration, allowing for rich <a id="_idIndexMarker1381"/>scenarios where we can remix the existing components into different layouts. Auxiliary routes are routes that are independent of each other where they can render content in named outlets that have been defined in the markup, such as <code class="Code-In-Text--PACKT-">&lt;router-outlet name="master"&gt;</code> or <code class="Code-In-Text--PACKT-">&lt;router-outlet name="detail"&gt;</code>. Furthermore, auxiliary routes can have their own parameters, browser history, children, and nested auxiliaries.</p>
    <p class="normal">In the following example, we will implement a basic master/detail view using auxiliary routes:</p>
    <ol>
      <li class="list" value="1">Implement a simple component with two named outlets defined:
        <pre class="programlisting"><code class="hljs xml"><strong>src/app/manager/user-management/user-management.component.ts</strong>
  template: `
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"horizontal-padding"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">router-outlet</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"master"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">router-outlet</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"min-height: 10px"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">router-outlet</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"detail"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">router-outlet</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  `
</code></pre>
      </li>
      <li class="list">Add a new <code class="Code-In-Text--PACKT-">userTable</code> component under manager</li>
      <li class="list">Update <code class="Code-In-Text--PACKT-">manager-routing.module.ts</code> to define the auxiliary routes:
        <pre class="programlisting"><code class="hljs less"><strong><span class="hljs-selector-tag">src</span>/<span class="hljs-selector-tag">app</span>/<span class="hljs-selector-tag">manager</span>/<span class="hljs-selector-tag">manager-routing</span><span class="hljs-selector-class">.module</span><span class="hljs-selector-class">.ts</span></strong>
  ...
    {
      <span class="hljs-attribute">path</span>: <span class="hljs-string">'users'</span>,
      <span class="hljs-attribute">component</span>: UserManagementComponent,
      <span class="hljs-attribute">children</span>: [
        { 
          <span class="hljs-attribute">path</span>: <span class="hljs-string">''</span>, <span class="hljs-attribute">component</span>: UserTableComponent, 
           <span class="hljs-attribute">outlet</span>: <span class="hljs-string">'master'</span> 
        },
        {
          <span class="hljs-attribute">path</span>: <span class="hljs-string">'user'</span>,
          <span class="hljs-attribute">component</span>: ViewUserComponent,
          <span class="hljs-attribute">outlet</span>: <span class="hljs-string">'detail'</span>,
          <span class="hljs-attribute">resolve</span>: {
            <span class="hljs-attribute">user</span>: UserResolve,
          },
        },
      ],
      <span class="hljs-attribute">canActivate</span>: [AuthGuard],
      <span class="hljs-attribute">canActivateChild</span>: [AuthGuard],
      <span class="hljs-attribute">data</span>: {
        <span class="hljs-attribute">expectedRole</span>: Role.Manager,
      },
    },
...
</code></pre>
        <p class="Bullet-Without-Bullet-Within-Bullet--PACKT-">This means <a id="_idIndexMarker1382"/>that when a <a id="_idIndexMarker1383"/>user navigates to <code class="Code-In-Text--PACKT-">/manager/users</code>, they'll see the <code class="Code-In-Text--PACKT-">UserTableComponent</code>, because it is implemented with the default path.</p>
      </li>
      <li class="list">Provide <code class="Code-In-Text--PACKT-">UserResolve</code> in <code class="Code-In-Text--PACKT-">manager.module.ts</code> since <code class="Code-In-Text--PACKT-">viewUser</code> depends on it</li>
      <li class="list">Implement a temporary button in <code class="Code-In-Text--PACKT-">userTable</code>:
        <pre class="programlisting"><code class="hljs vim"><strong>src/app/manager/user-table/user-table.component.html</strong>
&lt;<span class="hljs-keyword">a</span> <span class="hljs-keyword">mat</span>-button <span class="hljs-keyword">mat</span>-icon-button [routerLink]=<span class="hljs-comment">"['/manager/users', </span>
    { outlet<span class="hljs-variable">s:</span> { detai<span class="hljs-variable">l:</span> [<span class="hljs-string">'user'</span>, { userId: row._id}] } }]<span class="hljs-comment">"</span>
    skipLocationChange&gt;
  <span class="hljs-symbol">&lt;mat-icon&gt;</span>visibility&lt;/<span class="hljs-keyword">mat</span>-icon&gt;
&lt;/<span class="hljs-keyword">a</span>&gt;
</code></pre>
        <div class="packt_tip">
          <p>The <code class="Code-In-Text--PACKT-">skipLocationChange</code> directive navigates without pushing a new record into history. So if the user views multiple records and hits the <strong class="bold">Back</strong> button, they will be taken back to the previous screen, instead of having to scroll through the records they viewed first.</p>
        </div>
     
      <p class="Bullet-Without-Bullet-Within-Bullet--PACKT-">Imagine <a id="_idIndexMarker1384"/>that a user clicks on a <strong class="bold">View detail</strong> button like the one defined previously – then, <code class="Code-In-Text--PACKT-">ViewUserComponent</code> will be rendered for the user with the given <code class="Code-In-Text--PACKT-">userId</code>. In the <a id="_idIndexMarker1385"/>next screenshot, you can see what the <strong class="bold">View Details</strong> button will look like after we implement the data table in the next section:</p>
      <figure class="mediaobject"><img alt="" src="../Images/B14094_12_02.png"/></figure>
      <p class="packt_figref">Figure 12.2: View Details button</p>
      <div class="packt_tip">
        <p>You can have as many combinations and alternative components defined for the master and detail, allowing for the infinite possibilities of dynamic layouts. However, setting up the <code class="Code-In-Text--PACKT-">routerLink</code> can be a frustrating experience. Depending on the exact condition, you have to either supply or not supply all or some outlets in the link. For example, for the preceding scenario, if the link was <code class="Code-In-Text--PACKT-">['/manager/users', { outlets: { master: [''], detail: ['user', {userId: row.id}] } }]</code>, the route will silently fail to load. Expect these quirks to be ironed out in future Angular releases.</p>
      </div>
      <p class="Bullet-Without-Bullet-Within-Bullet--PACKT-">Now that we've completed the implementation of the resolve guard for <code class="Code-In-Text--PACKT-">ViewUserComponent</code>, you can use Chrome DevTools to see the data being loaded correctly.</p>
      <div class="note">
        <p class="Information-Box--PACKT-">Before debugging, ensure that the <strong class="bold">lemon-mart-server</strong> we created in <em class="italics">Chapter 10</em>, <em class="italics">RESTful APIs and Full-Stack Implementation</em>, is running.</p>
      </div> </li>
      <li class="list" value="6">In <a id="_idIndexMarker1386"/>Chrome DevTools, set <a id="_idIndexMarker1387"/>a break point right after <code class="Code-In-Text--PACKT-">this.currentUser</code> is assigned, as shown:<figure class="mediaobject"><img alt="" src="../Images/B14094_12_03.png"/></figure>
        <p class="packt_figref">Figure 12.3: Dev Tools debugging ViewUserComponent</p>
      </li>
    </ol>
    <p class="normal">You will observe that <code class="Code-In-Text--PACKT-">this.currentUser</code> is correctly set without any boilerplate code for loading data inside the <code class="Code-In-Text--PACKT-">ngOnInit</code> function, showing the true benefit of a resolve guard. <code class="Code-In-Text--PACKT-">ViewUserComponent</code> is the detail view; now let's implement the master view as a data table with pagination.</p>
    <h1 class="title" id="_idParaDest-423">Data table with pagination</h1>
    <p class="normal">We have <a id="_idIndexMarker1388"/>created the scaffolding to lay out <a id="_idIndexMarker1389"/>our master/detail view. In the master outlet, we will have a paginated data table of users, so let's implement <code class="Code-In-Text--PACKT-">UserTableComponent</code>, which will contain a <code class="Code-In-Text--PACKT-">MatTableDataSource</code> property named <code class="Code-In-Text--PACKT-">dataSource</code>. We will need to be able to fetch user data in bulk using standard pagination controls such as <code class="Code-In-Text--PACKT-">pageSize</code> and <code class="Code-In-Text--PACKT-">pagesToSkip</code> and be able to further narrow down the <a id="_idIndexMarker1390"/>selection with user-provided <code class="Code-In-Text--PACKT-">searchText</code>.</p>
    <p class="normal">Let's start <a id="_idIndexMarker1391"/>by adding the necessary functionality to the <code class="Code-In-Text--PACKT-">UserService</code>:</p>
    <ol>
      <li class="list" value="1">Implement a new <code class="Code-In-Text--PACKT-">IUsers</code> interface to describe the data structure of the paginated data:
        <pre class="programlisting"><code class="hljs routeros"><strong>src/app/user/user/user.service.ts</strong>
<span class="hljs-built_in">..</span>.
<span class="hljs-builtin-name">export</span><span class="hljs-built_in"> interface </span>IUsers {
  data: IUser[]
  total: number
}
</code></pre>
      </li>
      <li class="list">Update the interface for <code class="Code-In-Text--PACKT-">UserService</code> with a <code class="Code-In-Text--PACKT-">getUsers</code> function:
        <pre class="programlisting"><code class="hljs routeros"><strong>src/app/user/user/user.service.ts</strong>
<span class="hljs-built_in">..</span>.
<span class="hljs-builtin-name">export</span><span class="hljs-built_in"> interface </span>IUserService {
  getUser(id: string): Observable&lt;IUser&gt;
  updateUser(id: string, user: IUser): Observable&lt;IUser&gt;
  <strong>getUsers(pageSize: number, searchText: string, </strong>
<strong>    pagesToSkip: number): Observable&lt;IUsers&gt;</strong>
}
<span class="hljs-builtin-name">export</span> class UserService extends CacheService implements IUserService {
<span class="hljs-built_in">..</span>.
</code></pre>
      </li>
      <li class="list">Add <code class="Code-In-Text--PACKT-">getUsers</code> to <code class="Code-In-Text--PACKT-">UserService</code>:
        <pre class="programlisting"><code class="hljs vim"><strong>src/app/user/user/user.service.<span class="hljs-keyword">ts</span></strong>
...
getUsers(
    pageSize: <span class="hljs-keyword">number</span>,
    searchText = <span class="hljs-string">''</span>,
    pagesToSkip = <span class="hljs-number">0</span>,
    sortColumn = <span class="hljs-string">''</span>,
    sortDirection: <span class="hljs-string">''</span> | <span class="hljs-string">'asc'</span> | <span class="hljs-string">'desc'</span> = <span class="hljs-string">'asc'</span>
  ): Observable<span class="hljs-symbol">&lt;IUsers&gt;</span> {
    const recordsToSkip = pageSize * pagesToSkip
    <span class="hljs-keyword">if</span> (sortColumn) {
      sortColumn =
        sortDirection === <span class="hljs-string">'desc'</span> ? `-${sortColumn}` : sortColumn
    }
    <span class="hljs-keyword">return</span> this.httpClient.<span class="hljs-built_in">get</span><span class="hljs-symbol">&lt;IUsers&gt;</span>(
      `${environment.baseUrl}/v2/users`, { 
        param<span class="hljs-variable">s:</span> {
          <span class="hljs-built_in">filter</span>: searchText,
          skip: recordsToSkip.toString(),
          limi<span class="hljs-variable">t:</span> pageSize.toString(),
          sortKey: sortColumn,
        },
      })
    }
...
</code></pre>
        <div class="packt_tip">
          <p>Note that the sort direction is represented by the keywords <code class="Code-In-Text--PACKT-">asc</code> for ascending and <code class="Code-In-Text--PACKT-">desc</code> for descending. When we want to sort a column in ascending order, we pass the column name as a parameter to the server. To sort a column in descending order, we prepend the column name with a minus sign.</p>
        </div>
      </li>
      <li class="list">Set <a id="_idIndexMarker1392"/>up <code class="Code-In-Text--PACKT-">UserTable</code> with <a id="_idIndexMarker1393"/>pagination, sorting, and filtering:
        <pre class="programlisting"><code class="hljs kotlin"><strong>src/app/manager/user-table/user-table.component.ts</strong>
...
<span class="hljs-meta">@Component({
  selector: <span class="hljs-meta-string">'app-user-table'</span>,
  templateUrl: <span class="hljs-meta-string">'./user-table.component.html'</span>,
  styleUrls: [<span class="hljs-meta-string">'./user-table.component.css'</span>],
})</span>
export <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserTableComponent</span> <span class="hljs-title">implements</span> <span class="hljs-title">OnDestroy</span>, <span class="hljs-type">AfterViewInit {</span></span>
  displayedColumns = [<span class="hljs-string">'name'</span>, <span class="hljs-string">'email'</span>, <span class="hljs-string">'role'</span>, <span class="hljs-string">'_id'</span>]
  items$: Observable&lt;IUser[]&gt;
  resultsLength = <span class="hljs-number">0</span>
  hasError = <span class="hljs-literal">false</span>
  errorText = <span class="hljs-string">''</span>
  <span class="hljs-keyword">private</span> skipLoading = <span class="hljs-literal">false</span>
  <span class="hljs-keyword">private</span> subs = new SubSink()
  readonly isLoadingResults$ = new BehaviorSubject(<span class="hljs-literal">true</span>)
  loading$: Observable&lt;boolean&gt;
  refresh$ = new Subject()
  search = new FormControl(<span class="hljs-string">''</span>, OptionalTextValidation)
  <span class="hljs-meta">@ViewChild(MatPaginator, { static: false })</span>
    paginator: MatPaginator 
  <span class="hljs-meta">@ViewChild(MatSort, { static: false })</span> sort: MatSort
  <span class="hljs-keyword">constructor</span>(
    <span class="hljs-keyword">private</span> userService: UserService
  ) {
    <span class="hljs-keyword">this</span>.loading$ = <span class="hljs-keyword">this</span>.isLoadingResults$
  }
  getUsers(
    pageSize: number,
    searchText: string,
    pagesToSkip: number,
    sortColumn: string,
    sortDirection: SortDirection
  ): Observable&lt;IUsers&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.userService.getUsers(
      pageSize,
      searchText,
      pagesToSkip,
      sortColumn,
      sortDirection
    )
  }
  ngOnDestroy(): void {
    <span class="hljs-keyword">this</span>.subs.unsubscribe()
  }
  ngAfterViewInit() {
    <span class="hljs-keyword">this</span>.subs.sink = <span class="hljs-keyword">this</span>.sort.sortChange
      .subscribe(() =&gt; <span class="hljs-keyword">this</span>.paginator.firstPage()) 
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.skipLoading) {
      <span class="hljs-keyword">return</span>
    }
    <strong><span class="hljs-keyword">this</span>.items$ = merge(</strong>
<strong>      <span class="hljs-keyword">this</span>.refresh$,</strong>
<strong>      <span class="hljs-keyword">this</span>.sort.sortChange,</strong>
<strong>      <span class="hljs-keyword">this</span>.paginator.page,</strong>
<strong>      <span class="hljs-keyword">this</span>.search.valueChanges.pipe(debounceTime(<span class="hljs-number">1000</span>))</strong>
<strong>    ).pipe(</strong>
<strong>      startWith({}),</strong>
<strong>      switchMap(() =&gt; {</strong>
<strong>        <span class="hljs-keyword">this</span>.isLoadingResults$.next(<span class="hljs-literal">true</span>)</strong>
<strong>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.getUsers(</strong>
<strong>          <span class="hljs-keyword">this</span>.paginator.pageSize,</strong>
<strong>          <span class="hljs-keyword">this</span>.search.value,</strong>
<strong>          <span class="hljs-keyword">this</span>.paginator.pageIndex,</strong>
<strong>          <span class="hljs-keyword">this</span>.sort.active,</strong>
<strong>          <span class="hljs-keyword">this</span>.sort.direction</strong>
<strong>        )</strong>
<strong>      }),</strong>
<strong>      map((results: { total: number; <span class="hljs-keyword">data</span>: IUser[] }) =&gt; {</strong>
<strong>        <span class="hljs-keyword">this</span>.isLoadingResults$.next(<span class="hljs-literal">false</span>)</strong>
<strong>        <span class="hljs-keyword">this</span>.hasError = <span class="hljs-literal">false</span></strong>
<strong>        <span class="hljs-keyword">this</span>.resultsLength = results.total</strong>
<strong>        <span class="hljs-keyword">return</span> results.<span class="hljs-keyword">data</span></strong>
<strong>      }),</strong>
<strong>      catchError((err) =&gt; {</strong>
<strong>        <span class="hljs-keyword">this</span>.isLoadingResults$.next(<span class="hljs-literal">false</span>)</strong>
<strong>        <span class="hljs-keyword">this</span>.hasError = <span class="hljs-literal">true</span></strong>
<strong>        <span class="hljs-keyword">this</span>.errorText = err</strong>
<strong>        <span class="hljs-keyword">return</span> of([])</strong>
<strong>      })</strong>
<strong>    )</strong>
<strong>    <span class="hljs-keyword">this</span>.items$.subscribe()</strong>
  }
}
</code></pre>
        <div class="packt_tip">
          <p>We define <a id="_idIndexMarker1394"/>and initialize various <a id="_idIndexMarker1395"/>properties to support loading paginated data. <code class="Code-In-Text--PACKT-">items$</code> stores the user records, <code class="Code-In-Text--PACKT-">displayedColumns</code> defines the columns of data we intend to display, <code class="Code-In-Text--PACKT-">paginator</code> and <code class="Code-In-Text--PACKT-">sort</code> provide pagination and sorting preferences, and <code class="Code-In-Text--PACKT-">search</code> provides the text we need to filter our results by.</p>
        </div>
        <p class="Bullet-Without-Bullet-Within-Bullet--PACKT-">In <code class="Code-In-Text--PACKT-">ngAfterViewInit</code>, we use the <code class="Code-In-Text--PACKT-">merge</code> method, as highlighted in the preceding <a id="_idIndexMarker1396"/>snippet, to listen for changes <a id="_idIndexMarker1397"/>in pagination, sorting, and filter properties. If one property changes, the whole pipeline is triggered. This is similar to how we implemented the login routine in <code class="Code-In-Text--PACKT-">AuthService</code>. The pipeline contains a call to <code class="Code-In-Text--PACKT-">this.userService.getUsers</code>, which will retrieve users based on the pagination, sorting, and filter preferences passed in. Results are then piped into the <code class="Code-In-Text--PACKT-">this.items$</code> observable, which the data table subscribes to with an <code class="Code-In-Text--PACKT-">async</code> pipe, so it can display the data.</p>
      </li>
      <li class="list">Create a <code class="Code-In-Text--PACKT-">ManagerMaterialModule</code> containing the following Material modules:
        <pre class="programlisting"><code class="hljs autohotkey"><strong>src/app/manager/manager-material.module.ts</strong>
<span class="hljs-built_in">    MatTableModule,</span>
<span class="hljs-built_in">    MatSortModule,</span>
<span class="hljs-built_in">    MatPaginatorModule,</span>
<span class="hljs-built_in">    MatProgressSpinnerModule,</span>
<span class="hljs-built_in">    MatSlideToggleModule,</span>
</code></pre>
      </li>
      <li class="list">Ensure <a id="_idIndexMarker1398"/>that <code class="Code-In-Text--PACKT-">manager.module.ts</code> correctly imports the following:<ul>
          <li class="Bullet-Within-Bullet--PACKT-">The new <code class="Code-In-Text--PACKT-">ManageMaterialModule</code></li>
          <li class="Bullet-Within-Bullet--PACKT-">The baseline <code class="Code-In-Text--PACKT-">AppMaterialModule</code></li>
          <li class="Bullet-Within-Bullet-End--PACKT-">The following required modules: <code class="Code-In-Text--PACKT-">FormsModule</code>, <code class="Code-In-Text--PACKT-">ReactiveFormsModule</code>, and <code class="Code-In-Text--PACKT-">FlexLayoutModule</code></li>
        </ul>
      </li>
      <li class="list">Implement <a id="_idIndexMarker1399"/>the CSS for <code class="Code-In-Text--PACKT-">userTable</code>:
        <pre class="programlisting"><code class="hljs yaml"><strong><span class="hljs-string">src/app/manager/user-table/user-table.component.css</span></strong>
<span class="hljs-string">.loading-shade</span> <span class="hljs-string">{</span>
  <span class="hljs-attr">position:</span> <span class="hljs-string">absolute;</span>
  <span class="hljs-attr">top:</span> <span class="hljs-number">0</span><span class="hljs-string">;</span>
  <span class="hljs-attr">left:</span> <span class="hljs-number">0</span><span class="hljs-string">;</span>
  <span class="hljs-attr">bottom:</span> <span class="hljs-string">56px;</span>
  <span class="hljs-attr">right:</span> <span class="hljs-number">0</span><span class="hljs-string">;</span>
  <span class="hljs-attr">background:</span> <span class="hljs-string">rgba(0,</span> <span class="hljs-number">0</span><span class="hljs-string">,</span> <span class="hljs-number">0</span><span class="hljs-string">,</span> <span class="hljs-number">0.15</span><span class="hljs-string">);</span>
  <span class="hljs-attr">z-index:</span> <span class="hljs-number">1</span><span class="hljs-string">;</span>
  <span class="hljs-attr">display:</span> <span class="hljs-string">flex;</span>
  <span class="hljs-attr">align-items:</span> <span class="hljs-string">center;</span>
  <span class="hljs-attr">justify-content:</span> <span class="hljs-string">center;</span>
<span class="hljs-string">}</span>
<span class="hljs-string">.filter-row</span> <span class="hljs-string">{</span>
  <span class="hljs-attr">min-height:</span> <span class="hljs-string">64px;</span>
  <span class="hljs-attr">padding:</span> <span class="hljs-string">8px</span> <span class="hljs-string">24px</span> <span class="hljs-number">0</span><span class="hljs-string">;</span>
<span class="hljs-string">}</span>
<span class="hljs-string">.full-width</span> <span class="hljs-string">{</span>
  <span class="hljs-attr">width:</span> <span class="hljs-number">100</span><span class="hljs-string">%;</span>
<span class="hljs-string">}</span>
<span class="hljs-string">.mat-paginator</span> <span class="hljs-string">{</span>
  <span class="hljs-attr">background:</span> <span class="hljs-string">transparent;</span>
<span class="hljs-string">}</span>
</code></pre>
      </li>
      <li class="list">Finally, implement the <code class="Code-In-Text--PACKT-">userTable</code> template:
        <pre class="programlisting"><code class="hljs dust"><strong><span class="xml">src/app/manager/user-table/user-table.component.html</span></strong><span class="xml">
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"filter-row"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"margin-bottom: 32px"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">fxLayout</span>=<span class="hljs-string">"row"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">mat-form-field</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"full-width"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mat-icon</span> <span class="hljs-attr">matPrefix</span>&gt;</span>search<span class="hljs-tag">&lt;/<span class="hljs-name">mat-icon</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">matInput</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"Search"</span> <span class="hljs-attr">aria-label</span>=<span class="hljs-string">"Search"</span> [<span class="hljs-attr">formControl</span>]=<span class="hljs-string">"search"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mat-hint</span>&gt;</span>Search by e-mail or name<span class="hljs-tag">&lt;/<span class="hljs-name">mat-hint</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mat-error</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"search.invalid"</span>&gt;</span>
          Type more than one character to search
        <span class="hljs-tag">&lt;/<span class="hljs-name">mat-error</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">mat-form-field</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"mat-elevation-z8"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"loading-shade"</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"loading$ | async as loading"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">mat-spinner</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"loading"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">mat-spinner</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"error"</span> *<span class="hljs-attr">ngIf</span>=<span class="hljs-string">"hasError"</span>&gt;</span>
      </span><span class="hljs-template-variable">{{ errorText }</span><span class="xml">}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">table</span> <span class="hljs-attr">mat-table</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"full-width"</span> [<span class="hljs-attr">dataSource</span>]=<span class="hljs-string">"items$ | async"</span> <span class="hljs-attr">matSort</span>
    <span class="hljs-attr">matSortActive</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">matSortDirection</span>=<span class="hljs-string">"asc"</span> <span class="hljs-attr">matSortDisableClear</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">ng-container</span> <span class="hljs-attr">matColumnDef</span>=<span class="hljs-string">"name"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">th</span> <span class="hljs-attr">mat-header-cell</span> *<span class="hljs-attr">matHeaderCellDef</span> <span class="hljs-attr">mat-sort-header</span>&gt;</span> Name <span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">mat-cell</span> *<span class="hljs-attr">matCellDef</span>=<span class="hljs-string">"let row"</span>&gt;</span>
        </span><span class="hljs-template-variable">{{ row.fullName }</span><span class="xml">}
      <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">ng-container</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">ng-container</span> <span class="hljs-attr">matColumnDef</span>=<span class="hljs-string">"email"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">th</span> <span class="hljs-attr">mat-header-cell</span> *<span class="hljs-attr">matHeaderCellDef</span> <span class="hljs-attr">mat-sort-header</span>&gt;</span> E-mail <span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">mat-cell</span> *<span class="hljs-attr">matCellDef</span>=<span class="hljs-string">"let row"</span>&gt;</span> </span><span class="hljs-template-variable">{{ row.email }</span><span class="xml">} <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">ng-container</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">ng-container</span> <span class="hljs-attr">matColumnDef</span>=<span class="hljs-string">"role"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">th</span> <span class="hljs-attr">mat-header-cell</span> *<span class="hljs-attr">matHeaderCellDef</span> <span class="hljs-attr">mat-sort-header</span>&gt;</span> Role <span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">mat-cell</span> *<span class="hljs-attr">matCellDef</span>=<span class="hljs-string">"let row"</span>&gt;</span> </span><span class="hljs-template-variable">{{ row.role }</span><span class="xml">} <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">ng-container</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">ng-container</span> <span class="hljs-attr">matColumnDef</span>=<span class="hljs-string">"_id"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">th</span> <span class="hljs-attr">mat-header-cell</span> *<span class="hljs-attr">matHeaderCellDef</span>&gt;</span>View Details
      <span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">mat-cell</span> *<span class="hljs-attr">matCellDef</span>=<span class="hljs-string">"let row"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"margin-right: 8px"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">mat-button</span> <span class="hljs-attr">mat-icon-button</span> [<span class="hljs-attr">routerLink</span>]=<span class="hljs-string">"[
            '/manager/users',
            </span></span></span><span class="hljs-template-variable">{ outlets: { detail: ['user', { userId: row._id }</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">] } }
          ]"</span> <span class="hljs-attr">skipLocationChange</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">mat-icon</span>&gt;</span>visibility<span class="hljs-tag">&lt;/<span class="hljs-name">mat-icon</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">ng-container</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span> <span class="hljs-attr">mat-header-row</span> *<span class="hljs-attr">matHeaderRowDef</span>=<span class="hljs-string">"displayedColumns"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span> <span class="hljs-attr">mat-row</span> *<span class="hljs-attr">matRowDef</span>=<span class="hljs-string">"let row; columns: displayedColumns"</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">mat-toolbar</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">mat-toolbar-row</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">mat-icon-button</span> (<span class="hljs-attr">click</span>)=<span class="hljs-string">"refresh$.next()"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mat-icon</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"Refresh"</span>&gt;</span>refresh<span class="hljs-tag">&lt;/<span class="hljs-name">mat-icon</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"flex-spacer"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">mat-paginator</span> [<span class="hljs-attr">pageSizeOptions</span>]=<span class="hljs-string">"[5, 10, 25, 100]"</span>
                     [<span class="hljs-attr">length</span>]=<span class="hljs-string">"resultsLength"</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">mat-paginator</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">mat-toolbar-row</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">mat-toolbar</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</span></code></pre>
        <p class="Bullet-Without-Bullet-Within-Bullet--PACKT-">With just <a id="_idIndexMarker1400"/>the master view in place, the table <a id="_idIndexMarker1401"/>is as shown in the following screenshot (make sure you've updated to the latest version of Angular!):</p>
        <figure class="mediaobject"><img alt="" src="../Images/B14094_12_04.png"/></figure>
        <p class="packt_figref">Figure 12.4: User table</p>
        <p class="Bullet-Without-Bullet-Within-Bullet--PACKT-">If you <a id="_idIndexMarker1402"/>click on the <strong class="screen-text">View</strong> icon, <code class="Code-In-Text--PACKT-">ViewUserComponent</code> will get <a id="_idIndexMarker1403"/>rendered in the detail outlet, as shown:</p>
        <figure class="mediaobject"> <img alt="" src="../Images/B14094_12_05.png"/></figure>
        <p class="packt_figref">Figure 12.5: Master/detail view</p>
        <p class="Bullet-Without-Bullet-Within-Bullet--PACKT-">In the <a id="_idIndexMarker1404"/>previous chapter, we implemented the <strong class="screen-text">Edit</strong> button, passing the <code class="Code-In-Text--PACKT-">userId</code> to the <code class="Code-In-Text--PACKT-">UserProfile</code> so that the data <a id="_idIndexMarker1405"/>can be edited and updated.</p>
      </li>
      <li class="list">Click on the <strong class="screen-text">Edit</strong> button to be taken to the <code class="Code-In-Text--PACKT-">ProfileComponent</code>, edit the user record, and verify that you can update another user's record</li>
      <li class="list" value="10">Confirm that you can view the updated user record in the data table</li>
    </ol>
    <p class="normal">This demonstration <a id="_idIndexMarker1406"/>of data tables with pagination <a id="_idIndexMarker1407"/>completes the major functionality of LemonMart for the purpose of this book. Now, before we move on, let's make sure that all of our tests pass.</p>
    <h2 class="title" id="_idParaDest-424">Updating unit tests</h2>
    <p class="normal">Let's go <a id="_idIndexMarker1408"/>over some unit tests for <code class="Code-In-Text--PACKT-">ProfileComponent</code> and <code class="Code-In-Text--PACKT-">UserTableComponent</code> to see how we can leverage different techniques to test the components:</p>
    <ol>
      <li class="list" value="1">Observe the unit test file for <code class="Code-In-Text--PACKT-">ProfileComponent</code> and identify the use of the <code class="Code-In-Text--PACKT-">authServiceMock</code> object to provide initial data for the component:
        <pre class="programlisting"><code class="hljs vim"><strong>src/app/user/<span class="hljs-keyword">profile</span>/<span class="hljs-keyword">profile</span>.component.spec.<span class="hljs-keyword">ts</span></strong>
describe(<span class="hljs-string">'ProfileComponent'</span>, () =&gt; {
  <span class="hljs-keyword">let</span> componen<span class="hljs-variable">t:</span> ProfileComponent
  <span class="hljs-keyword">let</span> fixture: ComponentFixture<span class="hljs-symbol">&lt;ProfileComponent&gt;</span>
  <span class="hljs-keyword">let</span> authServiceMock: jasmine.SpyObj<span class="hljs-symbol">&lt;AuthService&gt;</span>
  beforeEach(async(() =&gt; {
    const authServiceSpy = autoSpyObj(
      AuthService,
      [<span class="hljs-string">'currentUser$'</span>, <span class="hljs-string">'authStatus$'</span>],
      ObservablePropertyStrategy.BehaviorSubject
    )
    TestBed.configureTestingModule({
      provider<span class="hljs-variable">s:</span> commonTestingProviders.concat({
        provide: AuthService,
        useValue: authServiceSpy,
      }),
      import<span class="hljs-variable">s:</span> commonTestingModules.concat([
        UserMaterialModule,
        FieldErrorModule,
        LemonRaterModule,
      ]),
      declaration<span class="hljs-variable">s:</span> [ProfileComponent, NameInputComponent, ViewUserComponent],
    }).compileComponents()
    authServiceMock = injectSpy(AuthService)
    fixture = TestBed.createComponent(ProfileComponent)
    component = fixture.debugElement.componentInstance
  }))
  it(<span class="hljs-string">'should create'</span>, () =&gt; {
    authServiceMock.currentUser$.<span class="hljs-keyword">next</span>(<span class="hljs-keyword">new</span> User())
    authServiceMock.authStatus$.<span class="hljs-keyword">next</span>(defaultAuthStatus)
    fixture.detectChanges()
    expect(component).toBeTruthy()
  })
})
</code></pre>
        <div class="packt_tip">
          <p>Note that instead of using the <code class="Code-In-Text--PACKT-">createComponentMock</code> function from <code class="Code-In-Text--PACKT-">angular-unit-test-helper</code> to import <code class="Code-In-Text--PACKT-">NameInputComponent</code> or <code class="Code-In-Text--PACKT-">ViewUserComponent</code>, I import their actual implementations. This is because <code class="Code-In-Text--PACKT-">createComponentMock</code> is not yet sophisticated enough to deal with binding data to child components. In the <em class="italics">Further reading</em> section, I've included a blog post by Aiko Klostermann that covers testing Angular components with <code class="Code-In-Text--PACKT-">@Input()</code> properties.</p>
        </div>
      </li>
      <li class="list">Open the spec file for <code class="Code-In-Text--PACKT-">UserTableComponent</code>:<p class="Bullet-Without-Bullet-Within-Bullet--PACKT-">After fixing up its providers and imports, you will notice that <code class="Code-In-Text--PACKT-">UserTableComponent</code> is throwing an <code class="Code-In-Text--PACKT-">ExpressionChangedAfterItHasBeenCheckedError</code> error. This is <a id="_idIndexMarker1409"/>because the component initialization logic requires <code class="Code-In-Text--PACKT-">dataSource</code> to be defined. If undefined, the component can't be created. However, we can easily modify component properties in the second <code class="Code-In-Text--PACKT-">beforeEach</code> method, which executes after <code class="Code-In-Text--PACKT-">TestBed</code> has injected real, mocked, or fake dependencies into the component class. See the highlighted changes in the following snippet for the test data setup:</p>
        <pre class="programlisting"><code class="hljs reasonml"><strong>src/app/manager/user-table/user-table.component.spec.ts</strong><span class="hljs-operator">
...
</span>before<span class="hljs-constructor">Each(()</span> =&gt; {
    fixture = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">TestBed</span>.</span></span>create<span class="hljs-constructor">Component(UserTableComponent)</span>
    component = fixture.componentInstance
    <strong>component.items$ = <span class="hljs-keyword">of</span>(<span class="hljs-literal">[<span class="hljs-identifier">new</span> U<span class="hljs-identifier">ser</span>()]</span>)</strong>
<strong>    <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Object</span>.</span></span>assign(component, { skipLoading: <span class="hljs-literal">true</span> })</strong>
    fixture.detect<span class="hljs-constructor">Changes()</span>
})<span class="hljs-operator">
...
</span></code></pre>
        <p class="Bullet-Without-Bullet-Within-Bullet--PACKT-">By now, you may have noticed that just by updating some of our central configuration files, such as <code class="Code-In-Text--PACKT-">commonTestingProviders</code> and <code class="Code-In-Text--PACKT-">commonTestingModules</code>, some tests are passing, and the rest of the tests can be resolved by applying the various patterns we have been using throughout the book. For example, <code class="Code-In-Text--PACKT-">user-management.component.spec.ts</code> uses the common testing modules and providers we have created:</p>
        <pre class="programlisting"><code class="hljs dts"><strong>src<span class="hljs-meta-keyword">/app/</span>manager<span class="hljs-meta-keyword">/user-management/</span>user-management.component.spec.ts</strong>
<span class="hljs-symbol">providers:</span> commonTestingProviders,
<span class="hljs-symbol">imports:</span> commonTestingModules.concat([ManagerMaterialModule]),
</code></pre>
        <p class="Bullet-Without-Bullet-Within-Bullet--PACKT-">When you <a id="_idIndexMarker1410"/>are mocking providers, keep in mind what module, component, service, or class is under test and take care only to mock dependencies.</p>
        <div class="packt_tip">
          <p><code class="Code-In-Text--PACKT-">ViewUserComponent</code> is a special case where we can't use our common testing modules and providers, otherwise, we would end up creating a circular dependency. In this case, manually specify the modules that need to be imported.</p>
        </div>
      </li>
      <li class="list" value="3">Fix the unit test configurations so all of them are passing and no warnings are generated.</li>
    </ol>
    <p class="normal">With the heavy lifting of the implementation completed, we can now explore alternative architectures, tools, and libraries to better understand the best ways to architect Angular apps for various needs. Next, let's explore NgRx.</p>
    <h1 class="title" id="_idParaDest-425">NgRx Store and Effects</h1>
    <p class="normal">As covered in <em class="italics">Chapter 1</em>, <em class="italics">Introduction to Angular and Its Concepts</em>, the NgRx library brings reactive state <a id="_idIndexMarker1411"/>management to Angular based on RxJS. State management with NgRx allows developers to write atomic, self-contained, and composable <a id="_idIndexMarker1412"/>pieces of code, creating actions, reducers, and selectors. This kind of reactive programming allows side effects in state changes to be isolated. In essence, NgRx is an abstraction layer over RxJS to fit the Flux pattern.</p>
    <p class="normal">There are four major elements of NgRx:</p>
    <ul>
      <li class="list"><strong class="bold">Store</strong>: The central <a id="_idIndexMarker1413"/>location where state information is persisted. You implement a reducer to store a state transition in the store and a selector to read data out of the store. These are atomic and <a id="_idIndexMarker1414"/>composable pieces of code.<div class="note">
          <p class="Information-Box--PACKT-">A view (or user interface) displays data from the store by using a selector.</p>
        </div>
      </li>
      <li class="list"><strong class="bold">Action</strong>: Unique <a id="_idIndexMarker1415"/>events that happen throughout your app.<div class="note">
          <p class="Information-Box--PACKT-">Actions are triggered from a view with the purpose of dispatching them to the store.</p>
        </div>
      </li>
      <li class="list"><strong class="bold">Dispatcher</strong>: This is a <a id="_idIndexMarker1416"/>method to send actions to the store.<div class="note">
          <p class="Information-Box--PACKT-">Reducers on the store listen for dispatched actions.</p>
        </div>
      </li>
      <li class="list"><strong class="bold">Effect</strong>: This is a <a id="_idIndexMarker1417"/>combination of an action and a dispatcher. Effects are usually used for actions that are not triggered from a view.</li>
    </ul>
    <p class="normal">Let's revisit the following Flux pattern diagram, which now highlights an <strong class="bold">Effect</strong>:</p>
    <figure class="mediaobject"><img alt="" src="../Images/B14094_12_06.png"/></figure>
    <p class="packt_figref">Figure 12.6: Flux pattern diagram</p>
    <p class="normal">Let's demonstrate how NgRx works by going over a concrete example. In order to keep it simple, we will be leveraging the LocalCast Weather app.</p>
    <h2 class="title" id="_idParaDest-426">Implementing NgRx for LocalCast Weather</h2>
    <p class="normal">We will <a id="_idIndexMarker1418"/>be implementing NgRx to execute the search functionality in the LocalCast Weather app. Consider the following architecture diagram:</p>
    <figure class="mediaobject"><img alt="" src="../Images/B14094_12_07.png"/></figure>
    <p class="packt_figref">Figure 12.7: LocalCast Weather architecture</p>
    <p class="normal">In order to achieve our implementation, we will use both the NgRx store and effects libraries. NgRx store actions are reflected in the diagram in light gray with a <code class="Code-In-Text--PACKT-">WeatherLoaded</code> reducer and the app state. At the top, actions are represented as a stream of various data objects either dispatching actions or acting on dispatched actions, enabling us to implement the Flux pattern. The NgRx effects library extends the Flux pattern by isolating side effects in its own model without littering the store with temporary data.</p>
    <p class="normal">The effects workflow, represented in dark gray, begins with <strong class="bold">Step 1</strong>:</p>
    <ol>
      <li class="list" value="1"><code class="Code-In-Text--PACKT-">CitySearchComponent</code> dispatches the <code class="Code-In-Text--PACKT-">search</code> action</li>
      <li class="list">The <code class="Code-In-Text--PACKT-">search</code> action appears on the observable <code class="Code-In-Text--PACKT-">@ngrx/action</code> stream (or data stream)</li>
      <li class="list"><code class="Code-In-Text--PACKT-">CurrentWeatherEffects</code> acts on the <code class="Code-In-Text--PACKT-">search</code> action to perform a search</li>
      <li class="list" value="4"><code class="Code-In-Text--PACKT-">WeatherService</code> performs the search to retrieve current weather information <a id="_idIndexMarker1419"/>from the <strong class="bold">OpenWeather API</strong></li>
    </ol>
    <p class="normal">Store <a id="_idIndexMarker1420"/>actions, represented in light gray, begin with <strong class="bold">Step A</strong>:</p>
    <ol type="A">
      <li class="list"><code class="Code-In-Text--PACKT-">CurrentWeatherEffects</code> dispatches the <code class="Code-In-Text--PACKT-">weatherLoaded</code> action</li>
      <li class="list">The <code class="Code-In-Text--PACKT-">weatherLoaded</code> action appears on the data stream</li>
      <li class="list">The <code class="Code-In-Text--PACKT-">weatherLoaded</code> reducer acts on the <code class="Code-In-Text--PACKT-">weatherLoaded</code> action</li>
      <li class="list">The <code class="Code-In-Text--PACKT-">weatherLoaded</code> reducer transforms the weather information to be stored as a new state</li>
      <li class="list" value="5">The new state is a persisted <code class="Code-In-Text--PACKT-">search</code> state, part of the <code class="Code-In-Text--PACKT-">appStore</code> state</li>
    </ol>
    <div class="packt_tip">
      <p>Note that there's a parent-level <code class="Code-In-Text--PACKT-">appStore</code> state, which contains a child <code class="Code-In-Text--PACKT-">search</code> state. I intentionally retained this setup to demonstrate how the parent-level state scales as you add different kinds of data elements to the store.</p>
    </div>
    <p class="normal">Finally, a view reads from the store, beginning with <strong class="bold">step a</strong>:</p>
    <ol type="a">
      <li class="list">The <code class="Code-In-Text--PACKT-">CurrentWeather</code> component subscribes to the <code class="Code-In-Text--PACKT-">selectCurrentWeather</code> selector using the <code class="Code-In-Text--PACKT-">async</code> pipe</li>
      <li class="list">The <code class="Code-In-Text--PACKT-">selectCurrentWeather</code> selector listens for changes to the <code class="Code-In-Text--PACKT-">store.search.current</code> property in the <code class="Code-In-Text--PACKT-">appStore</code> state</li>
      <li class="list" value="3">The <code class="Code-In-Text--PACKT-">appStore</code> state retrieves the persisted data</li>
    </ol>
    <p class="normal">Using NgRx, when a user searches for a city, the actions to retrieve, persist, and display that information on the <code class="Code-In-Text--PACKT-">CurrentWeatherComponent</code> happens automatically via individual composable and immutable elements.</p>
    <h2 class="title" id="_idParaDest-427">Comparing BehaviorSubject and NgRx</h2>
    <p class="normal">We will be <a id="_idIndexMarker1421"/>implementing NgRx side by side with <code class="Code-In-Text--PACKT-">BehaviorSubjects</code>, so you can see the differences in the implementation of the same feature. To do <a id="_idIndexMarker1422"/>this, we will need a slide toggle to switch between the two strategies:</p>
    <div class="note">
      <p class="Information-Box--PACKT-">This section uses the <strong class="bold">local-weather-app</strong> repo. You can find the code samples for this chapter under the <code class="Code-In-Text--PACKT-">projects/ch12</code> folder.</p>
    </div>
    <ol>
      <li class="list" value="1">Start by implementing a <code class="Code-In-Text--PACKT-">&lt;mat-slide-toggle&gt;</code> element on <code class="Code-In-Text--PACKT-">CitySearchComponent</code>, as shown in the following screenshot:<figure class="mediaobject"><img alt="" src="../Images/B14094_12_08.png"/></figure>
        <p class="packt_figref">Figure 12.8: LocalCast Weather slide toggle</p>
        <p class="Bullet-Without-Bullet-Within-Bullet--PACKT-">Ensure that the field is backed by a property on your component named <code class="Code-In-Text--PACKT-">useNgRx</code>.</p>
      </li>
      <li class="list">Refactor the <code class="Code-In-Text--PACKT-">doSearch</code> method to extract the <code class="Code-In-Text--PACKT-">BehaviorSubject</code> code as its own function named <code class="Code-In-Text--PACKT-">behaviorSubjectBasedSearch</code></li>
      <li class="list">Stub <a id="_idIndexMarker1423"/>out a function called <code class="Code-In-Text--PACKT-">ngRxBasedSearch</code>:
        <pre class="programlisting"><code class="hljs typescript"><strong>src/app/city-search/city-search.component.ts</strong>
doSearch(searchValue: <span class="hljs-built_in">string</span>) {
  <span class="hljs-keyword">const</span> userInput = searchValue.split(<span class="hljs-string">','</span>).map(<span class="hljs-function">(<span class="hljs-params">s</span>) =&gt;</span> s.trim())
  <span class="hljs-keyword">const</span> searchText = userInput[<span class="hljs-number">0</span>]
  <span class="hljs-keyword">const</span> country = userInput.length &gt; <span class="hljs-number">1</span> ? userInput[<span class="hljs-number">1</span>] : <span class="hljs-literal">undefined</span>
  <strong><span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.useNgRx) {</strong>
<strong>    <span class="hljs-keyword">this</span>.ngRxBasedSearch(searchText, country)</strong>
<strong>  } <span class="hljs-keyword">else</span> {</strong>
<strong>    <span class="hljs-keyword">this</span>.behaviorSubjectBasedSearch(searchText, country)</strong>
<strong>  }</strong>
}
</code></pre>
      </li>
    </ol>
    <p class="normal">We will <a id="_idIndexMarker1424"/>be dispatching an action from the <code class="Code-In-Text--PACKT-">ngRxBasedSearch</code> function that you just created.</p>
    <h2 class="title" id="_idParaDest-428">Setting up NgRx</h2>
    <p class="normal">You may <a id="_idIndexMarker1425"/>add the NgRx Store package with the following command:</p>
    <pre class="programlisting"><code class="hljs llvm">$ npx ng <span class="hljs-keyword">add</span> <span class="hljs-title">@ngrx</span>/<span class="hljs-keyword">store</span>
</code></pre>
    <p class="normal">This will create a reducers folder with an <code class="Code-In-Text--PACKT-">index.ts</code> file in it. Now add the NgRx effects package:</p>
    <pre class="programlisting"><code class="hljs dockerfile">$ npx ng <span class="hljs-keyword">add</span><span class="bash"> @ngrx/effects --minimal</span>
</code></pre>
    <div class="packt_tip">
      <p>We use the <code class="Code-In-Text--PACKT-">--minimal</code> option here to avoid creating unnecessary boilerplate.</p>
    </div>
    <p class="normal">Next, install the NgRx schematics library so you can take advantage of generators to create the boilerplate code for you:</p>
    <pre class="programlisting"><code class="hljs coffeescript">$ <span class="hljs-built_in">npm</span> i -D @ngrx/schematics
</code></pre>
    <p class="normal">Implementing NgRx can be confusing due to its highly decoupled nature, which may necessitate some insight into the inner workings of the library.</p>
    <div class="packt_tip">
      <p>The sample project under <code class="Code-In-Text--PACKT-">projects/ch12</code> configures <code class="Code-In-Text--PACKT-">@ngrx/store-devtools</code> for debugging.</p>
    </div>
    <p class="normal">If you would <a id="_idIndexMarker1426"/>like to be able to <code class="Code-In-Text--PACKT-">console.log</code> NgRx actions for debugging or instrumentation during runtime, refer to the <em class="italics">Appendix A</em>, <em class="italics">Debugging Angular</em>.</p>
    <h2 class="title" id="_idParaDest-429">Defining NgRx actions</h2>
    <p class="normal">Before we can <a id="_idIndexMarker1427"/>implement effects or reducers, we first need to define the actions our app is going to be able to execute. For LocalCast Weather, there are two types of actions:</p>
    <ul>
      <li class="list"><code class="Code-In-Text--PACKT-">search</code>: Fetches the current weather for the city or zip code that's being searched</li>
      <li class="list"><code class="Code-In-Text--PACKT-">weatherLoaded</code>: Indicates that new current weather information has been fetched</li>
    </ul>
    <p class="normal">Create an action named <code class="Code-In-Text--PACKT-">search</code> by running the following command:</p>
    <pre class="programlisting"><code class="hljs verilog">$ npx ng <span class="hljs-keyword">generate</span> @ngrx/schematics:action search --group --creators
</code></pre>
    <div class="packt_tip">
      <p>Take the default options when prompted.</p>
    </div>
    <div class="note">
      <p class="Information-Box--PACKT-">The <code class="Code-In-Text--PACKT-">--group</code> option groups actions under a folder named <code class="Code-In-Text--PACKT-">action</code>. The <code class="Code-In-Text--PACKT-">--creators</code> option uses creator functions to implement actions and reducers, which is a more familiar and straightforward way to implement these components.</p>
    </div>
    <p class="normal">Now, let's implement the two actions using the <code class="Code-In-Text--PACKT-">createAction</code> function, providing a name and an expected list of input parameters:</p>
    <pre class="programlisting"><code class="hljs crystal"><strong>src/app/action/search.actions.ts</strong>
import { createAction, props, <span class="hljs-class"><span class="hljs-keyword">union</span> } <span class="hljs-title">from</span> '@<span class="hljs-title">ngrx</span>/<span class="hljs-title">store</span>'</span>
import { ICurrentWeather } from <span class="hljs-string">'../interfaces'</span>
export const SearchActions = {
  <span class="hljs-symbol">search:</span> createAction(
    <span class="hljs-string">'[Search] Search'</span>,
    props&lt;{ <span class="hljs-symbol">searchText:</span> string; <span class="hljs-symbol">country?:</span> string }&gt;()
  ),
  <span class="hljs-symbol">weatherLoaded:</span> createAction( 
    <span class="hljs-string">'[Search] CurrentWeather loaded'</span>,
    props&lt;{ <span class="hljs-symbol">current:</span> ICurrentWeather }&gt;()
  ),
}
const all = <span class="hljs-class"><span class="hljs-keyword">union</span>(<span class="hljs-title">SearchActions</span>)</span>
export <span class="hljs-keyword">type</span> SearchActions = <span class="hljs-keyword">typeof</span> all
</code></pre>
    <p class="normal">The search action has the name <code class="Code-In-Text--PACKT-">'[Search] Search'</code> and has <code class="Code-In-Text--PACKT-">searchText</code> and an optional <code class="Code-In-Text--PACKT-">country</code> parameter as inputs. The <code class="Code-In-Text--PACKT-">weatherLoaded</code> action follows a similar pattern. At the end of the file, we create a union type of our actions, so we can group them <a id="_idIndexMarker1428"/>under one parent type to use in the rest of the application.</p>
    <div class="packt_tip">
      <p>Notice that action names are prepended by <code class="Code-In-Text--PACKT-">[Search]</code>. This is a convention that helps developers visually group related actions together during debugging.</p>
    </div>
    <p class="normal">Now that our actions are deﬁned, we can implement the effect to handle the search action and dispatch a <code class="Code-In-Text--PACKT-">weatherLoaded</code> action.</p>
    <h2 class="title" id="_idParaDest-430">Implementing NgRx Effects</h2>
    <p class="normal">As mentioned earlier, effects let us change the stored state without necessarily storing the event <a id="_idIndexMarker1429"/>data that is causing the change. For example, we want our state to only have weather data, not the search text itself. Effects allow us to do this in one step, rather than forcing us to use an intermediate store for the <code class="Code-In-Text--PACKT-">searchText</code> and a far more complicated chain of events to just turn that into weather data.</p>
    <p class="normal">Otherwise, we would have to implement a reducer in between, to first store this value in the store, and then later retrieve it from a service and dispatch a <code class="Code-In-Text--PACKT-">weatherLoaded</code> action. The effect will make it simpler to retrieve data from our service.</p>
    <p class="normal">Now let's add <code class="Code-In-Text--PACKT-">CurrentWeatherEffects</code> to our app:</p>
    <pre class="programlisting"><code class="hljs verilog">$ npx ng <span class="hljs-keyword">generate</span> @ngrx/schematics:effect currentWeather --<span class="hljs-keyword">module</span>=app<span class="hljs-variable">.module</span><span class="hljs-variable">.ts</span> --root --group --creators
</code></pre>
    <div class="packt_tip">
      <p>Take the default options when prompted.</p>
    </div>
    <p class="normal">You will have a new <code class="Code-In-Text--PACKT-">current-weather.effects.ts</code> file under the <code class="Code-In-Text--PACKT-">effects</code> folder.</p>
    <div class="packt_tip">
      <p>Once again, <code class="Code-In-Text--PACKT-">--group</code> is used to group effects under a folder of the same name. <code class="Code-In-Text--PACKT-">--root</code> registers the effect in <code class="Code-In-Text--PACKT-">app.module.ts</code> and we use creator functions with the <code class="Code-In-Text--PACKT-">--creators</code> option.</p>
    </div>
    <p class="normal">In the <code class="Code-In-Text--PACKT-">CurrentWeatherEffects</code> ﬁle, start by implementing a private <code class="Code-In-Text--PACKT-">doSearch</code> method:</p>
    <pre class="programlisting"><code class="hljs moonscript"><strong>src/app/effects/current-weather.effects.ts</strong>
private doSearch(<span class="hljs-name">action</span>: { <span class="hljs-name">searchText</span>: <span class="hljs-built_in">string</span>; country?: <span class="hljs-built_in">string</span> }) {
  <span class="hljs-keyword">return</span> this.weatherService.getCurrentWeather(
    action.searchText,
    action.country
  ).pipe(
    map(<span class="hljs-function"><span class="hljs-params">(weather)</span> =&gt;</span>
      SearchActions.weatherLoaded({ <span class="hljs-name">current</span>: weather })
    ),
    catchError(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> EMPTY)
  )
}
</code></pre>
    <div class="packt_tip">
      <p>Note that we're choosing to ignore errors thrown with the <code class="Code-In-Text--PACKT-">EMPTY</code> function. You can surface these errors to the user with a <code class="Code-In-Text--PACKT-">UiService</code> like the one you've implemented for LemonMart.</p>
    </div>
    <p class="normal">This function <a id="_idIndexMarker1430"/>takes an action with search parameters, calls <code class="Code-In-Text--PACKT-">getCurrentWeather</code>, and upon receiving a response, dispatches the <code class="Code-In-Text--PACKT-">weatherLoaded</code> action, passing in the current weather property.</p>
    <p class="normal">Now let's create the effect itself, so we can trigger the <code class="Code-In-Text--PACKT-">doSearch</code> function:</p>
    <pre class="programlisting"><code class="hljs reasonml"><strong>src/app/effects/current-weather.effects.ts</strong>
getCurrentWeather$ = create<span class="hljs-constructor">Effect(()</span> =&gt;
  this.actions<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">$</span>.</span></span>pipe(
    <span class="hljs-keyword">of</span><span class="hljs-constructor">Type(SearchActions.<span class="hljs-params">search</span>)</span>, 
    exhaust<span class="hljs-constructor">Map((<span class="hljs-params">action</span>)</span> =&gt; this.<span class="hljs-keyword">do</span><span class="hljs-constructor">Search(<span class="hljs-params">action</span>)</span>)
  )
)
</code></pre>
    <p class="normal">This is where we tap into the observable action stream, <code class="Code-In-Text--PACKT-">this.actions$</code>, and listen to actions of the <code class="Code-In-Text--PACKT-">SearchAction.search</code> type. We then use the <code class="Code-In-Text--PACKT-">exhaustMap</code> operator to register for the emitted event. Due to its unique nature, <code class="Code-In-Text--PACKT-">exhaustMap</code> won't allow another search action to be processed until the <code class="Code-In-Text--PACKT-">doSearch</code> function completes dispatching its <code class="Code-In-Text--PACKT-">weatherLoaded</code> action.</p>
    <div class="packt_tip">
      <p>Confused by all the different kinds of RxJS operators and worried you'll never remember them? See the <em class="italics">Appendix B</em>, <em class="italics">Angular Cheat Sheet</em>, for a quick reference.</p>
    </div>
    <h2 class="title" id="_idParaDest-431">Implementing reducers</h2>
    <p class="normal">With the <code class="Code-In-Text--PACKT-">weatherLoaded</code> action triggered, we need a way to ingest the current weather information <a id="_idIndexMarker1431"/>and store it in our <code class="Code-In-Text--PACKT-">appStore</code> state. Reducers will help us handle specific actions, creating an isolated and immutable pipeline to store our data in a predictable way.</p>
    <p class="normal">Let's create a search reducer:</p>
    <pre class="programlisting"><code class="hljs verilog">$ npx ng <span class="hljs-keyword">generate</span> @ngrx/schematics:reducer search 
    --reducers=reducers/index<span class="hljs-variable">.ts</span> --group --creators
</code></pre>
    <div class="packt_tip">
      <p>Take the default options. Here, we use <code class="Code-In-Text--PACKT-">--group</code> to keep files organized under the <code class="Code-In-Text--PACKT-">reducers</code> folder and <code class="Code-In-Text--PACKT-">--creators</code> to leverage the creator style of creating NgRx components. We also specify the location of our parent <code class="Code-In-Text--PACKT-">appStore</code> state at <code class="Code-In-Text--PACKT-">reducers/index.ts</code> with <code class="Code-In-Text--PACKT-">--reducers</code>, so our new reducer can be registered with it.</p>
    </div>
    <p class="normal">You may observe that <code class="Code-In-Text--PACKT-">reducers.index.ts</code> has been updated to register the new <code class="Code-In-Text--PACKT-">search.reducer.ts</code>. Let's implement it step by step.</p>
    <p class="normal">In the <code class="Code-In-Text--PACKT-">search</code> state, we will be storing the current weather, so implement the interface to reﬂect this:</p>
    <pre class="programlisting"><code class="hljs routeros"><strong>src/app/reducers/search.reducer.ts</strong>
<span class="hljs-builtin-name">export</span><span class="hljs-built_in"> interface </span>State {
  current: ICurrentWeather
}
</code></pre>
    <p class="normal">Now let's specify the <code class="Code-In-Text--PACKT-">initialState</code>. This is similar to how we need to define a default value of a <code class="Code-In-Text--PACKT-">BehaviorSubject</code>. Refactor the <code class="Code-In-Text--PACKT-">WeatherService</code> to export a <code class="Code-In-Text--PACKT-">const defaultWeather: ICurrentWeather</code> object that you can use to initialize <code class="Code-In-Text--PACKT-">BehaviorSubject</code> and <code class="Code-In-Text--PACKT-">initialState</code>.</p>
    <pre class="programlisting"><code class="hljs groovy"><strong>src<span class="hljs-regexp">/app/</span>reducers/search.reducer.ts</strong>
export const <span class="hljs-string">initialState:</span> 
  State = { <span class="hljs-string">current:</span>
  defaultWeather,
}
</code></pre>
    <p class="normal">Finally, implement <code class="Code-In-Text--PACKT-">searchReducer</code> to handle the <code class="Code-In-Text--PACKT-">weatherLoaded</code> action using the <code class="Code-In-Text--PACKT-">on</code> operator:</p>
    <pre class="programlisting"><code class="hljs pf"><strong>src/app/reducers/search.reducer.ts</strong>
const searchReducer = createReducer(
  initialState,
  <span class="hljs-keyword">on</span>(SearchActions.weatherLoaded, (<span class="hljs-keyword">state</span>, action) =&gt; {
    return {
      ...<span class="hljs-keyword">state</span>,
    current: action.current,
    }
  })
)
</code></pre>
    <p class="normal">We simply <a id="_idIndexMarker1432"/>register for the <code class="Code-In-Text--PACKT-">weatherLoaded</code> action and unwrap the data stored in it and pass it into the <code class="Code-In-Text--PACKT-">search</code> state.</p>
    <p class="normal">This is, of course, a very simplistic case. However, it is easy to imagine a more complicated scenario, where we may need to flatten or process a piece of data received and store it in an easy-to-consume manner. Isolating such logic in an immutable way is the key value proposition of utilizing a library like NgRx.</p>
    <h2 class="title" id="_idParaDest-432">Registering with Store using selector</h2>
    <p class="normal">We need <code class="Code-In-Text--PACKT-">CurrentWeatherComponent</code> to register with the <code class="Code-In-Text--PACKT-">appStore</code> state for updated current weather data.</p>
    <p class="normal">Start <a id="_idIndexMarker1433"/>by dependency injecting the <code class="Code-In-Text--PACKT-">appStore</code> state and registering the selector to pluck current weather from the <code class="Code-In-Text--PACKT-">State</code> object:</p>
    <pre class="programlisting"><code class="hljs typescript"><strong>src/app/current-weather/current-weather.component.ts</strong>
<strong><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> appStore <span class="hljs-keyword">from</span> <span class="hljs-string">'../reducers'</span></strong>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> CurrentWeatherComponent {
  current$: Observable&lt;ICurrentWeather&gt;
  <span class="hljs-keyword">constructor</span>(<strong><span class="hljs-params"><span class="hljs-keyword">private</span> store: Store&lt;appStore.State</span></strong><span class="hljs-params">&gt;</span>) {
    <span class="hljs-keyword">this</span>.current$ =
      <strong><span class="hljs-keyword">this</span>.store.pipe(select(<span class="hljs-function">(<span class="hljs-params">state: State</span>) =&gt;</span> state.search.current))</strong>
  } 
  ...
}
</code></pre>
    <p class="normal">We simply listen to state change events that flow through the store. Using the <code class="Code-In-Text--PACKT-">select</code> function, we can implement an inline select to get the piece of data we need.</p>
    <p class="normal">We can refactor this a bit and make our selector reusable by using a <code class="Code-In-Text--PACKT-">createSelector</code> to create a <code class="Code-In-Text--PACKT-">selectCurrentWeather</code> property on <code class="Code-In-Text--PACKT-">reducers/index.ts</code>:</p>
    <pre class="programlisting"><code class="hljs pf"><strong>src/app/reducers/index.ts</strong>
export const selectCurrentWeather = createSelector(
  (<span class="hljs-keyword">state</span>: State) =&gt; <span class="hljs-keyword">state</span>.search.current,
  current =&gt; current
)
</code></pre>
    <p class="normal">In addition, since we want to maintain the continued operation of the <code class="Code-In-Text--PACKT-">BehaviorSubject</code>, we can implement a <code class="Code-In-Text--PACKT-">merge</code> operator in <code class="Code-In-Text--PACKT-">CurrentWeatherComponent</code> to listen to both <code class="Code-In-Text--PACKT-">WeatherService</code> updates and <code class="Code-In-Text--PACKT-">appStore</code> state <a id="_idIndexMarker1434"/>updates:</p>
    <pre class="programlisting"><code class="hljs oxygene"><strong>src/app/current-weather/current-weather.component.ts</strong>
import * <span class="hljs-keyword">as</span> appStore <span class="hljs-keyword">from</span> <span class="hljs-string">'../reducers'</span>
  <span class="hljs-function"><span class="hljs-keyword">constructor</span><span class="hljs-params">(
    <span class="hljs-keyword">private</span> weatherService: WeatherService,
    <span class="hljs-keyword">private</span> store: Store&lt;appStore.State&gt;
  )</span> <span class="hljs-comment">{
    this.current$ = merge(
      </span></span><strong><span class="hljs-function"><span class="hljs-comment">this.store.pipe(select(appStore.selectCurrentWeather)),</span></span></strong><span class="hljs-function"><span class="hljs-comment">
      this.weatherService.currentWeather$
    )
  }</span>
</span></code></pre>
    <p class="normal">Now that we are able to listen to store updates, let's implement the final piece of the puzzle: dispatching the search action.</p>
    <h2 class="title" id="_idParaDest-433">Dispatching store actions</h2>
    <p class="normal">We need to <a id="_idIndexMarker1435"/>dispatch the search action so that our search effect can fetch current weather data and update the store. Earlier in this chapter, you <a id="_idIndexMarker1436"/>implemented a stubbed function called <code class="Code-In-Text--PACKT-">ngRxBasedSearch</code> in the <code class="Code-In-Text--PACKT-">CitySearchComponent</code>.</p>
    <p class="normal">Let's implement <code class="Code-In-Text--PACKT-">ngRxBasedSearch</code>:</p>
    <pre class="programlisting"><code class="hljs reasonml"><strong>src/app/city-search/city-search.component.ts</strong>
ng<span class="hljs-constructor">RxBasedSearch(<span class="hljs-params">searchText</span>: <span class="hljs-params">string</span>, <span class="hljs-params">country</span>?: <span class="hljs-params">string</span>)</span> {
  this.store.dispatch(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">SearchActions</span>.</span></span>search({ searchText, country }))
}
</code></pre>
    <div class="packt_tip">
      <p>Don't forget to inject the <code class="Code-In-Text--PACKT-">appState</code> store into the component!</p>
    </div>
    <p class="normal">And that's it! Now you should be able to run your code and test to see whether it all works.</p>
    <p class="normal">As you can see, NgRx brings a lot of sophisticated techniques to the table to create ways to make data transformations immutable, well deﬁned, and predictable. However, this comes with <a id="_idIndexMarker1437"/>considerable implementation overhead. Use your best judgment to determine whether you really need the Flux pattern in your Angular app. Often, the frontend application code can be made much simpler by implementing RESTful APIs that return ﬂat data objects, with complicated data manipulations handled server side.</p>
    <h2 class="title" id="_idParaDest-434">Unit testing reducers and selectors</h2>
    <p class="normal">You can <a id="_idIndexMarker1438"/>implement unit tests for the <code class="Code-In-Text--PACKT-">weatherLoaded</code> reducer and the <code class="Code-In-Text--PACKT-">selectCurrentWeather</code> selector in <code class="Code-In-Text--PACKT-">search.reducer.spec.ts</code>:</p>
    <pre class="programlisting"><code class="hljs coffeescript"><strong>src/app/reducers/search.reducer.spec.ts</strong>
<span class="hljs-keyword">import</span> { SearchActions } <span class="hljs-keyword">from</span> <span class="hljs-string">'../actions/search.actions'</span>
<span class="hljs-keyword">import</span> { defaultWeather } <span class="hljs-keyword">from</span> <span class="hljs-string">'../weather/weather.service'</span>
<span class="hljs-keyword">import</span> { fakeWeather } <span class="hljs-keyword">from</span> <span class="hljs-string">'../weather/weather.service.fake'</span>
<span class="hljs-keyword">import</span> { selectCurrentWeather } <span class="hljs-keyword">from</span> <span class="hljs-string">'./index'</span>
<span class="hljs-keyword">import</span> { initialState, reducer } <span class="hljs-keyword">from</span> <span class="hljs-string">'./search.reducer'</span>
describe(<span class="hljs-string">'Search Reducer'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
  describe(<span class="hljs-string">'weatherLoaded'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
    it(<span class="hljs-string">'should return current weather'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
      const action = SearchActions.weatherLoaded({ current: fakeWeather })
      const result = reducer(initialState, action)
      expect(result).toEqual({ current: fakeWeather })
    })
  })
})
describe(<span class="hljs-string">'Search Selectors'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> { 
  it(<span class="hljs-string">'should selectCurrentWeather'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
    const expectedWeather = defaultWeather
    expect(selectCurrentWeather({ search: { current: defaultWeather }
})).toEqual(
      expectedWeather
    )
  })
})
</code></pre>
    <p class="normal">These unit <a id="_idIndexMarker1439"/>tests are fairly straightforward and will ensure that no unintentional changes to the data structure can happen within the store.</p>
    <h2 class="title" id="_idParaDest-435">Unit testing components with MockStore</h2>
    <p class="normal">You need <a id="_idIndexMarker1440"/>to update the tests for <code class="Code-In-Text--PACKT-">CurrentWeatherComponent</code> so that we can inject a mock <code class="Code-In-Text--PACKT-">Store</code> into the component <a id="_idIndexMarker1441"/>to test the value of the <code class="Code-In-Text--PACKT-">current$</code> property.</p>
    <p class="normal">Let's look at the delta of what needs to be added to the spec file to configure the mock store:</p>
    <pre class="programlisting"><code class="hljs typescript"><strong>src/app/current-weather/current-weather.component.spec.ts</strong>
<span class="hljs-keyword">import</span> { MockStore, provideMockStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ngrx/store/testing'</span>
describe(<span class="hljs-string">'CurrentWeatherComponent'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
  ...
  <span class="hljs-keyword">let</span> store: MockStore&lt;{ search: { current: ICurrentWeather } }&gt;
  <span class="hljs-keyword">const</span> initialState = { search: { current: defaultWeather } }
  beforeEach(<span class="hljs-keyword">async</span>(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
    ...
    TestBed.configureTestingModule({
      imports: [AppMaterialModule],
      providers: [
        ...
        <strong>provideMockStore({ initialState }),</strong>
      ],
    }).compileComponents()
    ...
    <strong>store = TestBed.inject(Store) <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span></strong>
  }))
...
})
</code></pre>
    <p class="normal">We can now update the <code class="Code-In-Text--PACKT-">'should get currentWeather from weatherService'</code> test to see whether <code class="Code-In-Text--PACKT-">CurrentWeatherComponent</code> works with a mock store:</p>
    <pre class="programlisting"><code class="hljs reasonml"><strong>src/app/current-weather/current-weather.component.spec.ts</strong>
it('should get currentWeather from weatherService',<span class="hljs-function"> (<span class="hljs-params">done</span>) =&gt;</span> {
  <span class="hljs-comment">// Arrange</span>
  store.set<span class="hljs-constructor">State({ <span class="hljs-params">search</span>: { <span class="hljs-params">current</span>: <span class="hljs-params">fakeWeather</span> } })</span>
  weatherServiceMock.currentWeather<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">$</span>.</span></span>next(fakeWeather)
  <span class="hljs-comment">// Act</span>
  fixture.detect<span class="hljs-constructor">Changes()</span> <span class="hljs-comment">// triggers ngOnInit()</span>
  <span class="hljs-comment">// Assert</span>
  expect(component.current$).<span class="hljs-keyword">to</span><span class="hljs-constructor">BeDefined()</span>
  component.current<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">$</span>.</span></span>subscribe(current =&gt; { 
    expect(current.city).<span class="hljs-keyword">to</span><span class="hljs-constructor">Equal('Bethesda')</span>
    expect(current.temperature).<span class="hljs-keyword">to</span><span class="hljs-constructor">Equal(280.32)</span>
    <span class="hljs-comment">// Assert on DOM</span>
    const debugEl = fixture.debugElement
    const titleEl: HTMLElement =
      debugEl.query(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">By</span>.</span></span>css('.mat-title')).nativeElement
    expect(titleEl.textContent).<span class="hljs-keyword">to</span><span class="hljs-constructor">Contain('Bethesda')</span>
    <span class="hljs-keyword">done</span><span class="hljs-literal">()</span>
  })
})
</code></pre>
    <p class="normal">The mock <a id="_idIndexMarker1442"/>store allows us to <a id="_idIndexMarker1443"/>set the current state of the store, which in turn allows the selector call in the constructor to fire and grab the provided fake weather data.</p>
    <div class="packt_tip">
      <p>TestBed is not a hard requirement for writing unit tests in Angular, a topic covered well at <a href="https://angular.io/guide/testing"><span class="url">https://angular.io/guide/testing</span></a>. My colleague and reviewer of this book, Brendon Caulkins, contributed a bed-less spec file for this chapter, named <code class="Code-In-Text--PACKT-">current-weather.component.nobed.spec.ts</code>. He cites significant performance increases when running the tests, with fewer imports and less maintenance, but a higher level of care and expertise required to implement the tests. If you're on a large project, you should seriously consider skipping the <code class="Code-In-Text--PACKT-">TestBed</code>.</p>
      <p>You can find the sample code on GitHub under the <code class="Code-In-Text--PACKT-">projects/ch12</code> folder.</p>
    </div>
    <p class="normal">Go ahead and update the remainder of your tests and do not move on until they all start passing.</p>
    <h1 class="title" id="_idParaDest-436">NgRx Data</h1>
    <p class="normal">If NgRx is a configuration-based framework, NgRx Data is a convention-based sibling of NgRx. NgRx Data <a id="_idIndexMarker1444"/>automates the creation of stores, effects, actions, reducers, dispatches, and selectors. If most of your application actions are <strong class="bold">CRUD</strong> (<strong class="bold">Create</strong>, <strong class="bold">Retrieve</strong>, <strong class="bold">Update</strong>, and <strong class="bold">Delete</strong>) operations, then NgRx Data can achieve the <a id="_idIndexMarker1445"/>same result as NgRx with a lot less code needing to be written.</p>
    <p class="normal">NgRx Data may be a much better introduction to the Flux pattern for you and your team. Then you can go on to NgRx itself.</p>
    <div class="packt_tip">
      <p><code class="Code-In-Text--PACKT-">@ngrx/data</code> works in tandem with the <code class="Code-In-Text--PACKT-">@ngrx/entity</code> library. Together they offer a rich feature set, including transactional data management. Read more about it at <a href="https://ngrx.io/guide/data"><span class="url">https://ngrx.io/guide/data</span></a>.</p>
    </div>
    <p class="normal">For this example, we will be switching back over to the LemonMart project.</p>
    <p class="normal">Add NgRx Data to your project by executing the following commands:</p>
    <pre class="programlisting"><code class="hljs llvm">$ npx ng <span class="hljs-keyword">add</span> <span class="hljs-title">@ngrx</span>/<span class="hljs-keyword">store</span> --minimal
$ npx ng <span class="hljs-keyword">add</span> <span class="hljs-title">@ngrx</span>/effects --minimal
$ npx ng <span class="hljs-keyword">add</span> <span class="hljs-title">@ngrx</span>/entity
$ npx ng <span class="hljs-keyword">add</span> <span class="hljs-title">@ngrx</span>/data
</code></pre>
    <div class="packt_tip">
      <p>The sample project under <code class="Code-In-Text--PACKT-">projects/ch12</code> configures <code class="Code-In-Text--PACKT-">@ngrx/store-devtools</code> for debugging.</p>
    </div>
    <p class="normal">If you would like to be able to <code class="Code-In-Text--PACKT-">console.log</code> NgRx actions for debugging or instrumentation during runtime, refer to the <em class="italics">Appendix A</em>, <em class="italics">Debugging Angular</em>.</p>
    <h2 class="title" id="_idParaDest-437">Implementing NgRx/Data in LemonMart</h2>
    <p class="normal">In LemonMart, we have <a id="_idIndexMarker1446"/>a great use case <a id="_idIndexMarker1447"/>for the <code class="Code-In-Text--PACKT-">@ngrx/data</code> library with the <code class="Code-In-Text--PACKT-">User</code> class and the <code class="Code-In-Text--PACKT-">UserService</code>. It neatly represents an entity that could support CRUD operations. With a few modifications and the least amount of effort, you can see the library in action.</p>
    <div class="note">
      <p class="Information-Box--PACKT-">This section uses the <strong class="bold">lemon-mart</strong> repo. You can find the code samples for this chapter under the <code class="Code-In-Text--PACKT-">projects/ch12</code> folder.</p>
    </div>
    <ol>
      <li class="list" value="1">Let's start by defining the <code class="Code-In-Text--PACKT-">User</code> entity in <code class="Code-In-Text--PACKT-">entity-metadata.ts</code>:
        <pre class="programlisting"><code class="hljs javascript"><strong>src/app/entity-metadata.ts</strong>
<span class="hljs-keyword">import</span> { EntityMetadataMap } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ngrx/data'</span>
<span class="hljs-keyword">const</span> entityMetadata: EntityMetadataMap = {
  <span class="hljs-attr">User</span>: {},
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> entityConfig = {
  entityMetadata,
}
</code></pre>
      </li>
      <li class="list">Ensure <a id="_idIndexMarker1448"/>that the <code class="Code-In-Text--PACKT-">entityConfig</code> object is registered with <code class="Code-In-Text--PACKT-">EntityDataModule</code>:
        <pre class="programlisting"><code class="hljs reasonml"><strong>src/app/app.<span class="hljs-keyword">module</span>.ts</strong>
imports: <span class="hljs-literal">[
  <span class="hljs-operator">...</span>
  S<span class="hljs-identifier">toreModule</span>.<span class="hljs-identifier">forRoot</span>({}),
  E<span class="hljs-identifier">ffectsModule</span>.<span class="hljs-identifier">forRoot</span>([]</span>),
  <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">EntityDataModule</span>.</span></span>for<span class="hljs-constructor">Root(<span class="hljs-params">entityConfig</span>)</span>,
]
</code></pre>
      </li>
      <li class="list">Create <a id="_idIndexMarker1449"/>a <code class="Code-In-Text--PACKT-">User</code> entity service:
        <pre class="programlisting"><code class="hljs javascript"><strong>src/app/user/user/user.entity.service.ts</strong>
<span class="hljs-keyword">import</span> { Injectable } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span> 
<span class="hljs-keyword">import</span> {
  EntityCollectionServiceBase,
  EntityCollectionServiceElementsFactory,
} <span class="hljs-keyword">from</span> <span class="hljs-string">'@ngrx/data'</span>
<span class="hljs-keyword">import</span> { User } <span class="hljs-keyword">from</span> <span class="hljs-string">'./user'</span>
@Injectable({ <span class="hljs-attr">providedIn</span>: <span class="hljs-string">'root'</span> })
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserEntityService</span>
  <span class="hljs-keyword">extends</span> <span class="hljs-title">EntityCollectionServiceBase</span>&lt;<span class="hljs-title">User</span>&gt; </span>{
  <span class="hljs-keyword">constructor</span>(
    serviceElementsFactory: EntityCollectionServiceElementsFactory
  ) {
    <span class="hljs-keyword">super</span>(<span class="hljs-string">'User'</span>, serviceElementsFactory)
  }
}
</code></pre>
      </li>
    </ol>
    <p class="normal">You now have all the basic elements in place to integrate the entity service with a component. In a sense, it is this easy to set up NgRx Data. However, we'll have to customize <a id="_idIndexMarker1450"/>it somewhat to fit into our existing REST API structure, which will be covered in detail in the next section. If you were <a id="_idIndexMarker1451"/>to follow the API implementation pattern that NgRx Data expects, then no changes would be necessary.</p>
    <p class="normal">NgRx Data wants to access the REST API via the <code class="Code-In-Text--PACKT-">/api</code> path, hosted on the same port as your Angular app. To accomplish this during development, we need to leverage Angular CLI's proxy feature.</p>
    <h2 class="title" id="_idParaDest-438">Configuring proxy in Angular CLI</h2>
    <p class="normal">Normally, HTTP <a id="_idIndexMarker1452"/>requests sent to our web server and our API <a id="_idIndexMarker1453"/>server should have exactly the same URL. However, during development, we usually host both applications on two different ports of <code class="Code-In-Text--PACKT-">http://localhost</code>. Certain libraries, including NgRx Data, require that HTTP calls be on the same port. This creates a challenge for creating a frictionless development experience. For this reason, Angular CLI ships with a proxy feature with which you can direct the <code class="Code-In-Text--PACKT-">/api</code> path to a different endpoint on your localhost. This way, you can use one port to serve your web app and your API requests.</p>
    <ol>
      <li class="list" value="1">Create a <code class="Code-In-Text--PACKT-">proxy.conf.json</code> file under <code class="Code-In-Text--PACKT-">src</code>, as shown:<div class="packt_tip">
          <p>If you're working in the <strong class="bold">lemon-mart-server</strong> monorepo, this will be <code class="Code-In-Text--PACKT-">web-app/src</code>.</p>
        </div>
        <pre class="programlisting"><code class="hljs pgsql"><strong>proxy.conf.json</strong>
{
  "/api": {
    "target": "http://localhost:3000",
    "secure": <span class="hljs-keyword">false</span>,
    "pathRewrite": {
       "^/api": ""
    }
  }
}
</code></pre>
      </li>
      <li class="list" value="2">Register the proxy with <code class="Code-In-Text--PACKT-">angular.json</code>:
        <pre class="programlisting"><code class="hljs jboss-cli"><strong>angular.json</strong>
<span class="hljs-string">...</span>
<span class="hljs-string">"serve"</span>: {
  <span class="hljs-string">"builder"</span>: <span class="hljs-string">"@angular-devkit/build-angular:dev-server"</span>,
  <span class="hljs-string">"options"</span>: {
    <span class="hljs-string">"browserTarget"</span>: <span class="hljs-string">"lemon-mart:build"</span>,
    <span class="hljs-string">"proxyConfig"</span>: <span class="hljs-string">"proxy.conf.json"</span>
  },
  <span class="hljs-string">...</span>
}
</code></pre>
      </li>
    </ol>
    <p class="normal">Now the <a id="_idIndexMarker1454"/>server that is started when you run <code class="Code-In-Text--PACKT-">npm start</code> or <code class="Code-In-Text--PACKT-">ng serve</code> can rewrite the URLs of any call made to the <code class="Code-In-Text--PACKT-">/api</code> route with <code class="Code-In-Text--PACKT-">http://localhost:3000</code>. This is the port that <strong class="bold">lemon-mart-server</strong> runs by default.</p>
    <div class="packt_tip">
      <p>If your API is running a different port, then use the correct port number and child route.</p>
    </div>
    <p class="normal">Next, let's <a id="_idIndexMarker1455"/>use the <code class="Code-In-Text--PACKT-">UserEntityService</code>.</p>
    <h2 class="title" id="_idParaDest-439">Using Entity Service</h2>
    <p class="normal">We will <a id="_idIndexMarker1456"/>be updating the User Management master view, so we can optionally use <code class="Code-In-Text--PACKT-">BehaviorSubject</code> or the <code class="Code-In-Text--PACKT-">UserEntityService</code> we just created.</p>
    <ol>
      <li class="list" value="1">Start by implementing a toggle switch in <code class="Code-In-Text--PACKT-">user-table.component.ts</code>, similar to the way we did for LocalCast Weather and NgRx earlier in the chapter: <figure class="mediaobject"><img alt="" src="../Images/B14094_12_09.png"/></figure>
        <p class="packt_figref">Figure 12.9: UserTableComponent with the NgRx slide toggle</p>
      </li>
      <li class="list">Inject the new service into <code class="Code-In-Text--PACKT-">UserTableComponent</code> and merge its loading observable with the one that's present on the component:
        <pre class="programlisting"><code class="hljs oxygene"><strong>src/app/manager/user-table/user-table.component.ts</strong>
useNgRxData = <span class="hljs-keyword">true</span>
<span class="hljs-keyword">readonly</span> isLoadingResults$ = <span class="hljs-keyword">new</span> BehaviorSubject(<span class="hljs-keyword">true</span>) loading$: Observable&lt;boolean&gt;
<span class="hljs-function"><span class="hljs-keyword">constructor</span><span class="hljs-params">(
  <span class="hljs-keyword">private</span> userService: UserService,
  </span></span><strong><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">private</span> userEntityService: UserEntityService</span></span></strong><span class="hljs-function"><span class="hljs-params">
</span></span><strong><span class="hljs-function"><span class="hljs-params">)</span> <span class="hljs-comment">{</span></span></strong><span class="hljs-function"><span class="hljs-comment">
  this.loading$ = merge(
    </span></span><strong><span class="hljs-function"><span class="hljs-comment">this.userEntityService.loading$, </span></span></strong><span class="hljs-function"><span class="hljs-comment">
    this.isLoadingResults$
  )
}</span>
</span></code></pre>
        <div class="packt_tip">
          <p>Since <code class="Code-In-Text--PACKT-">EntityDataModule</code> is registered in <code class="Code-In-Text--PACKT-">app.module.ts</code> at the root of our application, we need to provide <code class="Code-In-Text--PACKT-">UserService</code> in <code class="Code-In-Text--PACKT-">app.module.ts</code> as well, so we can consume data from it in <code class="Code-In-Text--PACKT-">UserEntityService</code>. Even though <code class="Code-In-Text--PACKT-">UserEntityService</code> is provided in <code class="Code-In-Text--PACKT-">UserModule</code>, the order of operations within NgRx Data doesn't lend itself to properly working with feature modules. This will probably be fixed at some point.</p>
        </div>
      </li>
      <li class="list">You can <a id="_idIndexMarker1457"/>add CRUD methods to the component, as shown in the following code. However, we will be focused on just updating the <code class="Code-In-Text--PACKT-">getUsers</code> function so there is no need to add the others:
        <pre class="programlisting"><code class="hljs pgsql"><strong>src/app/manager/<span class="hljs-keyword">user</span>-<span class="hljs-keyword">table</span>/<span class="hljs-keyword">user</span>-<span class="hljs-keyword">table</span>.component.ts</strong>
<strong>getUsers() {</strong>
<strong>  <span class="hljs-keyword">return</span> this.userEntityService.getAll().pipe(</strong>
<strong>    map((<span class="hljs-keyword">value</span>) =&gt; {</strong>
<strong>      <span class="hljs-keyword">return</span> { total: <span class="hljs-keyword">value</span>.length, data: <span class="hljs-keyword">value</span> }</strong>
<strong>    })</strong>
<strong>  )</strong>
<strong>}</strong>
<span class="hljs-keyword">add</span>(<span class="hljs-keyword">user</span>: <span class="hljs-keyword">User</span>) { 
  this.userEntityService.<span class="hljs-keyword">add</span>(<span class="hljs-keyword">user</span>)
}
<span class="hljs-keyword">delete</span>(<span class="hljs-keyword">user</span>: <span class="hljs-keyword">User</span>) { 
  this.userEntityService.<span class="hljs-keyword">delete</span>(<span class="hljs-keyword">user</span>._id)
}
<span class="hljs-keyword">update</span>(<span class="hljs-keyword">user</span>: <span class="hljs-keyword">User</span>) { 
  this.userEntityService.<span class="hljs-keyword">update</span>(<span class="hljs-keyword">user</span>)
}
</code></pre>
      </li>
      <li class="list">In <code class="Code-In-Text--PACKT-">ngAfterViewInit</code>, refactor the call to <code class="Code-In-Text--PACKT-">this.userService.getUsers</code> so that it is called from a method named <code class="Code-In-Text--PACKT-">getUsers</code></li>
      <li class="list" value="5">Then <a id="_idIndexMarker1458"/>implement a conditional call to <code class="Code-In-Text--PACKT-">this.userEntityService.getAll()</code> and map out the return value so that it fits the <code class="Code-In-Text--PACKT-">IUsers</code> interface:
        <pre class="programlisting"><code class="hljs kotlin"><strong>src/app/manager/user-table/user-table.component.ts</strong>
...
  getUsers(pageSize: number, searchText = <span class="hljs-string">''</span>, pagesToSkip = <span class="hljs-number">0</span>)
    : Observable&lt;IUsers&gt; {
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.useNgRxData) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.userEntityService.getAll().pipe(   
          map((value) =&gt; {
            <span class="hljs-keyword">return</span> { total: value.length, <span class="hljs-keyword">data</span>: value }
          })
        )
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.userService.getUsers(
          pageSize,
          searchText,
          pagesToSkip,
          sortColumn,
          sortDirection
        )
      }
</code></pre>
      </li>
    </ol>
    <p class="normal">Now your component can attempt to get data from either source by toggling the slide toggle and entering some new search text. However, our endpoint does not provide the data in the shape that NgRx Data expects, so we need to customize the entity service to overcome this issue.</p>
    <h2 class="title" id="_idParaDest-440">Customizing Entity Service</h2>
    <p class="normal">You can <a id="_idIndexMarker1459"/>customize the behavior of NgRx Data in numerous places. We are interested in overriding the behavior of the <code class="Code-In-Text--PACKT-">getAll()</code> function, so the data we're receiving is properly hydrated and the data can be extracted from the item's object.</p>
    <div class="note">
      <p class="Information-Box--PACKT-">For this example, we will not attempt to restore the full pagination functionality using NgRx Data. To keep it simple, we focus on just getting an array of data into the data table.</p>
    </div>
    <p class="normal">Update User Entity Service to inject <code class="Code-In-Text--PACKT-">UserService</code> and implement a <code class="Code-In-Text--PACKT-">getAll</code> function that uses it:</p>
    <pre class="programlisting"><code class="hljs stylus"><strong>src/app/user/user/user<span class="hljs-selector-class">.entity</span><span class="hljs-selector-class">.service</span><span class="hljs-selector-class">.ts</span></strong>
...
<span class="hljs-function"><span class="hljs-title">getAll</span><span class="hljs-params">(options?: EntityActionOptions)</span></span>: Observable&lt;User[]&gt; {
  return this<span class="hljs-selector-class">.userService</span>
    .getUsers(<span class="hljs-number">10</span>)
    .pipe(map((users) =&gt; users<span class="hljs-selector-class">.data</span>.map(User.Build)))
}
...
</code></pre>
    <p class="normal">As you <a id="_idIndexMarker1460"/>can see, we're iterating through the item's object and hydrating objects with our builder function, thus flattening and transforming <code class="Code-In-Text--PACKT-">Observable&lt;IUsers&gt;</code> to <code class="Code-In-Text--PACKT-">Observable&lt;User[]&gt;</code>.</p>
    <p class="normal">After implementing this change, you should be able to see data flow into the user table as follows:</p>
    <figure class="mediaobject"><img alt="" src="../Images/B14094_12_10.png"/></figure>
    <p class="packt_figref">Figure 12.10: User table with NgRx Data</p>
    <p class="normal">Note that all seven users are displayed at once, and as magnified in the preceding screenshot, the pagination functionality is not working. However, this implementation is adequate <a id="_idIndexMarker1461"/>enough to demonstrate what NgRx Data brings to the table.</p>
    <p class="normal">So, should you implement NgRx Data in your next app? It depends. Since the library is an abstraction layer on top of NgRx, you may find yourself lost and restricted if you don't have a good understanding of the internals of NgRx. However, the library holds a lot of promise for reducing boilerplate code regarding entity data management and CRUD operations. If you're doing lots of CRUD operations in your app, you may save time, but be careful to keep the scope of your implementation only to the areas that need it. Either way, you should <a id="_idIndexMarker1462"/>keep an eye out for the evolution of this great library.</p>
    <h1 class="title" id="_idParaDest-441">Summary</h1>
    <p class="normal">In this chapter, we completed going over all major Angular app design considerations using router-first architecture, along with our recipes, to implement a line-of-business app with ease. We went over how to edit existing users, leverage a resolve guard to load user data, and hydrate and reuse a component in different contexts.</p>
    <p class="normal">We implemented a master/detail view using auxiliary routes and demonstrated how to build data tables with pagination. We then learned about NgRx and the <code class="Code-In-Text--PACKT-">@ngrx/data</code> libraries and their impact on our code base using the <strong class="bold">local-weather-app</strong> and <strong class="bold">lemon-mart</strong> projects.</p>
    <p class="normal">Overall, by using the router-first design, architecture, and implementation approach, we tackled our application's design with a good high-level understanding of what we wanted to achieve. By identifying code reuse opportunities early on, we were able to optimize our implementation strategy to implement reusable components ahead of time, without running the risk of grossly over-engineering our solution.</p>
    <p class="normal">In the next chapter, we will set up a highly available infrastructure on AWS to host LemonMart. We will update the project with new scripts to enable no-downtime blue-green deployments. Finally, in the last chapter, we will update LemonMart with Google Analytics and go over advanced Cloud Ops concerns.</p>
    <h1 class="title" id="_idParaDest-442">Further reading</h1>
    <ul>
      <li class="list"><em class="italics">Testing Angular Components With @Input()</em>, Aiko Klostermann, 2017, available at <a href="https://medium.com/better-programming/testing-angular-components-with-input-3bd6c07cfaf6"><span class="url">https://medium.com/better-programming/testing-angular-components-with-input-3bd6c07cfaf6</span></a></li>
      <li class="list"><em class="italics">What is NgRx?</em>, 2020, available at <a href="https://ngrx.io/docs"><span class="url">https://ngrx.io/docs</span></a></li>
      <li class="list"><em class="italics">NgRx Testing</em>, 2020, available at <a href="https://ngrx.io/guide/store/testing"><span class="url">https://ngrx.io/guide/store/testing</span></a></li>
      <li class="list"><em class="italics">@ngrx/data</em>, 2020, available at <a href="https://ngrx.io/guide/data"><span class="url">https://ngrx.io/guide/data</span></a></li>
      <li class="list"><em class="italics">NgRx: Action Creators redesigned</em>, Alex Okrushko, 2019, available at <a href="https://medium.com/angular-in-depth/ngrx-action-creators-redesigned-d396960e46da"><span class="url">https://medium.com/angular-in-depth/ngrx-action-creators-redesigned-d396960e46da</span></a></li>
      <li class="list"><em class="italics">Simplifying Frontend State Management with Observable Store</em>, Dan Wahlin, 2019, available at <a href="https://blog.codewithdan.com/simplifying-front-end-state-management-with-observable-store/"><span class="url">https://blog.codewithdan.com/simplifying-front-end-state-management-with-observable-store/</span></a></li>
    </ul>
    <h1 class="title" id="_idParaDest-443">Questions</h1>
    <p class="normal">Answer the following questions as best as you can to ensure that you've understood the key concepts from this chapter without Googling. Do you need help answering the questions? See <em class="italics">Appendix D</em>, <em class="italics">Self-Assessment Answers</em> online at <a href="https://static.packt-cdn.com/downloads/9781838648800_Appendix_D_Self-Assessment_Answers.pdf"><span class="url">https://static.packt-cdn.com/downloads/9781838648800_Appendix_D_Self-Assessment_Answers.pdf</span></a> or visit <a href="https://expertlysimple.io/angular-self-assessment"><span class="url">https://expertlysimple.io/angular-self-assessment</span></a>.</p>
    <ol>
      <li class="li" value="1">What is a resolve guard?</li>
      <li>What are the benefits of router orchestration?</li>
      <li>What is an auxiliary route?</li>
      <li>How does NgRx differ from using RxJS/Subject?</li>
      <li>What's the value of NgRx data?</li>
      <li>In <code class="Code-In-Text--PACKT-">UserTableComponent</code>, why do we use <code class="Code-In-Text--PACKT-">readonly isLoadingResults$: BehaviorSubject&lt;Boolean&gt;</code> over a simple Boolean to drive the loading spinner?</li>
    </ol>
  </div>
</body></html>