<html><head></head><body>
<div id="_idContainer027">
<h1 class="chapter-number" id="_idParaDest-93"><a id="_idTextAnchor090"/><span class="koboSpan" id="kobo.1.1">6</span></h1>
<h1 id="_idParaDest-94"><a id="_idTextAnchor091"/><span class="koboSpan" id="kobo.2.1">Enhancing the User Experience</span></h1>
<p><span class="koboSpan" id="kobo.3.1">Remix enables us to build applications with progressive enhancement in mind. </span><span class="koboSpan" id="kobo.3.2">In Remix, enhancing the user experience can be achieved by making additive changes. </span><span class="koboSpan" id="kobo.3.3">This allows us to follow a simple step-by-step process to build </span><span class="No-Break"><span class="koboSpan" id="kobo.4.1">our applications.</span></span></p>
<p><span class="koboSpan" id="kobo.5.1">In </span><a href="B17399_05.xhtml#_idTextAnchor078"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.6.1">Chapter 5</span></em></span></a><span class="koboSpan" id="kobo.7.1">, </span><em class="italic"><span class="koboSpan" id="kobo.8.1">Fetching and Mutating Data</span></em><span class="koboSpan" id="kobo.9.1">, we added data loading and mutations to our BeeRich application. </span><span class="koboSpan" id="kobo.9.2">When building out the create expense form, we first implemented the UI to work without JavaScript and then enhanced the browser’s default behavior with JavaScript. </span><span class="koboSpan" id="kobo.9.3">By doing so, we progressively enhanced </span><span class="No-Break"><span class="koboSpan" id="kobo.10.1">the experience.</span></span></p>
<p><span class="koboSpan" id="kobo.11.1">In this chapter, we’ll cover the </span><span class="No-Break"><span class="koboSpan" id="kobo.12.1">following topics:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.13.1">Understanding </span><span class="No-Break"><span class="koboSpan" id="kobo.14.1">progressive enhancement</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.15.1">Prefetching data</span></span></li>
<li><span class="koboSpan" id="kobo.16.1">Working with </span><span class="No-Break"><span class="koboSpan" id="kobo.17.1">action data</span></span></li>
<li><span class="koboSpan" id="kobo.18.1">Handling </span><span class="No-Break"><span class="koboSpan" id="kobo.19.1">concurrent mutations</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.20.1">First, we will formalize how progressive enhancement works in Remix. </span><span class="koboSpan" id="kobo.20.2">After that, we will focus on advanced data loading and mutation topics, including how to prefetch loader data and assets. </span><span class="koboSpan" id="kobo.20.3">Next, we will learn how to access action data to display mutation feedback. </span><span class="koboSpan" id="kobo.20.4">Finally, we will learn how to support concurrent mutations </span><span class="No-Break"><span class="koboSpan" id="kobo.21.1">in Remix.</span></span></p>
<p><span class="koboSpan" id="kobo.22.1">After reading this chapter, you will understand the benefits of working with progressive enhancement in mind. </span><span class="koboSpan" id="kobo.22.2">You will also learn how to prefetch data, work with action data, and handle multiple form </span><span class="No-Break"><span class="koboSpan" id="kobo.23.1">submissions simultaneously.</span></span></p>
<h1 id="_idParaDest-95"><a id="_idTextAnchor092"/><span class="koboSpan" id="kobo.24.1">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.25.1">Before you start this chapter, follow the instructions in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.26.1">README.md</span></strong><span class="koboSpan" id="kobo.27.1"> file in this chapter’s folder on GitHub. </span><span class="koboSpan" id="kobo.27.2">You can find the code for this chapter </span><span class="No-Break"><span class="koboSpan" id="kobo.28.1">here: </span></span><a href="https://github.com/PacktPublishing/Full-Stack-Web-Development-with-Remix/tree/main/06-enhancing-the-user-experience"><span class="No-Break"><span class="koboSpan" id="kobo.29.1">https://github.com/PacktPublishing/Full-Stack-Web-Development-with-Remix/tree/main/06-enhancing-the-user-experience</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.30.1">.</span></span></p>
<h1 id="_idParaDest-96"><a id="_idTextAnchor093"/><span class="koboSpan" id="kobo.31.1">Understanding progressive enhancement</span></h1>
<p><span class="koboSpan" id="kobo.32.1">In this section, we </span><a id="_idIndexMarker240"/><span class="koboSpan" id="kobo.33.1">will learn more about the motivation behind progressive enhancement and introduce best practices for working with progressive enhancement </span><span class="No-Break"><span class="koboSpan" id="kobo.34.1">in mind.</span></span></p>
<p><span class="koboSpan" id="kobo.35.1">Progressive enhancement is a design philosophy that aims to create a baseline user experience for users on older devices and browsers. </span><span class="koboSpan" id="kobo.35.2">Building with progressive enhancement in mind is like designing mobile first; you start with a minimal UI for small screens and progress </span><span class="No-Break"><span class="koboSpan" id="kobo.36.1">from there.</span></span></p>
<p><span class="koboSpan" id="kobo.37.1">A less frequently used </span><a id="_idIndexMarker241"/><span class="koboSpan" id="kobo.38.1">term is </span><strong class="bold"><span class="koboSpan" id="kobo.39.1">graceful degradation</span></strong><span class="koboSpan" id="kobo.40.1">. </span><span class="koboSpan" id="kobo.40.2">Graceful degradation describes a similar idea: striving for the best experience possible while supporting older browsers and devices. </span><span class="koboSpan" id="kobo.40.3">Progressive enhancement works upward, while graceful degradation </span><span class="No-Break"><span class="koboSpan" id="kobo.41.1">works downward.</span></span></p>
<h2 id="_idParaDest-97"><a id="_idTextAnchor094"/><span class="koboSpan" id="kobo.42.1">Progressive enhancement in Remix</span></h2>
<p><span class="koboSpan" id="kobo.43.1">Remix allows </span><a id="_idIndexMarker242"/><span class="koboSpan" id="kobo.44.1">us to build highly dynamic user experiences by utilizing web standards. </span><span class="koboSpan" id="kobo.44.2">Remix, by default, works without JavaScript. </span><span class="koboSpan" id="kobo.44.3">When working with </span><a id="_idIndexMarker243"/><span class="koboSpan" id="kobo.45.1">progressive enhancement in mind, we can enhance the experience upward but still keep it accessible and usable when JavaScript is still loading, fails to load, or </span><span class="No-Break"><span class="koboSpan" id="kobo.46.1">is disabled.</span></span></p>
<p><span class="koboSpan" id="kobo.47.1">In </span><a href="B17399_04.xhtml#_idTextAnchor057"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.48.1">Chapter 4</span></em></span></a><span class="koboSpan" id="kobo.49.1">, </span><em class="italic"><span class="koboSpan" id="kobo.50.1">Routing in Remix</span></em><span class="koboSpan" id="kobo.51.1">, we learned about Remix’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.52.1">Link</span></strong><span class="koboSpan" id="kobo.53.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.54.1">NavLink</span></strong><span class="koboSpan" id="kobo.55.1"> components. </span><span class="koboSpan" id="kobo.55.2">These components enhance the browser’s default behavior with JavaScript. </span><span class="koboSpan" id="kobo.55.3">Without JavaScript, Remix’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.56.1">Link</span></strong><span class="koboSpan" id="kobo.57.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.58.1">NavLink</span></strong><span class="koboSpan" id="kobo.59.1"> components still render an anchor tag that the browser can </span><span class="No-Break"><span class="koboSpan" id="kobo.60.1">work with.</span></span></p>
<p><span class="koboSpan" id="kobo.61.1">If JavaScript is available, </span><strong class="source-inline"><span class="koboSpan" id="kobo.62.1">Link</span></strong><span class="koboSpan" id="kobo.63.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.64.1">NavLink</span></strong><span class="koboSpan" id="kobo.65.1"> perform client-side navigations and fetch loader data and assets from the server without re-requesting the full HTML document. </span><span class="koboSpan" id="kobo.65.2">Client-side navigations aim to reduce response times by avoiding downloading the entire HTML </span><span class="No-Break"><span class="koboSpan" id="kobo.66.1">document repeatedly.</span></span></p>
<p><span class="koboSpan" id="kobo.67.1">Remix also supports progressive enhancement for data mutations. </span><span class="koboSpan" id="kobo.67.2">When using Remix’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.68.1">Form</span></strong><span class="koboSpan" id="kobo.69.1"> component, we again let Remix enhance the experience. </span><span class="koboSpan" id="kobo.69.2">If JavaScript is available, Remix prevents the browser’s default behavior and initiates a fetch request to the specified action. </span><span class="koboSpan" id="kobo.69.3">However, without JavaScript, we still render a form element that the browser can work with. </span><span class="koboSpan" id="kobo.69.4">Remix is capable of falling back to native </span><span class="No-Break"><span class="koboSpan" id="kobo.70.1">form submissions.</span></span></p>
<p><span class="koboSpan" id="kobo.71.1">Remix provides the tools to create highly dynamic but progressively enhanced experiences. </span><span class="koboSpan" id="kobo.71.2">When working with progressive enhancement in mind, the first step is to make it work </span><span class="No-Break"><span class="koboSpan" id="kobo.72.1">without JavaScript.</span></span></p>
<h2 id="_idParaDest-98"><a id="_idTextAnchor095"/><span class="koboSpan" id="kobo.73.1">Making it work without JavaScript</span></h2>
<p><span class="koboSpan" id="kobo.74.1">Making it </span><a id="_idIndexMarker244"/><span class="koboSpan" id="kobo.75.1">work without JavaScript lets us keep things simple and take advantage of the browser’s </span><span class="No-Break"><span class="koboSpan" id="kobo.76.1">default behavior.</span></span></p>
<p><span class="koboSpan" id="kobo.77.1">There are several reasons why JavaScript might not be available on </span><span class="No-Break"><span class="koboSpan" id="kobo.78.1">the client:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.79.1">JavaScript is still loading, or React is still hydrating when the user interacts with the page. </span><span class="koboSpan" id="kobo.79.2">This frequently happens on slower </span><span class="No-Break"><span class="koboSpan" id="kobo.80.1">network connections.</span></span></li>
<li><span class="koboSpan" id="kobo.81.1">JavaScript failed to load due to a </span><span class="No-Break"><span class="koboSpan" id="kobo.82.1">network error.</span></span></li>
<li><span class="koboSpan" id="kobo.83.1">JavaScript failed to be interpreted, executed, or hydrated due to an error in </span><span class="No-Break"><span class="koboSpan" id="kobo.84.1">the bundle.</span></span></li>
<li><span class="koboSpan" id="kobo.85.1">JavaScript is disabled on the browser by </span><span class="No-Break"><span class="koboSpan" id="kobo.86.1">the user.</span></span></li>
<li><span class="koboSpan" id="kobo.87.1">JavaScript is not supported in the </span><span class="No-Break"><span class="koboSpan" id="kobo.88.1">user’s environment.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.89.1">When our application works without JavaScript, we may be able to reach more people on slower networks or further away from our server locations. </span><span class="koboSpan" id="kobo.89.2">We may also be able to better serve assistive technologies that rely on the browser’s </span><span class="No-Break"><span class="koboSpan" id="kobo.90.1">default behavior.</span></span></p>
<p><span class="koboSpan" id="kobo.91.1">Starting without JavaScript also ensures that our application logic lives on the server whenever possible, reducing our client bundle size and keeping our client </span><span class="No-Break"><span class="koboSpan" id="kobo.92.1">application simple.</span></span></p>
<p><span class="koboSpan" id="kobo.93.1">There are several ways to disable JavaScript in a Remix app to emulate such an environment. </span><span class="koboSpan" id="kobo.93.2">For one, we can disable JavaScript in the browser’s developer tools. </span><span class="koboSpan" id="kobo.93.3">Alternatively, we can open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.94.1">app/root.tsx</span></strong><span class="koboSpan" id="kobo.95.1"> file in an editor and remove the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.96.1">Scripts</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.97.1"> component:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.98.1">
&lt;body&gt;  &lt;Outlet /&gt;
  &lt;ScrollRestoration /&gt;
  </span><strong class="bold"><span class="koboSpan" id="kobo.99.1">&lt;Scripts /&gt;</span></strong><span class="koboSpan" id="kobo.100.1">
  &lt;LiveReload /&gt;
&lt;/body&gt;</span></pre>
<p><span class="koboSpan" id="kobo.101.1">Removing the </span><strong class="source-inline"><span class="koboSpan" id="kobo.102.1">Scripts</span></strong><span class="koboSpan" id="kobo.103.1"> component removes all script tags from the server-side rendered </span><a id="_idIndexMarker245"/><span class="koboSpan" id="kobo.104.1">HTML document. </span><span class="koboSpan" id="kobo.104.2">By disabling JavaScript or not loading any JavaScript, we are forced to move logic from the client to our server-side </span><strong class="source-inline"><span class="koboSpan" id="kobo.105.1">actions</span></strong><span class="koboSpan" id="kobo.106.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.107.1">loader</span></strong><span class="koboSpan" id="kobo.108.1"> functions. </span><span class="koboSpan" id="kobo.108.2">Working with progressive enhancement in mind is a great way to reduce client-side code complexity for the baseline user experience. </span><span class="koboSpan" id="kobo.108.3">Once the baseline experience is implemented, we can add </span><span class="No-Break"><span class="koboSpan" id="kobo.109.1">client-side JavaScript.</span></span></p>
<h2 id="_idParaDest-99"><a id="_idTextAnchor096"/><span class="koboSpan" id="kobo.110.1">Making it worse before making it better</span></h2>
<p><span class="koboSpan" id="kobo.111.1">Once we </span><a id="_idIndexMarker246"/><span class="koboSpan" id="kobo.112.1">make it work without JavaScript, we can think about further enhancing the experience with JavaScript. </span><span class="koboSpan" id="kobo.112.2">One thing to note is that enabling JavaScript will make the experience worse, not better. </span><span class="koboSpan" id="kobo.112.3">By default, the browser indicates page loads by showing a loading spinner in the browser window’s title tab. </span><span class="koboSpan" id="kobo.112.4">Full page reloads also reset client-side states such as form inputs and revalidate the UI with the latest server data. </span><span class="koboSpan" id="kobo.112.5">By preventing the browser’s default behavior, we get rid of </span><span class="No-Break"><span class="koboSpan" id="kobo.113.1">these features.</span></span></p>
<p><span class="koboSpan" id="kobo.114.1">If we skip refreshing client-side states, resetting forms, and showing loading indicators during transitions or submissions, the user experience suffers. </span><span class="koboSpan" id="kobo.114.2">Therefore, we need to add these features back using JavaScript when we stop the browser from doing its </span><span class="No-Break"><span class="koboSpan" id="kobo.115.1">default actions.</span></span></p>
<p><span class="koboSpan" id="kobo.116.1">We already added custom loading indications in </span><a href="B17399_04.xhtml#_idTextAnchor057"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.117.1">Chapter 4</span></em></span></a><span class="koboSpan" id="kobo.118.1">, </span><em class="italic"><span class="koboSpan" id="kobo.119.1">Routing in Remix</span></em><span class="koboSpan" id="kobo.120.1">. </span><span class="koboSpan" id="kobo.120.2">However, whenever we add a new form to our application, we should investigate the experience and see whether additional pending indications </span><span class="No-Break"><span class="koboSpan" id="kobo.121.1">are necessary.</span></span></p>
<h2 id="_idParaDest-100"><a id="_idTextAnchor097"/><span class="koboSpan" id="kobo.122.1">Testing on slow networks</span></h2>
<p><span class="koboSpan" id="kobo.123.1">Testing on slow networks is</span><a id="_idIndexMarker247"/><span class="koboSpan" id="kobo.124.1"> a great way to check an application’s user experience. </span><span class="koboSpan" id="kobo.124.2">It is especially helpful when testing pending states. </span><span class="koboSpan" id="kobo.124.3">Take the expense creation form as an example; you might not have noticed the missing loading indication with the application running on your </span><span class="No-Break"><span class="koboSpan" id="kobo.125.1">local machine.</span></span></p>
<p><span class="koboSpan" id="kobo.126.1">Your browser’s developer tools offer a toggle to throttle your connection to a preset or custom bandwidth. </span><span class="koboSpan" id="kobo.126.2">Setting</span><a id="_idIndexMarker248"/><span class="koboSpan" id="kobo.127.1"> throttling to </span><strong class="bold"><span class="koboSpan" id="kobo.128.1">Slow 3G</span></strong><span class="koboSpan" id="kobo.129.1"> allows you to test your application in a way not possible when developing on </span><span class="No-Break"><span class="koboSpan" id="kobo.130.1">fast Wi-Fi.</span></span></p>
<p><span class="koboSpan" id="kobo.131.1">Let’s test BeeRich on </span><a id="_idIndexMarker249"/><span class="koboSpan" id="kobo.132.1">a slow </span><span class="No-Break"><span class="koboSpan" id="kobo.133.1">3G connection:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.134.1">Run BeeRich by executing </span><strong class="source-inline"><span class="koboSpan" id="kobo.135.1">npm run dev</span></strong><span class="koboSpan" id="kobo.136.1"> in the project’s </span><span class="No-Break"><span class="koboSpan" id="kobo.137.1">root folder.</span></span></li>
<li><span class="koboSpan" id="kobo.138.1">Make sure JavaScript is enabled in case it was </span><span class="No-Break"><span class="koboSpan" id="kobo.139.1">previously disabled.</span></span></li>
<li><span class="koboSpan" id="kobo.140.1">Open the application in </span><span class="No-Break"><span class="koboSpan" id="kobo.141.1">your browser.</span></span></li>
<li><span class="koboSpan" id="kobo.142.1">Open the developer tools and navigate to the </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.143.1">Network</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.144.1"> tab.</span></span></li>
<li><span class="koboSpan" id="kobo.145.1">Look for the throttling functionality and select </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.146.1">Slow 3G</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.147.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.148.1">Open the expense form in your browser </span><span class="No-Break"><span class="koboSpan" id="kobo.149.1">window (</span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.150.1">http://localhost:3000/dashboard/expense/</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.151.1">).</span></span></li>
<li><span class="koboSpan" id="kobo.152.1">Fill out the form and </span><span class="No-Break"><span class="koboSpan" id="kobo.153.1">click </span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.154.1">Submit</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.155.1">.</span></span><p class="list-inset"><span class="koboSpan" id="kobo.156.1">Note that the </span><strong class="bold"><span class="koboSpan" id="kobo.157.1">Submit</span></strong><span class="koboSpan" id="kobo.158.1"> button remains active and can be clicked again. </span><span class="koboSpan" id="kobo.158.2">It is not perfectly clear to the user that the form is currently </span><span class="No-Break"><span class="koboSpan" id="kobo.159.1">being submitted.</span></span></p></li>
<li><span class="koboSpan" id="kobo.160.1">Open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.161.1">dashboard.expenses._index.tsx</span></strong><span class="koboSpan" id="kobo.162.1"> route module in </span><span class="No-Break"><span class="koboSpan" id="kobo.163.1">your editor.</span></span></li>
<li><span class="koboSpan" id="kobo.164.1">Update the route component so that it uses the </span><strong class="source-inline"><span class="koboSpan" id="kobo.165.1">useNavigation</span></strong><span class="koboSpan" id="kobo.166.1"> hook to derive the current transition state of </span><span class="No-Break"><span class="koboSpan" id="kobo.167.1">our application:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.168.1">
import { </span><strong class="bold"><span class="koboSpan" id="kobo.169.1">useNavigation</span></strong><span class="koboSpan" id="kobo.170.1"> } from '@remix-run/react';export default function Component() {  </span><strong class="bold"><span class="koboSpan" id="kobo.171.1">const navigation = useNavigation();</span></strong><span class="koboSpan" id="kobo.172.1">  </span><strong class="bold"><span class="koboSpan" id="kobo.173.1">const isSubmitting = navigation.state !== 'idle' &amp;&amp; navigation.formAction === '/dashboard/expenses/?index';</span></strong><span class="koboSpan" id="kobo.174.1">  return (    &lt;Form method="POST" action="/dashboard/expenses/?index"&gt;      &lt;Input label="Title:" type="text" name="title" placeholder="Dinner for Two" required /&gt;      &lt;Textarea label="Description:" name="description" /&gt;      &lt;Input label="Amount (in USD):" type="number" defaultValue={0} name="amount" required /&gt;      &lt;Button type="submit" </span><strong class="bold"><span class="koboSpan" id="kobo.175.1">disabled={isSubmitting}</span></strong><span class="koboSpan" id="kobo.176.1"> isPrimary&gt;        </span><strong class="bold"><span class="koboSpan" id="kobo.177.1">{isSubmitting ? </span><span class="koboSpan" id="kobo.177.2">'Creating...' </span><span class="koboSpan" id="kobo.177.3">: 'Create'}</span></strong><span class="koboSpan" id="kobo.178.1">      &lt;/Button&gt;    &lt;/Form&gt;  );}</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.179.1">Here, we </span><a id="_idIndexMarker250"/><span class="koboSpan" id="kobo.180.1">updated the button text to indicate </span><a id="_idIndexMarker251"/><span class="koboSpan" id="kobo.181.1">the ongoing submission. </span><span class="koboSpan" id="kobo.181.2">The altered text communicates the loading state to the user. </span><span class="koboSpan" id="kobo.181.3">We also disabled the </span><strong class="bold"><span class="koboSpan" id="kobo.182.1">Submit</span></strong><span class="koboSpan" id="kobo.183.1"> button on submission. </span><span class="koboSpan" id="kobo.183.2">This helps us avoid </span><span class="No-Break"><span class="koboSpan" id="kobo.184.1">accidental re-submits.</span></span></p><p class="list-inset"><span class="koboSpan" id="kobo.185.1">Note that we ensure that the current submission (if any) submits a form to this form’s action by using the navigation object’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.186.1">formAction</span></strong><span class="koboSpan" id="kobo.187.1"> property. </span><span class="koboSpan" id="kobo.187.2">We only want to show the pending UI for this form if this form is </span><span class="No-Break"><span class="koboSpan" id="kobo.188.1">being submitted.</span></span></p></li> <li><span class="koboSpan" id="kobo.189.1">Test the new pending UI with the throttled </span><span class="No-Break"><span class="koboSpan" id="kobo.190.1">network connection.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.191.1">Notice how our changes to the </span><strong class="bold"><span class="koboSpan" id="kobo.192.1">Submit</span></strong><span class="koboSpan" id="kobo.193.1"> button enhance the experience. </span><span class="koboSpan" id="kobo.193.2">Submitting the expense creation form on a slow connection may take a few moments. </span><span class="koboSpan" id="kobo.193.3">Now, we have a clear </span><span class="No-Break"><span class="koboSpan" id="kobo.194.1">loading indication.</span></span></p>
<p><span class="koboSpan" id="kobo.195.1">Progressive enhancement is about making an application accessible to as many users as possible. </span><span class="koboSpan" id="kobo.195.2">Working with progressive enhancement in mind ensures that the baseline user experience stays simple enough to be used on older browsers </span><span class="No-Break"><span class="koboSpan" id="kobo.196.1">and devices.</span></span></p>
<p><span class="koboSpan" id="kobo.197.1">It turns out that </span><a id="_idIndexMarker252"/><span class="koboSpan" id="kobo.198.1">building with progressive enhancement in mind creates a simpler mental model for building great user interfaces. </span><span class="koboSpan" id="kobo.198.2">First, we create the baseline implementation without JavaScript. </span><span class="koboSpan" id="kobo.198.3">Once the baseline implementation works, we focus on enhancing the experience with JavaScript. </span><span class="koboSpan" id="kobo.198.4">We test the application by throttling the network. </span><span class="koboSpan" id="kobo.198.5">This forces us to build a resilient user experience that scales up and down. </span><span class="koboSpan" id="kobo.198.6">Remix supports us by providing primitives and conventions that let us make additive changes to enhance the experience until we </span><span class="No-Break"><span class="koboSpan" id="kobo.199.1">are satisfied.</span></span></p>
<p><span class="koboSpan" id="kobo.200.1">We’re just getting started! </span><span class="koboSpan" id="kobo.200.2">Remix can scale up to highly dynamic experiences. </span><span class="koboSpan" id="kobo.200.3">Next, we’ll learn how to prefetch data with Remix to reduce page </span><span class="No-Break"><span class="koboSpan" id="kobo.201.1">transition times.</span></span></p>
<h1 id="_idParaDest-101"><a id="_idTextAnchor098"/><span class="koboSpan" id="kobo.202.1">Prefetching data</span></h1>
<p><span class="koboSpan" id="kobo.203.1">In this </span><a id="_idIndexMarker253"/><span class="koboSpan" id="kobo.204.1">section, we will learn how to prefetch assets and loader data in Remix and how to utilize prefetching to speed up </span><span class="No-Break"><span class="koboSpan" id="kobo.205.1">transition times.</span></span></p>
<p><span class="koboSpan" id="kobo.206.1">Remix compiles the </span><strong class="source-inline"><span class="koboSpan" id="kobo.207.1">routes</span></strong><span class="koboSpan" id="kobo.208.1"> folder into a routing hierarchy at build time. </span><span class="koboSpan" id="kobo.208.2">The hierarchy information is stored in an asset manifest in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.209.1">public</span></strong><span class="koboSpan" id="kobo.210.1"> folder. </span><span class="koboSpan" id="kobo.210.2">This asset manifest is used by both Remix’s frontend and </span><span class="No-Break"><span class="koboSpan" id="kobo.211.1">backend applications.</span></span></p>
<p><span class="koboSpan" id="kobo.212.1">Since Remix has access to the asset manifest on the client, Remix knows in advance which </span><strong class="source-inline"><span class="koboSpan" id="kobo.213.1">loader</span></strong><span class="koboSpan" id="kobo.214.1"> functions to call to transition to a route. </span><span class="koboSpan" id="kobo.214.2">This allows Remix to prefetch loader data (and route assets) before </span><span class="No-Break"><span class="koboSpan" id="kobo.215.1">the transition.</span></span></p>
<p><span class="koboSpan" id="kobo.216.1">Enabling prefetching</span><a id="_idIndexMarker254"/><span class="koboSpan" id="kobo.217.1"> in Remix is as easy as setting a prop on the link we want to prefetch </span><span class="No-Break"><span class="koboSpan" id="kobo.218.1">data for:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.219.1">Open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.220.1">/app/routes/dashboard.tsx</span></strong><span class="koboSpan" id="kobo.221.1"> file in </span><span class="No-Break"><span class="koboSpan" id="kobo.222.1">your editor.</span></span></li>
<li><span class="koboSpan" id="kobo.223.1">Add the </span><strong class="source-inline"><span class="koboSpan" id="kobo.224.1">prefetch</span></strong><span class="koboSpan" id="kobo.225.1"> property to the </span><strong class="bold"><span class="koboSpan" id="kobo.226.1">Income</span></strong><span class="koboSpan" id="kobo.227.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.228.1">Expenses</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.229.1">navigation links:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.230.1">
&lt;ul className="mt-10 w-full flex flex-row gap-5"&gt;  &lt;li className="ml-auto"&gt;    &lt;NavLink      to={firstInvoice ? </span><span class="koboSpan" id="kobo.230.2">`/dashboard/income/${firstInvoice.id}`         : '/dashboard/income'}      </span><strong class="bold"><span class="koboSpan" id="kobo.231.1">prefetch="intent"</span></strong><span class="koboSpan" id="kobo.232.1">    &gt;      Income    &lt;/NavLink&gt;  &lt;/li&gt;  &lt;li className="mr-auto"&gt;    &lt;NavLink      to={firstExpense ? </span><span class="koboSpan" id="kobo.232.2">`/dashboard/expenses/${firstExpense.        </span><span class="koboSpan" id="kobo.232.3">id}` : '/dashboard/expenses'}      </span><strong class="bold"><span class="koboSpan" id="kobo.233.1">prefetch="intent"</span></strong><span class="koboSpan" id="kobo.234.1">    &gt;      Expenses    &lt;/NavLink&gt;  &lt;/li&gt;&lt;/ul&gt;</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.235.1">The </span><a id="_idIndexMarker255"/><span class="koboSpan" id="kobo.236.1">optional </span><strong class="source-inline"><span class="koboSpan" id="kobo.237.1">prefetch</span></strong><span class="koboSpan" id="kobo.238.1"> property of Remix’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.239.1">Link</span></strong><span class="koboSpan" id="kobo.240.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.241.1">NavLink</span></strong><span class="koboSpan" id="kobo.242.1"> components </span><a id="_idIndexMarker256"/><span class="koboSpan" id="kobo.243.1">can be set to one of the following </span><span class="No-Break"><span class="koboSpan" id="kobo.244.1">four values:</span></span></p><ul><li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.245.1">none</span></strong></span></li><li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.246.1">render</span></strong></span></li><li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.247.1">intent</span></strong></span></li><li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.248.1">viewport</span></strong></span></li></ul><p class="list-inset"><span class="koboSpan" id="kobo.249.1">By default, </span><strong class="source-inline"><span class="koboSpan" id="kobo.250.1">prefetch</span></strong><span class="koboSpan" id="kobo.251.1"> is set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.252.1">none</span></strong><span class="koboSpan" id="kobo.253.1">, which means data and assets won’t be prefetched for this link. </span><span class="koboSpan" id="kobo.253.2">If </span><strong class="source-inline"><span class="koboSpan" id="kobo.254.1">prefetch</span></strong><span class="koboSpan" id="kobo.255.1"> is set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.256.1">render</span></strong><span class="koboSpan" id="kobo.257.1">, then the loader data and assets for the link are fetched once this link is rendered on the page. </span><span class="koboSpan" id="kobo.257.2">If </span><strong class="source-inline"><span class="koboSpan" id="kobo.258.1">prefetch</span></strong><span class="koboSpan" id="kobo.259.1"> is set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.260.1">viewport</span></strong><span class="koboSpan" id="kobo.261.1">, then Remix starts prefetching once the link is within the user’s viewport on the screen. </span><span class="koboSpan" id="kobo.261.2">If </span><strong class="source-inline"><span class="koboSpan" id="kobo.262.1">prefetch</span></strong><span class="koboSpan" id="kobo.263.1"> is set to </span><strong class="source-inline"><span class="koboSpan" id="kobo.264.1">intent</span></strong><span class="koboSpan" id="kobo.265.1">, then Remix </span><a id="_idIndexMarker257"/><span class="koboSpan" id="kobo.266.1">starts prefetching once the user focuses or hovers over </span><a id="_idIndexMarker258"/><span class="koboSpan" id="kobo.267.1">the link; that is, the user shows an intent to use the link. </span><span class="koboSpan" id="kobo.267.2">For now, we will set </span><strong class="source-inline"><span class="koboSpan" id="kobo.268.1">prefetch</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.269.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.270.1">intent</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.271.1">.</span></span></p></li> <li><span class="koboSpan" id="kobo.272.1">Visit the income overview page (</span><a href="http://localhost:3000/dashboard/income"><span class="koboSpan" id="kobo.273.1">http://localhost:3000/dashboard/income</span></a><span class="koboSpan" id="kobo.274.1">) in your </span><span class="No-Break"><span class="koboSpan" id="kobo.275.1">browser window.</span></span></li>
<li><span class="koboSpan" id="kobo.276.1">Open the </span><strong class="bold"><span class="koboSpan" id="kobo.277.1">Network</span></strong><span class="koboSpan" id="kobo.278.1"> tab of your </span><span class="No-Break"><span class="koboSpan" id="kobo.279.1">developer tools.</span></span></li>
<li><span class="koboSpan" id="kobo.280.1">Clear the list of requests and filter for </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.281.1">All</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.282.1"> requests.</span></span></li>
<li><span class="koboSpan" id="kobo.283.1">Now, hover over the </span><strong class="bold"><span class="koboSpan" id="kobo.284.1">Expenses</span></strong><span class="koboSpan" id="kobo.285.1"> link in </span><span class="No-Break"><span class="koboSpan" id="kobo.286.1">the navigation.</span></span></li>
<li><span class="koboSpan" id="kobo.287.1">Inspect the </span><strong class="bold"><span class="koboSpan" id="kobo.288.1">Network</span></strong><span class="koboSpan" id="kobo.289.1"> tab. </span><span class="koboSpan" id="kobo.289.2">It should now list four prefetch requests, as visible in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.290.1">Figure 6</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.291.1">.1</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.292.1">:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer025">
<span class="koboSpan" id="kobo.293.1"><img alt="Figure 6.1 – Inspecting prefetch requests" src="image/Figure_6.01_B17399.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.294.1">Figure 6.1 – Inspecting prefetch requests</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.295.1">A transition to </span><strong class="source-inline"><span class="koboSpan" id="kobo.296.1">/dashboard/expenses/$id</span></strong><span class="koboSpan" id="kobo.297.1"> from the income route matches the following </span><span class="No-Break"><span class="koboSpan" id="kobo.298.1">route modules:</span></span></p>
<ul>
<li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.299.1">dashboard.tsx</span></strong></span></li>
<li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.300.1">dashboard.expenses.tsx</span></strong></span></li>
<li><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.301.1">dashboard.expenses.$id.tsx</span></strong></span></li>
</ul>
<p class="list-inset"><span class="koboSpan" id="kobo.302.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.303.1">dashboard.tsx</span></strong><span class="koboSpan" id="kobo.304.1"> route module is already active on the page, and there is no need to reload it. </span><span class="koboSpan" id="kobo.304.2">Remix only loads assets and loader data for the other two route modules. </span><span class="koboSpan" id="kobo.304.3">We can see four prefetch requests in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.305.1">Figure 6</span></em></span><em class="italic"><span class="koboSpan" id="kobo.306.1">.1</span></em><span class="koboSpan" id="kobo.307.1">. </span><span class="koboSpan" id="kobo.307.2">There are two requests of the JSON content type to fetch the required loader data and two requests to fetch the code-split JavaScript bundles of the two new </span><span class="No-Break"><span class="koboSpan" id="kobo.308.1">route modules.</span></span></p>
<ol>
<li value="8"><span class="koboSpan" id="kobo.309.1">Inspect</span><a id="_idIndexMarker259"/><span class="koboSpan" id="kobo.310.1"> the requests by clicking on them in the </span><strong class="bold"><span class="koboSpan" id="kobo.311.1">Network</span></strong><span class="koboSpan" id="kobo.312.1"> tab. </span><span class="koboSpan" id="kobo.312.2">This should open a request detail view. </span><span class="koboSpan" id="kobo.312.3">Inspect the nested </span><strong class="bold"><span class="koboSpan" id="kobo.313.1">Preview</span></strong><span class="koboSpan" id="kobo.314.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.315.1">Response</span></strong><span class="koboSpan" id="kobo.316.1"> tabs. </span><span class="koboSpan" id="kobo.316.2">The JSON responses contain the loader data of the two </span><span class="No-Break"><span class="koboSpan" id="kobo.317.1">route modules.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.318.1">Prefetching data is </span><a id="_idIndexMarker260"/><span class="koboSpan" id="kobo.319.1">optional. </span><span class="koboSpan" id="kobo.319.2">With prefetching, we pull a lever to reduce request times but introduce a risk of fetching unnecessary data if the user does not visit </span><span class="No-Break"><span class="koboSpan" id="kobo.320.1">the link.</span></span></p>
<p><span class="koboSpan" id="kobo.321.1">Prefetching on render is the most aggressive strategy while prefetching on intent is based on the user’s actions on </span><span class="No-Break"><span class="koboSpan" id="kobo.322.1">the page.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.323.1">Remix provides levers</span></p>
<p class="callout"><span class="koboSpan" id="kobo.324.1">Prefetching is a lever we can pull. </span><span class="koboSpan" id="kobo.324.2">Using prefetching reduces response times by increasing the risk of downloading unnecessary data over the network. </span><span class="koboSpan" id="kobo.324.3">Remix allows us to optimize our application for our use cases and requirements by </span><span class="No-Break"><span class="koboSpan" id="kobo.325.1">providing levers.</span></span></p>
<p><span class="koboSpan" id="kobo.326.1">Now that we’ve learned about prefetching, let’s dive deeper </span><span class="No-Break"><span class="koboSpan" id="kobo.327.1">into mutations.</span></span></p>
<h1 id="_idParaDest-102"><a id="_idTextAnchor099"/><span class="koboSpan" id="kobo.328.1">Working with action data</span></h1>
<p><span class="koboSpan" id="kobo.329.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.330.1">loader</span></strong><span class="koboSpan" id="kobo.331.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.332.1">action</span></strong><span class="koboSpan" id="kobo.333.1"> functions contain most of the business logic of our Remix application. </span><span class="koboSpan" id="kobo.333.2">This </span><a id="_idIndexMarker261"/><span class="koboSpan" id="kobo.334.1">is where we fetch, filter, and update data. </span><span class="koboSpan" id="kobo.334.2">Both functions must return a </span><strong class="source-inline"><span class="koboSpan" id="kobo.335.1">Response</span></strong><span class="koboSpan" id="kobo.336.1"> object. </span><span class="koboSpan" id="kobo.336.2">You know about the </span><strong class="source-inline"><span class="koboSpan" id="kobo.337.1">redirect</span></strong><span class="koboSpan" id="kobo.338.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.339.1">json</span></strong><span class="koboSpan" id="kobo.340.1"> helper functions, which let us create specific </span><strong class="source-inline"><span class="koboSpan" id="kobo.341.1">Response</span></strong><span class="koboSpan" id="kobo.342.1"> objects, and you have already practiced working with loader data. </span><span class="koboSpan" id="kobo.342.2">In this section, we will learn how to work with action data. </span><span class="koboSpan" id="kobo.342.3">For that, we will update the expense details view and implement an edit </span><span class="No-Break"><span class="koboSpan" id="kobo.343.1">expense form:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.344.1">Open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.345.1">dashboard.expenses.$id.tsx</span></strong><span class="koboSpan" id="kobo.346.1"> route module in </span><span class="No-Break"><span class="koboSpan" id="kobo.347.1">your editor.</span></span></li>
<li><span class="koboSpan" id="kobo.348.1">Take the current code from </span><strong class="source-inline"><span class="koboSpan" id="kobo.349.1">dashboard.expenses._index.tsx</span></strong><span class="koboSpan" id="kobo.350.1">. </span><span class="koboSpan" id="kobo.350.2">Can you modify the code to edit an existing expense? </span><span class="koboSpan" id="kobo.350.3">Give it </span><span class="No-Break"><span class="koboSpan" id="kobo.351.1">a try!</span></span><p class="list-inset"><span class="koboSpan" id="kobo.352.1">The final code for this chapter is available in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.353.1">/bee-rich/solution</span></strong><span class="koboSpan" id="kobo.354.1"> folder on GitHub for this chapter. </span><span class="koboSpan" id="kobo.354.2">As we move forward, we'll help you align your work with this </span><span class="No-Break"><span class="koboSpan" id="kobo.355.1">final solution.</span></span></p></li>
<li><span class="koboSpan" id="kobo.356.1">Make sure to update the form's </span><strong class="source-inline"><span class="koboSpan" id="kobo.357.1">action</span></strong><span class="koboSpan" id="kobo.358.1"> property using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.359.1">expense</span></strong><span class="koboSpan" id="kobo.360.1"> object from the </span><span class="No-Break"><span class="koboSpan" id="kobo.361.1">loader data:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.362.1">
&lt;Form method="POST" action={`/dashboard/expenses/${expense.id}`}</span></pre></li> <li><span class="koboSpan" id="kobo.363.1">If you haven't already, update the </span><strong class="source-inline"><span class="koboSpan" id="kobo.364.1">isSubmitting</span></strong><span class="koboSpan" id="kobo.365.1"> constant's </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.366.1">formAction</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.367.1"> check:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.368.1">
const navigation = useNavigation();const isSubmitting = navigation.state !== 'idle' &amp;&amp; navigation.formAction === `/dashboard/expenses/${expense.id}`;</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.369.1">We again use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.370.1">useNavigation</span></strong><span class="koboSpan" id="kobo.371.1"> hook to compute whether we should add pending indications to </span><a id="_idIndexMarker262"/><span class="koboSpan" id="kobo.372.1">the form. </span><span class="koboSpan" id="kobo.372.2">Note that, again, we ensure that the submitted form action matches this form’s </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.373.1">action</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.374.1"> property.</span></span></p></li> <li><span class="koboSpan" id="kobo.375.1">Next, update the route component’s </span><span class="No-Break"><span class="koboSpan" id="kobo.376.1">form fields:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.377.1">
&lt;Input label="Title:" type="text" name="title" </span><strong class="bold"><span class="koboSpan" id="kobo.378.1">defaultValue={expense.title}</span></strong><span class="koboSpan" id="kobo.379.1"> required /&gt;&lt;Textarea label="Description:" name="description" </span><strong class="bold"><span class="koboSpan" id="kobo.380.1">defaultValue={expense.description || ''}</span></strong><span class="koboSpan" id="kobo.381.1"> /&gt;&lt;Input label="Amount (in USD):" type="number" </span><strong class="bold"><span class="koboSpan" id="kobo.382.1">defaultValue={expense.amount}</span></strong><span class="koboSpan" id="kobo.383.1"> name="amount" required /&gt;&lt;Button type="submit" </span><strong class="bold"><span class="koboSpan" id="kobo.384.1">name="intent"</span></strong> <strong class="bold"><span class="koboSpan" id="kobo.385.1">value="update"</span></strong> <strong class="bold"><span class="koboSpan" id="kobo.386.1">disabled={isSubmitting}</span></strong><span class="koboSpan" id="kobo.387.1"> isPrimary&gt;  </span><strong class="bold"><span class="koboSpan" id="kobo.388.1">{isSubmitting ? </span><span class="koboSpan" id="kobo.388.2">'Save...' </span><span class="koboSpan" id="kobo.388.3">: 'Save'}</span></strong><span class="koboSpan" id="kobo.389.1">&lt;/Button&gt;</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.390.1">We use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.391.1">defaultValue</span></strong><span class="koboSpan" id="kobo.392.1"> property to set the form’s initial values. </span><span class="koboSpan" id="kobo.392.2">Compare this to setting the </span><strong class="source-inline"><span class="koboSpan" id="kobo.393.1">value</span></strong><span class="koboSpan" id="kobo.394.1"> property, which also requires us to register </span><strong class="source-inline"><span class="koboSpan" id="kobo.395.1">onChange</span></strong><span class="koboSpan" id="kobo.396.1"> event handlers and work with React states. </span><span class="koboSpan" id="kobo.396.2">Since we use Remix’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.397.1">Form</span></strong><span class="koboSpan" id="kobo.398.1"> component, we don’t need to keep track of the input field value changes, which greatly simplifies our </span><span class="No-Break"><span class="koboSpan" id="kobo.399.1">client-side code.</span></span></p><p class="list-inset"><span class="koboSpan" id="kobo.400.1">Note that </span><a id="_idIndexMarker263"/><span class="koboSpan" id="kobo.401.1">we added </span><strong class="source-inline"><span class="koboSpan" id="kobo.402.1">name</span></strong><span class="koboSpan" id="kobo.403.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.404.1">value</span></strong><span class="koboSpan" id="kobo.405.1"> properties to the </span><strong class="bold"><span class="koboSpan" id="kobo.406.1">Submit</span></strong><span class="koboSpan" id="kobo.407.1"> button. </span><span class="koboSpan" id="kobo.407.2">We can use a button to contain form data. </span><span class="koboSpan" id="kobo.407.3">This is convenient if we want to handle several different actions with the same </span><strong class="source-inline"><span class="koboSpan" id="kobo.408.1">action</span></strong><span class="koboSpan" id="kobo.409.1"> function. </span><span class="koboSpan" id="kobo.409.2">We use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.410.1">intent</span></strong><span class="koboSpan" id="kobo.411.1"> value on the server to know which action </span><span class="No-Break"><span class="koboSpan" id="kobo.412.1">to execute.</span></span></p></li> <li><span class="koboSpan" id="kobo.413.1">Next, add React’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.414.1">key</span></strong><span class="koboSpan" id="kobo.415.1"> property to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.416.1">Form</span></strong><span class="koboSpan" id="kobo.417.1"> component to ensure that React reconstructs the content of the form every time we transition between different expense </span><span class="No-Break"><span class="koboSpan" id="kobo.418.1">details pages:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.419.1">
&lt;Form method="POST" action={`/dashboard/expenses/${expense.id}`} </span><strong class="bold"><span class="koboSpan" id="kobo.420.1">key={expense.id}</span></strong><span class="koboSpan" id="kobo.421.1">&gt;</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.422.1">This is necessary to distinguish different expense forms. </span><span class="koboSpan" id="kobo.422.2">Without this change, React may not reset the </span><strong class="source-inline"><span class="koboSpan" id="kobo.423.1">defaultValue</span></strong><span class="koboSpan" id="kobo.424.1"> value of the input fields when loading a new expense </span><span class="No-Break"><span class="koboSpan" id="kobo.425.1">details page.</span></span></p><p class="list-inset"><span class="koboSpan" id="kobo.426.1">To better understand this, remove the </span><strong class="source-inline"><span class="koboSpan" id="kobo.427.1">key</span></strong><span class="koboSpan" id="kobo.428.1"> property and navigate between different expenses. </span><span class="koboSpan" id="kobo.428.2">You will see that the form does not update with the new expense data if we don’t tell React that each form is unique based on the </span><span class="No-Break"><span class="koboSpan" id="kobo.429.1">expense identifier.</span></span></p></li> <li><span class="koboSpan" id="kobo.430.1">Add the following </span><strong class="source-inline"><span class="koboSpan" id="kobo.431.1">action</span></strong><span class="koboSpan" id="kobo.432.1"> function to the </span><span class="No-Break"><span class="koboSpan" id="kobo.433.1">route module:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.434.1">
import type { </span><strong class="bold"><span class="koboSpan" id="kobo.435.1">ActionFunctionArgs</span></strong><span class="koboSpan" id="kobo.436.1">, LoaderFunctionArgs } from '@remix-run/node';export async function action({ params, request }: </span><strong class="bold"><span class="koboSpan" id="kobo.437.1">ActionFunctionArgs</span></strong><span class="koboSpan" id="kobo.438.1">) {  const { id } = params;  if (!id) throw Error('id route parameter must be defined');  const formData = await request.formData();  const intent = formData.get(</span><strong class="bold"><span class="koboSpan" id="kobo.439.1">'intent'</span></strong><span class="koboSpan" id="kobo.440.1">);  if (</span><strong class="bold"><span class="koboSpan" id="kobo.441.1">intent === 'delete'</span></strong><span class="koboSpan" id="kobo.442.1">) {    // up in the next section!  }  if (</span><strong class="bold"><span class="koboSpan" id="kobo.443.1">intent === 'update'</span></strong><span class="koboSpan" id="kobo.444.1">) {    return updateExpense(formData, id);  }  throw new Response('Bad request', { status: 400 });}</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.445.1">We use </span><a id="_idIndexMarker264"/><span class="koboSpan" id="kobo.446.1">the </span><strong class="source-inline"><span class="koboSpan" id="kobo.447.1">$id</span></strong><span class="koboSpan" id="kobo.448.1"> route parameter to decide which expense to update. </span><span class="koboSpan" id="kobo.448.2">Furthermore, we throw an error if the route parameter is </span><span class="No-Break"><span class="koboSpan" id="kobo.449.1">not defined.</span></span></p><p class="list-inset"><span class="koboSpan" id="kobo.450.1">We utilize the value on the </span><strong class="bold"><span class="koboSpan" id="kobo.451.1">Submit</span></strong><span class="koboSpan" id="kobo.452.1"> button to specify which action we want to execute. </span><span class="koboSpan" id="kobo.452.2">This way, we can handle several different form submissions with the same </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.453.1">action</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.454.1"> function.</span></span></p><p class="list-inset"><span class="koboSpan" id="kobo.455.1">As you can see, we will add a deletion action in the next section. </span><span class="koboSpan" id="kobo.455.2">For now, let’s focus on the </span><span class="No-Break"><span class="koboSpan" id="kobo.456.1">update functionality.</span></span></p></li> <li><span class="koboSpan" id="kobo.457.1">Add the missing </span><strong class="source-inline"><span class="koboSpan" id="kobo.458.1">updateExpense</span></strong><span class="koboSpan" id="kobo.459.1"> function to the route </span><span class="No-Break"><span class="koboSpan" id="kobo.460.1">module file:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.461.1">
async function updateExpense(formData: FormData, id: string): Promise&lt;Response&gt; {  const title = formData.get('title');  const description = formData.get('description');  const amount = formData.get('amount');  if (typeof title !== 'string' || typeof description !== 'string' || typeof amount !== 'string') {    throw Error('something went wrong');  }  const amountNumber = Number.parseFloat(amount);  if (Number.isNaN(amountNumber)) {    throw Error('something went wrong');  }  await db.expense.update({    where: { id },    data: { title, description, amount: amountNumber },  });  </span><strong class="bold"><span class="koboSpan" id="kobo.462.1">return json({ success: true });</span></strong><span class="koboSpan" id="kobo.463.1">}</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.464.1">Like the </span><a id="_idIndexMarker265"/><span class="koboSpan" id="kobo.465.1">create expense action, we validate the user’s input and then use the database client to persist the changes. </span><span class="koboSpan" id="kobo.465.2">However, this time, instead of redirecting the user, we return JSON data in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.466.1">action</span></strong><span class="koboSpan" id="kobo.467.1"> function. </span><span class="koboSpan" id="kobo.467.2">Like in </span><strong class="source-inline"><span class="koboSpan" id="kobo.468.1">loader</span></strong><span class="koboSpan" id="kobo.469.1"> functions, we can return JSON data in </span><strong class="source-inline"><span class="koboSpan" id="kobo.470.1">action</span></strong><span class="koboSpan" id="kobo.471.1"> functions. </span><span class="koboSpan" id="kobo.471.2">This is useful when communicating error or success states to the user after </span><span class="No-Break"><span class="koboSpan" id="kobo.472.1">the mutation.</span></span></p><p class="list-inset"><span class="koboSpan" id="kobo.473.1">In this case, we return a success state after successfully updating </span><span class="No-Break"><span class="koboSpan" id="kobo.474.1">the expense.</span></span></p></li> <li><span class="koboSpan" id="kobo.475.1">Import the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.476.1">useActionData</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.477.1"> hook:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.478.1">
import { </span><strong class="bold"><span class="koboSpan" id="kobo.479.1">useActionData</span></strong><span class="koboSpan" id="kobo.480.1">, useLoaderData, useNavigation } from '@remix-run/react';</span></pre></li> <li><span class="koboSpan" id="kobo.481.1">Call </span><strong class="source-inline"><span class="koboSpan" id="kobo.482.1">useActionData</span></strong><span class="koboSpan" id="kobo.483.1"> in the route module’s component to access the return data </span><span class="No-Break"><span class="koboSpan" id="kobo.484.1">of </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.485.1">action</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.486.1">:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.487.1">const actionData = useActionData&lt;typeof action&gt;();</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.488.1">We infer the type of the action data by using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.489.1">typeof</span></strong><span class="koboSpan" id="kobo.490.1"> operator. </span><span class="koboSpan" id="kobo.490.2">Note that action data – unlike loader data – can </span><span class="No-Break"><span class="koboSpan" id="kobo.491.1">be undefined.</span></span></p></li> <li><span class="koboSpan" id="kobo.492.1">Use the </span><a id="_idIndexMarker266"/><span class="koboSpan" id="kobo.493.1">action data to display a success message below the </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.494.1">Submit</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.495.1"> button:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.496.1">
&lt;Button type="submit" name="intent" value="update" disabled={isSubmitting} isPrimary&gt;  {isSubmitting ? </span><span class="koboSpan" id="kobo.496.2">'Save...' </span><span class="koboSpan" id="kobo.496.3">: 'Save'}&lt;/Button&gt;</span><strong class="bold"><span class="koboSpan" id="kobo.497.1">&lt;p aria-live="polite" className="text-green-600"&gt;</span></strong><strong class="bold"><span class="koboSpan" id="kobo.498.1">  {actionData?.success &amp;&amp; 'Changes saved!'}</span></strong><strong class="bold"><span class="koboSpan" id="kobo.499.1">&lt;/p&gt;</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.500.1">Whenever the </span><strong class="source-inline"><span class="koboSpan" id="kobo.501.1">action</span></strong><span class="koboSpan" id="kobo.502.1"> data is present and the </span><strong class="source-inline"><span class="koboSpan" id="kobo.503.1">success</span></strong><span class="koboSpan" id="kobo.504.1"> property is </span><strong class="source-inline"><span class="koboSpan" id="kobo.505.1">true</span></strong><span class="koboSpan" id="kobo.506.1">, we will show the user a </span><strong class="bold"><span class="koboSpan" id="kobo.507.1">Changes </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.508.1">saved!</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.509.1"> message.</span></span></p></li> <li><span class="koboSpan" id="kobo.510.1">Run the app and test out the updated </span><span class="No-Break"><span class="koboSpan" id="kobo.511.1">expense form!</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.512.1">Awesome! </span><span class="koboSpan" id="kobo.512.2">Just like that, we can leverage </span><strong class="source-inline"><span class="koboSpan" id="kobo.513.1">action</span></strong><span class="koboSpan" id="kobo.514.1"> data to communicate successful mutations. </span><span class="koboSpan" id="kobo.514.2">Make sure you implement the same functionality on the </span><strong class="source-inline"><span class="koboSpan" id="kobo.515.1">income</span></strong><span class="koboSpan" id="kobo.516.1"> routes. </span><span class="koboSpan" id="kobo.516.2">Try to adapt the income route modules without looking at the instructions. </span><span class="koboSpan" id="kobo.516.3">This will help you better understand the lessons of this chapter. </span><span class="koboSpan" id="kobo.516.4">If you get stuck, review the instructions of this chapter. </span><span class="koboSpan" id="kobo.516.5">You can also find the solution code for this chapter </span><span class="No-Break"><span class="koboSpan" id="kobo.517.1">on GitHub.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.518.1">Use useActionData only within the same route module</span></p>
<p class="callout"><span class="koboSpan" id="kobo.519.1">Note that a form submission creates a navigation to the location of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.520.1">action</span></strong><span class="koboSpan" id="kobo.521.1"> function. </span><strong class="source-inline"><span class="koboSpan" id="kobo.522.1">useLoaderData</span></strong><span class="koboSpan" id="kobo.523.1"> can </span><a id="_idIndexMarker267"/><span class="koboSpan" id="kobo.524.1">only access loader data of the same route’s loader. </span><span class="koboSpan" id="kobo.524.2">Similarly, </span><strong class="source-inline"><span class="koboSpan" id="kobo.525.1">useActionData</span></strong><span class="koboSpan" id="kobo.526.1"> must </span><a id="_idIndexMarker268"/><span class="koboSpan" id="kobo.527.1">be used in the route module of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.528.1">action</span></strong><span class="koboSpan" id="kobo.529.1"> function that the form </span><span class="No-Break"><span class="koboSpan" id="kobo.530.1">submits to.</span></span></p>
<p><span class="koboSpan" id="kobo.531.1">Remix also provides </span><a id="_idIndexMarker269"/><span class="koboSpan" id="kobo.532.1">advanced data mutation utilities. </span><span class="koboSpan" id="kobo.532.2">Next, we’ll add the ability to delete expenses and learn how to handle concurrent mutations </span><span class="No-Break"><span class="koboSpan" id="kobo.533.1">in Remix.</span></span></p>
<h1 id="_idParaDest-103"><a id="_idTextAnchor100"/><span class="koboSpan" id="kobo.534.1">Handling concurrent mutations</span></h1>
<p><span class="koboSpan" id="kobo.535.1">So far, we </span><a id="_idIndexMarker270"/><span class="koboSpan" id="kobo.536.1">have created expense creation and edit forms. </span><span class="koboSpan" id="kobo.536.2">Both forms are standalone on their respective pages. </span><span class="koboSpan" id="kobo.536.3">This section will teach you how to manage multiple form submissions simultaneously. </span><span class="koboSpan" id="kobo.536.4">Let’s start by adding a deletion form to every item in the expense </span><span class="No-Break"><span class="koboSpan" id="kobo.537.1">overview list.</span></span></p>
<h2 id="_idParaDest-104"><a id="_idTextAnchor101"/><span class="koboSpan" id="kobo.538.1">Adding a form to a list</span></h2>
<p><span class="koboSpan" id="kobo.539.1">The goal of this </span><a id="_idIndexMarker271"/><span class="koboSpan" id="kobo.540.1">section is to add a deletion form to every list item in the expense overview list. </span><span class="koboSpan" id="kobo.540.2">Clicking the item should delete the associated expense. </span><span class="koboSpan" id="kobo.540.3">Let’s </span><span class="No-Break"><span class="koboSpan" id="kobo.541.1">get started:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.542.1">If you haven't already, follow the instructions in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.543.1">README.md</span></strong><span class="koboSpan" id="kobo.544.1"> file of this chapter on </span><span class="No-Break"><span class="koboSpan" id="kobo.545.1">GitHub: </span></span><a href="https://github.com/PacktPublishing/Full-Stack-Web-Development-with-Remix/blob/main/06-enhancing-the-user-experience/bee-rich/README.md"><span class="No-Break"><span class="koboSpan" id="kobo.546.1">https://github.com/PacktPublishing/Full-Stack-Web-Development-with-Remix/blob/main/06-enhancing-the-user-experience/bee-rich/README.md</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.547.1">.</span></span><p class="list-inset"><span class="koboSpan" id="kobo.548.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.549.1">README.md</span></strong><span class="koboSpan" id="kobo.550.1"> file includes instructions for how to update the </span><strong class="source-inline"><span class="koboSpan" id="kobo.551.1">ListLinkItem</span></strong><span class="koboSpan" id="kobo.552.1"> component for </span><span class="No-Break"><span class="koboSpan" id="kobo.553.1">this chapter.</span></span></p></li>
<li><span class="koboSpan" id="kobo.554.1">Next, open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.555.1">dashboard.expenses.$id.tsx</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.556.1">route module.</span></span></li>
<li><span class="koboSpan" id="kobo.557.1">Add a </span><strong class="source-inline"><span class="koboSpan" id="kobo.558.1">deleteExpense</span></strong><span class="koboSpan" id="kobo.559.1"> function to the </span><span class="No-Break"><span class="koboSpan" id="kobo.560.1">route module:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.561.1">
async function deleteExpense(request: Request, id: string): Promise&lt;Response&gt; {  const referer = </span><strong class="bold"><span class="koboSpan" id="kobo.562.1">request.headers.get('referer');</span></strong><span class="koboSpan" id="kobo.563.1">  const redirectPath = </span><strong class="bold"><span class="koboSpan" id="kobo.564.1">referer || '/dashboard/expenses';</span></strong><span class="koboSpan" id="kobo.565.1">  try {    await db.expense.delete({ where: { id } });  } catch (err) {    throw new Response('Not found', { status: 404 });  }  if (redirectPath.includes(id)) {    return redirect('/dashboard/expenses');  }  return redirect(redirectPath);}</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.566.1">When </span><a id="_idIndexMarker272"/><span class="koboSpan" id="kobo.567.1">submitting a deletion request, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.568.1">action</span></strong><span class="koboSpan" id="kobo.569.1"> URL (</span><strong class="source-inline"><span class="koboSpan" id="kobo.570.1">request.url</span></strong><span class="koboSpan" id="kobo.571.1">) contains the </span><strong class="source-inline"><span class="koboSpan" id="kobo.572.1">id</span></strong><span class="koboSpan" id="kobo.573.1"> parameter of the expense that should be deleted. </span><span class="koboSpan" id="kobo.573.2">However, that may not be the expense that’s currently displayed in the details route module. </span><span class="koboSpan" id="kobo.573.3">We use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.574.1">referer</span></strong><span class="koboSpan" id="kobo.575.1"> header to derive the route from which the form was submitted. </span><span class="koboSpan" id="kobo.575.2">The goal is to keep the user on the current route unless the current route is the details page of the expense that is being deleted. </span><span class="koboSpan" id="kobo.575.3">This ensures that deletion does not navigate the user away from the current page unless the current expense </span><span class="No-Break"><span class="koboSpan" id="kobo.576.1">is deleted.</span></span></p></li> <li><span class="koboSpan" id="kobo.577.1">Call the newly created </span><strong class="source-inline"><span class="koboSpan" id="kobo.578.1">deleteExpense</span></strong><span class="koboSpan" id="kobo.579.1"> function in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.580.1">action</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.581.1"> function:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.582.1">
if (intent === 'delete') {  </span><strong class="bold"><span class="koboSpan" id="kobo.583.1">return deleteExpense(request, id);</span></strong><span class="koboSpan" id="kobo.584.1">}</span></pre></li> <li><span class="koboSpan" id="kobo.585.1">Inspect the code of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.586.1">ListLinkItem</span></strong><span class="koboSpan" id="kobo.587.1"> component </span><span class="No-Break"><span class="koboSpan" id="kobo.588.1">in </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.589.1">/app/components/links.tsx</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.590.1">.</span></span><p class="list-inset"><span class="koboSpan" id="kobo.591.1">The updated </span><strong class="source-inline"><span class="koboSpan" id="kobo.592.1">ListLinkItem</span></strong><span class="koboSpan" id="kobo.593.1"> component renders a delete (</span><strong class="bold"><span class="koboSpan" id="kobo.594.1">X</span></strong><span class="koboSpan" id="kobo.595.1">) button if the </span><strong class="source-inline"><span class="koboSpan" id="kobo.596.1">deleteProps</span></strong><span class="koboSpan" id="kobo.597.1"> property is provided. </span><span class="koboSpan" id="kobo.597.2">The </span><strong class="bold"><span class="koboSpan" id="kobo.598.1">Submit</span></strong><span class="koboSpan" id="kobo.599.1"> button also carries </span><strong class="source-inline"><span class="koboSpan" id="kobo.600.1">name</span></strong><span class="koboSpan" id="kobo.601.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.602.1">value</span></strong><span class="koboSpan" id="kobo.603.1"> properties to specify the type of </span><strong class="source-inline"><span class="koboSpan" id="kobo.604.1">action</span></strong><span class="koboSpan" id="kobo.605.1"> function </span><span class="No-Break"><span class="koboSpan" id="kobo.606.1">to perform.</span></span></p></li>
<li><span class="koboSpan" id="kobo.607.1">Next, open</span><a id="_idIndexMarker273"/><span class="koboSpan" id="kobo.608.1"> the </span><strong class="source-inline"><span class="koboSpan" id="kobo.609.1">dashboard.expenses.tsx</span></strong><span class="koboSpan" id="kobo.610.1"> file in your editor and pass the </span><strong class="source-inline"><span class="koboSpan" id="kobo.611.1">deleteProps</span></strong><span class="koboSpan" id="kobo.612.1"> property to the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.613.1">ListLinkItem</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.614.1"> component:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.615.1">
&lt;ListLinkItem  key={expense.id}  to={`/dashboard/expenses/${expense.id}`}</span><strong class="bold"><span class="koboSpan" id="kobo.616.1">  deleteProps={{</span></strong><strong class="bold"><span class="koboSpan" id="kobo.617.1">    ariaLabel: `Delete expense ${expense.title}`,</span></strong><strong class="bold"><span class="koboSpan" id="kobo.618.1">    action: `/dashboard/expenses/${expense.id}`,</span></strong><strong class="bold"><span class="koboSpan" id="kobo.619.1">  }}</span></strong><span class="koboSpan" id="kobo.620.1">&gt;  …&lt;/ListLinkItem&gt;</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.621.1">We now render a form for every expense item in the </span><span class="No-Break"><span class="koboSpan" id="kobo.622.1">expense list.</span></span></p></li> <li><span class="koboSpan" id="kobo.623.1">Let’s also add an indication about which list item is currently active in the details view. </span><span class="koboSpan" id="kobo.623.2">Import </span><strong class="source-inline"><span class="koboSpan" id="kobo.624.1">useParams</span></strong><span class="koboSpan" id="kobo.625.1"> from Remix inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.626.1">dashboard.expenses.tsx</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.627.1">route module:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.628.1">
import { Outlet, useLoaderData, useNavigation, </span><strong class="source-inline"><span class="koboSpan" id="kobo.629.1">useParams</span></strong><span class="koboSpan" id="kobo.630.1"> } from '@remix-run/react';</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.631.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.632.1">useParams</span></strong><span class="koboSpan" id="kobo.633.1"> hook can be used to access route parameters on the client. </span><span class="koboSpan" id="kobo.633.2">We use this hook to calculate the </span><strong class="source-inline"><span class="koboSpan" id="kobo.634.1">isActive</span></strong><span class="koboSpan" id="kobo.635.1"> property of the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.636.1">ListLinkItem</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.637.1"> component.</span></span></p></li> <li><span class="koboSpan" id="kobo.638.1">Use </span><a id="_idIndexMarker274"/><span class="koboSpan" id="kobo.639.1">the </span><strong class="source-inline"><span class="koboSpan" id="kobo.640.1">useParams</span></strong><span class="koboSpan" id="kobo.641.1"> hook in the route module component to access the </span><strong class="source-inline"><span class="koboSpan" id="kobo.642.1">id</span></strong><span class="koboSpan" id="kobo.643.1"> route parameter of the expense </span><span class="No-Break"><span class="koboSpan" id="kobo.644.1">details page:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.645.1">
const { id } = useParams();</span></pre></li> <li><span class="koboSpan" id="kobo.646.1">Add the </span><strong class="source-inline"><span class="koboSpan" id="kobo.647.1">isActive</span></strong><span class="koboSpan" id="kobo.648.1"> property to the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.649.1">ListLinkItem</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.650.1"> component:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.651.1">
&lt;ListLinkItem  key={expense.id}  to={`/dashboard/expenses/${expense.id}`}  </span><strong class="bold"><span class="koboSpan" id="kobo.652.1">isActive={expense.id === id}</span></strong><span class="koboSpan" id="kobo.653.1">  deleteProps={{    ariaLabel: `Delete expense ${expense.title}`,    action: `/dashboard/expenses/${expense.id}`,  }}&gt;  …&lt;/ListLinkItem&gt;</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.654.1">Earlier, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.655.1">ListLinkItem</span></strong><span class="koboSpan" id="kobo.656.1"> component used the </span><strong class="source-inline"><span class="koboSpan" id="kobo.657.1">NavLink</span></strong><span class="koboSpan" id="kobo.658.1"> component’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.659.1">isActive</span></strong><span class="koboSpan" id="kobo.660.1"> parameter from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.661.1">className</span></strong><span class="koboSpan" id="kobo.662.1"> property to update the styling. </span><span class="koboSpan" id="kobo.662.2">The new implementation requires custom logic as the </span><strong class="source-inline"><span class="koboSpan" id="kobo.663.1">ListLinkItem</span></strong><span class="koboSpan" id="kobo.664.1"> component now renders more than just a </span><strong class="source-inline"><span class="koboSpan" id="kobo.665.1">NavLink</span></strong><span class="koboSpan" id="kobo.666.1">. </span><span class="koboSpan" id="kobo.666.2">We use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.667.1">useParam</span></strong><span class="koboSpan" id="kobo.668.1"> hook to access the current </span><strong class="source-inline"><span class="koboSpan" id="kobo.669.1">id</span></strong><span class="koboSpan" id="kobo.670.1"> parameter and then derive whether the </span><strong class="source-inline"><span class="koboSpan" id="kobo.671.1">href</span></strong><span class="koboSpan" id="kobo.672.1"> attribute of </span><strong class="source-inline"><span class="koboSpan" id="kobo.673.1">ListLinkItem</span></strong><span class="koboSpan" id="kobo.674.1"> points to the currently </span><span class="No-Break"><span class="koboSpan" id="kobo.675.1">displayed expense.</span></span></p></li> <li><span class="koboSpan" id="kobo.676.1">Let’s try out our implementation. </span><span class="koboSpan" id="kobo.676.2">Run the app locally, visit the expense overview page, and delete an expense object by clicking the </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.677.1">X</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.678.1"> button.</span></span><p class="list-inset"><span class="koboSpan" id="kobo.679.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.680.1">action</span></strong><span class="koboSpan" id="kobo.681.1"> function </span><a id="_idIndexMarker275"/><span class="koboSpan" id="kobo.682.1">handles the submission and redirects the user back to the current page or the expense overview page. </span><span class="koboSpan" id="kobo.682.2">After the mutation, Remix refetches the loader data, which triggers a re-render. </span><span class="koboSpan" id="kobo.682.3">The expense object disappears from the </span><span class="No-Break"><span class="koboSpan" id="kobo.683.1">expenses list.</span></span></p></li>
</ol>
<p><span class="koboSpan" id="kobo.684.1">Great! </span><span class="koboSpan" id="kobo.684.2">Each list item in the expenses list now contains a form to delete an expense. </span><span class="koboSpan" id="kobo.684.3">Next, let’s indicate pending states </span><span class="No-Break"><span class="koboSpan" id="kobo.685.1">on deletion.</span></span></p>
<h2 id="_idParaDest-105"><a id="_idTextAnchor102"/><span class="koboSpan" id="kobo.686.1">Supporting multiple pending states</span></h2>
<p><span class="koboSpan" id="kobo.687.1">We already know that we</span><a id="_idIndexMarker276"/><span class="koboSpan" id="kobo.688.1"> can use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.689.1">useNavigation</span></strong><span class="koboSpan" id="kobo.690.1"> hook to access the global navigation object. </span><span class="koboSpan" id="kobo.690.2">The navigation object’s state property indicates </span><a id="_idIndexMarker277"/><span class="koboSpan" id="kobo.691.1">the current transition state of our app. </span><span class="koboSpan" id="kobo.691.2">Let’s use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.692.1">useNavigation</span></strong><span class="koboSpan" id="kobo.693.1"> hook to indicate pending deletion for the </span><span class="No-Break"><span class="koboSpan" id="kobo.694.1">deletion forms:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.695.1">Import </span><strong class="source-inline"><span class="koboSpan" id="kobo.696.1">useNavigation</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.697.1">in </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.698.1">/app/components/links.tsx</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.699.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.700.1">
import { Form, Link as RemixLink, NavLink as RemixNavLink, </span><strong class="bold"><span class="koboSpan" id="kobo.701.1">useNavigation</span></strong><span class="koboSpan" id="kobo.702.1"> } from '@remix-run/react';</span></pre></li> <li><span class="koboSpan" id="kobo.703.1">Next, use the hook to access the navigation object inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.704.1">ListLinkItem</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.705.1">function body:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.706.1">
const navigation = useNavigation();</span></pre></li> <li><span class="koboSpan" id="kobo.707.1">Derive whether the form is currently submitting </span><span class="No-Break"><span class="koboSpan" id="kobo.708.1">or loading:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.709.1">
const isSubmitting =  navigation.state !== 'idle' &amp;&amp;  navigation.formAction === deleteProps?.action &amp;&amp;  navigation.formData?.get('intent') === 'delete';</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.710.1">Note that we are playing extra safe here. </span><span class="koboSpan" id="kobo.710.2">We check whether there is currently a page navigation happening and whether </span><strong class="source-inline"><span class="koboSpan" id="kobo.711.1">formAction</span></strong><span class="koboSpan" id="kobo.712.1"> matches this form’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.713.1">action</span></strong><span class="koboSpan" id="kobo.714.1"> function. </span><span class="koboSpan" id="kobo.714.2">Finally, we also make sure that the form’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.715.1">intent</span></strong><span class="koboSpan" id="kobo.716.1"> value matches this </span><a id="_idIndexMarker278"/><span class="koboSpan" id="kobo.717.1">form’s submit button’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.718.1">intent</span></strong><span class="koboSpan" id="kobo.719.1"> value. </span><span class="koboSpan" id="kobo.719.2">This ensures that we only show the pending state if this delete button </span><span class="No-Break"><span class="koboSpan" id="kobo.720.1">is clicked.</span></span></p></li> <li><span class="koboSpan" id="kobo.721.1">Finally, use </span><strong class="source-inline"><span class="koboSpan" id="kobo.722.1">isSubmitting</span></strong><span class="koboSpan" id="kobo.723.1"> to disable the </span><strong class="bold"><span class="koboSpan" id="kobo.724.1">Submit</span></strong><span class="koboSpan" id="kobo.725.1"> button and indicate the pending </span><span class="No-Break"><span class="koboSpan" id="kobo.726.1">submission conditionally:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.727.1">
&lt;button  type="submit"  aria-label={deleteProps.ariaLabel}  name="intent"  value="delete"  </span><strong class="bold"><span class="koboSpan" id="kobo.728.1">disabled={isSubmitting}</span></strong><span class="koboSpan" id="kobo.729.1">  className={    </span><strong class="bold"><span class="koboSpan" id="kobo.730.1">isSubmitting</span></strong><span class="koboSpan" id="kobo.731.1">      ? </span><span class="koboSpan" id="kobo.731.2">'animate-spin duration-1000'      : 'hover:text-primary focus:text-primary dark:hover:text-darkPrimary dark:focus:text-darkPrimary'  }&gt;</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.732.1">We disable the delete button and showcase a spinner animation if </span><strong class="source-inline"><span class="koboSpan" id="kobo.733.1">isSubmitting</span></strong><span class="koboSpan" id="kobo.734.1"> is </span><strong class="source-inline"><span class="koboSpan" id="kobo.735.1">true</span></strong><span class="koboSpan" id="kobo.736.1">. </span><span class="koboSpan" id="kobo.736.2">Based on our previous experience with the navigation object, this should suffice. </span><span class="koboSpan" id="kobo.736.3">Let’s test it out and see it </span><span class="No-Break"><span class="koboSpan" id="kobo.737.1">in action.</span></span></p></li> <li><span class="koboSpan" id="kobo.738.1">Run the application in development mode and open </span><a href="http://localhost:3000/dashboard/expenses"><span class="koboSpan" id="kobo.739.1">http://localhost:3000/dashboard/expenses</span></a><span class="koboSpan" id="kobo.740.1"> in a </span><span class="No-Break"><span class="koboSpan" id="kobo.741.1">browser window.</span></span></li>
<li><span class="koboSpan" id="kobo.742.1">Open the </span><strong class="bold"><span class="koboSpan" id="kobo.743.1">Network</span></strong><span class="koboSpan" id="kobo.744.1"> tab of the browser developer tools and set throttling to </span><strong class="bold"><span class="koboSpan" id="kobo.745.1">Slow 3G</span></strong><span class="koboSpan" id="kobo.746.1">. </span><span class="koboSpan" id="kobo.746.2">This helps us experience the pending UI for longer. </span><span class="koboSpan" id="kobo.746.3">Also, make sure to filter by </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.747.1">Fetch/XHR</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.748.1"> requests.</span></span></li>
<li><span class="koboSpan" id="kobo.749.1">Try deleting </span><a id="_idIndexMarker279"/><span class="koboSpan" id="kobo.750.1">several expenses at once to see whether you spot </span><span class="No-Break"><span class="koboSpan" id="kobo.751.1">any issues.</span></span><p class="list-inset"><span class="koboSpan" id="kobo.752.1">You may notice a flaw in the current implementation: deleting an expense seems to cancel all other </span><span class="No-Break"><span class="koboSpan" id="kobo.753.1">ongoing deletions.</span></span></p></li>
</ol>
<p><span class="koboSpan" id="kobo.754.1">Can you reason why this is the case? </span><span class="koboSpan" id="kobo.754.2">Remix’s navigation object captures the global navigation state of our application. </span><span class="koboSpan" id="kobo.754.3">There can only be one page navigation at a time. </span><span class="koboSpan" id="kobo.754.4">If the user submits a second form, then Remix cancels the first navigation, as visible in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.755.1">Figure 6</span></em></span><em class="italic"><span class="koboSpan" id="kobo.756.1">.2</span></em><span class="koboSpan" id="kobo.757.1">. </span><span class="koboSpan" id="kobo.757.2">The navigation object is updated, reflecting the second </span><span class="No-Break"><span class="koboSpan" id="kobo.758.1">form submission:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer026">
<span class="koboSpan" id="kobo.759.1"><img alt="Figure 6.2 – Canceling fetch requests" src="image/Figure_6.02_B17399.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.760.1">Figure 6.2 – Canceling fetch requests</span></p>
<p><span class="koboSpan" id="kobo.761.1">Note that the deletions are not aborted; we only lose the pending indications. </span><span class="koboSpan" id="kobo.761.2">On the client, Remix cancels the current submission and updates the navigation object accordingly. </span><span class="koboSpan" id="kobo.761.3">However, the fetch request to delete the expense still reaches the server, and the action is performed. </span><span class="koboSpan" id="kobo.761.4">Remix also ensures that the loader data is only revalidated after every submission has been executed to avoid stale data in case the latest submission finishes faster than </span><span class="No-Break"><span class="koboSpan" id="kobo.762.1">previous submissions.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.763.1">Remix tracks all ongoing submissions but only handles the last navigation</span></p>
<p class="callout"><span class="koboSpan" id="kobo.764.1">Remember that Remix aims to emulate the browser’s default behavior. </span><span class="koboSpan" id="kobo.764.2">There can only ever be one page navigation. </span><span class="koboSpan" id="kobo.764.3">On concurrent form submissions, the last user action determines the final page navigation. </span><span class="koboSpan" id="kobo.764.4">In the background, Remix keeps track of all ongoing submissions to manage loader </span><span class="No-Break"><span class="koboSpan" id="kobo.765.1">data revalidation.</span></span></p>
<p><span class="koboSpan" id="kobo.766.1">Let’s fix the</span><a id="_idIndexMarker280"/><span class="koboSpan" id="kobo.767.1"> lost pending indications. </span><span class="koboSpan" id="kobo.767.2">We want to show the pending UI for every currently pending deletion. </span><span class="koboSpan" id="kobo.767.3">Luckily, Remix provides us with another way to declare a form. </span><span class="koboSpan" id="kobo.767.4">Remix’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.768.1">useFetcher</span></strong><span class="koboSpan" id="kobo.769.1"> hook can declare a </span><strong class="source-inline"><span class="koboSpan" id="kobo.770.1">Form</span></strong><span class="koboSpan" id="kobo.771.1"> component with an isolated </span><span class="No-Break"><span class="koboSpan" id="kobo.772.1">submission state:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.773.1">Import </span><strong class="source-inline"><span class="koboSpan" id="kobo.774.1">useFetcher</span></strong><span class="koboSpan" id="kobo.775.1">, replacing the </span><strong class="source-inline"><span class="koboSpan" id="kobo.776.1">useNavigation</span></strong><span class="koboSpan" id="kobo.777.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.778.1">Form</span></strong><span class="koboSpan" id="kobo.779.1"> imports, in </span><span class="No-Break"><span class="koboSpan" id="kobo.780.1">in </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.781.1">/app/components/links.tsx</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.782.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.783.1">
import { Link as RemixLink, NavLink as RemixNavLink, </span><strong class="bold"><span class="koboSpan" id="kobo.784.1">useFetcher</span></strong><span class="koboSpan" id="kobo.785.1"> } from '@remix-run/react';</span></pre></li> <li><span class="koboSpan" id="kobo.786.1">Replace the </span><strong class="source-inline"><span class="koboSpan" id="kobo.787.1">useNavigation</span></strong><span class="koboSpan" id="kobo.788.1"> hook declaration in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.789.1">ListLinkItem</span></strong><span class="koboSpan" id="kobo.790.1"> component with a call </span><span class="No-Break"><span class="koboSpan" id="kobo.791.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.792.1">useFetcher</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.793.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.794.1">
const fetcher = useFetcher();</span></pre></li> <li><span class="koboSpan" id="kobo.795.1">Next, update the assignment of the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.796.1">isSubmitting</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.797.1"> constant:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.798.1">
const isSubmitting = fetcher.state !== 'idle';</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.799.1">The fetcher object that’s returned from </span><strong class="source-inline"><span class="koboSpan" id="kobo.800.1">useFetcher</span></strong><span class="koboSpan" id="kobo.801.1"> has an isolated submission lifecycle and navigation state. </span><span class="koboSpan" id="kobo.801.2">The state is unaffected by other submissions or loading activities in </span><span class="No-Break"><span class="koboSpan" id="kobo.802.1">the app.</span></span></p><p class="list-inset"><span class="koboSpan" id="kobo.803.1">Note that a </span><strong class="source-inline"><span class="koboSpan" id="kobo.804.1">useFetcher</span></strong><span class="koboSpan" id="kobo.805.1"> form submission still triggers all active </span><strong class="source-inline"><span class="koboSpan" id="kobo.806.1">loader</span></strong><span class="koboSpan" id="kobo.807.1"> functions to reload after mutation. </span><span class="koboSpan" id="kobo.807.2">This sets the global navigation state to </span><strong class="source-inline"><span class="koboSpan" id="kobo.808.1">loading</span></strong><span class="koboSpan" id="kobo.809.1">. </span><span class="koboSpan" id="kobo.809.2">However, a </span><strong class="source-inline"><span class="koboSpan" id="kobo.810.1">useFetcher</span></strong><span class="koboSpan" id="kobo.811.1"> form submission does not set the global navigation object’s state </span><span class="No-Break"><span class="koboSpan" id="kobo.812.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.813.1">submitting</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.814.1">.</span></span></p></li> <li><span class="koboSpan" id="kobo.815.1">Replace </span><strong class="source-inline"><span class="koboSpan" id="kobo.816.1">Form</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.817.1">with </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.818.1">fetcher.Form</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.819.1">:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.820.1">&lt;fetcher.Form</span></strong><span class="koboSpan" id="kobo.821.1"> className="p-8 ml-auto" method="POST" action={deleteProps.action}&gt;  …</span><strong class="bold"><span class="koboSpan" id="kobo.822.1">&lt;/fetcher.Form&gt;</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.823.1">A </span><strong class="source-inline"><span class="koboSpan" id="kobo.824.1">useFetcher</span></strong><span class="koboSpan" id="kobo.825.1"> object </span><a id="_idIndexMarker281"/><span class="koboSpan" id="kobo.826.1">provides several different ways to fetch and mutate data. </span><span class="koboSpan" id="kobo.826.2">It offers a </span><strong class="source-inline"><span class="koboSpan" id="kobo.827.1">load</span></strong><span class="koboSpan" id="kobo.828.1"> function to fetch data from a </span><strong class="source-inline"><span class="koboSpan" id="kobo.829.1">loader</span></strong><span class="koboSpan" id="kobo.830.1"> outside the app’s navigation lifecycle. </span><span class="koboSpan" id="kobo.830.2">It also offers a </span><strong class="source-inline"><span class="koboSpan" id="kobo.831.1">submit</span></strong><span class="koboSpan" id="kobo.832.1"> function to call an </span><strong class="source-inline"><span class="koboSpan" id="kobo.833.1">action</span></strong><span class="koboSpan" id="kobo.834.1"> function programmatically. </span><span class="koboSpan" id="kobo.834.2">Finally, </span><strong class="source-inline"><span class="koboSpan" id="kobo.835.1">useFetcher</span></strong><span class="koboSpan" id="kobo.836.1"> also provides a </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.837.1">Form</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.838.1"> component.</span></span></p><p class="list-inset"><span class="koboSpan" id="kobo.839.1">There are plenty of use cases for </span><strong class="source-inline"><span class="koboSpan" id="kobo.840.1">useFetcher</span></strong><span class="koboSpan" id="kobo.841.1">. </span><span class="koboSpan" id="kobo.841.2">Here, we use the hook to create isolated forms for every item in </span><span class="No-Break"><span class="koboSpan" id="kobo.842.1">a list.</span></span></p><p class="list-inset"><span class="koboSpan" id="kobo.843.1">Since </span><strong class="source-inline"><span class="koboSpan" id="kobo.844.1">useFetcher</span></strong><span class="koboSpan" id="kobo.845.1"> is a hook, we must follow React’s rules for hooks. </span><span class="koboSpan" id="kobo.845.2">When working with a list and </span><strong class="source-inline"><span class="koboSpan" id="kobo.846.1">useFetcher</span></strong><span class="koboSpan" id="kobo.847.1">, we must declare a new </span><strong class="source-inline"><span class="koboSpan" id="kobo.848.1">useFetcher</span></strong><span class="koboSpan" id="kobo.849.1"> object for each list element. </span><span class="koboSpan" id="kobo.849.2">This ensures that each item has its own navigation state. </span><span class="koboSpan" id="kobo.849.3">Usually, this is done by creating a list item component where each list item manages its </span><strong class="source-inline"><span class="koboSpan" id="kobo.850.1">useFetcher</span></strong><span class="koboSpan" id="kobo.851.1"> object. </span><span class="koboSpan" id="kobo.851.2">Conveniently, we are already doing this with the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.852.1">ListLinkItem</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.853.1"> component.</span></span></p></li> <li><span class="koboSpan" id="kobo.854.1">Now, create a few expenses using the expense </span><span class="No-Break"><span class="koboSpan" id="kobo.855.1">creation form.</span></span></li>
<li><span class="koboSpan" id="kobo.856.1">Open the developer tools and navigate to the </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.857.1">Network</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.858.1"> tab.</span></span></li>
<li><span class="koboSpan" id="kobo.859.1">Throttle to </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.860.1">Slow 3G</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.861.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.862.1">Filter for </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.863.1">Fetch/XHR</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.864.1"> requests.</span></span></li>
<li><span class="koboSpan" id="kobo.865.1">Now, click the delete (</span><strong class="bold"><span class="koboSpan" id="kobo.866.1">X</span></strong><span class="koboSpan" id="kobo.867.1">) button of a few expenses as quickly </span><span class="No-Break"><span class="koboSpan" id="kobo.868.1">as possible.</span></span><p class="list-inset"><span class="koboSpan" id="kobo.869.1">Now, we can create an expense and delete several expenses simultaneously, and it will show the loading spinners correctly for each </span><span class="No-Break"><span class="koboSpan" id="kobo.870.1">pending form.</span></span></p><p class="list-inset"><span class="koboSpan" id="kobo.871.1">Note that Remix no longer cancels the previous submission when </span><span class="No-Break"><span class="koboSpan" id="kobo.872.1">using </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.873.1">useFetcher</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.874.1">.</span></span></p></li>
</ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.875.1">Loading and mutating data without page navigations with </span><strong class="source-inline"><span class="koboSpan" id="kobo.876.1">useFetcher</span></strong></p>
<p class="callout"><span class="koboSpan" id="kobo.877.1">Data mutations through the </span><strong class="source-inline"><span class="koboSpan" id="kobo.878.1">Form</span></strong><span class="koboSpan" id="kobo.879.1"> component navigate the user to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.880.1">action</span></strong><span class="koboSpan" id="kobo.881.1"> function’s location. </span><span class="koboSpan" id="kobo.881.2">This is the browser’s default behavior for </span><span class="No-Break"><span class="koboSpan" id="kobo.882.1">form submissions.</span></span></p>
<p class="callout"><span class="koboSpan" id="kobo.883.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.884.1">useFetcher</span></strong><span class="koboSpan" id="kobo.885.1"> hook allows us to load and mutate data without triggering page navigations; </span><strong class="source-inline"><span class="koboSpan" id="kobo.886.1">useFetcher</span></strong><span class="koboSpan" id="kobo.887.1"> has an isolated navigation state and does not trigger page navigations if JavaScript </span><span class="No-Break"><span class="koboSpan" id="kobo.888.1">is loaded.</span></span></p>
<p><span class="koboSpan" id="kobo.889.1">One thing to</span><a id="_idIndexMarker282"/><span class="koboSpan" id="kobo.890.1"> note is that </span><strong class="source-inline"><span class="koboSpan" id="kobo.891.1">useFetcher</span></strong><span class="koboSpan" id="kobo.892.1"> still honors redirect responses from </span><strong class="source-inline"><span class="koboSpan" id="kobo.893.1">action</span></strong><span class="koboSpan" id="kobo.894.1"> functions. </span><span class="koboSpan" id="kobo.894.2">Also, in case JavaScript is not available, </span><strong class="source-inline"><span class="koboSpan" id="kobo.895.1">useFetcher.Form</span></strong><span class="koboSpan" id="kobo.896.1"> falls back to the native form </span><span class="No-Break"><span class="koboSpan" id="kobo.897.1">element’s behavior.</span></span></p>
<p><span class="koboSpan" id="kobo.898.1">There are plenty of use cases for </span><strong class="source-inline"><span class="koboSpan" id="kobo.899.1">useFetcher</span></strong><span class="koboSpan" id="kobo.900.1">. </span><span class="koboSpan" id="kobo.900.2">You can read more about </span><strong class="source-inline"><span class="koboSpan" id="kobo.901.1">useFetcher</span></strong><span class="koboSpan" id="kobo.902.1"> in the Remix </span><span class="No-Break"><span class="koboSpan" id="kobo.903.1">documentation: </span></span><a href="https://remix.run/docs/en/2/hooks/use-fetcher"><span class="No-Break"><span class="koboSpan" id="kobo.904.1">https://remix.run/docs/en/2/hooks/use-fetcher</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.905.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.906.1">Next, practice what you’ve learned and use the updated </span><strong class="source-inline"><span class="koboSpan" id="kobo.907.1">ListLinkItem</span></strong><span class="koboSpan" id="kobo.908.1"> component for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.909.1">income</span></strong><span class="koboSpan" id="kobo.910.1"> routes. </span><span class="koboSpan" id="kobo.910.2">This will help you study this section’s newly </span><span class="No-Break"><span class="koboSpan" id="kobo.911.1">introduced concepts.</span></span></p>
<p><span class="koboSpan" id="kobo.912.1">Amazing! </span><span class="koboSpan" id="kobo.912.2">We’ve covered much ground in </span><span class="No-Break"><span class="koboSpan" id="kobo.913.1">this chapter.</span></span></p>
<p><span class="koboSpan" id="kobo.914.1">Please note that we are currently facing an issue with our user experience. </span><span class="koboSpan" id="kobo.914.2">If you are on an expense details page (</span><strong class="source-inline"><span class="koboSpan" id="kobo.915.1">dashboard/expenses/$id</span></strong><span class="koboSpan" id="kobo.916.1">) and quickly delete all expenses in one go, you may end up on a not found page. </span><span class="koboSpan" id="kobo.916.2">We will address this issue together in the next chapter, </span><a href="B17399_07.xhtml#_idTextAnchor105"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.917.1">Chapter 7</span></em></span></a><span class="koboSpan" id="kobo.918.1">, </span><em class="italic"><span class="koboSpan" id="kobo.919.1">Error Handling </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.920.1">in Remix</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.921.1">.</span></span></p>
<h1 id="_idParaDest-106"><a id="_idTextAnchor103"/><span class="koboSpan" id="kobo.922.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.923.1">In this chapter, we learned about progressive enhancement. </span><span class="koboSpan" id="kobo.923.2">Progressive enhancement is a design philosophy that aims to create a baseline user experience for users on older devices </span><span class="No-Break"><span class="koboSpan" id="kobo.924.1">and browsers.</span></span></p>
<p><span class="koboSpan" id="kobo.925.1">You learned that Remix’s primitives work with and without JavaScript. </span><span class="koboSpan" id="kobo.925.2">This allows us to progressively enhance the experience and make our application accessible to more users. </span><span class="koboSpan" id="kobo.925.3">By building with progressive enhancement in mind, we ensure a simple but resilient experience for as many devices and browsers as possible. </span><span class="koboSpan" id="kobo.925.4">Once we ensure a baseline experience, we can enhance the experience </span><span class="No-Break"><span class="koboSpan" id="kobo.926.1">with JavaScript.</span></span></p>
<p><span class="koboSpan" id="kobo.927.1">Next, you learned that Remix can scale both up and down. </span><span class="koboSpan" id="kobo.927.2">We can start simple and even disable JavaScript, but by making additive changes, we can create highly dynamic experiences with concurrent mutations, data revalidation, </span><span class="No-Break"><span class="koboSpan" id="kobo.928.1">and prefetching.</span></span></p>
<p><span class="koboSpan" id="kobo.929.1">Remix provides levers to optimize the experience for what is important to us. </span><span class="koboSpan" id="kobo.929.2">We can decide how aggressively we want to prefetch data by setting the </span><strong class="source-inline"><span class="koboSpan" id="kobo.930.1">prefetch</span></strong><span class="koboSpan" id="kobo.931.1"> property to </span><strong class="source-inline"><span class="koboSpan" id="kobo.932.1">render</span></strong><span class="koboSpan" id="kobo.933.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.934.1">viewport</span></strong><span class="koboSpan" id="kobo.935.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.936.1">intent</span></strong><span class="koboSpan" id="kobo.937.1">, or </span><strong class="source-inline"><span class="koboSpan" id="kobo.938.1">none</span></strong><span class="koboSpan" id="kobo.939.1">. </span><span class="koboSpan" id="kobo.939.2">You further learned about action data, which can be used to communicate error or success states after </span><span class="No-Break"><span class="koboSpan" id="kobo.940.1">a mutation.</span></span></p>
<p><span class="koboSpan" id="kobo.941.1">Finally, you learned how Remix manages concurrent form submissions. </span><span class="koboSpan" id="kobo.941.2">You know that there can only ever be one active page navigation. </span><span class="koboSpan" id="kobo.941.3">Remix cancels all pending navigations and updates the global navigation </span><span class="No-Break"><span class="koboSpan" id="kobo.942.1">object accordingly.</span></span></p>
<p><span class="koboSpan" id="kobo.943.1">If we want to manage concurrent pending indications and isolated action data, then we can use Remix’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.944.1">useFetcher</span></strong><span class="koboSpan" id="kobo.945.1"> hook. </span><span class="koboSpan" id="kobo.945.2">This can be used to programmatically submit forms, but also offers a </span><strong class="source-inline"><span class="koboSpan" id="kobo.946.1">useFetcher.Form</span></strong><span class="koboSpan" id="kobo.947.1"> component that does not trigger a page navigation if JavaScript </span><span class="No-Break"><span class="koboSpan" id="kobo.948.1">is available.</span></span></p>
<p><span class="koboSpan" id="kobo.949.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.950.1">useFetcher</span></strong><span class="koboSpan" id="kobo.951.1"> hook is especially useful to allow the submission of several forms concurrently while communicating the pending state of each of them in parallel. </span><span class="koboSpan" id="kobo.951.2">This is usually the case when rendering a list of forms, as we saw with the expense overview list </span><span class="No-Break"><span class="koboSpan" id="kobo.952.1">in BeeRich.</span></span></p>
<p><span class="koboSpan" id="kobo.953.1">In the next chapter, we will focus on handling errors and see how we can use Remix to provide a great user experience, even when something </span><span class="No-Break"><span class="koboSpan" id="kobo.954.1">goes wrong.</span></span></p>
<h1 id="_idParaDest-107"><a id="_idTextAnchor104"/><span class="koboSpan" id="kobo.955.1">Further reading</span></h1>
<p><span class="koboSpan" id="kobo.956.1">The Remix team has created an amazing video series called Remix Singles that goes in depth into how to work with data in Remix. </span><span class="koboSpan" id="kobo.956.2">I recommend that you watch the entire series. </span><span class="koboSpan" id="kobo.956.3">Most notably for this chapter, the series has a video about concurrent mutations with </span><strong class="source-inline"><span class="koboSpan" id="kobo.957.1">useFetcher</span></strong><span class="koboSpan" id="kobo.958.1"> that you can find </span><span class="No-Break"><span class="koboSpan" id="kobo.959.1">here: </span></span><a href="https://www.youtube.com/watch?v=vTzNpiOk668&amp;list=PLXoynULbYuEDG2wBFSZ66b85EIspy3fy6"><span class="No-Break"><span class="koboSpan" id="kobo.960.1">https://www.youtube.com/watch?v=vTzNpiOk668&amp;list=PLXoynULbYuEDG2wBFSZ66b85EIspy3fy6</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.961.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.962.1">The Remix documentation includes a page about progressive </span><span class="No-Break"><span class="koboSpan" id="kobo.963.1">enhancement: </span></span><a href="https://remix.run/docs/en/2/discussion/progressive-enhancement"><span class="No-Break"><span class="koboSpan" id="kobo.964.1">https://remix.run/docs/en/2/discussion/progressive-enhancement</span></span></a></p>
<p><span class="koboSpan" id="kobo.965.1">You can also read more about progressive enhancement in the MDN Web </span><span class="No-Break"><span class="koboSpan" id="kobo.966.1">Docs: </span></span><a href="https://developer.mozilla.org/en-US/docs/Glossary/Progressive_Enhancement"><span class="No-Break"><span class="koboSpan" id="kobo.967.1">https://developer.mozilla.org/en-US/docs/Glossary/Progressive_Enhancement</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.968.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.969.1">You can find more information about the </span><strong class="source-inline"><span class="koboSpan" id="kobo.970.1">useFetcher</span></strong><span class="koboSpan" id="kobo.971.1"> hook in the Remix </span><span class="No-Break"><span class="koboSpan" id="kobo.972.1">documentation: </span></span><a href="https://remix.run/docs/en/2/hooks/use-fetcher"><span class="No-Break"><span class="koboSpan" id="kobo.973.1">https://remix.run/docs/en/2/hooks/use-fetcher</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.974.1">.</span></span></p>
</div>
</body></html>