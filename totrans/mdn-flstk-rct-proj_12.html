<html><head></head><body>
<div id="_idContainer095" class="calibre2">
<h1 class="chapter-number" id="_idParaDest-175"><a id="_idTextAnchor176" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.1.1">9</span></h1>
<h1 id="_idParaDest-176" class="calibre5"><a id="_idTextAnchor177" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.2.1">Implementing End-to-End Tests Using Playwright</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.3.1">In the previous chapters, we have written unit tests for our backend using Jest. </span><span class="kobospan" id="kobo.3.2">Now, we are going to learn how to write and run end-to-end tests on our user interface using Playwright. </span><span class="kobospan" id="kobo.3.3">First, we set up Playwright in our project and VS Code to allow for running frontend tests. </span><span class="kobospan" id="kobo.3.4">Then, we are going to write some frontend tests for our application. </span><span class="kobospan" id="kobo.3.5">Next, we are going to learn about reusing test setups with fixtures. </span><span class="kobospan" id="kobo.3.6">Finally, we are going to learn how to view test reports and run Playwright in CI using </span><span><span class="kobospan" id="kobo.4.1">GitHub Actions.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.5.1">In this chapter, we are going to cover the following </span><span><span class="kobospan" id="kobo.6.1">main topics:</span></span></p>
<ul class="calibre10">
<li class="calibre11"><span class="kobospan" id="kobo.7.1">Setting up Playwright for </span><span><span class="kobospan" id="kobo.8.1">end-to-end testing</span></span></li>
<li class="calibre11"><span class="kobospan" id="kobo.9.1">Writing and running </span><span><span class="kobospan" id="kobo.10.1">end-to-end tests</span></span></li>
<li class="calibre11"><span class="kobospan" id="kobo.11.1">Reusable test setups </span><span><span class="kobospan" id="kobo.12.1">using fixtures</span></span></li>
<li class="calibre11"><span class="kobospan" id="kobo.13.1">Viewing test reports and running </span><span><span class="kobospan" id="kobo.14.1">in CI</span></span></li>
</ul>
<h1 id="_idParaDest-177" class="calibre5"><a id="_idTextAnchor178" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.15.1">Technical requirements</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.16.1">Before we start, please install all requirements from </span><a href="B19385_01.xhtml#_idTextAnchor016" class="calibre6 pcalibre1 pcalibre"><span><em class="italic"><span class="kobospan" id="kobo.17.1">Chapter 1</span></em></span></a><em class="italic"><span class="kobospan" id="kobo.18.1">, Preparing for Full-Stack Development</span></em><span class="kobospan" id="kobo.19.1">, and </span><a href="B19385_02.xhtml#_idTextAnchor028" class="calibre6 pcalibre1 pcalibre"><span><em class="italic"><span class="kobospan" id="kobo.20.1">Chapter 2</span></em></span></a><em class="italic"><span class="kobospan" id="kobo.21.1">, Getting to Know Node.js </span></em><span><em class="italic"><span class="kobospan" id="kobo.22.1">and MongoDB</span></em></span><span><span class="kobospan" id="kobo.23.1">.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.24.1">The versions listed in those chapters are the ones used throughout the book. </span><span class="kobospan" id="kobo.24.2">While installing a newer version should not be an issue, please note that certain steps might work differently on a newer version. </span><span class="kobospan" id="kobo.24.3">If you are having an issue with the code and steps provided in this book, please try using the versions mentioned in the </span><em class="italic"><span class="kobospan" id="kobo.25.1">Technical requirements</span></em><span class="kobospan" id="kobo.26.1"> section of </span><em class="italic"><span class="kobospan" id="kobo.27.1">Chapters 1 </span></em><span><span class="kobospan" id="kobo.28.1">and</span></span><span><em class="italic"><span class="kobospan" id="kobo.29.1"> 2</span></em></span><span><span class="kobospan" id="kobo.30.1">.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.31.1">You can find the code for this chapter on </span><span><span class="kobospan" id="kobo.32.1">GitHub: </span></span><a href="https://github.com/PacktPublishing/Modern-Full-Stack-React-Projects/tree/main/ch9" class="calibre6 pcalibre1 pcalibre"><span><span class="kobospan" id="kobo.33.1">https://github.com/PacktPublishing/Modern-Full-Stack-React-Projects/tree/main/ch9</span></span></a><span><span class="kobospan" id="kobo.34.1">.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.35.1">If you cloned the full repository for the book, Husky may not find the </span><strong class="source-inline"><span class="kobospan" id="kobo.36.1">.git</span></strong><span class="kobospan" id="kobo.37.1"> directory when running </span><strong class="source-inline"><span class="kobospan" id="kobo.38.1">npm install</span></strong><span class="kobospan" id="kobo.39.1">. </span><span class="kobospan" id="kobo.39.2">In that case, just run </span><strong class="source-inline"><span class="kobospan" id="kobo.40.1">git init</span></strong><span class="kobospan" id="kobo.41.1"> in the root of the corresponding </span><span><span class="kobospan" id="kobo.42.1">chapter folder.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.43.1">The CiA link for this chapter can be found </span><span><span class="kobospan" id="kobo.44.1">at: </span></span><a href="https://youtu.be/WjwEwUR8g2c" class="calibre6 pcalibre1 pcalibre"><span><span class="kobospan" id="kobo.45.1">https://youtu.be/WjwEwUR8g2c</span></span></a></p>
<h1 id="_idParaDest-178" class="calibre5"><a id="_idTextAnchor179" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.46.1">Setting up Playwright for end-to-end testing</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.47.1">Playwright</span><a id="_idIndexMarker571" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.48.1"> is a test runner to facilitate end-to-end testing on various web rendering engines, such as Chromium (Chrome, Edge, Opera, etc.), WebKit (Safari), and Firefox. </span><span class="kobospan" id="kobo.48.2">It can run tests on Windows, Linux, and macOS, locally or on CI. </span><span class="kobospan" id="kobo.48.3">There are two ways of </span><span><span class="kobospan" id="kobo.49.1">running Playwright:</span></span></p>
<ul class="calibre10">
<li class="calibre11"><strong class="bold"><span class="kobospan" id="kobo.50.1">Headed</span></strong><span class="kobospan" id="kobo.51.1">: Opens a</span><a id="_idIndexMarker572" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.52.1"> browser window where it can be seen what Playwright </span><span><span class="kobospan" id="kobo.53.1">is doing</span></span></li>
<li class="calibre11"><strong class="bold"><span class="kobospan" id="kobo.54.1">Headless</span></strong><span class="kobospan" id="kobo.55.1">: Runs</span><a id="_idIndexMarker573" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.56.1"> the rendering engine in the background and only displays the results of the tests in the Terminal or a generated </span><span><span class="kobospan" id="kobo.57.1">test report</span></span></li>
</ul>
<p class="calibre3"><span class="kobospan" id="kobo.58.1">In this chapter, we are going to explore both ways of running Playwright. </span><span class="kobospan" id="kobo.58.2">Let’s now install Playwright in </span><span><span class="kobospan" id="kobo.59.1">our project.</span></span></p>
<h2 id="_idParaDest-179" class="calibre7"><a id="_idTextAnchor180" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.60.1">Installing Playwright</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.61.1">To install </span><a id="_idIndexMarker574" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.62.1">Playwright, we can use </span><strong class="source-inline"><span class="kobospan" id="kobo.63.1">npm init playwright</span></strong><span class="kobospan" id="kobo.64.1">, which runs a command that installs Playwright, creates a folder for end-to-end tests for us, adds a GitHub Actions workflow to run tests in CI, and installs Playwright browsers so it can run tests in various engines. </span><span class="kobospan" id="kobo.64.2">Follow these steps to </span><span><span class="kobospan" id="kobo.65.1">install Playwright:</span></span></p>
<ol class="calibre15">
<li class="calibre11"><span class="kobospan" id="kobo.66.1">Copy the existing </span><strong class="source-inline1"><span class="kobospan" id="kobo.67.1">ch8</span></strong><span class="kobospan" id="kobo.68.1"> folder to a new </span><strong class="source-inline1"><span class="kobospan" id="kobo.69.1">ch9</span></strong><span class="kobospan" id="kobo.70.1"> folder, </span><span><span class="kobospan" id="kobo.71.1">as follows:</span></span><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.72.1">$ cp -R ch8 ch9</span></strong></pre></li> <li class="calibre11"><span class="kobospan" id="kobo.73.1">Open the </span><strong class="source-inline1"><span class="kobospan" id="kobo.74.1">ch9</span></strong><span class="kobospan" id="kobo.75.1"> folder in VS Code and open a </span><span><span class="kobospan" id="kobo.76.1">new Terminal.</span></span></li>
<li class="calibre11"><span class="kobospan" id="kobo.77.1">Run the </span><span><span class="kobospan" id="kobo.78.1">following command:</span></span><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.79.1">$ npm init playwright@1.17.131</span></strong></pre></li> </ol>
<p class="callout-heading"><span class="kobospan" id="kobo.80.1">Note</span></p>
<p class="callout"><span class="kobospan" id="kobo.81.1">Usually, it is a good idea to install the latest version here by running </span><strong class="source-inline1"><span class="kobospan" id="kobo.82.1">npm init playwright@latest</span></strong><span class="kobospan" id="kobo.83.1">. </span><span class="kobospan" id="kobo.83.2">However, to make sure the instructions in this book are reproducible even when new versions with breaking changes are released, we pin the </span><span><span class="kobospan" id="kobo.84.1">version here.</span></span></p>
<ol class="calibre15">
<li value="4" class="calibre11"><span class="kobospan" id="kobo.85.1">When asked if you want to proceed with installing the </span><strong class="source-inline1"><span class="kobospan" id="kobo.86.1">create-playwright</span></strong><span class="kobospan" id="kobo.87.1"> package, press </span><em class="italic"><span class="kobospan" id="kobo.88.1">Return/Enter</span></em><span class="kobospan" id="kobo.89.1"> to confirm it. </span><span class="kobospan" id="kobo.89.2">Then select </span><strong class="bold"><span class="kobospan" id="kobo.90.1">JavaScript</span></strong><span class="kobospan" id="kobo.91.1">. </span><span class="kobospan" id="kobo.91.2">As for the directory name, keep the </span><strong class="source-inline1"><span class="kobospan" id="kobo.92.1">tests</span></strong><span class="kobospan" id="kobo.93.1"> default name and press </span><em class="italic"><span class="kobospan" id="kobo.94.1">Return/Enter</span></em><span class="kobospan" id="kobo.95.1"> to confirm it. </span><span class="kobospan" id="kobo.95.2">Type </span><strong class="source-inline1"><span class="kobospan" id="kobo.96.1">y</span></strong><span class="kobospan" id="kobo.97.1"> to add a GitHub Actions workflow. </span><span class="kobospan" id="kobo.97.2">Type </span><strong class="source-inline1"><span class="kobospan" id="kobo.98.1">y</span></strong><span class="kobospan" id="kobo.99.1"> again to install Playwright browsers. </span><span class="kobospan" id="kobo.99.2">It will now take a while to download and install the different </span><span><span class="kobospan" id="kobo.100.1">browser engines.</span></span></li>
<li class="calibre11"><span class="kobospan" id="kobo.101.1">We need to adjust some files to make Playwright work with ES modules. </span><span class="kobospan" id="kobo.101.2">Edit </span><strong class="source-inline1"><span class="kobospan" id="kobo.102.1">playwright.config.js</span></strong><span class="kobospan" id="kobo.103.1"> and change the line with the </span><strong class="source-inline1"><span class="kobospan" id="kobo.104.1">require()</span></strong><span class="kobospan" id="kobo.105.1"> import at the beginning of the file to </span><span><span class="kobospan" id="kobo.106.1">the following:</span></span><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.107.1">import { defineConfig, devices } from '@playwright/test'</span></strong></pre></li> <li class="calibre11"><span class="kobospan" id="kobo.108.1">Also, change the export from </span><strong class="source-inline1"><span class="kobospan" id="kobo.109.1">module.exports</span></strong><span class="kobospan" id="kobo.110.1"> to </span><span><span class="kobospan" id="kobo.111.1">the following:</span></span><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.112.1">export default</span></strong><span class="kobospan1" id="kobo.113.1"> defineConfig({</span></pre></li> <li class="calibre11"><em class="italic"><span class="kobospan" id="kobo.114.1">Delete</span></em><span class="kobospan" id="kobo.115.1"> the </span><strong class="source-inline1"><span class="kobospan" id="kobo.116.1">tests-examples/</span></strong><span class="kobospan" id="kobo.117.1"> folder </span><a id="_idIndexMarker575" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.118.1">and the </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.119.1">tests/example.spec.js</span></strong></span><span><span class="kobospan" id="kobo.120.1"> file.</span></span></li>
</ol>
<p class="calibre3"><span class="kobospan" id="kobo.121.1">After installing Playwright, we need to prepare our backend for end-to-end testing, so let’s do </span><span><span class="kobospan" id="kobo.122.1">that now.</span></span></p>
<h2 id="_idParaDest-180" class="calibre7"><a id="_idTextAnchor181" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.123.1">Preparing the backend for end-to-end testing</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.124.1">To prepare the </span><a id="_idIndexMarker576" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.125.1">backend for end-to-end testing, we need to start an instance of the backend with the in-memory MongoDB server, similarly to what we did for the Jest tests. </span><span class="kobospan" id="kobo.125.2">Let’s do </span><span><span class="kobospan" id="kobo.126.1">that now:</span></span></p>
<ol class="calibre15">
<li class="calibre11"><span class="kobospan" id="kobo.127.1">Create </span><a id="_idIndexMarker577" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.128.1">a new </span><strong class="source-inline1"><span class="kobospan" id="kobo.129.1">backend/src/e2e.js</span></strong><span class="kobospan" id="kobo.130.1"> file. </span><span class="kobospan" id="kobo.130.2">Inside it, import </span><strong class="source-inline1"><span class="kobospan" id="kobo.131.1">dotenv</span></strong><span class="kobospan" id="kobo.132.1">, </span><strong class="source-inline1"><span class="kobospan" id="kobo.133.1">globalSetup</span></strong><span class="kobospan" id="kobo.134.1">, and the </span><strong class="source-inline1"><span class="kobospan" id="kobo.135.1">app</span></strong><span class="kobospan" id="kobo.136.1"> and </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.137.1">initDatabase</span></strong></span><span><span class="kobospan" id="kobo.138.1"> functions:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.139.1">
import dotenv from 'dotenv'
dotenv.config()
import globalSetup from './test/globalSetup.js'
import { app } from './app.js'
import { initDatabase } from './db/init.js'</span></pre></li> <li class="calibre11"><span class="kobospan" id="kobo.140.1">Then, define a new </span><strong class="source-inline1"><span class="kobospan" id="kobo.141.1">async</span></strong><span class="kobospan" id="kobo.142.1"> function to run a </span><span><span class="kobospan" id="kobo.143.1">testing server:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.144.1">
async function runTestingServer() {</span></pre></li> <li class="calibre11"><span class="kobospan" id="kobo.145.1">Inside this function, we first run the </span><strong class="source-inline1"><span class="kobospan" id="kobo.146.1">globalSetup</span></strong><span class="kobospan" id="kobo.147.1"> function, which runs an in-memory MongoDB server. </span><span class="kobospan" id="kobo.147.2">Then, we initialize the database and run the </span><span><span class="kobospan" id="kobo.148.1">Express app:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.149.1">
  await globalSetup()
  await initDatabase()
  const PORT = process.env.PORT
  app.listen(PORT)
  console.info(`TESTING express server running on http://localhost:${PORT}`)
}</span></pre></li> <li class="calibre11"><span class="kobospan" id="kobo.150.1">Finally, we run the </span><span><span class="kobospan" id="kobo.151.1">defined function:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.152.1">
runTestingServer()</span></pre></li> <li class="calibre11"><span class="kobospan" id="kobo.153.1">Edit </span><strong class="source-inline1"><span class="kobospan" id="kobo.154.1">backend/package.json</span></strong><span class="kobospan" id="kobo.155.1"> and add a new script to run the </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.156.1">e2e.js</span></strong></span><span><span class="kobospan" id="kobo.157.1"> file:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.158.1">
    "e2e": „node src/e2e.js",</span></pre></li> <li class="calibre11"><span class="kobospan" id="kobo.159.1">In the </span><a id="_idIndexMarker578" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.160.1">root of the project, install </span><strong class="source-inline1"><span class="kobospan" id="kobo.161.1">concurrently</span></strong><span class="kobospan" id="kobo.162.1">, a tool to run two commands </span><span><span class="kobospan" id="kobo.163.1">in parallel:</span></span><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.164.1">$ npm install --save-dev concurrently@8.2.2</span></strong></pre><p class="calibre3"><span class="kobospan" id="kobo.165.1">We are going to use this tool to run the backend and frontend </span><span><span class="kobospan" id="kobo.166.1">in parallel.</span></span></p></li> <li class="calibre11"><span class="kobospan" id="kobo.167.1">Edit </span><strong class="source-inline1"><span class="kobospan" id="kobo.168.1">package.json</span></strong><span class="kobospan" id="kobo.169.1"> in the root of the project and define an </span><strong class="source-inline1"><span class="kobospan" id="kobo.170.1">e2e</span></strong><span class="kobospan" id="kobo.171.1"> script that will run </span><strong class="source-inline1"><span class="kobospan" id="kobo.172.1">e2e:client</span></strong><span class="kobospan" id="kobo.173.1"> and </span><strong class="source-inline1"><span class="kobospan" id="kobo.174.1">e2e:server</span></strong><span class="kobospan" id="kobo.175.1"> scripts </span><span><span class="kobospan" id="kobo.176.1">in parallel:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.177.1">
    "e2e": "concurrently \"npm run e2e:client\" \"npm run e2e:server\"",</span></pre></li> <li class="calibre11"><span class="kobospan" id="kobo.178.1">Now, define the </span><strong class="source-inline1"><span class="kobospan" id="kobo.179.1">e2e:client</span></strong><span class="kobospan" id="kobo.180.1"> script, in which we just run the </span><span><span class="kobospan" id="kobo.181.1">prebuilt frontend:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.182.1">
    "e2e:client": "npm run build &amp;&amp; npm run start",</span></pre><p class="calibre3"><span class="kobospan" id="kobo.183.1">For performance reasons, we do not run the dev server. </span><span class="kobospan" id="kobo.183.2">Otherwise, we would be slowing down our end-to-end tests.  </span><span class="kobospan" id="kobo.183.3">We could omit the build script here, but then we must remember to build our frontend after making changes before running tests, and we must do this in CI as well. </span><span class="kobospan" id="kobo.183.4">Alternatively, when running the tests locally, especially when we are only running certain tests and not all of them, we could run the dev server instead </span><span><span class="kobospan" id="kobo.184.1">of building.</span></span></p></li> <li class="calibre11"><span class="kobospan" id="kobo.185.1">Then, we define the </span><strong class="source-inline1"><span class="kobospan" id="kobo.186.1">e2e:server</span></strong><span class="kobospan" id="kobo.187.1"> script, which runs the </span><strong class="source-inline1"><span class="kobospan" id="kobo.188.1">e2e</span></strong><span class="kobospan" id="kobo.189.1"> script in the </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.190.1">backend</span></strong></span><span><span class="kobospan" id="kobo.191.1"> folder:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.192.1">
    "e2e:server": "cd backend/ &amp;&amp; npm run e2e",</span></pre></li> <li class="calibre11"><span class="kobospan" id="kobo.193.1">Edit </span><strong class="source-inline1"><span class="kobospan" id="kobo.194.1">playwright.config.js</span></strong><span class="kobospan" id="kobo.195.1"> and set the </span><strong class="source-inline1"><span class="kobospan" id="kobo.196.1">baseURL</span></strong><span class="kobospan" id="kobo.197.1"> by changing the </span><span><span class="kobospan" id="kobo.198.1">following line:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.199.1">
  use: {
    /* Base URL to use in actions like `await page.goto('/')`. </span><span class="kobospan1" id="kobo.199.2">*/
 </span><strong class="bold1"><span class="kobospan1" id="kobo.200.1">   baseURL: 'http://localhost:5173',</span></strong></pre></li> <li class="calibre11"><span class="kobospan" id="kobo.201.1">Finally, edit </span><strong class="source-inline1"><span class="kobospan" id="kobo.202.1">playwright.config.js</span></strong><span class="kobospan" id="kobo.203.1"> and </span><em class="italic"><span class="kobospan" id="kobo.204.1">replace</span></em><span class="kobospan" id="kobo.205.1"> the </span><strong class="source-inline1"><span class="kobospan" id="kobo.206.1">webServer</span></strong><span class="kobospan" id="kobo.207.1"> config at the </span><a id="_idIndexMarker579" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.208.1">bottom of the file with </span><span><span class="kobospan" id="kobo.209.1">the following:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.210.1">
  webServer: {
    command: 'npm run e2e',
    url: 'http://localhost:5173',
  },</span></pre></li> </ol>
<p class="calibre3"><span class="kobospan" id="kobo.211.1">Now that we have successfully set up Playwright and prepared the backend for end-to-end testing, let’s get started writing and running </span><span><span class="kobospan" id="kobo.212.1">end-to-end tests!</span></span></p>
<h1 id="_idParaDest-181" class="calibre5"><a id="_idTextAnchor182" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.213.1">Writing and running end-to-end tests</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.214.1">We are now going to write and run </span><a id="_idIndexMarker580" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.215.1">our first end-to-end test with Playwright. </span><span class="kobospan" id="kobo.215.2">Let’s start with a simple test, which just verifies that we have properly optimized our title for search engines. </span><span class="kobospan" id="kobo.215.3">Follow these steps to write and run your first </span><span><span class="kobospan" id="kobo.216.1">end-to-end test:</span></span></p>
<ol class="calibre15">
<li class="calibre11"><span class="kobospan" id="kobo.217.1">Create a new </span><strong class="source-inline1"><span class="kobospan" id="kobo.218.1">tests/seo.spec.js</span></strong><span class="kobospan" id="kobo.219.1"> file. </span><span class="kobospan" id="kobo.219.2">Inside this file, we are going to check whether the title of our page is </span><span><span class="kobospan" id="kobo.220.1">set properly.</span></span></li>
<li class="calibre11"><span class="kobospan" id="kobo.221.1">Inside this newly created file, first import the </span><strong class="source-inline1"><span class="kobospan" id="kobo.222.1">test</span></strong><span class="kobospan" id="kobo.223.1"> and </span><strong class="source-inline1"><span class="kobospan" id="kobo.224.1">expect</span></strong><span class="kobospan" id="kobo.225.1"> functions </span><span><span class="kobospan" id="kobo.226.1">from </span></span><span><strong class="source-inline1"><span class="kobospan" id="kobo.227.1">@playwright/test</span></strong></span><span><span class="kobospan" id="kobo.228.1">:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.229.1">
import { test, expect } from '@playwright/test'</span></pre></li> <li class="calibre11"><span class="kobospan" id="kobo.230.1">Then, we define a test in which we check whether the title of the blog is </span><span><span class="kobospan" id="kobo.231.1">set properly:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.232.1">
test('has title', async ({ page }) =&gt; {</span></pre><p class="calibre3"><span class="kobospan" id="kobo.233.1">As you can see, the </span><strong class="source-inline"><span class="kobospan" id="kobo.234.1">test</span></strong><span class="kobospan" id="kobo.235.1"> function is similar to how we defined tests in Jest. </span><span class="kobospan" id="kobo.235.2">Playwright additionally</span><a id="_idIndexMarker581" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.236.1"> allows us to access special contexts in our test, called </span><strong class="bold"><span class="kobospan" id="kobo.237.1">fixtures</span></strong><span class="kobospan" id="kobo.238.1">. </span><span class="kobospan" id="kobo.238.2">The </span><strong class="source-inline"><span class="kobospan" id="kobo.239.1">page</span></strong><span class="kobospan" id="kobo.240.1"> fixture is the most essential fixture in Playwright and allows us to access browser features and interact with </span><span><span class="kobospan" id="kobo.241.1">a page.</span></span></p></li> <li class="calibre11"><span class="kobospan" id="kobo.242.1">Inside the test, we first navigate to the URL of our frontend by using the </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.243.1">page.goto</span></strong></span><span><span class="kobospan" id="kobo.244.1"> function:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.245.1">
  await page.goto('/')</span></pre></li> <li class="calibre11"><span class="kobospan" id="kobo.246.1">Then, we use the </span><strong class="source-inline1"><span class="kobospan" id="kobo.247.1">expect</span></strong><span class="kobospan" id="kobo.248.1"> function to check whether the page displays the </span><span><span class="kobospan" id="kobo.249.1">correct title:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.250.1">
  await expect(page).toHaveTitle('Full-Stack React Blog')
})</span></pre><p class="calibre3"><span class="kobospan" id="kobo.251.1">As we can see, the </span><a id="_idIndexMarker582" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.252.1">syntax of Playwright is very similar to Jest. </span><span class="kobospan" id="kobo.252.2">We also have an </span><strong class="source-inline"><span class="kobospan" id="kobo.253.1">expect</span></strong><span class="kobospan" id="kobo.254.1"> function to make assertions, such as the page having a </span><span><span class="kobospan" id="kobo.255.1">certain title.</span></span></p></li> <li class="calibre11"><span class="kobospan" id="kobo.256.1">Before running the tests, make sure the </span><strong class="source-inline1"><span class="kobospan" id="kobo.257.1">dbserver</span></strong><span class="kobospan" id="kobo.258.1"> Docker container </span><span><span class="kobospan" id="kobo.259.1">is running.</span></span></li>
<li class="calibre11"><span class="kobospan" id="kobo.260.1">We can now </span><a id="_idIndexMarker583" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.261.1">run this test by opening a new Terminal and executing the </span><span><span class="kobospan" id="kobo.262.1">following command:</span></span><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.263.1">$ npx playwright test</span></strong></pre><p class="calibre3"><span class="kobospan" id="kobo.264.1">Make sure you are in the root of our project (</span><strong class="source-inline"><span class="kobospan" id="kobo.265.1">ch9</span></strong><span class="kobospan" id="kobo.266.1"> folder), and not inside the </span><strong class="source-inline"><span class="kobospan" id="kobo.267.1">backend</span></strong><span class="kobospan" id="kobo.268.1"> folder, when running </span><span><span class="kobospan" id="kobo.269.1">this command!</span></span></p></li> </ol>
<p class="calibre3"><span class="kobospan" id="kobo.270.1">You will see that Playwright runs our test three times (on Chromium, Firefox, and Webkit) and that all of them passed successfully. </span><span class="kobospan" id="kobo.270.2">The following screenshot shows the result of running Playwright in the </span><span><span class="kobospan" id="kobo.271.1">command line:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer089">
<span class="kobospan" id="kobo.272.1"><img alt="Figure 9.1 – Running our first test in Playwright!" src="image/B19385_09_1.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.273.1">Figure 9.1 – Running our first test in Playwright!</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.274.1">Now that we have successfully executed our test, let’s move on to running tests using the VS </span><span><span class="kobospan" id="kobo.275.1">Code extension.</span></span></p>
<h2 id="_idParaDest-182" class="calibre7"><a id="_idTextAnchor183" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.276.1">Using the VS Code extension</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.277.1">Instead of manually</span><a id="_idIndexMarker584" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.278.1"> running all tests via the command line, we can also run specific tests (or all tests) using a VS Code extension, similar to what we did for Jest. </span><span class="kobospan" id="kobo.278.2">Additionally, the extension also allows us to get a visual overview of which tests are succeeding (or not), allows us to inspect tests while running in a browser, and can even record our interactions in the browser and generate tests </span><span><span class="kobospan" id="kobo.279.1">from it!</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.280.1">Let’s start by setting up the VS Code extension and running our test </span><span><span class="kobospan" id="kobo.281.1">from it:</span></span></p>
<ol class="calibre15">
<li class="calibre11"><span class="kobospan" id="kobo.282.1">Open the </span><strong class="bold"><span class="kobospan" id="kobo.283.1">Extensions</span></strong><span class="kobospan" id="kobo.284.1"> tab in VS Code and search </span><span><span class="kobospan" id="kobo.285.1">for </span></span><span><strong class="source-inline1"><span class="kobospan" id="kobo.286.1">Playwright</span></strong></span><span><span class="kobospan" id="kobo.287.1">.</span></span></li>
<li class="calibre11"><span class="kobospan" id="kobo.288.1">Click the </span><strong class="bold"><span class="kobospan" id="kobo.289.1">Install</span></strong><span class="kobospan" id="kobo.290.1"> button to install </span><strong class="bold"><span class="kobospan" id="kobo.291.1">Playwright Test for VS Code</span></strong> <span><span class="kobospan" id="kobo.292.1">by Microsoft.</span></span></li>
<li class="calibre11"><span class="kobospan" id="kobo.293.1">Click on the </span><strong class="bold"><span class="kobospan" id="kobo.294.1">Testing</span></strong><span class="kobospan" id="kobo.295.1"> tab in VS Code (the flask icon), which we also used for the Jest extension. </span><span class="kobospan" id="kobo.295.2">Here, you will now see </span><strong class="bold"><span class="kobospan" id="kobo.296.1">Jest</span></strong><span class="kobospan" id="kobo.297.1"> and </span><strong class="bold"><span class="kobospan" id="kobo.298.1">Playwright</span></strong><span class="kobospan" id="kobo.299.1"> in </span><span><span class="kobospan" id="kobo.300.1">the list.</span></span></li>
<li class="calibre11"><span class="kobospan" id="kobo.301.1">Expand the </span><strong class="bold"><span class="kobospan" id="kobo.302.1">Playwright</span></strong><span class="kobospan" id="kobo.303.1"> | </span><strong class="bold"><span class="kobospan" id="kobo.304.1">tests</span></strong><span class="kobospan" id="kobo.305.1"> path, click on </span><strong class="bold"><span class="kobospan" id="kobo.306.1">seo.spec.js</span></strong><span class="kobospan" id="kobo.307.1"> to load the file, and then click on the </span><strong class="bold"><span class="kobospan" id="kobo.308.1">Play</span></strong><span class="kobospan" id="kobo.309.1"> icon next to </span><strong class="bold"><span class="kobospan" id="kobo.310.1">seo.spec.js</span></strong><span class="kobospan" id="kobo.311.1"> to run </span><span><span class="kobospan" id="kobo.312.1">the test.</span></span></li>
</ol>
<p class="calibre3"><span class="kobospan" id="kobo.313.1">As we can see in the following screenshot, the test was executed successfully, and all tests </span><span><span class="kobospan" id="kobo.314.1">are passing:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer090">
<span class="kobospan" id="kobo.315.1"><img alt="Figure 9.2 – Our playwright test successfully running from the VS Code extension!" src="image/B19385_09_2.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.316.1">Figure 9.2 – Our playwright test successfully running from the VS Code extension!</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.317.1">Now that we have successfully run the tests in the VS Code extension in headless mode, let’s move on to running them in headed mode, where we show what Playwright is doing in the browser while </span><span><span class="kobospan" id="kobo.318.1">running tests.</span></span></p>
<h3 class="calibre9"><span class="kobospan" id="kobo.319.1">Showing the browser while running tests</span></h3>
<p class="calibre3"><span class="kobospan" id="kobo.320.1">The Playwright VS Code </span><a id="_idIndexMarker585" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.321.1">extension also has a useful </span><strong class="bold"><span class="kobospan" id="kobo.322.1">Show browser</span></strong><span class="kobospan" id="kobo.323.1"> option, which opens the browser while running the tests. </span><span class="kobospan" id="kobo.323.2">This allows us to debug tests or the frontend while the tests are running. </span><span class="kobospan" id="kobo.323.3">Let’s try it </span><span><span class="kobospan" id="kobo.324.1">out now:</span></span></p>
<ol class="calibre15">
<li class="calibre11"><span class="kobospan" id="kobo.325.1">On the bottom of the </span><strong class="bold"><span class="kobospan" id="kobo.326.1">Testing</span></strong><span class="kobospan" id="kobo.327.1"> sidebar, check the </span><strong class="bold"><span class="kobospan" id="kobo.328.1">Show browser</span></strong><span class="kobospan" id="kobo.329.1"> box at the bottom of the sidebar and run the </span><span><span class="kobospan" id="kobo.330.1">test again.</span></span><p class="calibre3"><span class="kobospan" id="kobo.331.1">A browser window will open and run the test. </span><span class="kobospan" id="kobo.331.2">However, our test is very quick and simple, so it runs within a short amount of time and there is not much </span><span><span class="kobospan" id="kobo.332.1">to see.</span></span></p></li>
<li class="calibre11"><span class="kobospan" id="kobo.333.1">To better inspect the test, we can use the trace viewer. </span><span class="kobospan" id="kobo.333.2">Check </span><strong class="bold"><span class="kobospan" id="kobo.334.1">Show trace viewer</span></strong><span class="kobospan" id="kobo.335.1"> at the bottom of the </span><strong class="bold"><span class="kobospan" id="kobo.336.1">Testing</span></strong><span class="kobospan" id="kobo.337.1"> sidebar and run the test again. </span><span class="kobospan" id="kobo.337.2">You will see the following </span><span><span class="kobospan" id="kobo.338.1">window open:</span></span></li>
</ol>
<p class="calibre3"> </p>
<div class="calibre2">
<div class="img---figure" id="_idContainer091">
<span class="kobospan" id="kobo.339.1"><img alt="Figure 9.3 – The Playwright trace viewer" src="image/B19385_09_3.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.340.1">Figure 9.3 – The Playwright trace viewer</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.341.1">As we can see, the Playwright</span><a id="_idIndexMarker586" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.342.1"> trace viewer shows us that the test ran </span><strong class="source-inline"><span class="kobospan" id="kobo.343.1">page.goto</span></strong><span class="kobospan" id="kobo.344.1"> and then </span><strong class="source-inline"><span class="kobospan" id="kobo.345.1">expect.toHaveTitle</span></strong><span class="kobospan" id="kobo.346.1">. </span><span class="kobospan" id="kobo.346.2">It also shows the state of the app at each step of the test. </span><span class="kobospan" id="kobo.346.3">In our case, we only have one step though. </span><span class="kobospan" id="kobo.346.4">This feature is especially useful when developing larger and more </span><span><span class="kobospan" id="kobo.347.1">complex tests.</span></span></p>
<p class="callout-heading"><span class="kobospan" id="kobo.348.1">Note</span></p>
<p class="callout"><span class="kobospan" id="kobo.349.1">It is also possible to run Playwright in UI mode, which opens the Playwright app in a separate window that allows us to run the tests separately and look at them being executed, similar to using the </span><strong class="bold"><span class="kobospan" id="kobo.350.1">Show trace viewer</span></strong><span class="kobospan" id="kobo.351.1"> function in the VS Code extension. </span><span class="kobospan" id="kobo.351.2">You can run Playwright in UI mode by executing the following command: </span><strong class="source-inline1"><span class="kobospan" id="kobo.352.1">npx playwright </span></strong><span><strong class="source-inline1"><span class="kobospan" id="kobo.353.1">test --ui</span></strong></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.354.1">Now that we have learned about using the extension to run tests, we can move on to a very useful feature of the extension: recording actions to create a new test. </span><span class="kobospan" id="kobo.354.2">Let’s do </span><span><span class="kobospan" id="kobo.355.1">that now.</span></span></p>
<h3 class="calibre9"><span class="kobospan" id="kobo.356.1">Recording a test</span></h3>
<p class="calibre3"><span class="kobospan" id="kobo.357.1">The Playwright extension can also</span><a id="_idIndexMarker587" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.358.1"> record new tests. </span><span class="kobospan" id="kobo.358.2">Let’s now create a new test for the signup page by using the test recording functionality of the VS </span><span><span class="kobospan" id="kobo.359.1">Code extension:</span></span></p>
<ol class="calibre15">
<li class="calibre11"><span class="kobospan" id="kobo.360.1">Unlike running a Playwright test, the test recorder does not automatically start our frontend and backend, so we need to start them manually first. </span><span class="kobospan" id="kobo.360.2">Open a new Terminal and execute the </span><span><span class="kobospan" id="kobo.361.1">following command:</span></span><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.362.1">$ npm run e2e</span></strong></pre></li> <li class="calibre11"><span class="kobospan" id="kobo.363.1">In the bottom section of the </span><strong class="bold"><span class="kobospan" id="kobo.364.1">Testing</span></strong><span class="kobospan" id="kobo.365.1"> sidebar, click on </span><strong class="bold"><span class="kobospan" id="kobo.366.1">Record new</span></strong><span class="kobospan" id="kobo.367.1">. </span><span class="kobospan" id="kobo.367.2">A browser window </span><span><span class="kobospan" id="kobo.368.1">should open.</span></span></li>
<li class="calibre11"><span class="kobospan" id="kobo.369.1">In the browser window, navigate to the frontend by pasting </span><strong class="source-inline1"><span class="kobospan" id="kobo.370.1">http://localhost:5173/</span></strong><span class="kobospan" id="kobo.371.1"> into the </span><span><span class="kobospan" id="kobo.372.1">URL bar.</span></span></li>
</ol>
<div class="calibre2">
<div class="img---figure" id="_idContainer092">
<span class="kobospan" id="kobo.373.1"><img alt="Figure 9.4 – The Playwright test recorder while hovering over the “Sign Up” link" src="image/B19385_09_4.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.374.1">Figure 9.4 – The Playwright test recorder while hovering over the “Sign Up” link</span></p>
<ol class="calibre15">
<li value="4" class="calibre11"><span class="kobospan" id="kobo.375.1">Then, click</span><a id="_idIndexMarker588" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.376.1"> on the </span><strong class="bold"><span class="kobospan" id="kobo.377.1">Sign Up</span></strong><span class="kobospan" id="kobo.378.1"> link. </span><span class="kobospan" id="kobo.378.2">The sign-up page </span><span><span class="kobospan" id="kobo.379.1">should open.</span></span></li>
<li class="calibre11"><span class="kobospan" id="kobo.380.1">On this new page, enter a username and password; for example, </span><strong class="source-inline1"><span class="kobospan" id="kobo.381.1">test</span></strong><span class="kobospan" id="kobo.382.1"> and </span><strong class="source-inline1"><span class="kobospan" id="kobo.383.1">test</span></strong><span class="kobospan" id="kobo.384.1">. </span><span class="kobospan" id="kobo.384.2">Then press the </span><strong class="bold"><span class="kobospan" id="kobo.385.1">Sign </span></strong><span><strong class="bold"><span class="kobospan" id="kobo.386.1">Up</span></strong></span><span><span class="kobospan" id="kobo.387.1"> button.</span></span></li>
<li class="calibre11"><span class="kobospan" id="kobo.388.1">You will get redirected to the login page. </span><span class="kobospan" id="kobo.388.2">Now, log in with the same username and password </span><span><span class="kobospan" id="kobo.389.1">as before.</span></span></li>
<li class="calibre11"><span class="kobospan" id="kobo.390.1">You will get redirected to the main page and will be logged in as </span><strong class="bold"><span class="kobospan" id="kobo.391.1">test</span></strong><span class="kobospan" id="kobo.392.1">. </span><span class="kobospan" id="kobo.392.2">You can now close the browser window. </span><span class="kobospan" id="kobo.392.3">You will see that inside VS Code you now have a new </span><strong class="source-inline1"><span class="kobospan" id="kobo.393.1">test-1.spec.ts</span></strong><span class="kobospan" id="kobo.394.1"> file containing all the actions we just did in </span><span><span class="kobospan" id="kobo.395.1">the browser!</span></span></li>
<li class="calibre11"><span class="kobospan" id="kobo.396.1">Save the file and quit the </span><strong class="source-inline1"><span class="kobospan" id="kobo.397.1">e2e</span></strong><span class="kobospan" id="kobo.398.1"> script running the backend and frontend. </span><span class="kobospan" id="kobo.398.2">You will now see the </span><strong class="source-inline1"><span class="kobospan" id="kobo.399.1">test-1.spec.ts</span></strong><span class="kobospan" id="kobo.400.1"> file in the </span><strong class="bold"><span class="kobospan" id="kobo.401.1">Testing</span></strong><span class="kobospan" id="kobo.402.1"> sidebar. </span><span class="kobospan" id="kobo.402.2">If you try running the test, you will notice that it gets stuck on the login part, because our test currently does </span><a id="_idIndexMarker589" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.403.1">not wait for the redirect to the </span><span><span class="kobospan" id="kobo.404.1">login page.</span></span></li>
</ol>
<p class="calibre3"><span class="kobospan" id="kobo.405.1">While recording tests is a useful feature to speed up writing end-to-end tests, it cannot always write functioning tests for us. </span><span class="kobospan" id="kobo.405.2">We now need to clean up our recorded test and add assertions </span><span><span class="kobospan" id="kobo.406.1">to it.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.407.1">For reference, here is the full code generated by the Playwright </span><span><span class="kobospan" id="kobo.408.1">test recorder:</span></span></p>
<pre class="source-code"><span class="kobospan1" id="kobo.409.1">
import { test, expect } from '@playwright/test'
test('test', async ({ page }) =&gt; {
  await page.goto('http://localhost:5173/')
  await page.getByRole('link', { name: 'Sign Up' }).click()
  await page.getByLabel('Username:').click()
  await page.getByLabel('Username:').fill('test')
  await page.getByLabel('Password:').click()
  await page.getByLabel('Password:').fill('test')
  await page.getByRole('button', { name: 'Sign Up' }).click()
  await page.getByLabel('Username:').click()
  await page.getByLabel('Username:').fill('test')
  await page.getByLabel('Password:').click()
  await page.getByLabel('Password:').fill('test')
  await page.getByRole('button', { name: 'Log In' }).click()
})</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.410.1">Now that we have recorded a test, let’s clean it up to make it </span><span><span class="kobospan" id="kobo.411.1">run properly.</span></span></p>
<h3 class="calibre9"><span class="kobospan" id="kobo.412.1">Cleaning up and finalizing the recorded test</span></h3>
<p class="calibre3"><span class="kobospan" id="kobo.413.1">If you have a look at </span><a id="_idIndexMarker590" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.414.1">the test, you will see that it has all the actions we performed in the browser, but it does not verify that we have been successfully logged in. </span><span class="kobospan" id="kobo.414.2">It also does not wait for pages to finish loading and some matchers do not match the proper text. </span><span class="kobospan" id="kobo.414.3">Let’s fix those </span><span><span class="kobospan" id="kobo.415.1">problems now:</span></span></p>
<ol class="calibre15">
<li class="calibre11"><span class="kobospan" id="kobo.416.1">Rename </span><strong class="source-inline1"><span class="kobospan" id="kobo.417.1">tests/test-1.spec.ts</span></strong> <span><span class="kobospan" id="kobo.418.1">to </span></span><span><strong class="source-inline1"><span class="kobospan" id="kobo.419.1">tests/auth.spec.js</span></strong></span><span><span class="kobospan" id="kobo.420.1">.</span></span></li>
<li class="calibre11"><span class="kobospan" id="kobo.421.1">Edit </span><strong class="source-inline1"><span class="kobospan" id="kobo.422.1">tests/auth.spec.js</span></strong><span class="kobospan" id="kobo.423.1"> and rename the test to </span><strong class="source-inline1"><span class="kobospan" id="kobo.424.1">allows sign up and </span></strong><span><strong class="source-inline1"><span class="kobospan" id="kobo.425.1">log in</span></strong></span><span><span class="kobospan" id="kobo.426.1">:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.427.1">
test(</span><strong class="bold1"><span class="kobospan1" id="kobo.428.1">'allows sign up and log in</span></strong><span class="kobospan1" id="kobo.429.1">', async ({ page }) =&gt; {</span></pre></li> <li class="calibre11"><span class="kobospan" id="kobo.430.1">We need to define a unique username to be able to run our test multiple times without having to restart the backend to clear the MongoDB </span><span><span class="kobospan" id="kobo.431.1">memory server:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.432.1">
  const testUser = 'test' + Date.now()</span></pre></li> </ol>
<p class="callout-heading"><span class="kobospan" id="kobo.433.1">Note</span></p>
<p class="callout"><span class="kobospan" id="kobo.434.1">It is important to not sign up twice with the same username, as the in-memory MongoDB database is reused for all the tests. </span><span class="kobospan" id="kobo.434.2">Make sure that tests can run independently from each other and do not rely on data from other test files, as the test files could run in any order. </span><span class="kobospan" id="kobo.434.3">Only the order within a single test file is guaranteed. </span><span class="kobospan" id="kobo.434.4">Using </span><strong class="source-inline1"><span class="kobospan" id="kobo.435.1">Date.now()</span></strong><span class="kobospan" id="kobo.436.1"> returns the current time in milliseconds and is mostly collision-safe as long as we do not run too many tests in parallel. </span><span class="kobospan" id="kobo.436.2">For a more collision-safe solution, you could use a UUID </span><span><span class="kobospan" id="kobo.437.1">generator instead.</span></span></p>
<ol class="calibre15">
<li value="4" class="calibre11"><span class="kobospan" id="kobo.438.1">Change the </span><strong class="source-inline1"><span class="kobospan" id="kobo.439.1">page.goto()</span></strong><span class="kobospan" id="kobo.440.1"> URL to </span><strong class="source-inline1"><span class="kobospan" id="kobo.441.1">/</span></strong><span class="kobospan" id="kobo.442.1"> to ensure it uses the </span><strong class="source-inline1"><span class="kobospan" id="kobo.443.1">baseURL</span></strong><span class="kobospan" id="kobo.444.1"> we set </span><span><span class="kobospan" id="kobo.445.1">up earlier:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.446.1">
  await page.goto(</span><strong class="bold1"><span class="kobospan1" id="kobo.447.1">'/'</span></strong><span class="kobospan1" id="kobo.448.1">)</span></pre></li> <li class="calibre11"><span class="kobospan" id="kobo.449.1">Fill in the generated username when </span><span><span class="kobospan" id="kobo.450.1">signing up:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.451.1">
  await page.getByLabel('Username:').fill(</span><strong class="bold1"><span class="kobospan1" id="kobo.452.1">testUser</span></strong><span class="kobospan1" id="kobo.453.1">)</span></pre></li> <li class="calibre11"><span class="kobospan" id="kobo.454.1">After the click on the </span><strong class="bold"><span class="kobospan" id="kobo.455.1">Sign Up</span></strong><span class="kobospan" id="kobo.456.1"> button, wait for the URL to update by using the </span><span><span class="kobospan" id="kobo.457.1">following function:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.458.1">
  await page.getByRole('button', { name: 'Sign Up' }).click()
</span><strong class="bold1"><span class="kobospan1" id="kobo.459.1">  await page.waitForURL('**/login')</span></strong></pre><p class="calibre3"><span class="kobospan" id="kobo.460.1">Waiting for the next page to load is necessary because the recording does not support page-loading detection right now and it would otherwise fire the commands on the old page or during the redirect, which would cause the test </span><span><span class="kobospan" id="kobo.461.1">to fail.</span></span></p></li> <li class="calibre11"><span class="kobospan" id="kobo.462.1">For the login, we also fill in the </span><span><span class="kobospan" id="kobo.463.1">generated username:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.464.1">
  await page.getByLabel('Username:').fill(</span><strong class="bold1"><span class="kobospan1" id="kobo.465.1">testUser</span></strong><span class="kobospan1" id="kobo.466.1">)</span></pre></li> <li class="calibre11"><span class="kobospan" id="kobo.467.1">After that, make the test click on on the </span><strong class="bold"><span class="kobospan" id="kobo.468.1">Log In</span></strong><span class="kobospan" id="kobo.469.1"> button and wait for the URL to </span><span><span class="kobospan" id="kobo.470.1">update again:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.471.1">
  await page.getByRole('button', { name: 'Log In' }).click()
</span><strong class="bold1"><span class="kobospan1" id="kobo.472.1">  await page.waitForURL('**/')</span></strong></pre></li> <li class="calibre11"><span class="kobospan" id="kobo.473.1">To more easily</span><a id="_idIndexMarker591" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.474.1"> match the </span><strong class="source-inline1"><span class="kobospan" id="kobo.475.1">Header</span></strong><span class="kobospan" id="kobo.476.1"> React component, edit </span><strong class="source-inline1"><span class="kobospan" id="kobo.477.1">src/components/Header.jsx</span></strong><span class="kobospan" id="kobo.478.1"> and turn the </span><strong class="source-inline1"><span class="kobospan" id="kobo.479.1">&lt;div&gt;</span></strong><span class="kobospan" id="kobo.480.1"> elements into </span><strong class="source-inline1"><span class="kobospan" id="kobo.481.1">&lt;</span></strong><span><strong class="source-inline1"><span class="kobospan" id="kobo.482.1">nav&gt;</span></strong></span><span><span class="kobospan" id="kobo.483.1"> elements:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.484.1">
export function Header() {
  const [token, setToken] = useAuth()
  if (token) {
    const { sub } = jwtDecode(token)
    return (
</span><strong class="bold1"><span class="kobospan1" id="kobo.485.1">      &lt;nav&gt;</span></strong><span class="kobospan1" id="kobo.486.1">
        Logged in as &lt;User id={sub} /&gt;
        &lt;br /&gt;
        &lt;button onClick={() =&gt; setToken(null)}&gt;Logout&lt;/button&gt;
</span><strong class="bold1"><span class="kobospan1" id="kobo.487.1">      &lt;/nav&gt;</span></strong><span class="kobospan1" id="kobo.488.1">
    )
  }
  return (
</span><strong class="bold1"><span class="kobospan1" id="kobo.489.1">    &lt;nav&gt;</span></strong><span class="kobospan1" id="kobo.490.1">
      &lt;Link to='/login'&gt;Log In&lt;/Link&gt; | &lt;Link to='/signup'&gt;Sign Up&lt;/Link&gt;
</span><strong class="bold1"><span class="kobospan1" id="kobo.491.1">    &lt;/nav&gt;</span></strong><span class="kobospan1" id="kobo.492.1">
  )
}</span></pre></li> <li class="calibre11"><span class="kobospan" id="kobo.493.1">At the end of the test, we now add an assertion that checks whether the Header (</span><strong class="source-inline1"><span class="kobospan" id="kobo.494.1">&lt;nav&gt;</span></strong><span class="kobospan" id="kobo.495.1"> element) contains the text </span><strong class="bold"><span class="kobospan" id="kobo.496.1">Logged in as</span></strong><span class="kobospan" id="kobo.497.1"> and the </span><span><span class="kobospan" id="kobo.498.1">generated username:</span></span><pre class="source-code">
<strong class="bold1"><span class="kobospan1" id="kobo.499.1">  await expect(page.locator('nav')).toContainText('Logged in as ' + testUser)</span></strong><span class="kobospan1" id="kobo.500.1">
})</span></pre><p class="calibre3"><span class="kobospan" id="kobo.501.1">Using </span><strong class="source-inline"><span class="kobospan" id="kobo.502.1">toContainText</span></strong><span class="kobospan" id="kobo.503.1"> instead of </span><strong class="source-inline"><span class="kobospan" id="kobo.504.1">toHaveText</span></strong><span class="kobospan" id="kobo.505.1"> ensures that the text does not have to be exactly the</span><a id="_idIndexMarker592" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.506.1"> provided string. </span><span class="kobospan" id="kobo.506.2">In our case, the </span><strong class="bold"><span class="kobospan" id="kobo.507.1">Logout</span></strong><span class="kobospan" id="kobo.508.1"> text is also part of the </span><strong class="source-inline"><span class="kobospan" id="kobo.509.1">&lt;nav&gt;</span></strong><span class="kobospan" id="kobo.510.1"> element, so the full text would be </span><strong class="bold"><span class="kobospan" id="kobo.511.1">Logged in </span></strong><span><strong class="bold"><span class="kobospan" id="kobo.512.1">as testXXXXLogout</span></strong></span><span><span class="kobospan" id="kobo.513.1">.</span></span></p></li> <li class="calibre11"><span class="kobospan" id="kobo.514.1">Run the test either using</span><a id="_idIndexMarker593" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.515.1"> the VS Code extension or by running the </span><strong class="source-inline1"><span class="kobospan" id="kobo.516.1">npx playwright test</span></strong><span class="kobospan" id="kobo.517.1"> command in the Terminal (whichever you prefer), and you will see that it passes </span><span><span class="kobospan" id="kobo.518.1">successfully now!</span></span></li>
</ol>
<p class="callout-heading"><span class="kobospan" id="kobo.519.1">Note</span></p>
<p class="callout"><span class="kobospan" id="kobo.520.1">If the test does not execute successfully, you might have accidentally recorded some additional actions and not cleaned them up properly. </span><span class="kobospan" id="kobo.520.2">Compare your test to the code example provided by this book to make sure the test is properly defined </span><span><span class="kobospan" id="kobo.521.1">and cleaned.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.522.1">Now that we know how defining basic tests works in Playwright, let’s learn about reusable test setups </span><span><span class="kobospan" id="kobo.523.1">using fixtures.</span></span></p>
<h1 id="_idParaDest-183" class="calibre5"><a id="_idTextAnchor184" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.524.1">Reusable test setups using fixtures</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.525.1">After creating the </span><a id="_idIndexMarker594" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.526.1">authentication test, you might be thinking: what if I </span><a id="_idIndexMarker595" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.527.1">want to define a test for creating a new post now? </span><span class="kobospan" id="kobo.527.2">We would have to first sign up, then log in, then create the post. </span><span class="kobospan" id="kobo.527.3">This is quite tedious and the more complex our tests get; the more tedious defining tests would get. </span><span class="kobospan" id="kobo.527.4">Fortunately, Playwright has a solution for these kinds of problems. </span><span class="kobospan" id="kobo.527.5">Playwright introduces a concept called fixtures, which are contexts for the test that can contain reusable functions. </span><span class="kobospan" id="kobo.527.6">For example, we could define an </span><strong class="source-inline"><span class="kobospan" id="kobo.528.1">auth</span></strong><span class="kobospan" id="kobo.529.1"> fixture to provide sign-up and log-in functions to </span><span><span class="kobospan" id="kobo.530.1">all tests.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.531.1">When we used Jest, we were using before/after hooks to prepare the common environment for multiple tests. </span><span class="kobospan" id="kobo.531.2">Fixtures have some advantages over before/after hooks. </span><span class="kobospan" id="kobo.531.3">Mainly, they encapsulate setup and teardown in the same place and are reusable between test files, composable, and more flexible. </span><span class="kobospan" id="kobo.531.4">Additionally, fixtures are provided </span><em class="italic"><span class="kobospan" id="kobo.532.1">on demand</span></em><span class="kobospan" id="kobo.533.1">, which means that Playwright will only set up the fixtures necessary for running a </span><span><span class="kobospan" id="kobo.534.1">certain test.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.535.1">Playwright also includes some fixtures out of the box, which we are going to learn </span><span><span class="kobospan" id="kobo.536.1">about now.</span></span></p>
<h2 id="_idParaDest-184" class="calibre7"><a id="_idTextAnchor185" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.537.1">Overview of built-in fixtures</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.538.1">Playwright comes with some </span><a id="_idIndexMarker596" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.539.1">built-in fixtures, one of which we have already learned about: the </span><strong class="source-inline"><span class="kobospan" id="kobo.540.1">page</span></strong><span class="kobospan" id="kobo.541.1"> fixture. </span><span class="kobospan" id="kobo.541.2">We are now going to briefly introduce the most important built-in fixtures Playwright provides out of </span><span><span class="kobospan" id="kobo.542.1">the box:</span></span></p>
<ul class="calibre10">
<li class="calibre11"><strong class="source-inline1"><span class="kobospan" id="kobo.543.1">browser</span></strong><span class="kobospan" id="kobo.544.1">: Allows controlling browser features, such as opening a </span><span><span class="kobospan" id="kobo.545.1">new page</span></span></li>
<li class="calibre11"><strong class="source-inline1"><span class="kobospan" id="kobo.546.1">browserName</span></strong><span class="kobospan" id="kobo.547.1">: Contains the name of the browser that is currently running </span><span><span class="kobospan" id="kobo.548.1">the test</span></span></li>
<li class="calibre11"><strong class="source-inline1"><span class="kobospan" id="kobo.549.1">page</span></strong><span class="kobospan" id="kobo.550.1">: By far the most important built-in fixture, used to control interactions with the page, visiting URLs, matching elements, doing actions, and </span><span><span class="kobospan" id="kobo.551.1">much more</span></span></li>
<li class="calibre11"><strong class="source-inline1"><span class="kobospan" id="kobo.552.1">context</span></strong><span class="kobospan" id="kobo.553.1">: An isolated context for the current </span><span><span class="kobospan" id="kobo.554.1">test run</span></span></li>
<li class="calibre11"><strong class="source-inline1"><span class="kobospan" id="kobo.555.1">request</span></strong><span class="kobospan" id="kobo.556.1">: Used </span><a id="_idIndexMarker597" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.557.1">to make API requests </span><span><span class="kobospan" id="kobo.558.1">from Playwright</span></span></li>
</ul>
<p class="calibre3"><span class="kobospan" id="kobo.559.1">Now that we have learned about the built-in fixtures Playwright provides, let’s continue by defining our </span><span><span class="kobospan" id="kobo.560.1">own fixture.</span></span></p>
<h2 id="_idParaDest-185" class="calibre7"><a id="_idTextAnchor186" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.561.1">Writing our own fixture</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.562.1">Signing up and logging in are </span><a id="_idIndexMarker598" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.563.1">common actions that we will need to do often in our end-to-end tests, so they are the perfect case for creating a fixture. </span><span class="kobospan" id="kobo.563.2">Follow these steps to create a new </span><span><strong class="source-inline"><span class="kobospan" id="kobo.564.1">auth</span></strong></span><span><span class="kobospan" id="kobo.565.1"> fixture:</span></span></p>
<ol class="calibre15">
<li class="calibre11"><span class="kobospan" id="kobo.566.1">Create a new </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.567.1">tests/fixtures/</span></strong></span><span><span class="kobospan" id="kobo.568.1"> folder.</span></span></li>
<li class="calibre11"><span class="kobospan" id="kobo.569.1">Inside it, create a new </span><strong class="source-inline1"><span class="kobospan" id="kobo.570.1">tests/fixtures/AuthFixture.js</span></strong><span class="kobospan" id="kobo.571.1"> file, where we define an </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.572.1">AuthFixture</span></strong></span><span><span class="kobospan" id="kobo.573.1"> class:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.574.1">
export class AuthFixture {</span></pre></li> <li class="calibre11"><span class="kobospan" id="kobo.575.1">This class will receive the </span><strong class="source-inline1"><span class="kobospan" id="kobo.576.1">page</span></strong><span class="kobospan" id="kobo.577.1"> fixture in </span><span><span class="kobospan" id="kobo.578.1">the constructor:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.579.1">
  constructor(page) {
    this.page = page
  }</span></pre></li> <li class="calibre11"><span class="kobospan" id="kobo.580.1">Define a </span><strong class="source-inline1"><span class="kobospan" id="kobo.581.1">signUpAndLogIn</span></strong><span class="kobospan" id="kobo.582.1"> method, which</span><a id="_idIndexMarker599" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.583.1"> follows the actions from the auth test to generate a unique username, then sign up and log in </span><span><span class="kobospan" id="kobo.584.1">the user:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.585.1">
  async signUpAndLogIn() {
    const testUser = 'test' + Date.now()
    await this.page.goto('/signup')
    await this.page.getByLabel('Username:').fill(testUser)
    await this.page.getByLabel('Password:').fill('password')
    await this.page.getByRole('button', { name: 'Sign Up' }).click()
    await this.page.waitForURL('**/login')
    await this.page.getByLabel('Username:').fill(testUser)
    await this.page.getByLabel('Password:').fill('password')
    await this.page.getByRole('button', { name: 'Log In' }).click()
    await this.page.waitForURL('**/')
    return testUser
  }
}</span></pre></li> <li class="calibre11"><span class="kobospan" id="kobo.586.1">Create a new </span><strong class="source-inline1"><span class="kobospan" id="kobo.587.1">tests/fixtures/index.js</span></strong><span class="kobospan" id="kobo.588.1"> file. </span><span class="kobospan" id="kobo.588.2">Inside it, import the </span><strong class="source-inline1"><span class="kobospan" id="kobo.589.1">test</span></strong><span class="kobospan" id="kobo.590.1"> function from </span><a id="_idIndexMarker600" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.591.1">Playwright (renaming it to </span><strong class="source-inline1"><span class="kobospan" id="kobo.592.1">baseTest</span></strong><span class="kobospan" id="kobo.593.1">) and the </span><strong class="source-inline1"><span class="kobospan" id="kobo.594.1">AuthFixture</span></strong><span class="kobospan" id="kobo.595.1"> we </span><span><span class="kobospan" id="kobo.596.1">just defined:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.597.1">
import { test as baseTest } from '@playwright/test'
import { AuthFixture } from './AuthFixture.js'</span></pre></li> <li class="calibre11"><span class="kobospan" id="kobo.598.1">Then, define and export a new </span><strong class="source-inline1"><span class="kobospan" id="kobo.599.1">test</span></strong><span class="kobospan" id="kobo.600.1"> function, extending the </span><strong class="source-inline1"><span class="kobospan" id="kobo.601.1">baseTest</span></strong><span class="kobospan" id="kobo.602.1"> function from Playwright by defining a new </span><strong class="source-inline1"><span class="kobospan" id="kobo.603.1">auth</span></strong><span class="kobospan" id="kobo.604.1"> fixture </span><span><span class="kobospan" id="kobo.605.1">inside it:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.606.1">
export const test = baseTest.extend({
  auth: async ({ page }, use) =&gt; {
    const authFixture = new AuthFixture(page)
    await use(authFixture)
  },
})</span></pre></li> </ol>
<p class="callout-heading"><span class="kobospan" id="kobo.607.1">Tip</span></p>
<p class="callout"><span class="kobospan" id="kobo.608.1">It is also possible to do additional setup of the fixture context before calling the </span><strong class="source-inline1"><span class="kobospan" id="kobo.609.1">use()</span></strong><span class="kobospan" id="kobo.610.1"> function, and additional breakdown after calling it. </span><span class="kobospan" id="kobo.610.2">This can be used to, for example, create a set of example posts before executing tests and deleting them again afterward. </span><span class="kobospan" id="kobo.610.3">If the backend had a way to delete a user, creating a temporary user and deleting the created username again after using the fixture would be a better option to deal with the issue of </span><span><span class="kobospan" id="kobo.611.1">username collisions.</span></span></p>
<ol class="calibre15">
<li value="7" class="calibre11"><span class="kobospan" id="kobo.612.1">Additionally, re-export the </span><strong class="source-inline1"><span class="kobospan" id="kobo.613.1">expect</span></strong><span class="kobospan" id="kobo.614.1"> function from Playwright to make it easier to import</span><a id="_idIndexMarker601" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.615.1"> from </span><span><span class="kobospan" id="kobo.616.1">our fixtures:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.617.1">
export { expect } from '@playwright/test'</span></pre></li> </ol>
<p class="calibre3"><span class="kobospan" id="kobo.618.1">Now that we have defined our custom fixture, let’s use it while creating a </span><span><span class="kobospan" id="kobo.619.1">new test!</span></span></p>
<h2 id="_idParaDest-186" class="calibre7"><a id="_idTextAnchor187" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.620.1">Using custom fixtures</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.621.1">We are now going to define an </span><a id="_idIndexMarker602" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.622.1">end-to-end test for creating a new post. </span><span class="kobospan" id="kobo.622.2">To create a post, we need to be logged in so we can use our </span><strong class="source-inline"><span class="kobospan" id="kobo.623.1">auth</span></strong><span class="kobospan" id="kobo.624.1"> fixture for preparing the environment. </span><span class="kobospan" id="kobo.624.2">Follow these steps to define the new test and use our </span><span><span class="kobospan" id="kobo.625.1">custom fixture:</span></span></p>
<ol class="calibre15">
<li class="calibre11"><span class="kobospan" id="kobo.626.1">Create a new </span><strong class="source-inline1"><span class="kobospan" id="kobo.627.1">tests/create-post.spec.js</span></strong><span class="kobospan" id="kobo.628.1"> file. </span><span class="kobospan" id="kobo.628.2">To use the custom fixture, we now need to import the </span><strong class="source-inline1"><span class="kobospan" id="kobo.629.1">test</span></strong><span class="kobospan" id="kobo.630.1"> and </span><strong class="source-inline1"><span class="kobospan" id="kobo.631.1">expect</span></strong><span class="kobospan" id="kobo.632.1"> functions from the </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.633.1">fixtures/index.js</span></strong></span><span><span class="kobospan" id="kobo.634.1"> file:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.635.1">
import { test, expect } from './fixtures/index.js'</span></pre></li> <li class="calibre11"><span class="kobospan" id="kobo.636.1">Define a new test to verify that post creation works, using the </span><strong class="source-inline1"><span class="kobospan" id="kobo.637.1">page</span></strong><span class="kobospan" id="kobo.638.1"> and </span><span><strong class="source-inline1"><span class="kobospan" id="kobo.639.1">auth</span></strong></span><span><span class="kobospan" id="kobo.640.1"> fixtures:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.641.1">
test('allows creating a new post', async ({ page, auth }) =&gt; {</span></pre></li> <li class="calibre11"><span class="kobospan" id="kobo.642.1">We can now use the </span><strong class="source-inline1"><span class="kobospan" id="kobo.643.1">signUpAndLogIn</span></strong><span class="kobospan" id="kobo.644.1"> method from our custom </span><strong class="source-inline1"><span class="kobospan" id="kobo.645.1">auth</span></strong><span class="kobospan" id="kobo.646.1"> fixture to create and log in a </span><span><span class="kobospan" id="kobo.647.1">new user:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.648.1">
  const testUser = await auth.signUpAndLogIn()
})</span></pre></li> <li class="calibre11"><span class="kobospan" id="kobo.649.1">We can make use of Playwright code generation again to record our test. </span><span class="kobospan" id="kobo.649.2">First, save the file and execute the </span><strong class="source-inline1"><span class="kobospan" id="kobo.650.1">create-post.spec.js</span></strong><span class="kobospan" id="kobo.651.1"> test with </span><strong class="bold"><span class="kobospan" id="kobo.652.1">Show </span></strong><span><strong class="bold"><span class="kobospan" id="kobo.653.1">browser</span></strong></span><span><span class="kobospan" id="kobo.654.1"> enabled.</span></span></li>
<li class="calibre11"><span class="kobospan" id="kobo.655.1">Then, create a new line after the </span><strong class="source-inline1"><span class="kobospan" id="kobo.656.1">auth.signUpAndLogIn</span></strong><span class="kobospan" id="kobo.657.1"> function is called and press </span><strong class="bold"><span class="kobospan" id="kobo.658.1">Record </span></strong><span><strong class="bold"><span class="kobospan" id="kobo.659.1">at cursor</span></strong></span><span><span class="kobospan" id="kobo.660.1">.</span></span></li>
<li class="calibre11"><span class="kobospan" id="kobo.661.1">Now we can record actions from the already opened browser window (which is also already logged in, because the fixture methods were called already!). </span><span class="kobospan" id="kobo.661.2">Click into the title field and enter </span><strong class="source-inline1"><span class="kobospan" id="kobo.662.1">Test Post</span></strong><span class="kobospan" id="kobo.663.1"> as the post title, then press </span><em class="italic"><span class="kobospan" id="kobo.664.1">Tab</span></em><span class="kobospan" id="kobo.665.1"> to go to the next field, enter </span><strong class="source-inline1"><span class="kobospan" id="kobo.666.1">Hello World!</span></strong><span class="kobospan" id="kobo.667.1"> as the post content, then press </span><em class="italic"><span class="kobospan" id="kobo.668.1">Tab</span></em><span class="kobospan" id="kobo.669.1"> again and press </span><em class="italic"><span class="kobospan" id="kobo.670.1">Return/Enter</span></em><span class="kobospan" id="kobo.671.1"> to create a </span><span><span class="kobospan" id="kobo.672.1">new post.</span></span></li>
</ol>
<p class="callout-heading"><span class="kobospan" id="kobo.673.1">Note</span></p>
<p class="callout"><span class="kobospan" id="kobo.674.1">The post does not actually get created, because Playwright closes the backend right after it finishes running it, so at the time of recording, the backend is already shut down. </span><span class="kobospan" id="kobo.674.2">If you want to record with the backend running, explore the </span><strong class="source-inline1"><span class="kobospan" id="kobo.675.1">webServer.reuseExistingServer</span></strong><span class="kobospan" id="kobo.676.1"> setting </span><span><span class="kobospan" id="kobo.677.1">in </span></span><span><strong class="source-inline1"><span class="kobospan" id="kobo.678.1">playwright.config.js</span></strong></span><span><span class="kobospan" id="kobo.679.1">.</span></span></p>
<ol class="calibre15">
<li value="7" class="calibre11"><span class="kobospan" id="kobo.680.1">Go back to</span><a id="_idIndexMarker603" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.681.1"> the file, and you will see that all actions were properly recorded! </span><span class="kobospan" id="kobo.681.2">The following code should have </span><span><span class="kobospan" id="kobo.682.1">been recorded:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.683.1">
  await page.getByLabel('Title:').click()
  await page.getByLabel('Title:').fill('Test Post')
  await page.getByLabel('Title:').press('Tab')
  await page.locator('textarea').fill('Hello World!')
  await page.locator('textarea').press('Tab')
  await page.getByRole('button', { name: 'Create' }).press('Enter')</span></pre></li> <li class="calibre11"><span class="kobospan" id="kobo.684.1">Now, we just need to add a check whether the post was </span><span><span class="kobospan" id="kobo.685.1">created successfully:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.686.1">
  await expect(page.getByText(`Test PostWritten by ${testUser}`)).toBeVisible()
})</span></pre><p class="calibre3"><span class="kobospan" id="kobo.687.1">As we are controlling the test environment, it is enough to check that the text </span><strong class="bold"><span class="kobospan" id="kobo.688.1">Test PostWritten by testXXX</span></strong><span class="kobospan" id="kobo.689.1"> (without a space between “Post” and “Written”) is visible on the page. </span><span class="kobospan" id="kobo.689.2">This will tell us that the post was created in </span><span><span class="kobospan" id="kobo.690.1">the list.</span></span></p></li> <li class="calibre11"><span class="kobospan" id="kobo.691.1">Run the </span><a id="_idIndexMarker604" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.692.1">test, and you will see that it </span><span><span class="kobospan" id="kobo.693.1">passes successfully!</span></span></li>
</ol>
<p class="calibre3"><span class="kobospan" id="kobo.694.1">We could create additional fixtures for handling posts (creating, editing, deleting) and use these to, for example, verify that the link to a single post works properly and adjusts the title accordingly. </span><span class="kobospan" id="kobo.694.2">However, extending end-to-end tests like that is similar to what we have already done and is thus left as an exercise </span><span><span class="kobospan" id="kobo.695.1">for you.</span></span></p>
<h1 id="_idParaDest-187" class="calibre5"><a id="_idTextAnchor188" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.696.1">Viewing test reports and running in CI</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.697.1">After successfully creating some end-to-end tests for our blog application, let’s wrap up the chapter by learning how to view HTML test reports and how to run Playwright </span><span><span class="kobospan" id="kobo.698.1">in CI.</span></span></p>
<h2 id="_idParaDest-188" class="calibre7"><a id="_idTextAnchor189" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.699.1">Viewing an HTML report</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.700.1">Playwright automatically </span><a id="_idIndexMarker605" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.701.1">generates HTML reports of test runs. </span><span class="kobospan" id="kobo.701.2">We can generate these by executing the following command to run </span><span><span class="kobospan" id="kobo.702.1">all tests:</span></span></p>
<pre class="console"><span class="kobospan1" id="kobo.703.1">
$ npx playwright test</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.704.1">Then, run the following command to serve and view the HTML report of the </span><span><span class="kobospan" id="kobo.705.1">last run:</span></span></p>
<pre class="console"><span class="kobospan1" id="kobo.706.1">
$ npx playwright show-report</span></pre> <p class="calibre3"><span class="kobospan" id="kobo.707.1">The report should open in a new browser window, and look </span><span><span class="kobospan" id="kobo.708.1">as follows:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer093">
<span class="kobospan" id="kobo.709.1"><img alt="Figure 9.5 – An HTML test report generated by Playwright" src="image/B19385_09_5.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.710.1">Figure 9.5 – An HTML test report generated by Playwright</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.711.1">As we can see, our</span><a id="_idIndexMarker606" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.712.1"> three tests were successfully run on all three browsers. </span><span class="kobospan" id="kobo.712.2">Click on one of the test runs to view all executed test steps </span><span><span class="kobospan" id="kobo.713.1">in detail.</span></span></p>
<h2 id="_idParaDest-189" class="calibre7"><a id="_idTextAnchor190" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.714.1">Running Playwright tests in CI</span></h2>
<p class="calibre3"><span class="kobospan" id="kobo.715.1">When we initialized </span><a id="_idIndexMarker607" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.716.1">Playwright, we were asked if we want to generate a </span><a id="_idIndexMarker608" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.717.1">GitHub Actions CI file. </span><span class="kobospan" id="kobo.717.2">We agreed, so Playwright automatically generated a CI configuration for us in the </span><strong class="source-inline"><span class="kobospan" id="kobo.718.1">.github/workflows/playwright.yml</span></strong><span class="kobospan" id="kobo.719.1"> file. </span><span class="kobospan" id="kobo.719.2">This workflow checks out the repository, installs all dependencies, installs Playwright browsers, runs all Playwright tests, and then uploads the report as an artifact so it can be viewed from the CI run. </span><span class="kobospan" id="kobo.719.3">We still need to adjust the CI workflow to also install dependencies for our backend, so let’s do </span><span><span class="kobospan" id="kobo.720.1">that now:</span></span></p>
<ol class="calibre15">
<li class="calibre11"><span class="kobospan" id="kobo.721.1">Edit </span><strong class="source-inline1"><span class="kobospan" id="kobo.722.1">.github/workflows/playwright.yml</span></strong><span class="kobospan" id="kobo.723.1"> and add the following step </span><span><span class="kobospan" id="kobo.724.1">to it:</span></span><pre class="source-code"><span class="kobospan1" id="kobo.725.1">
      - name: Install dependencies
        run: npm ci
</span><strong class="bold1"><span class="kobospan1" id="kobo.726.1">      - name: Install backend dependencies</span></strong>
<strong class="bold1"><span class="kobospan1" id="kobo.727.1">        run: cd backend/ &amp;&amp; npm ci</span></strong></pre><p class="calibre3"><span class="kobospan" id="kobo.728.1">The </span><strong class="source-inline"><span class="kobospan" id="kobo.729.1">npm ci</span></strong><span class="kobospan" id="kobo.730.1"> command ensures that the project already has a </span><strong class="source-inline"><span class="kobospan" id="kobo.731.1">package-lock.json</span></strong><span class="kobospan" id="kobo.732.1"> file and does not write a lock file, ensuring a clean state for CI to </span><span><span class="kobospan" id="kobo.733.1">run on.</span></span></p></li> <li class="calibre11"><span class="kobospan" id="kobo.734.1">Add, commit, and push everything to a GitHub repository to see Playwright running </span><span><span class="kobospan" id="kobo.735.1">in CI.</span></span></li>
</ol>
<p class="callout-heading"><span class="kobospan" id="kobo.736.1">Note</span></p>
<p class="callout"><span class="kobospan" id="kobo.737.1">Make sure to create a new repository from just the contents of the </span><strong class="source-inline1"><span class="kobospan" id="kobo.738.1">ch9</span></strong><span class="kobospan" id="kobo.739.1"> folder (not the whole </span><strong class="source-inline1"><span class="kobospan" id="kobo.740.1">Full-Stack-React-Projects</span></strong><span class="kobospan" id="kobo.741.1"> folder!), otherwise GitHub Actions will not detect the </span><strong class="source-inline1"><span class="kobospan" id="kobo.742.1">.</span></strong><span><strong class="source-inline1"><span class="kobospan" id="kobo.743.1">github</span></strong></span><span><span class="kobospan" id="kobo.744.1"> folder.</span></span></p>
<ol class="calibre15">
<li value="3" class="calibre11"><span class="kobospan" id="kobo.745.1">Go to GitHub, click on the </span><strong class="bold"><span class="kobospan" id="kobo.746.1">Actions</span></strong><span class="kobospan" id="kobo.747.1"> tab, select the </span><strong class="bold"><span class="kobospan" id="kobo.748.1">Playwright Tests</span></strong><span class="kobospan" id="kobo.749.1"> workflow on the sidebar, and then click on the latest </span><span><span class="kobospan" id="kobo.750.1">workflow run.</span></span></li>
<li class="calibre11"><span class="kobospan" id="kobo.751.1">At the</span><a id="_idIndexMarker609" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.752.1"> bottom of the run, there is an </span><strong class="bold"><span class="kobospan" id="kobo.753.1">Artifacts</span></strong><span class="kobospan" id="kobo.754.1"> section, which</span><a id="_idIndexMarker610" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.755.1"> contains a </span><strong class="source-inline1"><span class="kobospan" id="kobo.756.1">playwright-report</span></strong><span class="kobospan" id="kobo.757.1"> object that can be downloaded to view the </span><span><span class="kobospan" id="kobo.758.1">HTML report.</span></span></li>
</ol>
<p class="calibre3"><span class="kobospan" id="kobo.759.1">The following screenshot shows the Playwright tests running in GitHub Actions, with the report provided as </span><span><span class="kobospan" id="kobo.760.1">an artifact:</span></span></p>
<div class="calibre2">
<div class="img---figure" id="_idContainer094">
<span class="kobospan" id="kobo.761.1"><img alt="Figure 9.6 – Playwright running in GitHub Actions" src="image/B19385_09_6.jpg" class="calibre4"/></span>
</div>
</div>
<p class="img---caption" lang="en-US" xml:lang="en-US"><span class="kobospan" id="kobo.762.1">Figure 9.6 – Playwright running in GitHub Actions</span></p>
<p class="calibre3"><span class="kobospan" id="kobo.763.1">As we </span><a id="_idIndexMarker611" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.764.1">can see, running Playwright in CI by using the provided</span><a id="_idIndexMarker612" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.765.1"> template is simple </span><span><span class="kobospan" id="kobo.766.1">and straightforward.</span></span></p>
<h1 id="_idParaDest-190" class="calibre5"><a id="_idTextAnchor191" class="calibre6 pcalibre1 pcalibre"/><span class="kobospan" id="kobo.767.1">Summary</span></h1>
<p class="calibre3"><span class="kobospan" id="kobo.768.1">In this chapter, we learned about using Playwright for end-to-end testing. </span><span class="kobospan" id="kobo.768.2">We first set up Playwright in our project and prepared our backend for end-to-end testing. </span><span class="kobospan" id="kobo.768.3">Then, we wrote and ran our first test. </span><span class="kobospan" id="kobo.768.4">Next, we learned about fixtures to make reusable test contexts. </span><span class="kobospan" id="kobo.768.5">Finally, we viewed the generated HTML report and set up CI to run Playwright, generate a report, and save it as an artifact in </span><span><span class="kobospan" id="kobo.769.1">the pipeline.</span></span></p>
<p class="calibre3"><span class="kobospan" id="kobo.770.1">In the next chapter, </span><a href="B19385_10.xhtml#_idTextAnchor192" class="calibre6 pcalibre1 pcalibre"><span><em class="italic"><span class="kobospan" id="kobo.771.1">Chapter 10</span></em></span></a><em class="italic"><span class="kobospan" id="kobo.772.1">, Aggregating and Visualizing Statistics Using MongoDB and Victory</span></em><span class="kobospan" id="kobo.773.1">, we are going to learn how to aggregate data using MongoDB and expose this aggregated data via a backend. </span><span class="kobospan" id="kobo.773.2">Then, we are going to consume the aggregated data in the frontend and visualize it using Victory with various </span><span><span class="kobospan" id="kobo.774.1">visualization types.</span></span></p>
</div>
</body></html>