<html><head></head><body>
		<div id="_idContainer025">
			<h1 id="_idParaDest-48"><em class="italic"><a id="_idTextAnchor052"/>Chapter 4</em>: Building a Server-Side-Rendered Community Feed Using Next.js</h1>
			<p>So far, you've learned how React applications are typically <strong class="bold">Single-Page Applications</strong> (<strong class="bold">SPAs</strong>) and can be kickstarted using Create React App. This means the application is rendered on the client side, making it load in the browser when the user visits your application. But did you know React also supports <strong class="bold">Server-Side Rendering</strong> (<strong class="bold">SSR</strong>), as you might remember from back in the old days when code only rendered from a server?</p>
			<p>In this chapter, you'll learn how to create an application that has components dynamically loaded from the server instead of the browser. To enable SSR, we'll be using Next.js instead of Create React App. Next.js is a framework for React applications and adds additional features to React. If you're interested in <strong class="bold">Search Engine Optimization</strong> (<strong class="bold">SEO</strong>), SSR comes with the advantage that we can add metadata to the application so it can be better indexed by search engines.</p>
			<p>The following topics will be covered in this chapter:</p>
			<ul>
				<li>Setting up Next.js</li>
				<li>Server-side rendering</li>
				<li>SEO in React</li>
			</ul>
			<h1 id="_idParaDest-49"><a id="_idTextAnchor053"/>Project overview</h1>
			<p>In this chapter, we <a id="_idIndexMarker169"/>will create a community <a id="_idIndexMarker170"/>feed application using Next.js that supports SSR and therefore is loaded from the server rather than the browser. Also, the application is optimized for search engines.</p>
			<p>The build time is 2 hours.</p>
			<h1 id="_idParaDest-50"><a id="_idTextAnchor054"/>Getting started</h1>
			<p>The complete source code can also be found on GitHub: <a href="https://github.com/PacktPublishing/React-Projects-Second-Edition/tree/main/Chapter04">https://github.com/PacktPublishing/React-Projects-Second-Edition/tree/main/Chapter04</a>. Also, this project uses the publicly available Stack Overflow API to fill the application <a id="_idIndexMarker171"/>with data. This is done by fetching questions that are <a id="_idIndexMarker172"/>posted to Stack Overflow. More information about this API can be found at: <a href="https://api.stackexchange.com/docs/">https://api.stackexchange.com/docs/</a>.</p>
			<h1 id="_idParaDest-51"><a id="_idTextAnchor055"/>Community feed application</h1>
			<p>In this section, you'll build a community feed application with Next.js that supports SSR. Next.js goes <a id="_idIndexMarker173"/>beyond the functionalities of Create React App, by delivering a framework to build React applications quickly. It has built-in features for routing, SEO, SSR, and much more, as you'll learn in this chapter. In this community feed, you can see an overview of recent questions on Stack Overflow that have the <strong class="source-inline">reactjs</strong> tag, and you can click on them to see more information and the answers. </p>
			<h1 id="_idParaDest-52"><a id="_idTextAnchor056"/>Setting up Next.js</h1>
			<p>In previous chapters, we used Create React App to run a React application. Although Create React App <a id="_idIndexMarker174"/>is a good starting point for most React applications, it doesn't support SSR. Luckily, Next.js does offer this feature as it's considered a framework for React. In this chapter, we'll be using the latest stable version of Next.js, which is version 12.</p>
			<h2 id="_idParaDest-53"><a id="_idTextAnchor057"/>Installing Next.js</h2>
			<p>To set <a id="_idIndexMarker175"/>up Next.js, we run the following command:</p>
			<p class="source-code">npx create-next-app chapter-4</p>
			<p>You'll be asked to select a template, which is either the default starter app or a template that is created by the community. After selecting the default template, the <strong class="source-inline">react</strong>, <strong class="source-inline">react-dom</strong>, and <strong class="source-inline">next</strong> libraries will be installed, among others.</p>
			<p>After the installation is finished, we can move into the new <strong class="source-inline">chapter-4</strong> directory and run the following command:</p>
			<p class="source-code">npm run dev</p>
			<p>This will start the new Next.js application that will become available at <strong class="source-inline">http://localhost:3000</strong>. The default starter app will look something like the following application:</p>
			<div>
				<div id="_idContainer020" class="IMG---Figure">
					<img src="image/Figure_4.1_B17390.jpg" alt="Figure 4.1 – The initial Next.js application"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.1 – The initial Next.js application</p>
			<p>In this <a id="_idIndexMarker176"/>application, you can not only see what a Next.js application looks like but also find useful links to more sources to learn about Next.js and examples of how to deploy it.</p>
			<p>The application structure for a Next.js project is slightly different from how we structured our Create React App in the preceding chapters:</p>
			<p class="source-code">chapter-4</p>
			<p class="source-code">  |- package.json</p>
			<p class="source-code">  |- node_modules</p>
			<p class="source-code">  |- public</p>
			<p class="source-code">  |- pages</p>
			<p class="source-code">     |- api</p>
			<p class="source-code">        |- hello.js</p>
			<p class="source-code">     |- _app.js</p>
			<p class="source-code">     |- index.js</p>
			<p class="source-code">  |- styles</p>
			<p class="source-code">     |- globals.css</p>
			<p class="source-code">     |- Home.module.css</p>
			<p class="source-code"> </p>
			<p>In the preceding structure, you can see that there is again a directory called <strong class="source-inline">pages</strong> that will contain React components that will serve as a page. But different from Create React App, we don't <a id="_idIndexMarker177"/>need to set up <strong class="source-inline">react-router</strong> to serve the pages. Instead, Next.js automatically renders every component in that directory as a page. In this directory, we also find the <strong class="source-inline">hello.js</strong> file in the <strong class="source-inline">api</strong> directory. Next.js can also be used to create API endpoints, which we'll explore more in <a href="B17390_07_Final_NM_ePub.xhtml#_idTextAnchor090"><em class="italic">Chapter 7</em></a>, <em class="italic">Build a Full Stack E-Commerce Application with Next.js and GraphQL</em>. Also, the CSS files for our components are put in the <strong class="source-inline">styles</strong> directory, where you'll find the <strong class="source-inline">globals.css</strong> file with global styling and <strong class="source-inline">Home.module.css</strong> with styling for a specific component.</p>
			<h2 id="_idParaDest-54"><a id="_idTextAnchor058"/>Adding styled-components</h2>
			<p>Before we <a id="_idIndexMarker178"/>set up the routing, let's add <strong class="source-inline">styled-components</strong> to the project, which we've also used in the previous chapters. For this, we need to install <strong class="source-inline">styled-components</strong> by running the following commands:</p>
			<p class="source-code">npm install styled-components</p>
			<p>This will add the packages to our project so we can use them to create and style reusable components.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">Next.js uses the <strong class="source-inline">styles</strong> directory to store global and component-specific CSS files for styling. As we're using <strong class="source-inline">styled-components</strong> for styling instead, we don't have to add any new CSS files to this directory. If you're not using a library for styling with CSS-in-JS, you can place both global and component-level styling files in the <strong class="source-inline">styles</strong> directory instead.</p>
			<p>Setting up <strong class="source-inline">styled-components</strong> in Next.js <a id="_idIndexMarker179"/>is done slightly differently in comparison to Create React App:</p>
			<ol>
				<li>In Next.js, a <strong class="source-inline">Document</strong> component wraps the <strong class="source-inline">html</strong>, <strong class="source-inline">body</strong>, and <strong class="source-inline">head</strong> tags and runs them through a so-called <strong class="source-inline">renderPage</strong> method to allow for SSR. We need to overwrite this <strong class="source-inline">Document</strong> component from a new file called <strong class="source-inline">_document.js</strong> in the <strong class="source-inline">pages</strong> folder:<p class="source-code">import Document from 'next/document';</p><p class="source-code">import { ServerStyleSheet } from 'styled-components';</p><p class="source-code">export default class MyDocument extends Document {</p><p class="source-code">  static async getInitialProps(ctx) {</p><p class="source-code">    const sheet = new ServerStyleSheet();</p><p class="source-code">    const originalRenderPage = ctx.renderPage;</p><p class="source-code">    try {</p><p class="source-code">      ctx.renderPage = () =&gt;</p><p class="source-code">        originalRenderPage({</p><p class="source-code">          enhanceApp: (App) =&gt; (props) =&gt;</p><p class="source-code">            sheet.collectStyles(&lt;App {...props} /&gt;),</p><p class="source-code">        });</p><p class="source-code">      const initialProps = </p><p class="source-code">        await Document.getInitialProps(ctx);</p><p class="source-code">      return {</p><p class="source-code">        ...initialProps,</p><p class="source-code">        styles: (</p><p class="source-code">          &lt;&gt;</p><p class="source-code">            {initialProps.styles}</p><p class="source-code">            {sheet.getStyleElement()}</p><p class="source-code">          &lt;/&gt;</p><p class="source-code">        ),</p><p class="source-code">      };</p><p class="source-code">    } finally {</p><p class="source-code">      sheet.seal();</p><p class="source-code">    }</p><p class="source-code">  }</p><p class="source-code">}</p></li>
			</ol>
			<p>The preceding <a id="_idIndexMarker180"/>code creates an instance of <strong class="source-inline">ServerStyleSheet</strong>, which <strong class="source-inline">styled-components</strong> uses to retrieve any styles found in all the components in our application. This is needed to create a stylesheet that can be injected into our server-side-rendered application later on. The <strong class="source-inline">sheets.collectStyles</strong> method collects all of the styles from our components, while <strong class="source-inline">sheets.getElement()</strong> generates the <strong class="source-inline">style</strong> tag, which we'll need to return as a prop called <strong class="source-inline">styles</strong>.</p>
			<ol>
				<li value="2">To support SSR for <strong class="source-inline">styled-components</strong>, we also need to configure the <strong class="source-inline">next.config.json</strong> file in the root of the project. This file needs to hold the following configuration:<p class="source-code">const nextConfig = {</p><p class="source-code">    reactStrictMode: true,</p><p class="source-code">+   compiler: {</p><p class="source-code">+     styledComponents: true</p><p class="source-code">+   }</p><p class="source-code">}</p><p class="source-code">module.exports = nextConfig</p></li>
				<li>As with Next.js, we don't have a global entry file for the application. We need a different place to add our global styling and components that we want to display on <a id="_idIndexMarker181"/>all pages, such as a header. These styling and component must be added to <strong class="source-inline">_app.js</strong> in our <strong class="source-inline">pages</strong> directory, which returns the component for the page that we're currently visiting and any other component or styling that we return:<p class="source-code"><strong class="bold">- import '../styles/globals.css';</strong></p><p class="source-code"><strong class="bold">+ import { createGlobalStyle } from 'styled-components';</strong></p><p class="source-code"><strong class="bold">+ const GlobalStyle = createGlobalStyle' </strong></p><p class="source-code"><strong class="bold">+   body { </strong></p><p class="source-code"><strong class="bold">+     margin: 0; </strong></p><p class="source-code"><strong class="bold">+     padding: 0; </strong></p><p class="source-code"><strong class="bold">+     font-family: -apple-system, BlinkMacSystemFont,</strong></p><p class="source-code"><strong class="bold">        "Segoe UI", "Roboto", "Oxygen","Ubuntu",  </strong></p><p class="source-code"><strong class="bold">        "Cantarell", "Fira Sans", "Droid Sans",</strong></p><p class="source-code"><strong class="bold">        "Helvetica Neue", sans-serif;  </strong></p><p class="source-code"><strong class="bold">+     -webkit-font-smoothing: antialiased; </strong></p><p class="source-code"><strong class="bold">+     -moz-osx-font-smoothing: grayscale; </strong></p><p class="source-code"><strong class="bold">+   } </strong></p><p class="source-code"><strong class="bold">+ ';</strong></p><p class="source-code">  function MyApp({ Component, pageProps }) {</p><p class="source-code"><strong class="bold">-   return &lt;Component {...pageProps} /&gt;;</strong></p><p class="source-code"><strong class="bold">+   return (</strong></p><p class="source-code"><strong class="bold">+     &lt;&gt;</strong></p><p class="source-code"><strong class="bold">+       &lt;GlobalStyle /&gt;</strong></p><p class="source-code"><strong class="bold">+       &lt;Component {...pageProps} /&gt;</strong></p><p class="source-code"><strong class="bold">+     &lt;/&gt;</strong></p><p class="source-code"><strong class="bold">+   );</strong></p><p class="source-code">  }</p><p class="source-code">  export default MyApp;</p></li>
			</ol>
			<p>In the preceding file, we've deleted the line that imports the <strong class="source-inline">styles/globals.css</strong> file and <a id="_idIndexMarker182"/>replaced it with styling in <strong class="source-inline">styled-components</strong>. This means you can also safely delete the <strong class="source-inline">globals.css</strong> file from the <strong class="source-inline">styles</strong> directory.</p>
			<ol>
				<li value="4">This global styling is now present on all pages that we'll create later in this Next.js application. But for starters, let's create a <strong class="source-inline">Header</strong> component by adding a file called <strong class="source-inline">Header.js</strong> in a new directory called <strong class="source-inline">components</strong>:<p class="source-code">import styled from 'styled-components';</p><p class="source-code">const HeaderWrapper = styled.div'</p><p class="source-code">  background-color: orange;</p><p class="source-code">  height: 100%;</p><p class="source-code">  display: flex;</p><p class="source-code">  flex-direction: column;</p><p class="source-code">  align-items: center;</p><p class="source-code">  justify-content: center;</p><p class="source-code">  font-size: calc(10px + 2vmin);</p><p class="source-code">  color: white;</p><p class="source-code">';</p><p class="source-code">const Title = styled.h1'</p><p class="source-code">  height: 64px;</p><p class="source-code">  pointer-events: none;</p><p class="source-code">';</p><p class="source-code">function Header() {</p><p class="source-code">  return (</p><p class="source-code">    &lt;HeaderWrapper&gt;</p><p class="source-code">      &lt;Title&gt;Community Feed&lt;/Title&gt;</p><p class="source-code">    &lt;/HeaderWrapper&gt;</p><p class="source-code">  );</p><p class="source-code">}</p><p class="source-code">export default Header;</p></li>
				<li>This <a id="_idIndexMarker183"/>component will return a header that will be used on every page, but we also need to add it to <strong class="source-inline">_app.js</strong> to be effective:<p class="source-code">  import { createGlobalStyle } from </p><p class="source-code">    'styled-components';</p><p class="source-code"><strong class="bold">+ import Header from '../components/Header';</strong></p><p class="source-code">  // ...</p><p class="source-code">  function MyApp({ Component, pageProps }) {</p><p class="source-code">    return (</p><p class="source-code">      &lt;&gt;</p><p class="source-code">        &lt;GlobalStyle /&gt;</p><p class="source-code"><strong class="bold">+       &lt;Header /&gt;</strong></p><p class="source-code">        &lt;Component {...pageProps} /&gt;</p><p class="source-code">      &lt;/&gt;</p><p class="source-code">    );</p><p class="source-code">  }</p><p class="source-code">  export default MyApp;</p></li>
			</ol>
			<p>You'll <a id="_idIndexMarker184"/>see what the headers look like in the next section when we add our first route to the application. </p>
			<p>We've added multiple new files that have global styling with <strong class="source-inline">styled-components</strong>, which supports SSR, and also a directory that holds reusable components.</p>
			<p>With both Next.js and <strong class="source-inline">styled-components</strong> set up, we are ready to start developing with Next.js in the next section of this chapter.</p>
			<h1 id="_idParaDest-55"><a id="_idTextAnchor059"/>Routing with Next.js</h1>
			<p>With the <strong class="source-inline">react-router</strong> package, we can add declarative routing to any React application, but you <a id="_idIndexMarker185"/>need to set up components that define which routes you want to add. With Next.js, the filesystem is being used for routing, starting at the <strong class="source-inline">pages</strong> directory. Every file and directory in <strong class="source-inline">pages</strong> can represent a route. You can check this by visiting the project at <strong class="source-inline">http://localhost:3000</strong>, where the contents of <strong class="source-inline">index.js</strong> are being rendered.</p>
			<p>If we, for example, wanted to add the new <strong class="source-inline">/questions</strong> route to the application, we'd need to create either a new file called <strong class="source-inline">questions.js</strong> or a directory called <strong class="source-inline">questions</strong> with an <strong class="source-inline">index.js</strong> file in <strong class="source-inline">pages</strong>. Let's go with the second option and add the following code to this file:</p>
			<p class="source-code">import styled from 'styled-components';</p>
			<p class="source-code">const QuestionsContainer = styled.div'</p>
			<p class="source-code">  display: flex;</p>
			<p class="source-code">  justify-content: space-between;</p>
			<p class="source-code">  flex-direction: column;</p>
			<p class="source-code">  margin: 5%;</p>
			<p class="source-code">';</p>
			<p class="source-code">function Questions() {</p>
			<p class="source-code">  return (</p>
			<p class="source-code">    &lt;QuestionsContainer&gt;</p>
			<p class="source-code">      &lt;h2&gt;Questions&lt;/h2&gt;</p>
			<p class="source-code">    &lt;/QuestionsContainer&gt;</p>
			<p class="source-code">  );</p>
			<p class="source-code">}</p>
			<p class="source-code">export default Questions;</p>
			<p>This new route has now become available at <strong class="source-inline">http://localhost:3000/questions</strong> where only a title is being rendered. As mentioned in the introduction of this chapter, we'll be using the Stack Overflow API to get the data for this application. </p>
			<p>Before retrieving the data from the endpoint, we also need to create a component to render this data in. To do so, we need to create a new component that will be used to display a question. This <a id="_idIndexMarker186"/>new component can be created in a file called <strong class="source-inline">Card.js</strong> in the <strong class="source-inline">components</strong> directory with the following contents:</p>
			<p class="source-code">import styled from 'styled-components';</p>
			<p class="source-code">const CardWrapper = styled.div'</p>
			<p class="source-code">  text-align: left;</p>
			<p class="source-code">  padding: 1%;</p>
			<p class="source-code">  background: lightGray;</p>
			<p class="source-code">  border-radius: 5px;</p>
			<p class="source-code">  margin-bottom: 2%;</p>
			<p class="source-code">';</p>
			<p class="source-code">const Title = styled.h2'</p>
			<p class="source-code">  width: 100%;</p>
			<p class="source-code">  padding-bottom: 10px;</p>
			<p class="source-code">  text-align: center;</p>
			<p class="source-code">  border-bottom: 1px solid darkGray;</p>
			<p class="source-code">  color: black;</p>
			<p class="source-code">';</p>
			<p class="source-code">const Count = styled.span'</p>
			<p class="source-code">  color: darkGray;</p>
			<p class="source-code">';</p>
			<p class="source-code">function Card({ title, views, answers }) {</p>
			<p class="source-code">  return (</p>
			<p class="source-code">    &lt;CardWrapper&gt;</p>
			<p class="source-code">      &lt;Title&gt;{title}&lt;/Title&gt;</p>
			<p class="source-code">      &lt;Count&gt;{</p>
			<p class="source-code">        'Views: ${views} | Answers: ${answers}'}</p>
			<p class="source-code">      &lt;/Count&gt;</p>
			<p class="source-code">    &lt;/CardWrapper&gt;</p>
			<p class="source-code">  );</p>
			<p class="source-code">}</p>
			<p class="source-code">export default Card;</p>
			<p>With this <a id="_idIndexMarker187"/>component in place, let's retrieve the data from the Stack Overflow API. From this API, we want to retrieve all the questions that are posted with the <strong class="source-inline">reactjs</strong> tag, using the following endpoint:</p>
			<p class="source-code">https://api.stackexchange.com/2.2/questions?order=desc&amp;sort=hot&amp;tagged=reactjs&amp;site=stackoverflow</p>
			<p>You can find more information on this at <a href="https://api.stackexchange.com/docs/questions#order=desc&amp;sort=hot&amp;tagged=reactjs&amp;filter=default&amp;site=stackoverflow&amp;run=true">https://api.stackexchange.com/docs/questions#order=desc&amp;sort=hot&amp;tagged=reactjs&amp;filter=default&amp;site=stackoverflow&amp;run=true</a>.</p>
			<p>This returns an array of objects under the <strong class="source-inline">items</strong> field, and from every object, we can get information about a question, such as the title and the number of answers. </p>
			<p>We can retrieve the data from this endpoint and display it on the <strong class="source-inline">/questions</strong> route by making some additions to the <strong class="source-inline">index.js</strong> file in the <strong class="source-inline">questions</strong> directory in <strong class="source-inline">pages</strong>:</p>
			<ol>
				<li value="1">First, we need <a id="_idIndexMarker188"/>to add local state variables to the <strong class="source-inline">Questions</strong> component and add a <strong class="source-inline">useEffect</strong> Hook to fetch the data from the Stack Overflow API:<p class="source-code"><strong class="bold">+ import { useState, useEffect } from 'react';</strong></p><p class="source-code">  import styled from 'styled-components';</p><p class="source-code"><strong class="bold">+ import Card from '../ ../ components/Card';</strong></p><p class="source-code">  function Questions() {</p><p class="source-code"><strong class="bold">+   const [loading, setLoading] = useState(false);</strong></p><p class="source-code"><strong class="bold">+   const [questions, setQuestions] = useState([]);</strong></p><p class="source-code"><strong class="bold">+   useEffect(() =&gt; {</strong></p><p class="source-code"><strong class="bold">+     async function fetchData() {</strong></p><p class="source-code"><strong class="bold">+       const data = await fetch(</strong></p><p class="source-code"><strong class="bold">         'https://api.stackexchange.com/2.2/questions?</strong></p><p class="source-code"><strong class="bold">          order=desc&amp;sort=hot&amp;tagged=reactjs&amp;</strong></p><p class="source-code"><strong class="bold">          site=stackoverflow');</strong></p><p class="source-code"><strong class="bold">+       const result = await data.json();</strong></p><p class="source-code"><strong class="bold">+       if (result) {</strong></p><p class="source-code"><strong class="bold">+         setQuestions(result.items);</strong></p><p class="source-code"><strong class="bold">+         setLoading(false);</strong></p><p class="source-code"><strong class="bold">+       }</strong></p><p class="source-code"><strong class="bold">+     }</strong></p><p class="source-code"><strong class="bold">+     fetchData();</strong></p><p class="source-code"><strong class="bold">+   }, []);</strong></p><p class="source-code">  return (</p><p class="source-code">    // ...</p></li>
				<li>After adding the data fetching logic, we need to add some more code to display the fields <a id="_idIndexMarker189"/>from the API on our page. We're passing this data to our <strong class="source-inline">Card</strong> component to render it on the page:<p class="source-code">  // ...</p><p class="source-code">    return (</p><p class="source-code">      &lt;QuestionsContainer&gt;</p><p class="source-code">        &lt;h2&gt;Questions&lt;/h2&gt;</p><p class="source-code"><strong class="bold">+       {loading ? (</strong></p><p class="source-code"><strong class="bold">+         &lt;span&gt;Loading...&lt;/span&gt;</strong></p><p class="source-code"><strong class="bold">+        ) : (</strong></p><p class="source-code"><strong class="bold">+         &lt;div&gt;</strong></p><p class="source-code"><strong class="bold">+             {questions.map((question) =&gt; (</strong></p><p class="source-code"><strong class="bold">+               &lt;Card</strong></p><p class="source-code"><strong class="bold">+                 key={question.question_id}</strong></p><p class="source-code"><strong class="bold">+                 title={question.title}</strong></p><p class="source-code"><strong class="bold">+                 views={question.view_count}</strong></p><p class="source-code"><strong class="bold">+                 answers={question.answer_count}</strong></p><p class="source-code"><strong class="bold">+               /&gt;</strong></p><p class="source-code"><strong class="bold">+             ))}</strong></p><p class="source-code"><strong class="bold">+         &lt;/div&gt;</strong></p><p class="source-code"><strong class="bold">+       )}</strong></p><p class="source-code">    &lt;/QuestionsContainer&gt;</p><p class="source-code">  );</p><p class="source-code">}</p><p class="source-code">export default Questions;</p></li>
			</ol>
			<p>If you now visit the <strong class="source-inline">/questions</strong> route on <strong class="source-inline">http://localhost:3000/questions</strong>, you can see <a id="_idIndexMarker190"/>that a list of questions is being rendered together with the Header component, as you can see in the following screenshot:</p>
			<div>
				<div id="_idContainer021" class="IMG---Figure">
					<img src="image/Figure_4.2_B17390.jpg" alt="Figure 4.2 – Our application with Stack Overflow data"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.2 – Our application with Stack Overflow data</p>
			<p>We'll be handling SSR later, but before that, we need to add routes that support parameters. To create a route that supports a parameter, we need to create a file created in the same manner as the Questions component. The new route will display a specific question, information that we can also get from the Stack Overflow API. Again, the filesystem <a id="_idIndexMarker191"/>will be leading in creating the route:</p>
			<ol>
				<li value="1">To create a new route with a parameter, we need to create a file called <strong class="source-inline">[id].js</strong> inside the <strong class="source-inline">questions</strong> directory. This file has the parameter name inside square brackets, and in this file, we can use a Hook from the Next.js routing library to get this parameter value:<p class="source-code">import { useRouter } from 'next/router';</p><p class="source-code">import styled from 'styled-components';</p><p class="source-code">const QuestionDetailContainer = styled.div'</p><p class="source-code">  display: flex;</p><p class="source-code">  justify-content: space-between;</p><p class="source-code">  flex-direction: column;</p><p class="source-code">  margin: 5%;</p><p class="source-code">';</p><p class="source-code">function QuestionDetail() {</p><p class="source-code">  const router = useRouter();</p><p class="source-code">  const { id } = router.query;</p><p class="source-code">  return (</p><p class="source-code">    &lt;QuestionDetailContainer&gt;</p><p class="source-code">      &lt;h2&gt;Question: {id}&lt;/h2&gt;</p><p class="source-code">    &lt;/QuestionDetailContainer&gt;</p><p class="source-code">  );</p><p class="source-code">}</p><p class="source-code">export default QuestionDetail;</p></li>
			</ol>
			<p>By visiting <strong class="source-inline">http://localhost:3000/questions/123</strong>, you can see that the parameter that we've added has become visible on the screen.</p>
			<ol>
				<li value="2">In the <strong class="source-inline">QuestionDetail</strong> component, we can import the <strong class="source-inline">Card</strong> component and we can use <a id="_idIndexMarker192"/>the Stack Overflow API to fetch data for a specific question. For this, we need to add both data fetching logic and elements to render the data to the <strong class="source-inline">[id].js</strong> file in the <strong class="source-inline">questions</strong> directory that we created in the previous step:<p class="source-code"><strong class="bold">+ import { useState, useEffect } from 'react';</strong></p><p class="source-code">  import { useRouter } from 'next/router';</p><p class="source-code">  import styled from 'styled-components';</p><p class="source-code"><strong class="bold">+ import Card from '../../components/Card';</strong></p><p class="source-code">  // ...</p><p class="source-code">  function QuestionDetail() {</p><p class="source-code">    const router = useRouter();</p><p class="source-code">    const { id } = router.query;</p><p class="source-code"><strong class="bold">+   const [loading, setLoading] = useState(false);</strong></p><p class="source-code"><strong class="bold">+   const [question, setQuestion] = useState({});</strong></p><p class="source-code"><strong class="bold">+   useEffect(() =&gt; {</strong></p><p class="source-code"><strong class="bold">+     async function fetchData() {</strong></p><p class="source-code"><strong class="bold">+       const data = await fetch(</strong></p><p class="source-code"><strong class="bold">         'https://api.stackexchange.com/2.2/questions</strong></p><p class="source-code"><strong class="bold">         /${id}?site=stackoverflow');</strong></p><p class="source-code"><strong class="bold">+       const result = await data.json();</strong></p><p class="source-code"><strong class="bold">+       if (result) {</strong></p><p class="source-code"><strong class="bold">+         setQuestion(result.items[0]);</strong></p><p class="source-code"><strong class="bold">+         setLoading(false);</strong></p><p class="source-code"><strong class="bold">+       }</strong></p><p class="source-code"><strong class="bold">+     }</strong></p><p class="source-code"><strong class="bold">+     id &amp;&amp; fetchData();</strong></p><p class="source-code"><strong class="bold">+   }, [id]);</strong></p><p class="source-code">    // ...</p></li>
				<li>After <a id="_idIndexMarker193"/>adding the data fetching logic, the <strong class="source-inline">Card</strong> component can be returned with the question information passed to it as props:<p class="source-code">    // ...</p><p class="source-code">    return (</p><p class="source-code">      &lt;QuestionDetailContainer&gt;</p><p class="source-code"><strong class="bold">-       &lt;h2&gt;Question: {id}&lt;/h2&gt;</strong></p><p class="source-code"><strong class="bold">+       {loading ? (</strong></p><p class="source-code"><strong class="bold">+         &lt;span&gt;Loading...&lt;/span&gt;</strong></p><p class="source-code"><strong class="bold">+       ) : (</strong></p><p class="source-code"><strong class="bold">+         &lt;Card</strong></p><p class="source-code"><strong class="bold">+           title={question.title}</strong></p><p class="source-code"><strong class="bold">+           views={question.view_count}</strong></p><p class="source-code"><strong class="bold">+           answers={question.answers_count}</strong></p><p class="source-code"><strong class="bold">+         /&gt;</strong></p><p class="source-code"><strong class="bold">+       )}</strong></p><p class="source-code">    &lt;/QuestionDetailContainer&gt;</p><p class="source-code">  );</p><p class="source-code">}</p><p class="source-code">export default QuestionDetail;</p></li>
			</ol>
			<p>The API endpoint that gets a question by its identifier returns an array, as it expects <a id="_idIndexMarker194"/>multiple IDs at once. Therefore, we need to get the first item that's returned by the endpoint as we only provide one ID.</p>
			<ol>
				<li value="4">To get to a specific question, you need to have the ID of the question. This is best done from the <strong class="source-inline">Questions</strong> component where we can import a <strong class="source-inline">Link</strong> component from the routing library of Next.js. Every <strong class="source-inline">Link</strong> component needs to wrap a component that's able to do routing, so we'll add a styled <strong class="source-inline">a</strong> element inside it. Also, the elements used to display the questions will be replaced by the <strong class="source-inline">Card</strong> component that we created before:<p class="source-code">  import { useState, useEffect } from 'react';</p><p class="source-code">  import styled from 'styled-components';</p><p class="source-code"><strong class="bold">+ import Link from 'next/link';</strong>  </p><p class="source-code">  import Card from '../../components/Card';</p><p class="source-code">  // ...</p><p class="source-code"><strong class="bold">+ const CardLink = styled.a'</strong></p><p class="source-code"><strong class="bold">+   text-decoration: none;</strong></p><p class="source-code"><strong class="bold">+ ';</strong></p><p class="source-code">  function Questions() {</p><p class="source-code">  // ...</p><p class="source-code">    return (</p><p class="source-code">      &lt;QuestionsContainer&gt;</p><p class="source-code">        // ...</p><p class="source-code">        {questions.map((question) =&gt; (</p><p class="source-code"><strong class="bold">+         &lt;Link</strong></p><p class="source-code"><strong class="bold">+          key={question.question_id}</strong></p><p class="source-code"><strong class="bold">+          href={'/questions/${question.question_id}'}</strong></p><p class="source-code"><strong class="bold">+          passHref</strong></p><p class="source-code"><strong class="bold">+         &gt;</strong></p><p class="source-code"><strong class="bold">+           &lt;CardLink&gt;</strong></p><p class="source-code">              &lt;Card </p><p class="source-code"><strong class="bold">-               key={question.question_id}</strong></p><p class="source-code">                title={question.title} </p><p class="source-code">                views={question.view_count}</p><p class="source-code">                answers={question.answer_count} </p><p class="source-code">              /&gt;</p><p class="source-code"><strong class="bold">+           &lt;/CardLink&gt;</strong></p><p class="source-code"><strong class="bold">+         &lt;/Link&gt;</strong></p><p class="source-code">        ))}</p><p class="source-code">        // ...</p></li>
			</ol>
			<p>As you might notice when visiting <strong class="source-inline">http://localhost:3000/questions</strong>, the <strong class="source-inline">Card</strong> components are now clickable and link to a new page showing the question you've just clicked on. </p>
			<ol>
				<li value="5">Finally, we <a id="_idIndexMarker195"/>want the basic <strong class="source-inline">/</strong> route to also show the <strong class="source-inline">Questions</strong> component. We can do this by importing this component inside <strong class="source-inline">/pages/index.js</strong> and having it returned from there:<p class="source-code">import Questions from './questions';</p><p class="source-code">export default function Home() {</p><p class="source-code">  return &lt;Questions /&gt;;</p><p class="source-code">}</p></li>
			</ol>
			<p>The application will now return a list of questions on both the <strong class="source-inline">/</strong> and <strong class="source-inline">/questions</strong> routes, and is able to display a specific question when you click on any of the questions from these routes:</p>
			<p class="figure-caption">  </p>
			<div>
				<div id="_idContainer022" class="IMG---Figure">
					<img src="image/Figure_4.3_B17390.jpg" alt="Figure 4.3 – Our application with basic styling and dynamic routes&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.3 – Our application with basic styling and dynamic routes</p>
			<p>Besides <a id="_idIndexMarker196"/>routing using parameters, we can also add routing using a query string for features such as pagination. This will be shown in the next part of this section, about routing with Next.js.</p>
			<h2 id="_idParaDest-56"><a id="_idTextAnchor060"/>Handling query strings</h2>
			<p>Being able to navigate to individual questions is only one piece of the cake when you want to <a id="_idIndexMarker197"/>add routing to a project, and pagination could be another one.  </p>
			<p>The Stack Overflow <a id="_idIndexMarker198"/>API already has support for pagination, which you can see if you look at the API response. The object that is being returned when you call the endpoint that is described on https://api.stackexchange.com/docs/questions#order=desc&amp;sort=hot&amp;tagged=reactjs&amp;filter=default&amp;site=stackoverflow&amp;run=true has a field called <strong class="source-inline">has_more</strong>. If this field has the <strong class="source-inline">true</strong> value, you can request more questions by adding the <strong class="source-inline">page</strong> query string to the API request. </p>
			<p>Just as we got the parameters from the URL with the <strong class="source-inline">useRouter</strong> Hook from Next.js, we can also get the query strings with this Hook. To add pagination to the <strong class="source-inline">Questions</strong> component, we need to make the following changes:</p>
			<ol>
				<li value="1">In the <strong class="source-inline">Questions</strong> page component in <strong class="source-inline">pages/questions/index.js</strong>, we need to import the <strong class="source-inline">useRouter</strong> Hook and get the query strings from the URL:<p class="source-code">  import { useState, useEffect } from 'react';</p><p class="source-code">  import styled from 'styled-components';</p><p class="source-code">  import Link from 'next/link';</p><p class="source-code"><strong class="bold">+ import { useRouter } from 'next/router';</strong></p><p class="source-code">  import Card from '../components/Card';</p><p class="source-code">  // ...</p><p class="source-code">  function Questions() {</p><p class="source-code">    const [loading, setLoading] = useState(false);</p><p class="source-code">    const [questions, setQuestions] = useState([]);</p><p class="source-code"><strong class="bold">+   const router = useRouter();</strong></p><p class="source-code"><strong class="bold">+   const { page } = router.query;</strong></p><p class="source-code">    useEffect(() =&gt; {</p><p class="source-code">      // ...</p></li>
				<li>The <strong class="source-inline">page</strong> constant <a id="_idIndexMarker199"/>can then be appended to the <a id="_idIndexMarker200"/>endpoint to retrieve the questions from the Stack Overflow API:<p class="source-code">  // ...</p><p class="source-code">  useEffect(() =&gt; {</p><p class="source-code">    async function fetchData() {</p><p class="source-code"><strong class="bold">-     const data = await fetch(</strong></p><p class="source-code"><strong class="bold">        'https://api.stackexchange.com/2.2/questions</strong></p><p class="source-code"><strong class="bold">         ?order=desc&amp;sort=hot&amp;tagged=reactjs&amp;site=</strong></p><p class="source-code"><strong class="bold">         stackoverflow');</strong></p><p class="source-code"><strong class="bold">+     const data = await fetch(</strong></p><p class="source-code"><strong class="bold">        'https://api.stackexchange.com/2.2/questions</strong></p><p class="source-code"><strong class="bold">         ?${page ? 'page=${page}&amp;' : ''}order=</strong></p><p class="source-code"><strong class="bold">         desc&amp;sort=hot&amp;tagged=reactjs&amp;site=</strong></p><p class="source-code"><strong class="bold">         stackoverflow');</strong></p><p class="source-code">      const result = await data.json();</p><p class="source-code">      if (result) {</p><p class="source-code">        setQuestions(result.items);</p><p class="source-code">        setLoading(false);</p><p class="source-code">      }</p><p class="source-code">    }</p><p class="source-code">    fetchData();</p><p class="source-code"><strong class="bold">- }, []);</strong></p><p class="source-code"><strong class="bold">+ }, [page]);</strong></p><p class="source-code">  return (</p><p class="source-code">    // ...</p><p class="callout-heading">Note</p><p class="callout">In the preceding code, we've also added <strong class="source-inline">page</strong> to the dependency array of the <strong class="source-inline">useEffect</strong> Hook to do the data fetching. When the application first renders, the value for <strong class="source-inline">page</strong> is not set as the query string should still be retrieved from the API. This is causing the API to be called twice, something that we won't optimize now but will do later once we add SSR to the application.</p></li>
			</ol>
			<p>You can test <a id="_idIndexMarker201"/>whether this is working by changing <a id="_idIndexMarker202"/>the query string for <strong class="source-inline">page</strong> to different numbers, such as <strong class="source-inline">http://localhost:3000/questions?page=1</strong> or <strong class="source-inline">http://localhost:3000/questions?page=3</strong>. To make the application more user-friendly, let's add pagination buttons to the bottom of the page. </p>
			<ol>
				<li value="3">Create the <strong class="source-inline">Pagination</strong> component inside the <strong class="source-inline">components</strong> directory, which holds two <strong class="source-inline">Link</strong> components from Next.js. The component will display a link to the previous page if the current page number is above 1 and will also show a link to the next page if more pages are available:<p class="source-code">import styled from 'styled-components';</p><p class="source-code">import Link from 'next/link';</p><p class="source-code">const PaginationContainer = styled.div'</p><p class="source-code">  display: flex;</p><p class="source-code">  justify-content: center;</p><p class="source-code">';</p><p class="source-code">const PaginationLink = styled.a'</p><p class="source-code">  padding: 2%;</p><p class="source-code">  margin: 1%;</p><p class="source-code">  background: orange;</p><p class="source-code">  cursor: pointer;</p><p class="source-code">  color: white;</p><p class="source-code">  text-decoration: none;</p><p class="source-code">  border-radius: 5px;</p><p class="source-code">';</p><p class="source-code">function Pagination({ currentPage, hasMore }) {</p><p class="source-code">  return (</p><p class="source-code">    &lt;PaginationContainer&gt;</p><p class="source-code">      &lt;Link </p><p class="source-code">        href={'?page=${parseInt(currentPage) - 1}'}&gt;</p><p class="source-code">        &lt;PaginationLink&gt;Previous&lt;/PaginationLink&gt;</p><p class="source-code">      &lt;/Link&gt;</p><p class="source-code">      &lt;Link </p><p class="source-code">        href={'?page=${parseInt(currentPage) + 1}'}&gt;</p><p class="source-code">        &lt;PaginationLink&gt;Next&lt;/PaginationLink&gt;</p><p class="source-code">      &lt;/Link&gt;</p><p class="source-code">    &lt;/PaginationContainer&gt;</p><p class="source-code">  );</p><p class="source-code">}</p><p class="source-code">export default Pagination;</p></li>
				<li>We need <a id="_idIndexMarker203"/>to import this new <strong class="source-inline">Pagination</strong> component <a id="_idIndexMarker204"/>inside the <strong class="source-inline">Questions</strong> page component, but we also need to retrieve the value for <strong class="source-inline">hasMore</strong> from the Stack Overflow API:<p class="source-code">  import { useState, useEffect } from 'react';</p><p class="source-code">  import Link from 'next/link';</p><p class="source-code">  import { useRouter } from 'next/router';</p><p class="source-code">  import styled from 'styled-components';</p><p class="source-code">  import Card from '../../components/Card';</p><p class="source-code"><strong class="bold">+ import Pagination from</strong></p><p class="source-code"><strong class="bold">    '../../components/Pagination';</strong></p><p class="source-code">  // ...</p><p class="source-code">  function Questions() {</p><p class="source-code">    const [loading, setLoading] = useState(false);</p><p class="source-code">    const [questions, setQuestions] = useState([]);</p><p class="source-code"><strong class="bold">+   const [hasMore, setHasMore] = useState(false);</strong></p><p class="source-code">    const router = useRouter();</p><p class="source-code">    const { page } = router.query;</p><p class="source-code">    useEffect(() =&gt; {</p><p class="source-code">      async function fetchData() {</p><p class="source-code">        const data = await fetch(</p><p class="source-code">          'https://api.stackexchange.com/2.2/questions</p><p class="source-code">           ?${page ? 'page=${page}&amp;' : ''}order=</p><p class="source-code">           desc&amp;sort=hot&amp;tagged=reactjs&amp;site=</p><p class="source-code">           stackoverflow');</p><p class="source-code">      const result = await data.json();</p><p class="source-code">        if (result) {</p><p class="source-code">          setQuestions(result.items);</p><p class="source-code"><strong class="bold">+         setHasMore(result.has_more);</strong></p><p class="source-code">          setLoading(false);</p><p class="source-code">        }</p><p class="source-code">      }</p><p class="source-code">      fetchData();</p><p class="source-code">    }, [page]);</p><p class="source-code">    // ...</p></li>
				<li>Also, the <strong class="source-inline">Pagination</strong> component must be rendered at the end of the <strong class="source-inline">Questions</strong> component. Make <a id="_idIndexMarker205"/>sure to also pass the <strong class="source-inline">currentPage</strong> and <strong class="source-inline">hasMore</strong> props <a id="_idIndexMarker206"/>to the component:<p class="source-code">  // ...</p><p class="source-code">    return (</p><p class="source-code">      &lt;QuestionsContainer&gt;</p><p class="source-code">        &lt;h2&gt;Questions&lt;/h2&gt;</p><p class="source-code">        {loading ? (</p><p class="source-code">          &lt;span&gt;Loading...&lt;/span&gt;</p><p class="source-code">        ) : (</p><p class="source-code"><strong class="bold">+         &lt;&gt;</strong></p><p class="source-code">            &lt;div&gt;</p><p class="source-code">              {questions.map((question) =&gt; (</p><p class="source-code">                // ...</p><p class="source-code">              ))}</p><p class="source-code">            &lt;/div&gt;</p><p class="source-code"><strong class="bold">+          &lt;Pagination currentPage={parseInt(page) ||</strong></p><p class="source-code"><strong class="bold">             1} hasMore={hasMore} /&gt;</strong></p><p class="source-code"><strong class="bold">+        &lt;/&gt;</strong></p><p class="source-code">        )}</p><p class="source-code">      &lt;/QuestionsContainer&gt;</p><p class="source-code">    );</p><p class="source-code">  }</p><p class="source-code">  export default Questions;</p></li>
				<li>Finally, we <a id="_idIndexMarker207"/>want the user to not be able to navigate <a id="_idIndexMarker208"/>to a page that doesn't exist. So, in the <strong class="source-inline">Pagination</strong> component, make the following changes to disable the previous or next button if there is no page available:<p class="source-code">  // ...</p><p class="source-code">  const PaginationLink = styled.a'</p><p class="source-code">    padding: 2%;</p><p class="source-code">    margin: 1%;</p><p class="source-code"><strong class="bold">+   background: ${(props) =&gt; </strong></p><p class="source-code"><strong class="bold">      (!props.disabled ? 'orange' : 'lightGrey')};</strong></p><p class="source-code"><strong class="bold">+   pointer-events: ${(props) =&gt; </strong></p><p class="source-code"><strong class="bold">      (!props.disabled ? 'all' : 'none')};</strong></p><p class="source-code"><strong class="bold">+   cursor: ${(props) =&gt; </strong></p><p class="source-code"><strong class="bold">      (!props.disabled ? 'pointer' : 'not-allowed')};</strong></p><p class="source-code">    color: white;</p><p class="source-code">    text-decoration: none;</p><p class="source-code">    border-radius: 5px;</p><p class="source-code">  ';  </p><p class="source-code">  function Pagination({ currentPage, hasMore }) {</p><p class="source-code">    return (</p><p class="source-code">      &lt;PaginationContainer&gt;</p><p class="source-code">      &lt;Link href={'?page=${parseInt(currentPage) - 1}'}&gt;</p><p class="source-code"><strong class="bold">-       &lt;PaginationLink&gt;Previous&lt;/PaginationLink&gt;</strong></p><p class="source-code"><strong class="bold">+       &lt;PaginationLink disabled={currentPage &lt;= 1}&gt;</strong></p><p class="source-code"><strong class="bold">          Previous</strong></p><p class="source-code"><strong class="bold">         &lt;/PaginationLink&gt;</strong></p><p class="source-code">      &lt;/Link&gt;</p><p class="source-code">      &lt;Link href={'?page=${parseInt(currentPage) + 1}'}&gt;</p><p class="source-code"><strong class="bold">-       &lt;PaginationLink&gt;Next&lt;/PaginationLink&gt;</strong></p><p class="source-code"><strong class="bold">+       &lt;PaginationLink disabled={!hasMore}&gt;</strong></p><p class="source-code"><strong class="bold">          Next</strong></p><p class="source-code"><strong class="bold">        &lt;/PaginationLink&gt;</strong></p><p class="source-code">      &lt;/Link&gt;</p><p class="source-code">    &lt;/PaginationContainer&gt;</p><p class="source-code">  );</p><p class="source-code">}</p><p class="source-code">export default Pagination;</p></li>
			</ol>
			<p>You have now implemented the parsing of the query string to dynamically change the route for your application. With the addition of the <strong class="source-inline">Pagination</strong> component, both the <strong class="source-inline">/</strong> and <strong class="source-inline">/questions</strong> routes will look something like this:</p>
			<div>
				<div id="_idContainer023" class="IMG---Figure">
					<img src="image/Figure_4.4_B17390.jpg" alt="Figure 4.4 – The application after adding pagination&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.4 – The application after adding pagination</p>
			<p>In the next <a id="_idIndexMarker209"/>section, you'll explore another thing you can <a id="_idIndexMarker210"/>do with React in combination with Next.js, SRR, which enables you to serve your application from the server instead of rendering it at runtime.</p>
			<h1 id="_idParaDest-57"><a id="_idTextAnchor061"/>Enabling SSR</h1>
			<p>Using SSR can <a id="_idIndexMarker211"/>be helpful if you're building an application that needs to render very quickly or when you want certain information to be loaded before the web page is visible. Although most search engines are now able to render SPAs, this can still be an improvement, for example, if you want users to share your page on social media or when you want to enhance the performance of your application. </p>
			<h2 id="_idParaDest-58"><a id="_idTextAnchor062"/>Fetching data server side with Next.js</h2>
			<p>There is no standard pattern to enable SSR for your React application, but luckily, Next.js supports <a id="_idIndexMarker212"/>multiple ways to do data fetching, such as dynamically from the client, server side on every <a id="_idIndexMarker213"/>request, or statically during build time. The first <a id="_idIndexMarker214"/>way is what we've done in this chapter so far and in this section, we'll be requesting our data server side on every request. For this, the Next.js <strong class="source-inline">getServerSideProps</strong> method will be used.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">Next.js also offers the <strong class="source-inline">getStaticProps</strong> and <strong class="source-inline">getStaticPaths</strong> methods to generate the content of your application statically at build time. This is especially useful if your content doesn't change that often and you want to serve your website as fast as possible.</p>
			<p>At the beginning of this chapter, we already set up <strong class="source-inline">styled-components</strong> in such a way that it will support SSR, so we just have to alter how we do data fetching to enable it for the entire application. Therefore, we need to refactor our <strong class="source-inline">Questions</strong> component so that it will get the data from the Stack Overflow API on the server side instead of dynamically from the client:</p>
			<ol>
				<li value="1">In the <strong class="source-inline">Questions</strong> page component, we no longer have to import the <strong class="source-inline">useState</strong> and <strong class="source-inline">useEffect</strong> Hooks to set up state management and data fetching, so these can be removed. The <strong class="source-inline">useRouter</strong> Hook from Next.js can also be deleted:<p class="source-code"><strong class="bold">- import { useState, useEffect } from 'react';</strong></p><p class="source-code">  import styled from 'styled-components';</p><p class="source-code">  import Link from 'next/link';</p><p class="source-code"><strong class="bold">- import { useRouter } from 'next/router';</strong></p><p class="source-code">  import Card from '../../components/Card';</p><p class="source-code">  import Pagination from '../../components/Pagination';</p><p class="source-code">  // ...</p><p class="source-code">  function Questions() {</p><p class="source-code"><strong class="bold">-   const [loading, setLoading] = useState(false);</strong></p><p class="source-code"><strong class="bold">-   const [questions, setQuestions] = useState([]);</strong></p><p class="source-code"><strong class="bold">-   const [hasMore, setHasMore] = useState(false);</strong></p><p class="source-code"><strong class="bold">-   const router = useRouter();</strong></p><p class="source-code"><strong class="bold">-   const { page } = router.query;</strong></p><p class="source-code"><strong class="bold">-   useEffect(() =&gt; {</strong></p><p class="source-code"><strong class="bold">-     async function fetchData() {</strong></p><p class="source-code"><strong class="bold">-       const data = await fetch(</strong></p><p class="source-code"><strong class="bold">          'https://api.stackexchange.com/2.2/questions</strong></p><p class="source-code"><strong class="bold">           ?${page ? 'page=${page}&amp;' : ''}order=</strong></p><p class="source-code"><strong class="bold">           desc&amp;sort=hot&amp;tagged=reactjs&amp;site</strong></p><p class="source-code"><strong class="bold">           =stackoverflow');</strong></p><p class="source-code"><strong class="bold">-       const result = await data.json();</strong></p><p class="source-code"><strong class="bold">-       if (result) {</strong></p><p class="source-code"><strong class="bold">-         setQuestions(result.items);</strong></p><p class="source-code"><strong class="bold">-         setHasMore(result.has_more);</strong></p><p class="source-code"><strong class="bold">-         setLoading(false);</strong></p><p class="source-code"><strong class="bold">-       }</strong></p><p class="source-code"><strong class="bold">-     }</strong></p><p class="source-code"><strong class="bold">-     fetchData();</strong></p><p class="source-code"><strong class="bold">-   }, [page]);</strong></p><p class="source-code">  return (</p><p class="source-code">    // ...</p></li>
				<li>Instead, the <strong class="source-inline">getServerSideProps</strong> method needs to be used to do the data fetching <a id="_idIndexMarker215"/>on the server side. As the data is <a id="_idIndexMarker216"/>then not retrieved by the client, we no longer need to set local state variables or life cycles to keep track of changes in the data. The data will already be there once we load our React application in the browser:<p class="source-code">  // ...</p><p class="source-code"><strong class="bold">+ export async function getServerSideProps(context) {</strong></p><p class="source-code"><strong class="bold">+   const { page } = context.query;</strong></p><p class="source-code"><strong class="bold">+   const data = await fetch(</strong></p><p class="source-code"><strong class="bold">+     'https://api.stackexchange.com/2.2/questions?${</strong></p><p class="source-code"><strong class="bold">+       page ? 'page=${page}&amp;' : ''</strong></p><p class="source-code"><strong class="bold">+       }order=desc&amp;sort=hot&amp;tagged=reactjs&amp;site=</strong></p><p class="source-code"><strong class="bold">        stackoverflow',</strong></p><p class="source-code"><strong class="bold">+   );</strong></p><p class="source-code"><strong class="bold">+   const result = await data.json();</strong></p><p class="source-code"><strong class="bold">+   return { </strong></p><p class="source-code"><strong class="bold">+     props: { </strong></p><p class="source-code"><strong class="bold">+       questions: result.items, </strong></p><p class="source-code"><strong class="bold">+       hasMore: result.has_more, </strong></p><p class="source-code"><strong class="bold">+       page: page || 1, </strong></p><p class="source-code"><strong class="bold">+     } </strong></p><p class="source-code"><strong class="bold">+   };</strong></p><p class="source-code"><strong class="bold">+ }</strong></p><p class="source-code">export default Questions;</p></li>
			</ol>
			<p>In this <a id="_idIndexMarker217"/>method, the value for <strong class="source-inline">page</strong> is retrieved <a id="_idIndexMarker218"/>from a constant called <strong class="source-inline">context</strong>, which is passed to <strong class="source-inline">getServerSideProps</strong> by Next.js and gets the page from the router. Using this value, we can do the data fetching in the same way as we did before in the life cycle. Instead of storing the data in local state variables, we're now passing it as props to the <strong class="source-inline">Questions</strong> component by returning it from the method we created.</p>
			<ol>
				<li value="3">Our <strong class="source-inline">Questions</strong> page component can use these props to render our list of questions in the browser. As the data is retrieved from the server side before passing the application to the client, we no longer have to set a loading indicator to wait for the data to be fetched:<p class="source-code">  // ...</p><p class="source-code"><strong class="bold">- function Questions() {</strong></p><p class="source-code"><strong class="bold">+ function Questions({ questions, hasMore, page }) {</strong></p><p class="source-code">  return (</p><p class="source-code">    &lt;QuestionsContainer&gt;</p><p class="source-code">      &lt;h2&gt;Questions&lt;/h2&gt;</p><p class="source-code"><strong class="bold">-     {loading ? (</strong></p><p class="source-code"><strong class="bold">-       &lt;span&gt;Loading...&lt;/span&gt;</strong></p><p class="source-code"><strong class="bold">-     ) : (</strong></p><p class="source-code"><strong class="bold">-     &lt;&gt; </strong></p><p class="source-code">      &lt;div&gt;</p><p class="source-code">        {questions &amp;&amp;</p><p class="source-code">          questions.map((question) =&gt; (</p><p class="source-code">            // ...</p><p class="source-code">          ))}</p><p class="source-code">      &lt;/div&gt;</p><p class="source-code">      &lt;Pagination currentPage={parseInt(page) || 1} </p><p class="source-code">        hasMore={hasMore} /&gt;</p><p class="source-code"><strong class="bold">-    &lt;/&gt;</strong></p><p class="source-code"><strong class="bold">-    )}</strong></p><p class="source-code">    &lt;/QuestionsContainer&gt;</p><p class="source-code">  );</p><p class="source-code">}</p><p class="source-code">// ...</p></li>
			</ol>
			<p>You can <a id="_idIndexMarker219"/>check this by going to <strong class="source-inline">http://localhost:3000/questions</strong> and <a id="_idIndexMarker220"/>seeing that the questions are no longer being retrieved on the client side but on the server side. In the <strong class="bold">Network</strong> tab, there's no request made to the Stack Overflow API, while the questions are being rendered in the browsers. You can also verify this by inspecting the page source:</p>
			<div>
				<div id="_idContainer024" class="IMG---Figure">
					<img src="image/Figure_4.5_B17390.jpg" alt="Figure 4.5 – SSR application using Next.js&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.5 – SSR application using Next.js</p>
			<p>However, the <strong class="source-inline">Questions</strong> page component is also imported in <strong class="source-inline">pages/index.js</strong> and <a id="_idIndexMarker221"/>returned there. But opening our main <strong class="source-inline">/</strong> route at <strong class="source-inline">http://localhost:3000/</strong> doesn't show any questions. This is because <a id="_idIndexMarker222"/>this file doesn't have a <strong class="source-inline">getServerSideProps</strong> to get the data. Therefore, we need to create this method in <strong class="source-inline">pages/index.js</strong> as well and have it return the method that we can import from <strong class="source-inline">pages/questions/index.js</strong> so that we don't have to duplicate the data fetching logic. The <strong class="source-inline">Home</strong> component in this file can then get the data from the props and pass it to the <strong class="source-inline">Questions</strong> component:</p>
			<p class="source-code"><strong class="bold">- import Questions from './questions';</strong></p>
			<p class="source-code"><strong class="bold">+ import Questions, {</strong></p>
			<p class="source-code"><strong class="bold">+  getServerSideProps as getServerSidePropsQuestions,</strong></p>
			<p class="source-code"><strong class="bold">+ } from './questions';</strong></p>
			<p class="source-code"><strong class="bold">+ export function getServerSideProps(context) {</strong></p>
			<p class="source-code"><strong class="bold">+  return getServerSidePropsQuestions(context);</strong></p>
			<p class="source-code"><strong class="bold">+ }</strong></p>
			<p class="source-code"><strong class="bold">- export default function Home() {</strong></p>
			<p class="source-code"><strong class="bold">-   return &lt;Questions /&gt;;</strong></p>
			<p class="source-code"><strong class="bold">+ export default function Home(props) {</strong></p>
			<p class="source-code"><strong class="bold">+   return &lt;Questions {...props} /&gt;;</strong></p>
			<p class="source-code">}</p>
			<p>After <a id="_idIndexMarker223"/>making this change, both the <strong class="source-inline">/</strong> and <strong class="source-inline">/questions</strong> routes <a id="_idIndexMarker224"/>will have SSR enabled. Another advantage of SSR is that your application can be discovered by search engines more effectively. In the next part of this section, you'll add the tags that make your application discoverable by these engines.</p>
			<h2 id="_idParaDest-59"><a id="_idTextAnchor063"/>Adding head tags for SEO</h2>
			<p>Assuming you want your application to be indexed by search engines, you need to set head tags <a id="_idIndexMarker225"/>for the crawlers <a id="_idIndexMarker226"/>to identify the content <a id="_idIndexMarker227"/>on your page. This is something you want to do dynamically for each route, as each route will have different content.</p>
			<p>Next.js can define the head tags in any component that is rendered by your application by importing <strong class="source-inline">Head</strong> from <strong class="source-inline">next/head</strong>. If nested, the lowest definition of a <strong class="source-inline">Head</strong> component in the component tree will be used. That's why we can create a <strong class="source-inline">Head</strong> component in our <strong class="source-inline">Header</strong> component for all routes and in each of the components that is being rendered on a route:</p>
			<ol>
				<li value="1">Import the <strong class="source-inline">Head</strong> component in the <strong class="source-inline">components/Header.js</strong> file, and create a <strong class="source-inline">Head</strong> component that sets <strong class="source-inline">title</strong> and a meta description:<p class="source-code">  import styled from 'styled-components';</p><p class="source-code"><strong class="bold">+ import Head from 'next/head';</strong></p><p class="source-code">// ...</p><p class="source-code">  const Header = () =&gt; (</p><p class="source-code"><strong class="bold">+  &lt;&gt;</strong></p><p class="source-code"><strong class="bold">+    &lt;Head&gt;</strong></p><p class="source-code"><strong class="bold">+      &lt;title&gt;Community Feed&lt;/title&gt;</strong></p><p class="source-code"><strong class="bold">+      &lt;meta name='description' content='This is a</strong></p><p class="source-code"><strong class="bold">         Community Feed project build with React' /&gt;</strong></p><p class="source-code"><strong class="bold">+    &lt;/Head&gt;</strong></p><p class="source-code"><strong class="bold">    &lt;HeaderWrapper&gt;</strong></p><p class="source-code"><strong class="bold">      &lt;Title&gt;Community Feed&lt;/Title&gt;</strong></p><p class="source-code"><strong class="bold">    &lt;/HeaderWrapper&gt;</strong></p><p class="source-code"><strong class="bold">+  &lt;/&gt;</strong></p><p class="source-code">  );</p><p class="source-code">export default Header;</p></li>
				<li>Also, create <a id="_idIndexMarker228"/>a <strong class="source-inline">Head</strong> component <a id="_idIndexMarker229"/>in <strong class="source-inline">pages/questions/index.js</strong> that only sets a title for this route, so it will use <a id="_idIndexMarker230"/>the meta description of the <strong class="source-inline">Header</strong> component:<p class="source-code">  import styled from 'styled-components';</p><p class="source-code">  import Link from 'next/link';</p><p class="source-code"><strong class="bold">+ import Head from 'next/head';</strong></p><p class="source-code">  import Card from '../../components/Card';</p><p class="source-code">  import Pagination from</p><p class="source-code">    '../../components/Pagination';</p><p class="source-code">  // ...</p><p class="source-code">  function Questions({ questions, hasMore, page }) {</p><p class="source-code">    return (</p><p class="source-code">+     &lt;&gt;</p><p class="source-code"><strong class="bold">+       &lt;Head&gt;</strong></p><p class="source-code"><strong class="bold">+         &lt;title&gt;Questions&lt;/title&gt;</strong></p><p class="source-code"><strong class="bold">+       &lt;/Head&gt;</strong></p><p class="source-code">        &lt;QuestionsContainer&gt; </p><p class="source-code">          // ... </p><p class="source-code">        &lt;/QuestionsContainer&gt;</p><p class="source-code"><strong class="bold">+     &lt;/&gt;</strong></p><p class="source-code">    );</p><p class="source-code">  }</p><p class="source-code">  // ...</p></li>
				<li>Do <a id="_idIndexMarker231"/>the same for the <strong class="source-inline">pages/questions/[id].js</strong> file, where <a id="_idIndexMarker232"/>you can <a id="_idIndexMarker233"/>also take the title of the question to make the page title more dynamic:<p class="source-code">  import { useState, useEffect } from 'react';</p><p class="source-code">  import { useRouter } from 'next/router';</p><p class="source-code"><strong class="bold">+ import Head from 'next/head';</strong></p><p class="source-code">  import styled from 'styled-components';</p><p class="source-code">  import Card from '../../components/Card';</p><p class="source-code">  // ...</p><p class="source-code">  function QuestionDetail() {</p><p class="source-code">    // ...</p><p class="source-code">    return (</p><p class="source-code">      &lt;QuestionDetailContainer&gt;</p><p class="source-code">        {loading ? (</p><p class="source-code">          &lt;span&gt;Loading...&lt;/span&gt;</p><p class="source-code">        ) : (</p><p class="source-code"><strong class="bold">+         &lt;&gt;</strong></p><p class="source-code"><strong class="bold">+           &lt;Head&gt;</strong></p><p class="source-code"><strong class="bold">+             &lt;title&gt;{question.title}&lt;/title&gt;</strong></p><p class="source-code"><strong class="bold">+           &lt;/Head&gt;</strong></p><p class="source-code">            &lt;Card</p><p class="source-code">              title={question.title}</p><p class="source-code">              views={question.view_count}</p><p class="source-code">              answers={question.answer_count}</p><p class="source-code">            /&gt;</p><p class="source-code"><strong class="bold">+         &lt;/&gt;</strong></p><p class="source-code">        )}</p><p class="source-code">      &lt;/QuestionDetailContainer&gt;</p><p class="source-code">    );</p><p class="source-code">  }</p><p class="source-code">  export default QuestionDetail;</p></li>
			</ol>
			<p>These <a id="_idIndexMarker234"/>head tags will now be <a id="_idIndexMarker235"/>used when you're running <a id="_idIndexMarker236"/>your application on both the server and the client side, making your application more suitable for being indexed by search engines, which improves your SEO. </p>
			<h1 id="_idParaDest-60"><a id="_idTextAnchor064"/>Summary</h1>
			<p>In this chapter, you've learned how to use Next.js as an alternative to Create React App. Next.js is a framework to create React applications, without having to add configuration for compiling and building your code or to handle features such as routing and data fetching. The project you created in this chapter supports SSR, as this is built in by Next.js. Also, we've added dynamic head tags to the application for SEO purposes.</p>
			<p>After completing this chapter, you must already feel like an expert with React! The next chapter will take your skill to the next level as you'll learn how to handle state management using the context API. With the context API, you can share the state and data between multiple components in your application, no matter whether they're direct children of the parent component or not.</p>
			<h1 id="_idParaDest-61"><a id="_idTextAnchor065"/>Further reading</h1>
			<p>For more information on Next.js, you can refer to <a href="https://nextjs.org/docs/">https://nextjs.org/docs/</a>.</p>
		</div>
	</body></html>