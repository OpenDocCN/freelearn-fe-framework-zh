<html><head></head><body>
        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Routing and Navigation between Components</h1>
                
            
            <article>
                
<p class="calibre2">In this chapter, we will cover navigation in an Angular application. We will implement routers for our app component and authentication. We will also cover router outlets for our component view and create a router module for authentication. This will make our authentication feature completely independent of other modules. Component navigation in an authentication module will be taken care of by a child router module. We will also discuss Angular guard, which will restrict the navigation based on the condition to the component. This enhances the security of our application. Finally, we will cover Firebase session life cycles in depth and redirect our user to the <span>Login</span> or <span>My Profile</span> page. </p>
<p class="calibre2"><span>In this chapter, we will cover the following topics:</span></p>
<ul class="calibre7">
<li class="calibre8">Enabling routes in an app component</li>
<li class="calibre8">Creating a routing module for authentication</li>
<li class="calibre8">Adding a router link </li>
<li class="calibre8">Using authentication guard</li>
<li class="calibre8">Firebase session life cycles</li>
<li class="calibre8">Our project structure as of now</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Enabling routes in an app component</h1>
                
            
            <article>
                
<p class="calibre2">In this section, we enable routing and create the main navigation bar for our application. The steps to enable routes are as follows:</p>
<ul class="calibre7">
<li class="calibre8"><strong class="calibre1">Adding the base reference URL</strong>: We will need to add a base element in <kbd class="calibre11">index.html</kbd> to tell the Angular router how to compose the navigation URL. </li>
</ul>
<p class="mce-root"><span>We added <kbd class="calibre11">href</kbd> in the head tag of <kbd class="calibre11">index.html</kbd></span><span>:</span></p>
<pre class="calibre18"><span>&lt;</span><span>base </span><span>href=</span><span>"/"</span><span>&gt;</span></pre>
<ul class="calibre7">
<li class="calibre8"><strong class="calibre1">Creating the main navigation bar</strong>: Most web applications have a navigation bar at the top of the page for navigating to different pages in the application. We have added a main navigation bar for our friends application using the bootstrap <kbd class="calibre11">nav bar</kbd> component. </li>
</ul>
<ol class="calibre13">
<li value="1" class="calibre8">The first step is to include the <kbd class="calibre11">nav</kbd> tag in <kbd class="calibre11">app.component.html</kbd>, as follows:</li>
</ol>
<pre class="calibre18"><span>&lt;</span><span>nav </span><span>class=</span><span>"navbar navbar-expand-lg navbar-light bg-color"</span><span>&gt;&lt;/nav&gt;</span></pre>
<ol start="2" class="calibre13">
<li value="2" class="calibre8">The second step is to create a list of items using the <span><kbd class="calibre11">ul</kbd> tag:</span></li>
</ol>
<pre class="calibre18"><span>&lt;</span><span>ul </span><span>class=</span><span>"navbar-nav"</span><span>&gt;&lt;/ul&gt;</span></pre>
<ol start="3" class="calibre13">
<li value="3" class="calibre8">The third step is to create the items using the <kbd class="calibre11">li</kbd> <span>tag. In our application, we have to activate tabs based on the user login condition, for example, a user profile tab will appear when the user logs in. We followed these conditions to activate tabs in our navigation bar:</span>
<ul class="calibre24">
<li class="calibre8"><strong class="calibre1">User not signed</strong>: We activated only the <span>about</span> and <span>login</span> tabs. A user can navigate to the signup page by clicking on the <span>SIGNUP</span> button.</li>
<li class="calibre8"><strong class="calibre1">User signed</strong>: We deactivated the login page and activated the user profile page.</li>
</ul>
</li>
</ol>
<p class="mce-root">In order to achieve these scenarios, we will access the authentication service object, check the user logged-in status, and activate the tabs. We use the <kbd class="calibre11">ngIf</kbd> directive for condition check: </p>
<pre class="calibre18"><span>&lt;</span><span>li </span><span>class=</span><span>"nav-item" </span><span>*ngIf=</span><span>"</span><span>authenticationService</span><span>?.</span><span>isAuthenticated</span><span>()"</span><span>&gt;&lt;</span><span>a </span><span>class=</span><span>"nav-link" </span><span>routerLink=</span><span>"/app-friends-userprofile" </span><span>routerLinkActive=</span><span>"active"</span><span>&gt;</span>My Profile<span>&lt;/</span><span>a</span><span>&gt;&lt;/</span><span>li</span><span>&gt;</span></pre>
<p class="mce-root"><span>The question mark in <kbd class="calibre11">authenticationService?</kbd> in <kbd class="calibre11">AuthenticationService</kbd> in the template ensures that the object is not null. This object is defined in <kbd class="calibre11">app.component.ts</kbd>, as shown in the following code:</span></p>
<pre class="calibre18"><span>authenticationService</span>: AuthenticationService;<br class="title-page-name"/><br class="title-page-name"/><span>constructor</span>(<span>private </span>authService: AuthenticationService) {<br class="title-page-name"/>   <span>this</span>.<span>authenticationService </span>= authService;<br class="title-page-name"/>}</pre>
<p class="mce-root">Here's the complete <kbd class="calibre11">app.component.html</kbd> as of now:</p>
<pre class="calibre18"><span>&lt;</span><span>h1 </span><span>class=</span><span>"title"</span><span>&gt;</span>Friends - A Social App<span>&lt;/</span><span>h1</span><span>&gt;</span><br class="title-page-name"/><span>&lt;</span><span>div </span><span>class=</span><span>"nav-container"</span><span>&gt;</span><br class="title-page-name"/><span>&lt;</span><span>nav </span><span>class=</span><span>"navbar navbar-expand-lg navbar-light bg-color"</span><span>&gt;</span><br class="title-page-name"/>  <span>&lt;</span><span>div </span><span>class=</span><span>"collapse navbar-collapse" </span><span>id=</span><span>"navbarNav"</span><span>&gt;</span><br class="title-page-name"/>    <span>&lt;</span><span>ul </span><span>class=</span><span>"navbar-nav"</span><span>&gt;</span><br class="title-page-name"/>      <span>&lt;</span><span>li </span><span>class=</span><span>"nav-item"<br class="title-page-name"/></span><span>      *ngIf=</span><span>"</span><span>authenticationService</span><span>?.</span><span>isAuthenticated</span><span>()"</span><span>&gt;&lt;</span><span>a <br class="title-page-name"/></span><span>      class=</span><span>"nav-link" </span><span>routerLink=</span><span>"/app-friends-userprofile" <br class="title-page-name"/></span><span>      routerLinkActive=</span><span>"active"</span><span>&gt;</span>My Profile<span>&lt;/</span><span>a</span><span>&gt;&lt;/</span><span>li</span><span>&gt;</span><br class="title-page-name"/>      <span>&lt;</span><span>li </span><span>class=</span><span>"nav-item" <br class="title-page-name"/></span><span>     *ngIf=</span><span>"</span><span>authenticationService</span><span>?.</span><span>isAuthenticated</span><span>()"</span><span>&gt;<br class="title-page-name"/>      &lt;</span><span>a </span><span>class=</span><span>"nav-link" </span><span>routerLink=</span><span>"/app-friends-userfriends" <br class="title-page-name"/></span><span>      routerLinkActive=</span><span>"active"</span><span>&gt;</span>Friends<span>&lt;/</span><span>a</span><span>&gt;&lt;/</span><span>li</span><span>&gt;</span><br class="title-page-name"/>      <span>&lt;</span><span>li </span><span>class=</span><span>"nav-item" </span><span>&gt;&lt;</span><span>a </span><span>class=</span><span>"nav-link" </span><span>routerLink=</span><span>"/app-<br class="title-page-name"/>      friends-about" </span><span>routerLinkActive=</span><span>"active"</span><span>&gt;</span>About<span>&lt;/</span><span>a</span><span>&gt;&lt;/</span><span>li</span><span>&gt;</span><br class="title-page-name"/>      <span>&lt;</span><span>li </span><span>class=</span><span>"nav-item" </span><span>active <br class="title-page-name"/>     *ngIf=</span><span>"!</span><span>authenticationService</span><span>?.</span><span>isAuthenticated</span><span>()"</span><span>&gt;<br class="title-page-name"/>      &lt;</span><span>a</span><span> class=</span><span>"nav-link" </span><span>routerLink=</span><span>"/app-friends-login" <br class="title-page-name"/></span><span>      routerLinkActive=</span><span>"active"</span><span>&gt;</span>Login<span>&lt;/</span><span>a</span><span>&gt;&lt;/</span><span>li</span><span>&gt;</span><br class="title-page-name"/>    <span>&lt;/</span><span>ul</span><span>&gt;</span><br class="title-page-name"/>    <span>&lt;</span><span>div </span><span>class=</span><span>"form-container"</span><span>&gt;</span><br class="title-page-name"/>    <span>&lt;</span><span>form </span><span>class=</span><span>"form-inline my-2 my-lg-0"</span><span>&gt;</span><br class="title-page-name"/>      <span>&lt;</span><span>input </span><span>class=</span><span>"form-control mr-sm-2" </span><span>type=</span><span>"text" <br class="title-page-name"/></span><span>      placeholder=</span><span>"Search friends..." </span><span>aria-label=</span><span>"Search"</span><span>&gt;</span><br class="title-page-name"/>      <span>&lt;</span><span>button </span><span>class=</span><span>"btn btn-success my-2 my-sm-0" <br class="title-page-name"/></span><span>      type=</span><span>"submit"</span><span>&gt;</span>Search<span>&lt;/</span><span>button</span><span>&gt;</span><br class="title-page-name"/>    <span>&lt;/</span><span>form</span><span>&gt;</span><br class="title-page-name"/>    <span>&lt;/</span><span>div</span><span>&gt;</span><br class="title-page-name"/>  <span>&lt;/</span><span>div</span><span>&gt;</span><br class="title-page-name"/><span>&lt;/</span><span>nav</span><span>&gt;</span><br class="title-page-name"/><span>&lt;/</span><span>div</span><span>&gt;</span><br class="title-page-name"/><span>&lt;</span><span>router-outlet</span><span>&gt;&lt;/</span><span>router-outlet</span><span>&gt;</span></pre>
<ul class="calibre7">
<li class="calibre8"><strong class="calibre1">Creating page not found and about component</strong>: The <kbd class="calibre11">PageNotFoundComponent</kbd> component is used to display the view for an incorrect URL and <kbd class="calibre11">AboutComponent</kbd> is used to display information about the site.</li>
</ul>
<p class="mce-root">Both these components look similar and have a message header with the<span> </span><kbd class="calibre11">h2</kbd><span> tag with text. In these components, we defined a template and style sheets in component annotation. This is one simple way to create the component.</span></p>
<p class="mce-root"><span>The following is the complete <kbd class="calibre11">page-not-found.component.ts</kbd></span>:</p>
<pre class="calibre18"><span>import </span>{Component} <span>from </span><span>'@angular/core'</span>;<br class="title-page-name"/><br class="title-page-name"/>@<span>Component</span>({<br class="title-page-name"/>  <span>selector</span>: <span>'app-friends-page-not-found'</span>,<br class="title-page-name"/>  <span>template</span>: <span>'&lt;h2&gt;Page not found&lt;/h2&gt;'<br class="title-page-name"/></span>})<br class="title-page-name"/><span>export class </span>PageNotFoundComponent {}</pre>
<p class="mce-root"><span>The following is the complete </span><kbd class="calibre11">about.component.ts</kbd>:</p>
<pre class="calibre18"><span>import </span>{Component} <span>from </span><span>'@angular/core'</span>;<br class="title-page-name"/><br class="title-page-name"/>@<span>Component</span>({<br class="title-page-name"/>  <span>selector</span>: <span>'app-friends-about'</span>,<br class="title-page-name"/>  <span>template</span>: <span>'&lt;h2&gt;Friends is a social app&lt;/h2&gt;'<br class="title-page-name"/></span>})<br class="title-page-name"/><span>export class </span>AboutComponent {}</pre>
<ul class="calibre7">
<li class="calibre8"><strong class="calibre1">Creating routes for an app component</strong>: We create routes for our main app module for the about and page not found components. </li>
</ul>
<p class="mce-root"><span>We</span><span> create the routes for two components with the following path as;</span><span> the double star (**) is a wildcard so that when the user provides any incorrect URL, the router navigates to the page not found component:</span></p>
<pre class="calibre18"><span>export const </span><span>ROUTES</span>: Routes = [<br class="title-page-name"/>  {<span>path</span>: <span>'app-friends-about'</span>, <span>component</span>: AboutComponent, <br class="title-page-name"/><span>   pathMatch</span>: <span>'full'</span>},<br class="title-page-name"/>  {<span>path</span>: <span>'**'</span>, <span>redirectTo</span>: <span>'app-friends-page-not-found'</span>},<br class="title-page-name"/>];</pre>
<p class="mce-root">We inject routes for the app module in Angular <kbd class="calibre11">RouterModule</kbd><span>; the complete </span><kbd class="calibre11">app.routing.ts</kbd><span> as of now is as follows:</span></p>
<pre class="calibre18"><span>import </span>{RouterModule, Routes} <span>from </span><span>'@angular/router'</span>;<br class="title-page-name"/><span>import </span>{NgModule} <span>from </span><span>'@angular/core'</span>;<br class="title-page-name"/><span>import </span>{PageNotFoundComponent} <span>from </span><span>'./notfound/page-not-found.component'</span>;<br class="title-page-name"/><span>import </span>{AboutComponent} <span>from </span><span>'./about/about.component'</span>;<br class="title-page-name"/><br class="title-page-name"/><span>export const </span><span>ROUTES</span>: Routes = [<br class="title-page-name"/>  {<span>path</span>: <span>'app-friends-about'</span>, <span>component</span>: AboutComponent,<br class="title-page-name"/>   <span>pathMatch</span>: <span>'full'</span>},<br class="title-page-name"/>  {<span>path</span>: <span>'**'</span>, <span>redirectTo</span>: <span>'app-friends-page-not-found'</span>},<br class="title-page-name"/>];<br class="title-page-name"/><br class="title-page-name"/>@<span>NgModule</span>({<br class="title-page-name"/>  <span>imports</span>: [<br class="title-page-name"/>    RouterModule.<span>forRoot</span>(<br class="title-page-name"/>      <span>ROUTES<br class="title-page-name"/></span><span>    </span>)],<br class="title-page-name"/>  <span>exports</span>: [<br class="title-page-name"/>    RouterModule<br class="title-page-name"/>  ]<br class="title-page-name"/>})<br class="title-page-name"/><span>export class </span>AppRouting {<br class="title-page-name"/>}</pre>
<p class="mce-root">Finally, we integrate the app routing module in our main app module. We add <kbd class="calibre11">AppRouting</kbd> in the import tag as follows: </p>
<pre class="calibre18">@NgModule({<br class="title-page-name"/>    <span>declarations</span>: [<br class="title-page-name"/>        AppComponent,<br class="title-page-name"/>        PageNotFoundComponent,<br class="title-page-name"/>        AboutComponent<br class="title-page-name"/>    ],<br class="title-page-name"/>    <span>imports</span>: [<br class="title-page-name"/>        ...<br class="title-page-name"/>        AuthenticationModule,<br class="title-page-name"/>        AppRouting<br class="title-page-name"/>    ],<br class="title-page-name"/>    <span>bootstrap</span>: [AppComponent]<br class="title-page-name"/>})<br class="title-page-name"/><span>export class </span>AppModule {}</pre>
<p class="mce-root">When the user is not logged in, the navigation bar will show the <span>About</span> and <span>Login</span> tabs:</p>
<div class="cdpaligncenter"><img src="../images/00020.jpeg" class="calibre41"/></div>
<p class="mce-root">When the user is logged in, the navigation bar will show the <span><span>My Profile,</span> <span>Friends</span>, </span>and <span>About</span> tabs:</p>
<div class="cdpaligncenter"><img src="../images/00021.jpeg" class="calibre42"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Creating a routing module for authentication</h1>
                
            
            <article>
                
<p class="calibre2">As discussed earlier, we will build the individual routes for each feature module. We have two components in authentication:</p>
<ul class="calibre7">
<li class="calibre8">Login Component</li>
<li class="calibre8">Signup Component</li>
</ul>
<p class="calibre2">In order to define the routing module, we will need to create routes constant for navigation:</p>
<pre class="calibre17"><span>export const </span><span>ROUTES</span>: Routes = [<br class="title-page-name"/>   {<span>path</span>: <span>'app-friends-login'</span>, <span>component</span>: LoginComponent},<br class="title-page-name"/>   {<span>path</span>: <span>'app-friends-signup'</span>, <span>component</span>: SignupComponent}<br class="title-page-name"/>];</pre>
<p class="calibre2">Since these routes are child components of the main app component, we inject the routes into the child router module:</p>
<pre class="calibre17">RouterModule.<span>forChild</span>( <span>ROUTES </span>)</pre>
<p class="calibre2"><span>Here's the complete </span><kbd class="calibre11">authentication.routing.ts</kbd><span> as of now:</span></p>
<pre class="calibre17"><span>import </span>{NgModule} <span>from </span><span>'@angular/core'</span>;<br class="title-page-name"/><span>import </span>{RouterModule, Routes} <span>from </span><span>'@angular/router'</span>;<br class="title-page-name"/><span>import </span>{LoginComponent} <span>from </span><span>'./login/login.component'</span>;<br class="title-page-name"/><span>import </span>{SignupComponent} <span>from </span><span>'./signup/signup.component'</span>;<br class="title-page-name"/><br class="title-page-name"/><span>export const </span><span>ROUTES</span>: Routes = [<br class="title-page-name"/>   {<span>path</span>: <span>'app-friends-login'</span>, <span>component</span>: LoginComponent},<br class="title-page-name"/>   {<span>path</span>: <span>'app-friends-signup'</span>, <span>component</span>: SignupComponent}<br class="title-page-name"/>];<br class="title-page-name"/><br class="title-page-name"/><span>/**<br class="title-page-name"/></span><span> * Authentication Routing Module<br class="title-page-name"/></span><span> */<br class="title-page-name"/></span>@<span>NgModule</span>({<br class="title-page-name"/>   <span>imports</span>: [<br class="title-page-name"/>      RouterModule.<span>forChild</span>(<span>ROUTES</span>)<br class="title-page-name"/>   ],<br class="title-page-name"/>   <span>exports</span>: [<br class="title-page-name"/>      RouterModule<br class="title-page-name"/>   ]<br class="title-page-name"/>})<br class="title-page-name"/><span>export class </span>AuthenticationRouting {}</pre>
<p class="calibre2">After creating the routing module, we include the <kbd class="calibre11">AuthenticationRouting</kbd> module in the main authentication module; this makes our authentication module independent of the main app module.</p>
<p class="calibre2">Here is a sample <kbd class="calibre11">authentication.module.ts</kbd>:</p>
<pre class="calibre17"><span>import </span>{ NgModule } <span>from </span><span>'@angular/core'</span>;<br class="title-page-name"/><span>import </span>{ AuthenticationRouting } <span>from </span><span>'./authentication.routing'</span>;<br class="title-page-name"/><br class="title-page-name"/><span>/**<br class="title-page-name"/></span><span> * Authentication Module<br class="title-page-name"/></span><span> */<br class="title-page-name"/></span>@<span>NgModule</span>({<br class="title-page-name"/>    <span>imports</span>: [<br class="title-page-name"/>        ...<br class="title-page-name"/>        AuthenticationRouting<br class="title-page-name"/>    ],<br class="title-page-name"/>    <span>declarations</span>: [<br class="title-page-name"/>        ...<br class="title-page-name"/>    ],<br class="title-page-name"/>    <span>providers</span>: [<br class="title-page-name"/>        ...<br class="title-page-name"/>    ]<br class="title-page-name"/>})<br class="title-page-name"/><span>export class </span>AuthenticationModule {<br class="title-page-name"/>}</pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Exploring more routing techniques</h1>
                
            
            <article>
                
<p class="calibre2">In this section, we will explore two navigation methods in our application:</p>
<ul class="calibre7">
<li class="calibre8"><strong class="calibre1">Static Routing</strong>: In static routing, we will provide the navigation in the HTML template. Angular router provides a directive to perform the navigation action. We will include the <kbd class="calibre11">routerLink</kbd> directive with we inject the routes into the child router module: path for navigation. As seen in the following code, when you click on the <kbd class="calibre11">SIGNUP</kbd> button, the Angular framework navigates to the signup component using <kbd class="calibre11">Router</kbd>:</li>
</ul>
<pre class="calibre18"><span>&lt;</span><span>button </span><span>routerLink=</span><span>"/app-friends-signup" </span><span>data-tag=</span><span>"signup-tag" </span><span>routerLinkActive=</span><span>"active" </span><span>class=</span><span>"btn btn-success"</span><span>&gt;</span><br class="title-page-name"/>SIGNUP<br class="title-page-name"/><span>&lt;/</span><span>button</span><span>&gt;</span></pre>
<ul class="calibre7">
<li class="calibre8"><strong class="calibre1">Dynamic Routing</strong>: In dynamic routing, we use the <kbd class="calibre11">Router</kbd> component of the Angular framework. The instance is injected using dependency injection in the constructor: </li>
</ul>
<pre class="calibre18"><span>constructor</span>(<br class="title-page-name"/>    ...<br class="title-page-name"/>    <span>private </span>router: Router,<br class="title-page-name"/>){}</pre>
<p class="mce-root">Router provides the <kbd class="calibre11">navigateByUrl()</kbd> method to route to different components; in the following scenario, after successful login, we navigate to the user profile page:</p>
<pre class="calibre18"><span>private </span><span>navigateToUserProfile</span>() {<br class="title-page-name"/>  <span>this</span>.router.<span>navigateByUrl</span>(<span>'/app-friends-userprofile'</span>);<br class="title-page-name"/>}</pre>
<p class="mce-root">Now we have added navigation to our application; thus, in the next section we add conditional-based navigation guards.  </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Adding authentication guards</h1>
                
            
            <article>
                
<p class="calibre2">Guard are a really useful feature in Angular for protecting routes. They provide the security feature used to restrict resources in our application so that the user is not able to consume a resource without proper permission.</p>
<p class="calibre2">There are different guard types in Angular:</p>
<ul class="calibre7">
<li class="calibre8"><kbd class="calibre11">CanActivate</kbd>: This is used to decide whether the route can be activated</li>
<li class="calibre8"><kbd class="calibre11">CanActivateChild</kbd>: This is used to decide whether the child route can be activated</li>
<li class="calibre8"><kbd class="calibre11">CanDeactivate</kbd>: This is used to decide whether the route can be deactivated</li>
<li class="calibre8"><kbd class="calibre11">CanLoad</kbd>: This is used to decide whether the module can be loaded lazily</li>
</ul>
<p class="calibre2">We will take a look at an example of the <kbd class="calibre11">CanActivate</kbd> guard in authentication. We will allow the user to access the user profile and friends pages only after their authentication is successful. This means that the user will not be allowed to access <kbd class="calibre11">http://localhost:4200/app-friends-userprofile</kbd> without authentication and will be redirected to the login page. The steps involved in activating the guard are as follows:</p>
<ol class="calibre13">
<li value="1" class="calibre8"><strong class="calibre1">Guard condition</strong>: We need to provide conditions for activating the guard. In this scenario, we are checking the current user status. This condition was also used in the app component to show various tabs based on the condition:</li>
</ol>
<pre class="calibre18"><span>public </span><span>isAuthenticated</span>(): <span>boolean </span>{<br class="title-page-name"/>    <span>let </span><span>user </span>= <span>this</span>.angularFireAuth.<span>auth</span>.<span>currentUser</span>;<br class="title-page-name"/>    <span>return </span><span>user </span>? <span>true </span>: <span>false</span>;<br class="title-page-name"/>}</pre>
<p class="mce-root"><span>Here's the complete </span><kbd class="calibre11">authentication.service.ts</kbd><span> as of now:</span></p>
<pre class="calibre18"><span>import </span>{Injectable} <span>from </span><span>'@angular/core'</span>;<br class="title-page-name"/><span>import </span>{AngularFireAuth} <span>from </span><span>'angularfire2/auth'</span>;<br class="title-page-name"/><br class="title-page-name"/><span>/**<br class="title-page-name"/></span><span> * Authentication service<br class="title-page-name"/></span><span> *<br class="title-page-name"/></span><span> */<br class="title-page-name"/></span>@<span>Injectable</span>()<br class="title-page-name"/><span>export class </span>AuthenticationService {<br class="title-page-name"/><br class="title-page-name"/>  <span>/**<br class="title-page-name"/></span><span>   * Constructor<br class="title-page-name"/></span><span>   *<br class="title-page-name"/></span><span>   * </span><span>@param </span><span>{AngularFireAuth} angularFireAuth provides the  <br class="title-page-name"/>     functionality related to authentication<br class="title-page-name"/></span><span>   */<br class="title-page-name"/></span><span>  </span><span>constructor</span>(<span>private </span>angularFireAuth: AngularFireAuth) {<br class="title-page-name"/>  }<br class="title-page-name"/><br class="title-page-name"/>  <span>public </span><span>signup</span>(email: <span>string</span>, password: <span>string</span>): Promise&lt;<span>any</span>&gt; {<br class="title-page-name"/>    <span>return <br class="title-page-name"/>    this</span>.angularFireAuth.<span>auth</span>.<span>createUserWithEmailAndPassword</span>(email, <br class="title-page-name"/>    password);<br class="title-page-name"/>  }<br class="title-page-name"/><br class="title-page-name"/>  <span>public </span><span>login</span>(email: <span>string</span>, password: <span>string</span>): Promise&lt;<span>any</span>&gt; {<br class="title-page-name"/>    <span>return <br class="title-page-name"/>    this</span>.angularFireAuth.<span>auth</span>.<span>signInWithEmailAndPassword</span>(email, <br class="title-page-name"/>    password);<br class="title-page-name"/>  }<br class="title-page-name"/><br class="title-page-name"/>  <span>public </span><span>resetPassword</span>(email: <span>string</span>): Promise&lt;<span>any</span>&gt; {<br class="title-page-name"/>    <span>return this</span>.angularFireAuth.<span>auth</span>.<span>sendPasswordResetEmail</span>(email);<br class="title-page-name"/>  }<br class="title-page-name"/><br class="title-page-name"/>  <span>public </span><span>isAuthenticated</span>(): <span>boolean </span>{<br class="title-page-name"/>    <span>const </span><span>user </span>= <span>this</span>.angularFireAuth.<span>auth</span>.<span>currentUser</span>;<br class="title-page-name"/>    <span>return </span><span>user </span>? <span>true </span>: <span>false</span>;<br class="title-page-name"/>  }<br class="title-page-name"/><br class="title-page-name"/>  <span>public </span><span>signout</span>() {<br class="title-page-name"/>    <span>return this</span>.angularFireAuth.<span>auth</span>.<span>signOut</span>();<br class="title-page-name"/>  }<br class="title-page-name"/>}</pre>
<ol start="2" class="calibre13">
<li value="2" class="calibre8"><strong class="calibre1">Guard implementation</strong><span>: We implement the guard by extending the </span><kbd class="calibre11">CanActivate</kbd><span> interface and overriding the </span><kbd class="calibre11">canActivate</kbd><span> method. In this method, we navigate to the login page when the user authentication is not valid and this helps route to the login page based on the guard condition.</span></li>
</ol>
<p class="mce-root"><span>Here's the complete </span><kbd class="calibre11">authentication.guard.ts</kbd><span> as of now:</span></p>
<pre class="calibre18"><span>import </span>{Injectable} <span>from </span><span>'@angular/core'</span>;<br class="title-page-name"/><span>import </span>{ActivatedRouteSnapshot, CanActivate, Router, RouterStateSnapshot} <span>from </span><span>'@angular/router'</span>;<br class="title-page-name"/><span>import </span>{AuthenticationService} <span>from </span><span>'./authentication.service'</span>;<br class="title-page-name"/><br class="title-page-name"/>@<span>Injectable</span>()<br class="title-page-name"/><span>export class </span>AuthenticationGuard <span>implements </span>CanActivate {<br class="title-page-name"/><br class="title-page-name"/>  <span>constructor</span>(<span>private </span>authService: AuthenticationService,<br class="title-page-name"/>              <span>private </span>router: Router) {<br class="title-page-name"/>  }<br class="title-page-name"/><br class="title-page-name"/>  <span>canActivate</span>(route: ActivatedRouteSnapshot, state: <br class="title-page-name"/>  RouterStateSnapshot): <span>boolean </span>{<br class="title-page-name"/>    <span>const </span><span>isLoggedIn</span>: <span>boolean </span>= <span>this</span>.authService.<span>isAuthenticated</span>();<br class="title-page-name"/>    <span>if </span>(!<span>isLoggedIn</span>) {<br class="title-page-name"/>      <span>this</span>.router.<span>navigateByUrl</span>(<span>'/app-friends-login'</span>);<br class="title-page-name"/>    }<br class="title-page-name"/>    <span>return </span><span>isLoggedIn</span>;<br class="title-page-name"/>  }<br class="title-page-name"/>}</pre>
<ol start="3" class="calibre13">
<li value="3" class="calibre8"><strong class="calibre1">Adding a guard to the user module</strong><span>: This guard is added in the user module. The user module is covered in the next chapter in more detail. Here, we configure a guard in the user routing module to restrict the user to accessing the user profile and friends pages:</span></li>
</ol>
<pre class="calibre18"><span>import </span>{AuthenticationGuard} <span>from </span><span>'../services/authentication.guard'</span>;<br class="title-page-name"/><br class="title-page-name"/><span>/**<br class="title-page-name"/></span><span> * User Module<br class="title-page-name"/></span><span> */<br class="title-page-name"/></span>@<span>NgModule</span>({<br class="title-page-name"/>    <span>imports</span>: [<br class="title-page-name"/>        ...<br class="title-page-name"/>    ],<br class="title-page-name"/>    <span>declarations</span>: [<br class="title-page-name"/>        ...<br class="title-page-name"/>    ],<br class="title-page-name"/>    <span>providers</span>: [<br class="title-page-name"/>        AuthenticationGuard<br class="title-page-name"/>    ]<br class="title-page-name"/>})<br class="title-page-name"/><span>export class </span>UserModule {<br class="title-page-name"/>}</pre>
<ol start="4" class="calibre13">
<li value="4" class="calibre8"><strong class="calibre1">Adding a guard to protect the component</strong>: As shown in the following code, we can add this guard to any component that requires this condition check. We add the guard to the user profile and user friend list component. This means that these pages are protected from illegal access.</li>
</ol>
<p class="mce-root">Here is the complete <kbd class="calibre11">user-routing.module.ts</kbd>:</p>
<pre class="calibre18"><span>import </span>{ NgModule } <span>from </span><span>'@angular/core'</span>;<br class="title-page-name"/><span>import </span>{ Routes, RouterModule } <span>from </span><span>'@angular/router'</span>;<br class="title-page-name"/><span>import </span>{UserProfileComponent} <span>from </span><span>'./user-profile/user-profile.component'</span>;<br class="title-page-name"/><span>import </span>{AuthenticationGuard} <span>from </span><span>'../services/authentication.guard'</span>;<br class="title-page-name"/><br class="title-page-name"/><span>const </span><span>ROUTES</span>: Routes = [<br class="title-page-name"/>  {<span>path</span>: <span>''</span>, <span>redirectTo</span>: <span>'/app-friends-userprofile'</span>, <span>pathMatch</span>: <br class="title-page-name"/><span>  'full' </span>, <span>canActivate</span>: [AuthenticationGuard]},<br class="title-page-name"/>  {<span>path</span>: <span>'app-friends-userprofile'</span>, <span>component</span>: UserProfileComponent <br class="title-page-name"/>   , <span>canActivate</span>: [AuthenticationGuard]}<br class="title-page-name"/><br class="title-page-name"/>];<br class="title-page-name"/><br class="title-page-name"/>@<span>NgModule</span>({<br class="title-page-name"/>  <span>imports</span>: [<br class="title-page-name"/>    RouterModule.<span>forChild</span>(<span>ROUTES</span>)<br class="title-page-name"/>  ],<br class="title-page-name"/>  <span>exports</span>: [<br class="title-page-name"/>    RouterModule<br class="title-page-name"/>  ],<br class="title-page-name"/>  <span>providers</span>: [<br class="title-page-name"/>    AuthenticationGuard<br class="title-page-name"/>  ]<br class="title-page-name"/>})<br class="title-page-name"/><span>export class </span>UserRoutingModule { }</pre>
<ol start="5" class="calibre13">
<li class="calibre8" value="5"><strong class="calibre1">Testing the guard</strong>: You can test this guard by pasting the user profile URL<span> (</span><kbd class="calibre11">http://localhost:4200/app-friends-userprofile</kbd><span>)</span> into the browser, and the user is redirected to the login page for authentication.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Firebase session lifecycle</h1>
                
            
            <article>
                
<p class="calibre2">Firebase persists the user state, hence the user is always logged in even if they refresh or restart the page again, and the page is redirected to the main page instead of the login page. We will cover two navigation scenarios for a Firebase session life cycle:</p>
<ul class="calibre7">
<li class="calibre8"><strong class="calibre1">User token exists</strong>: In this scenario, the user token is still valid and the user is redirected to the user profile page. </li>
</ul>
<p class="mce-root"><kbd class="calibre11">AngularFireAuth.auth</kbd> provides the <kbd class="calibre11">onAuthStateChanged</kbd> method to know user state information. We subscribe to this method, check for our user, and redirect them to the profile page.</p>
<p class="mce-root">Here's is a sample of <kbd class="calibre11">login.component.ts</kbd>:</p>
<pre class="calibre18"><span>import </span>{Component} <span>from </span><span>'@angular/core'</span>;<br class="title-page-name"/><span>import </span>{User} <span>from </span><span>'../../services/user'</span>;<br class="title-page-name"/><span>import </span>{Router} <span>from </span><span>'@angular/router'</span>;<br class="title-page-name"/><span>import </span>{AuthenticationService} <span>from </span><span>'../../services/authentication.service'</span>;<br class="title-page-name"/><span>import </span>{UserService} <span>from </span><span>'../../services/user.service'</span>;<br class="title-page-name"/><span>import </span>{AngularFireAuth} <span>from </span><span>'angularfire2/auth'</span>;<br class="title-page-name"/><br class="title-page-name"/>@<span>Component</span>({<br class="title-page-name"/>  <span>selector</span>: <span>'app-friends-login'</span>,<br class="title-page-name"/>  <span>styleUrls</span>: [<span>'login.component.scss'</span>],<br class="title-page-name"/>  <span>templateUrl</span>: <span>'login.component.html'</span>,<br class="title-page-name"/>})<br class="title-page-name"/><span>export class </span>LoginComponent {<br class="title-page-name"/><br class="title-page-name"/>  ...<br class="title-page-name"/><br class="title-page-name"/>  <span>private </span><span>user</span>: User;<br class="title-page-name"/><br class="title-page-name"/>  <span>constructor</span>(<span>private </span>userService: UserService,<br class="title-page-name"/>              <span>private </span>router: Router,<br class="title-page-name"/>              <span>private </span>authService: AuthenticationService,<br class="title-page-name"/>              <span>private </span>angularFireAuth: AngularFireAuth) {<br class="title-page-name"/>    <span>this</span>.angularFireAuth.<span>auth</span>.<span>onAuthStateChanged</span>(user =&gt; {<br class="title-page-name"/>      <span>if </span>(user) {<br class="title-page-name"/>        <span>this</span>.<span>getUserInfo</span>(user.<span>uid</span>);<br class="title-page-name"/>      }<br class="title-page-name"/>    });<br class="title-page-name"/>  }<br class="title-page-name"/><br class="title-page-name"/>  <span>private </span><span>navigateToUserProfile</span>() {<br class="title-page-name"/>    <span>this</span>.router.<span>navigateByUrl</span>(<span>'/app-friends-userprofile'</span>);<br class="title-page-name"/>  }<br class="title-page-name"/><br class="title-page-name"/>  <span>private </span><span>getUserInfo</span>(uid: <span>string</span>) {<br class="title-page-name"/>    <span>this</span>.userService.<span>getUser</span>(uid).<span>subscribe</span>(snapshot =&gt; {<br class="title-page-name"/>      <span>this</span>.<span>user </span>= snapshot;<br class="title-page-name"/>      <span>this</span>.<span>navigateToUserProfile</span>();<br class="title-page-name"/>    });<br class="title-page-name"/>  }<br class="title-page-name"/>}</pre>
<ul class="calibre7">
<li class="calibre8"><strong class="calibre1">User token expires</strong>: In this scenario, the user token expires and the user is redirected to the login page. <span>Normally, the user token expires on the following conditions:</span> 
<ul class="calibre24">
<li class="calibre8"><strong class="calibre1">User clears browsing history</strong><span>: The user token can </span><span>expire</span><span><span> by clearing the browser history. This will clear the token and the user is redirected to the login page.</span></span></li>
<li class="calibre8"><strong class="calibre1">User changes the password</strong>: When a user changes the password, the user token expires and they are directed to the login page. This scenario is covered in the next chapter.</li>
<li class="calibre8"><strong class="calibre1">User sign out</strong>: When a user signs out, the user token expires and they are directed to the login page. We will cover this scenario in this section.</li>
</ul>
</li>
</ul>
<p class="calibre2">We have implemented the sign-out functionality in the user profile page. The user profile component is covered in more detail in the next chapter. In this section, we will add only a sign-out feature.</p>
<p class="calibre2">We create a button in the user profile template. When the user clicks on the <span>LOGOUT</span> button, the user session is cleared and the users are redirected to the login page.</p>
<p class="calibre2">Here's is sample <kbd class="calibre11">user-profile.component.html</kbd>:</p>
<pre class="calibre17"><span>&lt;</span><span>div </span><span>class=</span><span>"user-profile"</span><span>&gt;</span><br class="title-page-name"/>    <span>&lt;</span><span>div </span><span>class=</span><span>"user-profile-btn"</span><span>&gt;</span><br class="title-page-name"/>        <span>&lt;</span><span>button </span><span>type=</span><span>"button" </span><span>(click)=</span><span>'</span><span>onLogout</span><span>()' </span><span>class=</span><span>"btn btn-<br class="title-page-name"/>         info"</span><span>&gt;</span>LOGOUT<span>&lt;/</span><span>button</span><span>&gt;</span><br class="title-page-name"/>    <span>&lt;/</span><span>div</span><span>&gt;</span><br class="title-page-name"/><span>&lt;/</span><span>div</span><span>&gt;</span></pre>
<p class="calibre2">When the user clicks on the <span>LOGOUT</span> button, then <kbd class="calibre11">onLogout()</kbd> method of <kbd class="calibre11">UserProfileComponent</kbd> is called and we call <kbd class="calibre11">signout</kbd>() in the authentication service.</p>
<p class="calibre2"><span>Here's the sample </span><kbd class="calibre11">user-profile.component.ts</kbd><span> as of now:</span></p>
<pre class="calibre17"><span>import </span>{Component, OnInit} <span>from </span><span>'@angular/core'</span>;<br class="title-page-name"/><span>import </span>{AuthenticationService} <span>from </span><span>'../../services/authentication.service'</span>;<br class="title-page-name"/><span>import </span>{Router} <span>from </span><span>'@angular/router'</span>;<br class="title-page-name"/><br class="title-page-name"/>@<span>Component</span>({<br class="title-page-name"/>  <span>selector</span>: <span>'app-friends-userprofile'</span>,<br class="title-page-name"/>  <span>styleUrls</span>: [<span>'user-profile.component.scss'</span>],<br class="title-page-name"/>  <span>templateUrl</span>: <span>'user-profile.component.html'<br class="title-page-name"/></span>})<br class="title-page-name"/><span>export class </span>UserProfileComponent {<br class="title-page-name"/><br class="title-page-name"/>  <span>constructor</span>(<span>private </span>authService: AuthenticationService,<br class="title-page-name"/>              <span>private </span>router: Router) {<br class="title-page-name"/>  }<br class="title-page-name"/><br class="title-page-name"/>  <span>onLogout</span>(): <span>void </span>{<br class="title-page-name"/>    <span>this</span>.authService.<span>signout</span>().<span>then</span>(() =&gt; {<br class="title-page-name"/>      <span>this</span>.<span>navigateToLogin</span>();<br class="title-page-name"/>    });<br class="title-page-name"/>  }<br class="title-page-name"/><br class="title-page-name"/>  <span>navigateToLogin</span>() {<br class="title-page-name"/>    <span>this</span>.router.<span>navigateByUrl</span>(<span>'/app-friends-login'</span>);<br class="title-page-name"/>  }<br class="title-page-name"/>}</pre>
<p class="calibre2">The authentication service has a sign-out functionality in <kbd class="calibre11">authentication.service.ts</kbd>:</p>
<pre class="calibre17"><span>public </span><span>signout</span>(): Promise&lt;<span>any</span>&gt; {<br class="title-page-name"/>    <span>return this</span>.<span>angularFireAuth</span>.<span>auth</span>.<span>signOut</span>();<br class="title-page-name"/>}</pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Our project structure as of now</h1>
                
            
            <article>
                
<p class="calibre2">We thus come to the end of our first authentication module. Our authentication module will be as follows:</p>
<div class="cdpaligncenter"><img src="../images/00022.jpeg" class="calibre43"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Summary</h1>
                
            
            <article>
                
<p class="calibre2">In this chapter, we learned about navigation between page views. We enabled navigation in the base module. We used the router link directive to create our main navigation bar. We saw how to access component variables in the template and enabled navigation items based on the condition. We built our first guard to restrict our user to navigating to our user profile page so that only authenticated users are allowed to view the page. Finally, we covered the Firebase session life cycle and implemented navigation based on a user token. Finally, we explored the project structure for the authentication module.</p>
<p class="calibre2">In the next chapter, we will build more complex modules and explore more features of Firebase and Angular.</p>


            </article>

            
        </section>
    </body></html>