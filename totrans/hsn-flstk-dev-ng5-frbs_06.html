<html><head></head><body>
        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Creating a User's Friend List</h1>
                
            
            <article>
                
<p class="calibre2">In this chapter, we will move toward the more advanced features in Angular and Firebase. We will retrieve our user's friend list using a Firebase list. We will display the friend list in a card component provided by Bootstrap. We will implement the pagination concept using a Firebase filter. Finally, we will discuss Angular pipes.</p>
<p class="calibre2">In this chapter, we will cover the following topics:</p>
<ul class="calibre7">
<li class="calibre8">Creating user's friend template</li>
<li class="calibre8">Creating the friend's service</li>
<li class="calibre8">Creating the friends component</li>
<li class="calibre8">Creating our first date pipe</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Creating user's friend template</h1>
                
            
            <article>
                
<p class="calibre2">In this section, we will cover a slightly more complex template using a Bootstrap card component. We will retrieve the friend's list of a defined size and display the user's friend list in a card item. We will call the Firebase API to get three items and loop the friend's list using an <kbd class="calibre11">*ngFor</kbd> directive.</p>
<p class="calibre2">Card is a flexible and extensible container. It has an option to display the header, footer, title, and so on. We will use the following properties of the card component:</p>
<ul class="calibre7">
<li class="calibre8"><kbd class="calibre11">card-img-top</kbd>: This is used to display the friend's image on the top.</li>
<li class="calibre8"><kbd class="calibre11">card-title</kbd>: This <span>is used to</span> display the friend's name.</li>
<li class="calibre8"><kbd class="calibre11">card-text</kbd>: This<span> is used to</span> display their email and phone number.</li>
<li class="calibre8"><kbd class="calibre11">card-footer</kbd>: This<span> is used to</span> display the date using a custom pipe. We will implement custom pipe in a later part of this chapter.</li>
</ul>
<pre class="calibre17"><span>&lt;</span><span>div </span><span>*ngFor=</span><span>"let </span><span>friend</span><span> of </span><span>friends</span><span>" </span><span>class=</span><span>"card"</span><span>&gt;</span><br class="title-page-name"/>    <span>&lt;</span><span>img </span><span>class=</span><span>"card-img-top"  </span><span>src=</span><span>{{</span><span>friend</span><span>.</span><span>image</span><span>}} <br class="title-page-name"/></span><span>     alt=</span><span>"Card image cap"</span><span>&gt;</span><br class="title-page-name"/>    <span>&lt;</span><span>div </span><span>class=</span><span>"card-block"</span><span>&gt;</span><br class="title-page-name"/>        <span>&lt;</span><span>h4 </span><span>class=</span><span>"card-title"</span><span>&gt;</span>{{<span>friend</span>.<span>name</span>}}<span>&lt;/</span><span>h4</span><span>&gt;</span><br class="title-page-name"/>        <span>&lt;</span><span>p </span><span>class=</span><span>"card-text"</span><span>&gt;</span>{{<span>friend</span>.<span>email</span>}} | {{<span>friend</span>.<span>mobile</span>}}<span>&lt;/</span><span>p</span><span>&gt;</span><br class="title-page-name"/>    <span>&lt;/</span><span>div</span><span>&gt;</span><br class="title-page-name"/>    <span>&lt;</span><span>div </span><span>class=</span><span>"card-footer"</span><span>&gt;</span><br class="title-page-name"/>        <span>&lt;</span><span>small </span><span>class=</span><span>"text-muted"</span><span>&gt;</span>Friends from {{<span>friend</span>.<span>time </span>| <br class="title-page-name"/><span>         friendsdate</span>}}<span>&lt;/</span><span>small</span><span>&gt;</span><br class="title-page-name"/>    <span>&lt;/</span><span>div</span><span>&gt;</span><br class="title-page-name"/><span>&lt;/</span><span>div</span><span>&gt;</span></pre>
<p class="calibre2">After we display the first page, we need the left and right icon to scroll to the next and previous page. These icons will be visible based on the total items in the list, and <kbd class="calibre11">isLeftVisible</kbd> will be set from the <kbd class="calibre11">component</kbd> class:</p>
<pre class="calibre17"><span>&lt;</span><span>div </span><span>*ngIf=</span><span>"</span><span>isLeftVisible</span><span>" </span><span>(click)=</span><span>"</span><span>onLeft</span><span>()" </span><span>class=</span><span>"left"</span><span>&gt;&lt;/div&gt;</span></pre>
<p class="calibre2"><span>Here's the complete <kbd class="calibre11">user-friends.component.html</kbd></span> file<span>:</span></p>
<pre class="calibre17"><span>&lt;</span><span>div </span><span>class=</span><span>"main_container"</span><span>&gt;</span><br class="title-page-name"/>    <span>&lt;</span><span>div </span><span>*ngIf=</span><span>"</span><span>friends</span><span>" </span><span>class=</span><span>"content_container"</span><span>&gt;</span><br class="title-page-name"/>        <span>&lt;</span><span>div </span><span>*ngIf=</span><span>"</span><span>isLeftVisible</span><span>" </span><span>(click)=</span><span>"</span><span>onLeft</span><span>()" </span><span>class=</span><span>"left"</span><span>&gt;</span><br class="title-page-name"/>            <span>&lt;</span><span>img </span><span>src=</span><span>"assets/images/left.png"</span><span>&gt;</span><br class="title-page-name"/>        <span>&lt;/</span><span>div</span><span>&gt;</span><br class="title-page-name"/>        <span>&lt;</span><span>div </span><span>class=</span><span>"card-deck list"</span><span>&gt;</span><br class="title-page-name"/>            <span>&lt;</span><span>div </span><span>*ngFor=</span><span>"let </span><span>friend</span><span> of </span><span>friends</span><span>" </span><span>class=</span><span>"card"</span><span>&gt;</span><br class="title-page-name"/>                <span>&lt;</span><span>img </span><span>class=</span><span>"card-img-top"  </span><span>src=</span><span>{{</span><span>friend</span><span>.</span><span>image</span><span>}} <br class="title-page-name"/></span><span>                 alt=</span><span>"Card image cap"</span><span>&gt;</span><br class="title-page-name"/>                <span>&lt;</span><span>div </span><span>class=</span><span>"card-block"</span><span>&gt;</span><br class="title-page-name"/>                    <span>&lt;</span><span>h4 </span><span>class=</span><span>"card-title"</span><span>&gt;</span>{{<span>friend</span>.<span>name</span>}}<span>&lt;/</span><span>h4</span><span>&gt;</span><br class="title-page-name"/>                    <span>&lt;</span><span>p </span><span>class=</span><span>"card-text"</span><span>&gt;</span>{{<span>friend</span>.<span>email</span>}} | <br class="title-page-name"/>                     {{<span>friend</span>.<span>mobile</span>}}<span>&lt;/</span><span>p</span><span>&gt;</span><br class="title-page-name"/>                <span>&lt;/</span><span>div</span><span>&gt;</span><br class="title-page-name"/>                <span>&lt;</span><span>div </span><span>class=</span><span>"card-footer"</span><span>&gt;</span><br class="title-page-name"/>                    <span>&lt;</span><span>small </span><span>class=</span><span>"text-muted"</span><span>&gt;</span>Friends from <br class="title-page-name"/>                     {{<span>friend</span>.<span>time </span>| <span>friendsdate</span>}}<span>&lt;/</span><span>small</span><span>&gt;</span><br class="title-page-name"/>                <span>&lt;/</span><span>div</span><span>&gt;</span><br class="title-page-name"/>            <span>&lt;/</span><span>div</span><span>&gt;</span><br class="title-page-name"/>        <span>&lt;/</span><span>div</span><span>&gt;</span><br class="title-page-name"/>        <span>&lt;</span><span>div </span><span>*ngIf=</span><span>"</span><span>isRightVisible</span><span>" </span><span>(click)=</span><span>"</span><span>onRight</span><span>()" </span><span>class=</span><span>"right"</span><span>&gt;</span><br class="title-page-name"/>            <span>&lt;</span><span>img </span><span>src=</span><span>"assets/images/right.png"</span><span>&gt;</span><br class="title-page-name"/>        <span>&lt;/</span><span>div</span><span>&gt;</span><br class="title-page-name"/>    <span>&lt;/</span><span>div</span><span>&gt;</span><br class="title-page-name"/>    <span>&lt;</span><span>div </span><span>*ngIf=</span><span>"!</span><span>friends</span><span> || </span><span>friends</span><span>.length === 0" <br class="title-page-name"/></span><span>     class=</span><span>"no_info_container"</span><span>&gt;</span><br class="title-page-name"/>        <span>&lt;</span><span>h1</span><span>&gt;</span>No friends in your list<span>&lt;/</span><span>h1</span><span>&gt;</span><br class="title-page-name"/>    <span>&lt;/</span><span>div</span><span>&gt;</span><br class="title-page-name"/><span>&lt;/</span><span>div</span><span>&gt;</span></pre>
<p class="calibre2">We assign class selectors to apply styles to the elements. In the friends list page, we align the elements horizontally using <kbd class="calibre11">display:inline</kbd>. Also, the left icon, card list, and right icon are displayed one after another, so we use <kbd class="calibre11">float: left</kbd>.</p>
<p class="calibre2"><span>Here's the complete <kbd class="calibre11">user-friends.component.scss</kbd> </span><span>as of now:</span></p>
<pre class="calibre17">.<span>main_container </span>{<br class="title-page-name"/>    <span>margin-top</span>: <span>10</span><span>px</span>;<br class="title-page-name"/>    <span>margin-left</span>: <span>80</span><span>px</span>;<br class="title-page-name"/>    .<span>content_container </span>{<br class="title-page-name"/>        <span>display</span>: <span>inline</span>;<br class="title-page-name"/>        .<span>list </span>{<br class="title-page-name"/>            <span>float</span>: <span>left</span>;<br class="title-page-name"/>            .<span>card-img-top </span>{<br class="title-page-name"/>                <span>height</span>: <span>180</span><span>px</span>;<br class="title-page-name"/>                <span>width</span>: <span>260</span><span>px</span>;<br class="title-page-name"/>                <span>background-image</span>: <br class="title-page-name"/><span>                url</span>(<span>'../../../assets/images/person.png'</span>);<br class="title-page-name"/>            }<br class="title-page-name"/>        }<br class="title-page-name"/><br class="title-page-name"/>        .<span>left </span>{<br class="title-page-name"/>            <span>float</span>: <span>left</span>;<br class="title-page-name"/>            <span>margin-top</span>: <span>140</span><span>px</span>;<br class="title-page-name"/>        }<br class="title-page-name"/><br class="title-page-name"/>        .<span>right </span>{<br class="title-page-name"/>            <span>float</span>: <span>left</span>;<br class="title-page-name"/>            <span>margin-top</span>: <span>140</span><span>px</span>;<br class="title-page-name"/>        }<br class="title-page-name"/>    }<br class="title-page-name"/>}</pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Creating the friend's service</h1>
                
            
            <article>
                
<p class="calibre2">We will introduce one more service as part of our friend's component. This will fetch friend's details from the Firebase. In this section, we will cover the following topics:</p>
<ul class="calibre7">
<li class="calibre8">Creating a Firebase node in our database</li>
<li class="calibre8">Implementing the <kbd class="calibre11">Friend</kbd> class</li>
<li class="calibre8">Implementing the friend's service</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Creating a Firebase node in our database</h1>
                
            
            <article>
                
<p class="calibre2">Now, we have prefilled the friend's details in the Firebase as shown in the next image. We introduced a separate node called <kbd class="calibre11">user-details</kbd>. T<span>his will store all the user's information, and we don't need to query the user node for more information, as this increases the query performance.</span></p>
<p class="calibre2">The following are a few key observations for this instance of Firebase:</p>
<ul class="calibre7">
<li class="calibre8">We have not implemented the <span>add friend</span> feature; hence we will add the friend's information manually.</li>
<li class="calibre8">We use the UID relationship to list the friends of a user. In this case, the UID <kbd class="calibre11">qu3bXn9tTJR7j4PBp9LzBGKxHAe2</kbd> is the user ID and the other UID—<kbd class="calibre11">8wcVXYmEDQdqbaJ12BPmpsCmBMB2</kbd><span>—</span>is the friend's ID that is generated when the friend signs up to the application.</li>
<li class="calibre8">In Firebase, we repeat a lot of data. This is a common pattern while organizing data in a NoSQL database, as this avoids multiple hits to the database. Although i<span><span>t increases the write time, it helps our app to scale when reading data. It prevents large queries that slow down our database and nested nodes that take longer to read.</span></span></li>
</ul>
<p class="calibre2">The friends node in the Firebase database is as follows:</p>
<div class="cdpaligncenter"><img src="../images/00025.gif" class="calibre48"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Implementing the Friend model class</h1>
                
            
            <article>
                
<p class="calibre2">We will implement the <kbd class="calibre11">Friend</kbd> model class to map an array of friend's JSON object from Firebase. This class is similar to the <kbd class="calibre11">User</kbd> model class, and it is a good practice to segregate the responsibility in a separate class.</p>
<p class="calibre2">This class has <kbd class="calibre11">name</kbd>, <kbd class="calibre11">email</kbd>, <kbd class="calibre11">mobile</kbd>, <kbd class="calibre11">uid</kbd>, <kbd class="calibre11">time</kbd>, and <kbd class="calibre11">image</kbd> properties. The time property is used to show the duration of friendship and is stored in milliseconds. We will need to convert the time in milliseconds to a human-readable date format using an Angular pipe.</p>
<p class="calibre2">The following is the complete <kbd class="calibre11">friend.ts</kbd> file:</p>
<pre class="calibre17"><span>export class </span>Friend {<br class="title-page-name"/><br class="title-page-name"/>   <span>name</span>: <span>string</span>;<br class="title-page-name"/><br class="title-page-name"/>   <span>mobile</span>: <span>string</span>;<br class="title-page-name"/><br class="title-page-name"/>   <span>email</span>: <span>string</span>;<br class="title-page-name"/><br class="title-page-name"/>   <span>uid</span>: <span>string</span>;<br class="title-page-name"/><br class="title-page-name"/>   <span>time</span>: <span>string</span>;<br class="title-page-name"/><br class="title-page-name"/>   <span>image</span>: <span>string</span>;<br class="title-page-name"/><br class="title-page-name"/>   <span>constructor</span>(name: <span>string</span>,<br class="title-page-name"/>            mobile: <span>string</span>,<br class="title-page-name"/>            email: <span>string</span>,<br class="title-page-name"/>            uid: <span>string</span>,<br class="title-page-name"/>            time: <span>string</span>,<br class="title-page-name"/>            image: <span>string</span>) {<br class="title-page-name"/>      <span>this</span>.<span>name </span>= name;<br class="title-page-name"/>      <span>this</span>.<span>mobile </span>= mobile;<br class="title-page-name"/>      <span>this</span>.<span>email </span>= email;<br class="title-page-name"/>      <span>this</span>.<span>uid </span>= uid;<br class="title-page-name"/>      <span>this</span>.<span>time </span>= time;<br class="title-page-name"/>      <span>this</span>.<span>image </span>= image;<br class="title-page-name"/><br class="title-page-name"/>   }<br class="title-page-name"/><br class="title-page-name"/>}</pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Implementing the friend's service</h1>
                
            
            <article>
                
<p class="calibre2">As a part of this service, we will need to retrieve a list of friends. <kbd class="calibre11">AngularFireDatabase</kbd> provides a list API to retrieve the list of friends. This service consists of the following three methods to give us complete pagination functionalities:</p>
<ul class="calibre7">
<li class="calibre8"><strong class="calibre1">Retrieving the first page</strong>: The <kbd class="calibre11">getFirstPage()</kbd> method accepts <kbd class="calibre11">uid</kbd> and <kbd class="calibre11">pageSize</kbd> as parameters. These are used to retrieve the first <kbd class="calibre11">pageSize</kbd> data from Firebase. We pass the <kbd class="calibre11">pageSize</kbd> in the second argument of the query function:</li>
</ul>
<pre class="calibre18"><span>getFirstPage</span>(uid: <span>string</span>, pageSize: <span>number</span>): Observable&lt;Friend[]&gt; <br class="title-page-name"/>{<br class="title-page-name"/>  <span>return this</span>.fireDb.<span>list</span>&lt;Friend&gt; <br class="title-page-name"/>  (<span>`</span>${<span>USER_DETAILS_CHILD</span>}<span>/</span>${<span>FRIENDS_CHILD</span>}<span>/</span>${uid}<span>`</span>,<br class="title-page-name"/>    ref =&gt; ref.<span>limitToFirst</span>(pageSize)<br class="title-page-name"/>  ).<span>valueChanges</span>();<br class="title-page-name"/>}</pre>
<ul class="calibre7">
<li class="calibre8"><strong class="calibre1">Retrieving the next page:</strong> <kbd class="calibre11">loadNextPage()</kbd> accepts <kbd class="calibre11">uid</kbd>, <kbd class="calibre11">friendKey</kbd>, and <kbd class="calibre11">pageSize</kbd>. <kbd class="calibre11">uid</kbd> and <kbd class="calibre11">friendKey</kbd> are used to set the queries. This means that they retrieve the next <kbd class="calibre11">pageSize</kbd> data from the last retrieved <kbd class="calibre11">friendKey</kbd> data:</li>
</ul>
<pre class="calibre18"><span>loadNextPage</span>(uid: <span>string</span>, friendKey: <span>string</span>, pageSize: <span>number</span>): Observable&lt;Friend[]&gt; {<br class="title-page-name"/>  <span>return this</span>.fireDb.<span>list</span>&lt;Friend&gt;<br class="title-page-name"/>  (<span>`</span>${<span>USER_DETAILS_CHILD</span>}<span>/</span>${<span>FRIENDS_CHILD</span>}<span>/</span>${uid}<span>`</span>,<br class="title-page-name"/>    ref =&gt; ref.<span>orderByKey</span>().<span>startAt</span>(friendKey)<br class="title-page-name"/>           .<span>limitToFirst</span>(pageSize + <span>1</span>)<br class="title-page-name"/>  ).<span>valueChanges</span>();<br class="title-page-name"/>}</pre>
<ul class="calibre7">
<li class="calibre8"><strong class="calibre1">Retrieving the previous page:<span> </span></strong><kbd class="calibre11">loadPreviousPage()</kbd> method accepts <kbd class="calibre11">uid</kbd>, <kbd class="calibre11">friendKey</kbd>, and <kbd class="calibre11">pageSize</kbd>. The last two parameters are used to retrieve the previous <kbd class="calibre11">pageSize</kbd> data from the starting <kbd class="calibre11">friendKey</kbd> element:</li>
</ul>
<pre class="calibre18"><span>loadPreviousPage</span>(uid: <span>string</span>, friendKey: <span>string</span>, pageSize: <span>number</span>): Observable&lt;Friend[]&gt; {<br class="title-page-name"/>  <span>return this</span>.fireDb.<span>list</span>&lt;Friend&gt;<br class="title-page-name"/>  (<span>`</span>${<span>USER_DETAILS_CHILD</span>}<span>/</span>${<span>FRIENDS_CHILD</span>}<span>/</span>${uid}<span>`</span>,<br class="title-page-name"/>    ref =&gt; ref.<span>orderByKey</span>().<span>startAt</span>(friendKey)<br class="title-page-name"/>           .<span>limitToLast</span>(pageSize + <span>1</span>)<br class="title-page-name"/>  ).<span>valueChanges</span>();<br class="title-page-name"/>}</pre>
<p class="calibre2"><span>Here's the complete <kbd class="calibre11">friends.service.ts</kbd></span><span>:</span></p>
<pre class="calibre17"><span>import </span>{Injectable} <span>from </span><span>'@angular/core'</span>;<br class="title-page-name"/><span>import </span>{AngularFireDatabase} <span>from </span><span>'angularfire2/database'</span>;<br class="title-page-name"/><span>import </span>{Observable} <span>from </span><span>'rxjs/Observable'</span>;<br class="title-page-name"/><span>import </span><span>'rxjs/add/operator/map'</span>;<br class="title-page-name"/><span>import </span>{Friend} <span>from </span><span>'./friend'</span>;<br class="title-page-name"/><span>import </span>{<span>FRIENDS_CHILD</span>, <span>USER_DETAILS_CHILD</span>} <span>from </span><span>'./database-constants'</span>;<br class="title-page-name"/><br class="title-page-name"/><span>/**<br class="title-page-name"/></span><span> * Friends service<br class="title-page-name"/></span><span> *<br class="title-page-name"/></span><span> */<br class="title-page-name"/></span>@<span>Injectable</span>()<br class="title-page-name"/><span>export class </span>FriendsService {<br class="title-page-name"/><br class="title-page-name"/>    <span>/**<br class="title-page-name"/></span><span>     * Constructor<br class="title-page-name"/></span><span>     *<br class="title-page-name"/></span><span>     * </span><span>@param </span><span>{AngularFireDatabase} fireDb provides <br class="title-page-name"/>       the functionality related to authentication<br class="title-page-name"/></span><span>     */<br class="title-page-name"/></span><span>    </span><span>constructor</span>(<span>private </span>fireDb: AngularFireDatabase) {<br class="title-page-name"/>    }<br class="title-page-name"/><br class="title-page-name"/>    <span>getFirstPage</span>(uid: <span>string</span>, pageSize: <span>number</span>): Observable&lt;Friend[]&gt; <br class="title-page-name"/>{<br class="title-page-name"/>        <span>return this</span>.fireDb.<span>list</span>&lt;Friend&gt;<br class="title-page-name"/>        (<span>`</span>${<span>USER_DETAILS_CHILD</span>}<span>/</span>${<span>FRIENDS_CHILD</span>}<span>/</span>${uid}<span>`</span>,<br class="title-page-name"/>            ref =&gt; ref.<span>limitToFirst</span>(pageSize)<br class="title-page-name"/>        ).<span>valueChanges</span>();<br class="title-page-name"/>    }<br class="title-page-name"/><br class="title-page-name"/>    <span>loadNextPage</span>(uid: <span>string</span>, friendKey: <span>string</span>, pageSize: <span>number</span>): <br class="title-page-name"/>    Observable&lt;Friend[]&gt; {<br class="title-page-name"/>        <span>return this</span>.fireDb.<span>list</span>&lt;Friend&gt;<br class="title-page-name"/>        (<span>`</span>${<span>USER_DETAILS_CHILD</span>}<span>/</span>${<span>FRIENDS_CHILD</span>}<span>/</span>${uid}<span>`</span>,<br class="title-page-name"/>            ref =&gt; <br class="title-page-name"/>            ref.<span>orderByKey</span>().<span>startAt</span>(friendKey)<br class="title-page-name"/>            .<span>limitToFirst</span>(pageSize + <span>1</span>)<br class="title-page-name"/>        ).<span>valueChanges</span>();<br class="title-page-name"/>    }<br class="title-page-name"/><br class="title-page-name"/>    <span>loadPreviousPage</span>(uid: <span>string</span>, friendKey: <span>string</span>, pageSize: <span>number</span>): <br class="title-page-name"/>    Observable&lt;Friend[]&gt; {<br class="title-page-name"/>        <span>return this</span>.fireDb.<span>list</span>&lt;Friend&gt;<br class="title-page-name"/>       (<span>`</span>${<span>USER_DETAILS_CHILD</span>}<span>/</span>${<span>FRIENDS_CHILD</span>}<span>/</span>${uid}<span>`</span>,<br class="title-page-name"/>            ref =&gt; <br class="title-page-name"/>            ref.<span>orderByKey</span>().<span>startAt</span>(friendKey)<br class="title-page-name"/>            .<span>limitToLast</span>(pageSize + <span>1</span>)<br class="title-page-name"/>        ).<span>valueChanges</span>();<br class="title-page-name"/>    }<br class="title-page-name"/>}</pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Creating a friend's component</h1>
                
            
            <article>
                
<p class="calibre2">This is the main controller of our friend page. In this component, we will need to manage the navigation and visibility of our next and previous icon. We will cover the following two main things in this section:</p>
<ul class="calibre7">
<li class="calibre8">Displaying the next and previous page</li>
<li class="calibre8">Visibility of icons</li>
</ul>
<p class="calibre2">In order to display the next and previous page, we have already created the API required to display the friend's information. We have extended the <kbd class="calibre11">OnInit</kbd> interface and called <kbd class="calibre11">getFirstPage()</kbd> <span>on </span><kbd class="calibre11">ngOnInit</kbd><span> </span>with <kbd class="calibre11">uid</kbd> and <kbd class="calibre11">pageSize</kbd> as filter parameters, as follows:</p>
<pre class="calibre17"><span>ngOnInit</span>() {<br class="title-page-name"/>    <span>this</span>.<span>user </span>= <span>this</span>.userService.<span>getSavedUser</span>().<span>getValue</span>();<br class="title-page-name"/>    <span>this</span>.friendService.<span>getFirstPage</span>(<span>this</span>.<span>user</span>.<span>getUid</span>() , <span>this</span>.<span>pageSize</span>)<br class="title-page-name"/>        .<span>subscribe</span>(friends =&gt; {<br class="title-page-name"/>            <span>this</span>.<span>friends </span>= friends;<br class="title-page-name"/>            ...<br class="title-page-name"/>        });<br class="title-page-name"/>}</pre>
<div class="packt_infobox"><span class="calibre20">The <kbd class="calibre21">ngOnInit()</kbd> method runs when the page is loaded.</span></div>
<p class="calibre2">Consequently, we will retrieve the next and previous page using the API in the friend's service, as follows; the only difference is that we will also pass the friend <kbd class="calibre11">uid</kbd> so that we can retrieve the next page size data, starting from the last retrieved item:</p>
<pre class="calibre17"><span>next</span>() {<br class="title-page-name"/>    <span>this</span>.friendService.<span>loadNextPage</span>(<span>this</span>.<span>user</span>.<span>getUid</span>() ,<br class="title-page-name"/>        <span>this</span>.<span>friends</span>[<span>this</span>.<span>friends</span>.<span>length </span>- <span>1</span>].<span>getUid</span>(),<br class="title-page-name"/>        <span>this</span>.<span>pageSize<br class="title-page-name"/></span><span>    </span>).<span>subscribe</span>(friends =&gt; {<br class="title-page-name"/>        <span>this</span>.<span>friends </span>= friends;<br class="title-page-name"/>        ...<br class="title-page-name"/>    });<br class="title-page-name"/><br class="title-page-name"/><br class="title-page-name"/>}</pre>
<p class="calibre2">Now, we will move on to our next part. We will need to take care of the next and previous icons for which we will need the total number of friends. In our previous discussion, we obtained the size as <kbd class="calibre11">pageSize</kbd>. In order to solve this problem, we have to create <kbd class="calibre11">friendcount</kbd> in our Firebase user node. Whenever we add a friend, we increase the count. We have added this property in our <kbd class="calibre11">User</kbd> class; all the other parts remain the same:</p>
<pre class="calibre17"><span>private </span>friendcount: <span>number</span></pre>
<p class="calibre2">We will then retrieve the total item count in <kbd class="calibre11">ngOnInit</kbd>, as follows:</p>
<pre class="calibre17"><span>ngOnInit</span>() {<br class="title-page-name"/>        <span>this</span>.<span>user </span>= <span>this</span>.userService.<span>getSavedUser</span>().<span>getValue</span>();<br class="title-page-name"/>        <span>this</span>.<span>totalCount </span>= <span>this</span>.<span>user</span>.<span>getFriendcount</span>();<br class="title-page-name"/>        <span>this</span>.friendService.<span>getFirstPage</span>(<span>this</span>.<span>user</span>.<span>getUid</span>() , <br class="title-page-name"/><span>        this</span>.<span>pageSize</span>)<br class="title-page-name"/>            .<span>subscribe</span>(friends =&gt; {<br class="title-page-name"/>                ...<br class="title-page-name"/>                <span>let </span><span>count</span>: <span>number </span>= <span>this</span>.<span>friends</span>.<span>length</span>;<br class="title-page-name"/>                <span>this</span>.<span>currentCount </span>= <span>count</span>;<br class="title-page-name"/>                <span>this</span>.<span>leftArrowVisible</span>();<br class="title-page-name"/>                <span>this</span>.<span>rightArrowVisible</span>();<br class="title-page-name"/>            });<br class="title-page-name"/>    }</pre>
<p class="calibre2">Next, we initialize the current count to the item retrieved and then call the visibility based on the total and current count:</p>
<pre class="calibre17"><span>leftArrowVisible</span>(): <span>void</span>{<br class="title-page-name"/>    <span>this</span>.<span>isLeftVisible </span>= <span>this</span>.<span>currentCount </span>&gt; <span>this</span>.<span>pageSize</span>;<br class="title-page-name"/>}<br class="title-page-name"/><br class="title-page-name"/><span>rightArrowVisible</span>(): <span>void</span>{<br class="title-page-name"/>    <span>this</span>.<span>isRightVisible </span>= <span>this</span>.<span>totalCount </span>&gt; <span>this</span>.<span>currentCount</span>;<br class="title-page-name"/>}</pre>
<p class="calibre2"><span>Here's the complete <kbd class="calibre11">user-friends.component.ts</kbd></span> file:</p>
<pre class="calibre17"><span>import </span>{Component, OnInit} <span>from </span><span>'@angular/core'</span>;<br class="title-page-name"/><span>import </span>{FriendsService} <span>from </span><span>'../../services/friends.service'</span>;<br class="title-page-name"/><span>import </span>{Friend} <span>from </span><span>'../../services/friend'</span>;<br class="title-page-name"/><span>import </span>{UserService} <span>from </span><span>'../../services/user.service'</span>;<br class="title-page-name"/><span>import </span>{User} <span>from </span><span>'../../services/user'</span>;<br class="title-page-name"/><span>import </span><span>'firebase/storage'</span>;<br class="title-page-name"/><span>import </span>{Router} <span>from </span><span>'@angular/router'</span>;<br class="title-page-name"/><br class="title-page-name"/>@<span>Component</span>({<br class="title-page-name"/>  <span>selector</span>: <span>'app-friends-userfriends'</span>,<br class="title-page-name"/>  <span>styleUrls</span>: [<span>'user-friends.component.scss'</span>],<br class="title-page-name"/>  <span>templateUrl</span>: <span>'user-friends.component.html'<br class="title-page-name"/></span>})<br class="title-page-name"/><span>export class </span>UserFriendsComponent <span>implements </span>OnInit {<br class="title-page-name"/><br class="title-page-name"/>  <span>friends</span>: Friend[];<br class="title-page-name"/><br class="title-page-name"/>  <span>totalCount</span>: <span>number</span>;<br class="title-page-name"/><br class="title-page-name"/>  <span>pageSize </span>= <span>3</span>;<br class="title-page-name"/><br class="title-page-name"/>  <span>currentCount </span>= <span>0</span>;<br class="title-page-name"/><br class="title-page-name"/>  <span>previousCount </span>= <span>0</span>;<br class="title-page-name"/><br class="title-page-name"/>  <span>isLeftVisible </span>= <span>false</span>;<br class="title-page-name"/><br class="title-page-name"/>  <span>isRightVisible </span>= <span>true</span>;<br class="title-page-name"/><br class="title-page-name"/>  <span>user</span>: User;<br class="title-page-name"/><br class="title-page-name"/>  <span>constructor</span>(<span>private </span>friendService: FriendsService,<br class="title-page-name"/>              <span>private </span>userService: UserService) {<br class="title-page-name"/>  }<br class="title-page-name"/><br class="title-page-name"/>  <span>ngOnInit</span>() {<br class="title-page-name"/>    <span>this</span>.<span>user </span>= <span>this</span>.userService.<span>getSavedUser</span>().<span>getValue</span>();<br class="title-page-name"/>    <span>this</span>.<span>totalCount </span>= <span>this</span>.<span>user</span>.<span>friendcount</span>;<br class="title-page-name"/>    <span>this</span>.friendService.<span>getFirstPage</span>(<span>this</span>.<span>user</span>.<span>uid</span>, <span>this</span>.<span>pageSize</span>)<br class="title-page-name"/>      .<span>subscribe</span>(friends =&gt; {<br class="title-page-name"/>        <span>this</span>.<span>friends </span>= friends;<br class="title-page-name"/>        <span>const </span><span>count</span>: <span>number </span>= <span>this</span>.<span>friends</span>.<span>length</span>;<br class="title-page-name"/>        <span>this</span>.<span>currentCount </span>= <span>count</span>;<br class="title-page-name"/>        <span>this</span>.<span>leftArrowVisible</span>();<br class="title-page-name"/>        <span>this</span>.<span>rightArrowVisible</span>();<br class="title-page-name"/>      });<br class="title-page-name"/>  }<br class="title-page-name"/><br class="title-page-name"/>  <span>onLeft</span>(): <span>void </span>{<br class="title-page-name"/>    <span>this</span>.<span>previous</span>();<br class="title-page-name"/>  }<br class="title-page-name"/><br class="title-page-name"/>  <span>onRight</span>(): <span>void </span>{<br class="title-page-name"/>    <span>this</span>.<span>next</span>();<br class="title-page-name"/>  }<br class="title-page-name"/><br class="title-page-name"/>  <span>next</span>() {<br class="title-page-name"/>    <span>this</span>.friendService.<span>loadNextPage</span>(<span>this</span>.<span>user</span>.<span>uid</span>,<br class="title-page-name"/>      <span>this</span>.<span>friends</span>[<span>this</span>.<span>friends</span>.<span>length </span>- <span>1</span>].<span>uid</span>,<br class="title-page-name"/>      <span>this</span>.<span>pageSize<br class="title-page-name"/></span><span>    </span>).<span>subscribe</span>(friends =&gt; {<br class="title-page-name"/>      <span>this</span>.<span>friends </span>= friends;<br class="title-page-name"/>      <span>const </span><span>count</span>: <span>number </span>= <span>this</span>.<span>friends</span>.<span>length</span>;<br class="title-page-name"/>      <span>this</span>.<span>previousCount </span>= <span>count </span>- <span>1</span>;<br class="title-page-name"/>      <span>this</span>.<span>currentCount </span>+= <span>this</span>.<span>previousCount</span>;<br class="title-page-name"/>      <span>this</span>.<span>leftArrowVisible</span>();<br class="title-page-name"/>      <span>this</span>.<span>rightArrowVisible</span>();<br class="title-page-name"/>    });<br class="title-page-name"/><br class="title-page-name"/><br class="title-page-name"/>  }<br class="title-page-name"/><br class="title-page-name"/><br class="title-page-name"/>  <span>previous</span>() {<br class="title-page-name"/>    <span>this</span>.friendService.<span>loadPreviousPage</span>(<span>this</span>.<span>user</span>.<span>uid</span>,<br class="title-page-name"/>      <span>this</span>.<span>friends</span>[<span>0</span>].<span>uid</span>,<br class="title-page-name"/>      <span>this</span>.<span>pageSize<br class="title-page-name"/></span><span>    </span>).<span>subscribe</span>(friends =&gt; {<br class="title-page-name"/>      <span>this</span>.<span>friends </span>= friends;<br class="title-page-name"/>      <span>const </span><span>count</span>: <span>number </span>= <span>this</span>.<span>friends</span>.<span>length</span>;<br class="title-page-name"/>      <span>this</span>.<span>currentCount </span>-= <span>this</span>.<span>previousCount</span>;<br class="title-page-name"/>      <span>this</span>.<span>leftArrowVisible</span>();<br class="title-page-name"/>      <span>this</span>.<span>rightArrowVisible</span>();<br class="title-page-name"/>    });<br class="title-page-name"/><br class="title-page-name"/>  }<br class="title-page-name"/><br class="title-page-name"/>  <span>leftArrowVisible</span>(): <span>void </span>{<br class="title-page-name"/>    <span>this</span>.<span>isLeftVisible </span>= <span>this</span>.<span>currentCount </span>&gt; <span>this</span>.<span>pageSize</span>;<br class="title-page-name"/>  }<br class="title-page-name"/><br class="title-page-name"/>  <span>rightArrowVisible</span>(): <span>void </span>{<br class="title-page-name"/>    <span>this</span>.<span>isRightVisible </span>= <span>this</span>.<span>totalCount </span>&gt; <span>this</span>.<span>currentCount</span>;<br class="title-page-name"/>  }<br class="title-page-name"/><br class="title-page-name"/>}</pre>
<p class="calibre2">The user's friends page displays three friends with navigation enabled:</p>
<div class="cdpaligncenter"><img src="../images/00026.jpeg" class="calibre49"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Creating our first date pipe</h1>
                
            
            <article>
                
<p class="calibre2">A Pipe takes an input as its data and transforms it into the desired output. It is used to transform data into a usable form.</p>
<p class="calibre2">We use pipe to transform time into a human-friendly date format. To create the pipe, we implement the <kbd class="calibre11">PipeTransform</kbd> interface and override the <kbd class="calibre11">transform</kbd> method. In this method, we take the date in milliseconds and use the moment library to transform the time to a particular date format. We provide the selector name, which is used in the HTML tag with an input data:</p>
<pre class="calibre17"><span>import </span>* <span>as </span>moment <span>from </span><span>'moment'</span>;<br class="title-page-name"/><span>import </span>{Pipe, PipeTransform} <span>from </span><span>'@angular/core'</span>;<br class="title-page-name"/><br class="title-page-name"/><span>/**<br class="title-page-name"/></span><span> * It is used to format the date<br class="title-page-name"/></span><span> */<br class="title-page-name"/></span>@<span>Pipe</span>({<br class="title-page-name"/>  <span>name</span>: <span>'friendsdate'<br class="title-page-name"/></span>})<br class="title-page-name"/><span>export class </span>FriendsDatePipe <span>implements </span>PipeTransform {<br class="title-page-name"/>  <span>transform</span>(dateInMillis: <span>string</span>) {<br class="title-page-name"/>    <span>if </span>(dateInMillis === <span>'0' </span>|| dateInMillis === <span>'-1'</span>) {<br class="title-page-name"/>      <span>return </span><span>'Invalid Date'</span>;<br class="title-page-name"/>    }<br class="title-page-name"/>    <span>return </span>moment(dateInMillis, <span>'x'</span>).<span>format</span>(<span>'MM/DD/YY'</span>);<br class="title-page-name"/>  }<br class="title-page-name"/>}</pre>
<div class="packt_infobox">Moment is a JavaScript library used to format, manipulate, or parse dates.</div>
<p class="calibre2">After creating the pipe, we add it in our <kbd class="calibre11">user</kbd> module: </p>
<pre class="calibre17">@<span>NgModule</span>({<br class="title-page-name"/>    <span>imports</span>: [<br class="title-page-name"/>        ...<br class="title-page-name"/>    ],<br class="title-page-name"/>    <span>declarations</span>: [<br class="title-page-name"/>        ...<br class="title-page-name"/>        FriendsDatePipe<br class="title-page-name"/>    ]<br class="title-page-name"/>})<br class="title-page-name"/><span>export class </span>UserModule {<br class="title-page-name"/>}</pre>
<p class="calibre2">Finally, we provide the <kbd class="calibre11">friendsdate</kbd> pipe to our <kbd class="calibre11">time</kbd> value from the <kbd class="calibre11">friend</kbd> object in a template, as follows:</p>
<pre class="calibre17"><span>&lt;</span><span>div </span><span>class=</span><span>"card-footer"</span><span>&gt;</span><br class="title-page-name"/>    <span>&lt;</span><span>small </span><span>class=</span><span>"text-muted"</span><span>&gt;</span>Friends from {{<span>friend</span>.<span>getTime</span>() | <span>friendsdate</span>}}<span>&lt;/</span><span>small</span><span>&gt;</span><br class="title-page-name"/><span>&lt;/</span><span>div</span><span>&gt;</span></pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    </header><h1 class="header-title" id="calibre_pb_0">Summary</h1>
                
            
            <article>
                
<p class="calibre2"> In this chapter, we covered a lot of important concepts. We covered the card component, which is used in most applications nowadays. We decorated our view with styles and also created a new service. We discussed the Firebase list and then provided the filter options. This implemented pagination for our friend's list. Finally, we discussed the Angular pipe, which we used to convert time into a human-friendly date format.</p>
<p class="calibre2">In the next chapter, we will cover Firebase storage and learn how to store a profile image and then retrieve it.</p>


            </article>

            
        </section>
    </body></html>