<html><head></head><body><div class="chapter" title="Chapter&#xA0;6.&#xA0;React on the Server"><div class="titlepage"><div><div><h1 class="title"><a id="ch06"/>Chapter 6. React on the Server</h1></div></div></div><p>In the previous chapter, we took a look at refactoring our components. We saw how to make use of mixins and extract similar functionalities to use seamlessly across components. We also took a look at DOM interactions, using refs, and related DOM actions from a component.</p><p>In this chapter, we will explore how React functions on the server side. React allows us to render and handle components on the server to pre-render HTML, which is useful for several reasons. We will also take a look at how this affects the React component life cycle.</p><p>In this chapter, we will cover the following points:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Server-side rendering</li><li class="listitem" style="list-style-type: disc">Render functions</li><li class="listitem" style="list-style-type: disc">Server-side component life cycle</li></ul></div><p>At the end of chapter, we will be able to start using React components on the server side and understand its interactions and implications with the server side.</p><div class="section" title="Getting React to render on server"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec57"/>Getting React to render on server</h1></div></div></div><p>"Hey Shawn!" Mike <a id="id149" class="indexterm"/>startled Shawn, entering their workplace with a cup of coffee.</p><p>"Good morning, Mike," replied Shawn.</p><p>Sun sparkled on Shawn's desk and they entered into a conversation about a new project that they were about to begin.</p><p>"Shawn, I just came to know, from Carla, about a new project that we need to take. The client has asked us to build a simple search page for our Open Library project."</p><p>Shawn and Mike had previously build an application to display recent changes from <code class="literal">openlibrary.com</code> API. They were now going to build a search application on top of Open Library's Search API.</p><p>"Awesome," Mike was excited about this. He was already loving working on React.</p><p>"Shawn, for this project, we will be exploring options on how to use React on the server."</p><p>Until now, we have been manually mounting our components after page load. Until the component is rendered, the page doesn't have any HTML content from the component.</p><p>"Let's see how we will be doing this on the server so that HTML is pre-generated on the page instead of after the page has completely loaded."</p><p>"Got it. How is rendering of components on server side useful though?"</p><p>"It is useful for a couple of reasons. One being that we are generating content on the server. This is useful for SEO purpose and better indexing with search engines."</p><p>"As the content is <a id="id150" class="indexterm"/>generated on the server, the first render would display the page immediately instead of waiting for the page load to properly finish, after which the component would be rendered."</p><p>"This also helps us to avoid a flicker effect on our page loads. There are other such niceties that we can harness, we'll explore them later," Mike explained.</p><p>"Cool. Let's begin then."</p><p>"Alright! For this project, let's begin with a starter Webpack Project to manage our code. For the server element, we will be using Express JS. We won't be doing anything complex here, we will simply expose a route from Express JS and render a <code class="literal">.ejs</code> view that consists of our component."</p><p>"An example of such a <a id="id151" class="indexterm"/>starter project can be found on the <a class="ulink" href="http://webpack.github.io/">http://webpack.github.io/</a> website," informed Mike.</p><p>"Cool, I think we will divide the code on client/server side as well?"</p><p>"Yes. Let's put them under the <code class="literal">/app</code> directory to consist our components, <code class="literal">/client</code> for client-specific code, and <code class="literal">/server</code> for the code to be used on server in our <code class="literal">/src</code> directory," continued Mike.</p><p>"Next, we will be setting up the <code class="literal">server.js</code> file in <code class="literal">/app/server</code> directory."</p><div class="informalexample"><pre class="programlisting">import path from 'path';
import Express from 'express';

var app = Express();
var server;

const PATH_STYLES = path.resolve(__dirname, '../client/styles');
const PATH_DIST = path.resolve(__dirname, '../../dist');

app.use('/styles', Express.static(PATH_STYLES));
app.use(Express.static(PATH_DIST));

app.get('/', (req, res) =&gt; {
  res.sendFile(path.resolve(__dirname, '../client/index.html'));
});

server = app.listen(process.env.PORT || 3000, () =&gt; {
  var port = server.address().port;

  console.log('Server is listening at %s', port);
});</pre></div><p>"That's a pretty standard Express App setup. We are specifying the styles to be used, static assets path, and so on."</p><p>"For our route, we are simple exposing the root <code class="literal">/</code> by doing this:"</p><div class="informalexample"><pre class="programlisting">app.get('/', (req, res) =&gt; {
  res.sendFile(path.resolve(__dirname, '../client/index.html'));
});</pre></div><p>"We are asking Express to <a id="id152" class="indexterm"/>serve the <code class="literal">index.html</code> file on request to root. In our <code class="literal">index.js</code> file, which we will be passing to node to run the application, we will simply expose the server module that we just wrote."</p><div class="informalexample"><pre class="programlisting">require('babel/register');

module.exports = require('./server');</pre></div><p>"Mike, why do we require babel/register here?"</p><p>"Oh right. Here, we <a id="id153" class="indexterm"/>require Babel (<a class="ulink" href="http://babeljs.io/">http://babeljs.io/</a>) to convert our files to browser-compatible format. We are using some JavaScript ES2015 syntax goodness. Babel helps us to add support for the latest version of JavaScript through syntax transformers. This allows us to use the latest JavaScript syntax, which is not supported by browsers right now."</p><p>"With this setup, we will define our <code class="literal">index.html</code> as:"</p><div class="informalexample"><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head lang="en"&gt;
  &lt;meta charset="UTF-8"&gt;
  &lt;title&gt;Search&lt;/title&gt;

  &lt;link href="styles/main.css" rel="stylesheet" /&gt;

  &lt;link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css"&gt;
  &lt;link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css"&gt;
&lt;link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css"&gt;

&lt;/head&gt;
&lt;body&gt;
  &lt;div id="app"&gt;&lt;/div&gt;
  &lt;script src="bundle.js"&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</pre></div><p>"Nothing much is going on over here. We are simply defining a single div on top of which we will be rendering the React component."</p><p>"Also, notice that we <a id="id154" class="indexterm"/>have included links to the files to add Bootstrap and Font Awesome support to our app."</p><p>"Next, on the client-side render handling, we would be doing"</p><div class="informalexample"><pre class="programlisting">// file: scr/client/scripts/client.js
import App from '../../app';

var attachElement = document.getElementById('app');
var state = {};
var app;

// Create new app and attach to element
app = new App({ state: state});

app.renderToDOM(attachElement);</pre></div><p>"Finally, let's see how the <code class="literal">App</code> class defined here is used before moving to our actual component."</p><div class="informalexample"><pre class="programlisting">import React from 'react/addons';
import AppRoot from './components/AppRoot';

class App {
  constructor(options) {
    this.state = options.state;
 }

  render(element) {
    var appRootElement = React.createElement(AppRoot, {
      state: this.state
    });

    // render to DOM
    if (element) {
      React.render(appRootElement, element);
      return;
    }

    // render to string
    return React.renderToString(appRootElement);
  }

  renderToDOM(element) {
    if (!element) {
      new Error('App.renderToDOM: element is required');
    }

    this.render(element);
  }

  renderToString() {
    return this.render();
  }
}

export default App;</pre></div><p>"Wow, that's a lot to sink in," exhaled Shawn.</p><p>"Hah! Give it some time. What we are doing here is simply taking care of our rendering logic. If we pass an element to this class, contents are rendered onto it; otherwise, we will return the rendered string version. Notice how we are using <code class="literal">React.renderToString</code> to achieve the same. Let's <a id="id155" class="indexterm"/>complete this first and we will then revisit it when we will be using it to render the contents on the server request."</p><p>"In a nutshell, we are just asking React to take in a state for a component, render it, and return the contents that would be rendered from the <code class="literal">render()</code> method as a string."</p><p>"We will then start by defining our root container component."</p><div class="informalexample"><pre class="programlisting">require("jquery");
import React from 'react/addons';
import SearchPage from './SearchPage'

var AppRoot = React.createClass({
    propTypes: {
      state: React.PropTypes.object.isRequired
    },
    render()
    {
      return &lt;SearchPage/&gt;;
    }
  })
  ;

export default AppRoot;</pre></div><p>"Here, we simply define a container to hold our main component and require all our dependencies. Let's start building our Search Component next."</p><p>"Awesome. I think I can take that up. Looks like this will just be a simple component?"</p><p>"Yup. Go ahead," replied Mike.</p><p>"Ok, I see that we would be <a id="id156" class="indexterm"/>needing to fetch data from the Open Library API endpoint."</p><p>
<a class="ulink" href="https://openlibrary.org/search.json?page=1&amp;q=searchTerm">https://openlibrary.org/search.json?page=1&amp;q=searchTerm</a>
</p><p>"Here the <code class="literal">q</code> query <a id="id157" class="indexterm"/>parameter will be the search term. An example response looks like:"</p><div class="informalexample"><pre class="programlisting">{
 "start": 0,
 "num_found": 6,
 "numFound": 6,
 "docs": [
  {
   "title_suggest": "Automatic search term variant generation for document retrieval",
   "edition_key": [
    ..
   ],
…
   ],
   "author_name": [
..
..}]
}</pre></div><p>"Right," added Mike.</p><p>"I think I will start by defining the initial status based on the <code class="literal">start</code>, <code class="literal">num_found</code>, and <code class="literal">docs</code> fields," said Shawn</p><p>"Okay."</p><div class="informalexample"><pre class="programlisting">  getInitialState(){
    return {docs: [], numFound: 0, num_found: 0, start: 0, searchCompleted: false, searching: false}
  }</pre></div><p>"I also added two other states that I will maintain: <code class="literal">searchCompleted</code> to know whether the current search operation has completed or not and <code class="literal">searching</code> to know that we are currently searching something."</p><p>"Cool. Let's see the render method next," continued Mike.</p><p>"Let me start by <a id="id158" class="indexterm"/>adding the search box in the <code class="literal">render</code> method."</p><div class="informalexample"><pre class="programlisting">render() {
    let tabStyles = {paddingTop: '5%'};
    return (
        &lt;div className='container'&gt;
          &lt;div className="row" style={tabStyles}&gt;
            &lt;div className="col-lg-8 col-lg-offset-2"&gt;
              &lt;div className="input-group"&gt;
                &lt;input type="text" className="form-control" placeholder="Search for Projects..." ref='searchInput'/&gt;
            &lt;span className="input-group-btn"&gt;
              &lt;button className="btn btn-default" type="button" onClick={this.performSearch}&gt;Go!&lt;/button&gt;
            &lt;/span&gt;
              &lt;/div&gt;
            &lt;/div&gt;
          &lt;/div&gt;
       &lt;/div&gt;
    );
  },</pre></div><p>"We should now have a display for the search box."</p><div class="mediaobject"><img src="graphics/4730_06_01.jpg" alt="Getting React to render on server"/></div><p>"Next, we will add the <code class="literal">performSearch</code> method that initiates searching based on the search term entered by the user."</p><div class="informalexample"><pre class="programlisting">  performSearch(){
    let searchTerm = $(this.refs.searchInput.getDOMNode()).val();
    this.openLibrarySearch(searchTerm);
    this.setState({searchCompleted: false, searching: true});
  },</pre></div><p>"Here, we are simply fetching the search term entered by the user and passing it to the <code class="literal">openLibrarySearch</code> method, which will actually perform the search. Then, we update the state that we are actively performing a search now."</p><p>"Let's complete the <a id="id159" class="indexterm"/>search functionality now."</p><div class="informalexample"><pre class="programlisting"> openLibrarySearch(searchTerm){
    let openlibraryURI = `https://openlibrary.org/search.json?page=1&amp;q=${searchTerm}}`;
    fetch(openlibraryURI)
        .then(this.parseJSON)
        .then(this.updateState)
        .catch(function (ex) {
          console.log('Parsing failed', ex)
        })
  }</pre></div><p>"Ah, nice Shawn, you are <a id="id160" class="indexterm"/>using <code class="literal">fetch</code> instead of regular Ajax!"</p><p>"Huh, yeah. I have been using <a class="ulink" href="https://github.com/github/fetch">https://github.com/github/fetch</a> as a polyfill for the <code class="literal">window.fetch</code> specification."</p><p>"Nice, isn't it? It supports simple and clean API, such as Ajax, and a unified fetching API."</p><p>After fetching of some resource or request completion, the callbacks fall through this are defined by the <code class="literal">then</code> method. Notice that we have also used ES2015 string literal to build the URI," added Shawn.</p><p>"Cool. Looks like you are fetching the resource, then passing it to <code class="literal">parseJSON</code> to parse and return the JSON result from the response body. Then, are we updating the state on top of it?"</p><p>"Yes, let me define those"</p><div class="informalexample"><pre class="programlisting">  parseJSON(response) {
    return response.json();
  },

// response.json() is returning the JSON content from the response. 
  
updateState(json){
    this.setState({
      ...json,
      searchCompleted: true,
      searching: false
    });
  },</pre></div><p>"After getting the final response, I am updating and setting the state to result that is returned as well as updating our <code class="literal">searchCompleted</code> and searching states to indicate the searching job is done."</p><p>"Ah, nice Shawn, I see that you have started adopting and using new features from JS Next!, like the <code class="literal">spread</code> operator."</p><p>"Haha, yeah. I've fallen in love with these. I am using this to merge the properties of the JSON result with the new keys that I want to add and build a new object. This would also be done similarly using <code class="literal">Object.assign</code> that we previously saw."</p><div class="informalexample"><pre class="programlisting">Object.assign({}, json, {searchCompleted: true, searching: false} )</pre></div><p>"That way, we are building a <a id="id161" class="indexterm"/>new object instead of mutating a previous one."</p><p>"Nice Shawn," Mike was happy knowing that Shawn was getting hang of the new things.</p><p>"Finally, let me add the loading action display to show a loader icon and display of actual results. The render method will now look like this."</p><div class="informalexample"><pre class="programlisting">render() {
    let tabStyles = {paddingTop: '5%'};
    return (
        &lt;div className='container'&gt;
          &lt;div className="row" style={tabStyles}&gt;
            &lt;div className="col-lg-8 col-lg-offset-2"&gt;
              &lt;div className="input-group"&gt;
                &lt;input type="text" className="form-control" placeholder="Search for Projects..." ref='searchInput'/&gt;
            &lt;span className="input-group-btn"&gt;
              &lt;button className="btn btn-default" type="button" onClick={this.performSearch}&gt;Go!&lt;/button&gt;
            &lt;/span&gt;
              &lt;/div&gt;
            &lt;/div&gt;
          &lt;/div&gt;
          { (() =&gt; {
            if (this.state.searching) {
              return this.renderSearching();
            }
            return this.state.searchCompleted ? this.renderSearchElements() : &lt;div/&gt;
          })()}
        &lt;/div&gt;
    );
  },</pre></div><p>"Here, we are checking the current state of the search operation. Based on this, we are displaying the loader of the actual contents, results, or empty div element."</p><p>"Let me define the <a id="id162" class="indexterm"/>loading and rendering of the elements."</p><div class="informalexample"><pre class="programlisting">renderSearching(){
    return &lt;div className="row"&gt;
      &lt;div className="col-lg-8 col-lg-offset-2"&gt;
        &lt;div className='text-center'&gt;&lt;i className="fa fa-spinner fa-pulse fa-5x"&gt;&lt;/i&gt;&lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;;
  },</pre></div><p>"This will define the display of the spinner to indicate loading."</p><div class="informalexample"><pre class="programlisting">renderSearchElements(){
    return (

        &lt;div className="row"&gt;
          &lt;div className="col-lg-8 col-lg-offset-2"&gt;
            &lt;span className='text-center'&gt;Total Results: {this.state.numFound}&lt;/span&gt;

            &lt;table className="table table-stripped"&gt;
              &lt;thead&gt;
              &lt;th&gt;Title&lt;/th&gt;
              &lt;th&gt;Title suggest&lt;/th&gt;
              &lt;th&gt;Author&lt;/th&gt;
              &lt;th&gt;Edition&lt;/th&gt;
              &lt;/thead&gt;
              &lt;tbody&gt;
              {this.renderDocs(this.state.docs)}
              &lt;/tbody&gt;
            &lt;/table&gt;

          &lt;/div&gt;
        &lt;/div&gt;

    );
  },

  renderDocs(docs){
    return docs.map((doc) =&gt; {
      console.log(doc);
      return &lt;tr key={doc.cover_edition_key}&gt;
        &lt;td&gt;{doc.title}&lt;/td&gt;
        &lt;td&gt;{doc.title_suggest}&lt;/td&gt;
        &lt;td&gt;{(doc.author_name || []).join(', ')}&lt;/td&gt;
        &lt;td&gt;{doc.edition_count}&lt;/td&gt;
      &lt;/tr&gt;
    })
  },</pre></div><p>"After adding this, the <a id="id163" class="indexterm"/>searching operation should display a loader like so."</p><div class="mediaobject"><img src="graphics/4730_06_02.jpg" alt="Getting React to render on server"/></div><p>The results displayed <a id="id164" class="indexterm"/>would look like this:</p><div class="mediaobject"><img src="graphics/4730_06_03.jpg" alt="Getting React to render on server"/></div><p>"The completed <a id="id165" class="indexterm"/>
<code class="literal">SearchPage</code> component is as follows:"</p><div class="informalexample"><pre class="programlisting">import React from 'react';
var SearchPage = React.createClass({
  getInitialState(){
    return {docs: [], numFound: 0, num_found: 0, start: 0, searchCompleted: false, searching: false}
  },
  render() {
    let tabStyles = {paddingTop: '5%'};
    return (
      &lt;div className='container'&gt;
        &lt;div className="row" style={tabStyles}&gt;
          &lt;div className="col-lg-8 col-lg-offset-2"&gt;
            &lt;div className="input-group"&gt;
              &lt;input type="text" className="form-control" placeholder="Search for Projects..." ref='searchInput'/&gt;
            &lt;span className="input-group-btn"&gt;
              &lt;button className="btn btn-default" type="button" onClick={this.performSearch}&gt;Go!&lt;/button&gt;
            &lt;/span&gt;
            &lt;/div&gt;
          &lt;/div&gt;
        &lt;/div&gt;
        { (() =&gt; {
          if (this.state.searching) {
            return this.renderSearching();
          }
          return this.state.searchCompleted ? this.renderSearchElements() : &lt;div/&gt;
        })()}
      &lt;/div&gt;
    );
  },
  renderSearching(){
    return &lt;div className="row"&gt;
      &lt;div className="col-lg-8 col-lg-offset-2"&gt;
        &lt;div className='text-center'&gt;&lt;i className="fa fa-spinner fa-pulse fa-5x"&gt;&lt;/i&gt;&lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;;
  },
  renderSearchElements(){
    return (
      &lt;div className="row"&gt;
        &lt;div className="col-lg-8 col-lg-offset-2"&gt;
          &lt;span className='text-center'&gt;Total Results: {this.state.numFound}&lt;/span&gt;
          &lt;table className="table table-stripped"&gt;
            &lt;thead&gt;
            &lt;th&gt;Title&lt;/th&gt;
            &lt;th&gt;Title suggest&lt;/th&gt;
            &lt;th&gt;Author&lt;/th&gt;
            &lt;th&gt;Edition&lt;/th&gt;
            &lt;/thead&gt;
            &lt;tbody&gt;
            {this.renderDocs(this.state.docs)}
            &lt;/tbody&gt;
          &lt;/table&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    );
  },
  renderDocs(docs){
    return docs.map((doc) =&gt; {
      console.log(doc);
      return &lt;tr key={doc.cover_edition_key}&gt;
        &lt;td&gt;{doc.title}&lt;/td&gt;
        &lt;td&gt;{doc.title_suggest}&lt;/td&gt;
        &lt;td&gt;{(doc.author_name || []).join(', ')}&lt;/td&gt;
        &lt;td&gt;{doc.edition_count}&lt;/td&gt;
      &lt;/tr&gt;
    })
  },

  performSearch(){
    let searchTerm = $(this.refs.searchInput.getDOMNode()).val();
    this.openLibrarySearch(searchTerm);
    this.setState({searchCompleted: false, searching: true});
  },

  parseJSON(response) {   return response.json();  },

  updateState(json){
    this.setState({
      ...json,
      searchCompleted: true,
      searching: false
    });
  },
  openLibrarySearch(searchTerm){
    let openlibraryURI = `https://openlibrary.org/search.json?page=1&amp;q=${searchTerm}}`;
    fetch(openlibraryURI)
      .then(this.parseJSON)
      .then(this.updateState)
      .catch(function (ex) {
        console.log('Parsing failed', ex)
      })
  }
});
module.exports = SearchPage;</pre></div><p>"If you notice, I have <a id="id166" class="indexterm"/>used an immediately-invoked function to add an <code class="literal">if</code> statement to display the search icon rendering, as follows:"</p><div class="informalexample"><pre class="programlisting">          { (() =&gt; {
            if (this.state.searching) {
              return this.renderSearching();
            }
            return this.state.searchCompleted ? this.renderSearchElements() : &lt;div/&gt;
          })()}</pre></div><p>"Here, we have used the <code class="literal">()=&gt;{}</code> syntax to define the function first and then immediately invoke it <code class="literal">(()=&gt;{}))()</code>, returning the content that we need to display during the render."</p><p>"Great work, Shawn!" Mike was happy with the progress Shawn had made.</p><p>"This is handy, when we want to add simple logic switches within the render itself, instead of defining new methods," continued Mike.</p></div></div>
<div class="section" title="On the server"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec58"/>On the server</h1></div></div></div><p>"Now Shawn, let's <a id="id167" class="indexterm"/>pre-render the component on the server. What this means is that create an HTML element out of the React component and render <a id="id168" class="indexterm"/>its contents in our view on first page load itself. Currently, the loading of the element is taken care of by the client-side code."</p><div class="informalexample"><pre class="programlisting">app.renderToDOM(attachElement);</pre></div><p>"Instead of this, we will render the React element in the Express action itself."</p><p>"First, let's set up an <code class="literal">.ejs</code> view to display out HTML contents along with dynamically-generated React contents."</p><div class="informalexample"><pre class="programlisting">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head lang="en"&gt;
  &lt;meta charset="UTF-8"&gt;
  &lt;title&gt;Search&lt;/title&gt;

  &lt;link href="styles/main.css" rel="stylesheet" /&gt;
  &lt;link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css"&gt;
  &lt;link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css"&gt;
  &lt;link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css"&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;div id="app"&gt;
  &lt;%- reactOutput %&gt;
  &lt;/div&gt;
  &lt;script src="bundle.js"&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</pre></div><p>"Here, we will pass <code class="literal">reactOutput</code> to the view as a variable to be rendered."</p><p>"We will now <a id="id169" class="indexterm"/>change our <code class="literal">server.js</code> file to include the required component and React for rendering."</p><div class="informalexample"><pre class="programlisting">import AppRoot from '../app/components/AppRoot'
import React from 'react/addons';</pre></div><p>"Our action will get <a id="id170" class="indexterm"/>changed to:"</p><div class="informalexample"><pre class="programlisting">app.get('/', (req, res) =&gt; {
  var reactAppContent = React.renderToString(&lt;AppRoot state={{} }/&gt;);
  console.log(reactAppContent);
  res.render(path.resolve(__dirname, '../client/index.ejs'), {reactOutput: reactAppContent});
});</pre></div><p>"Our final server code would look like."</p><div class="informalexample"><pre class="programlisting">import path from 'path';
import Express from 'express';

import AppRoot from '../app/components/AppRoot'
import React from 'react/addons';

var app = Express();
var server;

const PATH_STYLES = path.resolve(__dirname, '../client/styles');
const PATH_DIST = path.resolve(__dirname, '../../dist');

app.use('/styles', Express.static(PATH_STYLES));
app.use(Express.static(PATH_DIST));

app.get('/', (req, res) =&gt; {
  var reactAppContent = React.renderToString(&lt;AppRoot state={{} }/&gt;);
  console.log(reactAppContent);
  res.render(path.resolve(__dirname, '../client/index.ejs'), {reactOutput: reactAppContent});
});

server = app.listen(process.env.PORT || 3000, () =&gt; {
  var port = server.address().port;

  console.log('Server is listening at %s', port);
});</pre></div><p>"Here you have it! We <a id="id171" class="indexterm"/>are using React's <code class="literal">renderToString</code> method <a id="id172" class="indexterm"/>to render a component, passing any state if required, to accompany it."</p></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec59"/>Summary</h1></div></div></div><p>In this chapter, we took a look at how server-side rendering can be used with React with the help of <code class="literal">Express.js</code>. We started with a client-side React component and in the end, replaced it with server-side rendering using the methods provided by the React API.</p><p>In the next chapter, we will look at React add ons for doing two-way binding, class name manipulation, cloning components, immutability helpers, and PureRenderMixin, while continuing with the search project build in this chapter.</p></div></body></html>