<html><head></head><body>
  <div id="_idContainer087" class="Basic-Text-Frame">
    <h1 class="chapterNumber">4</h1>
    <h1 id="_idParaDest-68" class="chapterTitle">Building a PWA Weather Application Using Angular Service Worker</h1>
    <p class="normal">We can access a web application using different types of devices, such as a desktop, mobile, or tablet, and over various types of network, such as broadband, Wi-Fi, and cellular. A web application should work seamlessly and provide the same user experience independently of the device and the network of the user.</p>
    <p class="normal"><strong class="keyWord">Progressive Web Apps (PWAs)</strong> are <a id="_idIndexMarker192"/>applications built with a collection of techniques with the previous considerations in mind. One popular technique is the <strong class="keyWord">service worker</strong>, which improves the loading time of a web application. In this chapter, we will use the service worker implementation of the Angular framework to build a PWA that displays the weather of a city using the <strong class="keyWord">OpenWeather API</strong>.</p>
    <p class="normal">We will cover the following topics in detail:</p>
    <ul>
      <li class="bulletList">Setting up the OpenWeather API</li>
      <li class="bulletList">Displaying weather data</li>
      <li class="bulletList">Enabling offline mode with the service worker</li>
      <li class="bulletList">Staying up to date with in-app notifications</li>
      <li class="bulletList">Deploying our app with <strong class="keyWord">Firebase Hosting</strong></li>
    </ul>
    <h1 id="_idParaDest-69" class="heading-1">Essential background theory and context</h1>
    <p class="normal">Traditional web applications are usually hosted in a web server and are immediately available to any user at any given time. Native applications are installed on the device of the user, have access to its native resources, and can work seamlessly with any network. PWAs straddle the two worlds of web and native applications and share characteristics from both, summarized by the following pillars:</p>
    <ul>
      <li class="bulletList"><strong class="keyWord">Capable</strong>: It can access locally saved data and interact with peripheral hardware that is connected to the device of the user.</li>
      <li class="bulletList"><strong class="keyWord">Reliable</strong>: It can have the same performance and experience in any network connection, even in areas with low connectivity and coverage.</li>
      <li class="bulletList"><strong class="keyWord">Installable</strong>: It can be installed on the device of the user, can be launched directly from the home screen, and interact with other installed native applications.</li>
    </ul>
    <p class="normal">Converting a web application into a PWA involves several steps and techniques. The most essential one is configuring a service worker. The service worker is a mechanism that runs on the web browser and acts as a proxy between the application and an external HTTP endpoint or other in-app resources such as JavaScript and CSS files. The main job of the service worker is to intercept requests to those resources and act on them by providing a cached or live response.</p>
    <div class="note">
      <p class="normal">The service worker is persisted after the tab of the browser is closed.</p>
    </div>
    <p class="normal">The Angular framework provides an implementation for the service worker that we can use to convert our Angular applications into PWAs.</p>
    <p class="normal">It also contains a built-in HTTP client that we can use to communicate with a server over HTTP. The Angular HTTP client exposes an observable-based API with all standard HTTP methods, such as POST and GET. Observables are based on the <strong class="keyWord">observer pattern</strong>, the core of reactive programming. In the observer pattern, multiple objects called <strong class="keyWord">observers</strong> can subscribe to an observable and get notified about any changes to its state. Observables dispatch changes to observers by emitting event streams asynchronously. The Angular framework uses a library called <strong class="keyWord">RxJS</strong> that contains various artifacts for working with observables. One of these artifacts is a set of functions called <strong class="keyWord">operators</strong> that can apply various actions on observables, such as transformations and filtering. Next, let’s get an overview of our project.</p>
    <h1 id="_idParaDest-70" class="heading-1">Project overview</h1>
    <p class="normal">In <a id="_idIndexMarker193"/>this project, we will build a PWA to display the weather conditions of a city. Initially, we will learn how to configure the OpenWeather API, which we will use to get weather data. We will then learn how to use the API to display weather information in an Angular component. We will see how to convert our Angular application into a PWA using a service worker. We will also implement a notification mechanism for our application updates. Finally, we will deploy our PWA into the Firebase Hosting provider. The following diagram presents an architectural overview of the project:</p>
    <figure class="mediaobject"><img src="../Images/B18465_04_01.png" alt="Εικόνα που περιέχει διάγραμμα  Περιγραφή που δημιουργήθηκε αυτόματα"/></figure>
    <p class="packt_figref">Figure 4.1 – Project architecture</p>
    <p class="normal">Build time: 90 minutes</p>
    <h1 id="_idParaDest-71" class="heading-1">Getting started</h1>
    <p class="normal">The following software tools are<a id="_idIndexMarker194"/> required to complete this project:</p>
    <ul>
      <li class="bulletList"><strong class="keyWord">Angular CLI</strong>: A command-line interface for Angular that you can find at <a href="https://angular.io/cli"><span class="url">https://angular.io/cli</span></a>.</li>
      <li class="bulletList"><strong class="keyWord">GitHub material</strong>: The related code for this chapter can be found in the <code class="inlineCode">Chapter04</code> folder at <a href="https://github.com/PacktPublishing/Angular-Projects-Third-Edition"><span class="url">https://github.com/PacktPublishing/Angular-Projects-Third-Edition</span></a>.</li>
    </ul>
    <h1 id="_idParaDest-72" class="heading-1">Setting up the OpenWeather API</h1>
    <p class="normal">The <a id="_idIndexMarker195"/>OpenWeather team<a id="_idIndexMarker196"/> created the OpenWeather API, which contains current and historical weather information from over 200,000 cities worldwide. It also supports forecast weather data for more detailed information.</p>
    <p class="normal">We need to get an API key first to start using the OpenWeather API:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Navigate to the <a id="_idIndexMarker197"/>OpenWeather API website at <a href="https://openweathermap.org/api"><span class="url">https://openweathermap.org/api</span></a>.
    <p class="normal">You will see a list of all available APIs from the OpenWeather team.</p></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="2">Find the <strong class="screenText">Current Weather Data</strong> section and click the <strong class="screenText">Subscribe</strong> button.
    <p class="normal">You will be redirected to the page with the available pricing schemes of the service. Each scheme supports a different combination of API calls per minute and month. For this project, we are going to use the <strong class="screenText">Free</strong> tier.</p></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="3">Click on the <strong class="screenText">Get API key</strong> button.
    <p class="normal">You will be redirected to the sign-up page of the service.</p></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="4">Complete all the required details and click the <strong class="screenText">Create Account</strong> button.
    <p class="normal">A confirmation message will be sent to the email address you used to create your account.</p></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="5">Find the confirmation email and click the <strong class="screenText">Verify your email</strong> button to complete your registration.
    <p class="normal">You will shortly receive another email from OpenWeather with details about your current subscription, including your API key and the HTTP endpoint you will use to communicate with the API.</p></li>
    </ol>
    <div class="note">
      <p class="normal">The API key may take some time to be activated, usually a couple of hours before you can use it.</p>
    </div>
    <p class="normal">Once the API key has been activated, we can use it within an Angular application. We will learn how to do this in the following section.</p>
    <h1 id="_idParaDest-73" class="heading-1">Displaying weather data</h1>
    <p class="normal">In this <a id="_idIndexMarker198"/>section, we will create an Angular application to display weather information for a given city. The user will enter the name of the city in an input field, and the application will use the OpenWeather API to get weather data for the specified city. We will cover the following topics in more detail:</p>
    <ul>
      <li class="bulletList">Setting up the Angular application</li>
      <li class="bulletList">Communicating with the OpenWeather API</li>
      <li class="bulletList">Displaying weather information for a city</li>
    </ul>
    <p class="normal">Let’s start by creating the Angular application first in the following section.</p>
    <h2 id="_idParaDest-74" class="heading-2">Setting up the Angular application</h2>
    <p class="normal">We will use <a id="_idIndexMarker199"/>the <code class="inlineCode">ng new</code> command of the Angular CLI to create a new Angular application from scratch:</p>
    <pre class="programlisting con"><code class="hljs-con">ng new weather-app --style=scss --routing=false
</code></pre>
    <p class="normal">The preceding command will create a new Angular CLI application with the following properties:</p>
    <ul>
      <li class="bulletList"><code class="inlineCode">weather-app</code>: The name of the Angular application</li>
      <li class="bulletList"><code class="inlineCode">--style=scss</code>: Indicates that our Angular application will use the SCSS stylesheet format</li>
      <li class="bulletList"><code class="inlineCode">--routing=false</code>: Disables Angular routing in the application</li>
    </ul>
    <p class="normal">The user should be able to enter the name of the city in an input field, and the weather information of the city should be visualized in a card layout. The <strong class="keyWord">Angular Material</strong> library provides a set<a id="_idIndexMarker200"/> of UI components for our needs, including an input and a card.</p>
    <p class="normal">Angular Material components adhere to<a id="_idIndexMarker201"/> the <strong class="keyWord">Material Design</strong> principles and are maintained by the <strong class="keyWord">Components</strong> team of Angular. We can install the Angular Material library using the following command of the Angular CLI:</p>
    <pre class="programlisting con"><code class="hljs-con">ng add @angular/material --theme=indigo-pink --animations=enabled --typography
</code></pre>
    <p class="normal">The preceding code uses the <code class="inlineCode">ng add</code> command of the Angular CLI, passing additional configuration options:</p>
    <ul>
      <li class="bulletList"><code class="inlineCode">@angular/material</code>: The npm package name of the Angular Material library. It will also install<a id="_idIndexMarker202"/> the <strong class="keyWord">Angular CDK</strong> package, a set of behaviors and interactions used to build Angular Material. Both packages will be added to the <code class="inlineCode">dependencies</code> section of the <code class="inlineCode">package.json</code> file of the application.</li>
      <li class="bulletList"><code class="inlineCode">--theme=indigo-pink</code>: The name of the Angular Material theme we want to use. Adding a theme involves modifying several files of the Angular CLI workspace. It adds entries of the CSS theme file to the <code class="inlineCode">angular.json</code> configuration file:
        <pre class="programlisting code"><code class="hljs-code">@angular/material/prebuilt-themes/indigo-pink.css
</code></pre>
    <p class="normal">It also <a id="_idIndexMarker203"/>includes the Material Design icons in the <code class="inlineCode">index.html</code> file:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag">&lt;</span><span class="hljs-name">link</span><span class="hljs-tag"> </span><span class="hljs-attr">href</span><span class="hljs-tag">=</span><span class="hljs-string">"https://fonts.googleapis.com/icon?family=Material+Icons"</span><span class="hljs-tag"> </span><span class="hljs-attr">rel</span><span class="hljs-tag">=</span><span class="hljs-string">"stylesheet"</span><span class="hljs-tag">&gt;</span>
</code></pre>
    <p class="normal">Angular Material comes with a set of predefined themes that we can use. Alternatively, we can build a custom one that fits our specific needs.</p>
      </li>
    </ul>
    <ul>
      <li class="bulletList"><code class="inlineCode">--animations=enabled</code>: Enables browser animations in our application by importing <code class="inlineCode">BrowserAnimationsModule</code> into the main application module, <code class="inlineCode">app.module.ts</code>:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">import</span> { <span class="hljs-title">NgModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title">BrowserModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/platform-browser'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title">AppComponent</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./app.component'</span>;
<span class="code-highlight"><strong class="hljs-keyword-slc">import</strong><strong class="hljs-slc"> { </strong><strong class="hljs-title-slc">BrowserAnimationsModule</strong><strong class="hljs-slc"> } </strong><strong class="hljs-keyword-slc">from</strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc">'@angular/platform-browser/animations'</strong><strong class="hljs-slc">;</strong></span>
<span class="hljs-meta">@NgModule</span>({
  <span class="hljs-attr">declarations</span>: [
    <span class="hljs-title">AppComponent</span>
  ],
  <span class="hljs-attr">imports</span>: [
    <span class="hljs-title">BrowserModule</span>,
    <span class="code-highlight"><strong class="hljs-title-slc">BrowserAnimationsModule</strong></span>
  ],
  <span class="hljs-attr">providers</span>: [],
  <span class="hljs-attr">bootstrap</span>: [<span class="hljs-title">AppComponent</span>]
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title">AppModule</span> { }
</code></pre>
      </li>
      <li class="bulletList"><code class="inlineCode">--typography</code>: Enables Angular Material typography globally in our application. Typography defines how text content is displayed and uses the <strong class="keyWord">Roboto</strong> font<a id="_idIndexMarker204"/> by default, which is included in the <code class="inlineCode">index.html</code> file:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag">&lt;</span><span class="hljs-name">link</span><span class="hljs-tag"> </span><span class="hljs-attr">href</span><span class="hljs-tag">=</span><span class="hljs-string">"https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&amp;display=swap"</span><span class="hljs-tag"> </span><span class="hljs-attr">rel</span><span class="hljs-tag">=</span><span class="hljs-string">"stylesheet"</span><span class="hljs-tag">&gt;</span>
</code></pre>
    <p class="normal">It adds <a id="_idIndexMarker205"/>the following class to the <code class="inlineCode">&lt;body&gt;</code> tag of the HTML file:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag">&lt;</span><span class="hljs-name">body</span><span class="hljs-tag"> </span><span class="code-highlight"><strong class="hljs-attr-slc">class</strong><strong class="hljs-tag-slc">=</strong><strong class="hljs-string-slc">"mat-typography"</strong></span><span class="hljs-tag">&gt;</span>
  <span class="hljs-tag">&lt;</span><span class="hljs-name">app-root</span><span class="hljs-tag">&gt;&lt;/</span><span class="hljs-name">app-root</span><span class="hljs-tag">&gt;</span>
<span class="hljs-tag">&lt;/</span><span class="hljs-name">body</span><span class="hljs-tag">&gt;</span>
</code></pre>
    <p class="normal">It also adds some CSS styles to the global <code class="inlineCode">styles.scss</code> file of our application:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-selector-tag">html</span>, <span class="hljs-selector-tag">body</span> { <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>; }
<span class="hljs-selector-tag">body</span> { <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>; <span class="hljs-attribute">font-family</span>: Roboto, <span class="hljs-string">"Helvetica Neue"</span>, sans-serif; }
</code></pre>
      </li>
    </ul>
    <p class="normal">We now have all the moving parts to build our Angular application. In the following section, we will create a mechanism for interacting with the OpenWeather API.</p>
    <h2 id="_idParaDest-75" class="heading-2">Communicating with the OpenWeather API</h2>
    <p class="normal">The <a id="_idIndexMarker206"/>application should interact with the OpenWeather API over HTTP to get weather data. Let’s see how we can set up this type of communication in our application:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">First, we must create an interface describing the data type we will get from the API. Use the following command of the Angular CLI to create one:
        <pre class="programlisting con"><code class="hljs-con">ng generate interface weather
</code></pre>
    <p class="normal">The preceding command will create the <code class="inlineCode">weather.ts</code> file in the <code class="inlineCode">src\app</code> folder of our Angular CLI project.</p>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="2">Open the <code class="inlineCode">weather.ts</code> file and modify it as follows:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">Weather</span> {
  <span class="hljs-attr">weather</span>: <span class="hljs-title">WeatherInfo</span>[],
  <span class="hljs-attr">main</span>: {
    <span class="hljs-attr">temp</span>: <span class="hljs-built_in">number</span>;
    <span class="hljs-attr">pressure</span>: <span class="hljs-built_in">number</span>;
    <span class="hljs-attr">humidity</span>: <span class="hljs-built_in">number</span>;
  };
  <span class="hljs-attr">wind</span>: {
    <span class="hljs-attr">speed</span>: <span class="hljs-built_in">number</span>;
  };
  <span class="hljs-attr">sys</span>: {
    <span class="hljs-attr">country</span>: <span class="hljs-built_in">string</span>
  };
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
}
<span class="hljs-keyword">interface</span> <span class="hljs-title">WeatherInfo</span> {
  <span class="hljs-attr">main</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">icon</span>: <span class="hljs-built_in">string</span>;
}
</code></pre>
    <p class="normal">Each<a id="_idIndexMarker207"/> property corresponds to a weather field in the OpenWeather API response. You can find a description for each one at <a href="https://openweathermap.org/current#parameter"><span class="url">https://openweathermap.org/current#parameter</span></a>.</p>
    <p class="normal">Then, we must set up the built-in HTTP client provided by the Angular framework.</p>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="3">Open the <code class="inlineCode">app.module.ts</code> file and add <code class="inlineCode">HttpClientModule</code> to the <code class="inlineCode">imports</code> array of the <code class="inlineCode">@NgModule</code> decorator:
        <pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-keyword-slc">import</strong><strong class="hljs-slc"> { </strong><strong class="hljs-title-slc">HttpClientModule</strong><strong class="hljs-slc"> } </strong><strong class="hljs-keyword-slc">from</strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc">'@angular/common/http'</strong><strong class="hljs-slc">;</strong></span>
<span class="hljs-keyword">import</span> { <span class="hljs-title">NgModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title">BrowserModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/platform-browser'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title">AppComponent</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./app.component'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title">BrowserAnimationsModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'</span><span class="hljs-string">@angular/platform-browser/animations'</span>;
<span class="hljs-meta">@NgModule</span>({
  <span class="hljs-attr">declarations</span>: [
    <span class="hljs-title">AppComponent</span>
  ],
  <span class="hljs-attr">imports</span>: [
    <span class="hljs-title">BrowserModule</span>,
    <span class="hljs-title">BrowserAnimationsModule</span>,
    <span class="code-highlight"><strong class="hljs-title-slc">HttpClientModule</strong></span>
  ],
  <span class="hljs-attr">providers</span>: [],
  <span class="hljs-attr">bootstrap</span>: [<span class="hljs-title">AppComponent</span>]
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title">AppModule</span> { }
</code></pre>
      </li>
      <li class="numberedList">Use the <a id="_idIndexMarker208"/>following command of the Angular CLI to create a new Angular service:
        <pre class="programlisting con"><code class="hljs-con">ng generate service weather
</code></pre>
    <p class="normal">The preceding command will create the <code class="inlineCode">weather.service.ts</code> file in the <code class="inlineCode">src\app</code> folder of our Angular CLI project.</p>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="5">Open the <code class="inlineCode">weather.service.ts</code> file and inject the <code class="inlineCode">HttpClient</code> service into its <code class="inlineCode">constructor</code>:
        <pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-keyword-slc">import</strong><strong class="hljs-slc"> { </strong><strong class="hljs-title-slc">HttpClient</strong><strong class="hljs-slc"> } </strong><strong class="hljs-keyword-slc">from</strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc">'@angular/common/http'</strong><strong class="hljs-slc">;</strong></span>
<span class="hljs-keyword">import</span> { <span class="hljs-title">Injectable</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>;
<span class="hljs-meta">@Injectable</span>({
  <span class="hljs-attr">providedIn</span>: <span class="hljs-string">'root'</span>
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title">WeatherService</span> {
  <span class="hljs-title">constructor</span>(<span class="code-highlight"><strong class="hljs-keyword-slc">private</strong><strong class="hljs-params-slc"> http: HttpClient</strong></span>) { }
}
</code></pre>
      </li>
      <li class="numberedList">Add the following properties to define the endpoint URL of the OpenWeather API and our API key:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">private</span> apiUrl = <span class="hljs-string">'https://api.openweathermap.org/data/2.5/'</span>;
<span class="hljs-keyword">private</span> apiKey = <span class="hljs-string">'&lt;Your API key&gt;'</span>;
</code></pre>
    <p class="normal">Replace the value of the <code class="inlineCode">apiKey</code> property with the API key that you have.</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="7">Add a method in the service that accepts the name of the city as a single parameter and queries the OpenWeather API for that city:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-title">getWeather</span>(<span class="hljs-attr">city</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title">Observable</span>&lt;<span class="hljs-title">Weather</span>&gt; {
  <span class="hljs-keyword">const</span> options = <span class="hljs-keyword">new</span> <span class="hljs-title">HttpParams</span>()
    .<span class="hljs-title">set</span>(<span class="hljs-string">'units'</span>, <span class="hljs-string">'metric'</span>)
    .<span class="hljs-title">set</span>(<span class="hljs-string">'q'</span>, city)
    .<span class="hljs-title">set</span>(<span class="hljs-string">'appId'</span>, <span class="hljs-variable">this</span>.<span class="hljs-property">apiKey</span>);
  <span class="hljs-keyword">return</span> <span class="hljs-variable">this</span>.<span class="hljs-property">http</span>.<span class="hljs-property">get</span>&lt;<span class="hljs-title">Weather</span>&gt;(<span class="hljs-variable">this</span>.<span class="hljs-property">apiUrl</span> + <span class="hljs-string">'weather'</span>, { <span class="hljs-attr">params</span>: options });
}
</code></pre>
      </li>
    </ol>
    <p class="normal">The <code class="inlineCode">getWeather</code> method uses the <code class="inlineCode">get</code> method of the <code class="inlineCode">HttpClient</code> service that accepts two parameters. The first one is the URL endpoint of the OpenWeather API. The second parameter is an <code class="inlineCode">options</code> object used to pass additional configuration to the request, such as URL query parameters with the <code class="inlineCode">params</code> property.</p>
    <p class="normal">We use the <a id="_idIndexMarker209"/>constructor of the <code class="inlineCode">HttpParams</code> object and call its <code class="inlineCode">set</code> method for each query parameter we want to add to the URL. In our case, we pass the <code class="inlineCode">q</code> parameter for the city name, the <code class="inlineCode">appId</code> for the API key, and the type of <code class="inlineCode">units</code> we want to use. You can learn more about supported units at <a href="https://openweathermap.org/current#data"><span class="url">https://openweathermap.org/current#data</span></a>.</p>
    <div class="packt_tip">
      <p class="normal">We used the <code class="inlineCode">set</code> method to create query parameters because the <code class="inlineCode">HttpParams</code> object is immutable. Calling the constructor for each parameter you want to pass will throw an error.</p>
    </div>
    <p class="normal">We also set the response data type as <code class="inlineCode">Weather</code> in the <code class="inlineCode">get</code> method. Notice that the <code class="inlineCode">getWeather</code> method does not return <code class="inlineCode">Weather</code> data but instead an <code class="inlineCode">Observable</code> of this type.</p>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="8">Add the following <code class="inlineCode">import</code> statements at the top of the file:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">import</span> { <span class="hljs-title">HttpClient</span>, <span class="code-highlight"><strong class="hljs-title-slc">HttpParams</strong></span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/common/http'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title">Injectable</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>;
<span class="code-highlight"><strong class="hljs-keyword-slc">import</strong><strong class="hljs-slc"> { </strong><strong class="hljs-title-slc">Observable</strong><strong class="hljs-slc"> } </strong><strong class="hljs-keyword-slc">from</strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc">'rxjs'</strong><strong class="hljs-slc">;</strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc">import</strong><strong class="hljs-slc"> { </strong><strong class="hljs-title-slc">Weather</strong><strong class="hljs-slc"> } </strong><strong class="hljs-keyword-slc">from</strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc">'./weather'</strong><strong class="hljs-slc">;</strong></span>
</code></pre>
      </li>
    </ol>
    <p class="normal">The Angular service that we created contains all the necessary artifacts for interacting with the OpenWeather API. In the following section, we will create an Angular component for initiating requests and displaying data from it.</p>
    <h2 id="_idParaDest-76" class="heading-2">Displaying weather information for a city</h2>
    <p class="normal">The user should be <a id="_idIndexMarker210"/>able to use the UI of our application and enter the name of a city for which they want to view weather details. The application will use that information to query the OpenWeather API, and the request result will be displayed on the UI using a card layout. Let’s start building an Angular component for creating all these types of interactions:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Use the following command of the Angular CLI to create an Angular component:
        <pre class="programlisting con"><code class="hljs-con">ng generate component weather
</code></pre>
      </li>
      <li class="numberedList">Open the template of the main component, <code class="inlineCode">app.component.html</code>, and replace its content with the selector of the new component, <code class="inlineCode">&lt;app-weather&gt;</code>:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag">&lt;</span><span class="hljs-name">app-weather</span><span class="hljs-tag">&gt;&lt;/</span><span class="hljs-name">app-weather</span><span class="hljs-tag">&gt;</span>
</code></pre>
      </li>
      <li class="numberedList">Open the <code class="inlineCode">app.module.ts</code> file and add the following modules from the Angular Material library to the <code class="inlineCode">imports</code> array of the <code class="inlineCode">@NgModule</code> decorator:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-meta">@NgModule</span>({
  <span class="hljs-attr">declarations</span>: [
    <span class="hljs-title">AppComponent</span>,
    <span class="hljs-title">WeatherComponent</span>
  ],
  <span class="hljs-attr">imports</span>: [
    <span class="hljs-title">BrowserModule</span>,
    <span class="hljs-title">BrowserAnimationsModule</span>,
    <span class="hljs-title">HttpClientModule</span>,
    <span class="code-highlight"><strong class="hljs-title-slc">MatIconModule</strong><strong class="hljs-slc">,</strong></span>
<span class="code-highlight"><strong class="hljs-slc">    </strong><strong class="hljs-title-slc">MatInputModule</strong><strong class="hljs-slc">,</strong></span>
<span class="code-highlight"><strong class="hljs-slc">    </strong><strong class="hljs-title-slc">MatCardModule</strong></span>
  ],
  <span class="hljs-attr">providers</span>: [],
  <span class="hljs-attr">bootstrap</span>: [<span class="hljs-title">AppComponent</span>]
})
</code></pre>
    <p class="normal">Also, add the necessary <code class="inlineCode">import</code> statements at the top of the file:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">import</span> { <span class="hljs-title">MatCardModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/material/card'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title">MatIconModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/material/icon'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title">MatInputModule</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/material/input'</span>;
</code></pre>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="4">Open the <code class="inlineCode">weather.component.ts</code> file, create a <code class="inlineCode">weather</code> property of the <code class="inlineCode">Weather</code> type, and inject <code class="inlineCode">WeatherService</code> into the <code class="inlineCode">constructor</code> of the <code class="inlineCode">WeatherComponent</code> class:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">import</span> { <span class="hljs-title">Component</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>;
<span class="code-highlight"><strong class="hljs-keyword-slc">import</strong><strong class="hljs-slc"> { </strong><strong class="hljs-title-slc">Weather</strong><strong class="hljs-slc"> } </strong><strong class="hljs-keyword-slc">from</strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc">'</strong><strong class="hljs-string-slc">../weather'</strong><strong class="hljs-slc">;</strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc">import</strong><strong class="hljs-slc"> { </strong><strong class="hljs-title-slc">WeatherService</strong><strong class="hljs-slc"> } </strong><strong class="hljs-keyword-slc">from</strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc">'../weather.service'</strong><strong class="hljs-slc">;</strong></span>
<span class="hljs-meta">@Component</span>({
  <span class="hljs-attr">selector</span>: <span class="hljs-string">'app-weather'</span>,
  <span class="hljs-attr">templateUrl</span>: <span class="hljs-string">'./weather.component.html'</span>,
  <span class="hljs-attr">styleUrls</span>: [<span class="hljs-string">'./weather.component.scss'</span>]
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title">WeatherComponent</span> {
  <span class="code-highlight"><strong class="hljs-attr-slc">weather</strong><strong class="hljs-slc">: </strong><strong class="hljs-title-slc">Weather</strong><strong class="hljs-slc"> | </strong><strong class="hljs-literal-slc">undefined</strong><strong class="hljs-slc">;</strong></span>
  <span class="code-highlight"><strong class="hljs-title-slc">constructor</strong><strong class="hljs-slc">(</strong><strong class="hljs-keyword-slc">private</strong><strong class="hljs-params-slc"> weatherService: WeatherService</strong><strong class="hljs-slc">){ }</strong></span>
}
</code></pre>
      </li>
      <li class="numberedList">Create a <a id="_idIndexMarker211"/>component method that subscribes to the <code class="inlineCode">getWeather</code> method of <code class="inlineCode">WeatherService</code> and assigns the result to the <code class="inlineCode">weather</code> component property:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-title">search</span>(<span class="hljs-params">city: </span><span class="hljs-built_in">string</span>) {
  <span class="hljs-variable">this</span>.<span class="hljs-property">weatherService</span>.<span class="hljs-title">getWeather</span>(city).<span class="hljs-title">subscribe</span>(<span class="hljs-params">weather</span><span class="hljs-function"> =&gt;</span> <span class="hljs-variable">this</span>.<span class="hljs-property">weather</span> = weather);
}
</code></pre>
      </li>
    </ol>
    <p class="normal">We have already finished working with the TypeScript class file of our component. Let’s wire it up to its template. Open the <code class="inlineCode">weather.component.html</code> file and replace its content with the following HTML code:</p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag">&lt;</span><span class="hljs-name">mat-form-field</span><span class="hljs-tag">&gt;</span>
    <span class="hljs-tag">&lt;</span><span class="hljs-name">input</span><span class="hljs-tag"> </span><span class="hljs-attr">matInput</span><span class="hljs-tag"> </span><span class="hljs-attr">placeholder</span><span class="hljs-tag">=</span><span class="hljs-string">"Enter city"</span><span class="hljs-tag"> </span><span class="hljs-attr">#cityCtrl</span><span class="hljs-tag"> (</span><span class="hljs-attr">keydown.enter</span><span class="hljs-tag">)=</span><span class="hljs-string">"search(cityCtrl.value)"</span><span class="hljs-tag">&gt;</span>
    <span class="hljs-tag">&lt;</span><span class="hljs-name">mat-icon</span><span class="hljs-tag"> </span><span class="hljs-attr">matSuffix</span><span class="hljs-tag"> (</span><span class="hljs-attr">click</span><span class="hljs-tag">)=</span><span class="hljs-string">"search(cityCtrl.value)"</span><span class="hljs-tag">&gt;</span>search<span class="hljs-tag">&lt;/</span><span class="hljs-name">mat-icon</span><span class="hljs-tag">&gt;</span>
<span class="hljs-tag">&lt;/</span><span class="hljs-name">mat-form-field</span><span class="hljs-tag">&gt;</span>
<span class="hljs-tag">&lt;</span><span class="hljs-name">mat-card</span><span class="hljs-tag"> *</span><span class="hljs-attr">ngIf</span><span class="hljs-tag">=</span><span class="hljs-string">"weather"</span><span class="hljs-tag">&gt;</span>
    <span class="hljs-tag">&lt;</span><span class="hljs-name">mat-card-header</span><span class="hljs-tag">&gt;</span>
        <span class="hljs-tag">&lt;</span><span class="hljs-name">mat-card-title</span><span class="hljs-tag">&gt;</span>{{weather.name}}, {{weather.sys.country}}<span class="hljs-tag">&lt;/</span><span class="hljs-name">mat-card-title</span><span class="hljs-tag">&gt;</span>
        <span class="hljs-tag">&lt;</span><span class="hljs-name">mat-card-subtitle</span><span class="hljs-tag">&gt;</span>{{weather.weather[0].main}}<span class="hljs-tag">&lt;/</span><span class="hljs-name">mat-card-subtitle</span><span class="hljs-tag">&gt;</span>
    <span class="hljs-tag">&lt;/</span><span class="hljs-name">mat-card-header</span><span class="hljs-tag">&gt;</span>
    <span class="hljs-tag">&lt;</span><span class="hljs-name">img</span><span class="hljs-tag"> </span><span class="hljs-attr">mat-card-image</span><span class="hljs-tag"> </span><span class="hljs-attr">src</span><span class="hljs-tag">=</span><span class="hljs-string">"https://openweathermap.org/img/wn/{{weather.weather[0].icon}}@2x.png"</span><span class="hljs-tag"> [</span><span class="hljs-attr">alt</span><span class="hljs-tag">]=</span><span class="hljs-string">"weather.weather[0].main"</span><span class="hljs-tag">&gt;</span>
    <span class="hljs-tag">&lt;</span><span class="hljs-name">mat-card-content</span><span class="hljs-tag">&gt;</span>
      <span class="hljs-tag">&lt;</span><span class="hljs-name">h1</span><span class="hljs-tag">&gt;</span>{{weather.main.temp | number:'1.0-0'}} <span class="hljs-symbol">&amp;#8451;</span><span class="hljs-tag">&lt;/</span><span class="hljs-name">h1</span><span class="hljs-tag">&gt;</span>
      <span class="hljs-tag">&lt;</span><span class="hljs-name">p</span><span class="hljs-tag">&gt;</span>Pressure: {{weather.main.pressure}} hPa<span class="hljs-tag">&lt;/</span><span class="hljs-name">p</span><span class="hljs-tag">&gt;</span>
      <span class="hljs-tag">&lt;</span><span class="hljs-name">p</span><span class="hljs-tag">&gt;</span>Humidity: {{weather.main.humidity}} %<span class="hljs-tag">&lt;/</span><span class="hljs-name">p</span><span class="hljs-tag">&gt;</span>
      <span class="hljs-tag">&lt;</span><span class="hljs-name">p</span><span class="hljs-tag">&gt;</span>Wind: {{weather.wind.speed}} m/s<span class="hljs-tag">&lt;/</span><span class="hljs-name">p</span><span class="hljs-tag">&gt;</span>
    <span class="hljs-tag">&lt;/</span><span class="hljs-name">mat-card-content</span><span class="hljs-tag">&gt;</span>
<span class="hljs-tag">&lt;/</span><span class="hljs-name">mat-card</span><span class="hljs-tag">&gt;</span>
</code></pre>
    <p class="normal">The preceding <a id="_idIndexMarker212"/>template consists of several components from the Angular Material library, including a <code class="inlineCode">&lt;mat-form-field&gt;</code> component that contains the following child elements:</p>
    <ul>
      <li class="bulletList">An <code class="inlineCode">&lt;input&gt;</code> HTML element for entering the name of the city. When the user has finished editing and presses the <em class="keystroke">Enter</em> key, it calls the <code class="inlineCode">search</code> component method passing the value property of the <code class="inlineCode">cityCtrl</code> variable as a parameter. The <code class="inlineCode">cityCtrl</code> variable is a <strong class="keyWord">template reference variable</strong> and indicates the actual object of the native HTML <code class="inlineCode">&lt;input&gt;</code> element.</li>
      <li class="bulletList">A <code class="inlineCode">&lt;mat-icon&gt;</code> component displays a magnifier icon at the end of the input element, as indicated by the <code class="inlineCode">matSuffix</code> directive. It also calls the <code class="inlineCode">search</code> component method when clicked.</li>
    </ul>
    <div class="note">
      <p class="normal">The <code class="inlineCode">cityCtrl</code> template reference variable is indicated by a <code class="inlineCode">#</code> and is accessible everywhere inside the component template.</p>
    </div>
    <p class="normal">A <code class="inlineCode">&lt;mat-card&gt;</code> component presents information in a card layout and is displayed only when the <code class="inlineCode">weather</code> component property has a value. It consists of the following child elements:</p>
    <ul>
      <li class="bulletList"><code class="inlineCode">&lt;mat-card-header&gt;</code>: The header of the card. It consists of a <code class="inlineCode">&lt;mat-card-title&gt;</code> component that displays the name of the city and the country code and a <code class="inlineCode">&lt;mat-card-subtitle&gt;</code> component that displays the current weather conditions.</li>
      <li class="bulletList"><code class="inlineCode">mat-card-image</code>: The image of the card that displays the icon of the weather conditions, along with a description as an alternate text.</li>
      <li class="bulletList"><code class="inlineCode">&lt;mat-card-content&gt;</code>: The main content of the card. It displays the temperature, pressure, humidity, and wind speed of the current weather. The temperature is displayed without any decimal points, as indicated by the <code class="inlineCode">number</code> pipe.</li>
    </ul>
    <p class="normal">Let’s now spice <a id="_idIndexMarker213"/>things up a bit by adding some styles to our component:</p>
    <p class="normal"><code class="inlineCode">weather.component.scss</code></p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-selector-pseudo">:host</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">justify-content</span>: center;
  <span class="hljs-attribute">flex-direction</span>: column;
  <span class="hljs-attribute">padding-top</span>: <span class="hljs-number">25px</span>;
}
mat-form-field {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">20%</span>;
}
mat-icon {
  <span class="hljs-attribute">cursor</span>: pointer;
}
mat-card {
  <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">30px</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">250px</span>;
}
<span class="hljs-selector-tag">h1</span> {
  <span class="hljs-attribute">text-align</span>: center;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">2.5em</span>;
}
</code></pre>
    <p class="normal">The <code class="inlineCode">:host</code> selector is an Angular unique CSS selector that targets the HTML element hosting our component, which in our case, is the <code class="inlineCode">&lt;app-weather&gt;</code> HTML element.</p>
    <p class="normal">If we run our application using <code class="inlineCode">ng serve</code>, navigate to <code class="inlineCode">http://localhost:4200</code>, and search for weather information in <code class="inlineCode">Athens</code>, we should get the following output on the screen:</p>
    <figure class="mediaobject"><img src="../Images/B18465_04_02.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.2 – Application output</p>
    <p class="normal">Congratulations! Now, you have a fully working Angular application that displays weather information<a id="_idIndexMarker214"/> for a specific city. The application consists of a single Angular component that communicates with the OpenWeather API using an Angular service through HTTP. We learned how to style our component using Angular Material and give our users a pleasant experience with our app. But what happens when we are offline? Does the application work as expected? Does the user’s experience remain the same? Let’s find out in the following section.</p>
    <h1 id="_idParaDest-77" class="heading-1">Enabling offline mode with the service worker</h1>
    <p class="normal">Users<a id="_idIndexMarker215"/> from anywhere can now access our Angular application to get weather information for any city they are interested in. When we say <em class="italic">anywhere</em>, we mean any network type, such as broadband, cellular (3G/4G/5G), and Wi-Fi. Consider the case where a user is in a place with low coverage or frequent network outages. How is our application going to behave? Let’s find out by experimenting:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Run the Angular application using the <code class="inlineCode">ng serve</code> command of the Angular CLI.</li>
      <li class="numberedList">Open your favorite browser and navigate to <code class="inlineCode">http://localhost:4200</code>, the default address and port number for an Angular CLI project. You should see the input field for entering the name of the city:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18465_04_03.png" alt="Εικόνα που περιέχει κείμενο  Περιγραφή που δημιουργήθηκε αυτόματα"/></figure>
    <p class="packt_figref">Figure 4.3 – Entering the name of a city</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="3">Open the<a id="_idIndexMarker216"/> developer tools of your browser and navigate to the <strong class="screenText">Network</strong> tab. Set the value of the <strong class="screenText">Throttling</strong> dropdown to <strong class="screenText">Offline</strong>:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18465_04_04.png" alt="Figure 4.3 – Offline network mode"/></figure>
    <p class="packt_figref">Figure 4.4 – Offline network mode</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="4">Try to refresh your browser. You will see an indication that you are disconnected from the internet, as shown in the following screenshot:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18465_04_05.png" alt="Figure 4.4 – No internet connection (Google Chrome)"/></figure>
    <p class="packt_figref">Figure 4.5 – No internet connection (Google Chrome)</p>
    <p class="normal">The previous case is standard in areas with low-quality internet connections. So, what can we do for our users in such places? Luckily, the Angular framework contains an implementation of a service worker that can significantly enhance the UX of our application when running in offline mode. It can cache certain application parts and deliver them accordingly instead of making real requests.</p>
    <div class="packt_tip">
      <p class="normal">The Angular service worker can also be used in environments with large network latency connections. Consider using a service worker in this type of network also to improve the experience of your users.</p>
    </div>
    <p class="normal">Run the <a id="_idIndexMarker217"/>following command of the Angular CLI to enable the service worker in our Angular application:</p>
    <pre class="programlisting con"><code class="hljs-con">ng add @angular/pwa
</code></pre>
    <p class="normal">The preceding command will transform the Angular CLI workspace accordingly for PWA support:</p>
    <ul>
      <li class="bulletList">It adds the <code class="inlineCode">@angular/service-worker</code> npm package to the <code class="inlineCode">dependencies</code> section of the <code class="inlineCode">package.json</code> file of the application.</li>
      <li class="bulletList">It creates the <code class="inlineCode">manifest.webmanifest</code> file in the <code class="inlineCode">src</code> folder of the application. The manifest file contains information about the application needed to install and run it natively. It also adds it to the <code class="inlineCode">assets</code> array of the <code class="inlineCode">build</code> options in the <code class="inlineCode">angular.json</code> file.</li>
      <li class="bulletList">It creates the <code class="inlineCode">ngsw-config.json</code> file at the root of the project, which is the service worker configuration file. We use it to define configuration-specific artifacts, such as which resources are cached and how they are cached. You can find more details about the configuration of the service worker at the following link: <a href="https://angular.io/guide/service-worker-config#service-worker-configuration"><span class="url">https://angular.io/guide/service-worker-config#service-worker-configuration</span></a>.</li>
      <li class="bulletList">The configuration file is also set in the <code class="inlineCode">ngswConfigPath</code> property of the <code class="inlineCode">build</code> configuration in the <code class="inlineCode">angular.json</code> file.</li>
      <li class="bulletList">It sets the <code class="inlineCode">serviceWorker</code> property to <code class="inlineCode">true</code> in the <code class="inlineCode">build</code> configuration of the <code class="inlineCode">angular.json</code> file.</li>
      <li class="bulletList">It registers the service worker in the <code class="inlineCode">app.module.ts</code> file:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-meta">@NgModule</span>({
  <span class="hljs-attr">declarations</span>: [
    <span class="hljs-title">AppComponent</span>,
    <span class="hljs-title">WeatherComponent</span>
  ],
  <span class="hljs-attr">imports</span>: [
    <span class="hljs-title">BrowserModule</span>,
    <span class="hljs-title">BrowserAnimationsModule</span>,
    <span class="hljs-title">HttpClientModule</span>,
    <span class="hljs-title">MatIconModule</span>,
    <span class="hljs-title">MatInputModule</span>,
    <span class="hljs-title">MatCardModule</span>,
    <span class="code-highlight"><strong class="hljs-title-slc">ServiceWorkerModule</strong><strong class="hljs-slc">.</strong><strong class="hljs-title-slc">register</strong><strong class="hljs-slc">(</strong><strong class="hljs-string-slc">'ngsw-worker.js'</strong><strong class="hljs-slc">, {</strong></span>
<span class="code-highlight"><strong class="hljs-slc">      </strong><strong class="hljs-attr-slc">enabled</strong><strong class="hljs-slc">: !</strong><strong class="hljs-title-slc">isDevMode</strong><strong class="hljs-slc">(),</strong></span>
<span class="code-highlight"><strong class="hljs-slc">      </strong><strong class="hljs-comment-slc">// Register the ServiceWorker as soon as the application is stable</strong></span>
<span class="code-highlight"><strong class="hljs-slc">      </strong><strong class="hljs-comment-slc">// or after 30 seconds (whichever comes first).</strong></span>
<span class="code-highlight"><strong class="hljs-slc">      </strong><strong class="hljs-attr-slc">registrationStrategy</strong><strong class="hljs-slc">: </strong><strong class="hljs-string-slc">'registerWhenStable:30000'</strong></span>
<span class="code-highlight"><strong class="hljs-slc">    })</strong></span>
  ],
  <span class="hljs-attr">providers</span>: [],
  <span class="hljs-attr">bootstrap</span>: [<span class="hljs-title">AppComponent</span>]
})
</code></pre>
      </li>
      <li class="bulletList">The <code class="inlineCode">ngsw-worker.js</code> file is the JavaScript file that contains the actual implementation<a id="_idIndexMarker218"/> of the service worker. It is created automatically for us when we build our application. Angular uses the <code class="inlineCode">register</code> method of the <code class="inlineCode">ServiceWorkerModule</code> class to register it within our application.</li>
      <li class="bulletList">It creates several icons to be used when the application is installed as a native one on the device of the user.</li>
      <li class="bulletList">It includes the manifest file and a <code class="inlineCode">&lt;meta&gt;</code> tag for <code class="inlineCode">theme-color</code> in the <code class="inlineCode">&lt;head&gt;</code> element of the <code class="inlineCode">index.html</code> file:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag">&lt;</span><span class="hljs-name">link</span><span class="hljs-tag"> </span><span class="hljs-attr">rel</span><span class="hljs-tag">=</span><span class="hljs-string">"manifest"</span><span class="hljs-tag"> </span><span class="hljs-attr">href</span><span class="hljs-tag">=</span><span class="hljs-string">"manifest.webmanifest"</span><span class="hljs-tag">&gt;</span>
<span class="hljs-tag">&lt;</span><span class="hljs-name">meta</span><span class="hljs-tag"> </span><span class="hljs-attr">name</span><span class="hljs-tag">=</span><span class="hljs-string">"theme-color"</span><span class="hljs-tag"> </span><span class="hljs-attr">content</span><span class="hljs-tag">=</span><span class="hljs-string">"#1976d2"</span><span class="hljs-tag">&gt;</span>
</code></pre>
      </li>
    </ul>
    <p class="normal">Now that we have completed the service worker installation, it is time to test it! Before moving on, we should install an external web server because the built-in function of the Angular CLI does not work with service workers. A good alternative is <strong class="keyWord">http-server</strong>:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Run the <code class="inlineCode">install</code> command of the npm client to install <code class="inlineCode">http-server</code>:
        <pre class="programlisting con"><code class="hljs-con">npm install -D http-server
</code></pre>
    <p class="normal">The preceding command will install <code class="inlineCode">http-server</code> as a development dependency of our Angular CLI project.</p>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="2">Build the Angular application using the <code class="inlineCode">ng build</code> command of the Angular CLI.</li>
      <li class="numberedList">Open the <code class="inlineCode">package.json</code> file of the Angular CLI workspace and add the following entry to the <code class="inlineCode">scripts</code> property:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-attr">"scripts"</span>: {
  <span class="hljs-string">"ng"</span>: <span class="hljs-string">"ng"</span>,
  <span class="hljs-string">"start"</span>: <span class="hljs-string">"ng serve"</span>,
  <span class="hljs-string">"build"</span>: <span class="hljs-string">"ng build"</span>,
  <span class="hljs-string">"watch"</span>: <span class="hljs-string">"ng build --watch --configuration development"</span>,
  <span class="hljs-string">"test"</span>: <span class="hljs-string">"ng test"</span>,
  <span class="code-highlight"><strong class="hljs-string-slc">"server"</strong><strong class="hljs-slc">: </strong><strong class="hljs-string-slc">"http-server -p 8080 -c-1 dist/weather-app"</strong></span>
}
</code></pre>
      </li>
      <li class="numberedList">Start <a id="_idIndexMarker219"/>the HTTP web server using the following command:
        <pre class="programlisting con"><code class="hljs-con">npm run server
</code></pre>
    <p class="normal">The preceding command will start http-server at port 8080 and have caching disabled.</p>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="5">Open your browser and navigate to <code class="inlineCode">http://localhost:8080</code>.
    <div class="packt_tip">
      <p class="normal">Prefer opening the page in private or incognito mode to avoid unexpected behavior from the service worker.</p>
    </div></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="6">Repeat the process we followed at the beginning of the section for switching to offline mode.</li>
      <li class="numberedList">If you refresh the page now, you will notice that the application is working as expected.
    <p class="normal">The service worker did all the work for us, and the process was so seamless that we could not tell whether we were online or offline. You can verify that by inspecting the <strong class="screenText">Network</strong> tab:</p>
    <figure class="mediaobject"><img src="../Images/B18465_04_06.png" alt="Figure 4.5 – Service worker (offline mode)"/></figure>
    <p class="packt_figref">Figure 4.6 – Service worker (offline mode)</p></li>
    </ol>
    <p class="normal">The <strong class="screenText">(ServiceWorker)</strong> value in the <strong class="screenText">Size</strong> column indicates that the service worker served a cached version of our application.</p>
    <p class="normal">We have successfully <a id="_idIndexMarker220"/>installed the service worker and moved closer to converting our application into a PWA. In the following section, we will learn how to notify users of the application about potential updates.</p>
    <h1 id="_idParaDest-78" class="heading-1">Staying up to date with in-app notifications</h1>
    <p class="normal">When we <a id="_idIndexMarker221"/>want to apply a change in a web application, we make the change and build a new version of our application. The application is then deployed to a web server, and every user can access the latest version immediately. But PWAs are different.</p>
    <p class="normal">When we deploy a new version of our PWA, the service worker must act accordingly and apply a specific update strategy. It should notify the user of the new version or install it immediately. Which update strategy we follow depends on our requirements. In this project, we want to show a prompt to the user and let them decide whether they want to update the app. Let’s see how to implement this feature in our application:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Open the <code class="inlineCode">app.module.ts</code> file and add <code class="inlineCode">MatSnackBarModule</code> to the <code class="inlineCode">imports</code> array of the <code class="inlineCode">@NgModule</code> decorator:
        <pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-keyword-slc">import</strong><strong class="hljs-slc"> { </strong><strong class="hljs-title-slc">MatSnackBarModule</strong><strong class="hljs-slc"> } </strong><strong class="hljs-keyword-slc">from</strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc">'@angular/material/snack-bar'</strong><strong class="hljs-slc">;</strong></span>
<span class="hljs-meta">@NgModule</span>({
  <span class="hljs-attr">declarations</span>: [
    <span class="hljs-title">AppComponent</span>,
    <span class="hljs-title">WeatherComponent</span>
  ],
  <span class="hljs-attr">imports</span>: [
    <span class="hljs-title">BrowserModule</span>,
    <span class="hljs-title">BrowserAnimationsModule</span>,
    <span class="hljs-title">HttpClientModule</span>,
    <span class="hljs-title">MatIconModule</span>,
    <span class="hljs-title">MatInputModule</span>,
    <span class="hljs-title">MatCardModule</span>,
    <span class="code-highlight"><strong class="hljs-title-slc">MatSnackBarModule</strong></span>,
    <span class="hljs-title">ServiceWorkerModule</span>.<span class="hljs-title">register</span>(<span class="hljs-string">'ngsw-worker.js'</span>, {
      <span class="hljs-attr">enabled</span>: !<span class="hljs-title">isDevMode</span>(),
      <span class="hljs-comment">// Register the ServiceWorker as soon as the application is stable</span>
      <span class="hljs-comment">// or after 30 seconds (whichever comes first).</span>
      <span class="hljs-attr">registrationStrategy</span>: <span class="hljs-string">'registerWhenStable:30000'</span>
    })
  ],
  <span class="hljs-attr">providers</span>: [],
  <span class="hljs-attr">bootstrap</span>: [<span class="hljs-title">AppComponent</span>]
})
</code></pre>
    <p class="normal"><code class="inlineCode">MatSnackBarModule</code> is an Angular Material module that allows us to interact with <strong class="keyWord">snack </strong><strong class="keyWord"><a id="_idIndexMarker222"/></strong><strong class="keyWord">bars</strong>. A snack bar is a pop-up window that usually appears on the bottom of the page and is used for notification purposes.</p>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="2">Open the <code class="inlineCode">app.component.ts</code> file and add the <code class="inlineCode">OnInit</code> interface to the implemented interfaces of the <code class="inlineCode">AppComponent</code> class:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">import</span> { <span class="hljs-title">Component</span>, <span class="code-highlight"><strong class="hljs-title-slc">OnInit</strong></span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>;
<span class="hljs-meta">@Component</span>({
  <span class="hljs-attr">selector</span>: <span class="hljs-string">'app-root'</span>,
  <span class="hljs-attr">templateUrl</span>: <span class="hljs-string">'./app.component.html'</span>,
  <span class="hljs-attr">styleUrls</span>: [<span class="hljs-string">'./app.component.scss'</span>]
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title">AppComponent</span> <span class="code-highlight"><strong class="hljs-keyword-slc">implements</strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc">OnInit</strong></span> {
  title = <span class="hljs-string">'weather-app'</span>;
}
</code></pre>
      </li>
      <li class="numberedList">Inject the <code class="inlineCode">MatSnackBar</code> and <code class="inlineCode">SwUpdate</code> services in the <code class="inlineCode">constructor</code> of the <code class="inlineCode">AppComponent</code> class:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">import</span> { <span class="hljs-title">Component</span>, <span class="hljs-title">OnInit</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>;
<span class="code-highlight"><strong class="hljs-keyword-slc">import</strong><strong class="hljs-slc"> { </strong><strong class="hljs-title-slc">MatSnackBar</strong><strong class="hljs-slc"> } </strong><strong class="hljs-keyword-slc">from</strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc">'@angular/material/snack-bar'</strong><strong class="hljs-slc">;</strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc">import</strong><strong class="hljs-slc"> { </strong><strong class="hljs-title-slc">SwUpdate</strong><strong class="hljs-slc">, </strong><strong class="hljs-title-slc">VersionReadyEvent</strong><strong class="hljs-slc"> } </strong><strong class="hljs-keyword-slc">from</strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc">'@angular/service-worker'</strong><strong class="hljs-slc">;</strong></span>
<span class="hljs-meta">@Component</span>({
  <span class="hljs-attr">selector</span>: <span class="hljs-string">'app-root'</span>,
  <span class="hljs-attr">templateUrl</span>: <span class="hljs-string">'./app.component.html'</span>,
  <span class="hljs-attr">styleUrls</span>: [<span class="hljs-string">'./app.component.scss'</span>]
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title">AppComponent</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">OnInit</span> {
  title = <span class="hljs-string">'weather-app'</span>;
  <span class="code-highlight"><strong class="hljs-title-slc">constructor</strong><strong class="hljs-slc">(</strong><strong class="hljs-keyword-slc">private</strong><strong class="hljs-params-slc"> updates: SwUpdate, </strong><strong class="hljs-keyword-slc">private</strong><strong class="hljs-params-slc"> snackbar: MatSnackBar</strong><strong class="hljs-slc">) {}</strong></span>
}
</code></pre>
    <p class="normal">The <code class="inlineCode">MatSnackBar</code> service is an Angular service exposed from <code class="inlineCode">MatSnackBarModule</code>. The <code class="inlineCode">SwUpdate</code> service is part of the service worker and contains observables that we can use to notify the user on the update process of our application.</p>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="4">Create the following <code class="inlineCode">ngOnInit</code> method:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-title">ngOnInit</span>() {
  <span class="hljs-variable">this</span>.<span class="hljs-property">updates</span>.<span class="hljs-property">versionUpdates</span>.<span class="hljs-title">pipe</span>(
    <span class="hljs-title">filter</span>((evt): evt is <span class="hljs-title">VersionReadyEvent</span> =&gt; evt.<span class="hljs-property">type</span> === <span class="hljs-string">'VERSION_READY'</span>),
    <span class="hljs-title">switchMap</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable">this</span>.<span class="hljs-property">snackbar</span>.<span class="hljs-title">open</span>(<span class="hljs-string">'A new version is available!'</span>, <span class="hljs-string">'</span><span class="hljs-string">Update now'</span>).<span class="hljs-title">afterDismissed</span>()),
    <span class="hljs-title">filter</span>(<span class="hljs-params">result</span><span class="hljs-function"> =&gt;</span> result.<span class="hljs-property">dismissedByAction</span>),
    <span class="hljs-title">map</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable">this</span>.<span class="hljs-property">updates</span>.<span class="hljs-title">activateUpdate</span>().<span class="hljs-title">then</span>(<span class="hljs-function">() =&gt;</span> location.<span class="hljs-title">reload</span>()))
  ).<span class="hljs-title">subscribe</span>();
}
</code></pre>
    <p class="normal">The <code class="inlineCode">ngOnInit</code> method is<a id="_idIndexMarker223"/> an implementation method of the <code class="inlineCode">OnInit</code> interface and is called upon component initialization. The <code class="inlineCode">SwUpdate</code> service contains a <code class="inlineCode">versionUpdates</code> observable property that we can use to get notified when a new version of our application is available. Typically, we tend to subscribe to observables, but in this case, we don’t. Instead, we subscribe to the <code class="inlineCode">pipe</code> method, an RxJS operator for composing multiple operators.</p>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="5">Add the following <code class="inlineCode">import</code> statements at the top of the <code class="inlineCode">app.component.ts</code> file:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">import</span> { filter, map, switchMap } <span class="hljs-keyword">from</span> <span class="hljs-string">'rxjs'</span>;
</code></pre>
      </li>
    </ol>
    <p class="normal">A lot is going on inside the <code class="inlineCode">ngOnInit</code> method that we defined previously, so let’s break it down into pieces to understand it further. The <code class="inlineCode">pipe</code> operator combines four RxJS operators:</p>
    <ul>
      <li class="bulletList"><code class="inlineCode">filter: </code>We use it to filter out any emitted values from the <code class="inlineCode">versionUpdates</code> observable other than the one that indicates when the version is ready to be installed<code class="inlineCode">.</code></li>
      <li class="bulletList"><code class="inlineCode">switchMap</code>: This is called when a new version of our application is available. It uses the <code class="inlineCode">open</code> method of the <code class="inlineCode">snackbar</code> property to show a snack bar with an action button and subscribes to its <code class="inlineCode">afterDismissed</code> observable. The <code class="inlineCode">afterDismissed</code> observable emits when the snack bar is closed either by clicking the action button or programmatically using its API methods.</li>
      <li class="bulletList"><code class="inlineCode">filter</code>: This is called when the snack bar is dismissed using the action button.</li>
      <li class="bulletList"><code class="inlineCode">map</code>: This calls the <code class="inlineCode">activateUpdate</code> method of the <code class="inlineCode">updates</code> property to apply the new version of the application. Once the application has been updated, it reloads the browser window for the changes to take effect.</li>
    </ul>
    <p class="normal">Let’s see the <a id="_idIndexMarker224"/>whole process of updating to a new version in action:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Run the following command of the Angular CLI to build the Angular application:
        <pre class="programlisting con"><code class="hljs-con">ng build
</code></pre>
      </li>
      <li class="numberedList">Start the HTTP server to serve the application:
        <pre class="programlisting con"><code class="hljs-con">npm run server
</code></pre>
      </li>
      <li class="numberedList">Open a private or incognito browser window and navigate to <code class="inlineCode">http://localhost:8080</code>.</li>
      <li class="numberedList">Without closing the browser window, let’s introduce a change in our application and add a UI header. Run the <code class="inlineCode">generate</code> command of the Angular CLI to create a component:
        <pre class="programlisting con"><code class="hljs-con">ng generate component header
</code></pre>
      </li>
      <li class="numberedList">Open the <code class="inlineCode">app.module.ts</code> file and import the following Angular Material modules:
        <pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-keyword-slc">import</strong><strong class="hljs-slc"> { </strong><strong class="hljs-title-slc">MatButtonModule</strong><strong class="hljs-slc"> } </strong><strong class="hljs-keyword-slc">from</strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc">'@angular/material/button'</strong><strong class="hljs-slc">;</strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc">import</strong><strong class="hljs-slc"> { </strong><strong class="hljs-title-slc">MatToolbarModule</strong><strong class="hljs-slc"> } </strong><strong class="hljs-keyword-slc">from</strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc">'@angular/material/toolbar'</strong><strong class="hljs-slc">;</strong></span>
<span class="hljs-meta">@NgModule</span>({
  <span class="hljs-attr">declarations</span>: [
    <span class="hljs-title">AppComponent</span>,
    <span class="hljs-title">WeatherComponent</span>,
    <span class="hljs-title">HeaderComponent</span>
  ],
  <span class="hljs-attr">imports</span>: [
    <span class="hljs-title">BrowserModule</span>,
    <span class="hljs-title">BrowserAnimationsModule</span>,
    <span class="hljs-title">HttpClientModule</span>,
    <span class="hljs-title">MatIconModule</span>,
    <span class="hljs-title">MatInputModule</span>,
    <span class="hljs-title">MatCardModule</span>,
    <span class="hljs-title">MatSnackBarModule</span>,
<span class="code-highlight"><strong class="hljs-slc">    </strong><strong class="hljs-title-slc">MatButtonModule</strong><strong class="hljs-slc">,</strong></span>
<span class="code-highlight"><strong class="hljs-slc">    </strong><strong class="hljs-title-slc">MatToolbarModule</strong><strong class="hljs-slc">,</strong></span>
    <span class="hljs-title">ServiceWorkerModule</span>.<span class="hljs-title">register</span>(<span class="hljs-string">'</span><span class="hljs-string">ngsw-worker.js'</span>, {
      <span class="hljs-attr">enabled</span>: !<span class="hljs-title">isDevMode</span>(),
      <span class="hljs-comment">// Register the ServiceWorker as soon as the application is stable</span>
      <span class="hljs-comment">// or after 30 seconds (whichever comes first).</span>
      <span class="hljs-attr">registrationStrategy</span>: <span class="hljs-string">'registerWhenStable:30000'</span>
    })
  ],
  <span class="hljs-attr">providers</span>: [],
  <span class="hljs-attr">bootstrap</span>: [<span class="hljs-title">AppComponent</span>]
})
</code></pre>
      </li>
      <li class="numberedList">Open<a id="_idIndexMarker225"/> the <code class="inlineCode">header.component.html</code> file and create a <code class="inlineCode">&lt;mat-toolbar&gt;</code> component with two HTML <code class="inlineCode">&lt;button&gt;</code> elements, each one containing a <code class="inlineCode">&lt;mat-icon&gt;</code> component:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag">&lt;</span><span class="hljs-name">mat-toolbar</span><span class="hljs-tag"> </span><span class="hljs-attr">color</span><span class="hljs-tag">=</span><span class="hljs-string">"primary"</span><span class="hljs-tag">&gt;</span>
  <span class="hljs-tag">&lt;</span><span class="hljs-name">span</span><span class="hljs-tag">&gt;</span>Weather App<span class="hljs-tag">&lt;/</span><span class="hljs-name">span</span><span class="hljs-tag">&gt;</span>
  <span class="hljs-tag">&lt;</span><span class="hljs-name">span</span><span class="hljs-tag"> </span><span class="hljs-attr">class</span><span class="hljs-tag">=</span><span class="hljs-string">"spacer"</span><span class="hljs-tag">&gt;&lt;/</span><span class="hljs-name">span</span><span class="hljs-tag">&gt;</span>
  <span class="hljs-tag">&lt;</span><span class="hljs-name">button</span><span class="hljs-tag"> </span><span class="hljs-attr">mat-icon-button</span><span class="hljs-tag">&gt;</span>
    <span class="hljs-tag">&lt;</span><span class="hljs-name">mat-icon</span><span class="hljs-tag">&gt;</span>refresh<span class="hljs-tag">&lt;/</span><span class="hljs-name">mat-icon</span><span class="hljs-tag">&gt;</span>
  <span class="hljs-tag">&lt;/</span><span class="hljs-name">button</span><span class="hljs-tag">&gt;</span>
  <span class="hljs-tag">&lt;</span><span class="hljs-name">button</span><span class="hljs-tag"> </span><span class="hljs-attr">mat-icon-button</span><span class="hljs-tag">&gt;</span>
    <span class="hljs-tag">&lt;</span><span class="hljs-name">mat-icon</span><span class="hljs-tag">&gt;</span>share<span class="hljs-tag">&lt;/</span><span class="hljs-name">mat-icon</span><span class="hljs-tag">&gt;</span>
  <span class="hljs-tag">&lt;/</span><span class="hljs-name">button</span><span class="hljs-tag">&gt;</span>
<span class="hljs-tag">&lt;/</span><span class="hljs-name">mat-toolbar</span><span class="hljs-tag">&gt;</span>
</code></pre>
      </li>
      <li class="numberedList">Add the following CSS style to the <code class="inlineCode">header.component.scss</code> file to position buttons at the far-right end of the header:
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-selector-class">.spacer</span> {
  <span class="hljs-attribute">flex</span>: <span class="hljs-number">1</span> <span class="hljs-number">1</span> auto;
}
</code></pre>
      </li>
      <li class="numberedList">Open <a id="_idIndexMarker226"/>the <code class="inlineCode">app.component.html</code> file and add the <code class="inlineCode">&lt;app-header&gt;</code> component at the top:
        <pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-tag-slc">&lt;</strong><strong class="hljs-name-slc">app-header</strong><strong class="hljs-tag-slc">&gt;&lt;/</strong><strong class="hljs-name-slc">app-header</strong><strong class="hljs-tag-slc">&gt;</strong></span>
<span class="hljs-tag">&lt;</span><span class="hljs-name">app-weather</span><span class="hljs-tag">&gt;&lt;/</span><span class="hljs-name">app-weather</span><span class="hljs-tag">&gt;</span>
</code></pre>
      </li>
      <li class="numberedList">Repeat steps 1 and 2 and refresh the browser window that points to <code class="inlineCode">http://localhost:8080</code>. You should see the following notification at the bottom of the page after a few seconds:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18465_04_07.png" alt="Figure 4.6 – New version notification"/></figure>
    <p class="packt_figref">Figure 4.7 – New version notification</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="10">Click on the <strong class="screenText">Update now</strong> button, wait for the browser window to reload, and you should see your change:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18465_04_08.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.8 – Application output</p>
    <p class="normal">Our Angular application has begun to transform into a PWA one. Along with the caching mechanism that the Angular service worker provides, we have added a mechanism for installing new versions of our application. In the following section, we will learn how to deploy and install our application natively on our device.</p>
    <h1 id="_idParaDest-79" class="heading-1">Deploying our app with Firebase Hosting</h1>
    <p class="normal">Firebase<a id="_idIndexMarker227"/> is a hosting <a id="_idIndexMarker228"/>solution provided by Google that we can use to deploy our Angular applications. The Firebase team <a id="_idIndexMarker229"/>has put much effort into creating an Angular CLI schematic for deploying an Angular application using one single command. Before diving deeper, let’s learn how to set up Firebase Hosting:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Use a Google account to log in to Firebase at <a href="https://console.firebase.google.com"><span class="url">https://console.firebase.google.com</span></a>.</li>
      <li class="numberedList">Click the <strong class="screenText">Add project</strong> button to create a new Firebase project.</li>
      <li class="numberedList">Enter the name of the project, <code class="inlineCode">weather-app</code>, and click the <strong class="screenText">Continue</strong> button.
    <div class="note">
      <p class="normal">Firebase generates a unique identifier for your project, such as <em class="italic">weather-app-b11a2</em>, underneath the name of the project. The identifier will be used in the hosting URL of your project later on.</p>
    </div></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="4">Disable the use of <strong class="keyWord">Google Analytics</strong> for your project and click the <strong class="screenText">Create project</strong> button.</li>
      <li class="numberedList">Once the project has been created, the following will appear on the screen:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18465_04_09.png" alt="Figure 4.8 – Firebase project creation"/></figure>
    <p class="packt_figref">Figure 4.9 – Firebase project creation</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="6">Click <a id="_idIndexMarker230"/>on the <strong class="screenText">Continue</strong> button, and you will be redirected to the dashboard of your new Firebase project.</li>
    </ol>
    <p class="normal">We have now <a id="_idIndexMarker231"/>completed the configuration of Firebase Hosting. It is now time to integrate it with our Angular application:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Run the following command in a terminal window to install <strong class="keyWord">Firebase tools</strong>:
        <pre class="programlisting con"><code class="hljs-con">npm install -g firebase-tools
</code></pre>
      </li>
      <li class="numberedList">Run the following command in the same terminal window to authenticate with the Firebase CLI:
        <pre class="programlisting con"><code class="hljs-con">firebase login
</code></pre>
      </li>
      <li class="numberedList">Finally, run the following command of the Angular CLI to install the <code class="inlineCode">@angular/fire</code> npm package in your Angular CLI project:
        <pre class="programlisting con"><code class="hljs-con">ng add @angular/fire
</code></pre>
    <p class="normal">The<a id="_idIndexMarker232"/> preceding command will find the latest version of the library and prompt us to install it.</p>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="4">First, it will ask what features of Firebase we want to enable:
        <pre class="programlisting con"><code class="hljs-con">? What features would you like to setup?
</code></pre>
    <p class="normal">Ensure the <code class="inlineCode">ng deploy -- hosting</code> option is selected, and press <em class="keystroke">Enter</em>.</p>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="5">Then, it will ask us to select which Firebase account we want to use:
        <pre class="programlisting con"><code class="hljs-con">? Which Firebase account would you like to use?
</code></pre>
    <p class="normal">Ensure the <a id="_idIndexMarker233"/>account you used earlier is selected, and press <em class="keystroke">Enter</em>.</p>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="6">In the next question, we will choose the project with which we are going to deploy our application:
        <pre class="programlisting con"><code class="hljs-con">? Please select a project:
</code></pre>
    <p class="normal">Select the <code class="inlineCode">weather-app</code> project that we created earlier and press <em class="keystroke">Enter</em>. </p>
      </li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="7">Finally, we must choose the site that will host our application:
        <pre class="programlisting con"><code class="hljs-con">? Please select a hosting site:
</code></pre>
      </li>
    </ol>
    <p class="normal">Select the hosting website that we created earlier and press <em class="keystroke">Enter</em>.</p>
    <p class="normal">The previous process will modify the Angular CLI workspace accordingly to accommodate its deployment to Firebase:</p>
    <ul>
      <li class="bulletList">It will create a <code class="inlineCode">.firebaserc</code> file in the root folder that contains details of the selected Firebase project.</li>
      <li class="bulletList">It will create a <code class="inlineCode">firebase.json</code> file in the root folder, which is the Firebase configuration file. The configuration file specifies settings such as the folder that will be deployed to Firebase and any rewrite rules.
    <div class="note">
      <p class="normal">The folder deployed by default is the <code class="inlineCode">dist</code> output folder created by the Angular CLI when we run the <code class="inlineCode">ng build</code> command.</p>
    </div></li>
    </ul>
    <ul>
      <li class="bulletList">It will add a <code class="inlineCode">deploy</code> target in the <code class="inlineCode">angular.json</code> configuration file.</li>
    </ul>
    <p class="normal">To deploy the<a id="_idIndexMarker234"/> application, we only need to run a single Angular CLI command, and the Angular CLI will take care of the rest:</p>
    <pre class="programlisting con"><code class="hljs-con">ng deploy
</code></pre>
    <p class="normal">The preceding<a id="_idIndexMarker235"/> command will build and deploy the application to the selected Firebase project. Once deployment is complete, the Angular CLI will report back the following information:</p>
    <ul>
      <li class="bulletList"><strong class="keyWord">Project Console</strong>: The dashboard of the Firebase project.</li>
      <li class="bulletList"><strong class="keyWord">Hosting URL</strong>: The URL of the deployed version of the application. It consists of the unique identifier of the Firebase project and the <code class="inlineCode">.web.app</code> suffix that is added automatically from Firebase.</li>
    </ul>
    <div class="note">
      <p class="normal">The service worker requires an application to be served with HTTPS to work properly as a PWA, except in the localhost that is used for development. Firebase hosts web applications with HTTPS by default.</p>
    </div>
    <p class="normal">Now that we have deployed our application, let’s see how we can install it as a PWA on our device:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Navigate to the hosting URL and click on the <strong class="screenText">Install weather-app</strong> button next to the address bar of the browser:
    <figure class="mediaobject"><img src="../Images/B18465_04_10.png" alt="Εικόνα που περιέχει κείμενο  Περιγραφή που δημιουργήθηκε αυτόματα"/></figure>
    <p class="packt_figref">Figure 4.10 – Installing the application (Google Chrome)</p>
    <div class="note">
      <p class="normal">The installation button may be found in different locations in other browsers.</p>
    </div>
    <p class="normal">The<a id="_idIndexMarker236"/> browser will prompt us to install the application.</p></li>
    </ol>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="2">Click the <strong class="screenText">Install</strong> button, and the application will open as a native window on our device:</li>
    </ol>
    <figure class="mediaobject"><img src="../Images/B18465_04_11.png" alt=""/></figure>
    <p class="packt_figref">Figure 4.11 – PWA </p>
    <p class="normal">It will <a id="_idIndexMarker237"/>also install a shortcut for launching the application directly from our device. Congratulations! We now have a full PWA that displays weather information for a city.</p>
    <h1 id="_idParaDest-80" class="heading-1">Summary</h1>
    <p class="normal">In this chapter, we built a PWA that displays weather information for a given city.</p>
    <p class="normal">Initially, we set up the OpenWeather API to get weather data and created an Angular application from scratch to integrate it. We learned how to use the built-in HTTP client of the Angular framework to communicate with the OpenWeather API. We also installed the Angular Material library and used some ready-made UI components for our application.</p>
    <p class="normal">After creating the Angular application, we introduced the Angular service worker and enabled it to work offline. We learned how to interact with the service worker and provide notifications for updates in our application. Finally, we deployed a production version of our application into Firebase Hosting and installed it locally on our device.</p>
    <p class="normal">In the next chapter, we will learn how to create an Angular desktop application with Electron, the big rival of PWAs.</p>
    <h1 id="_idParaDest-81" class="heading-1">Exercise</h1>
    <p class="normal">Use the OpenWeather API to display a weekly forecast for the selected city. The OpenWeather API provides the <strong class="screenText">5 Day / 3 Hour Forecast</strong> collection that can be used. The collection returns a forecast every 3 hours for each day, so, for a weekly forecast, you should just focus on the weather at 12:00pm each day. The forecast should be displayed as a grid list of card components and should be positioned below the current weather of the city.</p>
    <p class="normal">You can find the solution to the exercise in the <code class="inlineCode">Chapter04</code> folder of the <code class="inlineCode">exercise</code> branch at <a href="https://github.com/PacktPublishing/Angular-Projects-Third-Edition/tree/exercise"><span class="url">https://github.com/PacktPublishing/Angular-Projects-Third-Edition/tree/exercise</span></a>.</p>
    <h1 id="_idParaDest-82" class="heading-1">Further reading</h1>
    <ul>
      <li class="bulletList">PWAs: <a href="https://web.dev/progressive-web-apps"><span class="url">https://web.dev/progressive-web-apps</span></a></li>
      <li class="bulletList">OpenWeather API: <a href="https://openweathermap.org/api"><span class="url">https://openweathermap.org/api</span></a></li>
      <li class="bulletList">Angular Material: <a href="https://material.angular.io"><span class="url">https://material.angular.io</span></a></li>
      <li class="bulletList">Angular HTTP client: <a href="https://angular.io/guide/http"><span class="url">https://angular.io/guide/http</span></a></li>
      <li class="bulletList">Angular service worker: <a href="https://angular.io/guide/service-worker-getting-started "><span class="url">https://angular.io/guide/service-worker-getting-started</span></a></li>
      <li class="bulletList">Communicating with the Angular service worker: <a href="https://angular.io/guide/service-worker-communications"><span class="url">https://angular.io/guide/service-worker-communications</span></a></li>
      <li class="bulletList">HTTP server: <a href="https://www.npmjs.com/package/http-server"><span class="url">https://www.npmjs.com/package/http-server</span></a></li>
      <li class="bulletList">Firebase Hosting: <a href="https://firebase.google.com/docs/hosting"><span class="url">https://firebase.google.com/docs/hosting</span></a></li>
      <li class="bulletList">Deployment in Angular: <a href="https://angular.io/guide/deployment#automatic-deployment-with-the-cli"><span class="url">https://angular.io/guide/deployment#automatic-deployment-with-the-cli</span></a></li>
    </ul>
  </div>
</body></html>