<html><head></head><body>
<div id="_idContainer061">
<h1 class="chapter-number" id="_idParaDest-104"><a id="_idTextAnchor162"/><span class="koboSpan" id="kobo.1.1">6</span></h1>
<h1 id="_idParaDest-105"><a id="_idTextAnchor163"/><span class="koboSpan" id="kobo.2.1">Creating a Fitness Tracker with Data Visualization</span></h1>
<p><span class="koboSpan" id="kobo.3.1">Up until this point, we’ve relied on stateless apps or storing the state on the users’ browser. </span><span class="koboSpan" id="kobo.3.2">In this chapter, we’ll cover using a database to store data in a centralized place, and we’ll learn how to modify and read from the data source. </span><span class="koboSpan" id="kobo.3.3">We’ll use the opportunity to incorporate some data visualizations as well, using a </span><span class="No-Break"><span class="koboSpan" id="kobo.4.1">third-party library.</span></span></p>
<p><span class="koboSpan" id="kobo.5.1">While we’re using a database and have to set up tables, this is by no means a guide to production-ready database configuration and management. </span><span class="koboSpan" id="kobo.5.2">I suggest brushing up on those skills in different ways. </span><span class="koboSpan" id="kobo.5.3">It does serve as a valuable prototype to familiarize yourself with patterns concerning </span><span class="No-Break"><span class="koboSpan" id="kobo.6.1">database handling.</span></span></p>
<p><span class="koboSpan" id="kobo.7.1">Again, we’ll build upon the knowledge we’ve acquired so far, and we’ll incorporate composables, a store, and a component library to build </span><span class="No-Break"><span class="koboSpan" id="kobo.8.1">our product.</span></span></p>
<p><span class="koboSpan" id="kobo.9.1">In this chapter, we’ll cover the </span><span class="No-Break"><span class="koboSpan" id="kobo.10.1">following topics:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.11.1">Creating dashboards </span><span class="No-Break"><span class="koboSpan" id="kobo.12.1">and reports</span></span></li>
<li><span class="koboSpan" id="kobo.13.1">Retrieving data </span><span class="No-Break"><span class="koboSpan" id="kobo.14.1">with Supabase</span></span></li>
<li><span class="koboSpan" id="kobo.15.1">Storing data </span><span class="No-Break"><span class="koboSpan" id="kobo.16.1">using Supabase</span></span></li>
<li><span class="koboSpan" id="kobo.17.1">Adding various visualizations </span><span class="No-Break"><span class="koboSpan" id="kobo.18.1">using </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.19.1">vue-chartjs</span></strong></span></li>
</ul>
<h1 id="_idParaDest-106"><a id="_idTextAnchor164"/><span class="koboSpan" id="kobo.20.1">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.21.1">There’s some overlap in requirements from the previous chapter. </span><span class="koboSpan" id="kobo.21.2">We’ll make use of </span><strong class="bold"><span class="koboSpan" id="kobo.22.1">Vuetify</span></strong><span class="koboSpan" id="kobo.23.1"> (</span><a href="https://vuetifyjs.com/en/"><span class="koboSpan" id="kobo.24.1">https://vuetifyjs.com/en/</span></a><span class="koboSpan" id="kobo.25.1">) and </span><strong class="bold"><span class="koboSpan" id="kobo.26.1">Pinia</span></strong><span class="koboSpan" id="kobo.27.1"> (</span><a href="https://pinia.vuejs.org/"><span class="koboSpan" id="kobo.28.1">https://pinia.vuejs.org/</span></a><span class="koboSpan" id="kobo.29.1">). </span><span class="koboSpan" id="kobo.29.2">For storing data, we’ll make use of </span><strong class="bold"><span class="koboSpan" id="kobo.30.1">Supabase</span></strong><span class="koboSpan" id="kobo.31.1"> (</span><a href="https://supabase.com/"><span class="koboSpan" id="kobo.32.1">https://supabase.com/</span></a><span class="koboSpan" id="kobo.33.1">), which is an open source database provider with built-in authentication. </span><span class="koboSpan" id="kobo.33.2">For the database, I’ve prepared a script to create databases and another one to add </span><span class="No-Break"><span class="koboSpan" id="kobo.34.1">example data.</span></span></p>
<p><span class="koboSpan" id="kobo.35.1">Here’s the GitHub </span><span class="No-Break"><span class="koboSpan" id="kobo.36.1">link: </span></span><a href="https://github.com/PacktPublishing/Building-Real-world-Web-Applications-with-Vue.js-3/tree/main/06.fitness"><span class="No-Break"><span class="koboSpan" id="kobo.37.1">https://github.com/PacktPublishing/Building-Real-world-Web-Applications-with-Vue.js-3/tree/main/06.fitness</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.38.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.39.1">We’ll cover those steps during the chapter. </span><span class="koboSpan" id="kobo.39.2">Lastly, for data visualization, we’ll install and use </span><strong class="source-inline"><span class="koboSpan" id="kobo.40.1">vue-chartjs</span></strong><span class="koboSpan" id="kobo.41.1"> (</span><a href="https://vue-chartjs.org/"><span class="koboSpan" id="kobo.42.1">https://vue-chartjs.org/</span></a><span class="koboSpan" id="kobo.43.1">), which is a Vue-compatible wrapper for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.44.1">chart.js</span></strong><span class="koboSpan" id="kobo.45.1"> (</span><a href="https://www.chartjs.org/"><span class="No-Break"><span class="koboSpan" id="kobo.46.1">https://www.chartjs.org/</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.47.1">) library.</span></span></p>
<h1 id="_idParaDest-107"><a id="_idTextAnchor165"/><span class="koboSpan" id="kobo.48.1">Creating a client</span></h1>
<p><span class="koboSpan" id="kobo.49.1">In order to start our project, we’ll use the Vuetify installer, just as we did in the last chapter. </span><span class="koboSpan" id="kobo.49.2">Here’s the</span><a id="_idIndexMarker259"/><span class="koboSpan" id="kobo.50.1"> command </span><span class="No-Break"><span class="koboSpan" id="kobo.51.1">for that:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.52.1">
npm create vuetify</span></pre> <p><span class="koboSpan" id="kobo.53.1">Choose </span><strong class="source-inline"><span class="koboSpan" id="kobo.54.1">vue-fitness-tracker</span></strong><span class="koboSpan" id="kobo.55.1"> as the project name and select these options, as shown in the </span><span class="No-Break"><span class="koboSpan" id="kobo.56.1">following screenshot:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer050">
<span class="koboSpan" id="kobo.57.1"><img alt="Figure 6.1 – Setting up the Vuetify project" src="image/B19563_06_01.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.58.1">Figure 6.1 – Setting up the Vuetify project</span></p>
<p><span class="koboSpan" id="kobo.59.1">With our project initialized, we’ll create and configure a database to store </span><span class="No-Break"><span class="koboSpan" id="kobo.60.1">our data.</span></span></p>
<h1 id="_idParaDest-108"><a id="_idTextAnchor166"/><span class="koboSpan" id="kobo.61.1">Setting up the database</span></h1>
<p><span class="koboSpan" id="kobo.62.1">After registering</span><a id="_idIndexMarker260"/><span class="koboSpan" id="kobo.63.1"> for a free</span><a id="_idIndexMarker261"/><span class="koboSpan" id="kobo.64.1"> account on </span><strong class="bold"><span class="koboSpan" id="kobo.65.1">Supabase</span></strong><span class="koboSpan" id="kobo.66.1"> (</span><a href="https://supabase.com/"><span class="koboSpan" id="kobo.67.1">https://supabase.com/</span></a><span class="koboSpan" id="kobo.68.1">), you’ll end up in the dashboard to create a new project. </span><span class="koboSpan" id="kobo.68.2">Let’s use </span><strong class="source-inline"><span class="koboSpan" id="kobo.69.1">fitness-tracker</span></strong><span class="koboSpan" id="kobo.70.1"> as the name and choose a strong database password. </span><span class="koboSpan" id="kobo.70.2">For the region, pick one that is geographically close to you for better latency. </span><span class="koboSpan" id="kobo.70.3">We’ll stick with the </span><span class="No-Break"><span class="koboSpan" id="kobo.71.1">free plan!</span></span></p>
<p><span class="koboSpan" id="kobo.72.1">On the next page (</span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.73.1">Figure 6</span></em></span><em class="italic"><span class="koboSpan" id="kobo.74.1">.2</span></em><span class="koboSpan" id="kobo.75.1">), you will see the project </span><span class="No-Break"><span class="koboSpan" id="kobo.76.1">API keys:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer051">
<span class="koboSpan" id="kobo.77.1"><img alt="Figure 6.2 – Overview of the project API keys" src="image/B19563_06_02.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.78.1">Figure 6.2 – Overview of the project API keys</span></p>
<p><span class="koboSpan" id="kobo.79.1">We’ll store them in our </span><strong class="source-inline"><span class="koboSpan" id="kobo.80.1">.env</span></strong><span class="koboSpan" id="kobo.81.1"> file in </span><a id="_idIndexMarker262"/><span class="koboSpan" id="kobo.82.1">the root of </span><span class="No-Break"><span class="koboSpan" id="kobo.83.1">our project:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.84.1">
VITE_SUPABASE_URL=YOUR_SUPABASE_URLVITE_SUPABASE_ANON_KEY=YOUR_SUPABASE_ANON_KEY</span></pre>
<p><span class="koboSpan" id="kobo.85.1">Note that sharing keys like this via a client-side app always exposes them to the public. </span><span class="koboSpan" id="kobo.85.2">Luckily, Supabase has its own means of ensuring authentication while interacting with </span><span class="No-Break"><span class="koboSpan" id="kobo.86.1">the database.</span></span></p>
<p><span class="koboSpan" id="kobo.87.1">I’ve created a script that sets up the database with the table structure for our app. </span><span class="koboSpan" id="kobo.87.2">Via the dashboard and SQL editor, you can add and execute the query from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.88.1">example-structure.sql</span></strong><span class="koboSpan" id="kobo.89.1"> file in the example repository, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.90.1">Figure 6</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.91.1">.3</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.92.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer052">
<span class="koboSpan" id="kobo.93.1"><img alt="Figure 6.3 – Once the query is successfully executed, you should see four tables in the table editor overview" src="image/B19563_06_03.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.94.1">Figure 6.3 – Once the query is successfully executed, you should see four tables in the table editor overview</span></p>
<p><span class="koboSpan" id="kobo.95.1">Once that’s executed, you </span><a id="_idIndexMarker263"/><span class="koboSpan" id="kobo.96.1">can set up some data using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.97.1">example-exercises.sql</span></strong><span class="koboSpan" id="kobo.98.1"> script, as seen in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.99.1">Figure 6</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.100.1">.4</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.101.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer053">
<span class="koboSpan" id="kobo.102.1"><img alt="Figure 6.4 – Inserting example exercises into the exercise table" src="image/B19563_06_04.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.103.1">Figure 6.4 – Inserting example exercises into the exercise table</span></p>
<p><span class="koboSpan" id="kobo.104.1">To streamline interactions with the database, we’ll use the Supabase JavaScript client by installing </span><span class="No-Break"><span class="koboSpan" id="kobo.105.1">the dependency:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.106.1">
npm install @supabase/supabase-js</span></pre> <p><span class="koboSpan" id="kobo.107.1">Let’s turn that package into a composable that handles our database connection within the app. </span><span class="koboSpan" id="kobo.107.2">In </span><strong class="source-inline"><span class="koboSpan" id="kobo.108.1">src/composables</span></strong><span class="koboSpan" id="kobo.109.1">, we’ll create a </span><strong class="source-inline"><span class="koboSpan" id="kobo.110.1">supabase.ts</span></strong><span class="koboSpan" id="kobo.111.1"> file and add the </span><span class="No-Break"><span class="koboSpan" id="kobo.112.1">following contents:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.113.1">
import { createClient } from '@supabase/supabase-js'const supabaseUrl = import.meta.env.VITE_SUPABASE_URL
const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY
export const useSupabaseClient = createClient(supabaseUrl, supabaseAnonKey);</span></pre>
<p><span class="koboSpan" id="kobo.114.1">One final change I made was cleaning up the </span><strong class="source-inline"><span class="koboSpan" id="kobo.115.1">layouts</span></strong><span class="koboSpan" id="kobo.116.1"> folder with the boilerplate components. </span><span class="koboSpan" id="kobo.116.2">I deleted </span><a id="_idIndexMarker264"/><span class="koboSpan" id="kobo.117.1">all files except </span><strong class="source-inline"><span class="koboSpan" id="kobo.118.1">Default.vue</span></strong><span class="koboSpan" id="kobo.119.1"> and updated its contents to </span><span class="No-Break"><span class="koboSpan" id="kobo.120.1">match this:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.121.1">
&lt;template&gt;  &lt;v-app&gt;
    &lt;v-main&gt;
      &lt;router-view /&gt;
    &lt;/v-main&gt;
  &lt;/v-app&gt;
&lt;/template&gt;</span></pre>
<p><span class="koboSpan" id="kobo.122.1">That’s our baseline to start building our app. </span><span class="koboSpan" id="kobo.122.2">Next, we’re going to make sure that the app shows individual results, using the built-in tooling that </span><span class="No-Break"><span class="koboSpan" id="kobo.123.1">Supabase provides</span><a id="_idTextAnchor167"/><span class="koboSpan" id="kobo.124.1">.</span></span></p>
<h1 id="_idParaDest-109"><a id="_idTextAnchor168"/><span class="koboSpan" id="kobo.125.1">Handling the user</span></h1>
<p><span class="koboSpan" id="kobo.126.1">The goal of the app is to allow for individual metrics to be tracked and viewed, so for that purpose, we need to</span><a id="_idIndexMarker265"/><span class="koboSpan" id="kobo.127.1"> make sure that we can identify our users. </span><span class="koboSpan" id="kobo.127.2">Supabase supports authentication out of the box, and we’re going to use a very basic method: a </span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.128.1">magic link</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.129.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.130.1">A magic link allows you to sign up and sign in</span><a id="_idIndexMarker266"/><span class="koboSpan" id="kobo.131.1"> with just a valid email address. </span><span class="koboSpan" id="kobo.131.2">On logging in, the service sends an email containing a unique identifier, and when clicked, the user is verified to that email address. </span><span class="koboSpan" id="kobo.131.3">In our case, the backend handles verifying whether it’s a new user or an existing one, which is perfect for our </span><span class="No-Break"><span class="koboSpan" id="kobo.132.1">use case.</span></span></p>
<p><span class="koboSpan" id="kobo.133.1">Since we can identify users, we need to connect our app to retrieve information that Supabase provides. </span><span class="koboSpan" id="kobo.133.2">We can also introduce authentication to make sure that users have access to parts that they </span><a id="_idIndexMarker267"/><span class="koboSpan" id="kobo.134.1">want to use </span><span class="No-Break"><span class="koboSpan" id="kobo.135.1">or vi</span><a id="_idTextAnchor169"/><span class="koboSpan" id="kobo.136.1">sit.</span></span></p>
<h2 id="_idParaDest-110"><a id="_idTextAnchor170"/><span class="koboSpan" id="kobo.137.1">User store</span></h2>
<p><span class="koboSpan" id="kobo.138.1">We will want to have access and the ability to update the status of the user at all times, so we’ll set up a user </span><a id="_idIndexMarker268"/><span class="koboSpan" id="kobo.139.1">store in Pinia that will keep track of the current state and provide actions on updating the state and logging in </span><span class="No-Break"><span class="koboSpan" id="kobo.140.1">and out.</span></span></p>
<p><span class="koboSpan" id="kobo.141.1">We’ll go over the contents of the store, after creating a </span><strong class="source-inline"><span class="koboSpan" id="kobo.142.1">user.ts</span></strong><span class="koboSpan" id="kobo.143.1"> file in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.144.1">src/store</span></strong><span class="koboSpan" id="kobo.145.1"> folder with the following </span><span class="No-Break"><span class="koboSpan" id="kobo.146.1">contents: </span></span><a href="https://github.com/PacktPublishing/Building-Real-world-Web-Applications-with-Vue.js-3/blob/main/06.fitness/.notes/6.1-user.ts"><span class="No-Break"><span class="koboSpan" id="kobo.147.1">https://github.com/PacktPublishing/Building-Real-world-Web-Applications-with-Vue.js-3/blob/main/06.fitness/.notes/6.1-user.ts</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.148.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.149.1">In the session (</span><em class="italic"><span class="koboSpan" id="kobo.150.1">line 11</span></em><span class="koboSpan" id="kobo.151.1">), we’ll store the authentication state of the user. </span><span class="koboSpan" id="kobo.151.2">It can either be </span><strong class="source-inline"><span class="koboSpan" id="kobo.152.1">null</span></strong><span class="koboSpan" id="kobo.153.1"> for not logged in or the state can hold an object (as defined in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.154.1">UserSession</span></strong><span class="koboSpan" id="kobo.155.1"> interface), which gets populated by the Supabase </span><span class="No-Break"><span class="koboSpan" id="kobo.156.1">authorization service.</span></span></p>
<p><span class="koboSpan" id="kobo.157.1">With the </span><strong class="source-inline"><span class="koboSpan" id="kobo.158.1">login</span></strong><span class="koboSpan" id="kobo.159.1"> (</span><em class="italic"><span class="koboSpan" id="kobo.160.1">lines 13-20</span></em><span class="koboSpan" id="kobo.161.1">) and </span><strong class="source-inline"><span class="koboSpan" id="kobo.162.1">logout</span></strong><span class="koboSpan" id="kobo.163.1"> (</span><em class="italic"><span class="koboSpan" id="kobo.164.1">lines 22-30</span></em><span class="koboSpan" id="kobo.165.1">) methods, we are calling the Supabase authentication services and executing a provided callback function. </span><span class="koboSpan" id="kobo.165.2">We will see these in </span><span class="No-Break"><span class="koboSpan" id="kobo.166.1">action shortly!</span></span></p>
<p><span class="koboSpan" id="kobo.167.1">To store the user, we have the </span><strong class="source-inline"><span class="koboSpan" id="kobo.168.1">insertProfile</span></strong><span class="koboSpan" id="kobo.169.1"> function (</span><em class="italic"><span class="koboSpan" id="kobo.170.1">lines 32-44</span></em><span class="koboSpan" id="kobo.171.1">), which upserts any authenticated user to our database for </span><span class="No-Break"><span class="koboSpan" id="kobo.172.1">future reference.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.173.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.174.1">Storing personal data may be subject to local law and governance. </span><span class="koboSpan" id="kobo.174.2">Be very diligent and transparent in what you store, why you’re storing it, and how you remove </span><span class="No-Break"><span class="koboSpan" id="kobo.175.1">personal data.</span></span></p>
<p><strong class="source-inline"><span class="koboSpan" id="kobo.176.1">setUserSession</span></strong><span class="koboSpan" id="kobo.177.1"> (</span><em class="italic"><span class="koboSpan" id="kobo.178.1">lines 47-49</span></em><span class="koboSpan" id="kobo.179.1">) simply passes the data to the state for further reference. </span><span class="koboSpan" id="kobo.179.2">Lastly, </span><strong class="source-inline"><span class="koboSpan" id="kobo.180.1">userIsLoggedIn</span></strong><span class="koboSpan" id="kobo.181.1"> (</span><em class="italic"><span class="koboSpan" id="kobo.182.1">lines 51-58</span></em><span class="koboSpan" id="kobo.183.1">) checks whether the current session data is still valid, and if not, it returns </span><strong class="source-inline"><span class="koboSpan" id="kobo.184.1">false</span></strong><span class="koboSpan" id="kobo.185.1">. </span><span class="koboSpan" id="kobo.185.2">We can use this for quick assessments on displaying user </span><span class="No-Break"><span class="koboSpan" id="kobo.186.1">interface elements.</span></span></p>
<p><span class="koboSpan" id="kobo.187.1">Having the store in place, we can incorporate profiles in our app with some sensible </span><span class="No-Break"><span class="koboSpan" id="kobo.188.1">safety meas</span><a id="_idTextAnchor171"/><span class="koboSpan" id="kobo.189.1">ures.</span></span></p>
<h2 id="_idParaDest-111"><a id="_idTextAnchor172"/><span class="koboSpan" id="kobo.190.1">Authenticating users</span></h2>
<p><span class="koboSpan" id="kobo.191.1">Let’s create a form where the user </span><a id="_idIndexMarker269"/><span class="koboSpan" id="kobo.192.1">can provide an email address that will</span><a id="_idIndexMarker270"/><span class="koboSpan" id="kobo.193.1"> result in a </span><strong class="bold"><span class="koboSpan" id="kobo.194.1">one-time password</span></strong><span class="koboSpan" id="kobo.195.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.196.1">OTP</span></strong><span class="koboSpan" id="kobo.197.1">) generated by Supabase. </span><span class="koboSpan" id="kobo.197.2">We’ll create a form called </span><strong class="source-inline"><span class="koboSpan" id="kobo.198.1">FormLogin.vue</span></strong><span class="koboSpan" id="kobo.199.1"> in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.200.1">components</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.201.1">folder: </span></span><a href="https://github.com/PacktPublishing/Building-Real-world-Web-Applications-with-Vue.js-3/blob/main/06.fitness/.notes/6.2-FormLogin.vue"><span class="No-Break"><span class="koboSpan" id="kobo.202.1">https://github.com/PacktPublishing/Building-Real-world-Web-Applications-with-Vue.js-3/blob/main/06.fitness/.notes/6.2-FormLogin.vue</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.203.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.204.1">As you can see, we’re using our user store to dispatch a </span><strong class="source-inline"><span class="koboSpan" id="kobo.205.1">login</span></strong><span class="koboSpan" id="kobo.206.1"> action (</span><em class="italic"><span class="koboSpan" id="kobo.207.1">lines 11-14</span></em><span class="koboSpan" id="kobo.208.1">, </span><em class="italic"><span class="koboSpan" id="kobo.209.1">25</span></em><span class="koboSpan" id="kobo.210.1">) with the email address provided by the user. </span><span class="koboSpan" id="kobo.210.2">The template is built with Vuetify components. </span><span class="koboSpan" id="kobo.210.3">It holds a </span><strong class="source-inline"><span class="koboSpan" id="kobo.211.1">form</span></strong><span class="koboSpan" id="kobo.212.1"> and a </span><strong class="source-inline"><span class="koboSpan" id="kobo.213.1">dialog</span></strong><span class="koboSpan" id="kobo.214.1"> component that is triggered on submission, to inform the user to look at </span><span class="No-Break"><span class="koboSpan" id="kobo.215.1">their email.</span></span></p>
<p><span class="koboSpan" id="kobo.216.1">The OTP login sends a login link to the provided email address, which means the user will enter the app from an external link. </span><span class="koboSpan" id="kobo.216.2">We need to make sure to try to validate the user’s session when the app gets loaded. </span><span class="koboSpan" id="kobo.216.3">For that, we’ll update the </span><strong class="source-inline"><span class="koboSpan" id="kobo.217.1">App.vue</span></strong><span class="koboSpan" id="kobo.218.1"> file in </span><span class="No-Break"><span class="koboSpan" id="kobo.219.1">the root:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.220.1">
&lt;script setup lang="ts"&gt;</span><strong class="bold"><span class="koboSpan" id="kobo.221.1">import { onMounted } from "vue";</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.222.1">import { useUserStore } from "@/store/user";</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.223.1">import { useSupabaseClient } from "@/composables/supabase";</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.224.1">const userStore = useUserStore();</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.225.1">onMounted(async () =&gt; {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.226.1">  const { data } = await useSupabaseClient.auth.getSession();</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.227.1">  if (data &amp;&amp; data.session &amp;&amp; data.session.user) {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.228.1">    await userStore.insertProfile(data.session);</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.229.1">    userStore.setUserSession(data.session);</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.230.1">  }</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.231.1">  useSupabaseClient.auth.onAuthStateChange((_, _session) =&gt; {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.232.1">    userStore.setUserSession(_session);</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.233.1">  });</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.234.1">});</span></strong><span class="koboSpan" id="kobo.235.1">
&lt;/script&gt;
&lt;template&gt;
  &lt;router-view /&gt;
&lt;/template&gt;</span></pre>
<p><span class="koboSpan" id="kobo.236.1">In this script, we’ll validate the user session via Supabase. </span><span class="koboSpan" id="kobo.236.2">On receiving data, we store it on the user store</span><a id="_idIndexMarker271"/><span class="koboSpan" id="kobo.237.1"> and use the store to upsert a profile in our database. </span><span class="koboSpan" id="kobo.237.2">We also keep track of the state change, in order to handle updated tokens </span><span class="No-Break"><span class="koboSpan" id="kobo.238.1">or inval</span><a id="_idTextAnchor173"/><span class="koboSpan" id="kobo.239.1">idation.</span></span></p>
<h2 id="_idParaDest-112"><a id="_idTextAnchor174"/><span class="koboSpan" id="kobo.240.1">Protected routes</span></h2>
<p><span class="koboSpan" id="kobo.241.1">Having access to the state of the user, we can use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.242.1">beforeEnter</span></strong><span class="koboSpan" id="kobo.243.1"> lifecycle hook to validate if a user is allowed access to a route. </span><span class="koboSpan" id="kobo.243.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.244.1">beforeEnter</span></strong><span class="koboSpan" id="kobo.245.1"> method acts as middleware and </span><a id="_idIndexMarker272"/><span class="koboSpan" id="kobo.246.1">executes a function whereby you can decide how to handle the </span><span class="No-Break"><span class="koboSpan" id="kobo.247.1">route change.</span></span></p>
<p><span class="koboSpan" id="kobo.248.1">We’ll first create a view for the login state, called </span><strong class="source-inline"><span class="koboSpan" id="kobo.249.1">Login.vue</span></strong><span class="koboSpan" id="kobo.250.1">, in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.251.1">views</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.252.1"> folder:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.253.1">
&lt;script lang="ts" setup&gt;import FormLogin from '@/components/FormLogin.vue';
&lt;/script&gt;
&lt;template&gt;
  &lt;form-login /&gt;
&lt;/template&gt;</span></pre>
<p><span class="koboSpan" id="kobo.254.1">In the router file, we’ll add a function called </span><strong class="source-inline"><span class="koboSpan" id="kobo.255.1">loginGuard</span></strong><span class="koboSpan" id="kobo.256.1"> (</span><em class="italic"><span class="koboSpan" id="kobo.257.1">lines 7-14</span></em><span class="koboSpan" id="kobo.258.1">) to check whether the user is logged in, and we’ll call that function on the </span><strong class="source-inline"><span class="koboSpan" id="kobo.259.1">beforeEnter</span></strong><span class="koboSpan" id="kobo.260.1"> method for protected routes (</span><em class="italic"><span class="koboSpan" id="kobo.261.1">line 37</span></em><span class="koboSpan" id="kobo.262.1">). </span><span class="koboSpan" id="kobo.262.2">If the user session is present, you will be allowed to follow the route. </span><span class="koboSpan" id="kobo.262.3">Otherwise, you will be redirected to the newly added </span><strong class="source-inline"><span class="koboSpan" id="kobo.263.1">loginRoute</span></strong><span class="koboSpan" id="kobo.264.1"> function (</span><em class="italic"><span class="koboSpan" id="kobo.265.1">lines 12</span></em><span class="koboSpan" id="kobo.266.1">, </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.267.1">39-44</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.268.1">): </span></span><a href="https://github.com/PacktPublishing/Building-Real-world-Web-Applications-with-Vue.js-3/blob/main/06.fitness/.notes/6.3-router-index.ts"><span class="No-Break"><span class="koboSpan" id="kobo.269.1">https://github.com/PacktPublishing/Building-Real-world-Web-Applications-with-Vue.js-3/blob/main/06.fitness/.notes/6.3-router-index.ts</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.270.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.271.1">If you run the development</span><a id="_idIndexMarker273"/><span class="koboSpan" id="kobo.272.1"> app, on the first visit, you will be presented with a login form since you are not yet authenticated, as shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.273.1">Figure 6</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.274.1">.5</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.275.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer054">
<span class="koboSpan" id="kobo.276.1"><img alt="Figure 6.5 – The user is not logged in and is redirected to the /login route" src="image/B19563_06_05.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.277.1">Figure 6.5 – The user is not logged in and is redirected to the /login route</span></p>
<p><span class="koboSpan" id="kobo.278.1">After providing your email address, a fullscreen popup appears to direct our user to the next steps. </span><span class="koboSpan" id="kobo.278.2">If you open your email client, you should receive an email containing a magic </span><span class="No-Break"><span class="koboSpan" id="kobo.279.1">link shortly:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer055">
<span class="koboSpan" id="kobo.280.1"><img alt="Figure 6.6 – Default email containing a magic link" src="image/B19563_06_06.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.281.1">Figure 6.6 – Default email containing a magic link</span></p>
<p><span class="koboSpan" id="kobo.282.1">Clicking on the magic link opens a new browser window and should now direct you to the home page, which is only </span><a id="_idIndexMarker274"/><span class="koboSpan" id="kobo.283.1">accessible for </span><span class="No-Break"><span class="koboSpan" id="kobo.284.1">logged-in users:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer056">
<span class="koboSpan" id="kobo.285.1"><img alt="Figure 6.7 – The home page is only visible to logged-in users" src="image/B19563_06_07.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.286.1">Figure 6.7 – The home page is only visible to logged-in users</span></p>
<p><span class="koboSpan" id="kobo.287.1">This means if you’re seeing the Vuetify default home page, you are a logged-in user! </span><span class="koboSpan" id="kobo.287.2">You have no way of logging out for now, so let’s work on that to complete the </span><span class="No-Break"><span class="koboSpan" id="kobo.288.1">authenticati</span><a id="_idTextAnchor175"/><span class="koboSpan" id="kobo.289.1">on flow.</span></span></p>
<h2 id="_idParaDest-113"><a id="_idTextAnchor176"/><span class="koboSpan" id="kobo.290.1">Logging out</span></h2>
<p><span class="koboSpan" id="kobo.291.1">To complete the user flow, we’ll add a feature for the user to log out as well. </span><span class="koboSpan" id="kobo.291.2">For that, we’ll add a menu with a </span><a id="_idIndexMarker275"/><span class="koboSpan" id="kobo.292.1">button that is attached to the user logout method on </span><span class="No-Break"><span class="koboSpan" id="kobo.293.1">the store.</span></span></p>
<p><span class="koboSpan" id="kobo.294.1">Let’s create an </span><strong class="source-inline"><span class="koboSpan" id="kobo.295.1">AppMenu.vue</span></strong><span class="koboSpan" id="kobo.296.1"> file in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.297.1">src</span></strong><span class="koboSpan" id="kobo.298.1"> folder and add </span><strong class="bold"><span class="koboSpan" id="kobo.299.1">Log out </span></strong><span class="koboSpan" id="kobo.300.1">and </span><strong class="bold"><span class="koboSpan" id="kobo.301.1">Log in</span></strong><span class="koboSpan" id="kobo.302.1"> buttons. </span><span class="koboSpan" id="kobo.302.2">We’ll expand upon the menu later as </span><span class="No-Break"><span class="koboSpan" id="kobo.303.1">well: </span></span><a href="https://github.com/PacktPublishing/Building-Real-world-Web-Applications-with-Vue.js-3/blob/main/06.fitness/.notes/6.4-AppMenu.vue"><span class="No-Break"><span class="koboSpan" id="kobo.304.1">https://github.com/PacktPublishing/Building-Real-world-Web-Applications-with-Vue.js-3/blob/main/06.fitness/.notes/6.4-AppMenu.vue</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.305.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.306.1">In the menu, depending on the user state (</span><em class="italic"><span class="koboSpan" id="kobo.307.1">lines 5-6</span></em><span class="koboSpan" id="kobo.308.1">, </span><em class="italic"><span class="koboSpan" id="kobo.309.1">10</span></em><span class="koboSpan" id="kobo.310.1">, </span><em class="italic"><span class="koboSpan" id="kobo.311.1">18</span></em><span class="koboSpan" id="kobo.312.1">), we’ll show a button to either log in or log out. </span><span class="koboSpan" id="kobo.312.2">With some small modifications to our </span><strong class="source-inline"><span class="koboSpan" id="kobo.313.1">App.vue</span></strong><span class="koboSpan" id="kobo.314.1"> file, we can quickly include the </span><strong class="source-inline"><span class="koboSpan" id="kobo.315.1">AppMenu.vue</span></strong><span class="koboSpan" id="kobo.316.1"> file for our app (</span><em class="italic"><span class="koboSpan" id="kobo.317.1">lines 6</span></em><span class="koboSpan" id="kobo.318.1">, </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.319.1">21-26</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.320.1">): </span></span><a href="https://github.com/PacktPublishing/Building-Real-world-Web-Applications-with-Vue.js-3/blob/main/06.fitness/.notes/6.5-AppMenu.vue"><span class="No-Break"><span class="koboSpan" id="kobo.321.1">https://github.com/PacktPublishing/Building-Real-world-Web-Applications-with-Vue.js-3/blob/main/06.fitness/.notes/6.5-AppMenu.vue</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.322.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.323.1">We have now completed the user flow in our app. </span><span class="koboSpan" id="kobo.323.2">We can have new users logging in and existing users logging in, and logged-in users can sign out of the app. </span><span class="koboSpan" id="kobo.323.3">As you can see, we’ll let Supabase handle the logic, and we’re just consuming the data </span><span class="No-Break"><span class="koboSpan" id="kobo.324.1">from Supabase.</span></span></p>
<p><span class="koboSpan" id="kobo.325.1">This is a common</span><a id="_idIndexMarker276"/><span class="koboSpan" id="kobo.326.1"> pattern in frontend development, to leave the authentication to the server and never the client. </span><span class="koboSpan" id="kobo.326.2">For our upcoming features, we don’t have to worry about who has</span><a id="_idIndexMarker277"/><span class="koboSpan" id="kobo.327.1"> access to what data since we’ve configured Supabase (with </span><strong class="bold"><span class="koboSpan" id="kobo.328.1">Row Level Security</span></strong><span class="koboSpan" id="kobo.329.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.330.1">RLS</span></strong><span class="koboSpan" id="kobo.331.1">) policies (</span><a href="https://supabase.com/docs/guides/auth#row-level-security"><span class="koboSpan" id="kobo.332.1">https://supabase.com/docs/guides/auth#row-level-security</span></a><span class="koboSpan" id="kobo.333.1">)) and the authentication methods to take care of the data </span><span class="No-Break"><span class="koboSpan" id="kobo.334.1">for us.</span></span></p>
<p><span class="koboSpan" id="kobo.335.1">Now that we have a way for users to sign up and log in, we can start adding features for adding personal data </span><a id="_idTextAnchor177"/><span class="koboSpan" id="kobo.336.1">to </span><span class="No-Break"><span class="koboSpan" id="kobo.337.1">the app.</span></span></p>
<h1 id="_idParaDest-114"><a id="_idTextAnchor178"/><span class="koboSpan" id="kobo.338.1">App state</span></h1>
<p><span class="koboSpan" id="kobo.339.1">To make it easier for </span><a id="_idIndexMarker278"/><span class="koboSpan" id="kobo.340.1">us to control the state of the app, we’ll add a new store to track the current state of the </span><span class="No-Break"><span class="koboSpan" id="kobo.341.1">user interface.</span></span></p>
<p><span class="koboSpan" id="kobo.342.1">Vuetify has created a placeholder app store for us in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.343.1">store/app.ts</span></strong><span class="koboSpan" id="kobo.344.1"> file, so we’ll add some features to handle page transitions (</span><em class="italic"><span class="koboSpan" id="kobo.345.1">lines 28</span></em><span class="koboSpan" id="kobo.346.1">, </span><em class="italic"><span class="koboSpan" id="kobo.347.1">30-35</span></em><span class="koboSpan" id="kobo.348.1">), toggling a menu (</span><em class="italic"><span class="koboSpan" id="kobo.349.1">lines 18</span></em><span class="koboSpan" id="kobo.350.1">, </span><em class="italic"><span class="koboSpan" id="kobo.351.1">20-26</span></em><span class="koboSpan" id="kobo.352.1">) and controlling a dialog (</span><em class="italic"><span class="koboSpan" id="kobo.353.1">lines 37-55</span></em><span class="koboSpan" id="kobo.354.1">) for app-level </span><span class="No-Break"><span class="koboSpan" id="kobo.355.1">notifications: </span></span><a href="https://github.com/PacktPublishing/Building-Real-world-Web-Applications-with-Vue.js-3/blob/main/06.fitness/.notes/6.6-app.ts"><span class="No-Break"><span class="koboSpan" id="kobo.356.1">https://github.com/PacktPublishing/Building-Real-world-Web-Applications-with-Vue.js-3/blob/main/06.fitness/.notes/6.6-app.ts</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.357.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.358.1">Having access to these kinds of user interface utilities in a centralized place eliminates the need to repeat certain patterns in our app, such as showing or hiding a dialog. </span><span class="koboSpan" id="kobo.358.2">It means that those utilities are part of the app and are therefore available throughout th</span><a id="_idTextAnchor179"/><span class="koboSpan" id="kobo.359.1">e </span><span class="No-Break"><span class="koboSpan" id="kobo.360.1">whole app.</span></span></p>
<h2 id="_idParaDest-115"><a id="_idTextAnchor180"/><span class="koboSpan" id="kobo.361.1">Centralized dialog</span></h2>
<p><span class="koboSpan" id="kobo.362.1">Let’s update the </span><strong class="source-inline"><span class="koboSpan" id="kobo.363.1">FormLogin.vue</span></strong><span class="koboSpan" id="kobo.364.1"> file to</span><a id="_idIndexMarker279"/><span class="koboSpan" id="kobo.365.1"> make use of the store options on the app level. </span><span class="koboSpan" id="kobo.365.2">We can clean up the existing dialog options and replace them with calling store </span><span class="No-Break"><span class="koboSpan" id="kobo.366.1">methods: </span></span><a href="https://github.com/PacktPublishing/Building-Real-world-Web-Applications-with-Vue.js-3/blob/main/06.fitness/.notes/6.7-FormLogin.vue"><span class="No-Break"><span class="koboSpan" id="kobo.367.1">https://github.com/PacktPublishing/Building-Real-world-Web-Applications-with-Vue.js-3/blob/main/06.fitness/.notes/6.7-FormLogin.vue</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.368.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.369.1">As you can see, by using the generic app store (</span><em class="italic"><span class="koboSpan" id="kobo.370.1">lines 5</span></em><span class="koboSpan" id="kobo.371.1">, </span><em class="italic"><span class="koboSpan" id="kobo.372.1">8</span></em><span class="koboSpan" id="kobo.373.1">), we can now also easily add additional dialogs; for instance, when an email address is missing (</span><em class="italic"><span class="koboSpan" id="kobo.374.1">lines 13-17</span></em><span class="koboSpan" id="kobo.375.1">) or when the OTP has been sent (</span><em class="italic"><span class="koboSpan" id="kobo.376.1">lines 18-24</span></em><span class="koboSpan" id="kobo.377.1">). </span><span class="koboSpan" id="kobo.377.2">The only thing we need to do is add a central place to show the dialog, and</span><a id="_idIndexMarker280"/><span class="koboSpan" id="kobo.378.1"> we’ll open and modify </span><strong class="source-inline"><span class="koboSpan" id="kobo.379.1">App.vue</span></strong><span class="koboSpan" id="kobo.380.1"> for </span><span class="No-Break"><span class="koboSpan" id="kobo.381.1">that: </span></span><a href="https://github.com/PacktPublishing/Building-Real-world-Web-Applications-with-Vue.js-3/blob/main/06.fitness/.notes/6.8-App.vue"><span class="No-Break"><span class="koboSpan" id="kobo.382.1">https://github.com/PacktPublishing/Building-Real-world-Web-Applications-with-Vue.js-3/blob/main/06.fitness/.notes/6.8-App.vue</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.383.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.384.1">This way, we have a dialog (</span><em class="italic"><span class="koboSpan" id="kobo.385.1">lines 13</span></em><span class="koboSpan" id="kobo.386.1">, </span><em class="italic"><span class="koboSpan" id="kobo.387.1">31-39</span></em><span class="koboSpan" id="kobo.388.1">) that’s part of the app, and we can control it from anywhere using our store (</span><em class="italic"><span class="koboSpan" id="kobo.389.1">lines 4</span></em><span class="koboSpan" id="kobo.390.1">, </span><em class="italic"><span class="koboSpan" id="kobo.391.1">11</span></em><span class="koboSpan" id="kobo.392.1">)! </span><span class="koboSpan" id="kobo.392.2">The same goes for the app menu, so let’s modify our app to have centralized control over</span><a id="_idTextAnchor181"/><span class="koboSpan" id="kobo.393.1"> the </span><span class="No-Break"><span class="koboSpan" id="kobo.394.1">app menu.</span></span></p>
<h2 id="_idParaDest-116"><a id="_idTextAnchor182"/><span class="koboSpan" id="kobo.395.1">Centralized app menu</span></h2>
<p><span class="koboSpan" id="kobo.396.1">We can apply a similar pattern to a menu. </span><span class="koboSpan" id="kobo.396.2">We’ll convert it to a drawer link feature that slides in and out of</span><a id="_idIndexMarker281"/><span class="koboSpan" id="kobo.397.1"> view. </span><span class="koboSpan" id="kobo.397.2">Let’s start with modifying </span><strong class="source-inline"><span class="koboSpan" id="kobo.398.1">AppMenu.vue</span></strong><span class="koboSpan" id="kobo.399.1"> by adding the necessary app </span><span class="No-Break"><span class="koboSpan" id="kobo.400.1">store references:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.401.1">
&lt;script setup lang="ts"&gt;import { storeToRefs } from "pinia";
import { useUserStore } from "@/store/user";
</span><strong class="bold"><span class="koboSpan" id="kobo.402.1">import { useAppStore } from "@/store/app";</span></strong><span class="koboSpan" id="kobo.403.1">
const userStore = useUserStore();
</span><strong class="bold"><span class="koboSpan" id="kobo.404.1">const appStore = useAppStore();</span></strong><span class="koboSpan" id="kobo.405.1">
const { userIsLoggedIn } = storeToRefs(userStore);
</span><strong class="bold"><span class="koboSpan" id="kobo.406.1">const { drawer } = storeToRefs(appStore);</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.407.1">const goToPage = (page: string): void =&gt; {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.408.1">  appStore.navigateToPage(page);</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.409.1">};</span></strong><span class="koboSpan" id="kobo.410.1">
&lt;/script&gt;
&lt;template&gt;
</span><strong class="bold"><span class="koboSpan" id="kobo.411.1">  &lt;v-navigation-drawer v-model="drawer" app&gt;</span></strong><span class="koboSpan" id="kobo.412.1">
    &lt;v-list dense v-if="userIsLoggedIn"&gt;
      &lt;v-list-item @click="userStore.logout()"&gt;
        &lt;template v-slot:prepend&gt;
          &lt;v-icon icon="mdi-account-arrow-right"&gt;&lt;/v-icon&gt;
        &lt;/template&gt;
        &lt;v-list-item-title&gt;Log out&lt;/v-list-item-title&gt;
      &lt;/v-list-item&gt;
    &lt;/v-list&gt;
    &lt;v-list dense v-else&gt;
      </span><strong class="bold"><span class="koboSpan" id="kobo.413.1">&lt;v-list-item @click="goToPage('/login')"&gt;</span></strong><span class="koboSpan" id="kobo.414.1">
        &lt;template v-slot:prepend&gt;
          &lt;v-icon icon="mdi-account"&gt;&lt;/v-icon&gt;
        &lt;/template&gt;
</span><strong class="bold"><span class="koboSpan" id="kobo.415.1">        &lt;v-list-item-title&gt;Login&lt;/v-list-item-title&gt;</span></strong><span class="koboSpan" id="kobo.416.1">
      &lt;/v-list-item&gt;
    &lt;/v-list&gt;
</span><strong class="bold"><span class="koboSpan" id="kobo.417.1">  &lt;/v-navigation-drawer&gt;</span></strong><span class="koboSpan" id="kobo.418.1">
&lt;/template&gt;</span></pre>
<p><span class="koboSpan" id="kobo.419.1">In the template, we’ve</span><a id="_idIndexMarker282"/><span class="koboSpan" id="kobo.420.1"> wrapped the menu in a </span><strong class="source-inline"><span class="koboSpan" id="kobo.421.1">navigation-drawer</span></strong><span class="koboSpan" id="kobo.422.1"> component from Vuetify, which uses the </span><strong class="source-inline"><span class="koboSpan" id="kobo.423.1">drawer</span></strong><span class="koboSpan" id="kobo.424.1"> state variable to display as opened or closed. </span><span class="koboSpan" id="kobo.424.2">We’ve also replaced the </span><strong class="source-inline"><span class="koboSpan" id="kobo.425.1">router-link</span></strong><span class="koboSpan" id="kobo.426.1"> component with a method for navigating to </span><span class="No-Break"><span class="koboSpan" id="kobo.427.1">new pages.</span></span></p>
<p><span class="koboSpan" id="kobo.428.1">To complete the setup, we need to modify the </span><strong class="source-inline"><span class="koboSpan" id="kobo.429.1">App.vue</span></strong><span class="koboSpan" id="kobo.430.1"> file to adapt to the new interface and finalize</span><a id="_idIndexMarker283"/><span class="koboSpan" id="kobo.431.1"> the </span><span class="No-Break"><span class="koboSpan" id="kobo.432.1">app layout:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.433.1">
&lt;script setup lang="ts"&gt;// ...abbreviated
const userStore = useUserStore();
const appStore = useAppStore();
const { </span><strong class="bold"><span class="koboSpan" id="kobo.434.1">pageTitle, </span></strong><span class="koboSpan" id="kobo.435.1">dialog } = storeToRefs(appStore);
</span><strong class="bold"><span class="koboSpan" id="kobo.436.1">const currentYear = new Date().getFullYear();</span></strong><span class="koboSpan" id="kobo.437.1">
onMounted(async () =&gt; {
  // ...abbreviated
});
&lt;/script&gt;
&lt;template&gt;
  &lt;v-app&gt;
    &lt;app-menu /&gt;
</span><strong class="bold"><span class="koboSpan" id="kobo.438.1">    &lt;v-app-bar app style="position: relative"&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.439.1">      &lt;v-app-bar-nav-icon @click="appStore.toggleDrawer()"&gt;&lt;/v-app-bar-nav-icon&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.440.1">      &lt;v-toolbar-title&gt;</span></strong><strong class="bold"><span class="koboSpan" id="kobo.441.1">💪</span></strong><strong class="bold"><span class="koboSpan" id="kobo.442.1"> Fittest Pal - {{ pageTitle }}&lt;/v-toolbar-title&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.443.1">    &lt;/v-app-bar&gt;</span></strong><span class="koboSpan" id="kobo.444.1">
    &lt;v-main&gt;
      &lt;!-- abbreviated --&gt;
    &lt;/v-main&gt;
</span><strong class="bold"><span class="koboSpan" id="kobo.445.1">    &lt;v-footer app&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.446.1">      &lt;span&gt;&amp;copy; {{ currentYear }} </span></strong><strong class="bold"><span class="koboSpan" id="kobo.447.1">💪</span></strong><strong class="bold"><span class="koboSpan" id="kobo.448.1"> Fittest Pal Fitness Tracker&lt;/span&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.449.1">    &lt;/v-footer&gt;</span></strong><span class="koboSpan" id="kobo.450.1">
  &lt;/v-app&gt;
&lt;/template&gt;</span></pre>
<p><span class="koboSpan" id="kobo.451.1">So far, we have the foundation of an app that supports a personalized experience, depending on authentication by a third party, and the ability to have both public and secured routes. </span><span class="koboSpan" id="kobo.451.2">We have some centralized features to control the state of the app’s user interface. </span><span class="koboSpan" id="kobo.451.3">The next </span><a id="_idIndexMarker284"/><span class="koboSpan" id="kobo.452.1">step will be to add features where the user can insert their </span><span class="No-Break"><span class="koboSpan" id="kobo.453.1">own data!</span></span></p>
<p><span class="koboSpan" id="kobo.454.1">We’ve already prepared and set up our database with tables and some prefilled exercises. </span><span class="koboSpan" id="kobo.454.2">Feel free to take a look at the tables and the contents of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.455.1">exercises</span></strong><span class="koboSpan" id="kobo.456.1"> table, because it will help you understand our </span><span class="No-Break"><span class="koboSpan" id="kobo.457.1">next steps.</span></span></p>
<p><span class="koboSpan" id="kobo.458.1">We have a table exercise where different types of gym exercises are stored. </span><span class="koboSpan" id="kobo.458.2">The user data (limited to just an email address) is stored in the table. </span><span class="koboSpan" id="kobo.458.3">If you’ve signed up via the login form, you should see your email address already there! </span><span class="koboSpan" id="kobo.458.4">We have workouts where the training is logged per user, and the sets table combines performed exercises with a workout. </span><span class="koboSpan" id="kobo.458.5">Lastly, we have added a view for a dashboard, which we’ll build </span><span class="No-Break"><span class="koboSpan" id="kobo.459.1">later on.</span></span></p>
<p><span class="koboSpan" id="kobo.460.1">Now, let’s make sure users can add data to the database by building an </span><span class="No-Break"><span class="koboSpan" id="kobo.461.1">e</span><a id="_idTextAnchor183"/><span class="koboSpan" id="kobo.462.1">xercise tracker.</span></span></p>
<h1 id="_idParaDest-117"><a id="_idTextAnchor184"/><span class="koboSpan" id="kobo.463.1">Exercise tracking</span></h1>
<p><span class="koboSpan" id="kobo.464.1">Let’s add a new route to have our users add a routine to the database. </span><span class="koboSpan" id="kobo.464.2">Let’s start by adding a new route entry </span><a id="_idIndexMarker285"/><span class="koboSpan" id="kobo.465.1">on </span><span class="No-Break"><span class="koboSpan" id="kobo.466.1">the routes:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.467.1">
      {        path: 'track',
        name: 'Track',
        component: () =&gt; import(/* webpackChunkName: "track" */ '</span><strong class="bold"><span class="koboSpan" id="kobo.468.1">@/views/Track.vue</span></strong><span class="koboSpan" id="kobo.469.1">'),
        beforeEnter: </span><strong class="bold"><span class="koboSpan" id="kobo.470.1">loginGuard</span></strong><span class="koboSpan" id="kobo.471.1">
      },</span></pre>
<p><span class="koboSpan" id="kobo.472.1">As you can see, this is a page that is only accessible by authenticated users. </span><span class="koboSpan" id="kobo.472.2">Our entry also means that we need to create a view, called </span><strong class="source-inline"><span class="koboSpan" id="kobo.473.1">Track.vue</span></strong><span class="koboSpan" id="kobo.474.1">, so </span><span class="No-Break"><span class="koboSpan" id="kobo.475.1">let’s continue:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.476.1">
&lt;script lang="ts" setup&gt;import TrackExercise from "</span><strong class="bold"><span class="koboSpan" id="kobo.477.1">@/components/TrackExercise.vue</span></strong><span class="koboSpan" id="kobo.478.1">";
&lt;/script&gt;
&lt;template&gt;
  &lt;track-exercise /&gt;
&lt;/template&gt;</span></pre>
<p><span class="koboSpan" id="kobo.479.1">We’ll complete the initialization with the creation of an empty </span><strong class="source-inline"><span class="koboSpan" id="kobo.480.1">TrackExercise.vue</span></strong><span class="koboSpan" id="kobo.481.1"> file in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.482.1">components</span></strong><span class="koboSpan" id="kobo.483.1"> folder, and we’ll focus on creating an interface that matches the way we want to </span><span class="No-Break"><span class="koboSpan" id="kobo.484.1">track activities.</span></span></p>
<p><span class="koboSpan" id="kobo.485.1">To navigate to our route, we can modify our </span><strong class="source-inline"><span class="koboSpan" id="kobo.486.1">AppMenu.vue</span></strong><span class="koboSpan" id="kobo.487.1"> file. </span><span class="koboSpan" id="kobo.487.2">Since we can expect some more menu items, we can define a pattern for items in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.488.1">script</span></strong><span class="koboSpan" id="kobo.489.1"> block and have the template repeat over those items. </span><span class="koboSpan" id="kobo.489.2">We’ll start with a single item in the collection, </span><span class="No-Break"><span class="koboSpan" id="kobo.490.1">like this:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.491.1">
&lt;script setup lang="ts"&gt;// ...abbreviated
</span><strong class="bold"><span class="koboSpan" id="kobo.492.1">const menuItems = [</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.493.1">  {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.494.1">    icon: "mdi-dumbbell",</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.495.1">    title: "Track",</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.496.1">    page: "/track",</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.497.1">  }</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.498.1">];</span></strong><span class="koboSpan" id="kobo.499.1">
&lt;/script&gt;</span></pre>
<p><span class="koboSpan" id="kobo.500.1">In our template, we’ll </span><a id="_idIndexMarker286"/><span class="koboSpan" id="kobo.501.1">expand </span><strong class="source-inline"><span class="koboSpan" id="kobo.502.1">v-list</span></strong><span class="koboSpan" id="kobo.503.1"> for logged-in users to iterate over our </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.504.1">menuItems</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.505.1"> collection:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.506.1">
&lt;v-list dense v-if="userIsLoggedIn"&gt;</span><strong class="bold"><span class="koboSpan" id="kobo.507.1">  &lt;v-list-item</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.508.1">    v-for="item in menuItems"</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.509.1">    :key="item.title"</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.510.1">    @click="goToPage(item.page)"</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.511.1">  &gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.512.1">    &lt;template v-slot:prepend&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.513.1">      &lt;v-icon :icon="item.icon"&gt;&lt;/v-icon&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.514.1">    &lt;/template&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.515.1">    &lt;v-list-item-title&gt;{{ item.title }}&lt;/v-list-item-title&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.516.1">  &lt;/v-list-item&gt;</span></strong><span class="koboSpan" id="kobo.517.1">
  &lt;v-list-item @click="userStore.logout()"&gt;
    &lt;template v-slot:prepend&gt;
      &lt;v-icon icon="mdi-account-arrow-right"&gt;&lt;/v-icon&gt;
    &lt;/template&gt;
    &lt;v-list-item-title&gt;Log out&lt;/v-list-item-title&gt;
  &lt;/v-list-item&gt;
&lt;/v-list&gt;</span></pre>
<p><span class="koboSpan" id="kobo.518.1">We can now, from the menu, navigate to our ne</span><a id="_idTextAnchor185"/><span class="koboSpan" id="kobo.519.1">w page in </span><span class="No-Break"><span class="koboSpan" id="kobo.520.1">the app.</span></span></p>
<p><span class="koboSpan" id="kobo.521.1">Next, we can </span><a id="_idIndexMarker287"/><span class="koboSpan" id="kobo.522.1">define input fields. </span><span class="koboSpan" id="kobo.522.2">We’ll start by creating a date picker for </span><span class="No-Break"><span class="koboSpan" id="kobo.523.1">our users.</span></span></p>
<h2 id="_idParaDest-118"><a id="_idTextAnchor186"/><span class="koboSpan" id="kobo.524.1">Selecting a date</span></h2>
<p><span class="koboSpan" id="kobo.525.1">We want to add a date to</span><a id="_idIndexMarker288"/><span class="koboSpan" id="kobo.526.1"> our workout. </span><span class="koboSpan" id="kobo.526.2">Vuetify at the moment supports </span><strong class="source-inline"><span class="koboSpan" id="kobo.527.1">datepicker</span></strong><span class="koboSpan" id="kobo.528.1"> as an experimental feature. </span><span class="koboSpan" id="kobo.528.2">We need to explicitly import it into our newly created </span><strong class="source-inline"><span class="koboSpan" id="kobo.529.1">TrackExercise.vue</span></strong><span class="koboSpan" id="kobo.530.1"> file, and in addition, we’ll configure some variables to keep track of the user interface state as well as the </span><span class="No-Break"><span class="koboSpan" id="kobo.531.1">selected date:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.532.1">
&lt;script setup lang="ts"&gt;import { ref } from "vue";
import type { Ref } from "vue";
</span><strong class="bold"><span class="koboSpan" id="kobo.533.1">import { VDatePicker } from "vuetify/labs/VDatePicker";</span></strong><span class="koboSpan" id="kobo.534.1">
const showDialogDate: Ref&lt;boolean&gt; = ref(false);
const selectedDate: Ref&lt;any[] | undefined&gt; = ref(undefined);
&lt;/script&gt;</span></pre>
<p><span class="koboSpan" id="kobo.535.1">In our template, we’ll build controls to add a workout, beginning with a </span><span class="No-Break"><span class="koboSpan" id="kobo.536.1">date selection:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.537.1">
&lt;template&gt;  &lt;v-container&gt;
    &lt;v-row class="align-center justify-space-between mb-6"&gt;
      &lt;v-btn @click="showDialogDate = true"&gt;
        &lt;span v-if="selectedDate"&gt;Change date&lt;/span&gt;
        &lt;span v-else&gt;Select date&lt;/span&gt;
      &lt;/v-btn&gt;
      {{ selectedDate }}
      &lt;v-dialog v-model="showDialogDate" center&gt;
        &lt;v-date-picker
          v-model="selectedDate"
          show-adjacent-months
          @click:cancel="showDialogDate = false"
          @click:save="showDialogDate = false"
          style="margin: 0 auto"
        &gt;&lt;/v-date-picker&gt;
      &lt;/v-dialog&gt;
    &lt;/v-row&gt;
  &lt;/v-container&gt;
&lt;/template&gt;</span></pre>
<p><span class="koboSpan" id="kobo.538.1">This should look pretty familiar. </span><span class="koboSpan" id="kobo.538.2">We’ve added a button that controls a dialog and have some configuration for the dialog. </span><span class="koboSpan" id="kobo.538.3">The reason we’re not using our app-wide dialog is that this contains more advanced content and has hooks attached. </span><span class="koboSpan" id="kobo.538.4">The app dialog is meant to display short </span><a id="_idIndexMarker289"/><span class="koboSpan" id="kobo.539.1">messages to </span><span class="No-Break"><span class="koboSpan" id="kobo.540.1">our users.</span></span></p>
<p><span class="koboSpan" id="kobo.541.1">If you try this out, you’ll notice that selecting a date results in an unformatted date shown in the interface. </span><span class="koboSpan" id="kobo.541.2">We’ll fix that before we move on by using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.542.1">computed</span></strong><span class="koboSpan" id="kobo.543.1"> method and the browser’s built-in </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.544.1">Intl</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.545.1"> API:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.546.1">
&lt;script setup lang="ts"&gt;import { ref, </span><strong class="bold"><span class="koboSpan" id="kobo.547.1">computed</span></strong><span class="koboSpan" id="kobo.548.1"> } from "vue";
// ... </span><span class="koboSpan" id="kobo.548.2">abbreviated
</span><strong class="bold"><span class="koboSpan" id="kobo.549.1">const formattedDate: Ref&lt;string&gt; = computed(() =&gt; {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.550.1">  if (selectedDate?.value?.length) {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.551.1">    return new Intl.DateTimeFormat("en-US", {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.552.1">      weekday: "long",</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.553.1">      year: "numeric",</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.554.1">      month: "long",</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.555.1">      day: "numeric",</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.556.1">    }).format(selectedDate.value[0]);</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.557.1">  }</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.558.1">  return "";</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.559.1">});</span></strong><span class="koboSpan" id="kobo.560.1">
&lt;/script&gt;</span></pre>
<p><span class="koboSpan" id="kobo.561.1">In our</span><a id="_idIndexMarker290"/><span class="koboSpan" id="kobo.562.1"> template, we’ll replace </span><strong class="source-inline"><span class="koboSpan" id="kobo.563.1">{{ selectedDate }}</span></strong><span class="koboSpan" id="kobo.564.1"> with a nicely formatted </span><span class="No-Break"><span class="koboSpan" id="kobo.565.1">date representation:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.566.1">
&lt;h4 class="text-h5"&gt;{{</span><a id="_idTextAnchor187"/><span class="koboSpan" id="kobo.567.1"> formattedDate }}&lt;/h4&gt;</span></pre> <h2 id="_idParaDest-119"><a id="_idTextAnchor188"/><span class="koboSpan" id="kobo.568.1">Adding a routine</span></h2>
<p><span class="koboSpan" id="kobo.569.1">For adding a routine, we want the user to be able to select a routine from our database. </span><span class="koboSpan" id="kobo.569.2">We want to offer something </span><a id="_idIndexMarker291"/><span class="koboSpan" id="kobo.570.1">of a routine picker, so let’s build one! </span><span class="koboSpan" id="kobo.570.2">The component should read the exercises from the database and have a user select one to add properties of a set (weight </span><span class="No-Break"><span class="koboSpan" id="kobo.571.1">and repetitions).</span></span></p>
<p><span class="koboSpan" id="kobo.572.1">With a need for centralized data, we can create a store for all our fitness-related data and methods. </span><span class="koboSpan" id="kobo.572.2">Let’s create a </span><strong class="source-inline"><span class="koboSpan" id="kobo.573.1">fitness.ts</span></strong><span class="koboSpan" id="kobo.574.1"> file in the store, and we’ll start with retrieving exercises from the </span><span class="No-Break"><span class="koboSpan" id="kobo.575.1">database: </span></span><a href="https://github.com/PacktPublishing/Building-Real-world-Web-Applications-with-Vue.js-3/blob/main/06.fitness/.notes/6.9-fitness.ts"><span class="No-Break"><span class="koboSpan" id="kobo.576.1">https://github.com/PacktPublishing/Building-Real-world-Web-Applications-with-Vue.js-3/blob/main/06.fitness/.notes/6.9-fitness.ts</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.577.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.578.1">The store exposes the exercises and a method of retrieving them. </span><span class="koboSpan" id="kobo.578.2">Since we want to immediately populate the </span><strong class="source-inline"><span class="koboSpan" id="kobo.579.1">exercises</span></strong><span class="koboSpan" id="kobo.580.1"> list, we can call the </span><strong class="source-inline"><span class="koboSpan" id="kobo.581.1">getExercises</span></strong><span class="koboSpan" id="kobo.582.1"> method (</span><em class="italic"><span class="koboSpan" id="kobo.583.1">lines 13-28</span></em><span class="koboSpan" id="kobo.584.1">, </span><em class="italic"><span class="koboSpan" id="kobo.585.1">29</span></em><span class="koboSpan" id="kobo.586.1">) when initializing </span><span class="No-Break"><span class="koboSpan" id="kobo.587.1">the store!</span></span></p>
<p><span class="koboSpan" id="kobo.588.1">We’ll add more of this </span><a id="_idIndexMarker292"/><span class="koboSpan" id="kobo.589.1">store in the future, but for now, we can start using the data in a new component: an </span><strong class="bold"><span class="koboSpan" id="kobo.590.1">exercise picker</span></strong><span class="koboSpan" id="kobo.591.1">. </span><span class="koboSpan" id="kobo.591.2">In a new file in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.592.1">components</span></strong><span class="koboSpan" id="kobo.593.1"> folder called </span><strong class="source-inline"><span class="koboSpan" id="kobo.594.1">SelectExercise.vue</span></strong><span class="koboSpan" id="kobo.595.1">, we’ll import </span><a id="_idIndexMarker293"/><span class="koboSpan" id="kobo.596.1">the store and use it to populate a Vuetify </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.597.1">select</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.598.1"> component:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.599.1">
&lt;script setup lang="ts"&gt;import { storeToRefs } from "pinia";
import { useFitnessStore } from '@/store/fitness'
const fitnessStore = useFitnessStore()
const { exercises } = storeToRefs(fitnessStore)
&lt;/script&gt;
&lt;template&gt;
  &lt;v-select
    v-if="exercises"
    label="Select exercise"
    :items="exercises"
    item-title="name"
    item-value="id"
  &gt;&lt;/v-select&gt;
&lt;/template&gt;</span></pre>
<p><span class="koboSpan" id="kobo.600.1">Very straightforward! </span><span class="koboSpan" id="kobo.600.2">We access the store and map the values to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.601.1">v-select</span></strong><span class="koboSpan" id="kobo.602.1"> component. </span><span class="koboSpan" id="kobo.602.2">In addition to </span><strong class="source-inline"><span class="koboSpan" id="kobo.603.1">exercise</span></strong><span class="koboSpan" id="kobo.604.1">, we want the user to be able to add </span><strong class="source-inline"><span class="koboSpan" id="kobo.605.1">weight</span></strong><span class="koboSpan" id="kobo.606.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.607.1">repetitions</span></strong><span class="koboSpan" id="kobo.608.1"> as part of a routine. </span><span class="koboSpan" id="kobo.608.2">So, let’s wrap our created component in a parent called </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.609.1">AddRoutine.vue</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.610.1">: </span></span><a href="https://github.com/PacktPublishing/Building-Real-world-Web-Applications-with-Vue.js-3/blob/main/06.fitness/.notes/6.10-AddRoutine.vue"><span class="No-Break"><span class="koboSpan" id="kobo.611.1">https://github.com/PacktPublishing/Building-Real-world-Web-Applications-with-Vue.js-3/blob/main/06.fitness/.notes/6.10-AddRoutine.vue</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.612.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.613.1">Let’s break this down before we move to the template. </span><span class="koboSpan" id="kobo.613.2">We have the </span><strong class="source-inline"><span class="koboSpan" id="kobo.614.1">exercise</span></strong><span class="koboSpan" id="kobo.615.1"> (</span><em class="italic"><span class="koboSpan" id="kobo.616.1">line 10</span></em><span class="koboSpan" id="kobo.617.1">) and </span><strong class="source-inline"><span class="koboSpan" id="kobo.618.1">routine</span></strong><span class="koboSpan" id="kobo.619.1"> (</span><em class="italic"><span class="koboSpan" id="kobo.620.1">line 9</span></em><span class="koboSpan" id="kobo.621.1">) variables, where</span><a id="_idIndexMarker294"/><span class="koboSpan" id="kobo.622.1"> a routine consists of an exercise in combination with a set of weights </span><span class="No-Break"><span class="koboSpan" id="kobo.623.1">and repetitions.</span></span></p>
<p><span class="koboSpan" id="kobo.624.1">An example of  </span><strong class="source-inline"><span class="koboSpan" id="kobo.625.1">routines</span></strong><span class="koboSpan" id="kobo.626.1"> could be similar </span><span class="No-Break"><span class="koboSpan" id="kobo.627.1">to this:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.628.1">
{ "exercise": "7fa3219e-9127-4189-ae30-d340aaf0f9e6",  "routines": [
    { "weight": "10", "repetitions": "10" },
    { "weight": "10", "repetitions": "10" }
  ]
}</span></pre>
<p><span class="koboSpan" id="kobo.629.1">The flow starts with selecting an exercise, and the watcher (</span><em class="italic"><span class="koboSpan" id="kobo.630.1">lines 38-40</span></em><span class="koboSpan" id="kobo.631.1">) then prepares the routine to be filled with new values (clearing the </span><strong class="source-inline"><span class="koboSpan" id="kobo.632.1">routines</span></strong><span class="koboSpan" id="kobo.633.1"> array). </span><span class="koboSpan" id="kobo.633.2">The interface in the template is modeled to the weight and repetitions, as you will see in </span><span class="No-Break"><span class="koboSpan" id="kobo.634.1">a moment.</span></span></p>
<p><span class="koboSpan" id="kobo.635.1">As usual, several rows can be added to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.636.1">routines</span></strong><span class="koboSpan" id="kobo.637.1"> property using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.638.1">addRow</span></strong><span class="koboSpan" id="kobo.639.1"> function (</span><em class="italic"><span class="koboSpan" id="kobo.640.1">lines 16-21</span></em><span class="koboSpan" id="kobo.641.1">). </span><span class="koboSpan" id="kobo.641.2">If a user makes an error, a row can be removed from the property (</span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.642.1">lines 23-25</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.643.1">).</span></span></p>
<p><span class="koboSpan" id="kobo.644.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.645.1">add</span></strong><span class="koboSpan" id="kobo.646.1"> function (</span><em class="italic"><span class="koboSpan" id="kobo.647.1">lines 33-36</span></em><span class="koboSpan" id="kobo.648.1">) emits the </span><strong class="source-inline"><span class="koboSpan" id="kobo.649.1">routine</span></strong><span class="koboSpan" id="kobo.650.1"> object to the parent component and resets any values on </span><span class="No-Break"><span class="koboSpan" id="kobo.651.1">the form.</span></span></p>
<p><span class="koboSpan" id="kobo.652.1">In the template part, we start with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.653.1">select-exercise</span></strong><span class="koboSpan" id="kobo.654.1"> component (</span><em class="italic"><span class="koboSpan" id="kobo.655.1">line 48</span></em><span class="koboSpan" id="kobo.656.1">) to trigger the flow, and we use Vuetify expansion panels to show the forms for adding a set (</span><em class="italic"><span class="koboSpan" id="kobo.657.1">lines 52-86</span></em><span class="koboSpan" id="kobo.658.1">) as well as give a summary of sets that you’ve added (</span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.659.1">lines 87-131</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.660.1">).</span></span></p>
<p><span class="koboSpan" id="kobo.661.1">The second expansion panel also uses a Vuetify badge to indicate the number of unsaved changes (</span><em class="italic"><span class="koboSpan" id="kobo.662.1">lines 92-100</span></em><span class="koboSpan" id="kobo.663.1">). </span><span class="koboSpan" id="kobo.663.2">At the bottom, there’s a button (</span><em class="italic"><span class="koboSpan" id="kobo.664.1">lines 135-144</span></em><span class="koboSpan" id="kobo.665.1">) that calls the </span><strong class="source-inline"><span class="koboSpan" id="kobo.666.1">emit</span></strong><span class="koboSpan" id="kobo.667.1"> function to have the </span><strong class="source-inline"><span class="koboSpan" id="kobo.668.1">routine</span></strong><span class="koboSpan" id="kobo.669.1"> object sent to </span><span class="No-Break"><span class="koboSpan" id="kobo.670.1">the parent.</span></span></p>
<p><span class="koboSpan" id="kobo.671.1">We can now move back to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.672.1">TrackExercise.vue</span></strong><span class="koboSpan" id="kobo.673.1"> file to pick up on the emitted event and combine the selected date with the modeled routine to eventually store it in </span><span class="No-Break"><span class="koboSpan" id="kobo.674.1">the database.</span></span></p>
<p><span class="koboSpan" id="kobo.675.1">In the </span><strong class="source-inline"><span class="koboSpan" id="kobo.676.1">script</span></strong><span class="koboSpan" id="kobo.677.1"> block, we’ll add the following code to keep track of the routine and the </span><span class="No-Break"><span class="koboSpan" id="kobo.678.1">child component:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.679.1">
&lt;script setup lang="ts"&gt;// ...abbreviated
</span><strong class="bold"><span class="koboSpan" id="kobo.680.1">import type { Routine } from "@/types/fitness";</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.681.1">import AddRoutine from "./AddRoutine.vue";</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.682.1">const routines: Ref&lt;Routine[]&gt; = ref([]);</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.683.1">const showDialogRoutine: Ref&lt;boolean&gt; = ref(false);</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.684.1">const addRoutineToExercise = (newRoutine: any) =&gt; {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.685.1">  showDialogRoutine.value = false;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.686.1">  routines.value.push(newRoutine);</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.687.1">};</span></strong><span class="koboSpan" id="kobo.688.1">
&lt;/script&gt;</span></pre>
<p><span class="koboSpan" id="kobo.689.1">In our template, below the</span><a id="_idIndexMarker295"/><span class="koboSpan" id="kobo.690.1"> representation of the date picker, we can add a dialog for creating </span><span class="No-Break"><span class="koboSpan" id="kobo.691.1">a routine:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.692.1">
&lt;template&gt;  &lt;v-container&gt;
    &lt;v-row class="align-center justify-space-between mb-6"&gt;
      // …abbreviated
    &lt;/v-row&gt;
    </span><strong class="bold"><span class="koboSpan" id="kobo.693.1">{{ routines }}</span></strong><span class="koboSpan" id="kobo.694.1">
    &lt;v-row class="mb-6"&gt;
      &lt;v-btn
        block
        size="x-large"
        </span><strong class="bold"><span class="koboSpan" id="kobo.695.1">@click="showDialogRoutine = true"</span></strong><span class="koboSpan" id="kobo.696.1">
        </span><strong class="bold"><span class="koboSpan" id="kobo.697.1">v-if="selectedDate"</span></strong><span class="koboSpan" id="kobo.698.1">
      &gt;
        Add routine
      &lt;/v-btn&gt;
      &lt;v-dialog v-model="</span><strong class="bold"><span class="koboSpan" id="kobo.699.1">showDialogRoutine</span></strong><span class="koboSpan" id="kobo.700.1">" fullscreen&gt;
        &lt;v-card&gt;
          &lt;v-card-text&gt;
            </span><strong class="bold"><span class="koboSpan" id="kobo.701.1">&lt;add-routine @add="addRoutineToExercise" /&gt;</span></strong><span class="koboSpan" id="kobo.702.1">
          &lt;/v-card-text&gt;
          &lt;v-card-actions&gt;
            &lt;v-btn color="primary" @click="showDialogRoutine = false"
              &gt;Close&lt;/v-btn
            &gt;
          &lt;/v-card-actions&gt;
        &lt;/v-card&gt;
      &lt;/v-dialog&gt;
    &lt;/v-row&gt;
  &lt;/v-container&gt;
&lt;/template&gt;</span></pre>
<p><span class="koboSpan" id="kobo.703.1">After this code change, once a date has been selected, we show a button to start adding a routine. </span><span class="koboSpan" id="kobo.703.2">The routine selection </span><a id="_idIndexMarker296"/><span class="koboSpan" id="kobo.704.1">component opens in a dedicated dialog, and on the </span><strong class="source-inline"><span class="koboSpan" id="kobo.705.1">add</span></strong><span class="koboSpan" id="kobo.706.1"> event, it calls the </span><strong class="source-inline"><span class="koboSpan" id="kobo.707.1">addRoutineToExercise</span></strong><span class="koboSpan" id="kobo.708.1"> function, which adds a newline to the object in this component. </span><span class="koboSpan" id="kobo.708.2">You can try it out yourself since we’re showing </span><strong class="source-inline"><span class="koboSpan" id="kobo.709.1">{{ routines }}</span></strong><span class="koboSpan" id="kobo.710.1"> inline for the moment. </span><span class="koboSpan" id="kobo.710.2">It should look similar to </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.711.1">Figure 6</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.712.1">.8</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.713.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer057">
<span class="koboSpan" id="kobo.714.1"><img alt="Figure 6.8 – Our interface for compiling a workout" src="image/B19563_06_08.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.715.1">Figure 6.8 – Our interface for compiling a workout</span></p>
<p><span class="koboSpan" id="kobo.716.1">Our next step will be to format the display of the workout that we want to add to the database and, of course, store</span><a id="_idIndexMarker297"/><span class="koboSpan" id="kobo.717.1"> the wor</span><a id="_idTextAnchor189"/><span class="koboSpan" id="kobo.718.1">kout in the </span><span class="No-Break"><span class="koboSpan" id="kobo.719.1">database itself.</span></span></p>
<h2 id="_idParaDest-120"><a id="_idTextAnchor190"/><span class="koboSpan" id="kobo.720.1">Saving to the database</span></h2>
<p><span class="koboSpan" id="kobo.721.1">We’ve created a feature for our users to model a workout so that we can start saving the hard work. </span><span class="koboSpan" id="kobo.721.2">We’re going to </span><a id="_idIndexMarker298"/><span class="koboSpan" id="kobo.722.1">use our fitness store file for this, so let’s add some new methods and export them for </span><span class="No-Break"><span class="koboSpan" id="kobo.723.1">usage: </span></span><a href="https://github.com/PacktPublishing/Building-Real-world-Web-Applications-with-Vue.js-3/blob/main/06.fitness/.notes/6.11-fitness.ts"><span class="No-Break"><span class="koboSpan" id="kobo.724.1">https://github.com/PacktPublishing/Building-Real-world-Web-Applications-with-Vue.js-3/blob/main/06.fitness/.notes/6.11-fitness.ts</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.725.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.726.1">We need to have access to the user ID, so we’ll import the </span><strong class="source-inline"><span class="koboSpan" id="kobo.727.1">userStore</span></strong><span class="koboSpan" id="kobo.728.1"> function (</span><em class="italic"><span class="koboSpan" id="kobo.729.1">line 2</span></em><span class="koboSpan" id="kobo.730.1">), and we’ll import some of the data types that </span><span class="No-Break"><span class="koboSpan" id="kobo.731.1">we’ll use.</span></span></p>
<p><span class="koboSpan" id="kobo.732.1">We’ve added our main </span><strong class="source-inline"><span class="koboSpan" id="kobo.733.1">saveWorkout</span></strong><span class="koboSpan" id="kobo.734.1"> function (</span><em class="italic"><span class="koboSpan" id="kobo.735.1">lines 40-70</span></em><span class="koboSpan" id="kobo.736.1">), which executes two helpers: first, it saves the workout to the workout table using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.737.1">insertWorkout</span></strong><span class="koboSpan" id="kobo.738.1"> function (</span><em class="italic"><span class="koboSpan" id="kobo.739.1">lines 11-25</span></em><span class="koboSpan" id="kobo.740.1">). </span><span class="koboSpan" id="kobo.740.2">On retrieving the </span><strong class="source-inline"><span class="koboSpan" id="kobo.741.1">id</span></strong><span class="koboSpan" id="kobo.742.1"> property from the workout, we can start saving the sets. </span><span class="koboSpan" id="kobo.742.2">For that, we iterate over the routines to compile a list of sets, and we can save them all at once </span><a id="_idIndexMarker299"/><span class="koboSpan" id="kobo.743.1">with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.744.1">insertSets</span></strong><span class="koboSpan" id="kobo.745.1"> method (</span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.746.1">lines 27-38</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.747.1">).</span></span></p>
<p><span class="koboSpan" id="kobo.748.1">With those additions, let’s flip back to our </span><strong class="source-inline"><span class="koboSpan" id="kobo.749.1">TrackExercise.vue</span></strong><span class="koboSpan" id="kobo.750.1"> file to add a </span><strong class="bold"><span class="koboSpan" id="kobo.751.1">Save</span></strong><span class="koboSpan" id="kobo.752.1"> button to call the </span><strong class="source-inline"><span class="koboSpan" id="kobo.753.1">saveWorkout</span></strong><span class="koboSpan" id="kobo.754.1"> action. </span><span class="koboSpan" id="kobo.754.2">We’ll import both the fitness and </span><span class="No-Break"><span class="koboSpan" id="kobo.755.1">app store:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.756.1">
import { useFitnessStore } from "@/store/fitness";const fitnessStore = useFitnessStore();
import { useAppStore } from "@/store/app";
const appStore = useAppStore();</span></pre>
<p><span class="koboSpan" id="kobo.757.1">We’ll also add functions to validate if a workout can actually be saved – one to reset the form state and one that passes the information to our </span><span class="No-Break"><span class="koboSpan" id="kobo.758.1">store action:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.759.1">
const </span><strong class="bold"><span class="koboSpan" id="kobo.760.1">canSaveWorkout</span></strong><span class="koboSpan" id="kobo.761.1"> = computed(() =&gt; {  return routines.value.length &gt; 0;
});
const </span><strong class="bold"><span class="koboSpan" id="kobo.762.1">reset</span></strong><span class="koboSpan" id="kobo.763.1"> = () =&gt; {
  routines.value = [];
  selectedDate.value = undefined;
};
const </span><strong class="bold"><span class="koboSpan" id="kobo.764.1">saveWorkout</span></strong><span class="koboSpan" id="kobo.765.1"> = () =&gt; {
  if (selectedDate.value &amp;&amp; routines.value?.length &gt; 0) {
    </span><strong class="bold"><span class="koboSpan" id="kobo.766.1">fitnessStore.saveWorkout({</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.767.1">      date: selectedDate.value,</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.768.1">      routines: routines.value,</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.769.1">    });</span></strong><span class="koboSpan" id="kobo.770.1">
    appStore.showDialog({
      title: "Success",
      contents: "Workout saved successfully",
    });
    reset();
  } else {
    appStore.showDialog({
      title: "Error",
      contents: "Please select a date and add at least one routine",
    });
  }
};</span></pre>
<p><span class="koboSpan" id="kobo.771.1">Again, we’re using the app dialog to show our systems’ messages; nice and reusable. </span><span class="koboSpan" id="kobo.771.2">We’ll end our form with the</span><a id="_idIndexMarker300"/><span class="koboSpan" id="kobo.772.1"> conditional </span><strong class="bold"><span class="koboSpan" id="kobo.773.1">Save</span></strong><span class="koboSpan" id="kobo.774.1"> button at the bottom of </span><span class="No-Break"><span class="koboSpan" id="kobo.775.1">our template:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.776.1">
&lt;template&gt;// …abbreviated
</span><strong class="bold"><span class="koboSpan" id="kobo.777.1">    &lt;v-row class="mb-6"&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.778.1">      &lt;v-btn</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.779.1">        block</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.780.1">        size="x-large"</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.781.1">        :disabled="!canSaveWorkout"</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.782.1">        @click="saveWorkout"</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.783.1">        v-if="selectedDate"</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.784.1">        &gt;Save workout&lt;/v-btn</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.785.1">      &gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.786.1">    &lt;/v-row&gt;</span></strong><span class="koboSpan" id="kobo.787.1">
  &lt;/v-container&gt;
&lt;/template&gt;</span></pre>
<p><span class="koboSpan" id="kobo.788.1">You can try it out. </span><span class="koboSpan" id="kobo.788.2">The data should show up in the tables of your Supabase instance. </span><span class="koboSpan" id="kobo.788.3">In </span><a href="B19563_07.xhtml#_idTextAnchor204"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.789.1">Chapter 7</span></em></span></a><em class="italic"><span class="koboSpan" id="kobo.790.1">,</span></em><span class="Heading-1-Char" lang="en-US" xml:lang="en-US"> </span><span class="koboSpan" id="kobo.791.1">we’ll start to retrieve this data in various ways. </span><span class="koboSpan" id="kobo.791.2">As you can see, sometimes during development it makes </span><a id="_idIndexMarker301"/><span class="koboSpan" id="kobo.792.1">sense to go back and forth between various components that make up </span><span class="No-Break"><span class="koboSpan" id="kobo.793.1">the chain.</span></span></p>
<p><span class="koboSpan" id="kobo.794.1">I’m trying to demonstrate this process a bit since it’s close to the development in practice. </span><span class="koboSpan" id="kobo.794.2">It is rare to come up with the ideal solution</span><a id="_idTextAnchor191"/><span class="koboSpan" id="kobo.795.1"> (or specifications!) in </span><span class="No-Break"><span class="koboSpan" id="kobo.796.1">one go.</span></span></p>
<h1 id="_idParaDest-121"><a id="_idTextAnchor192"/><span class="koboSpan" id="kobo.797.1">Our hard work visualized</span></h1>
<p><span class="koboSpan" id="kobo.798.1">It is one thing to store the data. </span><span class="koboSpan" id="kobo.798.2">For the user, the data only has value if we can present it within a certain context. </span><span class="koboSpan" id="kobo.798.3">We’ve done a small exercise when displaying the compilation of a routine before saving. </span><span class="koboSpan" id="kobo.798.4">In this part, we’ll see a couple of different examples of displaying </span><span class="No-Break"><span class="koboSpan" id="kobo.799.1">the data.</span></span></p>
<p><span class="koboSpan" id="kobo.800.1">We’ll make sure to accommodate an empty state (so feel free to delete any items or try a new login), and after we’ve added some workouts, we’ll find ways to display </span><span class="No-Break"><span class="koboSpan" id="kobo.801.1">the data.</span></span></p>
<p><span class="koboSpan" id="kobo.802.1">Let’s start by replacing the home page. </span><span class="koboSpan" id="kobo.802.2">In this case, we already have a route and we have the </span><strong class="source-inline"><span class="koboSpan" id="kobo.803.1">Home.vue</span></strong><span class="koboSpan" id="kobo.804.1"> view, but we’ll remove the reference to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.805.1">HelloWorld.vue</span></strong><span class="koboSpan" id="kobo.806.1"> component and create an empty </span><strong class="source-inline"><span class="koboSpan" id="kobo.807.1">History.vue &lt;template&gt;</span></strong><span class="koboSpan" id="kobo.808.1"> component instead. </span><span class="koboSpan" id="kobo.808.2">And then, in </span><strong class="source-inline"><span class="koboSpan" id="kobo.809.1">Home.vue</span></strong><span class="koboSpan" id="kobo.810.1">, we’ll reference the </span><strong class="source-inline"><span class="koboSpan" id="kobo.811.1">History.vue</span><a id="_idTextAnchor193"/></strong><span class="koboSpan" id="kobo.812.1"> file instead </span><span class="No-Break"><span class="koboSpan" id="kobo.813.1">of </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.814.1">HelloWorld.vue</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.815.1">.</span></span></p>
<h2 id="_idParaDest-122"><a id="_idTextAnchor194"/><span class="koboSpan" id="kobo.816.1">A view-based dashboard</span></h2>
<p><span class="koboSpan" id="kobo.817.1">We can start with a quick component to show the latest statistics of the user. </span><span class="koboSpan" id="kobo.817.2">When executing the script on the database, it included</span><a id="_idIndexMarker302"/><span class="koboSpan" id="kobo.818.1"> a view, called </span><strong class="source-inline"><span class="koboSpan" id="kobo.819.1">workout_dashboard_view</span></strong><span class="koboSpan" id="kobo.820.1">. </span><span class="koboSpan" id="kobo.820.2">This is like an aggregate of read-only queries that we can in turn query as if it were a table on </span><span class="No-Break"><span class="koboSpan" id="kobo.821.1">its own.</span></span></p>
<p><span class="koboSpan" id="kobo.822.1">We’ll add methods for getting data to the fitness store, similar to what we did with the exercises, by adding and exposing the </span><strong class="source-inline"><span class="koboSpan" id="kobo.823.1">dashboard</span></strong><span class="koboSpan" id="kobo.824.1"> variable (</span><em class="italic"><span class="koboSpan" id="kobo.825.1">lines 15</span></em><span class="koboSpan" id="kobo.826.1">, </span><em class="italic"><span class="koboSpan" id="kobo.827.1">42</span></em><span class="koboSpan" id="kobo.828.1">), which in turn gets data from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.829.1">getDashboard</span></strong><span class="koboSpan" id="kobo.830.1"> method (</span><em class="italic"><span class="koboSpan" id="kobo.831.1">lines 17-40</span></em><span class="koboSpan" id="kobo.832.1">, </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.833.1">42</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.834.1">): </span></span><a href="https://github.com/PacktPublishing/Building-Real-world-Web-Applications-with-Vue.js-3/blob/main/06.fitness/.notes/6.12-fitness.ts"><span class="No-Break"><span class="koboSpan" id="kobo.835.1">https://github.com/PacktPublishing/Building-Real-world-Web-Applications-with-Vue.js-3/blob/main/06.fitness/.notes/6.12-fitness.ts</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.836.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.837.1">With that in place, we can create a component to access the dashboard from the store and show the contents. </span><span class="koboSpan" id="kobo.837.2">Let’s call it </span><strong class="source-inline"><span class="koboSpan" id="kobo.838.1">WorkoutStats.vue</span></strong><span class="koboSpan" id="kobo.839.1">, and we’ll add a reference to the fitness store and load </span><span class="No-Break"><span class="koboSpan" id="kobo.840.1">the dashboard:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.841.1">
&lt;script setup lang="ts"&gt;import { computed, onMounted } from "vue";
import { storeToRefs } from "pinia";
import { useFitnessStore } from "@/store/fitness";
const fitnessStore = useFitnessStore();
const { dashboard } = storeToRefs(fitnessStore);
const daysSinceLastWorkout = computed(() =&gt; {
  if (!dashboard.value) return 0;
  const lastWorkout = new Date(dashboard.value.last_workout_date);
  const today = new Date();
  const diffTime = Math.abs(today.getTime() - lastWorkout.getTime());
  const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
  return diffDays;
});
onMounted(() =&gt; {
  fitnessStore.getDashboard();
});
&lt;/script&gt;</span></pre>
<p><span class="koboSpan" id="kobo.842.1">We’re adding one function to calculate the difference between today and the last exercise date, but it’s a concise </span><a id="_idIndexMarker303"/><span class="koboSpan" id="kobo.843.1">setup. </span><span class="koboSpan" id="kobo.843.2">In the template, we can expect four values for the dashboard, each of which we’ll show on its </span><span class="No-Break"><span class="koboSpan" id="kobo.844.1">own card:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.845.1">
&lt;template&gt;  &lt;v-row&gt;
    &lt;v-col cols="12" sm="3" m="2" class="d-flex justify-space-between"&gt;
      &lt;v-card class="align-self-stretch flex-grow-1"&gt;
        &lt;v-card-title&gt;</span><strong class="bold"><span class="koboSpan" id="kobo.846.1">{{ daysSinceLastWorkout }}</span></strong><span class="koboSpan" id="kobo.847.1">&lt;/v-card-title&gt;
        &lt;v-card-text&gt;Days since last workout&lt;/v-card-text&gt;
      &lt;/v-card&gt;
    &lt;/v-col&gt;
    &lt;v-col cols="12" sm="3" m="2" class="d-flex justify-space-between"&gt;
      &lt;v-card class="align-self-stretch flex-grow-1"&gt;
        &lt;v-card-title&gt;</span><strong class="bold"><span class="koboSpan" id="kobo.848.1">{{ dashboard?.total_workouts || 0 }}</span></strong><span class="koboSpan" id="kobo.849.1">&lt;/v-card-title&gt;
        &lt;v-card-text&gt;Total workouts&lt;/v-card-text&gt;
      &lt;/v-card&gt;
    &lt;/v-col&gt;
    &lt;v-col cols="12" sm="3" m="2" class="d-flex justify-space-between"&gt;
      &lt;v-card class="align-self-stretch flex-grow-1"&gt;
        &lt;v-card-title&gt;</span><strong class="bold"><span class="koboSpan" id="kobo.850.1">{{ dashboard?.cumulative_weight || 0 }}</span></strong><span class="koboSpan" id="kobo.851.1">&lt;/v-card-title&gt;
        &lt;v-card-text&gt;Cumulative weight moved&lt;/v-card-text&gt;
      &lt;/v-card&gt;
    &lt;/v-col&gt;
    &lt;v-col cols="12" sm="3" m="2" class="d-flex justify-space-between"&gt;
      &lt;v-card class="align-self-stretch flex-grow-1"&gt;
        &lt;v-card-title&gt;</span><strong class="bold"><span class="koboSpan" id="kobo.852.1">{{</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.853.1">          dashboard?.most_weight_single_workout || 0</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.854.1">        }}</span></strong><span class="koboSpan" id="kobo.855.1">&lt;/v-card-title&gt;
        &lt;v-card-text&gt;Most weight in a single workout&lt;/v-card-text&gt;
      &lt;/v-card&gt;
    &lt;/v-col&gt;
  &lt;/v-row&gt;
&lt;/template&gt;</span></pre>
<p><span class="koboSpan" id="kobo.856.1">We’re using an expression</span><a id="_idIndexMarker304"/><span class="koboSpan" id="kobo.857.1"> to default to </span><strong class="source-inline"><span class="koboSpan" id="kobo.858.1">0</span></strong><span class="koboSpan" id="kobo.859.1"> values if we have no results from the dashboard. </span><span class="koboSpan" id="kobo.859.2">Once it gets filled with values, though, we populate the template with the values. </span><span class="koboSpan" id="kobo.859.3">There is some room for optimization since there’s some repetition involved in the template. </span><span class="koboSpan" id="kobo.859.4">This would be a good exercise to improve on </span><span class="No-Break"><span class="koboSpan" id="kobo.860.1">your own!</span></span></p>
<p><span class="koboSpan" id="kobo.861.1">Now, we have some means of motivating our users to start filling in more exercises! </span><span class="koboSpan" id="kobo.861.2">Let’s now see if we c</span><a id="_idTextAnchor195"/><span class="koboSpan" id="kobo.862.1">an </span><a id="_idIndexMarker305"/><span class="koboSpan" id="kobo.863.1">display individual </span><span class="No-Break"><span class="koboSpan" id="kobo.864.1">workouts too.</span></span></p>
<h2 id="_idParaDest-123"><a id="_idTextAnchor196"/><span class="koboSpan" id="kobo.865.1">History and overview</span></h2>
<p><span class="koboSpan" id="kobo.866.1">To retrieve our workouts, we’ll add a new</span><a id="_idIndexMarker306"/><span class="koboSpan" id="kobo.867.1"> method to our fitness store. </span><span class="koboSpan" id="kobo.867.2">We have another view lined up for this particular goal! </span><span class="koboSpan" id="kobo.867.3">Let’s take a look at the updated fitness store </span><span class="No-Break"><span class="koboSpan" id="kobo.868.1">file: </span></span><a href="https://github.com/PacktPublishing/Building-Real-world-Web-Applications-with-Vue.js-3/blob/main/06.fitness/.notes/6.13-fitness.ts"><span class="No-Break"><span class="koboSpan" id="kobo.869.1">https://github.com/PacktPublishing/Building-Real-world-Web-Applications-with-Vue.js-3/blob/main/06.fitness/.notes/6.13-fitness.ts</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.870.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.871.1">As you can see, with the workouts (</span><em class="italic"><span class="koboSpan" id="kobo.872.1">line 15</span></em><span class="koboSpan" id="kobo.873.1">) and the method of retrieving the workouts (</span><em class="italic"><span class="koboSpan" id="kobo.874.1">lines 20-46</span></em><span class="koboSpan" id="kobo.875.1">), we’ve exposed a new dataset to show in </span><span class="No-Break"><span class="koboSpan" id="kobo.876.1">the app.</span></span></p>
<p><span class="koboSpan" id="kobo.877.1">With these changes, we can add some additional content to our </span><strong class="source-inline"><span class="koboSpan" id="kobo.878.1">History.vue</span></strong><span class="koboSpan" id="kobo.879.1"> file. </span><span class="koboSpan" id="kobo.879.2">We’ll begin by importing the data from the store and simply outputting it in the </span><span class="No-Break"><span class="koboSpan" id="kobo.880.1">template: </span></span><a href="https://github.com/PacktPublishing/Building-Real-world-Web-Applications-with-Vue.js-3/blob/main/06.fitness/.notes/6.14-History.vue"><span class="No-Break"><span class="koboSpan" id="kobo.881.1">https://github.com/PacktPublishing/Building-Real-world-Web-Applications-with-Vue.js-3/blob/main/06.fitness/.notes/6.14-History.vue</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.882.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.883.1">This addition provides us with an overview of workout entries from the database view (</span><em class="italic"><span class="koboSpan" id="kobo.884.1">lines 6-7</span></em><span class="koboSpan" id="kobo.885.1">, </span><em class="italic"><span class="koboSpan" id="kobo.886.1">9</span></em><span class="koboSpan" id="kobo.887.1">, </span><em class="italic"><span class="koboSpan" id="kobo.888.1">28</span></em><span class="koboSpan" id="kobo.889.1">), which are presented in expansion panels from Vuetify (</span><em class="italic"><span class="koboSpan" id="kobo.890.1">lines 36-45</span></em><span class="koboSpan" id="kobo.891.1">). </span><span class="koboSpan" id="kobo.891.2">But as you can see, we need to massage the data a bit, since it’s now showing an individual line per combination of workout and exercise. </span><span class="koboSpan" id="kobo.891.3">We want to group the data by workout, so we’ll create a function to transform our data and add a bit more structure. </span><span class="koboSpan" id="kobo.891.4">Take a look at the next iteration of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.892.1">History.vue</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.893.1">file: </span></span><a href="https://github.com/PacktPublishing/Building-Real-world-Web-Applications-with-Vue.js-3/blob/main/06.fitness/.notes/6.15-History.vue"><span class="No-Break"><span class="koboSpan" id="kobo.894.1">https://github.com/PacktPublishing/Building-Real-world-Web-Applications-with-Vue.js-3/blob/main/06.fitness/.notes/6.15-History.vue</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.895.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.896.1">This will net us with unique IDs so that we can identify every workout, and we’ve remodeled the data so that every unique workout has a collection of corresponding exercises as a child (</span><em class="italic"><span class="koboSpan" id="kobo.897.1">lines 23-33</span></em><span class="koboSpan" id="kobo.898.1">). </span><span class="koboSpan" id="kobo.898.2">We’re doing something similar with exercises: grouping them based on the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.899.1">exercise_name</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.900.1"> property.</span></span></p>
<p><span class="koboSpan" id="kobo.901.1">In this case, we’re opting for this particular approach because we only have to query the database once. </span><span class="koboSpan" id="kobo.901.2">There are multiple ways of optimizing database queries, and we’re now choosing to take the data from the database as is and model it in our app to suit </span><span class="No-Break"><span class="koboSpan" id="kobo.902.1">our needs.</span></span></p>
<p><span class="koboSpan" id="kobo.903.1">We’ve also updated the panels to iterate over </span><strong class="source-inline"><span class="koboSpan" id="kobo.904.1">workoutIds</span></strong><span class="koboSpan" id="kobo.905.1"> and display the restructured (part of the) workout based on the </span><strong class="source-inline"><span class="koboSpan" id="kobo.906.1">id</span></strong><span class="koboSpan" id="kobo.907.1"> property (</span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.908.1">lines 53-63</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.909.1">).</span></span></p>
<p><span class="koboSpan" id="kobo.910.1">As a final step, we can create a small component to show the exercise. </span><span class="koboSpan" id="kobo.910.2">We’ll create a </span><strong class="source-inline"><span class="koboSpan" id="kobo.911.1">GroupedExerciseView.vue</span></strong><span class="koboSpan" id="kobo.912.1"> component and add the following </span><span class="No-Break"><span class="koboSpan" id="kobo.913.1">contents: </span></span><a href="https://github.com/PacktPublishing/Building-Real-world-Web-Applications-with-Vue.js-3/blob/main/06.fitness/.notes/6.16-GroupedExerciseView.vue"><span class="No-Break"><span class="koboSpan" id="kobo.914.1">https://github.com/PacktPublishing/Building-Real-world-Web-Applications-with-Vue.js-3/blob/main/06.fitness/.notes/6.16-GroupedExerciseView.vue</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.915.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.916.1">We can then import and use the Vue component in our panel by passing the exercise set as </span><span class="No-Break"><span class="koboSpan" id="kobo.917.1">a property:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.918.1">
&lt;script setup lang="ts"&gt;// ...abbreviated
import GroupedExerciseView from "./GroupedExerciseView.vue";
// ...abbreviated
&lt;/script&gt;</span></pre>
<p><span class="koboSpan" id="kobo.919.1">We can then pass</span><a id="_idIndexMarker307"/><span class="koboSpan" id="kobo.920.1"> it to </span><span class="No-Break"><span class="koboSpan" id="kobo.921.1">the template:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.922.1">
&lt;template&gt;  &lt;v-container&gt;
    &lt;workout-stats class="mb-4" /&gt;
    &lt;h1&gt;Past workouts&lt;/h1&gt;
    &lt;v-expansion-panels v-model="panel" multiple v-if="workouts"&gt;
      &lt;v-expansion-panel v-for="id in workoutIds" :key="id"&gt;
        &lt;v-expansion-panel-title
          &gt;{{
            formattedDate(new Date(workoutsGroupedById[id].workout_created_at))
          }}
        &lt;/v-expansion-panel-title&gt;
        &lt;v-expansion-panel-text&gt;
</span><strong class="bold"><span class="koboSpan" id="kobo.923.1">          &lt;grouped-exercise-view</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.924.1">            :exercise="set"</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.925.1">            v-for="(set, index) in setsByExerciseName(workoutsGroupedById[id].sets)"</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.926.1">            :key="index"</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.927.1">          /&gt;</span></strong><span class="koboSpan" id="kobo.928.1">
        &lt;/v-expansion-panel-text&gt;
      &lt;/v-expansion-panel&gt;
    &lt;/v-expansion-panels&gt;
  &lt;/v-container&gt;
&lt;/template&gt;</span></pre>
<p><span class="koboSpan" id="kobo.929.1">We can use this last</span><a id="_idIndexMarker308"/><span class="koboSpan" id="kobo.930.1"> component, slightly modified in our overview of adding a workout as well, to display what the user will be saving in a nicely </span><span class="No-Break"><span class="koboSpan" id="kobo.931.1">formatted manner.</span></span></p>
<p><span class="koboSpan" id="kobo.932.1">The data will be slightly different, so we’ll create a </span><strong class="source-inline"><span class="koboSpan" id="kobo.933.1">wrapper</span></strong><span class="koboSpan" id="kobo.934.1"> component to modify the data before sending it as an exercise to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.935.1">GroupedExerciseView.vue</span></strong><span class="koboSpan" id="kobo.936.1"> component. </span><span class="koboSpan" id="kobo.936.2">We’ll name the new file </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.937.1">ExerciseGrouping.vue</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.938.1">: </span></span><a href="https://github.com/PacktPublishing/Building-Real-world-Web-Applications-with-Vue.js-3/blob/main/06.fitness/.notes/6.17-ExerciseGrouping.vue"><span class="No-Break"><span class="koboSpan" id="kobo.939.1">https://github.com/PacktPublishing/Building-Real-world-Web-Applications-with-Vue.js-3/blob/main/06.fitness/.notes/6.17-ExerciseGrouping.vue</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.940.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.941.1">Here, we’re also using the component, but we make sure that data in a different format is modified to fit with the component. </span><span class="koboSpan" id="kobo.941.2">To make this visible, we’ll import the </span><strong class="source-inline"><span class="koboSpan" id="kobo.942.1">ExerciseGrouping.vue</span></strong><span class="koboSpan" id="kobo.943.1"> component in our </span><strong class="source-inline"><span class="koboSpan" id="kobo.944.1">TrackExercise.vue</span></strong><span class="koboSpan" id="kobo.945.1"> file and display </span><span class="No-Break"><span class="koboSpan" id="kobo.946.1">its values:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.947.1">
&lt;script setup lang="ts"&gt;// ...abbreviated
</span><strong class="bold"><span class="koboSpan" id="kobo.948.1">import ExerciseGrouping from "./ExerciseGrouping.vue";</span></strong><span class="koboSpan" id="kobo.949.1">
// ...abbreviated
&lt;/script&gt;
&lt;template&gt;
  &lt;v-container&gt;
    // ...abbreviated
</span><strong class="bold"><span class="koboSpan" id="kobo.950.1">    &lt;exercise-grouping</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.951.1">        :key="index"</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.952.1">        v-for="(row, index) in routines"</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.953.1">        :exercise-id="row.exercise || 'Unknown'"</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.954.1">        :routines="row?.routines"</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.955.1">        class="mb-6"</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.956.1">      /&gt;</span></strong><span class="koboSpan" id="kobo.957.1">
    // ...abbreviated
  &lt;/v-container&gt;
&lt;/template&gt;</span></pre>
<p><span class="koboSpan" id="kobo.958.1">This helps our users in tracking </span><a id="_idIndexMarker309"/><span class="koboSpan" id="kobo.959.1">their future exercises even better. </span><span class="koboSpan" id="kobo.959.2">These are relatively simple representations of data. </span><span class="koboSpan" id="kobo.959.3">Let’s see if we can add mor</span><a id="_idTextAnchor197"/><span class="koboSpan" id="kobo.960.1">e complex visualizations such </span><span class="No-Break"><span class="koboSpan" id="kobo.961.1">as graphs.</span></span></p>
<h2 id="_idParaDest-124"><a id="_idTextAnchor198"/><span class="koboSpan" id="kobo.962.1">Graphs</span></h2>
<p><span class="koboSpan" id="kobo.963.1">When working with larger sets of data, it is very common to need visualization at some point. </span><span class="koboSpan" id="kobo.963.2">We’ll implement different graphs by </span><a id="_idIndexMarker310"/><span class="koboSpan" id="kobo.964.1">adopting a third-party library (</span><strong class="source-inline"><span class="koboSpan" id="kobo.965.1">chart.js</span></strong><span class="koboSpan" id="kobo.966.1">) and have it render our tracked data! </span><span class="koboSpan" id="kobo.966.2">At this point, it would be helpful to have multiple workouts tracked over a certain timespan as well. </span><span class="koboSpan" id="kobo.966.3">This creates a more useful experience in visualizing </span><span class="No-Break"><span class="koboSpan" id="kobo.967.1">the data.</span></span></p>
<p><span class="koboSpan" id="kobo.968.1">With specific and complex challenges, it is often more efficient to reach for a third-party library than build a solution on</span><a id="_idIndexMarker311"/><span class="koboSpan" id="kobo.969.1"> your own. </span><span class="koboSpan" id="kobo.969.2">In this case, we’ll have a look at a library that connects </span><strong class="source-inline"><span class="koboSpan" id="kobo.970.1">c</span><a id="_idTextAnchor199"/><span class="koboSpan" id="kobo.971.1">hart.js</span></strong><span class="koboSpan" id="kobo.972.1"> to Vue.js and apply it to </span><span class="No-Break"><span class="koboSpan" id="kobo.973.1">our app.</span></span></p>
<h3><span class="koboSpan" id="kobo.974.1">Depending on vue-chartjs</span></h3>
<p><span class="koboSpan" id="kobo.975.1">We use a library for displaying </span><a id="_idIndexMarker312"/><span class="koboSpan" id="kobo.976.1">charts. </span><span class="koboSpan" id="kobo.976.2">In this case, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.977.1">vue-chartjs</span></strong><span class="koboSpan" id="kobo.978.1"> package helps us integrate the framework-agnostic </span><strong class="source-inline"><span class="koboSpan" id="kobo.979.1">chart.js</span></strong><span class="koboSpan" id="kobo.980.1"> with our Vue.js app. </span><span class="koboSpan" id="kobo.980.2">It is quite common to use a third-party wrapper to better embed an underlying library into </span><span class="No-Break"><span class="koboSpan" id="kobo.981.1">your framework.</span></span></p>
<p><span class="koboSpan" id="kobo.982.1">This usually helps in abstracting concepts and behavior that we know from our framework and translating it to and from the library, which acts unaware of its ecosystem. </span><span class="koboSpan" id="kobo.982.2">This way, we don’t have to deal with the integration layer and can focus on adding features that matter to our </span><span class="No-Break"><span class="koboSpan" id="kobo.983.1">end users.</span></span></p>
<p><span class="koboSpan" id="kobo.984.1">Let’s build some graphs! </span><span class="koboSpan" id="kobo.984.2">We’re going to install both </span><strong class="source-inline"><span class="koboSpan" id="kobo.985.1">vue-chartjs</span></strong><span class="koboSpan" id="kobo.986.1"> and the core </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.987.1">chart.js</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.988.1"> libraries:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.989.1">
npm i vue-chartjs chart.js</span></pre> <p><span class="koboSpan" id="kobo.990.1">We’ll create a new route called </span><strong class="source-inline"><span class="koboSpan" id="kobo.991.1">graph</span></strong><span class="koboSpan" id="kobo.992.1"> with a view that loads an empty component and an addition to </span><span class="No-Break"><span class="koboSpan" id="kobo.993.1">the menu.</span></span></p>
<p><span class="koboSpan" id="kobo.994.1">In the router file, we add the </span><span class="No-Break"><span class="koboSpan" id="kobo.995.1">following entry:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.996.1">
      {        path: 'graph',
        name: 'Graph',
        component: () =&gt; import(/* webpackChunkName: "graph" */ '</span><strong class="bold"><span class="koboSpan" id="kobo.997.1">@/views/Graph.vue</span></strong><span class="koboSpan" id="kobo.998.1">'),
        beforeEnter: loginGuard
      },</span></pre>
<p><span class="koboSpan" id="kobo.999.1">This indicated to us that we need to create a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1000.1">Graph.vue</span></strong><span class="koboSpan" id="kobo.1001.1"> file in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1002.1">views</span></strong><span class="koboSpan" id="kobo.1003.1"> folder, so let’s </span><span class="No-Break"><span class="koboSpan" id="kobo.1004.1">do that:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1005.1">
&lt;script lang="ts" setup&gt;import Graph from "</span><strong class="bold"><span class="koboSpan" id="kobo.1006.1">@/components/Graph.vue</span></strong><span class="koboSpan" id="kobo.1007.1">";
&lt;/script&gt;
&lt;template&gt;
  &lt;graph/&gt;
&lt;/template&gt;</span></pre>
<p><span class="koboSpan" id="kobo.1008.1">And we’ll create a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1009.1">Graph.vue</span></strong><span class="koboSpan" id="kobo.1010.1"> component to</span><a id="_idIndexMarker313"/><span class="koboSpan" id="kobo.1011.1"> start building different kinds of graphs on the route. </span><span class="koboSpan" id="kobo.1011.2">Let’s start with a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1012.1">panel</span></strong><span class="koboSpan" id="kobo.1013.1"> expansion </span><span class="No-Break"><span class="koboSpan" id="kobo.1014.1">template: </span></span><a href="https://github.com/PacktPublishing/Building-Real-world-Web-Applications-with-Vue.js-3/blob/main/06.fitness/.notes/6.18-Graph.vue"><span class="No-Break"><span class="koboSpan" id="kobo.1015.1">https://github.com/PacktPublishing/Building-Real-world-Web-Applications-with-Vue.js-3/blob/main/06.fitness/.notes/6.18-Graph.vue</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.1016.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.1017.1">As soon as we add the entry to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1018.1">menuItems</span></strong><span class="koboSpan" id="kobo.1019.1"> collection in our </span><strong class="source-inline"><span class="koboSpan" id="kobo.1020.1">AppMenu.ts</span></strong><span class="koboSpan" id="kobo.1021.1"> file, we can navigate to our final page for </span><span class="No-Break"><span class="koboSpan" id="kobo.1022.1">this project:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1023.1">
const menuItems = [  // ...abbreviated
</span><strong class="bold"><span class="koboSpan" id="kobo.1024.1">  {</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1025.1">    icon: "mdi-chart-line",</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1026.1">    title: "Graph",</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1027.1">    page: "/graph",</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1028.1">  },</span></strong><span class="koboSpan" id="kobo.1029.1">
];</span></pre>
<p><span class="koboSpan" id="kobo.1030.1">As you can see from the page, we’ll implement three types of charts, w</span><a id="_idTextAnchor200"/><span class="koboSpan" id="kobo.1031.1">ith various content of our </span><span class="No-Break"><span class="koboSpan" id="kobo.1032.1">tracked workouts.</span></span></p>
<h3><span class="koboSpan" id="kobo.1033.1">Piece of pie (chart)</span></h3>
<p><span class="koboSpan" id="kobo.1034.1">As we will see, generating a chart </span><a id="_idIndexMarker314"/><span class="koboSpan" id="kobo.1035.1">using a library is very straightforward! </span><span class="koboSpan" id="kobo.1035.2">We have to</span><a id="_idIndexMarker315"/><span class="koboSpan" id="kobo.1036.1"> bear in mind that a </span><strong class="source-inline"><span class="koboSpan" id="kobo.1037.1">chart</span></strong><span class="koboSpan" id="kobo.1038.1"> component expects data in a fixed format, as in </span><span class="No-Break"><span class="koboSpan" id="kobo.1039.1">this example:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1040.1">
chartData: {  labels: [ 'January', 'February', 'March' ],
  datasets: [ { data: [40, 20, 12] } ]
},</span></pre>
<p><span class="koboSpan" id="kobo.1041.1">This inevitably means that we need to do some data remodeling, so let’s do that first. </span><span class="koboSpan" id="kobo.1041.2">We actually need a bit more</span><a id="_idIndexMarker316"/><span class="koboSpan" id="kobo.1042.1"> of a detailed response from our data, so we’ll add the following functions</span><a id="_idIndexMarker317"/><span class="koboSpan" id="kobo.1043.1"> to our </span><span class="No-Break"><span class="koboSpan" id="kobo.1044.1">fitness store:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1045.1">
    const </span><strong class="bold"><span class="koboSpan" id="kobo.1046.1">workoutsWithSets</span></strong><span class="koboSpan" id="kobo.1047.1">: Ref&lt;WorkoutFromDatasource | []&gt; = ref([]);    const </span><strong class="bold"><span class="koboSpan" id="kobo.1048.1">getWorkoutsWithSets</span></strong><span class="koboSpan" id="kobo.1049.1"> = async (options: GetWorkoutsOptions = { order: 'ascending' }): Promise&lt;void&gt; =&gt; {
        try {
            // ...abbreviated
            const { data, error, status }: any = await useSupabaseClient
                .from('workouts')
                .select(
                  id, created_at,
</span><strong class="bold"><span class="koboSpan" id="kobo.1050.1">                  sets (</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1051.1">                    workout_id, weight, repetitions,</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1052.1">                    exercises ( name, color )</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1053.1">                  )</span></strong><span class="koboSpan" id="kobo.1054.1">
                )
    // ...abbreviated
return { exercises, getExercises, saveWorkout, workouts, getWorkouts, dashboard, getDashboard, </span><strong class="bold"><span class="koboSpan" id="kobo.1055.1">workoutsWithSets</span></strong><span class="koboSpan" id="kobo.1056.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.1057.1">getWorkoutsWithSets</span></strong><span class="koboSpan" id="kobo.1058.1"> }</span></pre>
<p><span class="koboSpan" id="kobo.1059.1">The key difference is in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1060.1">select</span></strong><span class="koboSpan" id="kobo.1061.1"> query, where we also request sets with their properties. </span><span class="koboSpan" id="kobo.1061.2">Of course, we also need to return these new methods from the store. </span><span class="koboSpan" id="kobo.1061.3">The data from the database, however, is not </span><a id="_idIndexMarker318"/><span class="koboSpan" id="kobo.1062.1">ready to be used in the graph, since it expects a different format. </span><span class="koboSpan" id="kobo.1062.2">Again, this happens regularly in real-life scenarios, so let’s build </span><a id="_idIndexMarker319"/><span class="No-Break"><span class="koboSpan" id="kobo.1063.1">a solution.</span></span></p>
<p><span class="koboSpan" id="kobo.1064.1">We create a new store called </span><strong class="source-inline"><span class="koboSpan" id="kobo.1065.1">graph.ts</span></strong><span class="koboSpan" id="kobo.1066.1">, and we’ll start with a function that returns data for our pie </span><span class="No-Break"><span class="koboSpan" id="kobo.1067.1">chart: </span></span><a href="https://github.com/PacktPublishing/Building-Real-world-Web-Applications-with-Vue.js-3/blob/main/06.fitness/.notes/6.19-graph.ts"><span class="No-Break"><span class="koboSpan" id="kobo.1068.1">https://github.com/PacktPublishing/Building-Real-world-Web-Applications-with-Vue.js-3/blob/main/06.fitness/.notes/6.19-graph.ts</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.1069.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.1070.1">Here, we’re getting the workout data and returning it as an object that’s compatible with a </span><span class="No-Break"><span class="koboSpan" id="kobo.1071.1">pie chart.</span></span></p>
<p><span class="koboSpan" id="kobo.1072.1">Now, we’ll create a component called </span><strong class="source-inline"><span class="koboSpan" id="kobo.1073.1">GraphPie.vue</span></strong><span class="koboSpan" id="kobo.1074.1"> in our </span><strong class="source-inline"><span class="koboSpan" id="kobo.1075.1">components</span></strong><span class="koboSpan" id="kobo.1076.1"> folder where we use the store, with some configuration for the graph type, to render a pie chart based on workout </span><span class="No-Break"><span class="koboSpan" id="kobo.1077.1">data: </span></span><a href="https://github.com/PacktPublishing/Building-Real-world-Web-Applications-with-Vue.js-3/blob/main/06.fitness/.notes/6.20-GraphPie.vue"><span class="No-Break"><span class="koboSpan" id="kobo.1078.1">https://github.com/PacktPublishing/Building-Real-world-Web-Applications-with-Vue.js-3/blob/main/06.fitness/.notes/6.20-GraphPie.vue</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.1079.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.1080.1">With our </span><strong class="source-inline"><span class="koboSpan" id="kobo.1081.1">PieChart</span></strong><span class="koboSpan" id="kobo.1082.1"> component completed, we’ll import it into the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1083.1">Graph.vue</span></strong><span class="koboSpan" id="kobo.1084.1"> component, and then we can replace the line in </span><span class="No-Break"><span class="koboSpan" id="kobo.1085.1">the collapsible:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1086.1">
&lt;script setup lang="ts"&gt;import { ref } from "vue";
import type { Ref } from "vue";
</span><strong class="bold"><span class="koboSpan" id="kobo.1087.1">import GraphPie from '@/components/GraphPie.vue'</span></strong><span class="koboSpan" id="kobo.1088.1">
const panel: Ref&lt;Number[]&gt; = ref([0]);
&lt;/script&gt;
&lt;template&gt;
  &lt;v-container&gt;
    &lt;h1&gt;Graphs&lt;/h1&gt;
    &lt;v-expansion-panels v-model="panel" accordion&gt;
      &lt;v-expansion-panel&gt;
        &lt;v-expansion-panel-title
          &gt;Workout distribution all time (sets &amp; reps)&lt;/v-expansion-panel-title
        &gt;
        &lt;v-expansion-panel-text&gt;
          </span><strong class="bold"><span class="koboSpan" id="kobo.1089.1">&lt;graph-pie /&gt;</span></strong><span class="koboSpan" id="kobo.1090.1">
        &lt;/v-expansion-panel-text&gt;
      &lt;/v-expansion-panel&gt;
      // ...abbreviated
    &lt;/v-expansion-panels&gt;
  &lt;/v-container&gt;
&lt;/template&gt;</span></pre>
<p><span class="koboSpan" id="kobo.1091.1">Depending on the</span><a id="_idIndexMarker320"/><span class="koboSpan" id="kobo.1092.1"> availability and content of the data, you will end up with </span><a id="_idIndexMarker321"/><span class="koboSpan" id="kobo.1093.1">a user interface that </span><span class="No-Break"><span class="koboSpan" id="kobo.1094.1">resembles this:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer058">
<span class="koboSpan" id="kobo.1095.1"><img alt="Figure 6.9 – Example workout data represented in a pie chart" src="image/B19563_06_09.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1096.1">Figure 6.9 – Example workout data represented in a pie chart</span></p>
<p><span class="koboSpan" id="kobo.1097.1">Using </span><strong class="source-inline"><span class="koboSpan" id="kobo.1098.1">vue-chartjs</span></strong><span class="koboSpan" id="kobo.1099.1">, it’s been relatively easy for us to visualize datasets. </span><span class="koboSpan" id="kobo.1099.2">We have worked on making sure that </span><a id="_idIndexMarker322"/><span class="koboSpan" id="kobo.1100.1">our data is formatted in the way the library expects. </span><span class="koboSpan" id="kobo.1100.2">With </span><a id="_idIndexMarker323"/><span class="koboSpan" id="kobo.1101.1">that in mind, we can proce</span><a id="_idTextAnchor201"/><span class="koboSpan" id="kobo.1102.1">ed in expanding to different types </span><span class="No-Break"><span class="koboSpan" id="kobo.1103.1">of visualizations.</span></span></p>
<h3><span class="koboSpan" id="kobo.1104.1">More charts!</span></h3>
<p><span class="koboSpan" id="kobo.1105.1">Looking at our collapsible examples, we’re going to build two more charts, just to get a feel of multiple implementations. </span><span class="koboSpan" id="kobo.1105.2">We’ll update our graph store with more features. </span><span class="koboSpan" id="kobo.1105.3">We’ll create an internal method that we can reuse in both our graphs and then create a public method on the store to retrieve </span><span class="No-Break"><span class="koboSpan" id="kobo.1106.1">data: </span></span><a href="https://github.com/PacktPublishing/Building-Real-world-Web-Applications-with-Vue.js-3/blob/main/06.fitness/.notes/6.21-graph.ts"><span class="No-Break"><span class="koboSpan" id="kobo.1107.1">https://github.com/PacktPublishing/Building-Real-world-Web-Applications-with-Vue.js-3/blob/main/06.fitness/.notes/6.21-graph.ts</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.1108.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.1109.1">We’re creating a helper function (</span><strong class="source-inline"><span class="koboSpan" id="kobo.1110.1">createGraphData</span></strong><span class="koboSpan" id="kobo.1111.1">, </span><em class="italic"><span class="koboSpan" id="kobo.1112.1">lines 11-46</span></em><span class="koboSpan" id="kobo.1113.1">) to gather and format the data based on a monthly average. </span><span class="koboSpan" id="kobo.1113.2">For our two distinct types of graphs, we’ll create one function called </span><strong class="source-inline"><span class="koboSpan" id="kobo.1114.1">getGraphMonthlyAverage</span></strong><span class="koboSpan" id="kobo.1115.1"> (</span><em class="italic"><span class="koboSpan" id="kobo.1116.1">lines 48-58</span></em><span class="koboSpan" id="kobo.1117.1">). </span><span class="koboSpan" id="kobo.1117.2">Since the library expects data in a predefined format, we can use the same data presented in </span><span class="No-Break"><span class="koboSpan" id="kobo.1118.1">different ways.</span></span></p>
<p><span class="koboSpan" id="kobo.1119.1">To showcase this, we’ll create a bar graph as well as a line graph from the same data. </span><span class="koboSpan" id="kobo.1119.2">First, the bar graph; the code is very similar to the pie graph, with our abstractions in place. </span><span class="koboSpan" id="kobo.1119.3">We’ll call this component </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1120.1">GraphBar.vue</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1121.1">: </span></span><a href="https://github.com/PacktPublishing/Building-Real-world-Web-Applications-with-Vue.js-3/blob/main/06.fitness/.notes/6.22-GraphBar.vue"><span class="No-Break"><span class="koboSpan" id="kobo.1122.1">https://github.com/PacktPublishing/Building-Real-world-Web-Applications-with-Vue.js-3/blob/main/06.fitness/.notes/6.22-GraphBar.vue</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.1123.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.1124.1">This is how the bar graph would render to </span><span class="No-Break"><span class="koboSpan" id="kobo.1125.1">the browser:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer059">
<span class="koboSpan" id="kobo.1126.1"><img alt="Figure 6.10 – Example workout data represented in a bar chart" src="image/B19563_06_10.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1127.1">Figure 6.10 – Example workout data represented in a bar chart</span></p>
<p><span class="koboSpan" id="kobo.1128.1">Not so different from our previous graph </span><a id="_idIndexMarker324"/><span class="koboSpan" id="kobo.1129.1">component! </span><span class="koboSpan" id="kobo.1129.2">We’ll do the same for a line graph, called </span><strong class="source-inline"><span class="koboSpan" id="kobo.1130.1">GraphLine.vue</span></strong><span class="koboSpan" id="kobo.1131.1">, as you might have </span><span class="No-Break"><span class="koboSpan" id="kobo.1132.1">guessed: </span></span><a href="https://github.com/PacktPublishing/Building-Real-world-Web-Applications-with-Vue.js-3/blob/main/06.fitness/.notes/6.23-GraphLine.vue"><span class="No-Break"><span class="koboSpan" id="kobo.1133.1">https://github.com/PacktPublishing/Building-Real-world-Web-Applications-with-Vue.js-3/blob/main/06.fitness/.notes/6.23-GraphLine.vue</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.1134.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.1135.1">This is how the line graph would render to </span><span class="No-Break"><span class="koboSpan" id="kobo.1136.1">the browser:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer060">
<span class="koboSpan" id="kobo.1137.1"><img alt="Figure 6.11 – Example workout data represented in a line chart" src="image/B19563_06_11.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.1138.1">Figure 6.11 – Example workout data represented in a line chart</span></p>
<p><span class="koboSpan" id="kobo.1139.1">We could even abstract repetitive code</span><a id="_idIndexMarker325"/><span class="koboSpan" id="kobo.1140.1"> in a Vue component that is capable of rendering the data as different types of graphs. </span><span class="koboSpan" id="kobo.1140.2">That would be a nice exercise for you to pursue as an extra assignment. </span><span class="koboSpan" id="kobo.1140.3">Try swapping out the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1141.1">getGraphPie</span></strong><span class="koboSpan" id="kobo.1142.1"> data with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.1143.1">getGraphMonthlyAverage</span></strong><span class="koboSpan" id="kobo.1144.1"> data, and you’ll see that the graph just accepts these new values since they follow the </span><span class="No-Break"><span class="koboSpan" id="kobo.1145.1">right shape.</span></span></p>
<p><span class="koboSpan" id="kobo.1146.1">To complete this chapter, we’ll add the components to our user interface, in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.1147.1">Graph.vue</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.1148.1"> file:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.1149.1">
&lt;script setup lang="ts"&gt;import { ref } from "vue";
import type { Ref } from "vue";
import GraphPie from '@/components/GraphPie.vue'
</span><strong class="bold"><span class="koboSpan" id="kobo.1150.1">import GraphLine from '@/components/GraphLine.vue'</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.1151.1">import GraphBar from '@/components/GraphBar.vue'</span></strong><span class="koboSpan" id="kobo.1152.1">
const panel: Ref&lt;Number[]&gt; = ref([0]);
&lt;/script&gt;
&lt;template&gt;
  &lt;v-container&gt;
    &lt;h1&gt;Graphs&lt;/h1&gt;
    &lt;v-expansion-panels v-model="panel" accordion&gt;
      &lt;!-- abbreviated --&gt;
      &lt;v-expansion-panel&gt;
        &lt;v-expansion-panel-title
          &gt;Monthly cumulative weight per exercise&lt;/v-expansion-panel-title
        &gt;
        &lt;v-expansion-panel-text&gt;
          </span><strong class="bold"><span class="koboSpan" id="kobo.1153.1">&lt;graph-bar /&gt;</span></strong><span class="koboSpan" id="kobo.1154.1">
        &lt;/v-expansion-panel-text&gt;
      &lt;/v-expansion-panel&gt;
      &lt;v-expansion-panel&gt;
        &lt;v-expansion-panel-title
          &gt;Cumulative effort per exercise over time&lt;/v-expansion-panel-title
        &gt;
        &lt;v-expansion-panel-text&gt;
          </span><strong class="bold"><span class="koboSpan" id="kobo.1155.1">&lt;graph-line /&gt;</span></strong><span class="koboSpan" id="kobo.1156.1">
        &lt;/v-expansion-panel-text&gt;
      &lt;/v-expansion-panel&gt;
    &lt;/v-expansion-panels&gt;
  &lt;/v-container&gt;
&lt;/template&gt;</span></pre>
<p><span class="koboSpan" id="kobo.1157.1">With that, we’ve built an app </span><a id="_idIndexMarker326"/><span class="koboSpan" id="kobo.1158.1">where users can l</span><a id="_idTextAnchor202"/><span class="koboSpan" id="kobo.1159.1">og in and track and retrieve their </span><span class="No-Break"><span class="koboSpan" id="kobo.1160.1">individual results.</span></span></p>
<h1 id="_idParaDest-125"><a id="_idTextAnchor203"/><span class="koboSpan" id="kobo.1161.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.1162.1">We’ve seen how we can use the concepts of stores, composables, and nested components to build a relatively complex user flow. </span><span class="koboSpan" id="kobo.1162.2">For security, we depend on the authorization model by Supabase, which helps us achieve our results in an </span><span class="No-Break"><span class="koboSpan" id="kobo.1163.1">efficient way.</span></span></p>
<p><span class="koboSpan" id="kobo.1164.1">Taking a look at the Supabase structure and data is helpful in understanding the way certain endpoints store and offer their data. </span><span class="koboSpan" id="kobo.1164.2">Up until this point, we’ve just been consuming data. </span><span class="koboSpan" id="kobo.1164.3">Under the hood, every Supabase instance is a dedicated PostgreSQL database. </span><span class="koboSpan" id="kobo.1164.4">If you want to know more about PostgreSQL, I highly recommend checking out </span><em class="italic"><span class="koboSpan" id="kobo.1165.1">Developing Modern Database Applications with PostgreSQL</span></em><span class="koboSpan" id="kobo.1166.1"> by Dr. </span><span class="koboSpan" id="kobo.1166.2">Quan Ha Le and Marcelo Diaz, </span><span class="No-Break"><span class="koboSpan" id="kobo.1167.1">at </span></span><a href="https://www.packtpub.com/product/developing-modern-database-applications-with-postgresql/9781838648145"><span class="No-Break"><span class="koboSpan" id="kobo.1168.1">https://www.packtpub.com/product/developing-modern-database-applications-with-postgresql/9781838648145</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.1169.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.1170.1">With more complex tasks, it makes sense to take a step-by-step approach to building the feature, which is something I’ve also demonstrated. </span><span class="koboSpan" id="kobo.1170.2">This sometimes means revisiting certain files to make small additions while we learn more about features along the way. </span><span class="koboSpan" id="kobo.1170.3">Even when requirements are very clear upfront, it can be really helpful to break features up into smaller parts and follow their path in the app file structure </span><span class="No-Break"><span class="koboSpan" id="kobo.1171.1">while building.</span></span></p>
<p><span class="koboSpan" id="kobo.1172.1">We’ve applied a certain level of abstraction but also took a pragmatic approach in parts. </span><span class="koboSpan" id="kobo.1172.2">It can be difficult to find this balance, but I do tend to favor some repetition to prevent over-engineering: this often results in more readable code that is easier to make small </span><span class="No-Break"><span class="koboSpan" id="kobo.1173.1">changes to.</span></span></p>
<p><span class="koboSpan" id="kobo.1174.1">I do favor separating a component into parts with a specific role. </span><span class="koboSpan" id="kobo.1174.2">The store composition is a good example of this, just as with our Supabase client file. </span><span class="koboSpan" id="kobo.1174.3">With the </span><strong class="bold"><span class="koboSpan" id="kobo.1175.1">separation of concerns</span></strong><span class="koboSpan" id="kobo.1176.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.1177.1">SoC</span></strong><span class="koboSpan" id="kobo.1178.1">), we can limit the complexity of each individual part to make it more scalable and manageable in </span><span class="No-Break"><span class="koboSpan" id="kobo.1179.1">the future.</span></span></p>
<p><span class="koboSpan" id="kobo.1180.1">We’ve built apps specifically for the web. </span><span class="koboSpan" id="kobo.1180.2">In the next chapter, we’ll see how we can create projects to target </span><span class="No-Break"><span class="koboSpan" id="kobo.1181.1">different environments.</span></span></p>
</div>
</body></html>