# 前言

*React* 最近一直是我主要的开发工具。在我的经验中，无论是作为开发者还是计算机用户，我发现最终我喜欢的都是一些轻量级的东西。虽然大公司来来去去很常见，但总有某些东西被保留下来。例如，过去二十年中，构建网站的方式已经重塑和改进，但构建网站的一般过程并没有太大变化。你仍然需要创建一个 *HTML* 文件，设计布局，并在服务器上的某个地方托管它。

当谈到 **用户界面** (**UI**) 时，还有一个可以以类似方式帮助你的话题。那就是状态。从 *jQuery* 和 *Angular* 到 *React*，从网页到其他非桌面平台（如 *Electron* 或 *React Native*），无论你走到哪里，都有一个技术问题需要你现在回答——屏幕如何知道需要应用变化？当我还在大学的时候，我从未问过这类问题。我通常认为计算机就是这样工作的。

当然，现在我知道计算机是这样工作的，因为有人创造了它。UI 最吸引人的地方是当状态出现。在早期，我们根本不谈论状态。但现在状态无处不在，尽管还没有教科书定义它或我们应该如何学习它。但可以肯定的是，状态在网页开发行业中仍然是一个相对较新的话题。

在这本书中，我将尝试使用 *React* 作为底层技术，探索和学习状态是如何引入和实现的。我希望通过这样做，我们最终能对“渲染引擎是如何由状态驱动的？”这个问题有一个更清晰的了解。

# 这本书面向的对象

这本书的理想读者是一个已经编写了几年 *JavaScript* 的工程师，但不一定有 *React* 和/或函数组件的经验。对于经验较少的 *JavaScript* 读者，我们通过 *CodePen* 提供了一个实时沙盒，这样你可以立即尝试每个主题。

如果你已经有 *React* 的经验，或者甚至有 Hooks 的经验，那也很好；这本书将向你展示 Hooks 在函数组件中的实现方式。此外，每个章节还包含与每个 Hook 相关的简化版 *React* 源代码，如果你是一个有经验的 *React* 程序员，这将帮助你更深入地理解。

# 这本书涵盖的内容

*第一章*，*介绍函数组件*，通过解释其属性和基本的父子关系来解释什么是函数组件。然后你将获得一些关于如何编写函数组件的技巧。在章节的结尾，你将看到一个实际的函数组件示例，`Nav`。

*第二章*，*在函数组件中构建状态*，展示了如何构建一个称为状态的特殊变量。我们将看到状态可以提供哪些好处，包括请求新的更新和监听值的变化。我们还将看到一个将状态应用于**单页应用**（**SPA**）的例子。我们还将仔细研究状态在*UI*中扮演的角色。

*第三章*，*深入 React*，探讨了我们在创建良好的状态解决方案时面临的挑战，然后我们将看到 React 架构师如何通过底层的 Hook 提供解决方案。然后我们将介绍 Hooks，了解它们的调用顺序，并学习如何在实际应用中避免遇到条件 Hook 问题。

*第四章*，*使用 State 启动组件*，涵盖了内置 Hooks，从`useState` Hook 开始。我们首先解释状态在 React 中的使用，然后了解`useState`背后的数据结构和源代码，并描述常见的状态分发用法。我们将对`useState`进行测试，并提供将`useState`应用于`Avatar`和`Tooltip`组件的两个实用示例。

*第五章*，*使用 Effect 处理副作用*，介绍了副作用，了解了`useEffect`背后的数据结构和源代码，并提供了各种触发效果的场景。我们还将演示使用`useEffect`的一些陷阱以及避免它们的方法。然后我们将使用`useEffect`在两个实用示例中，窗口大小和 Fetch API 中。

*第六章*，*使用 Memo 提升性能*，解释了在典型的 Web 应用中我们如何遇到性能下降问题。然后我们将了解`useMemo`背后的设计和源代码，并描述各种条件重用值的方法。然后我们将优化技术应用于两个常见情况，点击搜索和搜索防抖。

*第七章*，*使用 Context 覆盖区域*，介绍了区域更新以及 React contexts 如何用于将值共享到区域。然后，我们将了解`useContext`背后的数据结构和源代码以消费共享值。在章节末尾，我们将提供两个将上下文应用于主题和表格的实用示例。

*第八章*，*使用 Ref 隐藏内容*，解释了如何通过 ref 访问*DOM*元素，我们将了解`useRef` Hook 背后的设计和源代码。我们还将描述如何在不触发更新的情况下处理持久值。最后，我们将把 refs 应用于一些实际问题，例如点击菜单外，避免内存泄漏，设置中继站，和定位当前值。

*第九章*，*使用自定义钩子重用逻辑*，汇集了我们迄今为止所学的所有钩子，并解释了如何创建一个自定义钩子来满足我们的需求。我们将逐步介绍自定义钩子，并编写几个自定义钩子，包括`useToggle`、`useWindow`、`useAsync`、`useDebounced`、`useClickOutside`、`useCurrent`和`useProxy`。

*第十章*，*使用 React 构建网站*，一般性地讨论了 *React*，特别是 *React* 在网页开发中的作用。我们将从三个角度来探讨这个话题，看看 *React* 如何将资源组合起来构建一个网站，包括 *JavaScript ES6* 特性、*CSS-in-JS* 方法以及将类似 *HTML* 的行转换为 *JavaScript* 表达式的转换。

# 为了充分利用这本书，

本书的一个目标是通过使用 *React* 和 Hooks，让你获得实际操作经验。以下是一些你可以在开始之前采取的选项，以充分利用内容。

## 温习 React 知识

如果你最近没有使用过 *React* 或者不熟悉其前沿特性，我建议你跳转到 *第十章*，*使用 React 构建网站*，以了解 *React* 依赖的三个构建块来构建网站：JavaScript、CSS 和 HTML 的概览。

在阅读书籍时，如果你遇到不熟悉的语法，或者只是想更深入地了解每个构建块在 *React* 中的使用方法，请随时查看这一章节。

## 使用无需构建代码的浏览器

如果你没有本地环境来编写代码，或者你只是不想构建代码，你可以从在线服务器[`codepen.io/windmaomao/pen/ExvYPEX`](https://codepen.io/windmaomao/pen/ExvYPEX)访问示例。你很快就会在屏幕上看到打印出的 `Hello World`。每个章节都附带了一些操场链接，你可以点击它们来跟随。它们在书中的显示如下：

操场 – Hello World

你可以随意在这个在线示例[`codepen.io/windmaomao/pen/ExvYPEX`](https://codepen.io/windmaomao/pen/ExvYPEX)上尝试。

## 自己编写代码

如果你是一个喜欢动手实践的人，并且想在每一章中逐步跟随代码，你需要在你的一些项目中安装 *React*。从头开始设置 *React* 项目的说明如下。

### npm

访问 Node.js 网站，[`nodejs.org`](https://nodejs.org)，获取 `Node.js` 和 `npm` 的最新版本。选择适合你操作系统的正确版本并安装它。为了检查是否已正确安装，打开终端，并运行以下命令：

```js
node -v
```

如果你看到前一个命令返回的版本号，说明 Node.js 已安装。

### 创建 React 应用

你可以通过以下命令快速启动你的 *React* 项目：

```js
npx create-react-app my-app
```

将`my-app`替换为你希望的应用程序名称。一旦项目准备就绪，你可以进入`my-app`文件夹并启动它：

```js
cd my-app
yarn start
```

就这样，你应该能在你的本地计算机上看到一个应用程序。现在你可以通过将我们的代码粘贴到你的项目中并本地编译来尝试源代码。

# 下载彩色图像

我们还提供了一个包含本书中使用的截图和图表的彩色图像的 PDF 文件。您可以在此处下载：[`static.packt-cdn.com/downloads/9781803235950_ColorImages.pdf`](https://static.packt-cdn.com/downloads/9781803235950_ColorImages.pdf)。

# 使用的约定

本书使用了多种文本约定。

`文本中的代码`: 表示文本中的代码单词、数据库表名、文件夹名、文件名、文件扩展名、路径名、虚拟 URL、用户输入和 Twitter 昵称。以下是一个示例：“元素可以像`h1`、一个`div`元素那样简单，也可以是一个执行不同操作的人工元素。”

代码块设置如下：

```js
fetch('/giveMeANumber').then(res => { 
  ReactDOM.render(<Title />, rootEl) 
}) 
```

当我们希望引起你对代码块中特定部分的注意时，相关的行或项目将被设置为粗体：

```js
let c = 3
function add(a, b) {
  console.log(a, b)
  return a + b + c
}
```

**粗体**：表示新术语、重要单词或你在屏幕上看到的单词。例如，菜单或对话框中的单词会显示为**粗体**。以下是一个示例：“此标志可用于决定 UI 是否应显示**注销**或**登录**按钮。”

小贴士或重要注意事项

看起来像这样。

# 联系我们

我们读者的反馈总是受欢迎的。

在邮件主题中提及书籍标题，并发送至`customercare@packtpub.com`。

**勘误表**：尽管我们已经尽最大努力确保内容的准确性，但错误仍然可能发生。如果您在这本书中发现了错误，我们将非常感激您向我们报告。请访问[www.packtpub.com/support/errata](http://www.packtpub.com/support/errata)并填写表格。

通过链接材料发送至`copyright@packt.com`。

**如果你有兴趣成为作者**：如果你在某个领域有专业知识，并且你感兴趣的是撰写或为书籍做出贡献，请访问[authors.packtpub.com](http://authors.packtpub.com)。

# 分享你的想法

一旦你阅读了《正确设计 React Hooks》这本书，我们很乐意听听你的想法！请[点击此处直接进入亚马逊评论页面](https://www.packtpub.com/) [`packt.link/r/1803235950/`](https://packt.link/r/1803235950/)并为这本书分享你的反馈。

你的评论对我们和科技社区都很重要，并将帮助我们确保我们提供高质量的内容。
