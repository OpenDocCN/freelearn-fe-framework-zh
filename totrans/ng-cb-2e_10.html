<html><head></head><body>
<div class="Basic-Text-Frame" id="_idContainer208">
<h1 class="chapterNumber"><span class="koboSpan" id="kobo.1.1">10</span></h1>
<h1 class="chapterTitle" id="_idParaDest-333"><span class="koboSpan" id="kobo.2.1">Writing Unit Tests in Angular with Jest</span></h1>
<p class="normal"><em class="italic"><span class="koboSpan" id="kobo.3.1">“It works on my machine”</span></em><span class="koboSpan" id="kobo.4.1"> is a phrase that won’t lose its beauty with time. </span><span class="koboSpan" id="kobo.4.2">It is a shield for many engineers and a nightmare for the quality assurance professionals. </span><span class="koboSpan" id="kobo.4.3">But honestly, what’s a better way for your application’s robustness</span><a id="_idIndexMarker757"/><span class="koboSpan" id="kobo.5.1"> than writing tests? </span><span class="koboSpan" id="kobo.5.2">And when it comes to writing unit tests, my personal favorite is </span><strong class="keyWord"><span class="koboSpan" id="kobo.6.1">Jest</span></strong><span class="koboSpan" id="kobo.7.1">. </span><span class="koboSpan" id="kobo.7.2">That is because it is super-fast, lightweight, and has an easy API to write tests. </span><span class="koboSpan" id="kobo.7.3">More importantly, it is faster than the Karma and Jasmine setup that comes out of the box with Angular. </span><span class="koboSpan" id="kobo.7.4">In this chapter, you’ll learn how to configure Jest with Angular to run these tests in parallel. </span><span class="koboSpan" id="kobo.7.5">You’ll learn how to test components, services, and pipes with Jest. </span><span class="koboSpan" id="kobo.7.6">You’ll also learn how to mock dependencies for these tests.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.8.1">In this chapter, we’re going to cover the following recipes:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.9.1">Setting up unit tests in Angular with Jest</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.10.1">Providing global mocks for Jest</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.11.1">Mocking Angular services using stubs</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.12.1">Using spies on an injected service in a unit test</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.13.1">Mocking child components and directives using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.14.1">ng-mocks</span></code><span class="koboSpan" id="kobo.15.1"> package</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.16.1">Writing even easier tests with Angular CDK component harnesses</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.17.1">Unit-testing components with observables</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.18.1">Unit-testing Angular pipes</span></li>
</ul>
<h1 class="heading-1" id="_idParaDest-334"><span class="koboSpan" id="kobo.19.1">Technical requirements</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.20.1">For the recipes in this chapter, ensure your setup is complete as per the 'Technical Requirements' in the 'Angular-Cookbook-2E' GitHub repository. </span><span class="koboSpan" id="kobo.20.2">For setup details, visit: </span><a href="https://github.com/PacktPublishing/Angular-Cookbook-2E/tree/main/docs/technical-requirements.md"><span class="url"><span class="koboSpan" id="kobo.21.1">https://github.com/PacktPublishing/Angular-Cookbook-2E/tree/main/docs/technical-requirements.md</span></span></a><span class="koboSpan" id="kobo.22.1">. </span><span class="koboSpan" id="kobo.22.2">The starter code for this chapter is located at </span><a href="https://github.com/PacktPublishing/Angular-Cookbook-2E/tree/main/start/apps/chapter10"><span class="url"><span class="koboSpan" id="kobo.23.1">https://github.com/PacktPublishing/Angular-Cookbook-2E/tree/main/start/apps/chapter10</span></span></a><span class="koboSpan" id="kobo.24.1">.</span></p>
<h1 class="heading-1" id="_idParaDest-335"><span class="koboSpan" id="kobo.25.1">Setting up unit tests in Angular with Jest</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.26.1">By default, a new Angular project comes bundled</span><a id="_idIndexMarker758"/><span class="koboSpan" id="kobo.27.1"> with a lot of goodness, including</span><a id="_idIndexMarker759"/><span class="koboSpan" id="kobo.28.1"> the configuration and tooling in which to run unit tests with Karma and Jasmine. </span><span class="koboSpan" id="kobo.28.2">While working with Karma is relatively convenient, many developers find that in large-scale projects, the whole testing process becomes much slower if there are a lot of tests involved. </span><span class="koboSpan" id="kobo.28.3">This is mainly because you can’t run tests in parallel. </span><span class="koboSpan" id="kobo.28.4">In this recipe, we’ll set up Jest for unit testing in an Angular app. </span><span class="koboSpan" id="kobo.28.5">Additionally, we’ll migrate existing tests from the Karma syntax to the Jest syntax.</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.29.1">Starting with v16, Angular comes with a developer preview for Jest, and the process has become much easier. </span><span class="koboSpan" id="kobo.29.2">This recipe targets apps up to Angular v15 and covers what we can do in v16 at the end of the chapter.</span></p>
</div>
<h2 class="heading-2" id="_idParaDest-336"><span class="koboSpan" id="kobo.30.1">Getting ready</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.31.1">The app that we are going to work with now resides in </span><code class="inlineCode"><span class="koboSpan" id="kobo.32.1">start/apps/chapter10/ng-jest-setup</span></code><span class="koboSpan" id="kobo.33.1"> inside the cloned repository:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.34.1">Open the code repository in your code editor.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.35.1">Open the terminal, navigate to the code repository directory, and run the following command to serve the project:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.36.1">npm run serve:ng-jest-setup
</span></code></pre>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.37.1">The command in </span><em class="italic"><span class="koboSpan" id="kobo.38.1">step 2</span></em><span class="koboSpan" id="kobo.39.1"> is different from the rest of the recipes’ commands in this book. </span><span class="koboSpan" id="kobo.39.2">This is because the project for this recipe is </span><em class="italic"><span class="koboSpan" id="kobo.40.1">not</span></em><span class="koboSpan" id="kobo.41.1"> part of the NX workspace we have. </span><span class="koboSpan" id="kobo.41.2">It is a standalone Angular app itself; hence, it has different commands.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.42.1">This should open the app in a new browser tab, and you should see the following:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.43.1"><img alt="" role="presentation" src="../Images/B18469_10_01.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.44.1">Figure 10.1: The ng-jest-setup app running on http://localhost:4200</span></p>
<p class="normal"><span class="koboSpan" id="kobo.45.1">Next, try to run the test</span><a id="_idIndexMarker760"/><span class="koboSpan" id="kobo.46.1"> and monitor how much time</span><a id="_idIndexMarker761"/><span class="koboSpan" id="kobo.47.1"> it takes for the entire process to run. </span><span class="koboSpan" id="kobo.47.2">Run the command </span><code class="inlineCode"><span class="koboSpan" id="kobo.48.1">npm run test:ng-jest-setup</span></code><span class="koboSpan" id="kobo.49.1"> from the workspace </span><code class="inlineCode"><span class="koboSpan" id="kobo.50.1">root</span></code><span class="koboSpan" id="kobo.51.1">; within a few seconds, a new Chrome window should open, as follows:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.52.1"><img alt="" role="presentation" src="../Images/B18469_10_02.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.53.1">Figure 10.2: The tests’ results with Karma and Jasmine</span></p> </li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.54.1">Looking at the preceding screenshot, you might say </span><em class="italic"><span class="koboSpan" id="kobo.55.1">“Pfffttt, Ahsan, it says ‘finished in 0.033s (or something close to it)!’ </span><span class="koboSpan" id="kobo.55.2">What else do you want?”</span></em><span class="koboSpan" id="kobo.56.1"> Well, that time only covers how long it took Karma to run the tests </span><em class="italic"><span class="koboSpan" id="kobo.57.1">in the browser after the Chrome window was created</span></em><span class="koboSpan" id="kobo.58.1">. </span><span class="koboSpan" id="kobo.58.2">It doesn’t count the time it took to start the process, start the Chrome window, and then load the tests. </span><span class="koboSpan" id="kobo.58.3">This could be improved by running the Chrome Headless browser for Karma, which requires some configuration. </span><span class="koboSpan" id="kobo.58.4">However, it is still slower compared to the alternative (Jest). </span><span class="koboSpan" id="kobo.58.5">Also, at the time of writing this recipe, I’m running this on a Macbook Pro with the M2 Chip, </span><em class="italic"><span class="koboSpan" id="kobo.59.1">which is fast</span></em><span class="koboSpan" id="kobo.60.1">. </span><span class="koboSpan" id="kobo.60.2">That’s why we’re going to replace it with Jest. </span><span class="koboSpan" id="kobo.60.3">Now that you understand </span><a id="_idIndexMarker762"/><span class="koboSpan" id="kobo.61.1">the issue, in the next section, let’s take</span><a id="_idIndexMarker763"/><span class="koboSpan" id="kobo.62.1"> a look at the steps of the recipe.</span></p>
<h2 class="heading-2" id="_idParaDest-337"><span class="koboSpan" id="kobo.63.1">How to do it...</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.64.1">Here, we have an Angular app with a simple </span><code class="inlineCode"><span class="koboSpan" id="kobo.65.1">Counter</span></code><span class="koboSpan" id="kobo.66.1"> component. </span><span class="koboSpan" id="kobo.66.2">It shows the value of the counter and has three action buttons: one of the buttons is to increase the value of the counter, one of them is to decrease the value, and another is to reset the value. </span><span class="koboSpan" id="kobo.66.3">Additionally, there are some tests written with Karma and Jasmine, and all of the tests will pass if you run the tests. </span><span class="koboSpan" id="kobo.66.4">We’ll start by setting up Jest instead. </span><span class="koboSpan" id="kobo.66.5">Perform the following steps:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.67.1">First, open a new Terminal window/tab, and make sure you’re inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.68.1">start/apps/chapter10/ng-jest-setup</span></code><span class="koboSpan" id="kobo.69.1"> folder. </span><span class="koboSpan" id="kobo.69.2">Once inside, run the following command to install the packages that are required to test with Jest:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.70.1">npm install --save-dev jest jest-preset-angular @types/jest
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.71.1">We can now uninstall Karma and the unwanted dependencies. </span><span class="koboSpan" id="kobo.71.2">Now, run the following command in your Terminal:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.72.1">npm uninstall karma karma-chrome-launcher karma-jasmine-html-reporter @types/jasmine @types/jasminewd2 jasmine-core jasmine-spec-reporter karma-coverage-istanbul-reporter karma-jasmine
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.73.1">Now, update the test configuration in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.74.1">angular.json</span></code><span class="koboSpan" id="kobo.75.1"> file, as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-punctuation"><span class="koboSpan" id="kobo.76.1">{</span></span><span class="koboSpan" id="kobo.77.1">
  ...
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.78.1">"projects"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.79.1">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.80.1">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.81.1">"ng-jest-setup"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.82.1">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.83.1">{</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.84.1">"..."</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.85.1">"prefix"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.86.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.87.1">"app"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.88.1">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.89.1">"architect"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.90.1">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.91.1">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.92.1">"build"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.93.1">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.94.1">{</span></span><span class="koboSpan" id="kobo.95.1">...</span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.96.1">},</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.97.1">"serve"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.98.1">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.99.1">{</span></span><span class="koboSpan" id="kobo.100.1">...</span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.101.1">},</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.102.1">"extract-i18n"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.103.1">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.104.1">{</span></span><span class="koboSpan" id="kobo.105.1">...</span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.106.1">},</span></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.107.1">"test"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.108.1">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.109.1">{</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.110.1">"builder"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.111.1">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.112.1">"@angular-builders/jest:run"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.113.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.114.1">"options"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.115.1">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.116.1">{</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.117.1">"tsConfig"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.118.1">:</span></strong></span>
<span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.119.1">"&lt;rootDir&gt;/src/tsconfig.test.json"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.120.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.121.1">"collectCoverage"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.122.1">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.123.1">false</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.124.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.125.1">"forceExit"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.126.1">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.127.1">true</span></strong></span>
<span class="code-highlight"><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.128.1">}</span></strong></span>
<span class="code-highlight"><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.129.1">},</span></strong></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.130.1">"lint"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.131.1">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.132.1">{</span></span><span class="koboSpan" id="kobo.133.1">...</span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.134.1">},</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.135.1">"e2e"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.136.1">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.137.1">{</span></span><span class="koboSpan" id="kobo.138.1">...</span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.139.1">}</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.140.1">}</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.141.1">}</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.142.1">},</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.143.1">"defaultProject"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.144.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.145.1">"setting-up-jest"</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.146.1">}</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.147.1">We will now create a file to configure</span><a id="_idIndexMarker764"/><span class="koboSpan" id="kobo.148.1"> Jest for our project. </span><span class="koboSpan" id="kobo.148.2">Create a file</span><a id="_idIndexMarker765"/><span class="koboSpan" id="kobo.149.1"> named </span><code class="inlineCode"><span class="koboSpan" id="kobo.150.1">jestSetup.ts</span></code><span class="koboSpan" id="kobo.151.1"> inside the project’s folder, and paste the following content inside:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.152.1">import 'jest-preset-angular/setup-jest';
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.153.1">Now, let’s modify </span><code class="inlineCode"><span class="koboSpan" id="kobo.154.1">tsconfig.spec.json</span></code><span class="koboSpan" id="kobo.155.1"> to use Jest instead of Jasmine. </span><span class="koboSpan" id="kobo.155.2">After the modification, your entire file should appear as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-punctuation"><span class="koboSpan" id="kobo.156.1">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.157.1">"extends"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.158.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.159.1">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.160.1">./tsconfig.json"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.161.1">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.162.1">"compilerOptions"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.163.1">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.164.1">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.165.1">"outDir"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.166.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.167.1">"./out-tsc/spec"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.168.1">,</span></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.169.1">"types"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.170.1">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.171.1">[</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.172.1">"jest"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.173.1">,</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.174.1">"node"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.175.1">],</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.176.1">"esModuleInterop"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.177.1">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.178.1">true</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.179.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.180.1">"emitDecoratorMetadata"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.181.1">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.182.1">true</span></strong></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.183.1">},</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.184.1">"</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.185.1">files"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.186.1">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.187.1">[</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.188.1">"src/polyfills.ts"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.189.1">],</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.190.1">"include"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.191.1">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.192.1">[</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.193.1">"src/**/*.spec.ts"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.194.1">,</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.195.1">"src/**/*.d.ts"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.196.1">]</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.197.1">}</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.198.1">We’ll now modify </span><code class="inlineCode"><span class="koboSpan" id="kobo.199.1">package.json</span></code><span class="koboSpan" id="kobo.200.1"> to add</span><a id="_idIndexMarker766"/><span class="koboSpan" id="kobo.201.1"> the </span><code class="inlineCode"><span class="koboSpan" id="kobo.202.1">npm</span></code><span class="koboSpan" id="kobo.203.1"> scripts that’ll run</span><a id="_idIndexMarker767"/><span class="koboSpan" id="kobo.204.1"> the Jest tests:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-punctuation"><span class="koboSpan" id="kobo.205.1">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.206.1">"name"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.207.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.208.1">"setting-up-jest"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.209.1">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.210.1">"version"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.211.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.212.1">"0.0.0"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.213.1">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.214.1">"scripts"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.215.1">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.216.1">{</span></span><span class="koboSpan" id="kobo.217.1">
    ...
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.218.1">"build"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.219.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.220.1">"ng build"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.221.1">,</span></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.222.1">"test"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.223.1">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.224.1">"jest"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.225.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.226.1">"test:coverage"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.227.1">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.228.1">"jest --coverage"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.229.1">,</span></strong></span><span class="koboSpan" id="kobo.230.1">
    ...
  </span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.231.1">},</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.232.1">"private"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.233.1">:</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.234.1">true</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.235.1">,</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.236.1">"dependencies"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.237.1">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.238.1">{</span></span><span class="koboSpan" id="kobo.239.1">...</span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.240.1">},</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.241.1">"devDependencies"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.242.1">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.243.1">{</span></span><span class="koboSpan" id="kobo.244.1">...</span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.245.1">},</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.246.1">}</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.247.1">Finally, let’s wrap up the entire configuration for our Jest tests by adding the Jest configuration in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.248.1">package.json</span></code><span class="koboSpan" id="kobo.249.1"> file, as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-punctuation"><span class="koboSpan" id="kobo.250.1">{</span></span><span class="koboSpan" id="kobo.251.1">
  ...
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.252.1">"dependencies"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.253.1">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.254.1">{</span></span><span class="koboSpan" id="kobo.255.1">...</span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.256.1">},</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.257.1">"devDependencies"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.258.1">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.259.1">{</span></span><span class="koboSpan" id="kobo.260.1">...</span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.261.1">},</span></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.262.1">"jest"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.263.1">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.264.1">{</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.265.1">"preset"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.266.1">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.267.1">"jest-preset-angular"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.268.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.269.1">"setupFilesAfterEnv"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.270.1">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.271.1">[</span></strong></span>
<span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.272.1">"&lt;rootDir&gt;/jestSetup.ts"</span></strong></span>
<span class="code-highlight"><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.273.1">]</span></strong></span>
<span class="code-highlight"><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.274.1">}</span></strong></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.275.1">}</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.276.1">Now that we have set everything up, simply run the </span><code class="inlineCode"><span class="koboSpan" id="kobo.277.1">test</span></code><span class="koboSpan" id="kobo.278.1"> command from within the </span><code class="inlineCode"><span class="koboSpan" id="kobo.279.1">ng-jest-setup</span></code><span class="koboSpan" id="kobo.280.1"> folder, as follows:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.281.1">npm run test
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.282.1">Once the tests are finished, you should be able to see the following output:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.283.1"><img alt="" role="presentation" src="../Images/B18469_10_03.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.284.1">Figure 10.3: The results of the tests with Jest</span></p></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.285.1">Kaboom! </span><span class="koboSpan" id="kobo.285.2">You will notice that the entire process of running the tests with Jest takes about 6 seconds. </span><span class="koboSpan" id="kobo.285.3">It might take longer</span><a id="_idIndexMarker768"/><span class="koboSpan" id="kobo.286.1"> when you run it for the first time, but the subsequent</span><a id="_idIndexMarker769"/><span class="koboSpan" id="kobo.287.1"> runs should be faster. </span><span class="koboSpan" id="kobo.287.2">Now that you know how to configure an Angular app to use Jest for unit tests, please refer to the next section for resources in which to learn more.</span></p>
<h2 class="heading-2" id="_idParaDest-338"><span class="koboSpan" id="kobo.288.1">Bonus: Migrating to Jest in Angular v16</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.289.1">Starting from Angular v16, all you need</span><a id="_idIndexMarker770"/><span class="koboSpan" id="kobo.290.1"> to do to migrate to Jest (considering your project currently uses Karma) is to update the </span><code class="inlineCode"><span class="koboSpan" id="kobo.291.1">angular.json</span></code><span class="koboSpan" id="kobo.292.1"> file in the project with the following configuration object property hierarchy </span><code class="inlineCode"><span class="koboSpan" id="kobo.293.1">your-app &gt; architect &gt; test</span></code><span class="koboSpan" id="kobo.294.1"> settings:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-punctuation"><span class="koboSpan" id="kobo.295.1">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.296.1">"projects"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.297.1">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.298.1">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.299.1">"</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.300.1">my-app"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.301.1">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.302.1">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.303.1">"architect"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.304.1">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.305.1">{</span></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.306.1">"test"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.307.1">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.308.1">{</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.309.1">"builder"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.310.1">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.311.1">"@angular-devkit/build-angular:jest"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.312.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.313.1">"options"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.314.1">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.315.1">{</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.316.1">"tsConfig"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.317.1">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.318.1">"tsconfig.spec.json"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.319.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.320.1">"polyfills"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.321.1">:</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.322.1">[</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.323.1">"</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.324.1">zone.js"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.325.1">,</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.326.1">"zone.js/testing"</span></strong><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.327.1">]</span></strong></span>
<span class="code-highlight"><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.328.1">}</span></strong></span>
<span class="code-highlight"><strong class="hljs-punctuation-slc"><span class="koboSpan" id="kobo.329.1">}</span></strong></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.330.1">}</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.331.1">}</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.332.1">}</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.333.1">}</span></span>
</code></pre>
<h2 class="heading-2" id="_idParaDest-339"><span class="koboSpan" id="kobo.334.1">See also</span></h2>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.335.1">Testing Web Frameworks</span><a id="_idIndexMarker771"/><span class="koboSpan" id="kobo.336.1"> with Jest: </span><a href="https://jestjs.io/docs/en/testing-frameworks"><span class="url"><span class="koboSpan" id="kobo.337.1">https://jestjs.io/docs/en/testing-frameworks</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.338.1">Getting Started</span><a id="_idIndexMarker772"/><span class="koboSpan" id="kobo.339.1"> with Jest: </span><a href="https://jestjs.io/docs/en/getting-started"><span class="url"><span class="koboSpan" id="kobo.340.1">https://jestjs.io/docs/en/getting-started</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.341.1">Moving Angular CLI </span><a id="_idIndexMarker773"/><span class="koboSpan" id="kobo.342.1">to Jest: </span><a href="https://blog.angular.io/moving-angular-cli-to-jest-and-web-test-runner-ef85ef69ceca"><span class="url"><span class="koboSpan" id="kobo.343.1">https://blog.angular.io/moving-angular-cli-to-jest-and-web-test-runner-ef85ef69ceca</span></span></a></li>
</ul>
<h1 class="heading-1" id="_idParaDest-340"><span class="koboSpan" id="kobo.344.1">Providing global mocks for Jest</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.345.1">In the previous recipe, we learned</span><a id="_idIndexMarker774"/><span class="koboSpan" id="kobo.346.1"> how to set up Jest for Angular unit tests. </span><span class="koboSpan" id="kobo.346.2">There might be some</span><a id="_idIndexMarker775"/><span class="koboSpan" id="kobo.347.1"> scenarios in which you’d want to use a browser API that might not be part of your actual Angular code – for instance, using </span><code class="inlineCode"><span class="koboSpan" id="kobo.348.1">LocalStorage</span></code><span class="koboSpan" id="kobo.349.1"> or </span><code class="inlineCode"><span class="koboSpan" id="kobo.350.1">alert</span></code><span class="koboSpan" id="kobo.351.1">. </span><span class="koboSpan" id="kobo.351.2">In such cases, we need to provide some global mocks for the functions that we want to return mock values from. </span><span class="koboSpan" id="kobo.351.3">This is so that we can perform tests involving them as well. </span><span class="koboSpan" id="kobo.351.4">In this recipe, you’ll learn how to provide global mocks to Jest.</span></p>
<h2 class="heading-2" id="_idParaDest-341"><span class="koboSpan" id="kobo.352.1">Getting ready</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.353.1">The app that we are going to work with now resides in </span><code class="inlineCode"><span class="koboSpan" id="kobo.354.1">start/apps/chapter10/ng-jest-global-mocks</span></code><span class="koboSpan" id="kobo.355.1"> inside the cloned repository:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.356.1">Open the code repository in your code editor.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.357.1">Open the terminal, navigate to the code repository directory, and run the following command to serve the project:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.358.1">npm run serve ng-jest-global-mocks
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.359.1">This should open the app in a new browser tab, and you should see the following:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.360.1"><img alt="" role="presentation" src="../Images/B18469_10_04.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.361.1">Figure 10.4: The ng-jest-global-mocks app running on http://localhost:4200</span></p></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.362.1">Now that we have the app running</span><a id="_idIndexMarker776"/><span class="koboSpan" id="kobo.363.1"> locally, in the next section, let’s go through the steps</span><a id="_idIndexMarker777"/><span class="koboSpan" id="kobo.364.1"> of the recipe.</span></p>
<h2 class="heading-2" id="_idParaDest-342"><span class="koboSpan" id="kobo.365.1">How to do it...</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.366.1">The app we’re using for this recipe uses two global APIs: </span><code class="inlineCode"><span class="koboSpan" id="kobo.367.1">window.localStorage</span></code><span class="koboSpan" id="kobo.368.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.369.1">window.alert</span></code><span class="koboSpan" id="kobo.370.1">. </span><span class="koboSpan" id="kobo.370.2">Note that when the app starts, we get the counter value from </span><code class="inlineCode"><span class="koboSpan" id="kobo.371.1">LocalStorage</span></code><span class="koboSpan" id="kobo.372.1">, and then upon increment, decrement, and reset, we store it in </span><code class="inlineCode"><span class="koboSpan" id="kobo.373.1">LocalStorage</span></code><span class="koboSpan" id="kobo.374.1">. </span><span class="koboSpan" id="kobo.374.2">When the counter value becomes greater than the </span><code class="inlineCode"><span class="koboSpan" id="kobo.375.1">MAX_VALUE</span></code><span class="koboSpan" id="kobo.376.1"> or lower than the </span><code class="inlineCode"><span class="koboSpan" id="kobo.377.1">MIN_VALUE</span></code><span class="koboSpan" id="kobo.378.1">, we show the alert using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.379.1">alert</span></code><span class="koboSpan" id="kobo.380.1"> method. </span><span class="koboSpan" id="kobo.380.2">Let’s begin the recipe by writing some cool unit tests:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.381.1">First, we’ll write our test cases to show the alert when the counter value goes beyond </span><code class="inlineCode"><span class="koboSpan" id="kobo.382.1">MAX_VALUE</span></code><span class="koboSpan" id="kobo.383.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.384.1">MIN_VALUE</span></code><span class="koboSpan" id="kobo.385.1">. </span><span class="koboSpan" id="kobo.385.2">Modify the </span><code class="inlineCode"><span class="koboSpan" id="kobo.386.1">counter.component.spec.ts</span></code><span class="koboSpan" id="kobo.387.1"> file as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.388.1">...
</span><span class="hljs-title"><span class="koboSpan" id="kobo.389.1">describe</span></span><span class="koboSpan" id="kobo.390.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.391.1">'CounterComponent'</span></span><span class="koboSpan" id="kobo.392.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.393.1">() =&gt;</span></span><span class="koboSpan" id="kobo.394.1"> {
  ...
  </span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.395.1">it</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.396.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.397.1">'</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.398.1">should show an alert when the counter value goes</span></strong></span>
<span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.399.1">above the MAX_VALUE'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.400.1">, </span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.401.1">() =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.402.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.403.1">jest.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.404.1">spyOn</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.405.1">(</span></strong><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.406.1">window</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.407.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.408.1">'alert'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.409.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.410.1">component.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.411.1">counter</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.412.1"> = component.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.413.1">MAX_VALUE</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.414.1">;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.415.1">component.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.416.1">increment</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.417.1">();</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.418.1">expect</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.419.1">(</span></strong><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.420.1">window</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.421.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.422.1">alert</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.423.1">).</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.424.1">toHaveBeenCalledWith</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.425.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.426.1">'Value too</span></strong></span>
<span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.427.1">high'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.428.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.429.1">expect</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.430.1">(component.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.431.1">counter</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.432.1">).</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.433.1">toBe</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.434.1">(component.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.435.1">MAX_VALUE</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.436.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.437.1">});</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.438.1">it</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.439.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.440.1">'should show an alert when the counter value goes</span></strong></span>
<span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.441.1">below the MIN_VALUE'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.442.1">, </span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.443.1">() =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.444.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.445.1">jest.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.446.1">spyOn</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.447.1">(</span></strong><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.448.1">window</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.449.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.450.1">'alert'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.451.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.452.1">component.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.453.1">counter</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.454.1"> = component.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.455.1">MIN_VALUE</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.456.1">;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.457.1">component.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.458.1">decrement</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.459.1">();</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.460.1">expect</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.461.1">(</span></strong><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.462.1">window</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.463.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.464.1">alert</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.465.1">).</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.466.1">toHaveBeenCalledWith</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.467.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.468.1">'Value too</span></strong></span>
<span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.469.1">low'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.470.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.471.1">expect</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.472.1">(component.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.473.1">counter</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.474.1">).</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.475.1">toBe</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.476.1">(component.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.477.1">MIN_VALUE</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.478.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.479.1">});</span></strong></span><span class="koboSpan" id="kobo.480.1">
});
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.481.1">Here, you can see that the tests pass but with a bunch of console errors. </span><span class="koboSpan" id="kobo.481.2">And what if we wanted to check whether the value from </span><code class="inlineCode"><span class="koboSpan" id="kobo.482.1">LocalStorage</span></code><span class="koboSpan" id="kobo.483.1"> is being saved and retrieved properly?</span></p></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="2"><span class="koboSpan" id="kobo.484.1">We’ll create a new test to make</span><a id="_idIndexMarker778"/><span class="koboSpan" id="kobo.485.1"> sure the </span><code class="inlineCode"><span class="koboSpan" id="kobo.486.1">localStorage.getItem</span></code><span class="koboSpan" id="kobo.487.1"> method is called</span><a id="_idIndexMarker779"/><span class="koboSpan" id="kobo.488.1"> to retrieve the last saved value from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.489.1">LocalStorageAPI</span></code><span class="koboSpan" id="kobo.490.1">. </span><span class="koboSpan" id="kobo.490.2">Add the test to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.491.1">counter.component.spec.ts</span></code><span class="koboSpan" id="kobo.492.1"> file, as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.493.1">...
</span><span class="hljs-title"><span class="koboSpan" id="kobo.494.1">describe</span></span><span class="koboSpan" id="kobo.495.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.496.1">'CounterComponent'</span></span><span class="koboSpan" id="kobo.497.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.498.1">() =&gt;</span></span><span class="koboSpan" id="kobo.499.1"> {
  ...
  </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.500.1">it.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.501.1">only</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.502.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.503.1">'</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.504.1">should call the localStorage.getItem method on</span></strong></span>
<span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.505.1">component init'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.506.1">, </span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.507.1">() =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.508.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.509.1">jest.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.510.1">spyOn</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.511.1">(</span></strong><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.512.1">localStorage</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.513.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.514.1">'getItem'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.515.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.516.1">component.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.517.1">ngOnInit</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.518.1">();</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.519.1">expect</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.520.1">(</span></strong><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.521.1">localStorage</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.522.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.523.1">getItem</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.524.1">).</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.525.1">toHaveBeenCalled</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.526.1">();</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.527.1">});</span></strong></span><span class="koboSpan" id="kobo.528.1">
});
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.529.1">Notice that we’re using </span><code class="inlineCode"><span class="koboSpan" id="kobo.530.1">it.only</span></code><span class="koboSpan" id="kobo.531.1"> for this test case. </span><span class="koboSpan" id="kobo.531.2">This is to ensure that we’re only running this test (for now). </span><span class="koboSpan" id="kobo.531.3">If you run the tests, you should be able to see something like the following screenshot:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.532.1"><img alt="" role="presentation" src="../Images/B18469_10_05.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.533.1">Figure 10.5: The test that covers the LocalStorageAPI has failed</span></p>
<p class="normal"><span class="koboSpan" id="kobo.534.1">Notice the </span><strong class="screenText"><span class="koboSpan" id="kobo.535.1">Matcher error: received value must be a mock or a spy function</span></strong><span class="koboSpan" id="kobo.536.1"> message. </span><span class="koboSpan" id="kobo.536.2">This is what we’re going to do next, that is, provide a mock.</span></p> </li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="3"><span class="koboSpan" id="kobo.537.1">Create a file inside</span><a id="_idIndexMarker780"/><span class="koboSpan" id="kobo.538.1"> the project’s </span><code class="inlineCode"><span class="koboSpan" id="kobo.539.1">src</span></code><span class="koboSpan" id="kobo.540.1"> folder, and name </span><a id="_idIndexMarker781"/><span class="koboSpan" id="kobo.541.1">the file </span><code class="inlineCode"><span class="koboSpan" id="kobo.542.1">jest-global-mocks.ts</span></code><span class="koboSpan" id="kobo.543.1">. </span><span class="koboSpan" id="kobo.543.2">Then, add the following code to mock the </span><code class="inlineCode"><span class="koboSpan" id="kobo.544.1">LocalStorageAPI</span></code><span class="koboSpan" id="kobo.545.1">:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.546.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.547.1">LocalStorageMock</span></span><span class="koboSpan" id="kobo.548.1"> {
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.549.1">storage</span></span><span class="koboSpan" id="kobo.550.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.551.1">Partial</span></span><span class="koboSpan" id="kobo.552.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.553.1">Storage</span></span><span class="koboSpan" id="kobo.554.1">&gt; = {};
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.555.1">getItem</span></span><span class="koboSpan" id="kobo.556.1">(</span><span class="hljs-attr"><span class="koboSpan" id="kobo.557.1">key</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.558.1">: </span></span><span class="hljs-built_in"><span class="koboSpan" id="kobo.559.1">string</span></span><span class="koboSpan" id="kobo.560.1">) {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.561.1">return</span></span> <span class="hljs-variable"><span class="koboSpan" id="kobo.562.1">this</span></span><span class="koboSpan" id="kobo.563.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.564.1">storage</span></span><span class="koboSpan" id="kobo.565.1">[key] ? </span><span class="hljs-variable"><span class="koboSpan" id="kobo.566.1">this</span></span><span class="koboSpan" id="kobo.567.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.568.1">storage</span></span><span class="koboSpan" id="kobo.569.1">[key] : </span><span class="hljs-literal"><span class="koboSpan" id="kobo.570.1">null</span></span><span class="koboSpan" id="kobo.571.1">;
  }
  
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.572.1">setItem</span></span><span class="koboSpan" id="kobo.573.1">(</span><span class="hljs-attr"><span class="koboSpan" id="kobo.574.1">key</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.575.1">: </span></span><span class="hljs-built_in"><span class="koboSpan" id="kobo.576.1">string</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.577.1">, </span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.578.1">value</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.579.1">: </span></span><span class="hljs-built_in"><span class="koboSpan" id="kobo.580.1">string</span></span><span class="koboSpan" id="kobo.581.1">) {
    </span><span class="hljs-variable"><span class="koboSpan" id="kobo.582.1">this</span></span><span class="koboSpan" id="kobo.583.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.584.1">storage</span></span><span class="koboSpan" id="kobo.585.1">[key] = value;
  }
}
 
</span><span class="hljs-title"><span class="koboSpan" id="kobo.586.1">Object</span></span><span class="koboSpan" id="kobo.587.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.588.1">defineProperty</span></span><span class="koboSpan" id="kobo.589.1">(</span><span class="hljs-variable"><span class="koboSpan" id="kobo.590.1">window</span></span><span class="koboSpan" id="kobo.591.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.592.1">'localStorage'</span></span><span class="koboSpan" id="kobo.593.1">, {
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.594.1">value</span></span><span class="koboSpan" id="kobo.595.1">: </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.596.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.597.1">LocalStorageMock</span></span><span class="koboSpan" id="kobo.598.1">(),
});
 
</span><span class="hljs-title"><span class="koboSpan" id="kobo.599.1">Object</span></span><span class="koboSpan" id="kobo.600.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.601.1">defineProperty</span></span><span class="koboSpan" id="kobo.602.1">(</span><span class="hljs-variable"><span class="koboSpan" id="kobo.603.1">window</span></span><span class="koboSpan" id="kobo.604.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.605.1">'alert'</span></span><span class="koboSpan" id="kobo.606.1">, {
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.607.1">value</span></span><span class="koboSpan" id="kobo.608.1">: jest.</span><span class="hljs-title"><span class="koboSpan" id="kobo.609.1">fn</span></span><span class="koboSpan" id="kobo.610.1">(),
});
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.611.1">Now, import this file into the </span><code class="inlineCode"><span class="koboSpan" id="kobo.612.1">src/test-setup.ts</span></code><span class="koboSpan" id="kobo.613.1"> file, as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.614.1">...
</span><span class="koboSpan" id="kobo.614.2">globalThis.</span><span class="hljs-property"><span class="koboSpan" id="kobo.615.1">ngJest</span></span><span class="koboSpan" id="kobo.616.1"> = {...};
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.617.1">import</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.618.1">'jest-preset-angular/setup-jest'</span></span><span class="koboSpan" id="kobo.619.1">;
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.620.1">import</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.621.1">'./jest-global-mocks'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.622.1">;</span></strong></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.623.1">Now, if you rerun the tests, they should pass.</span></p></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="5"><span class="koboSpan" id="kobo.624.1">Let’s add another test to ensure</span><a id="_idIndexMarker782"/><span class="koboSpan" id="kobo.625.1"> we retrieve the last saved value</span><a id="_idIndexMarker783"/><span class="koboSpan" id="kobo.626.1"> from </span><code class="inlineCode"><span class="koboSpan" id="kobo.627.1">LocalStorage</span></code><span class="koboSpan" id="kobo.628.1"> in the component initiation. </span><span class="koboSpan" id="kobo.628.2">Modify the </span><code class="inlineCode"><span class="koboSpan" id="kobo.629.1">counter.component.spec.ts</span></code><span class="koboSpan" id="kobo.630.1"> file, as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.631.1">...
</span><span class="hljs-title"><span class="koboSpan" id="kobo.632.1">describe</span></span><span class="koboSpan" id="kobo.633.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.634.1">'CounterComponent'</span></span><span class="koboSpan" id="kobo.635.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.636.1">() =&gt;</span></span><span class="koboSpan" id="kobo.637.1"> {
  ...
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.638.1">it</span></span><span class="koboSpan" id="kobo.639.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.640.1">'should call the localStorage.getItem method on</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.641.1">component init'</span></span><span class="koboSpan" id="kobo.642.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.643.1">() =&gt;</span></span><span class="koboSpan" id="kobo.644.1"> {...});
  </span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.645.1">it</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.646.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.647.1">'should retrieve the last saved value from</span></strong></span>
<span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.648.1">localStorage on component init'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.649.1">, </span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.650.1">() =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.651.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.652.1">localStorage</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.653.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.654.1">setItem</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.655.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.656.1">'counterValue'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.657.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.658.1">'12'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.659.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.660.1">component.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.661.1">ngOnInit</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.662.1">();</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.663.1">expect</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.664.1">(component.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.665.1">counter</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.666.1">).</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.667.1">toBe</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.668.1">(</span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.669.1">12</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.670.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.671.1">});</span></strong></span><span class="koboSpan" id="kobo.672.1">
});
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.673.1">Finally, let’s make sure that we save the counter value to </span><code class="inlineCode"><span class="koboSpan" id="kobo.674.1">LocalStorage</span></code><span class="koboSpan" id="kobo.675.1"> whenever we trigger the </span><code class="inlineCode"><span class="koboSpan" id="kobo.676.1">increment</span></code><span class="koboSpan" id="kobo.677.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.678.1">decrement</span></code><span class="koboSpan" id="kobo.679.1">, or </span><code class="inlineCode"><span class="koboSpan" id="kobo.680.1">reset</span></code><span class="koboSpan" id="kobo.681.1"> methods. </span><span class="koboSpan" id="kobo.681.2">Update the </span><code class="inlineCode"><span class="koboSpan" id="kobo.682.1">counter.component.spec.ts</span></code><span class="koboSpan" id="kobo.683.1"> as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.684.1">...
</span><span class="hljs-title"><span class="koboSpan" id="kobo.685.1">describe</span></span><span class="koboSpan" id="kobo.686.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.687.1">'CounterComponent'</span></span><span class="koboSpan" id="kobo.688.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.689.1">() =&gt;</span></span><span class="koboSpan" id="kobo.690.1"> {
  ...
  </span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.691.1">it</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.692.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.693.1">'should save the new counterValue to localStorage on</span></strong></span>
<span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.694.1">increment, decrement and reset'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.695.1">, </span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.696.1">() =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.697.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.698.1">jest.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.699.1">spyOn</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.700.1">(</span></strong><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.701.1">localStorage</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.702.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.703.1">'setItem'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.704.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.705.1">component.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.706.1">counter</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.707.1"> = </span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.708.1">0</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.709.1">;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.710.1">component.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.711.1">increment</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.712.1">();</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.713.1">expect</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.714.1">(</span></strong><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.715.1">localStorage</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.716.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.717.1">setItem</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.718.1">).</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.719.1">toHaveBeenCalledWith</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.720.1">(</span></strong></span>
<span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.721.1">'counterValue'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.722.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.723.1">'1'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.724.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.725.1">component.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.726.1">counter</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.727.1"> = </span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.728.1">20</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.729.1">;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.730.1">component.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.731.1">decrement</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.732.1">();</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.733.1">expect</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.734.1">(</span></strong><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.735.1">localStorage</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.736.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.737.1">setItem</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.738.1">).</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.739.1">toHaveBeenCalledWith</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.740.1">(</span></strong></span>
<span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.741.1">'counterValue'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.742.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.743.1">'19'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.744.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.745.1">component.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.746.1">reset</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.747.1">();</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.748.1">expect</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.749.1">(</span></strong><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.750.1">localStorage</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.751.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.752.1">setItem</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.753.1">).</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.754.1">toHaveBeenCalledWith</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.755.1">(</span></strong></span>
<span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.756.1">'</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.757.1">counterValue'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.758.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.759.1">'0'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.760.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.761.1">});</span></strong></span><span class="koboSpan" id="kobo.762.1">
});
</span></code></pre>
</li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.763.1">Awesomesauce! </span><span class="koboSpan" id="kobo.763.2">You’ve just learned how to provide global mocks to Jest for testing. </span><span class="koboSpan" id="kobo.763.3">Please refer to the next section to understand how this works.</span></p>
<h2 class="heading-2" id="_idParaDest-343"><span class="koboSpan" id="kobo.764.1">How it works...</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.765.1">Jest provides a way to define</span><a id="_idIndexMarker784"/><span class="koboSpan" id="kobo.766.1"> global mocks for tests. </span><span class="koboSpan" id="kobo.766.2">It comes with a lot of built-in functions</span><a id="_idIndexMarker785"/><span class="koboSpan" id="kobo.767.1"> to define test suites and test cases, along with assertion functions. </span><span class="koboSpan" id="kobo.767.2">Here is an example of a simple Jest test suite for a </span><code class="inlineCode"><span class="koboSpan" id="kobo.768.1">sum</span></code><span class="koboSpan" id="kobo.769.1"> function that adds two numbers:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.770.1">import</span></span><span class="koboSpan" id="kobo.771.1"> { sum } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.772.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.773.1">'./sum'</span></span><span class="koboSpan" id="kobo.774.1">;
</span><span class="hljs-title"><span class="koboSpan" id="kobo.775.1">describe</span></span><span class="koboSpan" id="kobo.776.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.777.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.778.1">Sum function'</span></span><span class="koboSpan" id="kobo.779.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.780.1">() =&gt;</span></span><span class="koboSpan" id="kobo.781.1"> {
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.782.1">it</span></span><span class="koboSpan" id="kobo.783.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.784.1">'should add two numbers'</span></span><span class="koboSpan" id="kobo.785.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.786.1">() =&gt;</span></span><span class="koboSpan" id="kobo.787.1"> {
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.788.1">expect</span></span><span class="koboSpan" id="kobo.789.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.790.1">sum</span></span><span class="koboSpan" id="kobo.791.1">(</span><span class="hljs-number"><span class="koboSpan" id="kobo.792.1">2</span></span><span class="koboSpan" id="kobo.793.1">,</span><span class="hljs-number"><span class="koboSpan" id="kobo.794.1">3</span></span><span class="koboSpan" id="kobo.795.1">)).</span><span class="hljs-title"><span class="koboSpan" id="kobo.796.1">toBe</span></span><span class="koboSpan" id="kobo.797.1">(</span><span class="hljs-number"><span class="koboSpan" id="kobo.798.1">5</span></span><span class="koboSpan" id="kobo.799.1">);
  });
});
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.800.1">Jest also has a way to use a particular file to set up Jest in projects. </span><span class="koboSpan" id="kobo.800.2">When working with different frameworks, the file (or the filename) can be different, but the purpose would still be the same, that is, to define global configuration via this Jest setup file. </span><span class="koboSpan" id="kobo.800.3">In our NX workspace, we already have the Jest files in each project under the </span><code class="inlineCode"><span class="koboSpan" id="kobo.801.1">src</span></code><span class="koboSpan" id="kobo.802.1"> folder, and the filename is usually </span><code class="inlineCode"><span class="koboSpan" id="kobo.803.1">test-setup.ts</span></code><span class="koboSpan" id="kobo.804.1">. </span><span class="koboSpan" id="kobo.804.2">One of the common approaches to define global mocks is to create a new file containing the mocks and then import it into the </span><code class="inlineCode"><span class="koboSpan" id="kobo.805.1">test-setup.ts</span></code><span class="koboSpan" id="kobo.806.1"> file.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.807.1">Notice that we use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.808.1">Object.defineProperty</span></code><span class="koboSpan" id="kobo.809.1"> method in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.810.1">window</span></code><span class="koboSpan" id="kobo.811.1"> object to provide a mock implementation for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.812.1">LocalStorage</span></code><span class="koboSpan" id="kobo.813.1"> object, and we do similar for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.814.1">window.alert</span></code><span class="koboSpan" id="kobo.815.1"> mock. </span><span class="koboSpan" id="kobo.815.2">This is actually</span><a id="_idIndexMarker786"/><span class="koboSpan" id="kobo.816.1"> the same for any API that is not implemented in the </span><strong class="keyWord"><span class="koboSpan" id="kobo.817.1">JSDOM</span></strong><span class="koboSpan" id="kobo.818.1">(</span><strong class="keyWord"><span class="koboSpan" id="kobo.819.1">JavaScript Document Object Model</span></strong><span class="koboSpan" id="kobo.820.1">). </span><span class="koboSpan" id="kobo.820.2">Similarly, you can provide a global mock for each API that you use in your tests. </span><span class="koboSpan" id="kobo.820.3">Notice that in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.821.1">value</span></code><span class="koboSpan" id="kobo.822.1"> property, we create a new instance of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.823.1">LocalStorageMock</span></code><span class="koboSpan" id="kobo.824.1"> class using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.825.1">new</span></code><span class="koboSpan" id="kobo.826.1"> keyword. </span><span class="koboSpan" id="kobo.826.2">Essentially, this is one way to define mocks. </span><span class="koboSpan" id="kobo.826.3">We create the </span><code class="inlineCode"><span class="koboSpan" id="kobo.827.1">LocalStorageMock</span></code><span class="koboSpan" id="kobo.828.1"> class, and in that, we have a private property named </span><code class="inlineCode"><span class="koboSpan" id="kobo.829.1">storage</span></code><span class="koboSpan" id="kobo.830.1"> that mimics the </span><code class="inlineCode"><span class="koboSpan" id="kobo.831.1">localStorage</span></code><span class="koboSpan" id="kobo.832.1"> object. </span><span class="koboSpan" id="kobo.832.2">We have also defined the </span><code class="inlineCode"><span class="koboSpan" id="kobo.833.1">getItem</span></code><span class="koboSpan" id="kobo.834.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.835.1">setItem</span></code><span class="koboSpan" id="kobo.836.1"> methods in there so that we can set values to this storage and get values from it. </span><span class="koboSpan" id="kobo.836.2">Notice that we do not have the implementations of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.837.1">removeItem</span></code><span class="koboSpan" id="kobo.838.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.839.1">clear</span></code><span class="koboSpan" id="kobo.840.1"> methods that we have in the actual </span><code class="inlineCode"><span class="koboSpan" id="kobo.841.1">localStorage</span></code><span class="koboSpan" id="kobo.842.1"> API. </span><span class="koboSpan" id="kobo.842.2">We don’t have to have them because we’re not using these methods in our actual code.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.843.1">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.844.1">should call the localStorage.getItem method on component init</span></code><span class="koboSpan" id="kobo.845.1"> test, we simply spy on the </span><code class="inlineCode"><span class="koboSpan" id="kobo.846.1">localStorage</span></code><span class="koboSpan" id="kobo.847.1"> object’s </span><code class="inlineCode"><span class="koboSpan" id="kobo.848.1">getItem</span></code><span class="koboSpan" id="kobo.849.1"> method, call the </span><code class="inlineCode"><span class="koboSpan" id="kobo.850.1">ngOnInit</span></code><span class="koboSpan" id="kobo.851.1"> method ourselves, and then expect it to have been called. </span><em class="italic"><span class="koboSpan" id="kobo.852.1">Easy peasy!</span></em></p>
<p class="normal"><span class="koboSpan" id="kobo.853.1">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.854.1">should retrieve the last saved value from localStorage on component init</span></code><span class="koboSpan" id="kobo.855.1"> test, we save a value </span><a id="_idIndexMarker787"/><span class="koboSpan" id="kobo.856.1">in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.857.1">localStorage</span></code><span class="koboSpan" id="kobo.858.1"> object for the counter value as </span><code class="inlineCode"><span class="koboSpan" id="kobo.859.1">12</span></code><span class="koboSpan" id="kobo.860.1">, using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.861.1">setItem</span></code><span class="koboSpan" id="kobo.862.1"> method. </span><span class="koboSpan" id="kobo.862.2">Essentially, calling</span><a id="_idIndexMarker788"/><span class="koboSpan" id="kobo.863.1"> the </span><code class="inlineCode"><span class="koboSpan" id="kobo.864.1">setItem</span></code><span class="koboSpan" id="kobo.865.1"> method calls our mock implementation method and not the actual </span><code class="inlineCode"><span class="koboSpan" id="kobo.866.1">localStorage</span></code><span class="koboSpan" id="kobo.867.1"> API’s </span><code class="inlineCode"><span class="koboSpan" id="kobo.868.1">setItem</span></code><span class="koboSpan" id="kobo.869.1"> method. </span><span class="koboSpan" id="kobo.869.2">Notice that, here, we </span><em class="italic"><span class="koboSpan" id="kobo.870.1">do not</span></em><span class="koboSpan" id="kobo.871.1"> spy on the </span><code class="inlineCode"><span class="koboSpan" id="kobo.872.1">getItem</span></code><span class="koboSpan" id="kobo.873.1"> method; this is because, later on, we want the value of the component’s </span><code class="inlineCode"><span class="koboSpan" id="kobo.874.1">counter</span></code><span class="koboSpan" id="kobo.875.1"> property to be </span><code class="inlineCode"><span class="koboSpan" id="kobo.876.1">12</span></code><span class="koboSpan" id="kobo.877.1">.</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.878.1">IMPORTANT NOTE</span></p>
<p class="normal"><span class="koboSpan" id="kobo.879.1">Whenever we spy on a method, remember that any statements in the actual function will no longer be executed. </span><span class="koboSpan" id="kobo.879.2">This is why we do not spy on the </span><code class="inlineCode"><span class="koboSpan" id="kobo.880.1">getItem</span></code><span class="koboSpan" id="kobo.881.1"> method in the preceding test. </span><span class="koboSpan" id="kobo.881.2">If we do so, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.882.1">getItem</span></code><span class="koboSpan" id="kobo.883.1"> method from the mock implementation will not return anything. </span><span class="koboSpan" id="kobo.883.2">Therefore, our expected value for the counter property will not be </span><code class="inlineCode"><span class="koboSpan" id="kobo.884.1">12</span></code><span class="koboSpan" id="kobo.885.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.886.1">Put simply, if you have to rely on the outcome of a function’s implementation, or the statements executed within a function, do not spy on that function and replace such a function with </span><code class="inlineCode"><span class="koboSpan" id="kobo.887.1">jest.fn().mockReturnValue(123);</span></code><span class="koboSpan" id="kobo.888.1">. </span><span class="koboSpan" id="kobo.888.2">This ensures we can check if the function is called but also with a return value that can be used by the actual code.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.889.1">PS: I always end up learning this the hard way after debugging and bashing my head for a while.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.890.1">The final test is an easy one. </span><span class="koboSpan" id="kobo.890.2">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.891.1">should save the new counterValue to localStorage on increment, decrement and reset</span></code><span class="koboSpan" id="kobo.892.1"> test, we spy on the </span><code class="inlineCode"><span class="koboSpan" id="kobo.893.1">setItem</span></code><span class="koboSpan" id="kobo.894.1"> method. </span><span class="koboSpan" id="kobo.894.2">Then, we manually set the value of the counter property each time before we run the </span><code class="inlineCode"><span class="koboSpan" id="kobo.895.1">increment</span></code><span class="koboSpan" id="kobo.896.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.897.1">decrement</span></code><span class="koboSpan" id="kobo.898.1">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.899.1">reset</span></code><span class="koboSpan" id="kobo.900.1"> methods respectively. </span><span class="koboSpan" id="kobo.900.2">Additionally, we expect the </span><code class="inlineCode"><span class="koboSpan" id="kobo.901.1">setItem</span></code><span class="koboSpan" id="kobo.902.1"> method to have been called with the right arguments to save the value to the store. </span><span class="koboSpan" id="kobo.902.2">Note that we do not check the store’s value after saving it. </span><span class="koboSpan" id="kobo.902.3">As I mentioned earlier, since we have spied on the </span><code class="inlineCode"><span class="koboSpan" id="kobo.903.1">setItem</span></code><span class="koboSpan" id="kobo.904.1"> method, its internal statement won’t trigger and the value won’t be saved; therefore, we can’t retrieve</span><a id="_idIndexMarker789"/><span class="koboSpan" id="kobo.905.1"> the saved value </span><a id="_idIndexMarker790"/><span class="koboSpan" id="kobo.906.1">afterward.</span></p>
<h2 class="heading-2" id="_idParaDest-344"><span class="koboSpan" id="kobo.907.1">See also</span></h2>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.908.1">The Jest documentation</span><a id="_idIndexMarker791"/><span class="koboSpan" id="kobo.909.1"> for </span><code class="inlineCode"><span class="koboSpan" id="kobo.910.1">setupFiles</span></code><span class="koboSpan" id="kobo.911.1">: </span><a href="https://jestjs.io/docs/en/configuration#setupfiles-array"><span class="url"><span class="koboSpan" id="kobo.912.1">https://jestjs.io/docs/en/configuration#setupfiles-array</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.913.1">Manual Mocks</span><a id="_idIndexMarker792"/><span class="koboSpan" id="kobo.914.1"> with Jest: </span><a href="https://jestjs.io/docs/en/manual-mocks"><span class="url"><span class="koboSpan" id="kobo.915.1">https://jestjs.io/docs/en/manual-mocks</span></span></a></li>
</ul>
<h1 class="heading-1" id="_idParaDest-345"><span class="koboSpan" id="kobo.916.1">Mocking Angular services using stubs</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.917.1">There’s rarely an Angular app</span><a id="_idIndexMarker793"/><span class="koboSpan" id="kobo.918.1"> that doesn’t have a </span><strong class="keyWord"><span class="koboSpan" id="kobo.919.1">Service</span></strong><span class="koboSpan" id="kobo.920.1"> created inside it. </span><span class="koboSpan" id="kobo.920.2">And where overall</span><a id="_idIndexMarker794"/><span class="koboSpan" id="kobo.921.1"> business logic is concerned, services hold a great deal, particularly when it comes to interacting with APIs. </span><span class="koboSpan" id="kobo.921.2">In this recipe, you’ll learn how to mock services using stubs.</span></p>
<h2 class="heading-2" id="_idParaDest-346"><span class="koboSpan" id="kobo.922.1">Getting ready</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.923.1">The app that we are going to work with now resides in </span><code class="inlineCode"><span class="koboSpan" id="kobo.924.1">start/apps/chapter10/ng-test-services-stubs</span></code><span class="koboSpan" id="kobo.925.1"> inside the cloned repository:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.926.1">Open the code repository in your code editor.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.927.1">Open the terminal, navigate to the code repository directory, and run the following command to serve the project:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.928.1">npm run serve ng-test-services-stubs
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.929.1">This should open the app in a new browser tab, and you should see the following:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.930.1"><img alt="" role="presentation" src="../Images/B18469_10_06.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.931.1">Figure 10.6: The ng-test-services-stubs app running on http://localhost:4200</span></p> </li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.932.1">Now that we have the app running</span><a id="_idIndexMarker795"/><span class="koboSpan" id="kobo.933.1"> locally, in the next section, let’s take a look </span><a id="_idIndexMarker796"/><span class="koboSpan" id="kobo.934.1">at the steps of the recipe.</span></p>
<h2 class="heading-2" id="_idParaDest-347"><span class="koboSpan" id="kobo.935.1">How to do it...</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.936.1">We have the same application as the previous recipe; however, we’ve moved the logic of saving and retrieving data from </span><code class="inlineCode"><span class="koboSpan" id="kobo.937.1">localStorage</span></code><span class="koboSpan" id="kobo.938.1"> to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.939.1">CounterService</span></code><span class="koboSpan" id="kobo.940.1"> we’ve created. </span><span class="koboSpan" id="kobo.940.2">Now, all the tests are passing. </span><span class="koboSpan" id="kobo.940.3">However, what if we wanted to hide/encapsulate the logic of where the counter value is stored? </span><span class="koboSpan" id="kobo.940.4">Perhaps we want to send a backend API call for it. </span><span class="koboSpan" id="kobo.940.5">To do this, it makes more sense to test that our </span><code class="inlineCode"><span class="koboSpan" id="kobo.941.1">CounterService</span></code><span class="koboSpan" id="kobo.942.1">'s methods are being called instead of checking </span><code class="inlineCode"><span class="koboSpan" id="kobo.943.1">localStorage</span></code><span class="koboSpan" id="kobo.944.1"> methods. </span><span class="koboSpan" id="kobo.944.2">Let’s follow the recipe to provide a mock stub for our service:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.945.1">First, let’s create a folder inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.946.1">src</span></code><span class="koboSpan" id="kobo.947.1"> folder, named </span><code class="inlineCode"><span class="koboSpan" id="kobo.948.1">__mocks__</span></code><span class="koboSpan" id="kobo.949.1">. </span><span class="koboSpan" id="kobo.949.2">Inside it, create another folder named </span><code class="inlineCode"><span class="koboSpan" id="kobo.950.1">services</span></code><span class="koboSpan" id="kobo.951.1">. </span><span class="koboSpan" id="kobo.951.2">Then, again inside this folder, create the </span><code class="inlineCode"><span class="koboSpan" id="kobo.952.1">counter.service.mock.ts</span></code><span class="koboSpan" id="kobo.953.1"> file with the following content:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.954.1">import</span></span><span class="koboSpan" id="kobo.955.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.956.1">CounterService</span></span><span class="koboSpan" id="kobo.957.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.958.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.959.1">"../../app/services/counter.service"</span></span><span class="koboSpan" id="kobo.960.1">; 
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.961.1">const</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.962.1">counterServiceMock</span></span><span class="koboSpan" id="kobo.963.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.964.1">CounterService</span></span><span class="koboSpan" id="kobo.965.1"> = {
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.966.1">storageKey</span></span><span class="koboSpan" id="kobo.967.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.968.1">'counterValue'</span></span><span class="koboSpan" id="kobo.969.1">,
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.970.1">getFromStorage</span></span><span class="koboSpan" id="kobo.971.1">: jest.</span><span class="hljs-title"><span class="koboSpan" id="kobo.972.1">fn</span></span><span class="koboSpan" id="kobo.973.1">(),
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.974.1">saveToStorage</span></span><span class="koboSpan" id="kobo.975.1">: jest.</span><span class="hljs-title"><span class="koboSpan" id="kobo.976.1">fn</span></span><span class="koboSpan" id="kobo.977.1">(),
};
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.978.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.979.1">default</span></span><span class="koboSpan" id="kobo.980.1"> counterServiceMock;
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.981.1">Now, provide the mock service</span><a id="_idIndexMarker797"/><span class="koboSpan" id="kobo.982.1"> instead of the actual service</span><a id="_idIndexMarker798"/><span class="koboSpan" id="kobo.983.1"> in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.984.1">counter.component.spec.ts</span></code><span class="koboSpan" id="kobo.985.1">, as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.986.1">...
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.987.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.988.1"> { </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.989.1">CounterService</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.990.1"> } </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.991.1">from</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.992.1">'../services/counter.service'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.993.1">;</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.994.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.995.1"> counterServiceMock </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.996.1">from</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.997.1">'../../__mocks__/services/counter.service.mock'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.998.1">;</span></strong></span>
<span class="hljs-title"><span class="koboSpan" id="kobo.999.1">describe</span></span><span class="koboSpan" id="kobo.1000.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1001.1">'CounterComponent'</span></span><span class="koboSpan" id="kobo.1002.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.1003.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1004.1"> {
  ...
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.1005.1">beforeEach</span></span><span class="koboSpan" id="kobo.1006.1">(</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1007.1">async</span></span><span class="koboSpan" id="kobo.1008.1"> () =&gt; {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1009.1">await</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1010.1">TestBed</span></span><span class="koboSpan" id="kobo.1011.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1012.1">configureTestingModule</span></span><span class="koboSpan" id="kobo.1013.1">({
      </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1014.1">imports</span></span><span class="koboSpan" id="kobo.1015.1">: [</span><span class="hljs-title"><span class="koboSpan" id="kobo.1016.1">CounterComponent</span></span><span class="koboSpan" id="kobo.1017.1">]</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1018.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1019.1">providers</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1020.1">: [{</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1021.1">provide</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1022.1">: </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1023.1">CounterService</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1024.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1025.1">useValue</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1026.1">: counterServiceMock</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1027.1">}]</span></strong></span><span class="koboSpan" id="kobo.1028.1">
    }).</span><span class="hljs-title"><span class="koboSpan" id="kobo.1029.1">compileComponents</span></span><span class="koboSpan" id="kobo.1030.1">();
  });
  ...
</span><span class="koboSpan" id="kobo.1030.2">});
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1031.1">With the preceding change, you should see the following error that says the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1032.1">localStorage.getItem</span></code><span class="koboSpan" id="kobo.1033.1"> hasn’t been called. </span><span class="koboSpan" id="kobo.1033.2">This is because we’re now spying on the methods on our mock stub for the service:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1034.1"><img alt="" role="presentation" src="../Images/B18469_10_07.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1035.1">Figure 10.7: localStorage.getItem is not called because of the methods being spied on</span></p> </li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="3"><span class="koboSpan" id="kobo.1036.1">Now, instead of expecting the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1037.1">localStorage</span></code><span class="koboSpan" id="kobo.1038.1"> object’s methods to be called, let’s expect our service’s methods</span><a id="_idIndexMarker799"/><span class="koboSpan" id="kobo.1039.1"> to be called in our tests. </span><span class="koboSpan" id="kobo.1039.2">Update</span><a id="_idIndexMarker800"/><span class="koboSpan" id="kobo.1040.1"> the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1041.1">counter.component.spec.ts</span></code><span class="koboSpan" id="kobo.1042.1"> file using the snippet at </span><a href="https://ng-cookbook.com/s/services-stub-tests"><span class="url"><span class="koboSpan" id="kobo.1043.1">https://ng-cookbook.com/s/services-stub-tests</span></span></a><span class="koboSpan" id="kobo.1044.1"> to replace all the tests below the following comment:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1045.1">...
</span><span class="hljs-title"><span class="koboSpan" id="kobo.1046.1">describe</span></span><span class="koboSpan" id="kobo.1047.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1048.1">'CounterComponent'</span></span><span class="koboSpan" id="kobo.1049.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.1050.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1051.1"> {
  ...
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.1052.1">// replace the tests below</span></strong></span><span class="koboSpan" id="kobo.1053.1">
});
</span></code></pre>
</li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.1054.1">Great! </span><span class="koboSpan" id="kobo.1054.2">You now know how to mock services to test components with service dependencies. </span><span class="koboSpan" id="kobo.1054.3">Please refer to the next section to understand how it all works.</span></p>
<h2 class="heading-2" id="_idParaDest-348"><span class="koboSpan" id="kobo.1055.1">How it works...</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1056.1">Providing stubs for Angular services is already a breeze. </span><span class="koboSpan" id="kobo.1056.2">This is thanks to Angular’s out-of-the-box methods and tooling from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1057.1">@angular/core</span></code><span class="koboSpan" id="kobo.1058.1"> package, especially </span><code class="inlineCode"><span class="koboSpan" id="kobo.1059.1">@angular/core/testing</span></code><span class="koboSpan" id="kobo.1060.1">. </span><span class="koboSpan" id="kobo.1060.2">First, we create the stub for our </span><code class="inlineCode"><span class="koboSpan" id="kobo.1061.1">CounterService</span></code><span class="koboSpan" id="kobo.1062.1"> and use </span><code class="inlineCode"><span class="koboSpan" id="kobo.1063.1">jest.fn</span></code><span class="koboSpan" id="kobo.1064.1"> for every method within </span><code class="inlineCode"><span class="koboSpan" id="kobo.1065.1">CounterService</span></code><span class="koboSpan" id="kobo.1066.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1067.1">Calling </span><code class="inlineCode"><span class="koboSpan" id="kobo.1068.1">jest.fn</span></code><span class="koboSpan" id="kobo.1069.1"> returns a new, unused mock function that Jest automatically spies upon as well. </span><span class="koboSpan" id="kobo.1069.2">Optionally, we can also pass a mock implementation method as a parameter for </span><code class="inlineCode"><span class="koboSpan" id="kobo.1070.1">jest.fn</span></code><span class="koboSpan" id="kobo.1071.1">. </span><span class="koboSpan" id="kobo.1071.2">View the following example from the official documentation for </span><code class="inlineCode"><span class="koboSpan" id="kobo.1072.1">jest.fn</span></code><span class="koboSpan" id="kobo.1073.1">:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1074.1">const</span></span><span class="koboSpan" id="kobo.1075.1"> mockFn = jest.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1076.1">fn</span></span><span class="koboSpan" id="kobo.1077.1">();
</span><span class="hljs-title"><span class="koboSpan" id="kobo.1078.1">mockFn</span></span><span class="koboSpan" id="kobo.1079.1">();
</span><span class="hljs-title"><span class="koboSpan" id="kobo.1080.1">expect</span></span><span class="koboSpan" id="kobo.1081.1">(mockFn).</span><span class="hljs-title"><span class="koboSpan" id="kobo.1082.1">toHaveBeenCalled</span></span><span class="koboSpan" id="kobo.1083.1">(); </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1084.1">// test passes</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.1085.1">// With a mock implementation:</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1086.1">const</span></span><span class="koboSpan" id="kobo.1087.1"> returnsTrue = jest.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1088.1">fn</span></span><span class="koboSpan" id="kobo.1089.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.1090.1">() =&gt;</span></span> <span class="hljs-literal"><span class="koboSpan" id="kobo.1091.1">true</span></span><span class="koboSpan" id="kobo.1092.1">);
</span><span class="hljs-variable"><span class="koboSpan" id="kobo.1093.1">console</span></span><span class="koboSpan" id="kobo.1094.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1095.1">log</span></span><span class="koboSpan" id="kobo.1096.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.1097.1">returnsTrue</span></span><span class="koboSpan" id="kobo.1098.1">()); </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1099.1">// true;</span></span>
<span class="hljs-title"><span class="koboSpan" id="kobo.1100.1">expect</span></span><span class="koboSpan" id="kobo.1101.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.1102.1">returnsTrue</span></span><span class="koboSpan" id="kobo.1103.1">()).</span><span class="hljs-title"><span class="koboSpan" id="kobo.1104.1">toBe</span></span><span class="koboSpan" id="kobo.1105.1">(</span><span class="hljs-literal"><span class="koboSpan" id="kobo.1106.1">true</span></span><span class="koboSpan" id="kobo.1107.1">); </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1108.1">// test passes</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1109.1">Once we create the stub, we pass</span><a id="_idIndexMarker801"/><span class="koboSpan" id="kobo.1110.1"> it to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1111.1">TestBed</span></code><span class="koboSpan" id="kobo.1112.1"> configuration in the</span><a id="_idIndexMarker802"/><span class="koboSpan" id="kobo.1113.1"> provider’s array against the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1114.1">CounterService</span></code><span class="koboSpan" id="kobo.1115.1"> – but with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1116.1">useValue</span></code><span class="koboSpan" id="kobo.1117.1"> property set to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1118.1">counterServiceMock</span></code><span class="koboSpan" id="kobo.1119.1">. </span><span class="koboSpan" id="kobo.1119.2">This tells Angular to use our stub as it is for </span><code class="inlineCode"><span class="koboSpan" id="kobo.1120.1">CounterService</span></code><span class="koboSpan" id="kobo.1121.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1122.1">Then, in the test where we expect </span><code class="inlineCode"><span class="koboSpan" id="kobo.1123.1">CounterService.getFromStorage</span></code><span class="koboSpan" id="kobo.1124.1"> method to be called when the component initiates, we use the following statement:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.1125.1">expect</span></span><span class="koboSpan" id="kobo.1126.1">(counterServiceMock.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1127.1">getFromStorage</span></span><span class="koboSpan" id="kobo.1128.1">).</span><span class="hljs-title"><span class="koboSpan" id="kobo.1129.1">toBeCalled</span></span><span class="koboSpan" id="kobo.1130.1">();
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1131.1">Notice that in the preceding code, we are able to directly use </span><code class="inlineCode"><span class="koboSpan" id="kobo.1132.1">expect</span></code><span class="koboSpan" id="kobo.1133.1"> on </span><code class="inlineCode"><span class="koboSpan" id="kobo.1134.1">counterServiceMock.getFromStorage</span></code><span class="koboSpan" id="kobo.1135.1">. </span><span class="koboSpan" id="kobo.1135.2">While this isn’t possible in Karma and Jasmine, it is possible with Jest, since we’re using </span><code class="inlineCode"><span class="koboSpan" id="kobo.1136.1">jest.fn</span></code><span class="koboSpan" id="kobo.1137.1"> for each underlying method.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1138.1">Then, for a test in which we want to check whether the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1139.1">getFromStorage</span></code><span class="koboSpan" id="kobo.1140.1"> method is called and returns a saved value, we first use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1141.1">counterServiceMock.getFromStorage.mockReturnValue(12);</span></code><span class="koboSpan" id="kobo.1142.1"> statement. </span><span class="koboSpan" id="kobo.1142.2">This ensures that when the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1143.1">getFromStorage</span></code><span class="koboSpan" id="kobo.1144.1"> method is called, it returns the value of </span><code class="inlineCode"><span class="koboSpan" id="kobo.1145.1">12</span></code><span class="koboSpan" id="kobo.1146.1">. </span><span class="koboSpan" id="kobo.1146.2">Then, we just run the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1147.1">ngOnInit</span></code><span class="koboSpan" id="kobo.1148.1"> method in the test and expect that our component’s counter property has now been set to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1149.1">12</span></code><span class="koboSpan" id="kobo.1150.1">. </span><span class="koboSpan" id="kobo.1150.2">This means that the following things happen:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><code class="inlineCode"><span class="koboSpan" id="kobo.1151.1">ngOnInit</span></code><span class="koboSpan" id="kobo.1152.1"> calls the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1153.1">getFromStorage</span></code><span class="koboSpan" id="kobo.1154.1"> method.</span></li>
<li class="numberedList"><code class="inlineCode"><span class="koboSpan" id="kobo.1155.1">getFromStorage</span></code><span class="koboSpan" id="kobo.1156.1"> returns the previously saved value (in our case, that’s </span><code class="inlineCode"><span class="koboSpan" id="kobo.1157.1">12</span></code><span class="koboSpan" id="kobo.1158.1">, but in reality, it’ll be fetched from </span><code class="inlineCode"><span class="koboSpan" id="kobo.1159.1">localStorage</span></code><span class="koboSpan" id="kobo.1160.1">).</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1161.1">The component’s counter property is set to the retrieved value, which, in our case, is </span><code class="inlineCode"><span class="koboSpan" id="kobo.1162.1">12</span></code><span class="koboSpan" id="kobo.1163.1">.</span></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.1164.1">Now, for the final test, we just expect that the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1165.1">saveToStorage</span></code><span class="koboSpan" id="kobo.1166.1"> method of our </span><code class="inlineCode"><span class="koboSpan" id="kobo.1167.1">CounterService</span></code><span class="koboSpan" id="kobo.1168.1"> is called in each necessary case. </span><span class="koboSpan" id="kobo.1168.2">For this, we use the following types of </span><code class="inlineCode"><span class="koboSpan" id="kobo.1169.1">expect</span></code><span class="koboSpan" id="kobo.1170.1"> statements:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.1171.1">expect</span></span><span class="koboSpan" id="kobo.1172.1">(counterServiceMock.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1173.1">saveToStorage</span></span><span class="koboSpan" id="kobo.1174.1">).</span><span class="hljs-title"><span class="koboSpan" id="kobo.1175.1">toHaveBeenCalledWith</span></span><span class="koboSpan" id="kobo.1176.1">(</span><span class="hljs-number"><span class="koboSpan" id="kobo.1177.1">1</span></span><span class="koboSpan" id="kobo.1178.1">);
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1179.1">That’s pretty much about it. </span><span class="koboSpan" id="kobo.1179.2">Unit tests are fun, aren’t they? </span><span class="koboSpan" id="kobo.1179.3">Now that you’ve understood how it all works, please refer to the next section</span><a id="_idIndexMarker803"/><span class="koboSpan" id="kobo.1180.1"> for some helpful resources that you can use</span><a id="_idIndexMarker804"/><span class="koboSpan" id="kobo.1181.1"> for further reading.</span></p>
<h2 class="heading-2" id="_idParaDest-349"><span class="koboSpan" id="kobo.1182.1">See also</span></h2>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.1183.1">The official documentation</span><a id="_idIndexMarker805"/><span class="koboSpan" id="kobo.1184.1"> for </span><code class="inlineCode"><span class="koboSpan" id="kobo.1185.1">jest.fn</span></code><span class="koboSpan" id="kobo.1186.1">: </span><a href="https://jestjs.io/docs/en/jest-object.html#jestfnimplementation"><span class="url"><span class="koboSpan" id="kobo.1187.1">https://jestjs.io/docs/en/jest-object.html#jestfnimplementation</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1188.1">Angular’s</span><a id="_idIndexMarker806"/> <em class="italic"><span class="koboSpan" id="kobo.1189.1">Component testing scenarios</span></em><span class="koboSpan" id="kobo.1190.1">: </span><a href="https://angular.io/guide/testing-components-scenarios"><span class="url"><span class="koboSpan" id="kobo.1191.1">https://angular.io/guide/testing-components-scenarios</span></span></a></li>
</ul>
<h1 class="heading-1" id="_idParaDest-350"><span class="koboSpan" id="kobo.1192.1">Using spies on an injected service in a unit test</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1193.1">While you can provide stubs</span><a id="_idIndexMarker807"/><span class="koboSpan" id="kobo.1194.1"> for your services in the unit tests with Jest, sometimes, it might</span><a id="_idIndexMarker808"/><span class="koboSpan" id="kobo.1195.1"> feel like an overhead creating a mock for every new service. </span><span class="koboSpan" id="kobo.1195.2">Let’s suppose that if the service’s usage is limited to one test file, it might make more sense to just use spies on the actual injected service. </span><span class="koboSpan" id="kobo.1195.3">In this recipe, that’s exactly what we’re going to do.</span></p>
<h2 class="heading-2" id="_idParaDest-351"><span class="koboSpan" id="kobo.1196.1">Getting ready</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1197.1">The app that we are going to work with now resides in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1198.1">start/apps/chapter10/ng-test-services</span></code><span class="koboSpan" id="kobo.1199.1"> inside the cloned repository:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1200.1">Open the code repository in your code editor.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1201.1">Open the terminal, navigate to the code repository directory, and run the following command to serve the project:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1202.1">npm run serve ng-test-services
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1203.1">This should open the app in a new browser tab, and you should see the following:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1204.1"><img alt="" role="presentation" src="../Images/B18469_10_08.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1205.1">Figure 10.8: ng-test-services app running on http://localhost:4200</span></p> </li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.1206.1">Now that we have the app running, in the next section, let’s go through the steps of the recipe.</span></p>
<h2 class="heading-2" id="_idParaDest-352"><span class="koboSpan" id="kobo.1207.1">How to do it...</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1208.1">We have an application</span><a id="_idIndexMarker809"/><span class="koboSpan" id="kobo.1209.1"> that has a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1210.1">Counter</span></code><span class="koboSpan" id="kobo.1211.1"> component. </span><span class="koboSpan" id="kobo.1211.2">We can increment, decrement, and reset </span><a id="_idIndexMarker810"/><span class="koboSpan" id="kobo.1212.1">the counter, and the value for the counter changes. </span><span class="koboSpan" id="kobo.1212.2">The value is also stored in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1213.1">localStorage</span></code><span class="koboSpan" id="kobo.1214.1">. </span><span class="koboSpan" id="kobo.1214.2">We have the logic of saving and retrieving data from </span><code class="inlineCode"><span class="koboSpan" id="kobo.1215.1">localStorage</span></code><span class="koboSpan" id="kobo.1216.1"> to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1217.1">CounterService</span></code><span class="koboSpan" id="kobo.1218.1">. </span><span class="koboSpan" id="kobo.1218.2">Now, all the tests are passing, but we are checking the values in our tests directly from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1219.1">localStorage</span></code><span class="koboSpan" id="kobo.1220.1">. </span><span class="koboSpan" id="kobo.1220.2">What if we decided to change the logic of where the counter value is stored? </span><span class="koboSpan" id="kobo.1220.3">Perhaps we want to send a backend API call for it. </span><span class="koboSpan" id="kobo.1220.4">To do this, it makes more sense to test that our </span><code class="inlineCode"><span class="koboSpan" id="kobo.1221.1">CounterService</span></code><span class="koboSpan" id="kobo.1222.1">'s methods are being called instead of checking </span><code class="inlineCode"><span class="koboSpan" id="kobo.1223.1">localStorage</span></code><span class="koboSpan" id="kobo.1224.1"> methods. </span><span class="koboSpan" id="kobo.1224.2">However, unlike the previous recipe, where we provided stubs for our services, we’re going to inject the service directly and will create jest spies for the functions from the Angular Service that we want to ensure are being called. </span><span class="koboSpan" id="kobo.1224.3">Let’s follow the recipe to do that:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1225.1">Open the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1226.1">counter.component.spec.ts</span></code><span class="koboSpan" id="kobo.1227.1"> file. </span><span class="koboSpan" id="kobo.1227.2">You’ll see a comment that says </span><code class="inlineCode"><span class="koboSpan" id="kobo.1228.1">// replace the tests below</span></code><span class="koboSpan" id="kobo.1229.1">. </span><span class="koboSpan" id="kobo.1229.2">Let’s replace the first test </span><code class="inlineCode"><span class="koboSpan" id="kobo.1230.1">should call the localStorage.getItem method on component init</span></code><span class="koboSpan" id="kobo.1231.1"> below that comment with the following:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.1232.1">it</span></span><span class="koboSpan" id="kobo.1233.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1234.1">' should get counter from storage on component init'</span></span><span class="koboSpan" id="kobo.1235.1">,
</span><span class="hljs-title"> </span> <span class="hljs-function"><span class="koboSpan" id="kobo.1236.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1237.1"> {
    jest.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1238.1">spyOn</span></span><span class="koboSpan" id="kobo.1239.1">(component.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1240.1">counterService</span></span><span class="koboSpan" id="kobo.1241.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.1242.1">'getFromStorage'</span></span><span class="koboSpan" id="kobo.1243.1">);
    component.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1244.1">ngOnInit</span></span><span class="koboSpan" id="kobo.1245.1">();
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1246.1">expect</span></span><span class="koboSpan" id="kobo.1247.1">(component.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1248.1">counterService</span></span><span class="koboSpan" id="kobo.1249.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1250.1">getFromStorage</span></span><span class="koboSpan" id="kobo.1251.1">)
</span><span class="hljs-title"> </span><span class="koboSpan" id="kobo.1252.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1253.1">toHaveBeenCalled</span></span><span class="koboSpan" id="kobo.1254.1">();
  });
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1255.1">If you run </span><code class="inlineCode"><span class="koboSpan" id="kobo.1256.1">npm run test</span></code><span class="koboSpan" id="kobo.1257.1"> again, you should still see all the tests passing.</span></p></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="2"><span class="koboSpan" id="kobo.1258.1">Now, let’s replace the test</span><a id="_idIndexMarker811"/><span class="koboSpan" id="kobo.1259.1"> that says </span><code class="inlineCode"><span class="koboSpan" id="kobo.1260.1">should retrieve the last saved value from localStorage on component init</span></code><span class="koboSpan" id="kobo.1261.1"> with the following</span><a id="_idIndexMarker812"/><span class="koboSpan" id="kobo.1262.1"> test:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.1263.1">it</span></span><span class="koboSpan" id="kobo.1264.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1265.1">' should have the initial value of counter from storage</span></span>
<span class="hljs-title"> </span><span class="hljs-string"><span class="koboSpan" id="kobo.1266.1"> on component init '</span></span><span class="koboSpan" id="kobo.1267.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.1268.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1269.1"> {
    jest.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1270.1">spyOn</span></span><span class="koboSpan" id="kobo.1271.1">(component.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1272.1">counterService</span></span><span class="koboSpan" id="kobo.1273.1">,
      </span><span class="hljs-string"><span class="koboSpan" id="kobo.1274.1">'getFromStorage'</span></span><span class="koboSpan" id="kobo.1275.1">).</span><span class="hljs-title"><span class="koboSpan" id="kobo.1276.1">mockReturnValue</span></span><span class="koboSpan" id="kobo.1277.1">(</span><span class="hljs-number"><span class="koboSpan" id="kobo.1278.1">12</span></span><span class="koboSpan" id="kobo.1279.1">);
    component.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1280.1">ngOnInit</span></span><span class="koboSpan" id="kobo.1281.1">();
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1282.1">expect</span></span><span class="koboSpan" id="kobo.1283.1">(component.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1284.1">counter</span></span><span class="koboSpan" id="kobo.1285.1">).</span><span class="hljs-title"><span class="koboSpan" id="kobo.1286.1">toBe</span></span><span class="koboSpan" id="kobo.1287.1">(</span><span class="hljs-number"><span class="koboSpan" id="kobo.1288.1">12</span></span><span class="koboSpan" id="kobo.1289.1">);
  });
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1290.1">Finally, replace the last test that says </span><code class="inlineCode"><span class="koboSpan" id="kobo.1291.1">should save the new counterValue to localStorage on increment, decrement and reset</span></code><span class="koboSpan" id="kobo.1292.1"> with the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.1293.1">it</span></span><span class="koboSpan" id="kobo.1294.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1295.1">'should save the new counterValue on increment, decrement</span></span>
<span class="hljs-title"> </span><span class="hljs-string"><span class="koboSpan" id="kobo.1296.1"> and reset'</span></span><span class="koboSpan" id="kobo.1297.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.1298.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1299.1"> {
    jest.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1300.1">spyOn</span></span><span class="koboSpan" id="kobo.1301.1">(component.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1302.1">counterService</span></span><span class="koboSpan" id="kobo.1303.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.1304.1">'saveToStorage'</span></span><span class="koboSpan" id="kobo.1305.1">);
    component.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1306.1">counter</span></span><span class="koboSpan" id="kobo.1307.1"> = </span><span class="hljs-number"><span class="koboSpan" id="kobo.1308.1">0</span></span><span class="koboSpan" id="kobo.1309.1">;
    component.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1310.1">increment</span></span><span class="koboSpan" id="kobo.1311.1">();
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1312.1">expect</span></span><span class="koboSpan" id="kobo.1313.1">(component.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1314.1">counterService</span></span><span class="koboSpan" id="kobo.1315.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1316.1">saveToStorage</span></span><span class="koboSpan" id="kobo.1317.1">)
</span><span class="hljs-title"> </span><span class="koboSpan" id="kobo.1318.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1319.1">toHaveBeenCalledWith</span></span><span class="koboSpan" id="kobo.1320.1">(</span><span class="hljs-number"><span class="koboSpan" id="kobo.1321.1">1</span></span><span class="koboSpan" id="kobo.1322.1">);
    component.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1323.1">counter</span></span><span class="koboSpan" id="kobo.1324.1"> = </span><span class="hljs-number"><span class="koboSpan" id="kobo.1325.1">20</span></span><span class="koboSpan" id="kobo.1326.1">;
    component.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1327.1">decrement</span></span><span class="koboSpan" id="kobo.1328.1">();
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1329.1">expect</span></span><span class="koboSpan" id="kobo.1330.1">(component.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1331.1">counterService</span></span><span class="koboSpan" id="kobo.1332.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1333.1">saveToStorage</span></span><span class="koboSpan" id="kobo.1334.1">)
</span><span class="hljs-title"> </span><span class="koboSpan" id="kobo.1335.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1336.1">toHaveBeenCalledWith</span></span><span class="koboSpan" id="kobo.1337.1">(</span><span class="hljs-number"><span class="koboSpan" id="kobo.1338.1">19</span></span><span class="koboSpan" id="kobo.1339.1">);
    component.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1340.1">reset</span></span><span class="koboSpan" id="kobo.1341.1">();
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1342.1">expect</span></span><span class="koboSpan" id="kobo.1343.1">(component.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1344.1">counterService</span></span><span class="koboSpan" id="kobo.1345.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1346.1">saveToStorage</span></span><span class="koboSpan" id="kobo.1347.1">)
</span><span class="hljs-title"> </span><span class="koboSpan" id="kobo.1348.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1349.1">toHaveBeenCalledWith</span></span><span class="koboSpan" id="kobo.1350.1">(</span><span class="hljs-number"><span class="koboSpan" id="kobo.1351.1">0</span></span><span class="koboSpan" id="kobo.1352.1">);
  });
</span></code></pre>
</li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.1353.1">Awesome! </span><span class="koboSpan" id="kobo.1353.2">With this change, you should see all eight tests passing. </span><span class="koboSpan" id="kobo.1353.3">Let’s take a look at the next section to understand how it works.</span></p>
<h2 class="heading-2" id="_idParaDest-353"><span class="koboSpan" id="kobo.1354.1">How it works...</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1355.1">This recipe contained a lot of knowledge from the previous recipes of this chapter. </span><span class="koboSpan" id="kobo.1355.2">However, the key highlight is the fact that the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1356.1">CounterService</span></code><span class="koboSpan" id="kobo.1357.1"> class that is injected in the component can only be directly mocked using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1358.1">jest.spyOn</span></code><span class="koboSpan" id="kobo.1359.1"> method. </span><span class="koboSpan" id="kobo.1359.2">This method removes the need to mock every single service separately. </span><span class="koboSpan" id="kobo.1359.3">In the first (replaced) test, we spy on the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1360.1">getFromStorage</span></code><span class="koboSpan" id="kobo.1361.1"> method of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1362.1">component.counterService</span></code><span class="koboSpan" id="kobo.1363.1"> property. </span><span class="koboSpan" id="kobo.1363.2">This makes it a Jest spy that we can provide to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1364.1">expect</span></code><span class="koboSpan" id="kobo.1365.1"> block and that can run the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1366.1">expect(component.counterService.getFromStorage).toHaveBeenCalled();</span></code><span class="koboSpan" id="kobo.1367.1"> statement. </span><span class="koboSpan" id="kobo.1367.2">In the second test, notice that we not only spy on the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1368.1">getFromStorage</span></code><span class="koboSpan" id="kobo.1369.1"> method but also return a mock value, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1370.1">12</span></code><span class="koboSpan" id="kobo.1371.1">, so that when the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1372.1">component.ngOnInit</span></code><span class="koboSpan" id="kobo.1373.1"> method is called, the value returned from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1374.1">CounterService</span></code><span class="koboSpan" id="kobo.1375.1"> is this mocked value, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1376.1">12</span></code><span class="koboSpan" id="kobo.1377.1">. </span><span class="koboSpan" id="kobo.1377.2">Hence, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1378.1">counter</span></code><span class="koboSpan" id="kobo.1379.1"> property is set to 12 and the test passes.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1380.1">Finally, in the last test, we spy on the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1381.1">saveToStorage</span></code><span class="koboSpan" id="kobo.1382.1"> method. </span><span class="koboSpan" id="kobo.1382.2">Then, every time we click </span><code class="inlineCode"><span class="koboSpan" id="kobo.1383.1">Increment</span></code><span class="koboSpan" id="kobo.1384.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1385.1">Decrement</span></code><span class="koboSpan" id="kobo.1386.1">, or </span><code class="inlineCode"><span class="koboSpan" id="kobo.1387.1">Reset</span></code><span class="koboSpan" id="kobo.1388.1">, we expect</span><a id="_idIndexMarker813"/><span class="koboSpan" id="kobo.1389.1"> the spied function to be called</span><a id="_idIndexMarker814"/><span class="koboSpan" id="kobo.1390.1"> with the correct value. </span><em class="italic"><span class="koboSpan" id="kobo.1391.1">Easy peasy!</span></em></p>
<h2 class="heading-2" id="_idParaDest-354"><span class="koboSpan" id="kobo.1392.1">See also</span></h2>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.1393.1">Testing Angular</span><a id="_idIndexMarker815"/><span class="koboSpan" id="kobo.1394.1"> Services: </span><a href="https://angular.io/guide/testing-services"><span class="url"><span class="koboSpan" id="kobo.1395.1">https://angular.io/guide/testing-services</span></span></a></li>
</ul>
<h1 class="heading-1" id="_idParaDest-355"><span class="koboSpan" id="kobo.1396.1">Mocking child components and directives using the ng-mocks package</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1397.1">Unit tests mostly revolve around testing</span><a id="_idIndexMarker816"/><span class="koboSpan" id="kobo.1398.1"> components, directives, pipes, or services</span><a id="_idIndexMarker817"/><span class="koboSpan" id="kobo.1399.1"> in isolation. </span><span class="koboSpan" id="kobo.1399.2">However, what if your component depends completely on another component or directive to work properly, especially in a non-standalone application/component? </span><span class="koboSpan" id="kobo.1399.3">In such cases, you usually provide a mock implementation for the component, but that is a lot of work. </span><span class="koboSpan" id="kobo.1399.4">However, with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1400.1">ng-mocks</span></code><span class="koboSpan" id="kobo.1401.1"> package, it is super-easy. </span><span class="koboSpan" id="kobo.1401.2">In this recipe, we’ll learn an advanced example of how to use </span><code class="inlineCode"><span class="koboSpan" id="kobo.1402.1">ng-mocks</span></code><span class="koboSpan" id="kobo.1403.1"> for a parent component that depends on a child component to work properly.</span></p>
<h2 class="heading-2" id="_idParaDest-356"><span class="koboSpan" id="kobo.1404.1">Getting ready</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1405.1">The app that we are going to work</span><a id="_idIndexMarker818"/><span class="koboSpan" id="kobo.1406.1"> with now resides</span><a id="_idIndexMarker819"/><span class="koboSpan" id="kobo.1407.1"> in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1408.1">start/apps/chapter10/ng-test-ng-mocks</span></code><span class="koboSpan" id="kobo.1409.1"> inside the cloned repository:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1410.1">Open the code repository in your code editor.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1411.1">Open the terminal, navigate to the code repository directory, and run the following command to serve the project:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1412.1">npm run serve ng-test-ng-mocks
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1413.1">This should open the app in a new browser tab, and you should see the following:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1414.1"><img alt="" role="presentation" src="../Images/B18469_10_09.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1415.1">Figure 10.9: ng-test-ng-mocks app running on http://localhost:4200</span></p> </li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.1416.1">Now that we have the app running locally, in the next section, let’s go through the steps of the recipe.</span></p>
<h2 class="heading-2" id="_idParaDest-357"><span class="koboSpan" id="kobo.1417.1">How to do it...</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1418.1">If you run the command </span><code class="inlineCode"><span class="koboSpan" id="kobo.1419.1">npm run test ng-test-ng-mocks</span></code><span class="koboSpan" id="kobo.1420.1"> from the workspace root, you’ll see that not all of our tests pass. </span><span class="koboSpan" id="kobo.1420.2">Additionally, there are a bunch of errors on the console, as follows:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1421.1"><img alt="" role="presentation" src="../Images/B18469_10_10.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1422.1">Figure 10.10: Error during unit tests mentioning app-version-control component</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1423.1">Note that we are using an app with </span><code class="inlineCode"><span class="koboSpan" id="kobo.1424.1">NgModule</span></code><span class="koboSpan" id="kobo.1425.1">, i.e., </span><em class="italic"><span class="koboSpan" id="kobo.1426.1">not a standalone app</span></em><span class="koboSpan" id="kobo.1427.1">. </span><span class="koboSpan" id="kobo.1427.2">This is to demonstrate how to work in such situations. </span><span class="koboSpan" id="kobo.1427.3">Let’s go through the recipe to mock the respective components using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1428.1">ng-mocks</span></code><span class="koboSpan" id="kobo.1429.1"> package:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1430.1">First, let’s install the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1431.1">ng-mocks</span></code><span class="koboSpan" id="kobo.1432.1"> package</span><a id="_idIndexMarker820"/><span class="koboSpan" id="kobo.1433.1"> within our project. </span><span class="koboSpan" id="kobo.1433.2">To do this, run the following command from your project</span><a id="_idIndexMarker821"/><span class="koboSpan" id="kobo.1434.1"> root in the Terminal:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1435.1">cd start &amp;&amp; npm install ng-mocks --save
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1436.1">Now, we’ll try to fix the tests for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1437.1">App</span></code><span class="koboSpan" id="kobo.1438.1"> component. </span><span class="koboSpan" id="kobo.1438.2">To only run specific tests based on a string regex, we can use the -</span><code class="inlineCode"><span class="koboSpan" id="kobo.1439.1">t</span></code><span class="koboSpan" id="kobo.1440.1"> parameter with the test command. </span><span class="koboSpan" id="kobo.1440.2">Run the following command, and after it runs, press the -</span><code class="inlineCode"><span class="koboSpan" id="kobo.1441.1">t</span></code><span class="koboSpan" id="kobo.1442.1"> key to provide the regex </span><code class="inlineCode"><span class="koboSpan" id="kobo.1443.1">"</span></code><code class="inlineCode"><span class="koboSpan" id="kobo.1444.1">App"</span></code><span class="koboSpan" id="kobo.1445.1">:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1446.1">npm run test ng-test-ng-mocks –t "App"
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1447.1">Now, you can see that we only run the tests for </span><code class="inlineCode"><span class="koboSpan" id="kobo.1448.1">AppComponent</span></code><span class="koboSpan" id="kobo.1449.1">, and they fail as follows:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1450.1"><img alt="" role="presentation" src="../Images/B18469_10_11.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1451.1">Figure 10.11: Only running specific tests</span></p> </li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="3"><span class="koboSpan" id="kobo.1452.1">To fix the error shown in </span><em class="italic"><span class="koboSpan" id="kobo.1453.1">Figure 10.10</span></em><span class="koboSpan" id="kobo.1454.1">, we’ll import </span><code class="inlineCode"><span class="koboSpan" id="kobo.1455.1">VersionControlComponent</span></code><span class="koboSpan" id="kobo.1456.1"> into the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1457.1">TestBed</span></code><span class="koboSpan" id="kobo.1458.1"> definition inside</span><a id="_idIndexMarker822"/><span class="koboSpan" id="kobo.1459.1"> the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1460.1">app.component.spec.ts</span></code><span class="koboSpan" id="kobo.1461.1"> file. </span><span class="koboSpan" id="kobo.1461.2">This is so that our test environment also knows</span><a id="_idIndexMarker823"/><span class="koboSpan" id="kobo.1462.1"> the missing </span><code class="inlineCode"><span class="koboSpan" id="kobo.1463.1">&lt;app-version-control&gt;</span></code><span class="koboSpan" id="kobo.1464.1"> component. </span><span class="koboSpan" id="kobo.1464.2">To do this, modify the file as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1465.1">...
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1466.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1467.1"> { </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1468.1">VersionControlComponent</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1469.1"> } </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1470.1">from</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1471.1">'./components/version-control/version-control.component'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1472.1">;</span></strong></span><span class="koboSpan" id="kobo.1473.1">
...
</span><span class="hljs-title"><span class="koboSpan" id="kobo.1474.1">describe</span></span><span class="koboSpan" id="kobo.1475.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1476.1">'AppComponent'</span></span><span class="koboSpan" id="kobo.1477.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.1478.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1479.1"> {
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.1480.1">beforeEach</span></span><span class="koboSpan" id="kobo.1481.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.1482.1">waitForAsync</span></span><span class="koboSpan" id="kobo.1483.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.1484.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1485.1"> {
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1486.1">TestBed</span></span><span class="koboSpan" id="kobo.1487.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1488.1">configureTestingModule</span></span><span class="koboSpan" id="kobo.1489.1">({
      </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1490.1">imports</span></span><span class="koboSpan" id="kobo.1491.1">: [</span><span class="hljs-title"><span class="koboSpan" id="kobo.1492.1">RouterTestingModule</span></span><span class="koboSpan" id="kobo.1493.1">],
      </span><span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1494.1">declarations</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1495.1">: [</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1496.1">AppComponent</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1497.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1498.1">VersionControlComponent</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1499.1">],</span></strong></span><span class="koboSpan" id="kobo.1500.1">
    }).</span><span class="hljs-title"><span class="koboSpan" id="kobo.1501.1">compileComponents</span></span><span class="koboSpan" id="kobo.1502.1">();
  }));
  ...
</span><span class="koboSpan" id="kobo.1502.2">});
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1503.1">If you rerun the tests for </span><code class="inlineCode"><span class="koboSpan" id="kobo.1504.1">AppComponent</span></code><span class="koboSpan" id="kobo.1505.1">, you’ll see some fresher and newer errors. </span><span class="koboSpan" id="kobo.1505.2">Progress! </span><span class="koboSpan" id="kobo.1505.3">But since we have the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1506.1">Version Control</span></code><span class="koboSpan" id="kobo.1507.1"> component dependent on another component, the tests don’t pass. </span><span class="koboSpan" id="kobo.1507.2">We’ll discuss why this is in more detail in the </span><em class="italic"><span class="koboSpan" id="kobo.1508.1">How it works...</span></em><span class="koboSpan" id="kobo.1509.1"> section. </span><span class="koboSpan" id="kobo.1509.2">However, to fix this, let’s follow the next steps.</span></p></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="4"><span class="koboSpan" id="kobo.1510.1">Instead of providing the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1511.1">VersionControlComponent</span></code><span class="koboSpan" id="kobo.1512.1"> directly, we need to mock it, since we don’t really care about it for the tests for </span><code class="inlineCode"><span class="koboSpan" id="kobo.1513.1">AppComponent</span></code><span class="koboSpan" id="kobo.1514.1">. </span><span class="koboSpan" id="kobo.1514.2">One way would be to use </span><code class="inlineCode"><span class="koboSpan" id="kobo.1515.1">CUSTOM_ELEMENT_SCHEMA</span></code><span class="koboSpan" id="kobo.1516.1"> in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1517.1">TestBed</span></code><span class="koboSpan" id="kobo.1518.1">'s configuration to tell the test bed that we don’t really care about the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1519.1">VersionControlComponent</span></code><span class="koboSpan" id="kobo.1520.1"> inside the tests for </span><code class="inlineCode"><span class="koboSpan" id="kobo.1521.1">AppComponent</span></code><span class="koboSpan" id="kobo.1522.1">. </span><span class="koboSpan" id="kobo.1522.2">However, we’re going</span><a id="_idIndexMarker824"/><span class="koboSpan" id="kobo.1523.1"> to use a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1524.1">MockComponent</span></code><span class="koboSpan" id="kobo.1525.1"> from </span><code class="inlineCode"><span class="koboSpan" id="kobo.1526.1">ng-mocks</span></code><span class="koboSpan" id="kobo.1527.1"> to mock</span><a id="_idIndexMarker825"/><span class="koboSpan" id="kobo.1528.1"> the component, achieving the same outcome. </span><span class="koboSpan" id="kobo.1528.2">To do this, update the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1529.1">app.component.spec.ts</span></code><span class="koboSpan" id="kobo.1530.1"> file as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1531.1">...
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1532.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1533.1"> { </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1534.1">MockComponent</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1535.1"> } </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1536.1">from</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1537.1">'ng-mocks'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1538.1">;</span></strong></span><span class="koboSpan" id="kobo.1539.1">
...
</span><span class="hljs-title"><span class="koboSpan" id="kobo.1540.1">describe</span></span><span class="koboSpan" id="kobo.1541.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1542.1">'AppComponent'</span></span><span class="koboSpan" id="kobo.1543.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.1544.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1545.1"> {
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.1546.1">beforeEach</span></span><span class="koboSpan" id="kobo.1547.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.1548.1">waitForAsync</span></span><span class="koboSpan" id="kobo.1549.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.1550.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1551.1"> {
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1552.1">TestBed</span></span><span class="koboSpan" id="kobo.1553.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1554.1">configureTestingModule</span></span><span class="koboSpan" id="kobo.1555.1">({
      </span><span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1556.1">declarations</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1557.1">: [</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1558.1">AppComponent</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1559.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1560.1">MockComponent</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1561.1">(</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1562.1">VersionControlComponent</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1563.1">)],</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1564.1">imports</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1565.1">: [</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1566.1">RouterTestingModule</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1567.1">],</span></strong></span><span class="koboSpan" id="kobo.1568.1">
    }).</span><span class="hljs-title"><span class="koboSpan" id="kobo.1569.1">compileComponents</span></span><span class="koboSpan" id="kobo.1570.1">();
  }));
  ...
</span><span class="koboSpan" id="kobo.1570.2">});
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1571.1">Boom! </span><span class="koboSpan" id="kobo.1571.2">Problem solved. </span><span class="koboSpan" id="kobo.1571.3">Run the tests again, just for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1572.1">AppComponent</span></code><span class="koboSpan" id="kobo.1573.1">, and you should see them all pass as follows:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1574.1"><img alt="" role="presentation" src="../Images/B18469_10_12.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1575.1">Figure 10.12: Passing all of the tests for App component</span></p></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="5"><span class="koboSpan" id="kobo.1576.1">Press the </span><em class="keystroke"><span class="koboSpan" id="kobo.1577.1">a</span></em><span class="koboSpan" id="kobo.1578.1"> key in the terminal to run all tests again.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1579.1">Now, let’s talk about the tests for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1580.1">Version Control</span></code><span class="koboSpan" id="kobo.1581.1"> component. </span><span class="koboSpan" id="kobo.1581.2">This depends on the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1582.1">VC Logs</span></code><span class="koboSpan" id="kobo.1583.1"> component. </span><span class="koboSpan" id="kobo.1583.2">Let’s mock the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1584.1">VCLogsComponent</span></code><span class="koboSpan" id="kobo.1585.1"> class like a pro this time, using </span><a id="_idIndexMarker826"/><span class="koboSpan" id="kobo.1586.1">the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1587.1">MockBuilder</span></code><span class="koboSpan" id="kobo.1588.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1589.1">MockRender</span></code><span class="koboSpan" id="kobo.1590.1"> methods, so we can get rid of the errors during the tests. </span><span class="koboSpan" id="kobo.1590.2">After</span><a id="_idIndexMarker827"/><span class="koboSpan" id="kobo.1591.1"> the update, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1592.1">version-control.component.spec.ts</span></code><span class="koboSpan" id="kobo.1593.1"> file should appear as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1594.1">import</span></span><span class="koboSpan" id="kobo.1595.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.1596.1">ComponentFixture</span></span><span class="koboSpan" id="kobo.1597.1">, </span><span class="hljs-title"><span class="koboSpan" id="kobo.1598.1">TestBed</span></span><span class="koboSpan" id="kobo.1599.1">, waitForAsync } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1600.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1601.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1602.1">@angular/core/testing'</span></span><span class="koboSpan" id="kobo.1603.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1604.1">import</span></span><span class="koboSpan" id="kobo.1605.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.1606.1">VersionControlComponent</span></span><span class="koboSpan" id="kobo.1607.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1608.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1609.1">'./version-control.component'</span></span><span class="koboSpan" id="kobo.1610.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1611.1">import</span></span><span class="koboSpan" id="kobo.1612.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.1613.1">FormsModule</span></span><span class="koboSpan" id="kobo.1614.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1615.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1616.1">'@angular/forms'</span></span><span class="koboSpan" id="kobo.1617.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1618.1">import</span></span><span class="koboSpan" id="kobo.1619.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.1620.1">MockBuilder</span></span><span class="koboSpan" id="kobo.1621.1">, </span><span class="hljs-title"><span class="koboSpan" id="kobo.1622.1">MockRender</span></span><span class="koboSpan" id="kobo.1623.1">, </span><span class="hljs-title"><span class="koboSpan" id="kobo.1624.1">MockedComponentFixture</span></span><span class="koboSpan" id="kobo.1625.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1626.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1627.1">'ng-mocks'</span></span><span class="koboSpan" id="kobo.1628.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1629.1">import</span></span><span class="koboSpan" id="kobo.1630.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.1631.1">AppModule</span></span><span class="koboSpan" id="kobo.1632.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1633.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1634.1">'../../app.module'</span></span><span class="koboSpan" id="kobo.1635.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1636.1">import</span></span><span class="koboSpan" id="kobo.1637.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.1638.1">VcLogsComponent</span></span><span class="koboSpan" id="kobo.1639.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1640.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1641.1">'../vc-logs/vc-logs.component'</span></span><span class="koboSpan" id="kobo.1642.1">;
</span><span class="hljs-title"><span class="koboSpan" id="kobo.1643.1">describe</span></span><span class="koboSpan" id="kobo.1644.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1645.1">'VersionControlComponent'</span></span><span class="koboSpan" id="kobo.1646.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.1647.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1648.1"> {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1649.1">let</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.1650.1">component</span></span><span class="koboSpan" id="kobo.1651.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.1652.1">VersionControlComponent</span></span><span class="koboSpan" id="kobo.1653.1">;
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1654.1">let</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.1655.1">fixture</span></span><span class="koboSpan" id="kobo.1656.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.1657.1">MockedComponentFixture</span></span>
<span class="hljs-title"> </span><span class="koboSpan" id="kobo.1658.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.1659.1">VersionControlComponent</span></span><span class="koboSpan" id="kobo.1660.1">&gt;;
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.1661.1">beforeEach</span></span><span class="koboSpan" id="kobo.1662.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.1663.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1664.1"> {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1665.1">return</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1666.1">MockBuilder</span></span><span class="koboSpan" id="kobo.1667.1">(
      </span><span class="hljs-title"><span class="koboSpan" id="kobo.1668.1">VersionControlComponent</span></span><span class="koboSpan" id="kobo.1669.1">,
      </span><span class="hljs-title"><span class="koboSpan" id="kobo.1670.1">AppModule</span></span><span class="koboSpan" id="kobo.1671.1">
    );
  });
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.1672.1">beforeEach</span></span><span class="koboSpan" id="kobo.1673.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.1674.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1675.1"> {
    fixture = </span><span class="hljs-title"><span class="koboSpan" id="kobo.1676.1">MockRender</span></span><span class="koboSpan" id="kobo.1677.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.1678.1">VersionControlComponent</span></span><span class="koboSpan" id="kobo.1679.1">);
    component = fixture.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1680.1">point</span></span><span class="koboSpan" id="kobo.1681.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1682.1">componentInstance</span></span><span class="koboSpan" id="kobo.1683.1">;
  });
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.1684.1">it</span></span><span class="koboSpan" id="kobo.1685.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1686.1">'should create'</span></span><span class="koboSpan" id="kobo.1687.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.1688.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1689.1"> {...});
});
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1690.1">If you run </span><code class="inlineCode"><span class="koboSpan" id="kobo.1691.1">npm run test</span></code><span class="koboSpan" id="kobo.1692.1"> now, you should see all of the tests passing. </span><span class="koboSpan" id="kobo.1692.2">Let’s write another test in the next step.</span></p> </li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="7"><code class="inlineCode"><span class="koboSpan" id="kobo.1693.1">VersionControlComponent</span></code><span class="koboSpan" id="kobo.1694.1"> uses </span><code class="inlineCode"><span class="koboSpan" id="kobo.1695.1">VCLogsComponent</span></code><span class="koboSpan" id="kobo.1696.1"> as a child component in the template. </span><span class="koboSpan" id="kobo.1696.2">Additionally, it provides the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1697.1">vName</span></code><span class="koboSpan" id="kobo.1698.1"> property as </span><code class="inlineCode"><span class="koboSpan" id="kobo.1699.1">@Input()</span></code><span class="koboSpan" id="kobo.1700.1"> to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1701.1">VCLogsComponent</span></code><span class="koboSpan" id="kobo.1702.1">, via the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1703.1">[vName]</span></code><span class="koboSpan" id="kobo.1704.1"> attribute. </span><span class="koboSpan" id="kobo.1704.2">We can check whether the input’s value is set correctly. </span><span class="koboSpan" id="kobo.1704.3">To do so, update the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1705.1">version-control.component.spec.ts</span></code><span class="koboSpan" id="kobo.1706.1"> file, as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1707.1">import</span></span><span class="koboSpan" id="kobo.1708.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.1709.1">VersionControlComponent</span></span><span class="koboSpan" id="kobo.1710.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1711.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1712.1">'./version-control.component'</span></span><span class="koboSpan" id="kobo.1713.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1714.1">import</span></span><span class="koboSpan" id="kobo.1715.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.1716.1">MockBuilder</span></span><span class="koboSpan" id="kobo.1717.1">, </span><span class="hljs-title"><span class="koboSpan" id="kobo.1718.1">MockRender</span></span><span class="koboSpan" id="kobo.1719.1">, </span><span class="hljs-title"><span class="koboSpan" id="kobo.1720.1">MockedComponentFixture</span></span><span class="koboSpan" id="kobo.1721.1">, </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1722.1">ngMocks</span></strong></span><span class="koboSpan" id="kobo.1723.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1724.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1725.1">'ng-mocks'</span></span><span class="koboSpan" id="kobo.1726.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1727.1">import</span></span><span class="koboSpan" id="kobo.1728.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.1729.1">AppModule</span></span><span class="koboSpan" id="kobo.1730.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1731.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1732.1">'../../app.module'</span></span><span class="koboSpan" id="kobo.1733.1">;
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1734.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1735.1"> { </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1736.1">VcLogsComponent</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1737.1"> } </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1738.1">from</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1739.1">'../vc-logs/vc-logs.component'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1740.1">;</span></strong></span>
<span class="hljs-title"><span class="koboSpan" id="kobo.1741.1">describe</span></span><span class="koboSpan" id="kobo.1742.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1743.1">'VersionControlComponent'</span></span><span class="koboSpan" id="kobo.1744.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.1745.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1746.1"> {
  ...
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.1747.1">it</span></span><span class="koboSpan" id="kobo.1748.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1749.1">'should create'</span></span><span class="koboSpan" id="kobo.1750.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.1751.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1752.1"> {...});
  </span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1753.1">it</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1754.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1755.1">'should set vName input value in VCLogsComponent'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1756.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1757.1">() =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1758.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1759.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1760.1"> vcLogsComponent = ngMocks.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1761.1">find</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1762.1">&lt;</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1763.1">VcLogsComponent</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1764.1">&gt;(</span></strong></span>
<span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1765.1">'app-vc-logs'</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1766.1">).</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1767.1">componentInstance</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1768.1">;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1769.1">component.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1770.1">versionName</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1771.1"> = </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1772.1">'2.2.2'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1773.1">;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1774.1">fixture.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1775.1">detectChanges</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1776.1">();</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1777.1">expect</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1778.1">(vcLogsComponent.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1779.1">vName</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1780.1">).</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1781.1">toBe</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1782.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1783.1">'2.2.2'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1784.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1785.1">});</span></strong></span><span class="koboSpan" id="kobo.1786.1">
});
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1787.1">We are now going to modify</span><a id="_idIndexMarker828"/><span class="koboSpan" id="kobo.1788.1"> the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1789.1">vc-logs.component.spec.ts</span></code><span class="koboSpan" id="kobo.1790.1"> file to make sure that when the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1791.1">vName</span></code><span class="koboSpan" id="kobo.1792.1"> changes </span><a id="_idIndexMarker829"/><span class="koboSpan" id="kobo.1793.1">inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1794.1">VCLogsComponent</span></code><span class="koboSpan" id="kobo.1795.1">, we have a new log created inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1796.1">logs</span></code><span class="koboSpan" id="kobo.1797.1"> array. </span><span class="koboSpan" id="kobo.1797.2">To do so, modify the file as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1798.1">...
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1799.1">import</span></span><span class="koboSpan" id="kobo.1800.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.1801.1">TestBed</span></span><span class="koboSpan" id="kobo.1802.1">, waitForAsync } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1803.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1804.1">'@angular/core/testing'</span></span><span class="koboSpan" id="kobo.1805.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1806.1">import</span></span><span class="koboSpan" id="kobo.1807.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.1808.1">VcLogsComponent</span></span><span class="koboSpan" id="kobo.1809.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1810.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1811.1">'./vc-logs.component'</span></span><span class="koboSpan" id="kobo.1812.1">;
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1813.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1814.1"> { </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1815.1">MockRender</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1816.1">, </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1817.1">MockedComponentFixture</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1818.1"> } </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1819.1">from</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1820.1">'</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1821.1">ng-mocks'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1822.1">;</span></strong></span>
<span class="hljs-title"><span class="koboSpan" id="kobo.1823.1">describe</span></span><span class="koboSpan" id="kobo.1824.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1825.1">'VcLogsComponent'</span></span><span class="koboSpan" id="kobo.1826.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.1827.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1828.1"> {
  ...
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.1829.1">beforeEach</span></span><span class="koboSpan" id="kobo.1830.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.1831.1">waitForAsync</span></span><span class="koboSpan" id="kobo.1832.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.1833.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1834.1"> {...}));
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.1835.1">beforeEach</span></span><span class="koboSpan" id="kobo.1836.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.1837.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1838.1"> {
    fixture = </span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1839.1">MockRender</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1840.1">(</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1841.1">VcLogsComponent</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1842.1">, {</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1843.1">vName</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1844.1">: </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1845.1">'0.0.0'</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1846.1">});</span></strong></span><span class="koboSpan" id="kobo.1847.1">
    component = fixture</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1848.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1849.1">point</span></strong></span><span class="koboSpan" id="kobo.1850.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1851.1">componentInstance</span></span><span class="koboSpan" id="kobo.1852.1">;
    fixture.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1853.1">detectChanges</span></span><span class="koboSpan" id="kobo.1854.1">();
  });
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.1855.1">it</span></span><span class="koboSpan" id="kobo.1856.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1857.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1858.1">should create'</span></span><span class="koboSpan" id="kobo.1859.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.1860.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1861.1"> {
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1862.1">expect</span></span><span class="koboSpan" id="kobo.1863.1">(component).</span><span class="hljs-title"><span class="koboSpan" id="kobo.1864.1">toBeTruthy</span></span><span class="koboSpan" id="kobo.1865.1">();
  });
  </span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1866.1">it</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1867.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1868.1">'should add a log after vName change'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1869.1">, </span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1870.1">() =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1871.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1872.1">fixture.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1873.1">detectChanges</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1874.1">();</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1875.1">fixture.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1876.1">componentInstance</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1877.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1878.1">vName</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1879.1"> = </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1880.1">"2.2.3"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1881.1">;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1882.1">fixture.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1883.1">detectChanges</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1884.1">();</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1885.1">expect</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1886.1">(component.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1887.1">logs</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1888.1">).</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1889.1">toHaveLength</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1890.1">(</span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.1891.1">2</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1892.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1893.1">});</span></strong></span><span class="koboSpan" id="kobo.1894.1">
});
</span></code></pre>
</li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.1895.1">Boom! </span><span class="koboSpan" id="kobo.1895.2">We have implemented some</span><a id="_idIndexMarker830"/><span class="koboSpan" id="kobo.1896.1"> interesting tests by using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1897.1">ng-mocks</span></code><span class="koboSpan" id="kobo.1898.1"> package. </span><span class="koboSpan" id="kobo.1898.2">I absolutely love it every time I use it (mostly with components that are part of an </span><code class="inlineCode"><span class="koboSpan" id="kobo.1899.1">NgModule</span></code><span class="koboSpan" id="kobo.1900.1">, as </span><code class="inlineCode"><span class="koboSpan" id="kobo.1901.1">standalone</span></code><span class="koboSpan" id="kobo.1902.1"> components</span><a id="_idIndexMarker831"/><span class="koboSpan" id="kobo.1903.1"> don’t have this issue). </span><span class="koboSpan" id="kobo.1903.2">Now that we’ve finished the recipe, in the next section, let’s take a look at how it all works.</span></p>
<h2 class="heading-2" id="_idParaDest-358"><span class="koboSpan" id="kobo.1904.1">How it works...</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1905.1">There are a couple of interesting things that we have covered in this recipe. </span><span class="koboSpan" id="kobo.1905.2">First, to avoid any errors on the console complaining about unknown components, we use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1906.1">MockComponent</span></code><span class="koboSpan" id="kobo.1907.1"> method from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1908.1">ng-mocks</span></code><span class="koboSpan" id="kobo.1909.1"> package, declaring the components we’re dependent on as mocks. </span><span class="koboSpan" id="kobo.1909.2">Notice that when a component is mocked, it loses its functionality, as all the methods become </span><code class="inlineCode"><span class="koboSpan" id="kobo.1910.1">spy</span></code><span class="koboSpan" id="kobo.1911.1"> functions. </span><span class="koboSpan" id="kobo.1911.2">That is absolutely the simplest thing we can achieve with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1912.1">ng-mocks</span></code><span class="koboSpan" id="kobo.1913.1"> package. </span><span class="koboSpan" id="kobo.1913.2">However, we will move on to an advanced situation, which I will admit is sort of an unconventional approach, that is, testing the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1914.1">@Input</span></code><span class="koboSpan" id="kobo.1915.1"> properties and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1916.1">@Output</span></code><span class="koboSpan" id="kobo.1917.1"> emitters of the child components in the parent component in order to test an entire flow. </span><span class="koboSpan" id="kobo.1917.2">This is what we do for the tests of </span><code class="inlineCode"><span class="koboSpan" id="kobo.1918.1">VersionControlComponent</span></code><span class="koboSpan" id="kobo.1919.1"> by checking the value of an </span><code class="inlineCode"><span class="koboSpan" id="kobo.1920.1">@Input</span></code><span class="koboSpan" id="kobo.1921.1"> property </span><code class="inlineCode"><span class="koboSpan" id="kobo.1922.1">vName</span></code><span class="koboSpan" id="kobo.1923.1">. </span><span class="koboSpan" id="kobo.1923.2">Again, this is mostly useful for non-standalone components.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1924.1">Notice that we removed the usage of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1925.1">@angular/core/testing</span></code><span class="koboSpan" id="kobo.1926.1"> package completely from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1927.1">version-control.component.spec.ts</span></code><span class="koboSpan" id="kobo.1928.1"> file. </span><span class="koboSpan" id="kobo.1928.2">This is because we’re no longer using </span><code class="inlineCode"><span class="koboSpan" id="kobo.1929.1">TestBed</span></code><span class="koboSpan" id="kobo.1930.1"> to create the test environment. </span><span class="koboSpan" id="kobo.1930.2">Instead, we use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1931.1">MockBuilder</span></code><span class="koboSpan" id="kobo.1932.1"> method from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1933.1">ng-mocks</span></code><span class="koboSpan" id="kobo.1934.1"> package to build the test environment for our </span><code class="inlineCode"><span class="koboSpan" id="kobo.1935.1">VersionControlComponent</span></code><span class="koboSpan" id="kobo.1936.1">. </span><span class="koboSpan" id="kobo.1936.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1937.1">MockBuilder</span></code><span class="koboSpan" id="kobo.1938.1"> method has several overloads, the one we used to take the target component</span><a id="_idIndexMarker832"/><span class="koboSpan" id="kobo.1939.1"> as the first argument, and the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1940.1">NgModule</span></code><span class="koboSpan" id="kobo.1941.1"> this component</span><a id="_idIndexMarker833"/><span class="koboSpan" id="kobo.1942.1"> is a part of as the second argument. </span><span class="koboSpan" id="kobo.1942.2">The module and everything inside it are mocked. </span><span class="koboSpan" id="kobo.1942.3">This makes it so much easier to test the component in isolation. </span><span class="koboSpan" id="kobo.1942.4">You also have methods like </span><code class="inlineCode"><span class="koboSpan" id="kobo.1943.1">exclude</span></code><span class="koboSpan" id="kobo.1944.1"> that you can chain, like </span><code class="inlineCode"><span class="koboSpan" id="kobo.1945.1">MockBuilder(MyComponent, MyModule).exclude(OtherComponent)</span></code><span class="koboSpan" id="kobo.1946.1">, to not mock specific components. </span><span class="koboSpan" id="kobo.1946.2">However, we didn’t need to do that in this recipe. </span><span class="koboSpan" id="kobo.1946.3">We also wrote an interesting test for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1947.1">VersionControlComponent</span></code><span class="koboSpan" id="kobo.1948.1">, that is, getting a child component (</span><code class="inlineCode"><span class="koboSpan" id="kobo.1949.1">VCLogsComponent</span></code><span class="koboSpan" id="kobo.1950.1">) using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1951.1">ngMocks.find</span></code><span class="koboSpan" id="kobo.1952.1"> method and checking if the child component’s </span><code class="inlineCode"><span class="koboSpan" id="kobo.1953.1">@Input()</span></code><span class="koboSpan" id="kobo.1954.1"> is set appropriately when the respective property in the parent changes. </span><span class="koboSpan" id="kobo.1954.2">I call this interesting because now we’re getting away from the entire notion of “testing components in isolation,” as we are now checking a property of another component than the component we’re actually testing. </span><span class="koboSpan" id="kobo.1954.3">In general, you would want to mock the child components or any dependency that a component has. </span><span class="koboSpan" id="kobo.1954.4">With that said, the approach in your team might be different. </span><span class="koboSpan" id="kobo.1954.5">If you have a strong case for not mocking the child component and then checking its properties as shown in the recipe, now you know how. </span><span class="koboSpan" id="kobo.1954.6">Please refer to the next section for further resources to read.</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.1955.1">IMPORTANT NOTE</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1956.1">Notice that we don’t use a spy on the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1957.1">VersionControlComponent.addNewReleaseLog</span></code><span class="koboSpan" id="kobo.1958.1"> method. </span><span class="koboSpan" id="kobo.1958.2">This is because if we do so, that function will become a Jest spy function. </span><span class="koboSpan" id="kobo.1958.3">Therefore, it’ll lose its internal functionality. </span><span class="koboSpan" id="kobo.1958.4">In return, it’ll never add the new log to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1959.1">releaseLogs</span></code><span class="koboSpan" id="kobo.1960.1"> array, and none of our tests will pass. </span><span class="koboSpan" id="kobo.1960.2">You can try it out for fun.</span></p>
</div>
<h2 class="heading-2" id="_idParaDest-359"><span class="koboSpan" id="kobo.1961.1">See also</span></h2>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.1962.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1963.1">ng-mocks</span></code><span class="koboSpan" id="kobo.1964.1"> package’s</span><a id="_idIndexMarker834"/> <code class="inlineCode"><span class="koboSpan" id="kobo.1965.1">mock</span></code><span class="koboSpan" id="kobo.1966.1"> method: </span><a href="https://ng-mocks.sudo.eu/api/MockBuilder#mock"><span class="url"><span class="koboSpan" id="kobo.1967.1">https://ng-mocks.sudo.eu/api/MockBuilder#mock</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1968.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1969.1">ng-mocks</span></code><span class="koboSpan" id="kobo.1970.1"> official</span><a id="_idIndexMarker835"/><span class="koboSpan" id="kobo.1971.1"> documentation: </span><a href="https://ng-mocks.sudo.eu"><span class="url"><span class="koboSpan" id="kobo.1972.1">https://ng-mocks.sudo.eu</span></span></a></li>
</ul>
<h1 class="heading-1" id="_idParaDest-360"><span class="koboSpan" id="kobo.1973.1">Writing even easier tests with Angular CDK component harnesses</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1974.1">When writing tests for components, there might</span><a id="_idIndexMarker836"/><span class="koboSpan" id="kobo.1975.1"> be scenarios where you’d want to interact</span><a id="_idIndexMarker837"/><span class="koboSpan" id="kobo.1976.1"> with the DOM elements. </span><span class="koboSpan" id="kobo.1976.2">Now, this can already be achieved by using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1977.1">fixture.debugElement.query</span></code><span class="koboSpan" id="kobo.1978.1"> method to find the element, using a selector and then triggering events on it. </span><span class="koboSpan" id="kobo.1978.2">However, that means maintaining the DOM queries for different platforms, knowing the identifiers of all the selectors, and then exposing all of that in the tests. </span><span class="koboSpan" id="kobo.1978.3">And this is even worse if we’re talking about an Angular library. </span><span class="koboSpan" id="kobo.1978.4">It certainly isn’t necessary for each developer who interacts with my library to know all the element selectors in order to write tests. </span><span class="koboSpan" id="kobo.1978.5">Only the author of the library should know that much to respect encapsulation. </span><span class="koboSpan" id="kobo.1978.6">Luckily, we have the component harnesses from the Angular CDK team, which were released with Angular 9 along with the IVY compiler. </span><span class="koboSpan" id="kobo.1978.7">And they’ve led by example, by providing component harnesses for the Angular material components as well. </span><span class="koboSpan" id="kobo.1978.8">In this recipe, you’ll learn how to create your own component harnesses.</span></p>
<h2 class="heading-2" id="_idParaDest-361"><span class="koboSpan" id="kobo.1979.1">Getting ready</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1980.1">The app that we are going to work with now resides in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1981.1">start/apps/chapter10/ng-test-cdk-harness</span></code><span class="koboSpan" id="kobo.1982.1"> inside the cloned repository:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1983.1">Open the code repository in your code editor.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1984.1">Open the terminal, navigate to the code repository directory, and run the following command to serve the project:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1985.1">npm run serve ng-test-cdk-harness
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1986.1">This should open the app in a new browser tab, and you should see the following:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1987.1"><img alt="" role="presentation" src="../Images/B18469_10_13.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1988.1">Figure 10.13: The ng-test-cdk-harness app running on http://localhost:4200</span></p></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.1989.1">Now that you have the app running, let’s move on to the next section to follow the recipe.</span></p>
<h2 class="heading-2" id="_idParaDest-362"><span class="koboSpan" id="kobo.1990.1">How to do it...</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1991.1">We have our favorite Angular version</span><a id="_idIndexMarker838"/><span class="koboSpan" id="kobo.1992.1"> control app that allows us to create</span><a id="_idIndexMarker839"/><span class="koboSpan" id="kobo.1993.1"> release logs. </span><span class="koboSpan" id="kobo.1993.2">Also, we have tests written already, including tests that interact with the DOM element to validate a few use cases. </span><span class="koboSpan" id="kobo.1993.3">Let’s follow the recipe to use component harnesses instead, discovering how easy it becomes to use in the actual tests:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1994.1">First, run the following command to run the tests:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1995.1">npm run test ng-test-cdk-harness
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1996.1">Now, we’ll create a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1997.1">component harness</span></code><span class="koboSpan" id="kobo.1998.1"> for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1999.1">VersionControlComponent</span></code><span class="koboSpan" id="kobo.2000.1">. </span><span class="koboSpan" id="kobo.2000.2">Let’s create a new file inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2001.1">version-control</span></code><span class="koboSpan" id="kobo.2002.1"> folder, and name it </span><code class="inlineCode"><span class="koboSpan" id="kobo.2003.1">version-control.component.harness.ts</span></code><span class="koboSpan" id="kobo.2004.1">. </span><span class="koboSpan" id="kobo.2004.2">Then, add the following code inside it:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2005.1">import</span></span><span class="koboSpan" id="kobo.2006.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.2007.1">ComponentHarness</span></span><span class="koboSpan" id="kobo.2008.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2009.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2010.1">'@angular/cdk/testing'</span></span><span class="koboSpan" id="kobo.2011.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2012.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2013.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2014.1">VersionControlComponentHarness</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2015.1">extends</span></span>
<span class="hljs-keyword"> </span> <span class="hljs-title"><span class="koboSpan" id="kobo.2016.1">ComponentHarness</span></span><span class="koboSpan" id="kobo.2017.1"> {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2018.1">static</span></span><span class="koboSpan" id="kobo.2019.1"> hostSelector = </span><span class="hljs-string"><span class="koboSpan" id="kobo.2020.1">'app-release-form'</span></span><span class="koboSpan" id="kobo.2021.1">;
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2022.1">protected</span></span><span class="koboSpan" id="kobo.2023.1"> getSubmitButton =
</span><span class="hljs-keyword"> </span> <span class="hljs-variable"><span class="koboSpan" id="kobo.2024.1">this</span></span><span class="koboSpan" id="kobo.2025.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2026.1">locatorFor</span></span><span class="koboSpan" id="kobo.2027.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2028.1">'button[type=submit]'</span></span><span class="koboSpan" id="kobo.2029.1">);
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2030.1">protected</span></span><span class="koboSpan" id="kobo.2031.1"> getAppVersionInput =
</span><span class="hljs-keyword"> </span> <span class="hljs-variable"><span class="koboSpan" id="kobo.2032.1">this</span></span><span class="koboSpan" id="kobo.2033.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2034.1">locatorFor</span></span><span class="koboSpan" id="kobo.2035.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2036.1">`#versionNumber`</span></span><span class="koboSpan" id="kobo.2037.1">);
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2038.1">protected</span></span><span class="koboSpan" id="kobo.2039.1"> getVersionErrorEl =
</span><span class="hljs-keyword"> </span> <span class="hljs-variable"><span class="koboSpan" id="kobo.2040.1">this</span></span><span class="koboSpan" id="kobo.2041.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2042.1">locatorFor</span></span><span class="koboSpan" id="kobo.2043.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2044.1">'small.error'</span></span><span class="koboSpan" id="kobo.2045.1">);
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2046.1">Now, we need to set up the harness</span><a id="_idIndexMarker840"/><span class="koboSpan" id="kobo.2047.1"> environment for our tests</span><a id="_idIndexMarker841"/><span class="koboSpan" id="kobo.2048.1"> for </span><code class="inlineCode"><span class="koboSpan" id="kobo.2049.1">VersionControlComponent</span></code><span class="koboSpan" id="kobo.2050.1">. </span><span class="koboSpan" id="kobo.2050.2">For this, we’ll use </span><code class="inlineCode"><span class="koboSpan" id="kobo.2051.1">TestbedHarnessEnvironment</span></code><span class="koboSpan" id="kobo.2052.1"> from the Angular CDK. </span><span class="koboSpan" id="kobo.2052.2">Update the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2053.1">version-control.component.spec.ts</span></code><span class="koboSpan" id="kobo.2054.1"> file as follows:
        </span><pre class="programlisting code"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2055.1">import</span></span><span class="koboSpan" id="kobo.2056.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.2057.1">TestbedHarnessEnvironment</span></span><span class="koboSpan" id="kobo.2058.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2059.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2060.1">'@angular/cdk/testing/testbed'</span></span><span class="koboSpan" id="kobo.2061.1">;
      ...
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2062.1">Now, let’s write some methods in our </span><code class="inlineCode"><span class="koboSpan" id="kobo.2063.1">VersionControlComponentHarness</span></code><span class="koboSpan" id="kobo.2064.1"> class to get the relevant information. </span><span class="koboSpan" id="kobo.2064.2">We’ll use these methods in the later steps. </span><span class="koboSpan" id="kobo.2064.3">Update the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2065.1">version-control.component.harness.ts</span></code><span class="koboSpan" id="kobo.2066.1"> file as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2067.1">...
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2068.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2069.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2070.1">ReleaseFormComponentHarness</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2071.1">extends</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2072.1">ComponentHarness</span></span><span class="koboSpan" id="kobo.2073.1"> {
  ...
  </span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2074.1">async</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2075.1">clickSubmit</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2076.1">() {</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2077.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2078.1"> submitBtn = </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2079.1">await</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.2080.1">this</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2081.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2082.1">getSubmitButton</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2083.1">();</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2084.1">return</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2085.1">await</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2086.1"> submitBtn.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2087.1">click</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2088.1">();</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2089.1">}</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2090.1">async</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2091.1">setNewAppVersion</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2092.1">(</span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2093.1">version</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.2094.1">: </span></strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.2095.1">string</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2096.1">) {</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2097.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2098.1"> versionInput = </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2099.1">await</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.2100.1">this</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2101.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2102.1">getAppVersionInput</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2103.1">();</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2104.1">return</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2105.1">await</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2106.1"> versionInput.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2107.1">sendKeys</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2108.1">(version);</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2109.1">}</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2110.1">async</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2111.1">isVersionErrorShown</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2112.1">() {</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2113.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2114.1"> expected = </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2115.1">'Version number does not match the</span></strong></span>
<span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2116.1">pattern (x.x.x)'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2117.1">;</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2118.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2119.1"> versionErrorEl = </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2120.1">await</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.2121.1">this</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2122.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2123.1">getVersionErrorEl</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2124.1">();</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2125.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2126.1"> versionErrorText = </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2127.1">await</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2128.1"> versionErrorEl.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2129.1">text</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2130.1">();</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2131.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2132.1"> isErrorShown = versionErrorText.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2133.1">trim</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2134.1">() ===</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2135.1">expected;</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2136.1">if</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2137.1"> (!isErrorShown) {</span></strong></span>
<span class="code-highlight"><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.2138.1">console</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2139.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2140.1">log</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2141.1">({</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2142.1">actual</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2143.1">: versionErrorText.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2144.1">trim</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2145.1">(),</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2146.1">expected,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2147.1">});</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2148.1">}</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2149.1">return</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2150.1"> isErrorShown;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2151.1">}</span></strong></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2152.1">Next, we’ll work on our first</span><a id="_idIndexMarker842"/><span class="koboSpan" id="kobo.2153.1"> test, named </span><code class="inlineCode"><span class="koboSpan" id="kobo.2154.1">should show error on wrong version number input</span></code><span class="koboSpan" id="kobo.2155.1">, with the component</span><a id="_idIndexMarker843"/><span class="koboSpan" id="kobo.2156.1"> harness. </span><span class="koboSpan" id="kobo.2156.2">Update the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2157.1">version-control.component.spec.ts</span></code><span class="koboSpan" id="kobo.2158.1"> file as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2159.1">...
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2160.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2161.1"> { </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2162.1">VersionControlComponentHarness</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2163.1"> } </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2164.1">from</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2165.1">'./version-control.component.harness'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2166.1">;</span></strong></span>
<span class="hljs-title"><span class="koboSpan" id="kobo.2167.1">describe</span></span><span class="koboSpan" id="kobo.2168.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2169.1">'VersionControlComponent'</span></span><span class="koboSpan" id="kobo.2170.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.2171.1">() =&gt;</span></span><span class="koboSpan" id="kobo.2172.1"> {
  ...
  </span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2173.1">it</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2174.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2175.1">'should show error on wrong version number input'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2176.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2177.1">async</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2178.1"> () =&gt; {</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2179.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2180.1"> vcHarness = </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2181.1">await</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2182.1">TestbedHarnessEnvironment</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2183.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2184.1">harnessForFixture</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2185.1">(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2186.1">fixture,</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2187.1">VersionControlComponentHarness</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2188.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2189.1">await</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2190.1"> vcHarness.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2191.1">setNewAppVersion</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2192.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2193.1">'abcd'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2194.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2195.1">await</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2196.1"> vcHarness.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2197.1">clickSubmit</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2198.1">();</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2199.1">fixture.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2200.1">detectChanges</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2201.1">();</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2202.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2203.1"> isErrorShown = </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2204.1">await</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2205.1"> vcHarness</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2206.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2207.1">isVersionErrorShown</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2208.1">();</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2209.1">expect</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2210.1">(isErrorShown).</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2211.1">toBe</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2212.1">(</span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.2213.1">true</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2214.1">);</span></strong></span><span class="koboSpan" id="kobo.2215.1">
  });
  ...
</span><span class="koboSpan" id="kobo.2215.2">});
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2216.1">Now, if you run </span><code class="inlineCode"><span class="koboSpan" id="kobo.2217.1">npm run test</span></code><span class="koboSpan" id="kobo.2218.1">, you should see all of the tests passing, which means our first test with the component harness works. </span><span class="koboSpan" id="kobo.2218.2">Woo-hoo!</span></p></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="6"><span class="koboSpan" id="kobo.2219.1">For the final test, we also need a component harness for </span><code class="inlineCode"><span class="koboSpan" id="kobo.2220.1">VCLogsComponent</span></code><span class="koboSpan" id="kobo.2221.1">. </span><span class="koboSpan" id="kobo.2221.2">Let’s quickly create it. </span><span class="koboSpan" id="kobo.2221.3">Add a new file inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2222.1">vc-logs</span></code><span class="koboSpan" id="kobo.2223.1"> folder, named </span><code class="inlineCode"><span class="koboSpan" id="kobo.2224.1">vc-logs.component.harness.ts</span></code><span class="koboSpan" id="kobo.2225.1">, and add the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2226.1">import</span></span><span class="koboSpan" id="kobo.2227.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.2228.1">ComponentHarness</span></span><span class="koboSpan" id="kobo.2229.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2230.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2231.1">'@angular/cdk/testing'</span></span><span class="koboSpan" id="kobo.2232.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2233.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2234.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2235.1">VCLogsComponentHarness</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2236.1">extends</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2237.1">ComponentHarness</span></span><span class="koboSpan" id="kobo.2238.1"> {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2239.1">static</span></span><span class="koboSpan" id="kobo.2240.1"> hostSelector = </span><span class="hljs-string"><span class="koboSpan" id="kobo.2241.1">'app-vc-logs'</span></span><span class="koboSpan" id="kobo.2242.1">;
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2243.1">protected</span></span><span class="koboSpan" id="kobo.2244.1"> getLogsList = </span><span class="hljs-variable"><span class="koboSpan" id="kobo.2245.1">this</span></span><span class="koboSpan" id="kobo.2246.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2247.1">locatorForAll</span></span><span class="koboSpan" id="kobo.2248.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2249.1">'.logs__item'</span></span><span class="koboSpan" id="kobo.2250.1">);
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2251.1">async</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2252.1">getLogsLength</span></span><span class="koboSpan" id="kobo.2253.1">() {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2254.1">const</span></span><span class="koboSpan" id="kobo.2255.1"> logsElements = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2256.1">await</span></span> <span class="hljs-variable"><span class="koboSpan" id="kobo.2257.1">this</span></span><span class="koboSpan" id="kobo.2258.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2259.1">getLogsList</span></span><span class="koboSpan" id="kobo.2260.1">();
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2261.1">return</span></span><span class="koboSpan" id="kobo.2262.1"> logsElements.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2263.1">length</span></span><span class="koboSpan" id="kobo.2264.1">;
  }
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2265.1">protected</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2266.1">async</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2267.1">getLogTextAt</span></span><span class="koboSpan" id="kobo.2268.1">(</span><span class="hljs-attr"><span class="koboSpan" id="kobo.2269.1">index</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2270.1">: </span></span><span class="hljs-built_in"><span class="koboSpan" id="kobo.2271.1">number</span></span><span class="koboSpan" id="kobo.2272.1">) {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2273.1">const</span></span><span class="koboSpan" id="kobo.2274.1"> logsElements = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2275.1">await</span></span> <span class="hljs-variable"><span class="koboSpan" id="kobo.2276.1">this</span></span><span class="koboSpan" id="kobo.2277.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2278.1">getLogsList</span></span><span class="koboSpan" id="kobo.2279.1">();
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2280.1">return</span></span><span class="koboSpan" id="kobo.2281.1"> (</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2282.1">await</span></span><span class="koboSpan" id="kobo.2283.1"> logsElements[index].</span><span class="hljs-title"><span class="koboSpan" id="kobo.2284.1">text</span></span><span class="koboSpan" id="kobo.2285.1">()).</span><span class="hljs-title"><span class="koboSpan" id="kobo.2286.1">trim</span></span><span class="koboSpan" id="kobo.2287.1">();
  }
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2288.1">async</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2289.1">getFirstLogText</span></span><span class="koboSpan" id="kobo.2290.1">() {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2291.1">return</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2292.1">await</span></span> <span class="hljs-variable"><span class="koboSpan" id="kobo.2293.1">this</span></span><span class="koboSpan" id="kobo.2294.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2295.1">getLogTextAt</span></span><span class="koboSpan" id="kobo.2296.1">(</span><span class="hljs-number"><span class="koboSpan" id="kobo.2297.1">0</span></span><span class="koboSpan" id="kobo.2298.1">);
  }
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2299.1">async</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2300.1">getSecondLogText</span></span><span class="koboSpan" id="kobo.2301.1">() {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2302.1">return</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2303.1">await</span></span> <span class="hljs-variable"><span class="koboSpan" id="kobo.2304.1">this</span></span><span class="koboSpan" id="kobo.2305.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2306.1">getLogTextAt</span></span><span class="koboSpan" id="kobo.2307.1">(</span><span class="hljs-number"><span class="koboSpan" id="kobo.2308.1">1</span></span><span class="koboSpan" id="kobo.2309.1">);
  }
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2310.1">Finally, let’s modify</span><a id="_idIndexMarker844"/><span class="koboSpan" id="kobo.2311.1"> our final tests</span><a id="_idIndexMarker845"/><span class="koboSpan" id="kobo.2312.1"> in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2313.1">version-control.component.spec.ts</span></code><span class="koboSpan" id="kobo.2314.1"> file as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2315.1">...
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2316.1">import</span></span><span class="koboSpan" id="kobo.2317.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.2318.1">VersionControlComponentHarness</span></span><span class="koboSpan" id="kobo.2319.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2320.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2321.1">'./version-control.component.harness'</span></span><span class="koboSpan" id="kobo.2322.1">;
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2323.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2324.1"> { </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2325.1">VCLogsComponentHarness</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2326.1"> } </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2327.1">from</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2328.1">'../vc-logs/vc-logs.component.harness'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2329.1">;</span></strong></span>
<span class="hljs-title"><span class="koboSpan" id="kobo.2330.1">describe</span></span><span class="koboSpan" id="kobo.2331.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2332.1">'VersionControlComponent'</span></span><span class="koboSpan" id="kobo.2333.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.2334.1">() =&gt;</span></span><span class="koboSpan" id="kobo.2335.1"> {
  ...
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.2336.1">it</span></span><span class="koboSpan" id="kobo.2337.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2338.1">'should show the new log in the list after adding</span></span>
<span class="hljs-title"> </span><span class="hljs-string"><span class="koboSpan" id="kobo.2339.1"> submitting a new log'</span></span><span class="koboSpan" id="kobo.2340.1">, </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2341.1">async</span></span><span class="koboSpan" id="kobo.2342.1"> () =&gt; {
    </span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2343.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2344.1"> vcHarness = </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2345.1">await</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2346.1">TestbedHarnessEnvironment</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2347.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2348.1">harnessForFixture</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2349.1">(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2350.1">fixture,</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2351.1">VersionControlComponentHarness</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2352.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2353.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2354.1"> harnessLoader = </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2355.1">TestbedHarnessEnvironment</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2356.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2357.1">loader</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2358.1">(fixture);</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2359.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2360.1"> vcLogsHarness = </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2361.1">await</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2362.1"> harnessLoader.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2363.1">getHarness</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2364.1">(</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2365.1">VCLogsComponentHarness</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2366.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2367.1">const</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.2368.1">VERSION</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2369.1"> = </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2370.1">'2.3.6'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2371.1">;</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2372.1">await</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2373.1"> vcHarness.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2374.1">setNewAppVersion</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2375.1">(</span></strong><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.2376.1">VERSION</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2377.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2378.1">await</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2379.1"> vcHarness.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2380.1">clickSubmit</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2381.1">();</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2382.1">fixture.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2383.1">detectChanges</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2384.1">();</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2385.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2386.1"> logsLength = </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2387.1">await</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2388.1"> vcLogsHarness.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2389.1">getLogsLength</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2390.1">();</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2391.1">expect</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2392.1">(logsLength).</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2393.1">toBe</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2394.1">(</span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.2395.1">2</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2396.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2397.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2398.1"> firstLogText = </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2399.1">await</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2400.1"> vcLogsHarness</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2401.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2402.1">getFirstLogText</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2403.1">();</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2404.1">expect</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2405.1">(firstLogText).</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2406.1">toBe</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2407.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2408.1">`initial version is 0.0.0`</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2409.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2410.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2411.1"> secondLogText = </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2412.1">await</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2413.1"> vcLogsHarness</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2414.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2415.1">getSecondLogText</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2416.1">();</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2417.1">expect</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2418.1">(secondLogText).</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2419.1">toBe</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2420.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2421.1">`version changed to</span></strong></span>
<span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2422.1">2.3.6`</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2423.1">);</span></strong></span><span class="koboSpan" id="kobo.2424.1">
  });
});
</span></code></pre>
</li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.2425.1">Voilà! </span><span class="koboSpan" id="kobo.2425.2">That’s some amazing testing right there using the Angular CDK component harnesses. </span><span class="koboSpan" id="kobo.2425.3">If you run the tests now, you should see them all passing. </span><span class="koboSpan" id="kobo.2425.4">Now that you’ve finished the recipe, please refer</span><a id="_idIndexMarker846"/><span class="koboSpan" id="kobo.2426.1"> to the next section to learn</span><a id="_idIndexMarker847"/><span class="koboSpan" id="kobo.2427.1"> how this works.</span></p>
<h2 class="heading-2" id="_idParaDest-363"><span class="koboSpan" id="kobo.2428.1">How it works...</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2429.1">All right! </span><span class="koboSpan" id="kobo.2429.2">That was a cool recipe, and I enjoyed writing it too. </span><span class="koboSpan" id="kobo.2429.3">The key factor of this recipe is the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2430.1">@angular/cdk/testing</span></code><span class="koboSpan" id="kobo.2431.1"> package. </span><span class="koboSpan" id="kobo.2431.2">If you have worked with </span><code class="inlineCode"><span class="koboSpan" id="kobo.2432.1">e2e</span></code><span class="koboSpan" id="kobo.2433.1"> tests using Protractor before, this is a similar concept to the </span><strong class="keyWord"><span class="koboSpan" id="kobo.2434.1">Pages</span></strong><span class="koboSpan" id="kobo.2435.1"> or </span><strong class="keyWord"><span class="koboSpan" id="kobo.2436.1">Page Objects</span></strong><span class="koboSpan" id="kobo.2437.1"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.2438.1">POs</span></strong><span class="koboSpan" id="kobo.2439.1">) in Protractor. </span><span class="koboSpan" id="kobo.2439.2">The first thing we do</span><a id="_idIndexMarker848"/><span class="koboSpan" id="kobo.2440.1"> is to create a component </span><a id="_idIndexMarker849"/><span class="koboSpan" id="kobo.2441.1">harness for both the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2442.1">VCLogsComponent</span></code><span class="koboSpan" id="kobo.2443.1"> and the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2444.1">VersionControlComponent</span></code><span class="koboSpan" id="kobo.2445.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2446.1">Notice that we import the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2447.1">ComponentHarness</span></code><span class="koboSpan" id="kobo.2448.1"> class from </span><code class="inlineCode"><span class="koboSpan" id="kobo.2449.1">@angular/cdk/testing</span></code><span class="koboSpan" id="kobo.2450.1"> for both component harnesses. </span><span class="koboSpan" id="kobo.2450.2">Then, we extend our custom classes, called </span><code class="inlineCode"><span class="koboSpan" id="kobo.2451.1">VersionControlComponentHarness</span></code><span class="koboSpan" id="kobo.2452.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.2453.1">VCLogsComponentHarness</span></code><span class="koboSpan" id="kobo.2454.1">, from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2455.1">ComponentHarness</span></code><span class="koboSpan" id="kobo.2456.1"> class. </span><span class="koboSpan" id="kobo.2456.2">Essentially, this is the correct way to author component harnesses. </span><span class="koboSpan" id="kobo.2456.3">Did you notice the static property called </span><code class="inlineCode"><span class="koboSpan" id="kobo.2457.1">hostSelector</span></code><span class="koboSpan" id="kobo.2458.1">? </span><span class="koboSpan" id="kobo.2458.2">We need this property for every component harness class that we create, and the value is always the selector of the target element/component. </span><span class="koboSpan" id="kobo.2458.3">This ensures that when we load this harness into the test environment, the environment can find the host element in the DOM – for which we’re creating the component harness. </span><span class="koboSpan" id="kobo.2458.4">In our component harness class, we use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2459.1">this.locatorFor</span></code><span class="koboSpan" id="kobo.2460.1"> method to find elements within the</span><a id="_idIndexMarker850"/><span class="koboSpan" id="kobo.2461.1"> host component. </span><span class="koboSpan" id="kobo.2461.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.2462.1">locateFor</span></code><span class="koboSpan" id="kobo.2463.1"> method takes a single argument as the </span><strong class="keyWord"><span class="koboSpan" id="kobo.2464.1">CSS selector</span></strong><span class="koboSpan" id="kobo.2465.1"> of the element to be found, returning an </span><code class="inlineCode"><span class="koboSpan" id="kobo.2466.1">AsyncFactoryFn</span></code><span class="koboSpan" id="kobo.2467.1">. </span><span class="koboSpan" id="kobo.2467.2">This means the returned value is a function that we can use later to get the required elements.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2468.1">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2469.1">VersionControlComponentHarness</span></code><span class="koboSpan" id="kobo.2470.1"> class, we find the submit button and the version number input using the </span><em class="italic"><span class="koboSpan" id="kobo.2471.1">protected</span></em><span class="koboSpan" id="kobo.2472.1"> methods </span><code class="inlineCode"><span class="koboSpan" id="kobo.2473.1">getSubmitButton</span></code><span class="koboSpan" id="kobo.2474.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.2475.1">getAppVersionInput</span></code><span class="koboSpan" id="kobo.2476.1">, respectively. </span><span class="koboSpan" id="kobo.2476.2">All of these are of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2477.1">AsyncFactoryFn</span></code><span class="koboSpan" id="kobo.2478.1"> type, as mentioned earlier. </span><span class="koboSpan" id="kobo.2478.2">We have these methods set as </span><em class="italic"><span class="koboSpan" id="kobo.2479.1">protected</span></em><span class="koboSpan" id="kobo.2480.1"> because we don’t want the developers who write the unit tests to access or care about the information of the DOM elements. </span><span class="koboSpan" id="kobo.2480.2">This makes it much easier for everyone to write tests without worrying about the internal implementation of accessing the DOM.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2481.1">One important thing to mention</span><a id="_idIndexMarker851"/><span class="koboSpan" id="kobo.2482.1"> here is that when we call </span><a id="_idIndexMarker852"/><span class="koboSpan" id="kobo.2483.1">the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2484.1">locatorFor</span></code><span class="koboSpan" id="kobo.2485.1"> method or the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2486.1">locatorForAll</span></code><span class="koboSpan" id="kobo.2487.1"> method, we get back a </span><code class="inlineCode"><span class="koboSpan" id="kobo.2488.1">Promise</span></code><span class="koboSpan" id="kobo.2489.1"> with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2490.1">TestElement</span></code><span class="koboSpan" id="kobo.2491.1"> item or a </span><code class="inlineCode"><span class="koboSpan" id="kobo.2492.1">Promise</span></code><span class="koboSpan" id="kobo.2493.1"> with a list of </span><code class="inlineCode"><span class="koboSpan" id="kobo.2494.1">TestElement</span></code><span class="koboSpan" id="kobo.2495.1"> items, respectively. </span><span class="koboSpan" id="kobo.2495.2">Each </span><code class="inlineCode"><span class="koboSpan" id="kobo.2496.1">TestElement</span></code><span class="koboSpan" id="kobo.2497.1"> item has a bunch of handy methods, such as </span><code class="inlineCode"><span class="koboSpan" id="kobo.2498.1">click</span></code><span class="koboSpan" id="kobo.2499.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.2500.1">sendKeys</span></code><span class="koboSpan" id="kobo.2501.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.2502.1">focus</span></code><span class="koboSpan" id="kobo.2503.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.2504.1">blur</span></code><span class="koboSpan" id="kobo.2505.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.2506.1">getProperty</span></code><span class="koboSpan" id="kobo.2507.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.2508.1">text</span></code><span class="koboSpan" id="kobo.2509.1">, and more. </span><span class="koboSpan" id="kobo.2509.2">These methods are what we’re interested in, since we use them behind the scenes to interact with the DOM elements.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2510.1">Now, let’s talk about configuring the test environment. </span><span class="koboSpan" id="kobo.2510.2">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2511.1">version-control.component.spec.ts</span></code><span class="koboSpan" id="kobo.2512.1"> file, we set up the environment to use component harnesses for both </span><code class="inlineCode"><span class="koboSpan" id="kobo.2513.1">VCLogsComponent</span></code><span class="koboSpan" id="kobo.2514.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.2515.1">VersionControlComponent</span></code><span class="koboSpan" id="kobo.2516.1">. </span><span class="koboSpan" id="kobo.2516.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.2517.1">TestbedHarnessEnvironment</span></code><span class="koboSpan" id="kobo.2518.1"> element is the key element here. </span><span class="koboSpan" id="kobo.2518.2">We use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2519.1">TestbedHarnessEnvironment.harnessForFixture</span></code><span class="koboSpan" id="kobo.2520.1"> method first. </span><span class="koboSpan" id="kobo.2520.2">This is because we are writing tests for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2521.1">VersionControlComponent</span></code><span class="koboSpan" id="kobo.2522.1">, and we also want the harness of the same component as root. </span><span class="koboSpan" id="kobo.2522.2">Therefore, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2523.1">harnessForFixture</span></code><span class="koboSpan" id="kobo.2524.1"> method makes sense here. </span><span class="koboSpan" id="kobo.2524.2">This method takes the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2525.1">fixture</span></code><span class="koboSpan" id="kobo.2526.1"> as the first argument and the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2527.1">harness</span></code><span class="koboSpan" id="kobo.2528.1"> class as the second. </span><span class="koboSpan" id="kobo.2528.2">Then, we also use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2529.1">loader</span></code><span class="koboSpan" id="kobo.2530.1"> method of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2531.1">TestbedHarnessEnvironment</span></code><span class="koboSpan" id="kobo.2532.1"> class to get an instance of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2533.1">HarnessLoader</span></code><span class="koboSpan" id="kobo.2534.1">. </span><span class="koboSpan" id="kobo.2534.2">This loader can then get the harness of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2535.1">VCLogsComponent</span></code><span class="koboSpan" id="kobo.2536.1">, i.e., get the instance of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2537.1">VCLogsComponentHarness</span></code><span class="koboSpan" id="kobo.2538.1"> class. </span><span class="koboSpan" id="kobo.2538.2">Note that the fixture is what we get in the test environment using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2539.1">TestBed.createComponent(VersionControlComponent)</span></code><span class="koboSpan" id="kobo.2540.1"> statement.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2541.1">Notice that in the tests, we use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2542.1">harnessLoader.getHarness</span></code><span class="koboSpan" id="kobo.2543.1"> method by providing the harness class as an argument. </span><span class="koboSpan" id="kobo.2543.2">This enables the test environment to find the DOM element associated with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2544.1">hostSelector</span></code><span class="koboSpan" id="kobo.2545.1"> property of the harness class. </span><span class="koboSpan" id="kobo.2545.2">Additionally, we get back the instance of the component </span><a id="_idIndexMarker853"/><span class="koboSpan" id="kobo.2546.1">harness that we can use</span><a id="_idIndexMarker854"/><span class="koboSpan" id="kobo.2547.1"> further in the test.</span></p>
<h2 class="heading-2" id="_idParaDest-364"><span class="koboSpan" id="kobo.2548.1">See also</span></h2>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.2549.1">Finding components in the DOM</span><a id="_idIndexMarker855"/><span class="koboSpan" id="kobo.2550.1"> with component harnesses: </span><a href="https://material.angular.io/cdk/test-harnesses/overview#finding-elements-in-the-components-dom"><span class="url"><span class="koboSpan" id="kobo.2551.1">https://material.angular.io/cdk/test-harnesses/overview#finding-elements-in-the-components-dom</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2552.1">API for component </span><a id="_idIndexMarker856"/><span class="koboSpan" id="kobo.2553.1">harness authors: </span><a href="https://material.angular.io/cdk/test-harnesses/overview#api-for-component-harness-authors"><span class="url"><span class="koboSpan" id="kobo.2554.1">https://material.angular.io/cdk/test-harnesses/overview#api-for-component-harness-authors</span></span></a></li>
</ul>
<h1 class="heading-1" id="_idParaDest-365"><span class="koboSpan" id="kobo.2555.1">Unit-testing responses from HTTP calls</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.2556.1">If you’re building an Angular application, it is very likely that you’ll work with HTTP calls inside the app at some point. </span><span class="koboSpan" id="kobo.2556.2">For instance, you could be fetching data from a third-party API or just making APIs to your own server. </span><span class="koboSpan" id="kobo.2556.3">In either case, it becomes slightly difficult to test applications that have HTTP calls in action. </span><span class="koboSpan" id="kobo.2556.4">In this</span><a id="_idIndexMarker857"/><span class="koboSpan" id="kobo.2557.1"> recipe, we’re going</span><a id="_idIndexMarker858"/><span class="koboSpan" id="kobo.2558.1"> to learn how to create unit-tests with HTTP calls.</span></p>
<h2 class="heading-2" id="_idParaDest-366"><span class="koboSpan" id="kobo.2559.1">Getting ready</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2560.1">The app that we are going to work with now resides in </span><code class="inlineCode"><span class="koboSpan" id="kobo.2561.1">start/apps/chapter10/ng-test-http-resp</span></code><span class="koboSpan" id="kobo.2562.1"> inside the cloned repository:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.2563.1">Open the code repository in your code editor.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2564.1">Open the terminal, navigate to the code repository directory, and run the following command to serve the project:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2565.1">npm run serve ng-test-http-resp
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2566.1">This should open the app in a new browser tab, and you should see the following:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2567.1"><img alt="" role="presentation" src="../Images/B18469_10_14.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2568.1">Figure 10.14: The ng-test-http-resp app running on http://localhost:4200</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2569.1">Let’s also run the tests. </span><span class="koboSpan" id="kobo.2569.2">Right now, the test for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2570.1">UserService</span></code><span class="koboSpan" id="kobo.2571.1">, which fetches the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2572.1">HTTP</span></code><span class="koboSpan" id="kobo.2573.1"> response, doesn’t pass. </span><span class="koboSpan" id="kobo.2573.2">You should</span><a id="_idIndexMarker859"/><span class="koboSpan" id="kobo.2574.1"> see an output</span><a id="_idIndexMarker860"/><span class="koboSpan" id="kobo.2575.1"> similar to </span><em class="italic"><span class="koboSpan" id="kobo.2576.1">Figure 10.15</span></em><span class="koboSpan" id="kobo.2577.1">:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2578.1"><img alt="" role="presentation" src="../Images/B18469_10_15.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2579.1">Figure 10.15: Test failing for the UserService</span></p> </li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.2580.1">Now that we have the app and tests running locally, in the next section, let’s take a look at the steps of the recipe.</span></p>
<h2 class="heading-2" id="_idParaDest-367"><span class="koboSpan" id="kobo.2581.1">How to do it...</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2582.1">We’ll write one single test that checks if the service’s </span><code class="inlineCode"><span class="koboSpan" id="kobo.2583.1">getUser</span></code><span class="koboSpan" id="kobo.2584.1"> method returns the correct data. </span><span class="koboSpan" id="kobo.2584.2">If you open the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2585.1">UserService</span></code><span class="koboSpan" id="kobo.2586.1">, you’ll notice that the service fetches the users using an HTTP call and then</span><a id="_idIndexMarker861"/><span class="koboSpan" id="kobo.2587.1"> modifies the data to add the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2588.1">fullAddress</span></code><span class="koboSpan" id="kobo.2589.1"> property. </span><span class="koboSpan" id="kobo.2589.2">Our test should expect the same</span><a id="_idIndexMarker862"/><span class="koboSpan" id="kobo.2590.1"> to happen. </span><span class="koboSpan" id="kobo.2590.2">Let’s get started:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.2591.1">First and foremost, we’ll fix the failing test. </span><span class="koboSpan" id="kobo.2591.2">We’ll add the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2592.1">HttpClientModule</span></code><span class="koboSpan" id="kobo.2593.1"> class to the test in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2594.1">imports</span></code><span class="koboSpan" id="kobo.2595.1"> array. </span><span class="koboSpan" id="kobo.2595.2">Update the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2596.1">user.service.spec.ts</span></code><span class="koboSpan" id="kobo.2597.1"> as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2598.1">...
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2599.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2600.1"> { </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2601.1">HttpClientModule</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2602.1"> } </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2603.1">from</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2604.1">'</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2605.1">@angular/common/http'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2606.1">;</span></strong></span>
<span class="hljs-title"><span class="koboSpan" id="kobo.2607.1">describe</span></span><span class="koboSpan" id="kobo.2608.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2609.1">'UserService'</span></span><span class="koboSpan" id="kobo.2610.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.2611.1">() =&gt;</span></span><span class="koboSpan" id="kobo.2612.1"> {
  ...
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.2613.1">beforeEach</span></span><span class="koboSpan" id="kobo.2614.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.2615.1">() =&gt;</span></span><span class="koboSpan" id="kobo.2616.1"> {
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.2617.1">TestBed</span></span><span class="koboSpan" id="kobo.2618.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2619.1">configureTestingModule</span></span><span class="koboSpan" id="kobo.2620.1">(</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2621.1">{</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2622.1">imports</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2623.1">: [</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2624.1">HttpClientModule</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2625.1">],</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2626.1">}</span></strong></span><span class="koboSpan" id="kobo.2627.1">);
    service = </span><span class="hljs-title"><span class="koboSpan" id="kobo.2628.1">TestBed</span></span><span class="koboSpan" id="kobo.2629.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2630.1">inject</span></span><span class="koboSpan" id="kobo.2631.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.2632.1">UserService</span></span><span class="koboSpan" id="kobo.2633.1">);
  });
  ...
</span><span class="koboSpan" id="kobo.2633.2">});
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2634.1">Now, as soon as you run the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2635.1">npm run test</span></code><span class="koboSpan" id="kobo.2636.1"> command, you’ll see that the tests pass now as follows:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2637.1"><img alt="" role="presentation" src="../Images/B18469_10_16.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2638.1">Figure 10.16: Tests passing for the UserService as well</span></p> </li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="2"><span class="koboSpan" id="kobo.2639.1">Now, we’ll import the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2640.1">HttpClientTestingModule</span></code><span class="koboSpan" id="kobo.2641.1"> in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2642.1">user.service.spec.ts</span></code><span class="koboSpan" id="kobo.2643.1"> file to be able to use it to intercept HTTP calls. </span><span class="koboSpan" id="kobo.2643.2">Modify the file as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2644.1">...
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2645.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2646.1"> { </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2647.1">HttpClientTestingModule</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2648.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2649.1">} </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2650.1">from</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2651.1">'@angular/common/http/testing'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2652.1">;</span></strong></span><span class="koboSpan" id="kobo.2653.1">
...
</span><span class="hljs-title"><span class="koboSpan" id="kobo.2654.1">describe</span></span><span class="koboSpan" id="kobo.2655.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2656.1">'UserService'</span></span><span class="koboSpan" id="kobo.2657.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.2658.1">() =&gt;</span></span><span class="koboSpan" id="kobo.2659.1"> {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2660.1">let</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.2661.1">service</span></span><span class="koboSpan" id="kobo.2662.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.2663.1">UserService</span></span><span class="koboSpan" id="kobo.2664.1">;
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.2665.1">beforeEach</span></span><span class="koboSpan" id="kobo.2666.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.2667.1">() =&gt;</span></span><span class="koboSpan" id="kobo.2668.1"> {
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.2669.1">TestBed</span></span><span class="koboSpan" id="kobo.2670.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2671.1">configureTestingModule</span></span><span class="koboSpan" id="kobo.2672.1">({
      </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2673.1">imports</span></span><span class="koboSpan" id="kobo.2674.1">: [</span><span class="hljs-title"><span class="koboSpan" id="kobo.2675.1">HttpClientModule</span></span><span class="koboSpan" id="kobo.2676.1">, </span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2677.1">HttpClientTestingModule</span></strong></span><span class="koboSpan" id="kobo.2678.1">],
    });
    service = </span><span class="hljs-title"><span class="koboSpan" id="kobo.2679.1">TestBed</span></span><span class="koboSpan" id="kobo.2680.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2681.1">inject</span></span><span class="koboSpan" id="kobo.2682.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.2683.1">UserService</span></span><span class="koboSpan" id="kobo.2684.1">);
  });
});
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2685.1">Let’s create a controller</span><a id="_idIndexMarker863"/><span class="koboSpan" id="kobo.2686.1"> using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2687.1">HttpTestingController</span></code><span class="koboSpan" id="kobo.2688.1"> class</span><a id="_idIndexMarker864"/><span class="koboSpan" id="kobo.2689.1"> from the same </span><code class="inlineCode"><span class="koboSpan" id="kobo.2690.1">@angular/common/http/testing</span></code><span class="koboSpan" id="kobo.2691.1"> package. </span><span class="koboSpan" id="kobo.2691.2">We’ll use this controller later to expect and intercept the HTTP calls. </span><span class="koboSpan" id="kobo.2691.3">Update the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2692.1">user.service.spec.ts</span></code><span class="koboSpan" id="kobo.2693.1"> file as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2694.1">...
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2695.1">import</span></span><span class="koboSpan" id="kobo.2696.1"> {
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.2697.1">HttpClientTestingModule</span></span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2698.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2699.1">HttpTestingController</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2700.1">,</span></strong></span><span class="koboSpan" id="kobo.2701.1">
} </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2702.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2703.1">'@angular/common/http/testing'</span></span><span class="koboSpan" id="kobo.2704.1">;
</span><span class="hljs-title"><span class="koboSpan" id="kobo.2705.1">describe</span></span><span class="koboSpan" id="kobo.2706.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2707.1">'UserService'</span></span><span class="koboSpan" id="kobo.2708.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.2709.1">() =&gt;</span></span><span class="koboSpan" id="kobo.2710.1"> {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2711.1">let</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.2712.1">service</span></span><span class="koboSpan" id="kobo.2713.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.2714.1">UserService</span></span><span class="koboSpan" id="kobo.2715.1">;
  </span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2716.1">let</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2717.1">httpTestingController</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2718.1">: </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2719.1">HttpTestingController</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2720.1">;</span></strong></span>
<span class="hljs-title"><span class="koboSpan" id="kobo.2721.1">beforeEach</span></span><span class="koboSpan" id="kobo.2722.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.2723.1">() =&gt;</span></span><span class="koboSpan" id="kobo.2724.1"> {
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.2725.1">TestBed</span></span><span class="koboSpan" id="kobo.2726.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2727.1">configureTestingModule</span></span><span class="koboSpan" id="kobo.2728.1">({...});
    service = </span><span class="hljs-title"><span class="koboSpan" id="kobo.2729.1">TestBed</span></span><span class="koboSpan" id="kobo.2730.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2731.1">inject</span></span><span class="koboSpan" id="kobo.2732.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.2733.1">UserService</span></span><span class="koboSpan" id="kobo.2734.1">);
    </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2735.1">httpTestingController = </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2736.1">TestBed</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2737.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2738.1">inject</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2739.1">(</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2740.1">HttpTestingController</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2741.1">);</span></strong></span><span class="koboSpan" id="kobo.2742.1">
  });
});
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2743.1">Now, we’ll write a test (finally). </span><span class="koboSpan" id="kobo.2743.2">We’ll intercept the HTTP call to </span><code class="inlineCode"><span class="koboSpan" id="kobo.2744.1">/assets/users.json</span></code><span class="koboSpan" id="kobo.2745.1"> using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2746.1">httpTestingController</span></code><span class="koboSpan" id="kobo.2747.1">, and then we will compare the result with our expected data. </span><span class="koboSpan" id="kobo.2747.2">Update the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2748.1">user.service.ts</span></code><span class="koboSpan" id="kobo.2749.1"> file by adding a test, as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2750.1">...
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2751.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2752.1"> { </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2753.1">User</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2754.1"> } </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2755.1">from</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2756.1">'../user.interface'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2757.1">;</span></strong></span>
<span class="hljs-title"><span class="koboSpan" id="kobo.2758.1">describe</span></span><span class="koboSpan" id="kobo.2759.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2760.1">'UserService'</span></span><span class="koboSpan" id="kobo.2761.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.2762.1">() =&gt;</span></span><span class="koboSpan" id="kobo.2763.1"> {
  ...
  </span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2764.1">it</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2765.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2766.1">'should return expected user data (HttpClient called</span></strong></span>
<span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2767.1">once)'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2768.1">, </span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.2769.1">() =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2770.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2771.1">const</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2772.1">mockUsers</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2773.1">: </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2774.1">User</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2775.1">[] = [];</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2776.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2777.1"> req = httpTestingController</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2778.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2779.1">expectOne</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2780.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2781.1">'assets/users.json'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2782.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2783.1">expect</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2784.1">(req.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.2785.1">request</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2786.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.2787.1">method</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2788.1">).</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2789.1">toEqual</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2790.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2791.1">'GET'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2792.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2793.1">req.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2794.1">flush</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2795.1">(mockUsers); </span></strong><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.2796.1">// Respond with mocked data</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2797.1">});</span></strong></span><span class="koboSpan" id="kobo.2798.1">
});
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2799.1">We’ll add an </span><code class="inlineCode"><span class="koboSpan" id="kobo.2800.1">afterEach</span></code><span class="koboSpan" id="kobo.2801.1"> hook</span><a id="_idIndexMarker865"/><span class="koboSpan" id="kobo.2802.1"> in the tests to verify that there are no pending</span><a id="_idIndexMarker866"/><span class="koboSpan" id="kobo.2803.1"> requests after our test. </span><span class="koboSpan" id="kobo.2803.2">Let’s add it to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2804.1">user.service.spec.ts</span></code><span class="koboSpan" id="kobo.2805.1"> file as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2806.1">...
</span><span class="hljs-title"><span class="koboSpan" id="kobo.2807.1">describe</span></span><span class="koboSpan" id="kobo.2808.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2809.1">'UserService'</span></span><span class="koboSpan" id="kobo.2810.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.2811.1">() =&gt;</span></span><span class="koboSpan" id="kobo.2812.1"> {
  ...
  </span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2813.1">afterEach</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2814.1">(</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.2815.1">() =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2816.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.2817.1">// After every test, assert that there are no more</span></strong></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.2818.1">pending requests.</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2819.1">httpTestingController.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2820.1">verify</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2821.1">();</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2822.1">});</span></strong></span><span class="koboSpan" id="kobo.2823.1">
  ...
</span><span class="koboSpan" id="kobo.2823.2">});
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2824.1">Now, let’s populate the mock data (the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2825.1">mockUsers</span></code><span class="koboSpan" id="kobo.2826.1"> array) with two users. </span><span class="koboSpan" id="kobo.2826.2">Since we’re using </span><code class="inlineCode"><span class="koboSpan" id="kobo.2827.1">req.flush(mockUsers)</span></code><span class="koboSpan" id="kobo.2828.1">, the HTTP call will be intercepted, and this data (</span><code class="inlineCode"><span class="koboSpan" id="kobo.2829.1">mockUsers</span></code><span class="koboSpan" id="kobo.2830.1"> array) will be returned from it as a response. </span><span class="koboSpan" id="kobo.2830.2">Replace the test </span><code class="inlineCode"><span class="koboSpan" id="kobo.2831.1">it('should return expected user data (HttpClient called once)'</span></code><span class="koboSpan" id="kobo.2832.1"> in the file </span><code class="inlineCode"><span class="koboSpan" id="kobo.2833.1">user.service.spec.ts</span></code><span class="koboSpan" id="kobo.2834.1"> with the snippet from </span><a href="https://ng-cookbook.com/s/ng-test-http-mock-users"><span class="url"><span class="koboSpan" id="kobo.2835.1">https://ng-cookbook.com/s/ng-test-http-mock-users</span></span></a><span class="koboSpan" id="kobo.2836.1">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2837.1">Finally, update the test further to make the http call, using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2838.1">getUsers</span></code><span class="koboSpan" id="kobo.2839.1"> method, and see if we can expect </span><a id="_idIndexMarker867"/><span class="koboSpan" id="kobo.2840.1">the transformed data. </span><span class="koboSpan" id="kobo.2840.2">Update</span><a id="_idIndexMarker868"/><span class="koboSpan" id="kobo.2841.1"> the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2842.1">user.service.spec.ts</span></code><span class="koboSpan" id="kobo.2843.1"> file, as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.2844.1">describe</span></span><span class="koboSpan" id="kobo.2845.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2846.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2847.1">UserService'</span></span><span class="koboSpan" id="kobo.2848.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.2849.1">() =&gt;</span></span><span class="koboSpan" id="kobo.2850.1"> {
  ...
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.2851.1">it</span></span><span class="koboSpan" id="kobo.2852.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2853.1">'should return expected user data (HttpClient called</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.2854.1">once)'</span></span><span class="koboSpan" id="kobo.2855.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.2856.1">(</span></span><span class="code-highlight"><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.2857.1">done</span></strong></span><span class="hljs-function"><span class="koboSpan" id="kobo.2858.1">) =&gt;</span></span><span class="koboSpan" id="kobo.2859.1"> {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2860.1">const</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.2861.1">mockUsers</span></span><span class="koboSpan" id="kobo.2862.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.2863.1">User</span></span><span class="koboSpan" id="kobo.2864.1">[] = [...];
    </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2865.1">service.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2866.1">getUsers</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2867.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2868.1">subscribe</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2869.1">({</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2870.1">next</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2871.1">: </span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.2872.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.2873.1">data</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.2874.1">) =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2875.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2876.1">expect</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2877.1">(data).</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2878.1">toEqual</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2879.1">([{</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2880.1">...mockUsers[</span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.2881.1">0</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2882.1">],</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2883.1">fullAddress</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2884.1">: </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2885.1">'sample street 1, 123 ABC, Dream</span></strong></span>
<span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2886.1">city, 4567'</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2887.1">}, {</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2888.1">...mockUsers[</span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.2889.1">1</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2890.1">],</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2891.1">fullAddress</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2892.1">: </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2893.1">'sample street 2, 123 ABC, Dream</span></strong></span>
<span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2894.1">city, 890'</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2895.1">}]);</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2896.1">done</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2897.1">();</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2898.1">},</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2899.1">error</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2900.1">: </span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.2901.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.2902.1">err</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.2903.1">) =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2904.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.2905.1">console</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2906.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2907.1">log</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2908.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2909.1">'</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2910.1">Error: '</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2911.1">, err);</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2912.1">},</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2913.1">});</span></strong></span><span class="koboSpan" id="kobo.2914.1">
    ...
  </span><span class="koboSpan" id="kobo.2914.2">});
});
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2915.1">If you run the tests, you should see them all pass as follows:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2916.1"><img alt="" role="presentation" src="../Images/B18469_10_17.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2917.1">Figure 10.17: All of the tests pass</span></p> </li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.2918.1">Great! </span><span class="koboSpan" id="kobo.2918.2">You now know how to work with </span><code class="inlineCode"><span class="koboSpan" id="kobo.2919.1">HttpTestingController</span></code><span class="koboSpan" id="kobo.2920.1"> to test services that have methods, using HTTP calls. </span><span class="koboSpan" id="kobo.2920.2">Although there’s still a lot to learn about testing HTTP calls and Observables in Angular, the purpose of this recipe was to keep everything simple and sweet.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2921.1">Now that you have finished</span><a id="_idIndexMarker869"/><span class="koboSpan" id="kobo.2922.1"> the recipe, please refer to the next section to understand</span><a id="_idIndexMarker870"/><span class="koboSpan" id="kobo.2923.1"> how it works.</span></p>
<h2 class="heading-2" id="_idParaDest-368"><span class="koboSpan" id="kobo.2924.1">How it works...</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2925.1">The hero of this recipe is the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2926.1">HttpClientTestingModule</span></code><span class="koboSpan" id="kobo.2927.1">, which allows us to use an instance of </span><code class="inlineCode"><span class="koboSpan" id="kobo.2928.1">HttpTestingController</span></code><span class="koboSpan" id="kobo.2929.1">. </span><span class="koboSpan" id="kobo.2929.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.2930.1">HttpTestingController</span></code><span class="koboSpan" id="kobo.2931.1"> makes it easy to intercept the HTTP calls in our code and allows us to return a specific response. </span><span class="koboSpan" id="kobo.2931.2">This makes it easier for us to not have our Angular services tested with real HTTP calls, which can be expensive. </span><span class="koboSpan" id="kobo.2931.3">Another benefit of this approach to mocking the response is always having the same response object to work with. </span><span class="koboSpan" id="kobo.2931.4">In our case, our </span><code class="inlineCode"><span class="koboSpan" id="kobo.2932.1">getUsers</span></code><span class="koboSpan" id="kobo.2933.1"> method not only made an HTTP call but also transformed data, using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2934.1">map</span></code><span class="koboSpan" id="kobo.2935.1"> operator from </span><code class="inlineCode"><span class="koboSpan" id="kobo.2936.1">RxJs</span></code><span class="koboSpan" id="kobo.2937.1">. </span><span class="koboSpan" id="kobo.2937.2">Therefore, we used an array of mocked users and expected the result from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2938.1">getUsers</span></code><span class="koboSpan" id="kobo.2939.1"> method to have the transformed data, i.e., including the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2940.1">fullAddress</span></code><span class="koboSpan" id="kobo.2941.1"> property containing the right data. </span><span class="koboSpan" id="kobo.2941.2">You can see in the test that we use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2942.1">HttpTestingController.expectOne</span></code><span class="koboSpan" id="kobo.2943.1"> method, telling our test that there should be only one request when we run the test. </span><span class="koboSpan" id="kobo.2943.2">We expect the method of that request to be </span><code class="inlineCode"><span class="koboSpan" id="kobo.2944.1">GET</span></code><span class="koboSpan" id="kobo.2945.1">. </span><span class="koboSpan" id="kobo.2945.2">Then, we expect that the returned value</span><a id="_idIndexMarker871"/><span class="koboSpan" id="kobo.2946.1"> from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2947.1">getUsers</span></code><span class="koboSpan" id="kobo.2948.1"> method has an array of users</span><a id="_idIndexMarker872"/><span class="koboSpan" id="kobo.2949.1"> containing the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2950.1">fullAddress</span></code><span class="koboSpan" id="kobo.2951.1"> property.</span></p>
<h2 class="heading-2" id="_idParaDest-369"><span class="koboSpan" id="kobo.2952.1">See also</span></h2>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.2953.1">Angular testing</span><a id="_idIndexMarker873"/><span class="koboSpan" id="kobo.2954.1"> component scenarios: </span><a href="https://docs.angular.lat/guide/testing-components-scenarios"><span class="url"><span class="koboSpan" id="kobo.2955.1">https://docs.angular.lat/guide/testing-components-scenarios</span></span></a></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.2956.1">HttpTestingController</span></code> <a id="_idIndexMarker874"/><span class="koboSpan" id="kobo.2957.1">docs: </span><a href="https://angular.io/api/common/http/testing/HttpTestingController"><span class="url"><span class="koboSpan" id="kobo.2958.1">https://angular.io/api/common/http/testing/HttpTestingController</span></span></a></li>
</ul>
<h1 class="heading-1" id="_idParaDest-370"><span class="koboSpan" id="kobo.2959.1">Unit-testing Angular pipes</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.2960.1">In my opinion, pipes are the easiest</span><a id="_idIndexMarker875"/><span class="koboSpan" id="kobo.2961.1"> thing to test in an Angular application. </span><span class="koboSpan" id="kobo.2961.2">Why? </span><span class="koboSpan" id="kobo.2961.3">Well, this</span><a id="_idIndexMarker876"/><span class="koboSpan" id="kobo.2962.1"> is because they’re (supposed to be) pure functions that return the same result based on the same set of inputs. </span><span class="koboSpan" id="kobo.2962.2">In this recipe, we’ll write some tests for a simple pipe in an Angular application.</span></p>
<h2 class="heading-2" id="_idParaDest-371"><span class="koboSpan" id="kobo.2963.1">Getting ready</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2964.1">The app that we are going to work with now resides in </span><code class="inlineCode"><span class="koboSpan" id="kobo.2965.1">start/apps/chapter10/ng-test-pipes</span></code><span class="koboSpan" id="kobo.2966.1"> inside the cloned repository:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.2967.1">Open the code repository in your code editor.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2968.1">Open the terminal, navigate to the code repository directory, and run the following command to serve the project:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2969.1">npm run serve ng-test-pipes
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2970.1">This should open the app in a new browser tab, and you should see the following:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2971.1"><img alt="" role="presentation" src="../Images/B18469_10_18.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2972.1">Figure 10.18: The ng-test-pipes app running on http://localhost:4200</span></p></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.2973.1">Now that we have the app running locally, in the next section, let’s go through the steps of the recipe.</span></p>
<h2 class="heading-2" id="_idParaDest-372"><span class="koboSpan" id="kobo.2974.1">How to do it...</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2975.1">Here, we have a simple recipe that takes</span><a id="_idIndexMarker877"/><span class="koboSpan" id="kobo.2976.1"> two inputs – the digit and the max factor value. </span><span class="koboSpan" id="kobo.2976.2">Based </span><a id="_idIndexMarker878"/><span class="koboSpan" id="kobo.2977.1">on these inputs, we show a multiplication table. </span><span class="koboSpan" id="kobo.2977.2">We already have the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2978.1">MultTablePipe</span></code><span class="koboSpan" id="kobo.2979.1"> that is working fine according to our business logic. </span><span class="koboSpan" id="kobo.2979.2">We’ll now write some unit tests to validate our inputs and expected outputs, as follows:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.2980.1">Let’s write our first custom test for </span><code class="inlineCode"><span class="koboSpan" id="kobo.2981.1">MultTablePipe</span></code><span class="koboSpan" id="kobo.2982.1">. </span><span class="koboSpan" id="kobo.2982.2">We’ll make sure it returns an empty array when we have an invalid value for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2983.1">digit</span></code><span class="koboSpan" id="kobo.2984.1"> input. </span><span class="koboSpan" id="kobo.2984.2">Replace the whole </span><code class="inlineCode"><span class="koboSpan" id="kobo.2985.1">mult-table.pipe.spec.ts</span></code><span class="koboSpan" id="kobo.2986.1"> file with the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2987.1">import</span></span><span class="koboSpan" id="kobo.2988.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.2989.1">MultTablePipe</span></span><span class="koboSpan" id="kobo.2990.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2991.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2992.1">'./mult-table.pipe'</span></span><span class="koboSpan" id="kobo.2993.1">;
</span><span class="hljs-title"><span class="koboSpan" id="kobo.2994.1">describe</span></span><span class="koboSpan" id="kobo.2995.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2996.1">'MultTablePipe'</span></span><span class="koboSpan" id="kobo.2997.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.2998.1">() =&gt;</span></span><span class="koboSpan" id="kobo.2999.1"> {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3000.1">let</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.3001.1">pipe</span></span><span class="koboSpan" id="kobo.3002.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.3003.1">MultTablePipe</span></span><span class="koboSpan" id="kobo.3004.1">;
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.3005.1">beforeEach</span></span><span class="koboSpan" id="kobo.3006.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.3007.1">() =&gt;</span></span><span class="koboSpan" id="kobo.3008.1"> {
    pipe = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3009.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.3010.1">MultTablePipe</span></span><span class="koboSpan" id="kobo.3011.1">();
  })
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.3012.1">it</span></span><span class="koboSpan" id="kobo.3013.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.3014.1">'should return an empty array if the value of digit</span></span>
<span class="hljs-title"> </span><span class="hljs-string"><span class="koboSpan" id="kobo.3015.1"> is not valid'</span></span><span class="koboSpan" id="kobo.3016.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.3017.1">() =&gt;</span></span><span class="koboSpan" id="kobo.3018.1"> {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3019.1">const</span></span><span class="koboSpan" id="kobo.3020.1"> digit = </span><span class="hljs-number"><span class="koboSpan" id="kobo.3021.1">0</span></span><span class="koboSpan" id="kobo.3022.1">;
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3023.1">const</span></span><span class="koboSpan" id="kobo.3024.1"> limit = </span><span class="hljs-number"><span class="koboSpan" id="kobo.3025.1">10</span></span><span class="koboSpan" id="kobo.3026.1">;
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.3027.1">const</span></span><span class="koboSpan" id="kobo.3028.1"> outputArray = pipe.</span><span class="hljs-title"><span class="koboSpan" id="kobo.3029.1">transform</span></span><span class="koboSpan" id="kobo.3030.1">(</span><span class="hljs-literal"><span class="koboSpan" id="kobo.3031.1">null</span></span><span class="koboSpan" id="kobo.3032.1">, digit, limit);
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.3033.1">expect</span></span><span class="koboSpan" id="kobo.3034.1">(outputArray).</span><span class="hljs-title"><span class="koboSpan" id="kobo.3035.1">toEqual</span></span><span class="koboSpan" id="kobo.3036.1">([]);
  });
});
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.3037.1">Let’s write another test to validate the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3038.1">limit</span></code><span class="koboSpan" id="kobo.3039.1"> input so that we also return an empty array if it is invalid:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.3040.1">...
</span><span class="hljs-title"><span class="koboSpan" id="kobo.3041.1">describe</span></span><span class="koboSpan" id="kobo.3042.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.3043.1">'MultTablePipe'</span></span><span class="koboSpan" id="kobo.3044.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.3045.1">() =&gt;</span></span><span class="koboSpan" id="kobo.3046.1"> {
  ...
  </span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.3047.1">it</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3048.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.3049.1">'should return an empty array if the value of limit</span></strong></span>
<span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.3050.1">is not valid'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3051.1">, </span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.3052.1">() =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3053.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.3054.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3055.1"> digit = </span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.3056.1">10</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3057.1">;</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.3058.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3059.1"> limit = </span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.3060.1">0</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3061.1">;</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.3062.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3063.1"> outputArray = pipe.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.3064.1">transform</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3065.1">(</span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.3066.1">null</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3067.1">, digit,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3068.1">limit);</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.3069.1">expect</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3070.1">(outputArray).</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.3071.1">toEqual</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3072.1">([]);</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3073.1">});</span></strong></span><span class="koboSpan" id="kobo.3074.1">
});
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.3075.1">Now, we’ll write a test to validate the output of the pipe’s </span><code class="inlineCode"><span class="koboSpan" id="kobo.3076.1">transform</span></code><span class="koboSpan" id="kobo.3077.1"> method when both the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3078.1">digit</span></code><span class="koboSpan" id="kobo.3079.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.3080.1">limit</span></code><span class="koboSpan" id="kobo.3081.1"> inputs are valid. </span><span class="koboSpan" id="kobo.3081.2">In this scenario, we should get back the array containing</span><a id="_idIndexMarker879"/><span class="koboSpan" id="kobo.3082.1"> the multiplication table. </span><span class="koboSpan" id="kobo.3082.2">Write another</span><a id="_idIndexMarker880"/><span class="koboSpan" id="kobo.3083.1"> test as follows:
        </span><pre class="programlisting code"><code class="hljs-code"> <span class="hljs-title"><span class="koboSpan" id="kobo.3084.1">describe</span></span><span class="koboSpan" id="kobo.3085.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.3086.1">'MultTablePipe'</span></span><span class="koboSpan" id="kobo.3087.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.3088.1">() =&gt;</span></span><span class="koboSpan" id="kobo.3089.1"> {
  ...
  </span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.3090.1">it</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3091.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.3092.1">'should return the correct multiplication table</span></strong></span>
<span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.3093.1">when both digit and limit inputs are valid'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3094.1">, </span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.3095.1">() =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3096.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.3097.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3098.1"> digit = </span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.3099.1">10</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3100.1">;</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.3101.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3102.1"> limit = </span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.3103.1">2</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3104.1">;</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.3105.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3106.1"> expectedArray = [{ </span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.3107.1">digit</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3108.1">: </span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.3109.1">10</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3110.1">, </span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.3111.1">factor</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3112.1">: </span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.3113.1">1</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3114.1">, </span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.3115.1">result</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3116.1">:</span></strong></span>
<span class="code-highlight"><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.3117.1">10</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3118.1"> },</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3119.1">{ </span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.3120.1">digit</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3121.1">: </span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.3122.1">10</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3123.1">, </span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.3124.1">factor</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3125.1">: </span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.3126.1">2</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3127.1">, </span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.3128.1">result</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3129.1">: </span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.3130.1">20</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3131.1"> },];</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.3132.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3133.1"> outputArray = pipe.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.3134.1">transform</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3135.1">(</span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.3136.1">null</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3137.1">, digit, limit);</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.3138.1">expect</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3139.1">(outputArray).</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.3140.1">toEqual</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3141.1">(expectedArray);</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3142.1">});</span></strong></span><span class="koboSpan" id="kobo.3143.1">
});
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.3144.1">Right now, within the app, we have the possibility to provide decimal digits for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.3145.1">limit</span></code><span class="koboSpan" id="kobo.3146.1"> input. </span><span class="koboSpan" id="kobo.3146.2">For instance, we can write </span><code class="inlineCode"><span class="koboSpan" id="kobo.3147.1">2.5</span></code><span class="koboSpan" id="kobo.3148.1"> as the max factor in the input. </span><span class="koboSpan" id="kobo.3148.2">To handle this, we use a </span><code class="inlineCode"><span class="koboSpan" id="kobo.3149.1">Math.floor</span></code><span class="koboSpan" id="kobo.3150.1"> in </span><code class="inlineCode"><span class="koboSpan" id="kobo.3151.1">MultTablePipe</span></code><span class="koboSpan" id="kobo.3152.1"> to round it down to the lower number. </span><span class="koboSpan" id="kobo.3152.2">Let’s write a test to make sure this works:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.3153.1">...
</span><span class="hljs-title"><span class="koboSpan" id="kobo.3154.1">describe</span></span><span class="koboSpan" id="kobo.3155.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.3156.1">'MultTablePipe'</span></span><span class="koboSpan" id="kobo.3157.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.3158.1">() =&gt;</span></span><span class="koboSpan" id="kobo.3159.1"> {
  ...
  </span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.3160.1">it</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3161.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.3162.1">'should round of the limit if it is provided</span></strong></span>
<span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.3163.1">in decimals'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3164.1">, </span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.3165.1">() =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3166.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.3167.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3168.1"> digit = </span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.3169.1">10</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3170.1">;</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.3171.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3172.1"> limit = </span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.3173.1">3.5</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3174.1">;</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.3175.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3176.1"> expectedArray = [</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3177.1">{</span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.3178.1">digit</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3179.1">: </span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.3180.1">10</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3181.1">, </span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.3182.1">factor</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3183.1">: </span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.3184.1">1</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3185.1">, </span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.3186.1">result</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3187.1">: </span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.3188.1">10</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3189.1">},</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3190.1">{</span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.3191.1">digit</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3192.1">: </span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.3193.1">10</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3194.1">, </span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.3195.1">factor</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3196.1">: </span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.3197.1">2</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3198.1">, </span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.3199.1">result</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3200.1">: </span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.3201.1">20</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3202.1">},</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3203.1">{</span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.3204.1">digit</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3205.1">: </span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.3206.1">10</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3207.1">, </span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.3208.1">factor</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3209.1">: </span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.3210.1">3</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3211.1">, </span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.3212.1">result</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3213.1">: </span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.3214.1">30</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3215.1">}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3216.1">]; </span></strong><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.3217.1">// rounded off to 3 factors instead of 3.5</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.3218.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3219.1"> outputArray = pipe.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.3220.1">transform</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3221.1">(</span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.3222.1">null</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3223.1">, digit, limit);</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.3224.1">expect</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3225.1">(outputArray).</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.3226.1">toEqual</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.3227.1">(expectedArray);</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.3228.1">});</span></strong></span><span class="koboSpan" id="kobo.3229.1">
});
</span></code></pre>
</li>
</ol>
<p class="normal"><em class="italic"><span class="koboSpan" id="kobo.3230.1">Easy peasy!</span></em><span class="koboSpan" id="kobo.3231.1"> Writing tests for Angular pipes is so straightforward that I love it. </span><span class="koboSpan" id="kobo.3231.2">We could call this the power of pure functions. </span><span class="koboSpan" id="kobo.3231.3">Now that you’ve finished </span><a id="_idIndexMarker881"/><span class="koboSpan" id="kobo.3232.1">the recipe, please refer to the next section for more </span><a id="_idIndexMarker882"/><span class="koboSpan" id="kobo.3233.1">informative links.</span></p>
<h2 class="heading-2" id="_idParaDest-373"><span class="koboSpan" id="kobo.3234.1">See also</span></h2>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.3235.1">Testing Angular pipes</span><a id="_idIndexMarker883"/><span class="koboSpan" id="kobo.3236.1"> official documentation: </span><a href="https://angular.io/guide/testing-pipes"><span class="url"><span class="koboSpan" id="kobo.3237.1">https://angular.io/guide/testing-pipes</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.3238.1">Test Angular Pipes</span><a id="_idIndexMarker884"/><span class="koboSpan" id="kobo.3239.1"> With Services: </span><a href="https://levelup.gitconnected.com/test-angular-pipes-with-services-4cf77e34e576"><span class="url"><span class="koboSpan" id="kobo.3240.1">https://levelup.gitconnected.com/test-angular-pipes-with-services-4cf77e34e576</span></span></a></li>
</ul>
<h1 class="heading-1"><span class="koboSpan" id="kobo.3241.1">Learn more on Discord</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.3242.1">To join the Discord community for this book – where you can share feedback, ask questions to the author, and learn about new releases – follow the QR code below:</span></p>
<p class="normal"><a href="Chapter_10.xhtml"><span class="url"><span class="koboSpan" id="kobo.3243.1">https://packt.link/AngularCookbook2e</span></span></a></p>
<p class="normal"><span class="koboSpan" id="kobo.3244.1"><img alt="" role="presentation" src="../Images/QR_Code1388317275422265.png"/></span></p>
</div>
</body></html>