<html><head></head><body>
<div id="_idContainer118">
<h1 class="chapterNumber"><a id="_idTextAnchor147"/><span class="koboSpan" id="kobo.1.1">6</span></h1>
<h1 class="chapterTitle" id="_idParaDest-142"><a id="_idTextAnchor148"/><span class="koboSpan" id="kobo.2.1">Using Hooks and React Suspense for Data Fetching</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.3.1">In the previous chapter, we learned how to use React Context as an alternative to manually passing down props. </span><span class="koboSpan" id="kobo.3.2">We learned about context providers, consumers and the Context Hook.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.4.1">In this chapter, we are going to first set up a simple backend server from a JSON file using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.5.1">json-server</span></code><span class="koboSpan" id="kobo.6.1"> tool. </span><span class="koboSpan" id="kobo.6.2">Then, we are going to fetch data from our server using an Effect Hook in combination with a State Hook. </span><span class="koboSpan" id="kobo.6.3">Next, we are going to do the same using TanStack Query, a popular data fetching library for React that makes use of Hooks. </span><span class="koboSpan" id="kobo.6.4">Finally, we will learn about React Suspense, which can be used to defer rendering until the content has finished loading.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.7.1">The following topics will be covered in this chapter:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.8.1">Setting up a simple backend server</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.9.1">Requesting resources using an Effect and a State Hook</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.10.1">Using TanStack Query to request resources and make changes</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.11.1">Introducing React Suspense and Error Boundaries</span></li>
</ul>
<h1 class="heading-1" id="_idParaDest-143"><a id="_idTextAnchor149"/><span class="koboSpan" id="kobo.12.1">Technical requirements</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.13.1">A fairly recent version of Node.js should already be installed. </span><span class="koboSpan" id="kobo.13.2">The Node Package Manager (</span><code class="inlineCode"><span class="koboSpan" id="kobo.14.1">npm</span></code><span class="koboSpan" id="kobo.15.1">) also needs to be installed (it should come with Node.js). </span><span class="koboSpan" id="kobo.15.2">For more information on how to install Node.js, please check out their official website: </span><a href="https://nodejs.org/"><span class="url"><span class="koboSpan" id="kobo.16.1">https://nodejs.org/</span></span></a><span class="koboSpan" id="kobo.17.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.18.1">We are going to use </span><strong class="keyWord"><span class="koboSpan" id="kobo.19.1">Visual Studio Code</span></strong><span class="koboSpan" id="kobo.20.1"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.21.1">VS Code</span></strong><span class="koboSpan" id="kobo.22.1">) for the guides in this book, but everything should work similarly in any other editor. </span><span class="koboSpan" id="kobo.22.2">For more information on how to install VS Code, please refer to their official website: </span><a href="https://code.visualstudio.com"><span class="url"><span class="koboSpan" id="kobo.23.1">https://code.visualstudio.com</span></span></a></p>
<p class="normal"><span class="koboSpan" id="kobo.24.1">In this book, we use the following versions:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.25.1">Node.js v22.14.0</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.26.1">npm</span></code><span class="koboSpan" id="kobo.27.1"> v10.9.2</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.28.1">Visual Studio Code v1.97.2</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.29.1">The versions mentioned in the preceding list are the ones used in the book. </span><span class="koboSpan" id="kobo.29.2">While installing a newer version should not be an issue, please note that certain steps might work differently on a newer version. </span><span class="koboSpan" id="kobo.29.3">If you are having an issue with the code and steps provided in this book, please try using the mentioned versions.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.30.1">You can find the code for this chapter on GitHub: </span><a href="https://github.com/PacktPublishing/Learn-React-Hooks-Second-Edition/tree/main/Chapter06"><span class="url"><span class="koboSpan" id="kobo.31.1">https://github.com/PacktPublishing/Learn-React-Hooks-Second-Edition/tree/main/Chapter06</span></span></a></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.32.1">It is highly recommended that you write the code on your own. </span><span class="koboSpan" id="kobo.32.2">Do not simply run the code examples that are provided with the book. </span><span class="koboSpan" id="kobo.32.3">It is important to write the code yourself to be able to learn and understand it properly. </span><span class="koboSpan" id="kobo.32.4">However, if you run into any issues, you can always refer to the code example.</span></p>
</div>
<h1 class="heading-1" id="_idParaDest-144"><a id="_idTextAnchor150"/><span class="koboSpan" id="kobo.33.1">Setting up a simple backend server</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.34.1">Before we can</span><a id="_idIndexMarker249"/><span class="koboSpan" id="kobo.35.1"> implement requests, we need to implement a server. </span><span class="koboSpan" id="kobo.35.2">Since we are focusing on the user interface in this book, we are going to set up a dummy server, which will allow us to test out requests. </span><span class="koboSpan" id="kobo.35.3">We are going to use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.36.1">json-server</span></code><span class="koboSpan" id="kobo.37.1"> tool to </span><a id="_idIndexMarker250"/><span class="koboSpan" id="kobo.38.1">create a mock </span><strong class="keyWord"><span class="koboSpan" id="kobo.39.1">Representational State Transfer</span></strong><span class="koboSpan" id="kobo.40.1"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.41.1">REST</span></strong><span class="koboSpan" id="kobo.42.1">) </span><strong class="keyWord"><span class="koboSpan" id="kobo.43.1">Application Programming Interface</span></strong><span class="koboSpan" id="kobo.44.1"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.45.1">API</span></strong><span class="koboSpan" id="kobo.46.1">) from</span><a id="_idIndexMarker251"/><span class="koboSpan" id="kobo.47.1"> a JSON</span><a id="_idIndexMarker252"/><span class="koboSpan" id="kobo.48.1"> file.</span></p>
<h2 class="heading-2" id="_idParaDest-145"><a id="_idTextAnchor151"/><span class="koboSpan" id="kobo.49.1">Creating the db.json file</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.50.1">To be able to</span><a id="_idIndexMarker253"/><span class="koboSpan" id="kobo.51.1"> use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.52.1">json-server</span></code><span class="koboSpan" id="kobo.53.1"> tool, we first need to create a </span><code class="inlineCode"><span class="koboSpan" id="kobo.54.1">db.json</span></code><span class="koboSpan" id="kobo.55.1"> file, which </span><a id="_idIndexMarker254"/><span class="koboSpan" id="kobo.56.1">is going to contain the database for the server. </span><span class="koboSpan" id="kobo.56.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.57.1">json-server</span></code><span class="koboSpan" id="kobo.58.1"> tool will then create a REST API that allows us to access and modify the </span><code class="inlineCode"><span class="koboSpan" id="kobo.59.1">db.json</span></code><span class="koboSpan" id="kobo.60.1"> file, as follows:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.61.1">GET</span></code><span class="koboSpan" id="kobo.62.1"> requests, to view data from the file</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.63.1">POST</span></code><span class="koboSpan" id="kobo.64.1"> requests, to insert new data into the file</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.65.1">PUT</span></code><span class="koboSpan" id="kobo.66.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.67.1">PATCH</span></code><span class="koboSpan" id="kobo.68.1"> requests, to adjust existing data in the file</span></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.69.1">DELETE</span></code><span class="koboSpan" id="kobo.70.1"> requests, to remove data from the file</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.71.1">The structure of the REST API is inferred from a JSON object in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.72.1">db.json</span></code><span class="koboSpan" id="kobo.73.1"> file. </span><span class="koboSpan" id="kobo.73.2">For all modifying actions (</span><code class="inlineCode"><span class="koboSpan" id="kobo.74.1">POST</span></code><span class="koboSpan" id="kobo.75.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.76.1">PUT</span></code><span class="koboSpan" id="kobo.77.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.78.1">PATCH</span></code><span class="koboSpan" id="kobo.79.1">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.80.1">DELETE</span></code><span class="koboSpan" id="kobo.81.1">), the updated file will be automatically saved by the tool.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.82.1">We can use our existing structure for posts, which we defined as </span><code class="inlineCode"><span class="koboSpan" id="kobo.83.1">defaultPosts</span></code><span class="koboSpan" id="kobo.84.1"> in our App component, but we need to provide an additional </span><code class="inlineCode"><span class="koboSpan" id="kobo.85.1">id</span></code><span class="koboSpan" id="kobo.86.1"> value, so that we can query posts from the database later. </span><span class="koboSpan" id="kobo.86.2">Additionally, we give each post a </span><code class="inlineCode"><span class="koboSpan" id="kobo.87.1">featured</span></code><span class="koboSpan" id="kobo.88.1"> value. </span><span class="koboSpan" id="kobo.88.2">This will be important later to distinguish between featured and regular posts when we implement the request.</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.89.1">[
  {
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.90.1">"id"</span></span><span class="koboSpan" id="kobo.91.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.92.1">"1"</span></span><span class="koboSpan" id="kobo.93.1">,
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.94.1">"title"</span></span><span class="koboSpan" id="kobo.95.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.96.1">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.97.1">React Hooks"</span></span><span class="koboSpan" id="kobo.98.1">,
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.99.1">"content"</span></span><span class="koboSpan" id="kobo.100.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.101.1">"The greatest thing since sliced bread!"</span></span><span class="koboSpan" id="kobo.102.1">,
</span><span class="hljs-string"><span class="koboSpan" id="kobo.103.1">    "author"</span></span><span class="koboSpan" id="kobo.104.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.105.1">"Daniel Bugl"</span></span><span class="koboSpan" id="kobo.106.1">,
</span><span class="hljs-string"><span class="koboSpan" id="kobo.107.1">    "featured"</span></span><span class="koboSpan" id="kobo.108.1">: </span><span class="hljs-literal"><span class="koboSpan" id="kobo.109.1">false</span></span><span class="koboSpan" id="kobo.110.1">
  },
  {
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.111.1">"id"</span></span><span class="koboSpan" id="kobo.112.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.113.1">"2"</span></span><span class="koboSpan" id="kobo.114.1">,
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.115.1">"title"</span></span><span class="koboSpan" id="kobo.116.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.117.1">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.118.1">Using React Fragments"</span></span><span class="koboSpan" id="kobo.119.1">,
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.120.1">"content"</span></span><span class="koboSpan" id="kobo.121.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.122.1">"Keeping the DOM tree clean!"</span></span><span class="koboSpan" id="kobo.123.1">,
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.124.1">"author"</span></span><span class="koboSpan" id="kobo.125.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.126.1">"Daniel Bugl"</span></span><span class="koboSpan" id="kobo.127.1">,
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.128.1">"featured"</span></span><span class="koboSpan" id="kobo.129.1">: </span><span class="hljs-literal"><span class="koboSpan" id="kobo.130.1">false</span></span><span class="koboSpan" id="kobo.131.1">
  },
  {
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.132.1">"id"</span></span><span class="koboSpan" id="kobo.133.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.134.1">"3"</span></span><span class="koboSpan" id="kobo.135.1">,
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.136.1">"title"</span></span><span class="koboSpan" id="kobo.137.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.138.1">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.139.1">React Context"</span></span><span class="koboSpan" id="kobo.140.1">,
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.141.1">"content"</span></span><span class="koboSpan" id="kobo.142.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.143.1">"Manage global state with ease!"</span></span><span class="koboSpan" id="kobo.144.1">,
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.145.1">"author"</span></span><span class="koboSpan" id="kobo.146.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.147.1">"Daniel Bugl"</span></span><span class="koboSpan" id="kobo.148.1">,
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.149.1">"featured"</span></span><span class="koboSpan" id="kobo.150.1">: </span><span class="hljs-literal"><span class="koboSpan" id="kobo.151.1">true</span></span><span class="koboSpan" id="kobo.152.1">
  }
]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.153.1">For the users, we need to come up with a way to store usernames and passwords. </span><span class="koboSpan" id="kobo.153.2">For simplicity, we just store the password in plain text </span><em class="italic"><span class="koboSpan" id="kobo.154.1">(never do this in a production environment!)</span></em><span class="koboSpan" id="kobo.155.1">:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.156.1">[
  {
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.157.1">"id"</span></span><span class="koboSpan" id="kobo.158.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.159.1">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.160.1">1"</span></span><span class="koboSpan" id="kobo.161.1">,
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.162.1">"username"</span></span><span class="koboSpan" id="kobo.163.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.164.1">"Daniel Bugl"</span></span><span class="koboSpan" id="kobo.165.1">,
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.166.1">"password"</span></span><span class="koboSpan" id="kobo.167.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.168.1">"hunter2"</span></span><span class="koboSpan" id="kobo.169.1">
  }
]
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.170.1">Now all that is left to</span><a id="_idIndexMarker255"/><span class="koboSpan" id="kobo.171.1"> do is to combine these two arrays into a single</span><a id="_idIndexMarker256"/><span class="koboSpan" id="kobo.172.1"> JSON object, by storing the posts array under a </span><code class="inlineCode"><span class="koboSpan" id="kobo.173.1">posts</span></code><span class="koboSpan" id="kobo.174.1"> key, and the users array under a </span><code class="inlineCode"><span class="koboSpan" id="kobo.175.1">users</span></code><span class="koboSpan" id="kobo.176.1"> key.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.177.1">Let’s get started creating the JSON file for our backend server now:</span></p>
<ol>
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.178.1">Copy the </span><code class="inlineCode"><span class="koboSpan" id="kobo.179.1">Chapter05_2</span></code><span class="koboSpan" id="kobo.180.1"> folder to a new </span><code class="inlineCode"><span class="koboSpan" id="kobo.181.1">Chapter06_1</span></code><span class="koboSpan" id="kobo.182.1"> folder by executing the following command:
        </span><pre class="programlisting con-one"><code class="hljs-con"><span class="koboSpan" id="kobo.183.1">$ cp -R Chapter05_2 Chapter06_1
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.184.1">Open the new </span><code class="inlineCode"><span class="koboSpan" id="kobo.185.1">Chapter06_1</span></code><span class="koboSpan" id="kobo.186.1"> folder in VS Code.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.187.1">Create a new </span><code class="inlineCode"><span class="koboSpan" id="kobo.188.1">server/</span></code><span class="koboSpan" id="kobo.189.1"> folder, directly inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.190.1">Chapter06_1</span></code><span class="koboSpan" id="kobo.191.1"> folder.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.192.1">Create a </span><code class="inlineCode"><span class="koboSpan" id="kobo.193.1">server/db.json</span></code><span class="koboSpan" id="kobo.194.1"> file with</span><a id="_idIndexMarker257"/><span class="koboSpan" id="kobo.195.1"> the following</span><a id="_idIndexMarker258"/><span class="koboSpan" id="kobo.196.1"> contents:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="koboSpan" id="kobo.197.1">{
  </span><span class="hljs-string"><span class="koboSpan" id="kobo.198.1">"posts"</span></span><span class="koboSpan" id="kobo.199.1">: [
    {
      </span><span class="hljs-string"><span class="koboSpan" id="kobo.200.1">"id"</span></span><span class="koboSpan" id="kobo.201.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.202.1">"1"</span></span><span class="koboSpan" id="kobo.203.1">,
      </span><span class="hljs-string"><span class="koboSpan" id="kobo.204.1">"title"</span></span><span class="koboSpan" id="kobo.205.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.206.1">"React Hooks"</span></span><span class="koboSpan" id="kobo.207.1">,
      </span><span class="hljs-string"><span class="koboSpan" id="kobo.208.1">"content"</span></span><span class="koboSpan" id="kobo.209.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.210.1">"The greatest thing since sliced bread!"</span></span><span class="koboSpan" id="kobo.211.1">,
      </span><span class="hljs-string"><span class="koboSpan" id="kobo.212.1">"author"</span></span><span class="koboSpan" id="kobo.213.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.214.1">"Daniel Bugl"</span></span><span class="koboSpan" id="kobo.215.1">,
      </span><span class="hljs-string"><span class="koboSpan" id="kobo.216.1">"featured"</span></span><span class="koboSpan" id="kobo.217.1">: </span><span class="hljs-literal"><span class="koboSpan" id="kobo.218.1">false</span></span><span class="koboSpan" id="kobo.219.1">
    },
    {
      </span><span class="hljs-string"><span class="koboSpan" id="kobo.220.1">"id"</span></span><span class="koboSpan" id="kobo.221.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.222.1">"2"</span></span><span class="koboSpan" id="kobo.223.1">,
      </span><span class="hljs-string"><span class="koboSpan" id="kobo.224.1">"title"</span></span><span class="koboSpan" id="kobo.225.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.226.1">"Using React Fragments"</span></span><span class="koboSpan" id="kobo.227.1">,
      </span><span class="hljs-string"><span class="koboSpan" id="kobo.228.1">"content"</span></span><span class="koboSpan" id="kobo.229.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.230.1">"Keeping the DOM tree clean!"</span></span><span class="koboSpan" id="kobo.231.1">,
      </span><span class="hljs-string"><span class="koboSpan" id="kobo.232.1">"author"</span></span><span class="koboSpan" id="kobo.233.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.234.1">"Daniel Bugl"</span></span><span class="koboSpan" id="kobo.235.1">,
      </span><span class="hljs-string"><span class="koboSpan" id="kobo.236.1">"featured"</span></span><span class="koboSpan" id="kobo.237.1">: </span><span class="hljs-literal"><span class="koboSpan" id="kobo.238.1">false</span></span><span class="koboSpan" id="kobo.239.1">
    },
    {
      </span><span class="hljs-string"><span class="koboSpan" id="kobo.240.1">"id"</span></span><span class="koboSpan" id="kobo.241.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.242.1">"3"</span></span><span class="koboSpan" id="kobo.243.1">,
      </span><span class="hljs-string"><span class="koboSpan" id="kobo.244.1">"title"</span></span><span class="koboSpan" id="kobo.245.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.246.1">"React Context"</span></span><span class="koboSpan" id="kobo.247.1">,
      </span><span class="hljs-string"><span class="koboSpan" id="kobo.248.1">"content"</span></span><span class="koboSpan" id="kobo.249.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.250.1">"Manage global state with ease!"</span></span><span class="koboSpan" id="kobo.251.1">,
      </span><span class="hljs-string"><span class="koboSpan" id="kobo.252.1">"author"</span></span><span class="koboSpan" id="kobo.253.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.254.1">"Daniel Bugl"</span></span><span class="koboSpan" id="kobo.255.1">,
      </span><span class="hljs-string"><span class="koboSpan" id="kobo.256.1">"featured"</span></span><span class="koboSpan" id="kobo.257.1">: </span><span class="hljs-literal"><span class="koboSpan" id="kobo.258.1">true</span></span><span class="koboSpan" id="kobo.259.1">
    }
  ],
  </span><span class="hljs-string"><span class="koboSpan" id="kobo.260.1">"users"</span></span><span class="koboSpan" id="kobo.261.1">: [
    {
      </span><span class="hljs-string"><span class="koboSpan" id="kobo.262.1">"id"</span></span><span class="koboSpan" id="kobo.263.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.264.1">"1"</span></span><span class="koboSpan" id="kobo.265.1">,
      </span><span class="hljs-string"><span class="koboSpan" id="kobo.266.1">"username"</span></span><span class="koboSpan" id="kobo.267.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.268.1">"Daniel Bugl"</span></span><span class="koboSpan" id="kobo.269.1">,
      </span><span class="hljs-string"><span class="koboSpan" id="kobo.270.1">"password"</span></span><span class="koboSpan" id="kobo.271.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.272.1">"hunter2"</span></span><span class="koboSpan" id="kobo.273.1">
    }
  ]
}
</span></code></pre>
</li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.274.1">That’s all we need to automatically create a simple backend with a REST API using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.275.1">json-server</span></code><span class="koboSpan" id="kobo.276.1"> tool. </span><span class="koboSpan" id="kobo.276.2">Let’s</span><a id="_idIndexMarker259"/><span class="koboSpan" id="kobo.277.1"> continue </span><a id="_idIndexMarker260"/><span class="koboSpan" id="kobo.278.1">by setting up the tool.</span></p>
<h2 class="heading-2" id="_idParaDest-146"><a id="_idTextAnchor152"/><span class="koboSpan" id="kobo.279.1">Installing the json-server tool</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.280.1">Now, we are going</span><a id="_idIndexMarker261"/><span class="koboSpan" id="kobo.281.1"> to install and start our backend</span><a id="_idIndexMarker262"/><span class="koboSpan" id="kobo.282.1"> server by using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.283.1">json-server</span></code><span class="koboSpan" id="kobo.284.1"> tool:</span></p>
<ol>
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.285.1">First, install the </span><code class="inlineCode"><span class="koboSpan" id="kobo.286.1">json-server</span></code><span class="koboSpan" id="kobo.287.1"> tool, as follows:
        </span><pre class="programlisting con-one"><code class="hljs-con"><span class="koboSpan" id="kobo.288.1">$ npm install --save-exact json-server@1.0.0-beta.3
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.289.1">Now, start the backend server by executing the following command:
        </span><pre class="programlisting con-one"><code class="hljs-con"><span class="koboSpan" id="kobo.290.1">$ npx json-server server/db.json
</span></code></pre>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.291.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.292.1">npx</span></code><span class="koboSpan" id="kobo.293.1"> command executes commands that were installed locally in a project. </span><span class="koboSpan" id="kobo.293.2">We need to use </span><code class="inlineCode"><span class="koboSpan" id="kobo.294.1">npx</span></code><span class="koboSpan" id="kobo.295.1"> here, because we did not globally install the </span><code class="inlineCode"><span class="koboSpan" id="kobo.296.1">json-server</span></code><span class="koboSpan" id="kobo.297.1"> tool (via </span><code class="inlineCode"><span class="koboSpan" id="kobo.298.1">npm install -g json-server</span></code><span class="koboSpan" id="kobo.299.1">).</span></p>
</div>
</li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.300.1">We executed the </span><code class="inlineCode"><span class="koboSpan" id="kobo.301.1">json-server</span></code><span class="koboSpan" id="kobo.302.1"> tool, and it is watching the </span><code class="inlineCode"><span class="koboSpan" id="kobo.303.1">server/db.json</span></code><span class="koboSpan" id="kobo.304.1"> file that we created earlier.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.305.1">By default, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.306.1">json-server</span></code><span class="koboSpan" id="kobo.307.1"> tool defines the following routes for each </span><code class="inlineCode"><span class="koboSpan" id="kobo.308.1">key</span></code><span class="koboSpan" id="kobo.309.1"> in the JSON object:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.310.1">GET    /posts
GET    /posts/:id
POST   /posts
PUT    /posts/:id
PATCH  /posts/:id
DELETE /posts/:id
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.311.1">Now, we can go to </span><code class="inlineCode"><span class="koboSpan" id="kobo.312.1">http://localhost:3000/posts/1</span></code><span class="koboSpan" id="kobo.313.1"> in order to see our post object:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.314.1"><img alt="Figure 6.1 – The json-server tool serving a post via its REST API!" src="../Images/B31327_06_01.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.315.1">Figure 6.1 – The json-server tool serving a post via its REST API!</span></p>
<p class="normal"><span class="koboSpan" id="kobo.316.1">As we can see, the tool created a full REST API from the database JSON file for us! </span><span class="koboSpan" id="kobo.316.2">Now, let’s continue by </span><a id="_idIndexMarker263"/><span class="koboSpan" id="kobo.317.1">configuring </span><code class="inlineCode"><span class="koboSpan" id="kobo.318.1">package.json</span></code><span class="koboSpan" id="kobo.319.1"> scripts so that</span><a id="_idIndexMarker264"/><span class="koboSpan" id="kobo.320.1"> the </span><code class="inlineCode"><span class="koboSpan" id="kobo.321.1">json-server</span></code><span class="koboSpan" id="kobo.322.1"> tool is started together with our frontend.</span></p>
<h2 class="heading-2" id="_idParaDest-147"><a id="_idTextAnchor153"/><span class="koboSpan" id="kobo.323.1">Configuring the package.json scripts</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.324.1">Let’s get </span><a id="_idIndexMarker265"/><span class="koboSpan" id="kobo.325.1">started </span><a id="_idIndexMarker266"/><span class="koboSpan" id="kobo.326.1">adjusting the </span><code class="inlineCode"><span class="koboSpan" id="kobo.327.1">package.json</span></code><span class="koboSpan" id="kobo.328.1"> file:</span></p>
<ol>
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.329.1">Edit </span><code class="inlineCode"><span class="koboSpan" id="kobo.330.1">package.json</span></code><span class="koboSpan" id="kobo.331.1"> and define a new script called </span><code class="inlineCode"><span class="koboSpan" id="kobo.332.1">dev:server</span></code><span class="koboSpan" id="kobo.333.1">, by inserting it in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.334.1">scripts</span></code><span class="koboSpan" id="kobo.335.1"> section. </span><span class="koboSpan" id="kobo.335.2">We also make sure to change the port to be adjacent to the Vite default port (which is </span><code class="inlineCode"><span class="koboSpan" id="kobo.336.1">5173</span></code><span class="koboSpan" id="kobo.337.1">):
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-string"><span class="koboSpan" id="kobo.338.1">"scripts"</span></span><span class="koboSpan" id="kobo.339.1">: {
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.340.1">"dev:server"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.341.1">: </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.342.1">"json-server server/db.json --port 5174"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.343.1">,</span></strong></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.344.1">Then, we rename the </span><code class="inlineCode"><span class="koboSpan" id="kobo.345.1">dev</span></code><span class="koboSpan" id="kobo.346.1"> script to </span><code class="inlineCode"><span class="koboSpan" id="kobo.347.1">dev:client</span></code><span class="koboSpan" id="kobo.348.1">:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-string"><span class="koboSpan" id="kobo.349.1">"scripts"</span></span><span class="koboSpan" id="kobo.350.1">: {
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.351.1">"dev:server"</span></span><span class="koboSpan" id="kobo.352.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.353.1">"json-server server/db.json --port 5174"</span></span><span class="koboSpan" id="kobo.354.1">,
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.355.1">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.356.1">dev</span></span><span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.357.1">:client</span></strong></span><span class="hljs-string"><span class="koboSpan" id="kobo.358.1">"</span></span><span class="koboSpan" id="kobo.359.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.360.1">"vite"</span></span><span class="koboSpan" id="kobo.361.1">,
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.362.1">Save the </span><code class="inlineCode"><span class="koboSpan" id="kobo.363.1">package.json</span></code><span class="koboSpan" id="kobo.364.1"> file, otherwise running </span><code class="inlineCode"><span class="koboSpan" id="kobo.365.1">npm install</span></code><span class="koboSpan" id="kobo.366.1"> later will overwrite our changes.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.367.1">If it is still running, quit the </span><code class="inlineCode"><span class="koboSpan" id="kobo.368.1">json-server</span></code><span class="koboSpan" id="kobo.369.1"> tool by pressing </span><em class="italic"><span class="koboSpan" id="kobo.370.1">Ctrl+C</span></em><span class="koboSpan" id="kobo.371.1">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.372.1">Next, we install a tool called </span><code class="inlineCode"><span class="koboSpan" id="kobo.373.1">concurrently</span></code><span class="koboSpan" id="kobo.374.1">, which lets us start the server and client at the same time:
        </span><pre class="programlisting con-one"><code class="hljs-con"><span class="koboSpan" id="kobo.375.1">$ npm install --save-dev --save-exact concurrently@9.1.2
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.376.1">Now, we edit </span><code class="inlineCode"><span class="koboSpan" id="kobo.377.1">package.json</span></code><span class="koboSpan" id="kobo.378.1"> again and define a new </span><code class="inlineCode"><span class="koboSpan" id="kobo.379.1">dev</span></code><span class="koboSpan" id="kobo.380.1"> script by using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.381.1">concurrently</span></code><span class="koboSpan" id="kobo.382.1"> command</span><a id="_idIndexMarker267"/><span class="koboSpan" id="kobo.383.1"> and then passing</span><a id="_idIndexMarker268"/><span class="koboSpan" id="kobo.384.1"> the server and client commands as arguments to it:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-string"><span class="koboSpan" id="kobo.385.1">"scripts"</span></span><span class="koboSpan" id="kobo.386.1">: {
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.387.1">"dev"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.388.1">: </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.389.1">"concurrently \"npm run dev:server\" \"npm run dev:client\""</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.390.1">,</span></strong></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.391.1">Try executing the following command now:
        </span><pre class="programlisting con-one"><code class="hljs-con"><span class="koboSpan" id="kobo.392.1">$ npm run dev
</span></code></pre>
</li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.393.1">You will see that this command is starting both the server and the client:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.394.1"><img alt="Figure 6.2 – The concurrently tool running our server and client in parallel" src="../Images/B31327_06_02.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.395.1">Figure 6.2 – The concurrently tool running our server and client in parallel</span></p>
<p class="normal"><span class="koboSpan" id="kobo.396.1">Now that </span><a id="_idIndexMarker269"/><span class="koboSpan" id="kobo.397.1">we have both the client and the server running, let’s </span><a id="_idIndexMarker270"/><span class="koboSpan" id="kobo.398.1">move on to configuring a proxy to avoid having to deal with cross-site requests.</span></p>
<h2 class="heading-2" id="_idParaDest-148"><a id="_idTextAnchor154"/><span class="koboSpan" id="kobo.399.1">Configuring a proxy</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.400.1">For security </span><a id="_idIndexMarker271"/><span class="koboSpan" id="kobo.401.1">reasons, browsers have restrictions on making requests to </span><a id="_idIndexMarker272"/><span class="koboSpan" id="kobo.402.1">different domains. </span><span class="koboSpan" id="kobo.402.2">This restriction is called </span><strong class="keyWord"><span class="koboSpan" id="kobo.403.1">cross-origin resource sharing (CORS)</span></strong><span class="koboSpan" id="kobo.404.1"> and it </span><a id="_idIndexMarker273"/><span class="koboSpan" id="kobo.405.1">prevents us from being able to make requests to URLs with a different origin. </span><span class="koboSpan" id="kobo.405.2">The origin consists of the domain and port. </span><span class="koboSpan" id="kobo.405.3">In our case, the domain is the same (</span><code class="inlineCode"><span class="koboSpan" id="kobo.406.1">localhost</span></code><span class="koboSpan" id="kobo.407.1">), but the port is different (</span><code class="inlineCode"><span class="koboSpan" id="kobo.408.1">5173</span></code><span class="koboSpan" id="kobo.409.1"> vs </span><code class="inlineCode"><span class="koboSpan" id="kobo.410.1">5174</span></code><span class="koboSpan" id="kobo.411.1">). </span><span class="koboSpan" id="kobo.411.2">It would be best to stay on the same domain and port to make requests from a frontend to a backend. </span><span class="koboSpan" id="kobo.411.3">So, we need to configure a proxy that will forward requests from </span><code class="inlineCode"><span class="koboSpan" id="kobo.412.1">http://localhost:5173/api/</span></code><span class="koboSpan" id="kobo.413.1"> to </span><code class="inlineCode"><span class="koboSpan" id="kobo.414.1">http://localhost:5174/</span></code><span class="koboSpan" id="kobo.415.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.416.1">Now, let’s get started configuring the proxy:</span></p>
<ol>
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.417.1">Edit </span><code class="inlineCode"><span class="koboSpan" id="kobo.418.1">vite.config.js</span></code><span class="koboSpan" id="kobo.419.1"> and define a </span><code class="inlineCode"><span class="koboSpan" id="kobo.420.1">proxy</span></code><span class="koboSpan" id="kobo.421.1"> config that will be bound to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.422.1">/api</span></code><span class="koboSpan" id="kobo.423.1"> path:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.424.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.425.1">default</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.426.1">defineConfig</span></span><span class="koboSpan" id="kobo.427.1">({
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.428.1">plugins</span></span><span class="koboSpan" id="kobo.429.1">: [</span><span class="hljs-title"><span class="koboSpan" id="kobo.430.1">react</span></span><span class="koboSpan" id="kobo.431.1">()],
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.432.1">resolve</span></span><span class="koboSpan" id="kobo.433.1">: {
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.434.1">alias</span></span><span class="koboSpan" id="kobo.435.1">: [
      { </span><span class="hljs-attr"><span class="koboSpan" id="kobo.436.1">find</span></span><span class="koboSpan" id="kobo.437.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.438.1">'@'</span></span><span class="koboSpan" id="kobo.439.1">, </span><span class="hljs-attr"><span class="koboSpan" id="kobo.440.1">replacement</span></span><span class="koboSpan" id="kobo.441.1">: path.</span><span class="hljs-title"><span class="koboSpan" id="kobo.442.1">resolve</span></span><span class="koboSpan" id="kobo.443.1">(</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.444.1">import</span></span><span class="koboSpan" id="kobo.445.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.446.1">meta</span></span><span class="koboSpan" id="kobo.447.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.448.1">dirname</span></span><span class="koboSpan" id="kobo.449.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.450.1">'src'</span></span><span class="koboSpan" id="kobo.451.1">) },
    ],
  },
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.452.1">server</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.453.1">: {</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.454.1">proxy</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.455.1">: {</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.456.1">'/api'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.457.1">: {</span></strong></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.458.1">Set the target to our backend server running at </span><code class="inlineCode"><span class="koboSpan" id="kobo.459.1">http://localhost:5174</span></code><span class="koboSpan" id="kobo.460.1">, and rewrite the path to remove the </span><code class="inlineCode"><span class="koboSpan" id="kobo.461.1">/api</span></code><span class="koboSpan" id="kobo.462.1"> from it before forwarding the request to our server:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.463.1">target</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.464.1">: </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.465.1">'http://localhost:5174'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.466.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.467.1">rewrite</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.468.1">: </span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.469.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.470.1">path</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.471.1">) =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.472.1"> path.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.473.1">replace</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.474.1">(</span></strong><strong class="hljs-regexp-slc"><span class="koboSpan" id="kobo.475.1">/^\/api/</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.476.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.477.1">''</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.478.1">),</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.479.1">      },</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.480.1">    },</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.481.1">  },</span></strong></span><span class="koboSpan" id="kobo.482.1">
})
</span></code></pre>
</li>
</ol>
<p class="normal-one"><span class="koboSpan" id="kobo.483.1">This proxy configuration will link </span><code class="inlineCode"><span class="koboSpan" id="kobo.484.1">/api</span></code><span class="koboSpan" id="kobo.485.1"> to our backend server.</span></p>
<ol>
<li class="numberedList" value="3"><span class="koboSpan" id="kobo.486.1">Quit the server and client if they are already running. </span><span class="koboSpan" id="kobo.486.2">Then, start them again with the following command:
        </span><pre class="programlisting con-one"><code class="hljs-con"><span class="koboSpan" id="kobo.487.1">$ npm run dev
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.488.1">Now, access the API by opening </span><code class="inlineCode"><span class="koboSpan" id="kobo.489.1">http://localhost:5173/api/posts/1</span></code><span class="koboSpan" id="kobo.490.1"> in your browser.</span></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.491.1">As we can see, the post object is still being served properly, but now from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.492.1">/api</span></code><span class="koboSpan" id="kobo.493.1"> path through the proxy defined in Vite!</span></p>
<div class="note">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.494.1">Example code</span></strong></p>
<p class="normal"><span class="koboSpan" id="kobo.495.1">The example code for this section can be found in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.496.1">Chapter06/Chapter06_1</span></code><span class="koboSpan" id="kobo.497.1"> folder. </span><span class="koboSpan" id="kobo.497.2">Check the </span><code class="inlineCode"><span class="koboSpan" id="kobo.498.1">README.md</span></code><span class="koboSpan" id="kobo.499.1"> file inside the folder for instructions on how to set up and run the example.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.500.1">Now, let’s </span><a id="_idIndexMarker274"/><span class="koboSpan" id="kobo.501.1">move on </span><a id="_idIndexMarker275"/><span class="koboSpan" id="kobo.502.1">to requesting resources using an Effect and a State/Reducer Hook.</span></p>
<h1 class="heading-1" id="_idParaDest-149"><a id="_idTextAnchor155"/><span class="koboSpan" id="kobo.503.1">Requesting resources using an Effect and a State/Reducer Hook</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.504.1">Before learning </span><a id="_idIndexMarker276"/><span class="koboSpan" id="kobo.505.1">how to use a library to implement requests using Hooks, we are going to implement them manually, using an Effect Hook to trigger the request, and a State/Reducer Hook to store the result.</span></p>
<h2 class="heading-2" id="_idParaDest-150"><a id="_idTextAnchor156"/><span class="koboSpan" id="kobo.506.1">Fetching posts from the server</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.507.1">We are now going </span><a id="_idIndexMarker277"/><span class="koboSpan" id="kobo.508.1">to implement a </span><a id="_idIndexMarker278"/><span class="koboSpan" id="kobo.509.1">way to fetch posts by using an Effect Hook. </span><span class="koboSpan" id="kobo.509.2">Then, we will store it by extending the already defined Reducer Hook. </span><span class="koboSpan" id="kobo.509.3">Let’s get started:</span></p>
<ol>
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.510.1">Copy the </span><code class="inlineCode"><span class="koboSpan" id="kobo.511.1">Chapter06_1</span></code><span class="koboSpan" id="kobo.512.1"> folder to a new </span><code class="inlineCode"><span class="koboSpan" id="kobo.513.1">Chapter06_2</span></code><span class="koboSpan" id="kobo.514.1"> folder by executing the following command:
        </span><pre class="programlisting con-one"><code class="hljs-con"><span class="koboSpan" id="kobo.515.1">$ cp -R Chapter06_1 Chapter06_2
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.516.1">Open the new </span><code class="inlineCode"><span class="koboSpan" id="kobo.517.1">Chapter06_2</span></code><span class="koboSpan" id="kobo.518.1"> folder in VS Code.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.519.1">First, edit </span><code class="inlineCode"><span class="koboSpan" id="kobo.520.1">src/reducers.js</span></code><span class="koboSpan" id="kobo.521.1"> and define a new </span><code class="inlineCode"><span class="koboSpan" id="kobo.522.1">FETCH_POSTS</span></code><span class="koboSpan" id="kobo.523.1"> action, which is simply going to return the new list of posts from the action:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.524.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.525.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.526.1">postsReducer</span></span><span class="koboSpan" id="kobo.527.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.528.1">state, action</span></span><span class="koboSpan" id="kobo.529.1">) {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.530.1">switch</span></span><span class="koboSpan" id="kobo.531.1"> (action.</span><span class="hljs-property"><span class="koboSpan" id="kobo.532.1">type</span></span><span class="koboSpan" id="kobo.533.1">) {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.534.1">case</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.535.1">'CREATE_POST'</span></span><span class="koboSpan" id="kobo.536.1">:
      </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.537.1">return</span></span><span class="koboSpan" id="kobo.538.1"> [action.</span><span class="hljs-property"><span class="koboSpan" id="kobo.539.1">post</span></span><span class="koboSpan" id="kobo.540.1">, ...state]
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.541.1">case</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.542.1">'FETCH_POSTS'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.543.1">:</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.544.1">return</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.545.1"> action.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.546.1">posts</span></strong></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.547.1">default</span></span><span class="koboSpan" id="kobo.548.1">:
      </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.549.1">throw</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.550.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.551.1">Error</span></span><span class="koboSpan" id="kobo.552.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.553.1">'Unknown action type'</span></span><span class="koboSpan" id="kobo.554.1">)
  }
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.555.1">Now, edit </span><code class="inlineCode"><span class="koboSpan" id="kobo.556.1">src/App.jsx</span></code><span class="koboSpan" id="kobo.557.1"> and import the </span><code class="inlineCode"><span class="koboSpan" id="kobo.558.1">useEffect</span></code><span class="koboSpan" id="kobo.559.1"> function:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.560.1">import</span></span><span class="koboSpan" id="kobo.561.1"> { useState, useReducer</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.562.1">, useEffect</span></strong></span><span class="koboSpan" id="kobo.563.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.564.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.565.1">'react'</span></span>
</code></pre>
</li>
<li class="numberedList"><em class="italic"><span class="koboSpan" id="kobo.566.1">Remove</span></em><span class="koboSpan" id="kobo.567.1"> the </span><code class="inlineCode"><span class="koboSpan" id="kobo.568.1">featuredPosts</span></code><span class="koboSpan" id="kobo.569.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.570.1">defaultPosts</span></code><span class="koboSpan" id="kobo.571.1"> arrays.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.572.1">Adjust the default value of the Reducer Hook to be an empty array:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.573.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.574.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.575.1">App</span></span><span class="koboSpan" id="kobo.576.1">() {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.577.1">const</span></span><span class="koboSpan" id="kobo.578.1"> [posts, dispatch] = </span><span class="hljs-title"><span class="koboSpan" id="kobo.579.1">useReducer</span></span><span class="koboSpan" id="kobo.580.1">(postsReducer, </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.581.1">[]</span></strong></span><span class="koboSpan" id="kobo.582.1">)
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.583.1">const</span></span><span class="koboSpan" id="kobo.584.1"> [username, setUsername] = </span><span class="hljs-title"><span class="koboSpan" id="kobo.585.1">useState</span></span><span class="koboSpan" id="kobo.586.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.587.1">''</span></span><span class="koboSpan" id="kobo.588.1">)
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.589.1">Then, define an Effect Hook in the App component, as follows:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-title"><span class="koboSpan" id="kobo.590.1">useEffect</span></span><span class="koboSpan" id="kobo.591.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.592.1">() =&gt;</span></span><span class="koboSpan" id="kobo.593.1"> {
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.594.1">Inside the Hook, we call </span><code class="inlineCode"><span class="koboSpan" id="kobo.595.1">fetch</span></code><span class="koboSpan" id="kobo.596.1"> to make a request to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.597.1">/api/posts</span></code><span class="koboSpan" id="kobo.598.1"> endpoint:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-title"><span class="koboSpan" id="kobo.599.1">fetch</span></span><span class="koboSpan" id="kobo.600.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.601.1">'/api/posts'</span></span><span class="koboSpan" id="kobo.602.1">)
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.603.1">Parse the JSON response to get back a </span><code class="inlineCode"><span class="koboSpan" id="kobo.604.1">posts</span></code><span class="koboSpan" id="kobo.605.1"> array:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="koboSpan" id="kobo.606.1">      .</span><span class="hljs-title"><span class="koboSpan" id="kobo.607.1">then</span></span><span class="koboSpan" id="kobo.608.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.609.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.610.1">response</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.611.1">) =&gt;</span></span><span class="koboSpan" id="kobo.612.1"> response.</span><span class="hljs-title"><span class="koboSpan" id="kobo.613.1">json</span></span><span class="koboSpan" id="kobo.614.1">())
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.615.1">Now, dispatch the </span><code class="inlineCode"><span class="koboSpan" id="kobo.616.1">FETCH_POSTS</span></code><span class="koboSpan" id="kobo.617.1"> action with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.618.1">posts</span></code><span class="koboSpan" id="kobo.619.1"> array returned from the server:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="koboSpan" id="kobo.620.1">      .</span><span class="hljs-title"><span class="koboSpan" id="kobo.621.1">then</span></span><span class="koboSpan" id="kobo.622.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.623.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.624.1">posts</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.625.1">) =&gt;</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.626.1">dispatch</span></span><span class="koboSpan" id="kobo.627.1">({ </span><span class="hljs-attr"><span class="koboSpan" id="kobo.628.1">type</span></span><span class="koboSpan" id="kobo.629.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.630.1">'FETCH_POSTS'</span></span><span class="koboSpan" id="kobo.631.1">, posts }))
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.632.1">Pass an empty </span><a id="_idIndexMarker279"/><span class="koboSpan" id="kobo.633.1">array </span><a id="_idIndexMarker280"/><span class="koboSpan" id="kobo.634.1">to the Effect Hook dependency array to make sure it only triggers when the component mounts:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="koboSpan" id="kobo.635.1">  }, [])
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.636.1">We still need to separate featured posts from non-featured posts, so let’s use </span><code class="inlineCode"><span class="koboSpan" id="kobo.637.1">filter</span></code><span class="koboSpan" id="kobo.638.1"> to split up the array into two arrays, as follows:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.639.1">const</span></span><span class="koboSpan" id="kobo.640.1"> featuredPosts = posts.</span><span class="hljs-title"><span class="koboSpan" id="kobo.641.1">filter</span></span><span class="koboSpan" id="kobo.642.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.643.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.644.1">post</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.645.1">) =&gt;</span></span><span class="koboSpan" id="kobo.646.1"> post.</span><span class="hljs-property"><span class="koboSpan" id="kobo.647.1">featured</span></span><span class="koboSpan" id="kobo.648.1">).</span><span class="hljs-title"><span class="koboSpan" id="kobo.649.1">reverse</span></span><span class="koboSpan" id="kobo.650.1">()
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.651.1">const</span></span><span class="koboSpan" id="kobo.652.1"> regularPosts = posts.</span><span class="hljs-title"><span class="koboSpan" id="kobo.653.1">filter</span></span><span class="koboSpan" id="kobo.654.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.655.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.656.1">post</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.657.1">) =&gt;</span></span><span class="koboSpan" id="kobo.658.1"> !post.</span><span class="hljs-property"><span class="koboSpan" id="kobo.659.1">featured</span></span><span class="koboSpan" id="kobo.660.1">).</span><span class="hljs-title"><span class="koboSpan" id="kobo.661.1">reverse</span></span><span class="koboSpan" id="kobo.662.1">()
</span></code></pre>
</li>
</ol>
<p class="normal-one"><span class="koboSpan" id="kobo.663.1">We reverse the order here to make sure the newest posts are shown first. </span><span class="koboSpan" id="kobo.663.2">If we had a </span><code class="inlineCode"><span class="koboSpan" id="kobo.664.1">createdAt</span></code><span class="koboSpan" id="kobo.665.1"> property, we could use that instead to sort the posts properly.</span></p>
<ol>
<li class="numberedList" value="13"><span class="koboSpan" id="kobo.666.1">Pass </span><code class="inlineCode"><span class="koboSpan" id="kobo.667.1">regularPosts</span></code><span class="koboSpan" id="kobo.668.1"> instead of </span><code class="inlineCode"><span class="koboSpan" id="kobo.669.1">posts</span></code><span class="koboSpan" id="kobo.670.1"> to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.671.1">PostList</span></code><span class="koboSpan" id="kobo.672.1"> component to ensure that featured posts are not rendered twice:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="koboSpan" id="kobo.673.1">          &lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.674.1">PostList</span></span><span class="koboSpan" id="kobo.675.1"> posts={</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.676.1">regularPosts</span></strong></span><span class="koboSpan" id="kobo.677.1">} /&gt;
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.678.1">Start the client and server, as follows:
        </span><pre class="programlisting con-one"><code class="hljs-con"><span class="koboSpan" id="kobo.679.1">$ npm run dev
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.680.1">Now, go to </span><code class="inlineCode"><span class="koboSpan" id="kobo.681.1">http://localhost:5173/</span></code><span class="koboSpan" id="kobo.682.1"> in your browser.</span></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.683.1">As we can see, the app still works the same way as before! </span><span class="koboSpan" id="kobo.683.2">To verify that the posts are really coming from our database, make a change to </span><code class="inlineCode"><span class="koboSpan" id="kobo.684.1">db.json</span></code><span class="koboSpan" id="kobo.685.1">, then refresh the page. </span><span class="koboSpan" id="kobo.685.2">You will see that the change is</span><a id="_idIndexMarker281"/><span class="koboSpan" id="kobo.686.1"> visible in </span><a id="_idIndexMarker282"/><span class="koboSpan" id="kobo.687.1">the app!</span></p>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.688.1">In development mode, you will see two </span><code class="inlineCode"><span class="koboSpan" id="kobo.689.1">GET</span></code><span class="koboSpan" id="kobo.690.1"> requests. </span><span class="koboSpan" id="kobo.690.2">This is due to React rendering components twice in strict mode to help you spot side effects that may happen when re-rendering components (for example, forgetting to clean up timeouts/intervals).</span></p>
<p class="normal"><span class="koboSpan" id="kobo.691.1">In production mode, the component will only be rendered once and thus only one </span><code class="inlineCode"><span class="koboSpan" id="kobo.692.1">GET</span></code><span class="koboSpan" id="kobo.693.1"> request will be sent.</span></p>
</div>
<h2 class="heading-2" id="_idParaDest-151"><a id="_idTextAnchor157"/><span class="koboSpan" id="kobo.694.1">Quick detour: The async/await construct</span></h2>
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.695.1">Regular functions</span></strong><span class="koboSpan" id="kobo.696.1"> are </span><a id="_idIndexMarker283"/><span class="koboSpan" id="kobo.697.1">defined </span><a id="_idIndexMarker284"/><span class="koboSpan" id="kobo.698.1">as</span><a id="_idIndexMarker285"/><span class="koboSpan" id="kobo.699.1"> follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.700.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.701.1">doSomething</span></span><span class="koboSpan" id="kobo.702.1">() {
  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.703.1">// ...</span></span><span class="koboSpan" id="kobo.704.1">
}
</span></code></pre>
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.705.1">Regular anonymous functions</span></strong><span class="koboSpan" id="kobo.706.1"> are</span><a id="_idIndexMarker286"/><span class="koboSpan" id="kobo.707.1"> defined as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.708.1">() =&gt; {
  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.709.1">// ...</span></span><span class="koboSpan" id="kobo.710.1">
}
</span></code></pre>
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.711.1">Asynchronous functions</span></strong><span class="koboSpan" id="kobo.712.1"> are</span><a id="_idIndexMarker287"/><span class="koboSpan" id="kobo.713.1"> defined by adding the </span><code class="inlineCode"><span class="koboSpan" id="kobo.714.1">async</span></code><span class="koboSpan" id="kobo.715.1"> keyword:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.716.1">async</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.717.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.718.1">doSomething</span></span><span class="koboSpan" id="kobo.719.1">() {
  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.720.1">// ...</span></span><span class="koboSpan" id="kobo.721.1">
}
</span></code></pre>
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.722.1">Asynchronous anonymous functions</span></strong><span class="koboSpan" id="kobo.723.1"> are also possible:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.724.1">async</span></span><span class="koboSpan" id="kobo.725.1"> () =&gt; {
  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.726.1">// ...</span></span><span class="koboSpan" id="kobo.727.1">
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.728.1">Within </span><code class="inlineCode"><span class="koboSpan" id="kobo.729.1">async</span></code><span class="koboSpan" id="kobo.730.1"> functions, we can use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.731.1">await</span></code><span class="koboSpan" id="kobo.732.1"> keyword to wait for promises to resolve before continuing. </span><span class="koboSpan" id="kobo.732.2">Instead </span><a id="_idIndexMarker288"/><span class="koboSpan" id="kobo.733.1">of having </span><a id="_idIndexMarker289"/><span class="koboSpan" id="kobo.734.1">to do the following:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.735.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.736.1">fetchPosts</span></span><span class="koboSpan" id="kobo.737.1">() {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.738.1">return</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.739.1">fetch</span></span><span class="koboSpan" id="kobo.740.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.741.1">'/api/posts'</span></span><span class="koboSpan" id="kobo.742.1">)
    .</span><span class="hljs-title"><span class="koboSpan" id="kobo.743.1">then</span></span><span class="koboSpan" id="kobo.744.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.745.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.746.1">response</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.747.1">) =&gt;</span></span><span class="koboSpan" id="kobo.748.1"> response.</span><span class="hljs-title"><span class="koboSpan" id="kobo.749.1">json</span></span><span class="koboSpan" id="kobo.750.1">())
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.751.1">We can now write the same function like this using </span><code class="inlineCode"><span class="koboSpan" id="kobo.752.1">async</span></code><span class="koboSpan" id="kobo.753.1">/</span><code class="inlineCode"><span class="koboSpan" id="kobo.754.1">await</span></code><span class="koboSpan" id="kobo.755.1">:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.756.1">async</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.757.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.758.1">fetchPosts</span></span><span class="koboSpan" id="kobo.759.1">() {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.760.1">const</span></span><span class="koboSpan" id="kobo.761.1"> response = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.762.1">await</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.763.1">fetch</span></span><span class="koboSpan" id="kobo.764.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.765.1">'/api/posts'</span></span><span class="koboSpan" id="kobo.766.1">)
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.767.1">const</span></span><span class="koboSpan" id="kobo.768.1"> posts = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.769.1">await</span></span><span class="koboSpan" id="kobo.770.1"> response.</span><span class="hljs-title"><span class="koboSpan" id="kobo.771.1">json</span></span><span class="koboSpan" id="kobo.772.1">()
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.773.1">return</span></span><span class="koboSpan" id="kobo.774.1"> posts
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.775.1">In the previous section, we used the Promise API to work with the result of an asynchronous function by using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.776.1">.then()</span></code><span class="koboSpan" id="kobo.777.1"> function inside the Effect Hook. </span><span class="koboSpan" id="kobo.777.2">Effect Hooks do not support passing an async function to them to prevent race conditions. </span><span class="koboSpan" id="kobo.777.3">However, it would be possible to define an async function inside the Hook and then call it immediately. </span><span class="koboSpan" id="kobo.777.4">So, we could also define the Hook as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"> <span class="hljs-title"><span class="koboSpan" id="kobo.778.1">useEffect</span></span><span class="koboSpan" id="kobo.779.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.780.1">() =&gt;</span></span><span class="koboSpan" id="kobo.781.1"> {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.782.1">async</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.783.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.784.1">fetchPosts</span></span><span class="koboSpan" id="kobo.785.1">() {
      </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.786.1">const</span></span><span class="koboSpan" id="kobo.787.1"> response = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.788.1">await</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.789.1">fetch</span></span><span class="koboSpan" id="kobo.790.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.791.1">'/api/posts'</span></span><span class="koboSpan" id="kobo.792.1">)
      </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.793.1">const</span></span><span class="koboSpan" id="kobo.794.1"> posts = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.795.1">await</span></span><span class="koboSpan" id="kobo.796.1"> response.</span><span class="hljs-title"><span class="koboSpan" id="kobo.797.1">json</span></span><span class="koboSpan" id="kobo.798.1">()
      </span><span class="hljs-title"><span class="koboSpan" id="kobo.799.1">dispatch</span></span><span class="koboSpan" id="kobo.800.1">({ </span><span class="hljs-attr"><span class="koboSpan" id="kobo.801.1">type</span></span><span class="koboSpan" id="kobo.802.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.803.1">'FETCH_POSTS'</span></span><span class="koboSpan" id="kobo.804.1">, posts })
    }
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.805.1">void</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.806.1">fetchPosts</span></span><span class="koboSpan" id="kobo.807.1">()
  }, [])
</span></code></pre>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.808.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.809.1">void</span></code><span class="koboSpan" id="kobo.810.1"> operator shows that we did not just accidentally call an </span><code class="inlineCode"><span class="koboSpan" id="kobo.811.1">async</span></code><span class="koboSpan" id="kobo.812.1"> function without </span><code class="inlineCode"><span class="koboSpan" id="kobo.813.1">await</span></code><span class="koboSpan" id="kobo.814.1">. </span><span class="koboSpan" id="kobo.814.2">In this case, we want to call the asynchronous function but do not care about waiting for it to finish.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.815.1">As you can see, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.816.1">async</span></code><span class="koboSpan" id="kobo.817.1">/</span><code class="inlineCode"><span class="koboSpan" id="kobo.818.1">await</span></code><span class="koboSpan" id="kobo.819.1"> construct can make our code easier to read in some cases. </span><span class="koboSpan" id="kobo.819.2">You can choose either pattern (</span><code class="inlineCode"><span class="koboSpan" id="kobo.820.1">then</span></code><span class="koboSpan" id="kobo.821.1"> or </span><code class="inlineCode"><span class="koboSpan" id="kobo.822.1">async</span></code><span class="koboSpan" id="kobo.823.1">/</span><code class="inlineCode"><span class="koboSpan" id="kobo.824.1">await</span></code><span class="koboSpan" id="kobo.825.1">) depending on which one makes the code more readable. </span><span class="koboSpan" id="kobo.825.2">However, it is best practice not to mix both in the same function. </span><span class="koboSpan" id="kobo.825.3">Of course, instead of using </span><code class="inlineCode"><span class="koboSpan" id="kobo.826.1">dispatch</span></code><span class="koboSpan" id="kobo.827.1"> and the</span><a id="_idIndexMarker290"/><span class="koboSpan" id="kobo.828.1"> Reducer </span><a id="_idIndexMarker291"/><span class="koboSpan" id="kobo.829.1">Hook, we could also call </span><code class="inlineCode"><span class="koboSpan" id="kobo.830.1">setPosts</span></code><span class="koboSpan" id="kobo.831.1"> here, if we had a State Hook instead.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.832.1">Now that posts are successfully loaded from the database, let’s implement a way to create posts via the backend server.</span></p>
<h2 class="heading-2" id="_idParaDest-152"><a id="_idTextAnchor158"/><span class="koboSpan" id="kobo.833.1">Creating new posts on the server</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.834.1">For creating </span><a id="_idIndexMarker292"/><span class="koboSpan" id="kobo.835.1">posts, we simply </span><a id="_idIndexMarker293"/><span class="koboSpan" id="kobo.836.1">need to adjust the submit handler function to use </span><code class="inlineCode"><span class="koboSpan" id="kobo.837.1">fetch</span></code><span class="koboSpan" id="kobo.838.1"> to perform a POST request. </span><span class="koboSpan" id="kobo.838.2">Let’s get started doing that now:</span></p>
<ol>
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.839.1">Edit </span><code class="inlineCode"><span class="koboSpan" id="kobo.840.1">src/components/post/CreatePost.jsx</span></code><span class="koboSpan" id="kobo.841.1"> and make the </span><code class="inlineCode"><span class="koboSpan" id="kobo.842.1">handleSubmit</span></code><span class="koboSpan" id="kobo.843.1"> function </span><code class="inlineCode"><span class="koboSpan" id="kobo.844.1">async</span></code><span class="koboSpan" id="kobo.845.1">:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.846.1">async</span></strong></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.847.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.848.1">handleSubmit</span></span><span class="koboSpan" id="kobo.849.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.850.1">e</span></span><span class="koboSpan" id="kobo.851.1">) {
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.852.1">Inside the function, after collecting the values, create a fetch request to </span><code class="inlineCode"><span class="koboSpan" id="kobo.853.1">/api/posts</span></code><span class="koboSpan" id="kobo.854.1">:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="koboSpan" id="kobo.855.1">    e.</span><span class="hljs-title"><span class="koboSpan" id="kobo.856.1">preventDefault</span></span><span class="koboSpan" id="kobo.857.1">()
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.858.1">const</span></span><span class="koboSpan" id="kobo.859.1"> form = e.</span><span class="hljs-property"><span class="koboSpan" id="kobo.860.1">target</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.861.1">const</span></span><span class="koboSpan" id="kobo.862.1"> title = form.</span><span class="hljs-property"><span class="koboSpan" id="kobo.863.1">elements</span></span><span class="koboSpan" id="kobo.864.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.865.1">title</span></span><span class="koboSpan" id="kobo.866.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.867.1">value</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.868.1">const</span></span><span class="koboSpan" id="kobo.869.1"> content = form.</span><span class="hljs-property"><span class="koboSpan" id="kobo.870.1">elements</span></span><span class="koboSpan" id="kobo.871.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.872.1">content</span></span><span class="koboSpan" id="kobo.873.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.874.1">value</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.875.1">const</span></span><span class="koboSpan" id="kobo.876.1"> newPost = { title, content, </span><span class="hljs-attr"><span class="koboSpan" id="kobo.877.1">author</span></span><span class="koboSpan" id="kobo.878.1">: username</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.879.1">, </span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.880.1">featured</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.881.1">: </span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.882.1">false</span></strong></span><span class="koboSpan" id="kobo.883.1"> }
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.884.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.885.1"> response = </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.886.1">await</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.887.1">fetch</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.888.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.889.1">'/api/posts'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.890.1">, {</span></strong></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.891.1">Make sure this is a POST request and set the header so that our backend server knows we will be sending a JSON object:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-attr"><span class="koboSpan" id="kobo.892.1">method</span></span><span class="koboSpan" id="kobo.893.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.894.1">'POST'</span></span><span class="koboSpan" id="kobo.895.1">,
      </span><span class="hljs-attr"><span class="koboSpan" id="kobo.896.1">headers</span></span><span class="koboSpan" id="kobo.897.1">: { </span><span class="hljs-string"><span class="koboSpan" id="kobo.898.1">'Content-Type'</span></span><span class="koboSpan" id="kobo.899.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.900.1">'application/json'</span></span><span class="koboSpan" id="kobo.901.1"> },
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.902.1">Now, we can </span><a id="_idIndexMarker294"/><span class="koboSpan" id="kobo.903.1">pass our </span><code class="inlineCode"><span class="koboSpan" id="kobo.904.1">post</span></code><span class="koboSpan" id="kobo.905.1"> object </span><a id="_idIndexMarker295"/><span class="koboSpan" id="kobo.906.1">as the request body, by turning it into a JSON string:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-attr"><span class="koboSpan" id="kobo.907.1">body</span></span><span class="koboSpan" id="kobo.908.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.909.1">JSON</span></span><span class="koboSpan" id="kobo.910.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.911.1">stringify</span></span><span class="koboSpan" id="kobo.912.1">(newPost),
    })
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.913.1">If the response wasn’t a success, throw an error:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.914.1">if</span></span><span class="koboSpan" id="kobo.915.1"> (!response.</span><span class="hljs-property"><span class="koboSpan" id="kobo.916.1">ok</span></span><span class="koboSpan" id="kobo.917.1">) {
      </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.918.1">throw</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.919.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.920.1">Error</span></span><span class="koboSpan" id="kobo.921.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.922.1">'Unable to create post'</span></span><span class="koboSpan" id="kobo.923.1">)
    }
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.924.1">Otherwise, we dispatch the </span><code class="inlineCode"><span class="koboSpan" id="kobo.925.1">CREATE_POST</span></code><span class="koboSpan" id="kobo.926.1"> action to show the new post on the client-side and reset the form:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-title"><span class="koboSpan" id="kobo.927.1">dispatch</span></span><span class="koboSpan" id="kobo.928.1">({ </span><span class="hljs-attr"><span class="koboSpan" id="kobo.929.1">type</span></span><span class="koboSpan" id="kobo.930.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.931.1">'CREATE_POST'</span></span><span class="koboSpan" id="kobo.932.1">, </span><span class="hljs-attr"><span class="koboSpan" id="kobo.933.1">post</span></span><span class="koboSpan" id="kobo.934.1">: newPost })
    form.</span><span class="hljs-title"><span class="koboSpan" id="kobo.935.1">reset</span></span><span class="koboSpan" id="kobo.936.1">()
  }
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.937.1">Create a new post using the frontend, and then check the </span><code class="inlineCode"><span class="koboSpan" id="kobo.938.1">server/db.json</span></code><span class="koboSpan" id="kobo.939.1"> file.</span></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.940.1">As we can see, the</span><a id="_idIndexMarker296"/><span class="koboSpan" id="kobo.941.1"> new post was</span><a id="_idIndexMarker297"/><span class="koboSpan" id="kobo.942.1"> successfully inserted into the database:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.943.1"><img alt="Figure 6.3 – We successfully inserted a new post into the database" src="../Images/B31327_06_03.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.944.1">Figure 6.3 – We successfully inserted a new post into the database</span></p>
<div class="note">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.945.1">Example code</span></strong></p>
<p class="normal"><span class="koboSpan" id="kobo.946.1">The example code for this section can be found in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.947.1">Chapter06/Chapter06_2</span></code><span class="koboSpan" id="kobo.948.1"> folder. </span><span class="koboSpan" id="kobo.948.2">Check the </span><code class="inlineCode"><span class="koboSpan" id="kobo.949.1">README.md</span></code><span class="koboSpan" id="kobo.950.1"> file inside the folder for instructions on how to set up and run the example.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.951.1">Now that we have successfully implemented fetching and creating posts by directly using the Fetch API and</span><a id="_idIndexMarker298"/><span class="koboSpan" id="kobo.952.1"> an Effect Hook, we</span><a id="_idIndexMarker299"/><span class="koboSpan" id="kobo.953.1"> can move on to learning about using a library to request resources and make changes.</span></p>
<h1 class="heading-1" id="_idParaDest-153"><a id="_idTextAnchor159"/><span class="koboSpan" id="kobo.954.1">Using TanStack Query to request resources and make changes</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.955.1">In the previous </span><a id="_idIndexMarker300"/><span class="koboSpan" id="kobo.956.1">section, we used an Effect Hook to trigger the</span><a id="_idIndexMarker301"/><span class="koboSpan" id="kobo.957.1"> request, and a Reducer Hook to update the state, using the result from the request. </span><span class="koboSpan" id="kobo.957.2">Instead of manually implementing requests like this, we can instead use the TanStack Query library. </span><span class="koboSpan" id="kobo.957.3">This library not only allows us to easily fetch resources, but also caches the result for us and provides ways to invalidate the state. </span><span class="koboSpan" id="kobo.957.4">Invalidation allows us to, for example, re-fetch posts from the server after creating a new post, instead of having to manually dispatch an action.</span></p>
<h2 class="heading-2" id="_idParaDest-154"><a id="_idTextAnchor160"/><span class="koboSpan" id="kobo.958.1">Setting up the library</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.959.1">Before we can get</span><a id="_idIndexMarker302"/><span class="koboSpan" id="kobo.960.1"> started using it, we need to install and set up the library. </span><span class="koboSpan" id="kobo.960.2">TanStack Query is a library used to manage state of server data. </span><span class="koboSpan" id="kobo.960.3">It consists of 3 parts:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.961.1">A </span><strong class="keyWord"><span class="koboSpan" id="kobo.962.1">Query Client</span></strong><span class="koboSpan" id="kobo.963.1">, which manages the cache and invalidation.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.964.1">A </span><strong class="keyWord"><span class="koboSpan" id="kobo.965.1">Query Client Provider</span></strong><span class="koboSpan" id="kobo.966.1">, which wraps your application to provide the query client to all components.</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.967.1">A collection of hooks, such as Query and Mutation </span><a id="_idIndexMarker303"/><span class="koboSpan" id="kobo.968.1">Hooks. </span><span class="koboSpan" id="kobo.968.2">The </span><strong class="keyWord"><span class="koboSpan" id="kobo.969.1">Query Hook</span></strong><span class="koboSpan" id="kobo.970.1"> is used for fetching and subscribing to data, while</span><a id="_idIndexMarker304"/><span class="koboSpan" id="kobo.971.1"> the </span><strong class="keyWord"><span class="koboSpan" id="kobo.972.1">Mutation Hook</span></strong><span class="koboSpan" id="kobo.973.1"> is used when you need to modify data on the server.</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.974.1">Let’s get started setting up TanStack Query now:</span></p>
<ol>
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.975.1">Copy the </span><code class="inlineCode"><span class="koboSpan" id="kobo.976.1">Chapter06_2</span></code><span class="koboSpan" id="kobo.977.1"> folder to a new </span><code class="inlineCode"><span class="koboSpan" id="kobo.978.1">Chapter06_3</span></code><span class="koboSpan" id="kobo.979.1"> folder by executing the following command:
        </span><pre class="programlisting con-one"><code class="hljs-con"><span class="koboSpan" id="kobo.980.1">$ cp -R Chapter06_2 Chapter06_3
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.981.1">Open the new </span><code class="inlineCode"><span class="koboSpan" id="kobo.982.1">Chapter06_3</span></code><span class="koboSpan" id="kobo.983.1"> folder in VS Code.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.984.1">Install the TanStack Query library, as follows:
        </span><pre class="programlisting con-one"><code class="hljs-con"><span class="koboSpan" id="kobo.985.1">$ npm install --save-exact @tanstack/react-query@5.66.7
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.986.1">Additionally, install the ESLint plugin as a dev dependency:
        </span><pre class="programlisting con-one"><code class="hljs-con"><span class="koboSpan" id="kobo.987.1">$ npm install --save-dev --save-exact @tanstack/eslint-plugin-query@5.66.1
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.988.1">Edit </span><code class="inlineCode"><span class="koboSpan" id="kobo.989.1">eslint.config.js</span></code><span class="koboSpan" id="kobo.990.1"> and import the plugin there:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.991.1">import</span></span><span class="koboSpan" id="kobo.992.1"> pluginQuery </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.993.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.994.1">'@tanstack/eslint-plugin-query'</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.995.1">Then, add </span><a id="_idIndexMarker305"/><span class="koboSpan" id="kobo.996.1">the plugin, as follows:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.997.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.998.1">default</span></span><span class="koboSpan" id="kobo.999.1"> [
</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1000.1">  ...pluginQuery.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1001.1">configs</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1002.1">[</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1003.1">'flat/recommended'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1004.1">],</span></strong></span><span class="koboSpan" id="kobo.1005.1">
  { </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1006.1">ignores</span></span><span class="koboSpan" id="kobo.1007.1">: [</span><span class="hljs-string"><span class="koboSpan" id="kobo.1008.1">'dist'</span></span><span class="koboSpan" id="kobo.1009.1">] },
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1010.1">Now we can get started setting up TanStack Query itself. </span><span class="koboSpan" id="kobo.1010.2">First, create a new </span><code class="inlineCode"><span class="koboSpan" id="kobo.1011.1">src/api.js</span></code><span class="koboSpan" id="kobo.1012.1"> file, which will contain the Query Client.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1013.1">Edit </span><code class="inlineCode"><span class="koboSpan" id="kobo.1014.1">src/api.js</span></code><span class="koboSpan" id="kobo.1015.1"> and import and create the Query Client:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1016.1">import</span></span><span class="koboSpan" id="kobo.1017.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.1018.1">QueryClient</span></span><span class="koboSpan" id="kobo.1019.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1020.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1021.1">'@tanstack/react-query'</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1022.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1023.1">const</span></span><span class="koboSpan" id="kobo.1024.1"> queryClient = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1025.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1026.1">QueryClient</span></span><span class="koboSpan" id="kobo.1027.1">()
</span></code></pre>
</li>
</ol>
<p class="normal-one"><span class="koboSpan" id="kobo.1028.1">We are creating a single instance of the query client here to ensure that all parts of our app use the same query client (and thus the same cache).</span></p>
<ol>
<li class="numberedList" value="9"><span class="koboSpan" id="kobo.1029.1">Now, edit </span><code class="inlineCode"><span class="koboSpan" id="kobo.1030.1">src/App.jsx</span></code><span class="koboSpan" id="kobo.1031.1">, </span><em class="italic"><span class="koboSpan" id="kobo.1032.1">remove</span></em><span class="koboSpan" id="kobo.1033.1"> the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1034.1">useReducer</span></code><span class="koboSpan" id="kobo.1035.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1036.1">useEffect</span></code><span class="koboSpan" id="kobo.1037.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1038.1">postsReducer</span></code><span class="koboSpan" id="kobo.1039.1"> imports:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1040.1">import</span></span><span class="koboSpan" id="kobo.1041.1"> { useState</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1042.1">, useReducer, useEffect</span></strong></span><span class="koboSpan" id="kobo.1043.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1044.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1045.1">'react'</span></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1046.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1047.1"> { postsReducer } </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1048.1">from</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1049.1">'./reducers.js'</span></strong></span>
</code></pre>
</li>
</ol>
<p class="normal-one"><em class="italic"><span class="koboSpan" id="kobo.1050.1">Replace</span></em><span class="koboSpan" id="kobo.1051.1"> them with imports of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1052.1">queryClient</span></code><span class="koboSpan" id="kobo.1053.1"> and the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1054.1">QueryClientProvider</span></code><span class="koboSpan" id="kobo.1055.1">:</span></p>
<pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1056.1">import</span></span><span class="koboSpan" id="kobo.1057.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.1058.1">QueryClientProvider</span></span><span class="koboSpan" id="kobo.1059.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1060.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1061.1">'@tanstack/react-query'</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1062.1">import</span></span><span class="koboSpan" id="kobo.1063.1"> { queryClient } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1064.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1065.1">'./api.js'</span></span>
</code></pre>
<ol>
<li class="numberedList" value="10"><span class="koboSpan" id="kobo.1066.1">Inside the</span><a id="_idIndexMarker306"/><span class="koboSpan" id="kobo.1067.1"> App component, </span><em class="italic"><span class="koboSpan" id="kobo.1068.1">remove</span></em><span class="koboSpan" id="kobo.1069.1"> the Hooks related to fetching posts:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1070.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1071.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1072.1">App</span></span><span class="koboSpan" id="kobo.1073.1">() {
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1074.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1075.1"> [posts, dispatch] = </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1076.1">useReducer</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1077.1">(postsReducer, [])</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1078.1">const</span></span><span class="koboSpan" id="kobo.1079.1"> [username, setUsername] = </span><span class="hljs-title"><span class="koboSpan" id="kobo.1080.1">useState</span></span><span class="koboSpan" id="kobo.1081.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1082.1">''</span></span><span class="koboSpan" id="kobo.1083.1">)
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1084.1">useEffect</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1085.1">(</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1086.1">() =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1087.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1088.1">fetch</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1089.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1090.1">'/api/posts'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1091.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1092.1">      .</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1093.1">then</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1094.1">(</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1095.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1096.1">response</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1097.1">) =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1098.1"> response.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1099.1">json</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1100.1">())</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1101.1">      .</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1102.1">then</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1103.1">(</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1104.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1105.1">posts</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1106.1">) =&gt;</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1107.1">dispatch</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1108.1">({ </span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1109.1">type</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1110.1">: </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1111.1">'FETCH_POSTS'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1112.1">, posts }))</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1113.1">  }, [])</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1114.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1115.1"> featuredPosts = posts.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1116.1">filter</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1117.1">(</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1118.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1119.1">post</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1120.1">) =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1121.1"> post.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1122.1">featured</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1123.1">).</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1124.1">reverse</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1125.1">()</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1126.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1127.1"> regularPosts = posts.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1128.1">filter</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1129.1">(</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1130.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1131.1">post</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1132.1">)</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1133.1">=&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1134.1"> !post.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1135.1">featured</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1136.1">).</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1137.1">reverse</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1138.1">()</span></strong></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1139.1">Wrap the app with a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1140.1">QueryClientProvider</span></code><span class="koboSpan" id="kobo.1141.1">, as follows:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1142.1">return</span></span><span class="koboSpan" id="kobo.1143.1"> (
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1144.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1145.1">QueryClientProvider</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1146.1">client</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1147.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1148.1">{queryClient}</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1149.1">&gt;</span></strong></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1150.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1151.1">UserContext.Provider</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1152.1">value</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1153.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1154.1">{[username,</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1155.1">setUsername</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1156.1">]}&gt;</span></span><span class="koboSpan" id="kobo.1157.1">
       …
      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1158.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1159.1">UserContext.Provider</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1160.1">&gt;</span></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1161.1">&lt;/</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1162.1">QueryClientProvider</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1163.1">&gt;</span></strong></span><span class="koboSpan" id="kobo.1164.1">
  )
}
</span></code></pre>
</li>
<li class="numberedList"><em class="italic"><span class="koboSpan" id="kobo.1165.1">Remove</span></em><span class="koboSpan" id="kobo.1166.1"> the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1167.1">dispatch</span></code><span class="koboSpan" id="kobo.1168.1"> prop from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1169.1">CreatePost</span></code><span class="koboSpan" id="kobo.1170.1"> component:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="koboSpan" id="kobo.1171.1">            {username &amp;&amp; </span><span class="code-highlight"><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1172.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1173.1">CreatePost</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1174.1"> /&gt;</span></strong></span><span class="koboSpan" id="kobo.1175.1">}
</span></code></pre>
</li>
</ol>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.1176.1">At this point in the chapter, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1177.1">featuredPosts</span></code><span class="koboSpan" id="kobo.1178.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1179.1">regularPosts</span></code><span class="koboSpan" id="kobo.1180.1"> arrays are not defined anymore, causing ESLint errors. </span><span class="koboSpan" id="kobo.1180.2">Ignore these errors for now, we will be fixing them soon.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.1181.1">Now we are </span><a id="_idIndexMarker307"/><span class="koboSpan" id="kobo.1182.1">ready to use TanStack Query!</span></p>
<h2 class="heading-2" id="_idParaDest-155"><a id="_idTextAnchor161"/><span class="koboSpan" id="kobo.1183.1">Fetching posts using a Query Hook</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1184.1">Now that the </span><a id="_idIndexMarker308"/><span class="koboSpan" id="kobo.1185.1">library is set up, we can start using it. </span><span class="koboSpan" id="kobo.1185.2">We </span><a id="_idIndexMarker309"/><span class="koboSpan" id="kobo.1186.1">will start by fetching posts using a Query Hook. </span><span class="koboSpan" id="kobo.1186.2">To</span><a id="_idIndexMarker310"/><span class="koboSpan" id="kobo.1187.1"> do this, we are going to create a new </span><code class="inlineCode"><span class="koboSpan" id="kobo.1188.1">PostFeed</span></code><span class="koboSpan" id="kobo.1189.1"> component, which will handle the fetching logic, while keeping </span><code class="inlineCode"><span class="koboSpan" id="kobo.1190.1">PostList</span></code><span class="koboSpan" id="kobo.1191.1"> as a UI component that renders a list of components. </span><span class="koboSpan" id="kobo.1191.2">We are also going to define a function that will fetch posts for us in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1192.1">src/api.js</span></code><span class="koboSpan" id="kobo.1193.1"> file.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1194.1">Let’s get started fetching posts using a Query Hook now:</span></p>
<ol>
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1195.1">Edit </span><code class="inlineCode"><span class="koboSpan" id="kobo.1196.1">src/api.js</span></code><span class="koboSpan" id="kobo.1197.1"> and define a new function that accepts a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1198.1">featured</span></code><span class="koboSpan" id="kobo.1199.1"> prop and then fetches posts for us:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1200.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1201.1">async</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1202.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1203.1">fetchPosts</span></span><span class="koboSpan" id="kobo.1204.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.1205.1">{ featured }</span></span><span class="koboSpan" id="kobo.1206.1">) {
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1207.1">We make a call to the API, passing the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1208.1">featured</span></code><span class="koboSpan" id="kobo.1209.1"> prop as a query param. </span><span class="koboSpan" id="kobo.1209.2">This will cause </span><code class="inlineCode"><span class="koboSpan" id="kobo.1210.1">json-server</span></code><span class="koboSpan" id="kobo.1211.1"> to filter the posts by their </span><code class="inlineCode"><span class="koboSpan" id="kobo.1212.1">featured</span></code><span class="koboSpan" id="kobo.1213.1"> value for us:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1214.1">const</span></span><span class="koboSpan" id="kobo.1215.1"> res = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1216.1">await</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1217.1">fetch</span></span><span class="koboSpan" id="kobo.1218.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1219.1">`/api/posts?featured=</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1220.1">${featured}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1221.1">`</span></span><span class="koboSpan" id="kobo.1222.1">)
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1223.1">Parse the response as JSON and return it:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1224.1">return</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1225.1">await</span></span><span class="koboSpan" id="kobo.1226.1"> res.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1227.1">json</span></span><span class="koboSpan" id="kobo.1228.1">()
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1229.1">Create a new </span><code class="inlineCode"><span class="koboSpan" id="kobo.1230.1">src/components/post/PostFeed.jsx</span></code><span class="koboSpan" id="kobo.1231.1"> file.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1232.1">Inside it, import the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1233.1">useQuery</span></code><span class="koboSpan" id="kobo.1234.1"> function, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1235.1">PostList</span></code><span class="koboSpan" id="kobo.1236.1"> component and the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1237.1">fetchPosts</span></code><span class="koboSpan" id="kobo.1238.1"> function:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1239.1">import</span></span><span class="koboSpan" id="kobo.1240.1"> { useQuery } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1241.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1242.1">'@tanstack/react-query'</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1243.1">import</span></span><span class="koboSpan" id="kobo.1244.1"> { fetchPosts } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1245.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1246.1">'@/api.js'</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1247.1">import</span></span><span class="koboSpan" id="kobo.1248.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.1249.1">PostList</span></span><span class="koboSpan" id="kobo.1250.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1251.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1252.1">'./PostList.jsx'</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1253.1">Then, define</span><a id="_idIndexMarker311"/><span class="koboSpan" id="kobo.1254.1"> the component, which </span><a id="_idIndexMarker312"/><span class="koboSpan" id="kobo.1255.1">accepts a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1256.1">featured</span></code><span class="koboSpan" id="kobo.1257.1"> prop to toggle</span><a id="_idIndexMarker313"/><span class="koboSpan" id="kobo.1258.1"> whether to render featured components or regular components:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1259.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1260.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1261.1">PostFeed</span></span><span class="koboSpan" id="kobo.1262.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.1263.1">{ featured = </span></span><span class="hljs-literal"><span class="koboSpan" id="kobo.1264.1">false</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1265.1"> }</span></span><span class="koboSpan" id="kobo.1266.1">) {
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1267.1">Define a Query Hook, from which we use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1268.1">data</span></code><span class="koboSpan" id="kobo.1269.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1270.1">isLoading</span></code><span class="koboSpan" id="kobo.1271.1"> values:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1272.1">const</span></span><span class="koboSpan" id="kobo.1273.1"> { data, isLoading } = </span><span class="hljs-title"><span class="koboSpan" id="kobo.1274.1">useQuery</span></span><span class="koboSpan" id="kobo.1275.1">({
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1276.1">For each Query Hook, we need to define a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1277.1">queryKey</span></code><span class="koboSpan" id="kobo.1278.1">. </span><span class="koboSpan" id="kobo.1278.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1279.1">queryKey</span></code><span class="koboSpan" id="kobo.1280.1"> is used to cache the results of a query:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-attr"><span class="koboSpan" id="kobo.1281.1">    queryKey</span></span><span class="koboSpan" id="kobo.1282.1">: [</span><span class="hljs-string"><span class="koboSpan" id="kobo.1283.1">'posts'</span></span><span class="koboSpan" id="kobo.1284.1">, featured],
</span></code></pre>
</li>
</ol>
<p class="normal-one"><span class="koboSpan" id="kobo.1285.1">If we, for example, fetch with the same </span><code class="inlineCode"><span class="koboSpan" id="kobo.1286.1">queryKey</span></code><span class="koboSpan" id="kobo.1287.1"> in another component, we will get the cached result instead of making another request. </span><span class="koboSpan" id="kobo.1287.2">React Query will always try to first get the result from the cache (if it exists for a given </span><code class="inlineCode"><span class="koboSpan" id="kobo.1288.1">queryKey</span></code><span class="koboSpan" id="kobo.1289.1">), and if it does not exist in the cache yet, it will make a request in the background for us and cache it. </span></p>
<p class="normal-one"><span class="koboSpan" id="kobo.1290.1">This is very useful as it allows us to fetch data further down in the component tree, directly wherever we need it – avoiding prop drilling without compromising performance.</span></p>
<div class="note-one">
<p class="normal"><span class="koboSpan" id="kobo.1291.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1292.1">queryKey</span></code><span class="koboSpan" id="kobo.1293.1"> can also be a source of bugs, when it is accidentally reused for different requests. </span><span class="koboSpan" id="kobo.1293.2">For example, we need to add the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1294.1">featured</span></code><span class="koboSpan" id="kobo.1295.1"> prop to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1296.1">queryKey</span></code><span class="koboSpan" id="kobo.1297.1"> here, otherwise only either featured or regular posts would get fetched and returned twice. </span><span class="koboSpan" id="kobo.1297.2">If you are getting weird results or outdated data returned from Query Hooks, make sure to check your query keys and ensure that you have a unique key for each request and that all parameters passed to the query function are also added to the query key.</span></p>
</div>
<ol>
<li class="numberedList" value="9"><span class="koboSpan" id="kobo.1298.1">Next, we define the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1299.1">queryFn</span></code><span class="koboSpan" id="kobo.1300.1"> – a function that will be called when the query is executed. </span><span class="koboSpan" id="kobo.1300.2">In</span><a id="_idIndexMarker314"/><span class="koboSpan" id="kobo.1301.1"> this case, we simply </span><a id="_idIndexMarker315"/><span class="koboSpan" id="kobo.1302.1">call </span><a id="_idIndexMarker316"/><span class="koboSpan" id="kobo.1303.1">the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1304.1">fetchPosts</span></code><span class="koboSpan" id="kobo.1305.1"> function with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1306.1">featured</span></code><span class="koboSpan" id="kobo.1307.1"> prop:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-attr"><span class="koboSpan" id="kobo.1308.1">    queryFn</span></span><span class="koboSpan" id="kobo.1309.1">: </span><span class="hljs-function"><span class="koboSpan" id="kobo.1310.1">() =&gt;</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1311.1">fetchPosts</span></span><span class="koboSpan" id="kobo.1312.1">({ featured }),
  })
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1313.1">If the Query Hook is in a loading state, we show a loading message:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1314.1">if</span></span><span class="koboSpan" id="kobo.1315.1"> (isLoading) {
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1316.1">    return</span></span> <span class="hljs-tag"><span class="koboSpan" id="kobo.1317.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1318.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1319.1">&gt;</span></span><span class="koboSpan" id="kobo.1320.1">Loading posts...</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1321.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1322.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1323.1">&gt;</span></span><span class="koboSpan" id="kobo.1324.1">
  }
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1325.1">Similarly, if fetching the data did not work, we show an error message:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1326.1">if</span></span><span class="koboSpan" id="kobo.1327.1"> (!data) {
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1328.1">    return</span></span> <span class="hljs-tag"><span class="koboSpan" id="kobo.1329.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1330.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1331.1">&gt;</span></span><span class="koboSpan" id="kobo.1332.1">Could not load posts!</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1333.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1334.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1335.1">&gt;</span></span><span class="koboSpan" id="kobo.1336.1">
  }
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1337.1">Otherwise, everything is fine, and we can render the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1338.1">PostList</span></code><span class="koboSpan" id="kobo.1339.1">:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1340.1">return</span></span> <span class="hljs-tag"><span class="koboSpan" id="kobo.1341.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1342.1">PostList</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1343.1">posts</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1344.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1345.1">{data}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1346.1"> /&gt;</span></span><span class="koboSpan" id="kobo.1347.1">
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1348.1">Edit </span><code class="inlineCode"><span class="koboSpan" id="kobo.1349.1">src/App.jsx</span></code><span class="koboSpan" id="kobo.1350.1"> and </span><em class="italic"><span class="koboSpan" id="kobo.1351.1">remove</span></em><span class="koboSpan" id="kobo.1352.1"> the following </span><code class="inlineCode"><span class="koboSpan" id="kobo.1353.1">PostList</span></code><span class="koboSpan" id="kobo.1354.1"> import:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1355.1">import</span></span><span class="koboSpan" id="kobo.1356.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.1357.1">PostList</span></span><span class="koboSpan" id="kobo.1358.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1359.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1360.1">'./components/post/PostList.jsx'</span></span>
</code></pre>
</li>
</ol>
<p class="normal-one"><em class="italic"><span class="koboSpan" id="kobo.1361.1">Replace</span></em><span class="koboSpan" id="kobo.1362.1"> it with an import of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1363.1">PostFeed</span></code><span class="koboSpan" id="kobo.1364.1"> component:</span></p>
<pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1365.1">import</span></span><span class="koboSpan" id="kobo.1366.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.1367.1">PostFeed</span></span><span class="koboSpan" id="kobo.1368.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1369.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1370.1">'./components/post/PostFeed.jsx'</span></span>
</code></pre>
<ol>
<li class="numberedList" value="14"><span class="koboSpan" id="kobo.1371.1">Inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1372.1">App</span></code><span class="koboSpan" id="kobo.1373.1"> component, replace the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1374.1">PostList</span></code><span class="koboSpan" id="kobo.1375.1"> components with </span><code class="inlineCode"><span class="koboSpan" id="kobo.1376.1">PostFeed</span></code><span class="koboSpan" id="kobo.1377.1"> components, as follows:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="koboSpan" id="kobo.1378.1">            &lt;hr /&gt;
            </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1379.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1380.1">ThemeContext.Provider</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1381.1">value</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1382.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1383.1">{{</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1384.1">primaryColor:</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1385.1"> '</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1386.1">salmon</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1387.1">' }}&gt;</span></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1388.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1389.1">PostFeed</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1390.1">featured</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1391.1"> /&gt;</span></strong></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1392.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1393.1">ThemeContext.Provider</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1394.1">&gt;</span></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1395.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1396.1">PostFeed</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1397.1"> /&gt;</span></strong></span>
</code></pre>
</li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.1398.1">After </span><a id="_idIndexMarker317"/><span class="koboSpan" id="kobo.1399.1">implementing </span><a id="_idIndexMarker318"/><span class="koboSpan" id="kobo.1400.1">a way to fetch posts, let’s continue</span><a id="_idIndexMarker319"/><span class="koboSpan" id="kobo.1401.1"> by using a Mutation Hook to create a new post.</span></p>
<h2 class="heading-2" id="_idParaDest-156"><a id="_idTextAnchor162"/><span class="koboSpan" id="kobo.1402.1">Creating posts using a Mutation Hook</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1403.1">Fetching posts</span><a id="_idIndexMarker320"/><span class="koboSpan" id="kobo.1404.1"> required</span><a id="_idIndexMarker321"/><span class="koboSpan" id="kobo.1405.1"> us to </span><a id="_idIndexMarker322"/><span class="koboSpan" id="kobo.1406.1">make a request to get data from the server when the component mounts. </span><span class="koboSpan" id="kobo.1406.2">However, for creating posts, we want to make a request to the server when the user presses a button. </span><span class="koboSpan" id="kobo.1406.3">To implement such a behavior, we need a Mutation Hook instead of a Query Hook.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1407.1">Let’s get started implementing post creation using a Mutation Hook now:</span></p>
<ol>
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1408.1">Edit </span><code class="inlineCode"><span class="koboSpan" id="kobo.1409.1">src/api.js</span></code><span class="koboSpan" id="kobo.1410.1"> and define a new function to create a post:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1411.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1412.1">async</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1413.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1414.1">createPost</span></span><span class="koboSpan" id="kobo.1415.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.1416.1">post</span></span><span class="koboSpan" id="kobo.1417.1">) {
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1418.1">Inside it, we make a POST request, similarly to what we did before:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1419.1">const</span></span><span class="koboSpan" id="kobo.1420.1"> res = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1421.1">await</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1422.1">fetch</span></span><span class="koboSpan" id="kobo.1423.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1424.1">'/api/posts'</span></span><span class="koboSpan" id="kobo.1425.1">, {
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1426.1">method</span></span><span class="koboSpan" id="kobo.1427.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.1428.1">'POST'</span></span><span class="koboSpan" id="kobo.1429.1">,
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1430.1">headers</span></span><span class="koboSpan" id="kobo.1431.1">: { </span><span class="hljs-string"><span class="koboSpan" id="kobo.1432.1">'Content-Type'</span></span><span class="koboSpan" id="kobo.1433.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.1434.1">'application/json'</span></span><span class="koboSpan" id="kobo.1435.1"> },
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1436.1">body</span></span><span class="koboSpan" id="kobo.1437.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.1438.1">JSON</span></span><span class="koboSpan" id="kobo.1439.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1440.1">stringify</span></span><span class="koboSpan" id="kobo.1441.1">(post),
  })
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1442.1">If there was a problem with making the request, we throw an error:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1443.1">if</span></span><span class="koboSpan" id="kobo.1444.1"> (!res.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1445.1">ok</span></span><span class="koboSpan" id="kobo.1446.1">) {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1447.1">throw</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1448.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1449.1">Error</span></span><span class="koboSpan" id="kobo.1450.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1451.1">'Unable to create post'</span></span><span class="koboSpan" id="kobo.1452.1">)
  }
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1453.1">Otherwise, if the </span><a id="_idIndexMarker323"/><span class="koboSpan" id="kobo.1454.1">request </span><a id="_idIndexMarker324"/><span class="koboSpan" id="kobo.1455.1">was successful, we return the result:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1456.1">return</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1457.1">await</span></span><span class="koboSpan" id="kobo.1458.1"> res.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1459.1">json</span></span><span class="koboSpan" id="kobo.1460.1">()
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1461.1">Edit </span><code class="inlineCode"><span class="koboSpan" id="kobo.1462.1">src/components/post/CreatePost.jsx</span></code><span class="koboSpan" id="kobo.1463.1"> and import the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1464.1">useMutation</span></code><span class="koboSpan" id="kobo.1465.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1466.1">createPost</span></code><span class="koboSpan" id="kobo.1467.1"> functions, as well as the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1468.1">queryClient</span></code><span class="koboSpan" id="kobo.1469.1">:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1470.1">import</span></span><span class="koboSpan" id="kobo.1471.1"> { useMutation } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1472.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1473.1">'@tanstack/react-query'</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1474.1">import</span></span><span class="koboSpan" id="kobo.1475.1"> { createPost, queryClient } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1476.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1477.1">'@/api.js'</span></span>
</code></pre>
</li>
<li class="numberedList"><em class="italic"><span class="koboSpan" id="kobo.1478.1">Remove</span></em><span class="koboSpan" id="kobo.1479.1"> the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1480.1">dispatch</span></code><span class="koboSpan" id="kobo.1481.1"> prop from the component, as we will not need it anymore:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1482.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1483.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1484.1">CreatePost</span></span><span class="koboSpan" id="kobo.1485.1">(</span><span class="code-highlight"><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1486.1">{ dispatch }</span></strong></span><span class="koboSpan" id="kobo.1487.1">) {
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1488.1">Inside the component, add a new Mutation Hook, passing the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1489.1">createPost</span></code><span class="koboSpan" id="kobo.1490.1"> function as the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1491.1">mutationFn</span></code><span class="koboSpan" id="kobo.1492.1">:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1493.1">const</span></span><span class="koboSpan" id="kobo.1494.1"> createPostMutation = </span><span class="hljs-title"><span class="koboSpan" id="kobo.1495.1">useMutation</span></span><span class="koboSpan" id="kobo.1496.1">({
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1497.1">mutationFn</span></span><span class="koboSpan" id="kobo.1498.1">: createPost,
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1499.1">Add an </span><code class="inlineCode"><span class="koboSpan" id="kobo.1500.1">onSuccess</span></code><span class="koboSpan" id="kobo.1501.1"> handler, which will invalidate all queries that start with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1502.1">'posts'</span></code><span class="koboSpan" id="kobo.1503.1"> query key:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-attr"><span class="koboSpan" id="kobo.1504.1">onSuccess</span></span><span class="koboSpan" id="kobo.1505.1">: </span><span class="hljs-function"><span class="koboSpan" id="kobo.1506.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1507.1"> {
      queryClient.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1508.1">invalidateQueries</span></span><span class="koboSpan" id="kobo.1509.1">([</span><span class="hljs-string"><span class="koboSpan" id="kobo.1510.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1511.1">posts'</span></span><span class="koboSpan" id="kobo.1512.1">])
    },
  })
</span></code></pre>
</li>
</ol>
<p class="normal-one"><span class="koboSpan" id="kobo.1513.1">When a query </span><a id="_idIndexMarker325"/><span class="koboSpan" id="kobo.1514.1">key is invalidated, all</span><a id="_idIndexMarker326"/><span class="koboSpan" id="kobo.1515.1"> Query Hooks that use it are </span><a id="_idIndexMarker327"/><span class="koboSpan" id="kobo.1516.1">automatically re-executed to fetch the new data, and the components are re-rendered to show it. </span><span class="koboSpan" id="kobo.1516.2">In this case, we invalidate all query keys that start with </span><code class="inlineCode"><span class="koboSpan" id="kobo.1517.1">'posts'</span></code><span class="koboSpan" id="kobo.1518.1">, so we will be invalidating both </span><code class="inlineCode"><span class="koboSpan" id="kobo.1519.1">['posts', true]</span></code><span class="koboSpan" id="kobo.1520.1"> for the featured posts feed, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1521.1">['posts', false]</span></code><span class="koboSpan" id="kobo.1522.1"> for the regular posts feed.</span></p>
<ol>
<li class="numberedList" value="9"><em class="italic"><span class="koboSpan" id="kobo.1523.1">Replace</span></em><span class="koboSpan" id="kobo.1524.1"> the whole </span><code class="inlineCode"><span class="koboSpan" id="kobo.1525.1">handleSubmit</span></code><span class="koboSpan" id="kobo.1526.1"> function with the following:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1527.1">async</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1528.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1529.1">handleSubmit</span></span><span class="koboSpan" id="kobo.1530.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.1531.1">e</span></span><span class="koboSpan" id="kobo.1532.1">) {
    e.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1533.1">preventDefault</span></span><span class="koboSpan" id="kobo.1534.1">()
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1535.1">const</span></span><span class="koboSpan" id="kobo.1536.1"> form = e.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1537.1">target</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1538.1">const</span></span><span class="koboSpan" id="kobo.1539.1"> title = form.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1540.1">elements</span></span><span class="koboSpan" id="kobo.1541.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1542.1">title</span></span><span class="koboSpan" id="kobo.1543.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1544.1">value</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1545.1">const</span></span><span class="koboSpan" id="kobo.1546.1"> content = form.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1547.1">elements</span></span><span class="koboSpan" id="kobo.1548.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1549.1">content</span></span><span class="koboSpan" id="kobo.1550.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1551.1">value</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1552.1">const</span></span><span class="koboSpan" id="kobo.1553.1"> newPost = { title, content, </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1554.1">author</span></span><span class="koboSpan" id="kobo.1555.1">: username, </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1556.1">featured</span></span><span class="koboSpan" id="kobo.1557.1">: </span><span class="hljs-literal"><span class="koboSpan" id="kobo.1558.1">false</span></span><span class="koboSpan" id="kobo.1559.1"> }
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1560.1">Then, call the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1561.1">mutate</span></code><span class="koboSpan" id="kobo.1562.1"> function from the Mutation Hook, and reset the form after successfully executing the mutation:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="koboSpan" id="kobo.1563.1">    createPostMutation.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1564.1">mutate</span></span><span class="koboSpan" id="kobo.1565.1">(newPost, {
      </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1566.1">onSuccess</span></span><span class="koboSpan" id="kobo.1567.1">: </span><span class="hljs-function"><span class="koboSpan" id="kobo.1568.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1569.1"> form.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1570.1">reset</span></span><span class="koboSpan" id="kobo.1571.1">()
    })
  }
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1572.1">Additionally, we can improve the user experience for the component now. </span><span class="koboSpan" id="kobo.1572.2">For example, we can </span><a id="_idIndexMarker328"/><span class="koboSpan" id="kobo.1573.1">use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1574.1">isPending</span></code><span class="koboSpan" id="kobo.1575.1"> state to</span><a id="_idIndexMarker329"/><span class="koboSpan" id="kobo.1576.1"> disable the submit button</span><a id="_idIndexMarker330"/><span class="koboSpan" id="kobo.1577.1"> while the mutation is pending:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="koboSpan" id="kobo.1578.1">      &lt;input
        type=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1579.1">'submit'</span></span><span class="koboSpan" id="kobo.1580.1">
        value=</span><span class="hljs-string"><span class="koboSpan" id="kobo.1581.1">'Create'</span></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1582.1">        disabled={createPostMutation.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1583.1">isPending</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1584.1">}</span></strong></span><span class="koboSpan" id="kobo.1585.1">
      /&gt;
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1586.1">If there is an error during the mutation, we can also show the error message in red at the end of the form:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1587.1">      {createPostMutation.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1588.1">isError</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1589.1"> &amp;&amp; (</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1590.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1591.1">div</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1592.1">style</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1593.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1594.1">{{</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1595.1">color:</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1596.1"> '</span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1597.1">red</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1598.1">' }}&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1599.1">          {createPostMutation.error.toString()}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1600.1">&lt;/</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1601.1">div</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1602.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1603.1">      )}</span></strong></span><span class="koboSpan" id="kobo.1604.1">
    &lt;/form&gt;
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1605.1">Try running the app, and you will see that it still works the same way as before, but now using TanStack Query!</span></li>
</ol>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.1606.1">When inserting a new post, you may notice that it gets added to the end now. </span><span class="koboSpan" id="kobo.1606.2">Unfortunately, we cannot control how </span><code class="inlineCode"><span class="koboSpan" id="kobo.1607.1">json-server</span></code><span class="koboSpan" id="kobo.1608.1"> inserts new posts into the array. </span><span class="koboSpan" id="kobo.1608.2">If you want to add this behavior again, I suggest adding a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1609.1">createdAt</span></code><span class="koboSpan" id="kobo.1610.1"> timestamp to all posts and then use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1611.1">_sort</span></code><span class="koboSpan" id="kobo.1612.1"> query param provided by the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1613.1">json-server</span></code><span class="koboSpan" id="kobo.1614.1"> tool to sort the posts by this timestamp. </span><span class="koboSpan" id="kobo.1614.2">Doing so is left as an exercise for you.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.1615.1">With the new</span><a id="_idIndexMarker331"/><span class="koboSpan" id="kobo.1616.1"> structure of our app, we can further improve it </span><a id="_idIndexMarker332"/><span class="koboSpan" id="kobo.1617.1">a bit by using React Suspense and</span><a id="_idIndexMarker333"/><span class="koboSpan" id="kobo.1618.1"> Error Boundaries!</span></p>
<div class="note">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.1619.1">Example code</span></strong></p>
<p class="normal"><span class="koboSpan" id="kobo.1620.1">The example code for this section can be found in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1621.1">Chapter06/Chapter06_3</span></code><span class="koboSpan" id="kobo.1622.1"> folder. </span><span class="koboSpan" id="kobo.1622.2">Check the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1623.1">README.md</span></code><span class="koboSpan" id="kobo.1624.1"> file inside the folder for instructions on how to set up and run the example.</span></p>
</div>
<h1 class="heading-1" id="_idParaDest-157"><a id="_idTextAnchor163"/><span class="koboSpan" id="kobo.1625.1">Introducing React Suspense and Error Boundaries</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1626.1">In the previous section, we used the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1627.1">isLoading</span></code><span class="koboSpan" id="kobo.1628.1"> state from TanStack Query to show a loading message when the posts are still being fetched. </span><span class="koboSpan" id="kobo.1628.2">While this works fine, handling loading states like that can get a bit messy. </span><span class="koboSpan" id="kobo.1628.3">A better way to model loading states is to use React Suspense. </span><span class="koboSpan" id="kobo.1628.4">React Suspense is a special component that can display a fallback until its children have finished loading. </span><span class="koboSpan" id="kobo.1628.5">To use React Suspense, data fetching frameworks and libraries need to support it. </span><span class="koboSpan" id="kobo.1628.6">Thankfully, TanStack Query supports Suspense. </span><span class="koboSpan" id="kobo.1628.7">Frameworks like Relay and Next.js support it as well.</span></p>
<h2 class="heading-2" id="_idParaDest-158"><a id="_idTextAnchor164"/><span class="koboSpan" id="kobo.1629.1">Setting up a Suspense Boundary</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1630.1">To use Suspense, we need to</span><a id="_idIndexMarker334"/><span class="koboSpan" id="kobo.1631.1"> define a Suspense Boundary with a fallback. </span><span class="koboSpan" id="kobo.1631.2">If any child component within the boundary is fetching data, the fallback will be rendered in place of the boundary, replacing all the child components of it. </span><span class="koboSpan" id="kobo.1631.3">When all data is fetched successfully, all child components will be rendered. </span><span class="koboSpan" id="kobo.1631.4">This allows us to write code that assumes data is always there, and to handle the edge case further up in the tree.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1632.1">Let’s now get started setting up a Suspense Boundary for the post feed:</span></p>
<ol>
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1633.1">Copy the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1634.1">Chapter06_3</span></code><span class="koboSpan" id="kobo.1635.1"> folder to a new </span><code class="inlineCode"><span class="koboSpan" id="kobo.1636.1">Chapter06_4</span></code><span class="koboSpan" id="kobo.1637.1"> folder by executing the following command:
        </span><pre class="programlisting con-one"><code class="hljs-con"><span class="koboSpan" id="kobo.1638.1">$ cp -R Chapter06_3 Chapter06_4
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1639.1">Open the new </span><code class="inlineCode"><span class="koboSpan" id="kobo.1640.1">Chapter06_4</span></code><span class="koboSpan" id="kobo.1641.1"> folder in VS Code.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1642.1">Edit </span><code class="inlineCode"><span class="koboSpan" id="kobo.1643.1">src/App.jsx</span></code><span class="koboSpan" id="kobo.1644.1"> and import </span><code class="inlineCode"><span class="koboSpan" id="kobo.1645.1">Suspense</span></code><span class="koboSpan" id="kobo.1646.1">:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1647.1">import</span></span><span class="koboSpan" id="kobo.1648.1"> { useState</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1649.1">, </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1650.1">Suspense</span></strong></span><span class="koboSpan" id="kobo.1651.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1652.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1653.1">'react'</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1654.1">Adjust the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1655.1">App</span></code><span class="koboSpan" id="kobo.1656.1"> component to render the post feed within a Suspense Boundary, providing a loading message as fallback:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1657.1">            &lt;</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1658.1">Suspense</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1659.1"> fallback={</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1660.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1661.1">strong</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1662.1">&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1663.1">Loading posts...</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1664.1">&lt;/</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1665.1">strong</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1666.1">&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1667.1">}&gt;</span></strong></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1668.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1669.1">ThemeContext.Provider</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1670.1">value</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1671.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1672.1">{{</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1673.1">primaryColor:</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1674.1"> '</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1675.1">salmon</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1676.1">' }}&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1677.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1678.1">PostFeed</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1679.1">featured</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1680.1"> /&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1681.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1682.1">ThemeContext.Provider</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1683.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1684.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1685.1">PostFeed</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1686.1"> /&gt;</span></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1687.1">            &lt;/</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1688.1">Suspense</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1689.1">&gt;</span></strong></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1690.1">Now, we need to adjust the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1691.1">PostFeed</span></code><span class="koboSpan" id="kobo.1692.1"> component to use the Suspense Query Hook instead. </span><span class="koboSpan" id="kobo.1692.2">Edit </span><code class="inlineCode"><span class="koboSpan" id="kobo.1693.1">src/components/post/PostFeed.jsx</span></code><span class="koboSpan" id="kobo.1694.1"> and adjust the import as follows:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1695.1">import</span></span><span class="koboSpan" id="kobo.1696.1"> { use</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1697.1">Suspense</span></strong></span><span class="koboSpan" id="kobo.1698.1">Query } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1699.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1700.1">'@tanstack/react-query'</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1701.1">Then, adjust the Hook, as follows:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1702.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1703.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1704.1">PostFeed</span></span><span class="koboSpan" id="kobo.1705.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.1706.1">{ featured = </span></span><span class="hljs-literal"><span class="koboSpan" id="kobo.1707.1">false</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1708.1"> }</span></span><span class="koboSpan" id="kobo.1709.1">) {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1710.1">const</span></span> <span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1711.1">{ data }</span></strong></span><span class="koboSpan" id="kobo.1712.1"> = </span><span class="hljs-title"><span class="koboSpan" id="kobo.1713.1">use</span></span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1714.1">Suspense</span></strong></span><span class="hljs-title"><span class="koboSpan" id="kobo.1715.1">Query</span></span><span class="koboSpan" id="kobo.1716.1">({
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1717.1">We can now </span><em class="italic"><span class="koboSpan" id="kobo.1718.1">remove</span></em><span class="koboSpan" id="kobo.1719.1"> the following code from the component:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1720.1">if</span></span><span class="koboSpan" id="kobo.1721.1"> (isLoading) {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1722.1">return</span></span> <span class="hljs-tag"><span class="koboSpan" id="kobo.1723.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1724.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1725.1">&gt;</span></span><span class="koboSpan" id="kobo.1726.1">Loading posts...</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1727.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1728.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1729.1">&gt;</span></span><span class="koboSpan" id="kobo.1730.1">
  }
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1731.1">if</span></span><span class="koboSpan" id="kobo.1732.1"> (!data) {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1733.1">return</span></span> <span class="hljs-tag"><span class="koboSpan" id="kobo.1734.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1735.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1736.1">&gt;</span></span><span class="koboSpan" id="kobo.1737.1">Could not load posts!</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1738.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1739.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1740.1">&gt;</span></span><span class="koboSpan" id="kobo.1741.1">
  }
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1742.1">Start the app, as follows:
        </span><pre class="programlisting con-one"><code class="hljs-con"><span class="koboSpan" id="kobo.1743.1">$ npm run dev
</span></code></pre>
</li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.1744.1">You will see that</span><a id="_idIndexMarker335"/><span class="koboSpan" id="kobo.1745.1"> instead of getting two loading messages (one for featured posts and one for regular posts), we now only see one loading message from the Suspense Boundary!</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1746.1"><img alt="Figure 6.4 – Loading messages before and after using React Suspense" src="../Images/B31327_06_04.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1747.1">Figure 6.4 – Loading messages before and after using React Suspense</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1748.1">The loading messages may be disappearing too quickly for you to see, because we are running the backend locally, so</span><a id="_idIndexMarker336"/><span class="koboSpan" id="kobo.1749.1"> there is no network delay. </span><span class="koboSpan" id="kobo.1749.2">This is not a realistic scenario. </span><span class="koboSpan" id="kobo.1749.3">In production, we would have latency on every request that we make. </span><span class="koboSpan" id="kobo.1749.4">We can use the DevTools to simulate a slower network connection; let’s do that now:</span></p>
<ol>
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1750.1">In Google Chrome, open the inspector by right clicking on the website and pressing </span><strong class="screenText"><span class="koboSpan" id="kobo.1751.1">Inspect</span></strong><span class="koboSpan" id="kobo.1752.1">.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1753.1">The inspector will open, inside it, go to the </span><strong class="screenText"><span class="koboSpan" id="kobo.1754.1">Network</span></strong><span class="koboSpan" id="kobo.1755.1"> tab.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1756.1">At the top of the Network tab, click on the </span><strong class="screenText"><span class="koboSpan" id="kobo.1757.1">No throttling</span></strong><span class="koboSpan" id="kobo.1758.1"> dropdown.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1759.1">Select the </span><strong class="screenText"><span class="koboSpan" id="kobo.1760.1">3G</span></strong><span class="koboSpan" id="kobo.1761.1"> preset. </span><span class="koboSpan" id="kobo.1761.2">See the following screenshot for reference:</span></li>
</ol>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1762.1"><img alt="Figure 6.5 – Simulating slow networks in Google Chrome DevTools" src="../Images/B31327_06_05.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1763.1">Figure 6.5 – Simulating slow networks in Google Chrome DevTools</span></p>
<ol>
<li class="numberedList" value="5"><span class="koboSpan" id="kobo.1764.1">Refresh the </span><a id="_idIndexMarker337"/><span class="koboSpan" id="kobo.1765.1">page. </span><span class="koboSpan" id="kobo.1765.2">You will now see the app slowly loading the posts.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1766.1">Do not forget to set it back to </span><strong class="screenText"><span class="koboSpan" id="kobo.1767.1">No throttling</span></strong><span class="koboSpan" id="kobo.1768.1"> to avoid having to wait so long for requests.</span></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.1769.1">Next, let’s move on to setting up an Error Boundary.</span></p>
<h2 class="heading-2" id="_idParaDest-159"><a id="_idTextAnchor165"/><span class="koboSpan" id="kobo.1770.1">Setting up an Error Boundary</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1771.1">As we have learned, a </span><a id="_idIndexMarker338"/><span class="koboSpan" id="kobo.1772.1">Suspense Boundary can provide a fallback while components are fetching data. </span><span class="koboSpan" id="kobo.1772.2">However, you may have noticed that we also removed the error handling code. </span><span class="koboSpan" id="kobo.1772.3">To provide a fallback when an error happens in a child component, we can use an Error Boundary. </span><span class="koboSpan" id="kobo.1772.4">Error Boundaries work similar to Suspense Boundaries, but they react to error states rather than loading states.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1773.1">Let’s now get started setting up an Error Boundary:</span></p>
<ol>
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1774.1">First, install the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1775.1">react-error-boundary</span></code><span class="koboSpan" id="kobo.1776.1"> package:
        </span><pre class="programlisting con-one"><code class="hljs-con"><span class="koboSpan" id="kobo.1777.1">$ npm install --save-exact react-error-boundary@5.0.0
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1778.1">Then, we create a component that will be rendered as a fallback when an error happens. </span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1779.1">Create a new </span><code class="inlineCode"><span class="koboSpan" id="kobo.1780.1">src/FetchErrorNotice.jsx</span></code><span class="koboSpan" id="kobo.1781.1"> file. </span><span class="koboSpan" id="kobo.1781.2">Inside it, define a component that takes a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1782.1">resetErrorBoundary</span></code><span class="koboSpan" id="kobo.1783.1"> function:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1784.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1785.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1786.1">FetchErrorNotice</span></span><span class="koboSpan" id="kobo.1787.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.1788.1">{ resetErrorBoundary }</span></span><span class="koboSpan" id="kobo.1789.1">) {
</span></code></pre>
</li>
</ol>
<p class="normal-one"><span class="koboSpan" id="kobo.1790.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1791.1">resetErrorBoundary</span></code><span class="koboSpan" id="kobo.1792.1"> function can be used to reset the operation that caused the error. </span><span class="koboSpan" id="kobo.1792.2">In our case, it will retry the request to fetch posts.</span></p>
<ol>
<li class="numberedList" value="4"><span class="koboSpan" id="kobo.1793.1">Render an error message and a button that triggers the reset function:
        </span><pre class="programlisting code-one"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1794.1">return</span></span><span class="koboSpan" id="kobo.1795.1"> (
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1796.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1797.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1798.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1799.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1800.1">strong</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1801.1">&gt;</span></span><span class="koboSpan" id="kobo.1802.1">There was an error fetching data.</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1803.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1804.1">strong</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1805.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1806.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1807.1">br</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1808.1"> /&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1809.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1810.1">button</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1811.1">onClick</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1812.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1813.1">{resetErrorBoundary}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1814.1">&gt;</span></span><span class="koboSpan" id="kobo.1815.1">Try again</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1816.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1817.1">button</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1818.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1819.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1820.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1821.1">&gt;</span></span><span class="koboSpan" id="kobo.1822.1">
  )
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1823.1">Now, edit </span><code class="inlineCode"><span class="koboSpan" id="kobo.1824.1">src/App.jsx</span></code><span class="koboSpan" id="kobo.1825.1"> and import the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1826.1">ErrorBoundary</span></code><span class="koboSpan" id="kobo.1827.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1828.1">QueryErrorResetBoundary</span></code><span class="koboSpan" id="kobo.1829.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1830.1">FetchErrorNotice</span></code><span class="koboSpan" id="kobo.1831.1">:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1832.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1833.1"> { </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1834.1">ErrorBoundary</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1835.1"> } </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1836.1">from</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1837.1">'react-error-boundary'</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1838.1">import</span></span><span class="koboSpan" id="kobo.1839.1"> {
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.1840.1">QueryClientProvider</span></span><span class="koboSpan" id="kobo.1841.1">,
</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1842.1">QueryErrorResetBoundary</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1843.1">,</span></strong></span><span class="koboSpan" id="kobo.1844.1">
} </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1845.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1846.1">'@tanstack/react-query'</span></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1847.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1848.1"> { </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1849.1">FetchErrorNotice</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1850.1"> } </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1851.1">from</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1852.1">'./FetchErrorNotice.jsx'</span></strong></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1853.1">Inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1854.1">App</span></code><span class="koboSpan" id="kobo.1855.1"> component, wrap the Suspense Boundary with an Error Boundary, which is in turn wrapped by the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1856.1">QueryErrorResetBoundary</span></code><span class="koboSpan" id="kobo.1857.1">, which provides the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1858.1">reset</span></code><span class="koboSpan" id="kobo.1859.1"> function to retry queries:
        </span><pre class="programlisting code-one"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1860.1">            &lt;</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1861.1">QueryErrorResetBoundary</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1862.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1863.1">              {</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1864.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1865.1">{ reset }</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1866.1">) =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1867.1"> (</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1868.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1869.1">ErrorBoundary</span></strong></span>
<span class="code-highlight"><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1870.1">onReset</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1871.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1872.1">{reset}</span></strong></span>
<span class="code-highlight"><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1873.1">fallbackRender</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1874.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1875.1">{FetchErrorNotice}</span></strong></span>
<span class="code-highlight"><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1876.1">                &gt;</span></strong></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1877.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1878.1">Suspense</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1879.1">fallback</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1880.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1881.1">{</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1882.1">&lt;</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1883.1">strong</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1884.1">&gt;</span></span><span class="koboSpan" id="kobo.1885.1">Loading posts...</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1886.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1887.1">strong</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1888.1">&gt;</span></span><span class="koboSpan" id="kobo.1889.1">}&gt;
                    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1890.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1891.1">ThemeContext.Provider</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1892.1">value</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1893.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1894.1">{{</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1895.1">primaryColor:</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1896.1"> '</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1897.1">salmon</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1898.1">' }}&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1899.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1900.1">PostFeed</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1901.1">featured</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1902.1"> /&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1903.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1904.1">ThemeContext.Provider</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1905.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1906.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1907.1">PostFeed</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1908.1"> /&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1909.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1910.1">Suspense</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1911.1">&gt;</span></span>
<span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1912.1">&lt;/</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1913.1">ErrorBoundary</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1914.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1915.1">              )}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1916.1">            &lt;/</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1917.1">QueryErrorResetBoundary</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1918.1">&gt;</span></strong></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1919.1">If it is currently running, stop the app.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1920.1">Then, start only the client, as follows:
        </span><pre class="programlisting con-one"><code class="hljs-con"><span class="koboSpan" id="kobo.1921.1">$ npm run dev:client
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1922.1">Open the app in your browser, you will see the loading message. </span><span class="koboSpan" id="kobo.1922.2">Wait a while until the request times out. </span><span class="koboSpan" id="kobo.1922.3">Then, you will see the error message and the retry button:</span></li>
</ol>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1923.1"><img alt="Figure 6.6 – The Error Boundary being triggered by a request timeout" src="../Images/B31327_06_06.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1924.1">Figure 6.6 – The Error Boundary being triggered by a request timeout</span></p>
<ol>
<li class="numberedList" value="10"><span class="koboSpan" id="kobo.1925.1">Now, without </span><a id="_idIndexMarker339"/><span class="koboSpan" id="kobo.1926.1">quitting the client, additionally start the server, as follows:
        </span><pre class="programlisting con-one"><code class="hljs-con"><span class="koboSpan" id="kobo.1927.1">$ npm run dev:server
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1928.1">Press the </span><strong class="screenText"><span class="koboSpan" id="kobo.1929.1">Try again</span></strong><span class="koboSpan" id="kobo.1930.1"> button. </span><span class="koboSpan" id="kobo.1930.2">You will see the loading message again and then the list of posts!</span></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.1931.1">As we can see, Error Boundaries allow us to manage error states by displaying a fallback component and</span><a id="_idIndexMarker340"/><span class="koboSpan" id="kobo.1932.1"> functionality to reset the operation that caused the error.</span></p>
<div class="note">
<p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.1933.1">Example code</span></strong></p>
<p class="normal"><span class="koboSpan" id="kobo.1934.1">The example code for this section can be found in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1935.1">Chapter06/Chapter06_4</span></code><span class="koboSpan" id="kobo.1936.1"> folder. </span><span class="koboSpan" id="kobo.1936.2">Check the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1937.1">README.md</span></code><span class="koboSpan" id="kobo.1938.1"> file inside the folder for instructions on how to set up and run the example.</span></p>
</div>
<h1 class="heading-1" id="_idParaDest-160"><a id="_idTextAnchor166"/><span class="koboSpan" id="kobo.1939.1">Summary</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1940.1">In this chapter, we first learned how to set up a simple API server from a JSON file. </span><span class="koboSpan" id="kobo.1940.2">Then, we learned how to fetch and create posts using Effect and State/Reducer Hooks. </span><span class="koboSpan" id="kobo.1940.3">Next, we implemented the same functionality using the TanStack Query library, which simplified our code and allowed us to leverage its caching abilities. </span><span class="koboSpan" id="kobo.1940.4">Finally, we learned how to deal with loading states using React Suspense and error states using Error Boundaries.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1941.1">In the next chapter, we are going to learn about form handling in depth, by using Form Actions and Hooks, such as the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1942.1">useActionState</span></code><span class="koboSpan" id="kobo.1943.1"> Hook to handle form states and the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1944.1">useOptimistic</span></code><span class="koboSpan" id="kobo.1945.1"> Hook to implement optimistic updates.</span></p>
<h1 class="heading-1" id="_idParaDest-161"><a id="_idTextAnchor167"/><span class="koboSpan" id="kobo.1946.1">Questions</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1947.1">To recap what we have learned in this chapter, try to answer the following questions:</span></p>
<ol>
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1948.1">How can we easily create a full REST API from a JSON file for mocking purposes?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1949.1">What are the advantages of using a proxy to access our backend server?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1950.1">Which combinations of Hooks can be used to implement data fetching?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1951.1">Which advantages does TanStack Query have over our simple data fetching implementation?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1952.1">Which Hook in TanStack Query is used for fetching data?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1953.1">Which Hook in TanStack Query is used for making changes to the server?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1954.1">What role does the query key play in the TanStack Query library?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1955.1">What is a Suspense Boundary used for?</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1956.1">What are Error Boundaries used for?</span></li>
</ol>
<h1 class="heading-1" id="_idParaDest-162"><a id="_idTextAnchor168"/><span class="koboSpan" id="kobo.1957.1">Further reading</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1958.1">If you are interested in more information about the concepts that we have learned in this chapter, take a look at the following links:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.1959.1">Official documentation of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1960.1">json-server</span></code><span class="koboSpan" id="kobo.1961.1"> tool: </span><a href="https://github.com/typicode/json-server"><span class="url"><span class="koboSpan" id="kobo.1962.1">https://github.com/typicode/json-server</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1963.1">Official documentation of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1964.1">concurrently</span></code><span class="koboSpan" id="kobo.1965.1"> tool: </span><a href="https://github.com/open-cli-tools/concurrently"><span class="url"><span class="koboSpan" id="kobo.1966.1">https://github.com/open-cli-tools/concurrently</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1967.1">Official documentation of TanStack Query for React: </span><a href="https://tanstack.com/query/latest/docs/framework/react/overview"><span class="url"><span class="koboSpan" id="kobo.1968.1">https://tanstack.com/query/latest/docs/framework/react/overview</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1969.1">More information on </span><strong class="keyWord"><span class="koboSpan" id="kobo.1970.1">cross-origin resource sharing</span></strong><span class="koboSpan" id="kobo.1971.1"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.1972.1">CORS</span></strong><span class="koboSpan" id="kobo.1973.1">): </span><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS"><span class="url"><span class="koboSpan" id="kobo.1974.1">https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1975.1">More information on the proxy setting in the Vite config: </span><a href="https://vite.dev/config/server-options#server-proxy"><span class="url"><span class="koboSpan" id="kobo.1976.1">https://vite.dev/config/server-options#server-proxy</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1977.1">More information on React strict mode: </span><a href="https://react.dev/reference/react/StrictMode"><span class="url"><span class="koboSpan" id="kobo.1978.1">https://react.dev/reference/react/StrictMode</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1979.1">Blog article about fetching data with React Hooks, without a library: </span><a href="https://www.robinwieruch.de/react-hooks-fetch-data/"><span class="url"><span class="koboSpan" id="kobo.1980.1">https://www.robinwieruch.de/react-hooks-fetch-data/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1981.1">More information about Suspense: </span><a href="https://react.dev/reference/react/Suspense"><span class="url"><span class="koboSpan" id="kobo.1982.1">https://react.dev/reference/react/Suspense</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1983.1">More information about Error Boundaries: </span><a href="https://github.com/bvaughn/react-error-boundary"><span class="url"><span class="koboSpan" id="kobo.1984.1">https://github.com/bvaughn/react-error-boundary</span></span></a></li>
</ul>
<h1 class="heading-1"><span class="koboSpan" id="kobo.1985.1">Learn more on Discord</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1986.1">To join the Discord community for this book – where you can share feedback, ask questions to the author, and learn about new releases – follow the QR code below:</span></p>
<p class="normal"><a href="Chapter_06.xhtml"><span class="url"><span class="koboSpan" id="kobo.1987.1">https://packt.link/wnXT0</span></span></a></p>
<p class="normal"><span class="koboSpan" id="kobo.1988.1"><img alt="" src="../Images/image_%283%29.png"/></span></p>
</div>
</body></html>