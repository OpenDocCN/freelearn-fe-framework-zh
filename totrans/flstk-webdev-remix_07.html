<html><head></head><body>
<div id="_idContainer035">
<h1 class="chapter-number" id="_idParaDest-108"><a id="_idTextAnchor105"/><span class="koboSpan" id="kobo.1.1">7</span></h1>
<h1 id="_idParaDest-109"><a id="_idTextAnchor106"/><span class="koboSpan" id="kobo.2.1">Error Handling in Remix</span></h1>
<p><span class="koboSpan" id="kobo.3.1">Error handling is an important part of building resilient user experiences. </span><span class="koboSpan" id="kobo.3.2">We can distinguish two kinds </span><span class="No-Break"><span class="koboSpan" id="kobo.4.1">of errors:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.5.1">Unexpected errors, such as </span><span class="No-Break"><span class="koboSpan" id="kobo.6.1">network timeouts</span></span></li>
<li><span class="koboSpan" id="kobo.7.1">Expected failures (exceptions) thrown </span><span class="No-Break"><span class="koboSpan" id="kobo.8.1">on purpose</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.9.1">Remix provides primitives and conventions to handle both unexpected and expected errors uniformly. </span><span class="koboSpan" id="kobo.9.2">This chapter covers the </span><span class="No-Break"><span class="koboSpan" id="kobo.10.1">following topics:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.11.1">Dealing with </span><span class="No-Break"><span class="koboSpan" id="kobo.12.1">unexpected errors</span></span></li>
<li><span class="koboSpan" id="kobo.13.1">Handling </span><span class="No-Break"><span class="koboSpan" id="kobo.14.1">thrown responses</span></span></li>
<li><span class="koboSpan" id="kobo.15.1">Handling page-not-found (</span><span class="No-Break"><span class="koboSpan" id="kobo.16.1">404) errors</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.17.1">First, we will fabricate some unexpected errors and learn how to handle them. </span><span class="koboSpan" id="kobo.17.2">Next, we will review the difference between returning and throwing </span><strong class="source-inline"><span class="koboSpan" id="kobo.18.1">Response</span></strong><span class="koboSpan" id="kobo.19.1"> objects in </span><strong class="source-inline"><span class="koboSpan" id="kobo.20.1">loader</span></strong><span class="koboSpan" id="kobo.21.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.22.1">action</span></strong><span class="koboSpan" id="kobo.23.1"> functions. </span><span class="koboSpan" id="kobo.23.2">We will see how we can handle thrown responses with Remix’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.24.1">ErrorBoundary</span></strong><span class="koboSpan" id="kobo.25.1">. </span><span class="koboSpan" id="kobo.25.2">Finally, we will add not-found error handling </span><span class="No-Break"><span class="koboSpan" id="kobo.26.1">to BeeRich.</span></span></p>
<p><span class="koboSpan" id="kobo.27.1">After reading this chapter, you will understand how to manage both unexpected and expected failures in Remix declaratively using Remix’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.28.1">ErrorBoundary</span></strong><span class="koboSpan" id="kobo.29.1"> component. </span><span class="koboSpan" id="kobo.29.2">You will also know how throwing responses fits into Remix’s exception-handling story and know the difference between throwing and returning responses. </span><span class="koboSpan" id="kobo.29.3">Finally, you will know how to handle not-found errors </span><span class="No-Break"><span class="koboSpan" id="kobo.30.1">with Remix.</span></span></p>
<h1 id="_idParaDest-110"><a id="_idTextAnchor107"/><span class="koboSpan" id="kobo.31.1">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.32.1">You can go ahead and use the solution from the previous chapter. </span><span class="koboSpan" id="kobo.32.2">No additional setup steps are required for this chapter. </span><span class="koboSpan" id="kobo.32.3">If you get stuck, you can find the solution code for this chapter </span><span class="No-Break"><span class="koboSpan" id="kobo.33.1">here: </span></span><span class="No-Break"><span class="koboSpan" id="kobo.34.1">https://github.com/PacktPublishing/Full-Stack-Web-Development-with-Remix/tree/main/07-error-handling-in-remix</span></span><span class="No-Break"><span class="koboSpan" id="kobo.35.1">.</span></span></p>
<h1 id="_idParaDest-111"><a id="_idTextAnchor108"/><span class="koboSpan" id="kobo.36.1">Dealing with unexpected errors</span></h1>
<p><span class="koboSpan" id="kobo.37.1">During runtime, a </span><a id="_idIndexMarker283"/><span class="koboSpan" id="kobo.38.1">Remix application is executed both in the browser and on the server. </span><span class="koboSpan" id="kobo.38.2">A lot can go wrong, and unexpected errors can happen both on the client and server. </span><span class="koboSpan" id="kobo.38.3">It is important to consider the error case to provide a resilient user experience. </span><span class="koboSpan" id="kobo.38.4">In this section, we will investigate how to handle unexpected errors in Remix both at the root level and in </span><span class="No-Break"><span class="koboSpan" id="kobo.39.1">nested routes.</span></span></p>
<h2 id="_idParaDest-112"><a id="_idTextAnchor109"/><span class="koboSpan" id="kobo.40.1">Invoking client and server errors</span></h2>
<p><span class="koboSpan" id="kobo.41.1">In </span><a href="B17399_02.xhtml#_idTextAnchor030"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.42.1">Chapter 2</span></em></span></a><span class="koboSpan" id="kobo.43.1">, </span><em class="italic"><span class="koboSpan" id="kobo.44.1">Creating a New Remix App</span></em><span class="koboSpan" id="kobo.45.1">, we provided a troubleshooting guide and investigated how Remix </span><a id="_idIndexMarker284"/><span class="koboSpan" id="kobo.46.1">handles errors on both the client and server uniformly. </span><span class="koboSpan" id="kobo.46.2">Let’s review Remix’s default error handling again by invoking some “</span><span class="No-Break"><span class="koboSpan" id="kobo.47.1">unexpected” errors:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.48.1">Open your BeeRich application in </span><span class="No-Break"><span class="koboSpan" id="kobo.49.1">an editor.</span></span></li>
<li><span class="koboSpan" id="kobo.50.1">Open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.51.1">dashboard.tsx</span></strong><span class="koboSpan" id="kobo.52.1"> route module inside the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.53.1">app/routes</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.54.1"> folder.</span></span></li>
<li><span class="koboSpan" id="kobo.55.1">Add the following code inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.56.1">loader</span></strong><span class="koboSpan" id="kobo.57.1"> function body before the </span><span class="No-Break"><span class="koboSpan" id="kobo.58.1">return statement:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.59.1">
throw Error('Something went wrong!');</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.60.1">By throwing an error in a </span><strong class="source-inline"><span class="koboSpan" id="kobo.61.1">loader</span></strong><span class="koboSpan" id="kobo.62.1"> function, we prevent the application from handling incoming requests. </span><span class="koboSpan" id="kobo.62.2">This creates an unexpected failure on </span><span class="No-Break"><span class="koboSpan" id="kobo.63.1">the server.</span></span></p></li> <li><span class="koboSpan" id="kobo.64.1">Execute </span><strong class="source-inline"><span class="koboSpan" id="kobo.65.1">npm run dev</span></strong><span class="koboSpan" id="kobo.66.1"> in a terminal to run </span><span class="No-Break"><span class="koboSpan" id="kobo.67.1">the app.</span></span></li>
<li><span class="koboSpan" id="kobo.68.1">Visit the BeeRich dashboard by opening </span><a href="http://localhost:3000/dashboard"><span class="koboSpan" id="kobo.69.1">http://localhost:3000/dashboard</span></a><span class="koboSpan" id="kobo.70.1"> in a new </span><span class="No-Break"><span class="koboSpan" id="kobo.71.1">browser window.</span></span><p class="list-inset"><span class="koboSpan" id="kobo.72.1">Throwing an error in a </span><strong class="source-inline"><span class="koboSpan" id="kobo.73.1">loader</span></strong><span class="koboSpan" id="kobo.74.1"> function renders Remix’s error page, as visible in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.75.1">Figure 7</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.76.1">.1</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.77.1">:</span></span></p></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer028">
<span class="koboSpan" id="kobo.78.1"><img alt="Figure 7.1 – Application error in the loader function" src="image/Figure_07.1_B17399.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.79.1">Figure 7.1 – Application error in the loader function</span></p>
<p class="list-inset"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.80.1">Figure 7</span></em></span><em class="italic"><span class="koboSpan" id="kobo.81.1">.1</span></em><span class="koboSpan" id="kobo.82.1"> showcases Remix’s default behavior when handling unexpected errors. </span><span class="koboSpan" id="kobo.82.2">We can see our error message stating “Something went wrong!” </span><span class="koboSpan" id="kobo.82.3">on the screen and the stack trace of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.83.1">loader</span></strong><span class="koboSpan" id="kobo.84.1"> function that failed </span><span class="No-Break"><span class="koboSpan" id="kobo.85.1">to execute.</span></span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.86.1">Now, let’s </span><a id="_idIndexMarker285"/><span class="koboSpan" id="kobo.87.1">throw an error in a route component. </span><span class="koboSpan" id="kobo.87.2">Move the error from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.88.1">loader</span></strong><span class="koboSpan" id="kobo.89.1"> function inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.90.1">dashboard.tsx</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.91.1">route component:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.92.1">
export default function Component() {  throw Error('Something went wrong!');</span></pre></li> <li><span class="koboSpan" id="kobo.93.1">Refresh the </span><span class="No-Break"><span class="koboSpan" id="kobo.94.1">browser window.</span></span><p class="list-inset"><span class="koboSpan" id="kobo.95.1">By reloading the page, we trigger a full-page reload. </span><span class="koboSpan" id="kobo.95.2">Remix handles initial document requests on the server. </span><span class="koboSpan" id="kobo.95.3">Hence, the dashboard route module component is first called on the server, and we again throw an error on </span><span class="No-Break"><span class="koboSpan" id="kobo.96.1">the server.</span></span></p><p class="list-inset"><span class="koboSpan" id="kobo.97.1">The error stack trace changes, but Remix still displays “Something went wrong!” </span><span class="koboSpan" id="kobo.97.2">on </span><span class="No-Break"><span class="koboSpan" id="kobo.98.1">the screen.</span></span></p></li>
<li><span class="koboSpan" id="kobo.99.1">Now, wrap the error inside a </span><strong class="source-inline"><span class="koboSpan" id="kobo.100.1">useEffect</span></strong><span class="koboSpan" id="kobo.101.1"> hook to ensure that the error is executed on the </span><span class="No-Break"><span class="koboSpan" id="kobo.102.1">client instead:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.103.1">
import { useEffect } from 'react';export default function Component() {  useEffect(() =&gt; {    throw Error('Something went wrong!');  }, []);</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.104.1">React’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.105.1">useEffect</span></strong><span class="koboSpan" id="kobo.106.1"> hook only executes on the client, not the server. </span><span class="koboSpan" id="kobo.106.2">This is because the hook is executed after the initial render, and on the server, we only </span><span class="No-Break"><span class="koboSpan" id="kobo.107.1">render once.</span></span></p></li> <li><span class="koboSpan" id="kobo.108.1">Refresh the </span><a id="_idIndexMarker286"/><span class="koboSpan" id="kobo.109.1">browser window one more time. </span><span class="koboSpan" id="kobo.109.2">You should see yet another stack trace on the page. </span><span class="koboSpan" id="kobo.109.3">This time, the stack trace originates from </span><span class="No-Break"><span class="koboSpan" id="kobo.110.1">client-side scripts.</span></span><p class="list-inset"><span class="koboSpan" id="kobo.111.1">As visible in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.112.1">Figure 7</span></em></span><em class="italic"><span class="koboSpan" id="kobo.113.1">.2</span></em><span class="koboSpan" id="kobo.114.1">, notice </span><a id="_idIndexMarker287"/><span class="koboSpan" id="kobo.115.1">that the filenames in the stack trace include hashes. </span><span class="koboSpan" id="kobo.115.2">This means the files have been bundled and are part of the </span><span class="No-Break"><span class="koboSpan" id="kobo.116.1">client bundle:</span></span></p></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer029">
<span class="koboSpan" id="kobo.117.1"><img alt="Figure 7.2 – Application error on the client" src="image/Figure_07.2_B17399.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.118.1">Figure 7.2 – Application error on the client</span></p>
<p><span class="koboSpan" id="kobo.119.1">This experiment tells us that Remix provides the same default experience for both browser and server errors. </span><span class="koboSpan" id="kobo.119.2">Next, let’s replace Remix’s default error page with </span><span class="No-Break"><span class="koboSpan" id="kobo.120.1">custom UIs.</span></span></p>
<h2 id="_idParaDest-113"><a id="_idTextAnchor110"/><span class="koboSpan" id="kobo.121.1">Handling errors with the root error boundary</span></h2>
<p><span class="koboSpan" id="kobo.122.1">In React, failures </span><a id="_idIndexMarker288"/><span class="koboSpan" id="kobo.123.1">during rendering can </span><a id="_idIndexMarker289"/><span class="koboSpan" id="kobo.124.1">be handled through error boundaries. </span><span class="koboSpan" id="kobo.124.2">Error boundaries are class components that implement the error boundary life cycle methods. </span><span class="koboSpan" id="kobo.124.3">Remix builds on top of React’s error boundaries and extends its capabilities to handle server-side errors. </span><span class="koboSpan" id="kobo.124.4">Instead of nesting React error boundaries inside our component tree, we declare them through Remix’s route module API by exporting an </span><strong class="source-inline"><span class="koboSpan" id="kobo.125.1">ErrorBoundary</span></strong><span class="koboSpan" id="kobo.126.1"> component in our </span><span class="No-Break"><span class="koboSpan" id="kobo.127.1">route modules.</span></span></p>
<p><span class="koboSpan" id="kobo.128.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.129.1">ErrorBoundary</span></strong><span class="koboSpan" id="kobo.130.1"> component in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.131.1">root.tsx</span></strong><span class="koboSpan" id="kobo.132.1"> route module is the topmost error boundary of our application. </span><span class="koboSpan" id="kobo.132.2">To replace Remix’s default error page, we need to export an </span><strong class="source-inline"><span class="koboSpan" id="kobo.133.1">ErrorBoundary</span></strong><span class="koboSpan" id="kobo.134.1"> component </span><span class="No-Break"><span class="koboSpan" id="kobo.135.1">from </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.136.1">root.tsx</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.137.1">:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.138.1">Open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.139.1">app/root.tsx</span></strong><span class="koboSpan" id="kobo.140.1"> route module in </span><span class="No-Break"><span class="koboSpan" id="kobo.141.1">your editor.</span></span></li>
<li><span class="koboSpan" id="kobo.142.1">Import the </span><strong class="source-inline"><span class="koboSpan" id="kobo.143.1">useRouteError</span></strong><span class="koboSpan" id="kobo.144.1"> hook </span><span class="No-Break"><span class="koboSpan" id="kobo.145.1">from Remix:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.146.1">
import {  Links,  LiveReload,  Meta,  Outlet,  Scripts,  ScrollRestoration,  </span><strong class="bold"><span class="koboSpan" id="kobo.147.1">useRouteError</span></strong><span class="koboSpan" id="kobo.148.1">,} from '@remix-run/react';</span></pre></li> <li><span class="koboSpan" id="kobo.149.1">Export a new React component named </span><strong class="source-inline"><span class="koboSpan" id="kobo.150.1">ErrorBoundary</span></strong><span class="koboSpan" id="kobo.151.1"> and add the following code </span><span class="No-Break"><span class="koboSpan" id="kobo.152.1">to it:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.153.1">
import { H1 } from './components/headings';import { ButtonLink } from './components/links';export function ErrorBoundary() {  </span><strong class="bold"><span class="koboSpan" id="kobo.154.1">const error = useRouteError();</span></strong><span class="koboSpan" id="kobo.155.1">  let errorMessage = </span><strong class="bold"><span class="koboSpan" id="kobo.156.1">error instanceof Error</span></strong><span class="koboSpan" id="kobo.157.1"> ? </span><span class="koboSpan" id="kobo.157.2">error.message :    null;  return (    &lt;section className="m-5 lg:m-20 flex flex-col gap-5"&gt;      &lt;H1&gt;Unexpected Error&lt;/H1&gt;      &lt;p&gt;We are very sorry. </span><span class="koboSpan" id="kobo.157.3">An unexpected error occurred. </span><span class="koboSpan" id="kobo.157.4">Please        try again or contact us if the problem persists.&lt;/p&gt;      {errorMessage &amp;&amp; (        &lt;div className="border-4 border-red-500 p-10"&gt;          &lt;p&gt;Error message: {errorMessage}&lt;/p&gt;        &lt;/div&gt;      )}      &lt;ButtonLink to="/" isPrimary&gt;        Back to homepage      &lt;/ButtonLink&gt;    &lt;/section&gt;  );}</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.158.1">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.159.1">ErrorBoundary</span></strong><span class="koboSpan" id="kobo.160.1"> component</span><a id="_idIndexMarker290"/><span class="koboSpan" id="kobo.161.1"> is part </span><a id="_idIndexMarker291"/><span class="koboSpan" id="kobo.162.1">of Remix’s route API and replaces the route module component in case of an error. </span><span class="koboSpan" id="kobo.162.2">We can access the error that caused the failure by calling </span><strong class="source-inline"><span class="koboSpan" id="kobo.163.1">useRouteError</span></strong><span class="koboSpan" id="kobo.164.1">. </span><span class="koboSpan" id="kobo.164.2">We further use the error object to display an </span><span class="No-Break"><span class="koboSpan" id="kobo.165.1">error message.</span></span></p></li> <li><span class="koboSpan" id="kobo.166.1">Fabricate an unexpected error and refresh the browser window to inspect the updated </span><span class="No-Break"><span class="koboSpan" id="kobo.167.1">error page:</span></span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer030">
<span class="koboSpan" id="kobo.168.1"><img alt="Figure 7.3 – Custom root ErrorBoundary component" src="image/Figure_07.3_B17399.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.169.1">Figure 7.3 – Custom root ErrorBoundary component</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.170.1">As visible in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.171.1">Figure 7</span></em></span><em class="italic"><span class="koboSpan" id="kobo.172.1">.3</span></em><span class="koboSpan" id="kobo.173.1">, we now render a custom error page for </span><span class="No-Break"><span class="koboSpan" id="kobo.174.1">our application.</span></span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.175.1">Investigate </span><a id="_idIndexMarker292"/><span class="koboSpan" id="kobo.176.1">the code of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.177.1">ErrorBoundary</span></strong><span class="koboSpan" id="kobo.178.1"> component in </span><strong class="source-inline"><span class="koboSpan" id="kobo.179.1">root.tsx</span></strong><span class="koboSpan" id="kobo.180.1">. </span><span class="koboSpan" id="kobo.180.2">Notice that we render our styled </span><strong class="source-inline"><span class="koboSpan" id="kobo.181.1">H1</span></strong><span class="koboSpan" id="kobo.182.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.183.1">ButtonLink</span></strong><span class="koboSpan" id="kobo.184.1"> components. </span><span class="koboSpan" id="kobo.184.2">Why are our custom styles not applied to </span><span class="No-Break"><span class="koboSpan" id="kobo.185.1">the page?</span></span></li>
<li><span class="koboSpan" id="kobo.186.1">Review </span><a id="_idIndexMarker293"/><span class="koboSpan" id="kobo.187.1">the </span><strong class="bold"><span class="koboSpan" id="kobo.188.1">Network</span></strong><span class="koboSpan" id="kobo.189.1"> tab, as visible in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.190.1">Figure 7</span></em></span><em class="italic"><span class="koboSpan" id="kobo.191.1">.3</span></em><span class="koboSpan" id="kobo.192.1">. </span><span class="koboSpan" id="kobo.192.2">Note that we are not loading a stylesheet or any client-side JavaScript. </span><span class="koboSpan" id="kobo.192.3">Why </span><span class="No-Break"><span class="koboSpan" id="kobo.193.1">is that?</span></span><p class="list-inset"><span class="koboSpan" id="kobo.194.1">Remix exposes the </span><strong class="source-inline"><span class="koboSpan" id="kobo.195.1">Meta</span></strong><span class="koboSpan" id="kobo.196.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.197.1">Links</span></strong><span class="koboSpan" id="kobo.198.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.199.1">Scripts</span></strong><span class="koboSpan" id="kobo.200.1"> components to append our meta and link tags and the client-side JavaScript scripts to the HTML document. </span><span class="koboSpan" id="kobo.200.2">This happens in the route module component in </span><strong class="source-inline"><span class="koboSpan" id="kobo.201.1">root.tsx</span></strong><span class="koboSpan" id="kobo.202.1">. </span><span class="koboSpan" id="kobo.202.2">However, on error, we do not render the route module component but the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.203.1">ErrorBoundary</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.204.1"> component.</span></span></p><p class="list-inset"><span class="koboSpan" id="kobo.205.1">Remix wraps the content of our error boundary in an HTML body tag by default. </span><span class="koboSpan" id="kobo.205.2">However, we </span><a id="_idIndexMarker294"/><span class="koboSpan" id="kobo.206.1">can also provide a custom HTML document. </span><span class="koboSpan" id="kobo.206.2">Let’s update the code so that we render the </span><strong class="source-inline"><span class="koboSpan" id="kobo.207.1">Meta</span></strong><span class="koboSpan" id="kobo.208.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.209.1">Links</span></strong><span class="koboSpan" id="kobo.210.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.211.1">Scripts</span></strong><span class="koboSpan" id="kobo.212.1"> components in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.213.1">root.tsx</span></strong><span class="koboSpan" id="kobo.214.1"> file’s </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.215.1">ErrorBoundary</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.216.1"> component.</span></span></p></li>
<li><span class="koboSpan" id="kobo.217.1">Create a </span><a id="_idIndexMarker295"/><span class="koboSpan" id="kobo.218.1">new </span><strong class="source-inline"><span class="koboSpan" id="kobo.219.1">Document</span></strong><span class="koboSpan" id="kobo.220.1"> component in </span><strong class="source-inline"><span class="koboSpan" id="kobo.221.1">root.tsx</span></strong><span class="koboSpan" id="kobo.222.1"> so that we can reuse code between the </span><strong class="source-inline"><span class="koboSpan" id="kobo.223.1">App</span></strong><span class="koboSpan" id="kobo.224.1"> and </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.225.1">ErrorBoundary</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.226.1"> components:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.227.1">
function Document(</span><strong class="bold"><span class="koboSpan" id="kobo.228.1">{ children }: { children: React.ReactNode }</span></strong><span class="koboSpan" id="kobo.229.1">) {  return (    &lt;html lang="en"&gt;      &lt;head&gt;        &lt;meta charSet="utf-8" /&gt;        &lt;meta name="viewport" content="width=device-          width,initial-scale=1" /&gt;        &lt;Meta /&gt;        &lt;Links /&gt;      &lt;/head&gt;      &lt;body className="bg-background dark:bg-darkBackground         text-lg text-text dark:text-darkText"&gt;        &lt;PageTransitionProgressBar /&gt;        </span><strong class="bold"><span class="koboSpan" id="kobo.230.1">{children}</span></strong><span class="koboSpan" id="kobo.231.1">        &lt;ScrollRestoration /&gt;        &lt;Scripts /&gt;        &lt;LiveReload /&gt;      &lt;/body&gt;    &lt;/html&gt;  );}</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.232.1">The reusable </span><strong class="source-inline"><span class="koboSpan" id="kobo.233.1">Document</span></strong><span class="koboSpan" id="kobo.234.1"> component renders the JSX from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.235.1">App</span></strong><span class="koboSpan" id="kobo.236.1"> component. </span><span class="koboSpan" id="kobo.236.2">We just replaced </span><strong class="source-inline"><span class="koboSpan" id="kobo.237.1">Outlet</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.238.1">with </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.239.1">children</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.240.1">.</span></span></p></li> <li><span class="koboSpan" id="kobo.241.1">Now, update</span><a id="_idIndexMarker296"/><span class="koboSpan" id="kobo.242.1"> the </span><strong class="source-inline"><span class="koboSpan" id="kobo.243.1">App</span></strong><span class="koboSpan" id="kobo.244.1"> component </span><a id="_idIndexMarker297"/><span class="koboSpan" id="kobo.245.1">so that it </span><span class="No-Break"><span class="koboSpan" id="kobo.246.1">uses </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.247.1">Document</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.248.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.249.1">
export default function App() {  return (    </span><strong class="bold"><span class="koboSpan" id="kobo.250.1">&lt;Document&gt;</span></strong><span class="koboSpan" id="kobo.251.1">      &lt;Outlet /&gt;    </span><strong class="bold"><span class="koboSpan" id="kobo.252.1">&lt;/Document&gt;</span></strong><span class="koboSpan" id="kobo.253.1">  );}</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.254.1">The content of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.255.1">App</span></strong><span class="koboSpan" id="kobo.256.1"> component remains unchanged. </span><span class="koboSpan" id="kobo.256.2">We just moved the code into the reusable </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.257.1">Document</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.258.1"> component.</span></span></p></li> <li><span class="koboSpan" id="kobo.259.1">Next, wrap the content of the error boundary inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.260.1">Document</span></strong><span class="koboSpan" id="kobo.261.1"> component </span><span class="No-Break"><span class="koboSpan" id="kobo.262.1">as well:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.263.1">
export function ErrorBoundary() {  const error = useRouteError();  let errorMessage = error instanceof Error ? </span><span class="koboSpan" id="kobo.263.2">error.message :    null;  return (    </span><strong class="bold"><span class="koboSpan" id="kobo.264.1">&lt;Document&gt;</span></strong><span class="koboSpan" id="kobo.265.1">…</span><strong class="bold"><span class="koboSpan" id="kobo.266.1">&lt;/Document&gt;</span></strong><span class="koboSpan" id="kobo.267.1">  );}</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.268.1">By using our custom </span><strong class="source-inline"><span class="koboSpan" id="kobo.269.1">Document</span></strong><span class="koboSpan" id="kobo.270.1"> component, the error boundary now includes our application’s scripts, stylesheets, and custom </span><strong class="source-inline"><span class="koboSpan" id="kobo.271.1">html</span></strong><span class="koboSpan" id="kobo.272.1"> and </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.273.1">head</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.274.1"> elements:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer031">
<span class="koboSpan" id="kobo.275.1"><img alt="Figure 7.4 – Styled root ErrorBoundary component" src="image/Figure_07.4_B17399.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.276.1">Figure 7.4 – Styled root ErrorBoundary component</span></p>
<p><span class="koboSpan" id="kobo.277.1">Amazing! </span><span class="koboSpan" id="kobo.277.2">Now, we can </span><a id="_idIndexMarker298"/><span class="koboSpan" id="kobo.278.1">utilize client-side</span><a id="_idIndexMarker299"/><span class="koboSpan" id="kobo.279.1"> JavaScript and our custom styles in the root </span><strong class="source-inline"><span class="koboSpan" id="kobo.280.1">ErrorBoundary</span></strong><span class="koboSpan" id="kobo.281.1"> component. </span><span class="koboSpan" id="kobo.281.2">One thing that we must keep in mind when reusing components for our </span><strong class="source-inline"><span class="koboSpan" id="kobo.282.1">ErrorBoundary</span></strong><span class="koboSpan" id="kobo.283.1"> component is that we can’t call the </span><strong class="source-inline"><span class="koboSpan" id="kobo.284.1">useLoaderData</span></strong><span class="koboSpan" id="kobo.285.1"> hook. </span><span class="koboSpan" id="kobo.285.2">Be sure not to render components that access loader data, as loader data is not defined when the </span><strong class="source-inline"><span class="koboSpan" id="kobo.286.1">ErrorBoundary</span></strong><span class="koboSpan" id="kobo.287.1"> component </span><span class="No-Break"><span class="koboSpan" id="kobo.288.1">is rendered.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.289.1">Error boundaries don’t have access to useLoaderData</span></p>
<p class="callout"><span class="koboSpan" id="kobo.290.1">An error boundary is rendered if an error occurs within the </span><strong class="source-inline"><span class="koboSpan" id="kobo.291.1">loader</span></strong><span class="koboSpan" id="kobo.292.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.293.1">action</span></strong><span class="koboSpan" id="kobo.294.1"> function of the route module. </span><span class="koboSpan" id="kobo.294.2">Conclusively, loader data is not available in the </span><span class="No-Break"><span class="koboSpan" id="kobo.295.1">error boundary.</span></span></p>
<p><span class="koboSpan" id="kobo.296.1">The top-level </span><strong class="source-inline"><span class="koboSpan" id="kobo.297.1">ErrorBoundary</span></strong><span class="koboSpan" id="kobo.298.1"> component in BeeRich does not render any navigation bar or other layout components. </span><span class="koboSpan" id="kobo.298.2">Keeping the top-level </span><strong class="source-inline"><span class="koboSpan" id="kobo.299.1">ErrorBoundary</span></strong><span class="koboSpan" id="kobo.300.1"> component simple ensures that it renders even in the case of an </span><span class="No-Break"><span class="koboSpan" id="kobo.301.1">unexpected failure.</span></span></p>
<p><span class="koboSpan" id="kobo.302.1">Next, let’s see how we can improve error handling further by declaring nested </span><span class="No-Break"><span class="koboSpan" id="kobo.303.1">error boundaries.</span></span></p>
<h2 id="_idParaDest-114"><a id="_idTextAnchor111"/><span class="koboSpan" id="kobo.304.1">Nested error handling</span></h2>
<p><span class="koboSpan" id="kobo.305.1">Error boundaries </span><a id="_idIndexMarker300"/><span class="koboSpan" id="kobo.306.1">can be nested. </span><span class="koboSpan" id="kobo.306.2">When an error is thrown, it bubbles upward through the route hierarchy until Remix finds the nearest error boundary. </span><span class="koboSpan" id="kobo.306.3">Nested error boundaries let us </span><span class="No-Break"><span class="koboSpan" id="kobo.307.1">contain errors.</span></span></p>
<p><span class="koboSpan" id="kobo.308.1">Let’s add a </span><a id="_idIndexMarker301"/><span class="koboSpan" id="kobo.309.1">nested error boundary to the dashboard </span><span class="No-Break"><span class="koboSpan" id="kobo.310.1">route module:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.311.1">Open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.312.1">dashboard.tsx</span></strong><span class="koboSpan" id="kobo.313.1"> route module inside the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.314.1">app/routes</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.315.1"> folder.</span></span></li>
<li><span class="koboSpan" id="kobo.316.1">Add a simple </span><strong class="source-inline"><span class="koboSpan" id="kobo.317.1">ErrorBoundary</span></strong><span class="koboSpan" id="kobo.318.1"> export to </span><span class="No-Break"><span class="koboSpan" id="kobo.319.1">the page:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.320.1">
export function ErrorBoundary() {  return &lt;p&gt;Error contained in dashboard.tsx&lt;/p&gt;;}</span></pre></li> <li><span class="koboSpan" id="kobo.321.1">Now, throw an error in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.322.1">dashboard.tsx</span></strong><span class="koboSpan" id="kobo.323.1"> route module’s </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.324.1">loader</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.325.1"> function:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.326.1">
throw Error('Something went wrong!');</span></pre></li> <li><span class="koboSpan" id="kobo.327.1">Run the app and visit the dashboard by opening </span><a href="http://localhost:3000/dashboard"><span class="koboSpan" id="kobo.328.1">http://localhost:3000/dashboard</span></a><span class="koboSpan" id="kobo.329.1"> in a new </span><span class="No-Break"><span class="koboSpan" id="kobo.330.1">browser window.</span></span><p class="list-inset"><span class="koboSpan" id="kobo.331.1">Note that we are not rendering the root error boundary but the one nested in </span><strong class="source-inline"><span class="koboSpan" id="kobo.332.1">dashboard.tsx</span></strong><span class="koboSpan" id="kobo.333.1">. </span><span class="koboSpan" id="kobo.333.2">Remix uses the closest error boundary available and renders it within the parent route </span><span class="No-Break"><span class="koboSpan" id="kobo.334.1">component’s </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.335.1">Outlet</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.336.1">.</span></span></p></li>
<li><span class="koboSpan" id="kobo.337.1">Let’s make the error boundary look nice. </span><span class="koboSpan" id="kobo.337.2">Like we did in </span><strong class="source-inline"><span class="koboSpan" id="kobo.338.1">root.tsx</span></strong><span class="koboSpan" id="kobo.339.1">, we want to share markup between the </span><strong class="source-inline"><span class="koboSpan" id="kobo.340.1">ErrorBoundary</span></strong><span class="koboSpan" id="kobo.341.1"> component and the route component. </span><span class="koboSpan" id="kobo.341.2">Refactor the route component so that it’s a reusable </span><strong class="source-inline"><span class="koboSpan" id="kobo.342.1">Layout</span></strong><span class="koboSpan" id="kobo.343.1"> component. </span><span class="koboSpan" id="kobo.343.2">First, remove </span><strong class="source-inline"><span class="koboSpan" id="kobo.344.1">export default</span></strong><span class="koboSpan" id="kobo.345.1"> from the function definition and add a </span><strong class="source-inline"><span class="koboSpan" id="kobo.346.1">LayoutProps</span></strong><span class="koboSpan" id="kobo.347.1"> type to specify the properties the </span><span class="No-Break"><span class="koboSpan" id="kobo.348.1">component expects:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.349.1">
import type { </span><strong class="bold"><span class="koboSpan" id="kobo.350.1">Expense</span></strong><span class="koboSpan" id="kobo.351.1">, </span><strong class="bold"><span class="koboSpan" id="kobo.352.1">Invoice</span></strong><span class="koboSpan" id="kobo.353.1"> } from '@prisma/client';import type { </span><strong class="bold"><span class="koboSpan" id="kobo.354.1">SerializeFrom</span></strong><span class="koboSpan" id="kobo.355.1"> } from '@remix-run/node';type LayoutProps = {  children: React.ReactNode;  firstExpense: </span><strong class="bold"><span class="koboSpan" id="kobo.356.1">SerializeFrom&lt;Expense&gt;</span></strong><span class="koboSpan" id="kobo.357.1"> | null;  firstInvoice: </span><strong class="bold"><span class="koboSpan" id="kobo.358.1">SerializeFrom&lt;Invoice&gt;</span></strong><span class="koboSpan" id="kobo.359.1"> | null;};function Layout(</span><strong class="bold"><span class="koboSpan" id="kobo.360.1">{ firstExpense, firstInvoice, children }: LayoutProps</span></strong><span class="koboSpan" id="kobo.361.1">) {  …}</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.362.1">The new </span><strong class="source-inline"><span class="koboSpan" id="kobo.363.1">Layout</span></strong><span class="koboSpan" id="kobo.364.1"> component </span><a id="_idIndexMarker302"/><span class="koboSpan" id="kobo.365.1">expects three props: React </span><strong class="source-inline"><span class="koboSpan" id="kobo.366.1">children</span></strong><span class="koboSpan" id="kobo.367.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.368.1">firstExpense</span></strong><span class="koboSpan" id="kobo.369.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.370.1">firstInvoice</span></strong><span class="koboSpan" id="kobo.371.1">. </span><span class="koboSpan" id="kobo.371.2">To type the props correctly, we wrap the </span><strong class="source-inline"><span class="koboSpan" id="kobo.372.1">Expense</span></strong><span class="koboSpan" id="kobo.373.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.374.1">Invoice</span></strong><span class="koboSpan" id="kobo.375.1"> types </span><a id="_idIndexMarker303"/><span class="koboSpan" id="kobo.376.1">from Prisma with Remix’s </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.377.1">SerializeFrom</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.378.1"> type.</span></span></p><p class="list-inset"><span class="koboSpan" id="kobo.379.1">Prisma (our database ORM) generates the </span><strong class="source-inline"><span class="koboSpan" id="kobo.380.1">Expense</span></strong><span class="koboSpan" id="kobo.381.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.382.1">Invoice</span></strong><span class="koboSpan" id="kobo.383.1"> types based on our Prisma database schema. </span><span class="koboSpan" id="kobo.383.2">Remix’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.384.1">SerializeFrom</span></strong><span class="koboSpan" id="kobo.385.1"> type transforms the </span><strong class="source-inline"><span class="koboSpan" id="kobo.386.1">Expense</span></strong><span class="koboSpan" id="kobo.387.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.388.1">Invoice</span></strong><span class="koboSpan" id="kobo.389.1"> types into their serialized versions. </span><span class="koboSpan" id="kobo.389.2">This is necessary as the data travels over the network, serialized as JSON. </span><span class="koboSpan" id="kobo.389.3">For instance, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.390.1">createdAt</span></strong><span class="koboSpan" id="kobo.391.1"> field is of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.392.1">Date</span></strong><span class="koboSpan" id="kobo.393.1"> type on the server but serialized as </span><strong class="source-inline"><span class="koboSpan" id="kobo.394.1">string</span></strong><span class="koboSpan" id="kobo.395.1"> once accessed </span><span class="No-Break"><span class="koboSpan" id="kobo.396.1">via </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.397.1">useLoaderData</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.398.1">.</span></span></p></li> <li><span class="koboSpan" id="kobo.399.1">Remove the </span><strong class="source-inline"><span class="koboSpan" id="kobo.400.1">useLoaderData</span></strong><span class="koboSpan" id="kobo.401.1"> call from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.402.1">Layout</span></strong><span class="koboSpan" id="kobo.403.1"> function body. </span><span class="koboSpan" id="kobo.403.2">Since error boundaries cannot call </span><strong class="source-inline"><span class="koboSpan" id="kobo.404.1">useLoaderData</span></strong><span class="koboSpan" id="kobo.405.1">, we must pass the loader data as optional </span><a id="_idIndexMarker304"/><span class="koboSpan" id="kobo.406.1">props. </span><span class="koboSpan" id="kobo.406.2">As visible in </span><strong class="source-inline"><span class="koboSpan" id="kobo.407.1">LayoutProps</span></strong><span class="koboSpan" id="kobo.408.1">, we ensure that the </span><strong class="source-inline"><span class="koboSpan" id="kobo.409.1">Layout</span></strong><span class="koboSpan" id="kobo.410.1"> component also accepts </span><strong class="source-inline"><span class="koboSpan" id="kobo.411.1">null</span></strong><span class="koboSpan" id="kobo.412.1"> as a value for </span><strong class="source-inline"><span class="koboSpan" id="kobo.413.1">firstExpense</span></strong><span class="koboSpan" id="kobo.414.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.415.1">firstInvoice</span></strong><span class="koboSpan" id="kobo.416.1">. </span><span class="koboSpan" id="kobo.416.2">This can be the case if we don’t find any expenses or invoices in our database or when the error boundary </span><span class="No-Break"><span class="koboSpan" id="kobo.417.1">is rendered.</span></span></li>
<li><span class="koboSpan" id="kobo.418.1">Replace</span><a id="_idIndexMarker305"/><span class="koboSpan" id="kobo.419.1"> the rendering of </span><strong class="source-inline"><span class="koboSpan" id="kobo.420.1">Outlet</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.421.1">with </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.422.1">children</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.423.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.424.1">
&lt;main className="p-4 w-full flex justify-center items-center"&gt;</span><strong class="bold"><span class="koboSpan" id="kobo.425.1">{children}</span></strong><span class="koboSpan" id="kobo.426.1">&lt;/main&gt;</span></pre></li> <li><span class="koboSpan" id="kobo.427.1">Create a new route component that </span><span class="No-Break"><span class="koboSpan" id="kobo.428.1">uses </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.429.1">Layout</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.430.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.431.1">
export default function Component() {  const { firstExpense, firstInvoice } = useLoaderData&lt;typeof loader&gt;();  return (    &lt;Layout firstExpense={firstExpense} firstInvoice={firstInvoice}&gt;      &lt;Outlet /&gt;    &lt;/Layout&gt;  );}</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.432.1">The route component renders the same content as before. </span><span class="koboSpan" id="kobo.432.2">We just moved some code to the new </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.433.1">Layout</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.434.1"> component.</span></span></p></li> <li><span class="koboSpan" id="kobo.435.1">Next, update the </span><strong class="source-inline"><span class="koboSpan" id="kobo.436.1">ErrorBoundary</span></strong><span class="koboSpan" id="kobo.437.1"> component </span><span class="No-Break"><span class="koboSpan" id="kobo.438.1">in </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.439.1">dashboard.tsx</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.440.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.441.1">
import { Link as RemixLink, Outlet, useLoaderData, useLocation, </span><strong class="bold"><span class="koboSpan" id="kobo.442.1">useRouteError</span></strong><span class="koboSpan" id="kobo.443.1"> } from '@remix-run/react';import { H1 } from '~/components/headings';export function ErrorBoundary() {  const error = useRouteError();  const errorMessage = error instanceof Error &amp;&amp; error.message;  return (    &lt;Layout firstExpense={null} firstInvoice={null}&gt;      &lt;Container className="p-5 lg:p-20 flex flex-col gap-5"&gt;        &lt;H1&gt;Unexpected Error&lt;/H1&gt;        &lt;p&gt;We are very sorry. </span><span class="koboSpan" id="kobo.443.2">An unexpected error occurred.          </span><span class="koboSpan" id="kobo.443.3">Please try again or contact us if the problem          persists.&lt;/p&gt;        {errorMessage &amp;&amp; (          &lt;div className="border-4 border-red-500 p-10"&gt;            &lt;p&gt;Error message: {error.message}&lt;/p&gt;          &lt;/div&gt;        )}      &lt;/Container&gt;    &lt;/Layout&gt;  );}</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.444.1">Great! </span><span class="koboSpan" id="kobo.444.2">We </span><a id="_idIndexMarker306"/><span class="koboSpan" id="kobo.445.1">created a nice-looking error </span><a id="_idIndexMarker307"/><span class="koboSpan" id="kobo.446.1">boundary that shares markup with the route component to create the same look and feel. </span><span class="koboSpan" id="kobo.446.2">Let's test </span><span class="No-Break"><span class="koboSpan" id="kobo.447.1">our implementation.</span></span></p></li> <li><span class="koboSpan" id="kobo.448.1">Remove the </span><a id="_idIndexMarker308"/><span class="koboSpan" id="kobo.449.1">thrown error from the </span><strong class="source-inline"><span class="koboSpan" id="kobo.450.1">loader</span></strong><span class="koboSpan" id="kobo.451.1"> function for </span><span class="No-Break"><span class="koboSpan" id="kobo.452.1">a moment.</span></span></li>
<li><span class="koboSpan" id="kobo.453.1">Run the app </span><a id="_idIndexMarker309"/><span class="koboSpan" id="kobo.454.1">and visit the </span><a href="http://localhost:3000/dashboard"><span class="No-Break"><span class="koboSpan" id="kobo.455.1">http://localhost:3000/dashboard</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.456.1"> page.</span></span><p class="list-inset"><span class="koboSpan" id="kobo.457.1">Without throwing an error, we should see the expense overview page. </span><span class="koboSpan" id="kobo.457.2">If you can’t remember why this is happening, look inside the </span><strong class="source-inline"><span class="koboSpan" id="kobo.458.1">dashboard._index.tsx</span></strong><span class="koboSpan" id="kobo.459.1"> route module. </span><span class="koboSpan" id="kobo.459.2">If the dashboard’s index route is active, it redirects to the expense </span><span class="No-Break"><span class="koboSpan" id="kobo.460.1">overview page.</span></span></p></li>
<li><span class="koboSpan" id="kobo.461.1">Next, throw an error in any </span><strong class="source-inline"><span class="koboSpan" id="kobo.462.1">loader</span></strong><span class="koboSpan" id="kobo.463.1"> function or React component that is active inside </span><span class="No-Break"><span class="koboSpan" id="kobo.464.1">the dashboard:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.465.1">
throw Error('Something went wrong!');</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.466.1">The browser window should now render the styled nested error boundary. </span><span class="koboSpan" id="kobo.466.2">As visible in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.467.1">Figure 7</span></em></span><em class="italic"><span class="koboSpan" id="kobo.468.1">.5</span></em><span class="koboSpan" id="kobo.469.1">, adding an error boundary to the dashboard route lets us isolate the error and render all parent </span><span class="No-Break"><span class="koboSpan" id="kobo.470.1">routes correctly:</span></span></p></li> </ol>
<div>
<div class="IMG---Figure" id="_idContainer032">
<span class="koboSpan" id="kobo.471.1"><img alt="Figure 7.5 – Nested dashboard ErrorBoundary component" src="image/Figure_07.5_B17399.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.472.1">Figure 7.5 – Nested dashboard ErrorBoundary component</span></p>
<p><span class="koboSpan" id="kobo.473.1">Nested error boundaries </span><a id="_idIndexMarker310"/><span class="koboSpan" id="kobo.474.1">allow us to contain errors </span><a id="_idIndexMarker311"/><span class="koboSpan" id="kobo.475.1">within a subset of the route hierarchy. </span><span class="koboSpan" id="kobo.475.2">This ensures that the parent routes render as expected. </span><span class="koboSpan" id="kobo.475.3">The closer the error boundary is to the error that occurred, the more contained the error </span><span class="No-Break"><span class="koboSpan" id="kobo.476.1">will be.</span></span></p>
<p><span class="koboSpan" id="kobo.477.1">In this section, you learned how to handle unexpected errors in Remix using Remix’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.478.1">ErrorBoundary</span></strong><span class="koboSpan" id="kobo.479.1"> component. </span><span class="koboSpan" id="kobo.479.2">Next, let’s look at how to use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.480.1">ErrorBoundary</span></strong><span class="koboSpan" id="kobo.481.1"> component to handle </span><span class="No-Break"><span class="koboSpan" id="kobo.482.1">expected exceptions.</span></span></p>
<h1 id="_idParaDest-115"><a id="_idTextAnchor112"/><span class="koboSpan" id="kobo.483.1">Handling thrown responses</span></h1>
<p><span class="koboSpan" id="kobo.484.1">We already</span><a id="_idIndexMarker312"/><span class="koboSpan" id="kobo.485.1"> take advantage of throwing </span><strong class="source-inline"><span class="koboSpan" id="kobo.486.1">Response</span></strong><span class="koboSpan" id="kobo.487.1"> objects in BeeRich. </span><span class="koboSpan" id="kobo.487.2">For instance, in </span><a href="B17399_04.xhtml#_idTextAnchor057"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.488.1">Chapter 4</span></em></span></a><span class="koboSpan" id="kobo.489.1">, </span><em class="italic"><span class="koboSpan" id="kobo.490.1">Routing in Remix,</span></em><span class="koboSpan" id="kobo.491.1"> we added the following </span><strong class="source-inline"><span class="koboSpan" id="kobo.492.1">loader</span></strong><span class="koboSpan" id="kobo.493.1"> function to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.494.1">dashboard.expenses.$id.tsx</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.495.1">route module:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.496.1">
export function loader({ params }: LoaderFunctionArgs) {  const { id } = params;
  const expense = data.find((expense) =&gt; expense.id === Number(id));
  </span><strong class="bold"><span class="koboSpan" id="kobo.497.1">if (!expense) throw new Response('Not found', { status: 404 });</span></strong><span class="koboSpan" id="kobo.498.1">
  return json(expense);
}</span></pre>
<p><span class="koboSpan" id="kobo.499.1">In the </span><strong class="source-inline"><span class="koboSpan" id="kobo.500.1">loader</span></strong><span class="koboSpan" id="kobo.501.1"> function, we throw a </span><strong class="source-inline"><span class="koboSpan" id="kobo.502.1">Response</span></strong><span class="koboSpan" id="kobo.503.1"> object if we cannot find the expense for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.504.1">id</span></strong><span class="koboSpan" id="kobo.505.1"> route parameter. </span><span class="koboSpan" id="kobo.505.2">This creates an expected failure during </span><strong class="source-inline"><span class="koboSpan" id="kobo.506.1">loader</span></strong><span class="koboSpan" id="kobo.507.1"> function execution. </span><span class="koboSpan" id="kobo.507.2">Let’s investigate Remix’s default behavior when an expected </span><span class="No-Break"><span class="koboSpan" id="kobo.508.1">exception occurs.</span></span></p>
<h2 id="_idParaDest-116"><a id="_idTextAnchor113"/><span class="koboSpan" id="kobo.509.1">Throwing responses</span></h2>
<p><span class="koboSpan" id="kobo.510.1">In JavaScript, the </span><strong class="source-inline"><span class="koboSpan" id="kobo.511.1">throw</span></strong><span class="koboSpan" id="kobo.512.1"> statement is used to throw user-defined exceptions. </span><span class="koboSpan" id="kobo.512.2">A </span><strong class="source-inline"><span class="koboSpan" id="kobo.513.1">catch</span></strong><span class="koboSpan" id="kobo.514.1"> block can then catch the thrown exception. </span><span class="koboSpan" id="kobo.514.2">We can throw any value, including </span><strong class="source-inline"><span class="koboSpan" id="kobo.515.1">Response</span></strong><span class="koboSpan" id="kobo.516.1"> objects. </span><span class="koboSpan" id="kobo.516.2">Remix takes advantage of this, offering a convention to stop </span><strong class="source-inline"><span class="koboSpan" id="kobo.517.1">action</span></strong><span class="koboSpan" id="kobo.518.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.519.1">loader</span></strong><span class="koboSpan" id="kobo.520.1"> functions early with exception responses. </span><span class="koboSpan" id="kobo.520.2">Let’s invoke the not-found response that was thrown in the expense </span><span class="No-Break"><span class="koboSpan" id="kobo.521.1">details </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.522.1">loader</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.523.1">:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.524.1">Run BeeRich on localhost by executing </span><strong class="source-inline"><span class="koboSpan" id="kobo.525.1">npm </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.526.1">run dev</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.527.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.528.1">Visit the expense overview page by opening </span><a href="http://localhost:3000/dashboard/expenses"><span class="koboSpan" id="kobo.529.1">http://localhost:3000/dashboard/expenses</span></a><span class="koboSpan" id="kobo.530.1"> in a new </span><span class="No-Break"><span class="koboSpan" id="kobo.531.1">browser window.</span></span></li>
<li><span class="koboSpan" id="kobo.532.1">Now, click on an expense in the overview list. </span><span class="koboSpan" id="kobo.532.2">This will redirect us to the expense </span><span class="No-Break"><span class="koboSpan" id="kobo.533.1">details page.</span></span></li>
<li><span class="koboSpan" id="kobo.534.1">Replace the </span><strong class="source-inline"><span class="koboSpan" id="kobo.535.1">id</span></strong><span class="koboSpan" id="kobo.536.1"> route parameter in the URL with a fake one: </span><a href="http://localhost:3000/dashboard/expenses/fake-id"><span class="koboSpan" id="kobo.537.1">http://localhost:3000/dashboard/expenses/fake-id</span></a><span class="koboSpan" id="kobo.538.1">. </span><span class="koboSpan" id="kobo.538.2">Then, reload the </span><span class="No-Break"><span class="koboSpan" id="kobo.539.1">browser window.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.540.1">This should render our dashboard error boundary to </span><span class="No-Break"><span class="koboSpan" id="kobo.541.1">the page.</span></span></p>
<p><span class="koboSpan" id="kobo.542.1">Remix lets us </span><a id="_idIndexMarker313"/><span class="koboSpan" id="kobo.543.1">handle unexpected errors and thrown responses uniformly with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.544.1">ErrorBoundary</span></strong><span class="koboSpan" id="kobo.545.1"> component. </span><span class="koboSpan" id="kobo.545.2">Any </span><strong class="source-inline"><span class="koboSpan" id="kobo.546.1">Response</span></strong><span class="koboSpan" id="kobo.547.1"> object thrown in a </span><strong class="source-inline"><span class="koboSpan" id="kobo.548.1">loader</span></strong><span class="koboSpan" id="kobo.549.1"> or </span><strong class="source-inline"><span class="koboSpan" id="kobo.550.1">action</span></strong><span class="koboSpan" id="kobo.551.1"> function triggers the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.552.1">ErrorBoundary</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.553.1"> component.</span></span></p>
<p><span class="koboSpan" id="kobo.554.1">Thrown responses allow us to retrieve additional information, such as the status code from the error in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.555.1">ErrorBoundary</span></strong><span class="koboSpan" id="kobo.556.1"> component. </span><span class="koboSpan" id="kobo.556.2">For that, we need to check whether the thrown error object is a </span><strong class="source-inline"><span class="koboSpan" id="kobo.557.1">Response</span></strong><span class="koboSpan" id="kobo.558.1"> object or an </span><span class="No-Break"><span class="koboSpan" id="kobo.559.1">unexpected error.</span></span></p>
<h2 id="_idParaDest-117"><a id="_idTextAnchor114"/><span class="koboSpan" id="kobo.560.1">Handling exceptions with error boundaries</span></h2>
<p><span class="koboSpan" id="kobo.561.1">Let’s add a </span><a id="_idIndexMarker314"/><span class="koboSpan" id="kobo.562.1">third error boundary, this time for the nested expense </span><span class="No-Break"><span class="koboSpan" id="kobo.563.1">details page:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.564.1">Open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.565.1">dashboard.expenses.$id.tsx</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.566.1">route module.</span></span></li>
<li><span class="koboSpan" id="kobo.567.1">Import Remix’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.568.1">useRouteError</span></strong><span class="koboSpan" id="kobo.569.1"> and </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.570.1">isRouteErrorResponse</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.571.1"> helpers:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.572.1">
import {  </span><strong class="source-inline"><span class="koboSpan" id="kobo.573.1">isRouteErrorResponse</span></strong><span class="koboSpan" id="kobo.574.1">,  useActionData,  useLoaderData,  useNavigation,  useParams,  </span><strong class="source-inline"><span class="koboSpan" id="kobo.575.1">useRouteError</span></strong><span class="koboSpan" id="kobo.576.1">,} from '@remix-run/react';</span></pre></li> <li><span class="koboSpan" id="kobo.577.1">Create a new </span><strong class="source-inline"><span class="koboSpan" id="kobo.578.1">ErrorBoundary</span></strong><span class="koboSpan" id="kobo.579.1"> export and add the </span><span class="No-Break"><span class="koboSpan" id="kobo.580.1">following code:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.581.1">
export function ErrorBoundary() {  const error = useRouteError();  const { id } = useParams();  let heading = 'Something went wrong';  let message = `Apologies, something went wrong on our end, please try again.`;  if (</span><strong class="bold"><span class="koboSpan" id="kobo.582.1">isRouteErrorResponse(error) &amp;&amp; error.status === 404</span></strong><span class="koboSpan" id="kobo.583.1">) {    heading = 'Expense not found';    message = `Apologies, the expense with the id ${id} cannot be found.`;  }  return (    &lt;&gt;      &lt;div className="w-full m-auto lg:max-w-3xl flex flex-col items-center justify-center gap-5"&gt;        &lt;H2&gt;{heading}&lt;/H2&gt;        &lt;p&gt;{message}&lt;/p&gt;      &lt;/div&gt;      &lt;FloatingActionLink to="/dashboard/expenses/"&gt;Add expense&lt;/FloatingActionLink&gt;    &lt;/&gt;  );}</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.584.1">This time, we</span><a id="_idIndexMarker315"/><span class="koboSpan" id="kobo.585.1"> also use Remix’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.586.1">useParams</span></strong><span class="koboSpan" id="kobo.587.1"> hook to access the expense </span><strong class="source-inline"><span class="koboSpan" id="kobo.588.1">id</span></strong><span class="koboSpan" id="kobo.589.1"> route parameter. </span><span class="koboSpan" id="kobo.589.2">Then, we use Remix’s </span><strong class="source-inline"><span class="koboSpan" id="kobo.590.1">isRouteErrorResponse</span></strong><span class="koboSpan" id="kobo.591.1"> helper to check whether the error object is a </span><strong class="source-inline"><span class="koboSpan" id="kobo.592.1">Response</span></strong><span class="koboSpan" id="kobo.593.1"> object. </span><span class="koboSpan" id="kobo.593.2">If yes, then we can read the status code and other fields of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.594.1">Response</span></strong><span class="koboSpan" id="kobo.595.1"> object to provide a more specific </span><span class="No-Break"><span class="koboSpan" id="kobo.596.1">error message.</span></span></p></li> <li><span class="koboSpan" id="kobo.597.1">Next, test the</span><a id="_idIndexMarker316"/><span class="koboSpan" id="kobo.598.1"> implementation. </span><span class="koboSpan" id="kobo.598.2">Navigate to an expense details page and use a fake </span><strong class="source-inline"><span class="koboSpan" id="kobo.599.1">id</span></strong><span class="koboSpan" id="kobo.600.1"> route parameter in the URL. </span><span class="koboSpan" id="kobo.600.2">You should now see the nested </span><strong class="source-inline"><span class="koboSpan" id="kobo.601.1">ErrorBoundary</span></strong><span class="koboSpan" id="kobo.602.1"> component rendered on </span><span class="No-Break"><span class="koboSpan" id="kobo.603.1">the page.</span></span><p class="list-inset"><span class="koboSpan" id="kobo.604.1">Notice how we still render the expense overview list; this is the power of nested </span><span class="No-Break"><span class="koboSpan" id="kobo.605.1">error handling!</span></span></p></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer033">
<span class="koboSpan" id="kobo.606.1"><img alt="Figure 7.6 – Nested expense details ErrorBoundary component" src="image/Figure_07.6_B17399.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.607.1">Figure 7.6 – Nested expense details ErrorBoundary component</span></p>
<p><span class="koboSpan" id="kobo.608.1">Now that we’ve implemented a nested error boundary for the expense details page, go ahead and implement the same experience for the income </span><span class="No-Break"><span class="koboSpan" id="kobo.609.1">details page.</span></span></p>
<p><span class="koboSpan" id="kobo.610.1">Once you’ve finished working on the income details page, we’ll revisit the unpleasant experience from </span><a href="B17399_06.xhtml#_idTextAnchor090"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.611.1">Chapter 6</span></em></span></a><span class="koboSpan" id="kobo.612.1">, </span><em class="italic"><span class="koboSpan" id="kobo.613.1">Enhancing the </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.614.1">User Experience</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.615.1">.</span></span></p>
<h2 id="_idParaDest-118"><a id="_idTextAnchor115"/><span class="koboSpan" id="kobo.616.1">Creating a resilient experience</span></h2>
<p><span class="koboSpan" id="kobo.617.1">Do you </span><a id="_idIndexMarker317"/><span class="koboSpan" id="kobo.618.1">remember that we created an unpleasant experience in </span><a href="B17399_06.xhtml#_idTextAnchor090"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.619.1">Chapter 6</span></em></span></a><span class="koboSpan" id="kobo.620.1">, </span><em class="italic"><span class="koboSpan" id="kobo.621.1">Enhancing the User Experience,</span></em><span class="koboSpan" id="kobo.622.1"> when introducing the expense deletion form? </span><span class="koboSpan" id="kobo.622.2">If you are on an expense details page (</span><strong class="source-inline"><span class="koboSpan" id="kobo.623.1">dashboard/expenses/$id</span></strong><span class="koboSpan" id="kobo.624.1">) and quickly delete all expenses in one go, you may end up on a not-found page. </span><span class="koboSpan" id="kobo.624.2">This is because of our redirect logic in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.625.1">dashboard/expenses/$id</span></strong> <span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.626.1">deleteExpense</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.627.1"> function:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.628.1">
async function deleteExpense(request: Request, id: string): Promise&lt;Response&gt; {  </span><strong class="bold"><span class="koboSpan" id="kobo.629.1">const referer = request.headers.get('referer');</span></strong><span class="koboSpan" id="kobo.630.1">
  </span><strong class="bold"><span class="koboSpan" id="kobo.631.1">const redirectPath = referer || '/dashboard/expenses';</span></strong><span class="koboSpan" id="kobo.632.1">
  try {
    await db.expense.delete({ where: { id } });
  } catch (err) {
    throw new Response('Not found', { status: 404 });
  }
  if (</span><strong class="bold"><span class="koboSpan" id="kobo.633.1">redirectPath.includes(id)</span></strong><span class="koboSpan" id="kobo.634.1">) {
    return redirect('/dashboard/expenses');
  }
  return redirect(redirectPath);
}</span></pre>
<p><span class="koboSpan" id="kobo.635.1">We use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.636.1">referer</span></strong><span class="koboSpan" id="kobo.637.1"> header, if available, to redirect the user back to the current route after deletion. </span><span class="koboSpan" id="kobo.637.2">This is meant to improve the user experience. </span><span class="koboSpan" id="kobo.637.3">If the user is currently on the details page, </span><strong class="source-inline"><span class="koboSpan" id="kobo.638.1">/dashboard/expenses/1</span></strong><span class="koboSpan" id="kobo.639.1">, and deletes the expense with </span><strong class="source-inline"><span class="koboSpan" id="kobo.640.1">id</span></strong> <strong class="source-inline"><span class="koboSpan" id="kobo.641.1">2</span></strong><span class="koboSpan" id="kobo.642.1">, then we do not want to redirect the user away from </span><strong class="source-inline"><span class="koboSpan" id="kobo.643.1">/dashboard/expenses/1</span></strong><span class="koboSpan" id="kobo.644.1">. </span><span class="koboSpan" id="kobo.644.2">However, we also have an </span><strong class="source-inline"><span class="koboSpan" id="kobo.645.1">if</span></strong><span class="koboSpan" id="kobo.646.1"> condition in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.647.1">deleteExpense</span></strong><span class="koboSpan" id="kobo.648.1"> function to make sure that we do redirect the user if the user is currently on the details page of the expense that is </span><span class="No-Break"><span class="koboSpan" id="kobo.649.1">being deleted.</span></span></p>
<p><span class="koboSpan" id="kobo.650.1">This </span><a id="_idIndexMarker318"/><span class="koboSpan" id="kobo.651.1">logic fails when we quickly delete several expenses. </span><span class="koboSpan" id="kobo.651.2">Triggering many expense deletions simultaneously creates a race condition between the different action requests. </span><span class="koboSpan" id="kobo.651.3">It is going to be the response of the last triggered </span><strong class="source-inline"><span class="koboSpan" id="kobo.652.1">action</span></strong><span class="koboSpan" id="kobo.653.1"> that decides where the user is going to be redirected. </span><span class="koboSpan" id="kobo.653.2">However, by that time, we might have already deleted the expense that we currently have in the </span><span class="No-Break"><span class="koboSpan" id="kobo.654.1">details view.</span></span></p>
<p><span class="koboSpan" id="kobo.655.1">Let’s say we are on the details page, </span><strong class="source-inline"><span class="koboSpan" id="kobo.656.1">/dashboard/expenses/1</span></strong><span class="koboSpan" id="kobo.657.1">, and quickly delete the expenses with </span><strong class="source-inline"><span class="koboSpan" id="kobo.658.1">id</span></strong> <strong class="source-inline"><span class="koboSpan" id="kobo.659.1">1</span></strong><span class="koboSpan" id="kobo.660.1"> and then also with </span><strong class="source-inline"><span class="koboSpan" id="kobo.661.1">id</span></strong> <strong class="source-inline"><span class="koboSpan" id="kobo.662.1">2</span></strong><span class="koboSpan" id="kobo.663.1">. </span><span class="koboSpan" id="kobo.663.2">In the </span><strong class="source-inline"><span class="koboSpan" id="kobo.664.1">deleteExpense</span></strong><span class="koboSpan" id="kobo.665.1"> function handling the deletion of expense </span><strong class="source-inline"><span class="koboSpan" id="kobo.666.1">1</span></strong><span class="koboSpan" id="kobo.667.1">, we return a redirect to </span><strong class="source-inline"><span class="koboSpan" id="kobo.668.1">/dashboard/expenses</span></strong><span class="koboSpan" id="kobo.669.1"> since we know that expense </span><strong class="source-inline"><span class="koboSpan" id="kobo.670.1">1</span></strong><span class="koboSpan" id="kobo.671.1"> has been deleted. </span><span class="koboSpan" id="kobo.671.2">However, in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.672.1">deleteExpense</span></strong><span class="koboSpan" id="kobo.673.1"> function handling the deletion of expense </span><strong class="source-inline"><span class="koboSpan" id="kobo.674.1">2</span></strong><span class="koboSpan" id="kobo.675.1">, we will return a redirect to </span><strong class="source-inline"><span class="koboSpan" id="kobo.676.1">/dashboard/expenses/1</span></strong><span class="koboSpan" id="kobo.677.1"> (the current page). </span><span class="koboSpan" id="kobo.677.2">Remix takes the response of the last user action and commits to the redirect to </span><strong class="source-inline"><span class="koboSpan" id="kobo.678.1">/dashboard/expenses/1</span></strong><span class="koboSpan" id="kobo.679.1">. </span><span class="koboSpan" id="kobo.679.2">We throw a 404 not-found error in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.680.1">loader</span></strong><span class="koboSpan" id="kobo.681.1"> function as the expense with </span><strong class="source-inline"><span class="koboSpan" id="kobo.682.1">id</span></strong> <strong class="source-inline"><span class="koboSpan" id="kobo.683.1">1</span></strong><span class="koboSpan" id="kobo.684.1"> cannot be found (it has </span><span class="No-Break"><span class="koboSpan" id="kobo.685.1">been deleted).</span></span></p>
<p><span class="koboSpan" id="kobo.686.1">As shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.687.1">Figure 7</span></em></span><em class="italic"><span class="koboSpan" id="kobo.688.1">.6</span></em><span class="koboSpan" id="kobo.689.1">, we've enhanced the user experience by introducing the nested </span><strong class="source-inline"><span class="koboSpan" id="kobo.690.1">ErrorBoundary</span></strong><span class="koboSpan" id="kobo.691.1"> component for expense details. </span><span class="koboSpan" id="kobo.691.2">Nice! </span><span class="koboSpan" id="kobo.691.3">Now, if there's a 404 error, the user stays on the expenses overview page, and the error is contained in the nested </span><strong class="source-inline"><span class="koboSpan" id="kobo.692.1">ErrorBoundary</span></strong><span class="koboSpan" id="kobo.693.1">. </span><span class="koboSpan" id="kobo.693.2">We avoid showing the user a full-screen error message and instead gracefully display the not-found error as part of the </span><span class="No-Break"><span class="koboSpan" id="kobo.694.1">dashboard UI.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.695.1">Declarative error handling</span></p>
<p class="callout"><span class="koboSpan" id="kobo.696.1">Remix’s error boundaries let us handle errors and exceptions declaratively. </span><span class="koboSpan" id="kobo.696.2">By adding nested error boundaries, we can handle edge cases gracefully for a resilient </span><span class="No-Break"><span class="koboSpan" id="kobo.697.1">user experience.</span></span></p>
<p><span class="koboSpan" id="kobo.698.1">Now that we’ve ensured a resilient user experience with nested error boundaries, let’s enhance the root error boundary with custom error messages for common HTTP status codes. </span><span class="koboSpan" id="kobo.698.2">In the next section, we will handle </span><span class="No-Break"><span class="koboSpan" id="kobo.699.1">page-not-found errors.</span></span></p>
<h1 id="_idParaDest-119"><a id="_idTextAnchor116"/><span class="koboSpan" id="kobo.700.1">Handling page-not-found (404) errors</span></h1>
<p><span class="koboSpan" id="kobo.701.1">We can </span><a id="_idIndexMarker319"/><span class="koboSpan" id="kobo.702.1">also handle thrown responses in the root </span><strong class="source-inline"><span class="koboSpan" id="kobo.703.1">ErrorBoundary</span></strong><span class="koboSpan" id="kobo.704.1"> component. </span><span class="koboSpan" id="kobo.704.2">One special case that can only be handled in the root </span><strong class="source-inline"><span class="koboSpan" id="kobo.705.1">ErrorBoundary</span></strong><span class="koboSpan" id="kobo.706.1"> component is the page-not-found exception thrown by Remix. </span><span class="koboSpan" id="kobo.706.2">Let’s revisit the root </span><a id="_idIndexMarker320"/><span class="koboSpan" id="kobo.707.1">error boundary to handle thrown responses at the </span><span class="No-Break"><span class="koboSpan" id="kobo.708.1">root level:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.709.1">Run BeeRich on localhost by executing </span><strong class="source-inline"><span class="koboSpan" id="kobo.710.1">npm </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.711.1">run dev</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.712.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.713.1">Visit a non-existing page such as </span><a href="http://localhost:3000/cheesecake"><span class="koboSpan" id="kobo.714.1">http://localhost:3000/cheesecake</span></a><span class="koboSpan" id="kobo.715.1"> in a new </span><span class="No-Break"><span class="koboSpan" id="kobo.716.1">browser window.</span></span><p class="list-inset"><span class="koboSpan" id="kobo.717.1">When visiting a non-existing route, Remix throws a response with HTTP status code 404 at the root level. </span><span class="koboSpan" id="kobo.717.2">We can use </span><strong class="source-inline"><span class="koboSpan" id="kobo.718.1">isRouteErrorResponse</span></strong><span class="koboSpan" id="kobo.719.1"> to render a 404 page using the root </span><span class="No-Break"><span class="koboSpan" id="kobo.720.1">error boundary.</span></span></p></li>
<li><span class="koboSpan" id="kobo.721.1">Open the </span><strong class="source-inline"><span class="koboSpan" id="kobo.722.1">root.tsx</span></strong><span class="koboSpan" id="kobo.723.1"> file in </span><span class="No-Break"><span class="koboSpan" id="kobo.724.1">an editor.</span></span></li>
<li><span class="koboSpan" id="kobo.725.1">Import </span><strong class="source-inline"><span class="koboSpan" id="kobo.726.1">isRouteErrorResponse</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.727.1">from Remix:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.728.1">
import {  </span><strong class="bold"><span class="koboSpan" id="kobo.729.1">isRouteErrorResponse</span></strong><span class="koboSpan" id="kobo.730.1">,  Links,  LiveReload,  Meta,  Outlet,  Scripts,  ScrollRestoration,  useRouteError,} from '@remix-run/react';</span></pre></li> <li><span class="koboSpan" id="kobo.731.1">Update the function body of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.732.1">ErrorBoundary</span></strong><span class="koboSpan" id="kobo.733.1"> export </span><span class="No-Break"><span class="koboSpan" id="kobo.734.1">in </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.735.1">root.tsx</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.736.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.737.1">
const error = useRouteError();let heading = 'Unexpected Error';let message =  'We are very sorry. </span><span class="koboSpan" id="kobo.737.2">An unexpected error occurred. </span><span class="koboSpan" id="kobo.737.3">Please try again or contact us if the problem persists.';if (</span><strong class="bold"><span class="koboSpan" id="kobo.738.1">isRouteErrorResponse(error)</span></strong><span class="koboSpan" id="kobo.739.1">) {  switch (error.status) {    </span><strong class="bold"><span class="koboSpan" id="kobo.740.1">case 401:</span></strong><span class="koboSpan" id="kobo.741.1">      heading = '401 Unauthorized';      message = 'Oops! </span><span class="koboSpan" id="kobo.741.2">Looks like you tried to visit a page that you do not have access to.';      break;    </span><strong class="bold"><span class="koboSpan" id="kobo.742.1">case 404:</span></strong><span class="koboSpan" id="kobo.743.1">      heading = '404 Not Found';      message = 'Oops! </span><span class="koboSpan" id="kobo.743.2">Looks like you tried to visit a page that does not exist.';      break;  }}let errorMessage = error instanceof Error ? </span><span class="koboSpan" id="kobo.743.3">error.message : null;</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.744.1">We now </span><a id="_idIndexMarker321"/><span class="koboSpan" id="kobo.745.1">create the error message dynamically </span><a id="_idIndexMarker322"/><span class="koboSpan" id="kobo.746.1">based on the response </span><span class="No-Break"><span class="koboSpan" id="kobo.747.1">status code.</span></span></p></li> <li><span class="koboSpan" id="kobo.748.1">Finally, replace the hardcoded </span><strong class="source-inline"><span class="koboSpan" id="kobo.749.1">H1</span></strong><span class="koboSpan" id="kobo.750.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.751.1">p</span></strong><span class="koboSpan" id="kobo.752.1"> texts with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.753.1">heading</span></strong><span class="koboSpan" id="kobo.754.1"> and </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.755.1">message</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.756.1"> values:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.757.1">
&lt;H1&gt;{</span><strong class="bold"><span class="koboSpan" id="kobo.758.1">heading</span></strong><span class="koboSpan" id="kobo.759.1">}&lt;/H1&gt;&lt;p&gt;{</span><strong class="bold"><span class="koboSpan" id="kobo.760.1">message</span></strong><span class="koboSpan" id="kobo.761.1">}&lt;/p&gt;{errorMessage &amp;&amp; (  &lt;div className="border-4 border-red-500 p-10"&gt;    &lt;p&gt;Error message: {errorMessage}&lt;/p&gt;  &lt;/div&gt;)}</span></pre></li> <li><span class="No-Break"><span class="koboSpan" id="kobo.762.1">Revisit </span></span><a href="http://localhost:3000/cheesecake"><span class="No-Break"><span class="koboSpan" id="kobo.763.1">http://localhost:3000/cheesecake</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.764.1">.</span></span><p class="list-inset"><span class="koboSpan" id="kobo.765.1">You </span><a id="_idIndexMarker323"/><span class="koboSpan" id="kobo.766.1">should now see the 404 not-found page</span><a id="_idIndexMarker324"/><span class="koboSpan" id="kobo.767.1"> shown in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.768.1">Figure 7</span></em></span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.769.1">.7</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.770.1">:</span></span></p></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer034">
<span class="koboSpan" id="kobo.771.1"><img alt="Figure 7.7 – Screenshot of BeeRich’s 404 page" src="image/Figure_07.7_B17399.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.772.1">Figure 7.7 – Screenshot of BeeRich’s 404 page</span></p>
<p><span class="koboSpan" id="kobo.773.1">Great! </span><span class="koboSpan" id="kobo.773.2">We’ve added root and nested error boundaries to BeeRich. </span><span class="koboSpan" id="kobo.773.3">Note that we can throw custom 404 responses in </span><strong class="source-inline"><span class="koboSpan" id="kobo.774.1">loader</span></strong><span class="koboSpan" id="kobo.775.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.776.1">action</span></strong><span class="koboSpan" id="kobo.777.1"> functions. </span><span class="koboSpan" id="kobo.777.2">Nested error boundaries can handle these thrown exceptions. </span><span class="koboSpan" id="kobo.777.3">Remix throws a root-level 404 response if the requested URL does not match any routes. </span><span class="koboSpan" id="kobo.777.4">Since the exception is thrown at the root level, we use the root error boundary to handle the global 404 not-found page </span><span class="No-Break"><span class="koboSpan" id="kobo.778.1">in Remix.</span></span></p>
<h1 id="_idParaDest-120"><a id="_idTextAnchor117"/><span class="koboSpan" id="kobo.779.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.780.1">In this chapter, you learned that Remix lets us handle both expected and unexpected failures declaratively using Remix’s </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.781.1">ErrorBoundary</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.782.1"> component.</span></span></p>
<p><span class="koboSpan" id="kobo.783.1">The root </span><strong class="source-inline"><span class="koboSpan" id="kobo.784.1">ErrorBoundary</span></strong><span class="koboSpan" id="kobo.785.1"> export handles thrown responses and errors if no other nested error boundary has handled them yet. </span><span class="koboSpan" id="kobo.785.2">Both errors and thrown responses bubble upward through the </span><span class="No-Break"><span class="koboSpan" id="kobo.786.1">route hierarchy.</span></span></p>
<p><span class="koboSpan" id="kobo.787.1">Then, you learned that error boundaries do not have access to loader data. </span><span class="koboSpan" id="kobo.787.2">It is important not to render any components in the boundaries that access the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.788.1">useLoaderData</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.789.1"> hook.</span></span></p>
<p><span class="koboSpan" id="kobo.790.1">Using error boundaries makes the application more resilient toward errors. </span><span class="koboSpan" id="kobo.790.2">Tight error boundaries keep parts of our application functional if an unexpected error only affects a nested </span><span class="No-Break"><span class="koboSpan" id="kobo.791.1">route module.</span></span></p>
<p><span class="koboSpan" id="kobo.792.1">In the next chapter, we will throw some more responses – 401 responses, to be precise – as we implement an authentication flow and learn more about state management </span><span class="No-Break"><span class="koboSpan" id="kobo.793.1">with Remix.</span></span></p>
<h1 id="_idParaDest-121"><a id="_idTextAnchor118"/><span class="koboSpan" id="kobo.794.1">Further reading</span></h1>
<p><span class="koboSpan" id="kobo.795.1">You can find a list of all HTTP status codes on </span><span class="No-Break"><span class="koboSpan" id="kobo.796.1">MDN: </span></span><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status"><span class="No-Break"><span class="koboSpan" id="kobo.797.1">https://developer.mozilla.org/en-US/docs/Web/HTTP/Status</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.798.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.799.1">If you want to learn more about exception and error handling, I recommend that you check out Shawn Wang's (</span><strong class="source-inline"><span class="koboSpan" id="kobo.800.1">@swyx</span></strong><span class="koboSpan" id="kobo.801.1">) blog post </span><em class="italic"><span class="koboSpan" id="kobo.802.1">Errors Are Not </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.803.1">Exceptions</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.804.1">: </span></span><a href="https://www.swyx.io/errors-not-exceptions"><span class="No-Break"><span class="koboSpan" id="kobo.805.1">https://www.swyx.io/errors-not-exceptions</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.806.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.807.1">You can find more information about the </span><strong class="source-inline"><span class="koboSpan" id="kobo.808.1">ErrorBoundary</span></strong><span class="koboSpan" id="kobo.809.1"> route module export in the Remix </span><span class="No-Break"><span class="koboSpan" id="kobo.810.1">documentation: </span></span><a href="https://remix.run/docs/en/2/route/error-boundary"><span class="No-Break"><span class="koboSpan" id="kobo.811.1">https://remix.run/docs/en/2/route/error-boundary</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.812.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.813.1">The Remix docs also contain a guide with more information about not-found error handling, which you can find </span><span class="No-Break"><span class="koboSpan" id="kobo.814.1">here: </span></span><a href="https://remix.run/docs/en/2/guides/not-found"><span class="No-Break"><span class="koboSpan" id="kobo.815.1">https://remix.run/docs/en/2/guides/not-found</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.816.1">.</span></span></p>
</div>
</body></html>