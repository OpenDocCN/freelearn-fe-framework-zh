<html><head></head><body>
<div class="Basic-Text-Frame" id="_idContainer238">
<h1 class="chapterNumber"><span class="koboSpan" id="kobo.1.1">11</span></h1>
<h1 class="chapterTitle" id="_idParaDest-374"><span class="koboSpan" id="kobo.2.1">E2E Tests in Angular with Cypress</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.3.1">An app having a couple of </span><strong class="keyWord"><span class="koboSpan" id="kobo.4.1">End-to-End</span></strong><span class="koboSpan" id="kobo.5.1"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.6.1">E2E</span></strong><span class="koboSpan" id="kobo.7.1">) tests surely promises more reliability than an app having no tests</span><a id="_idIndexMarker885"/><span class="koboSpan" id="kobo.8.1"> at all, and in today’s world, with emerging businesses and complex applications, it becomes essential at some point to have E2E tests written to capture the entire flow of an application. </span><span class="koboSpan" id="kobo.8.2">Cypress is one of the best tools out there today when it comes to E2E tests for web applications. </span><span class="koboSpan" id="kobo.8.3">In this chapter, you’ll learn how to test your E2E flows in an Angular app with Cypress. </span><span class="koboSpan" id="kobo.8.4">Here are the recipes we’re going to cover in this chapter:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.9.1">Writing your first Cypress test</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.10.1">Validating if a DOM element is visible on the view</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.11.1">Testing form inputs and submission</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.12.1">Waiting for </span><strong class="keyWord"><span class="koboSpan" id="kobo.13.1">XMLHttpRequests</span></strong><span class="koboSpan" id="kobo.14.1"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.15.1">XHRs</span></strong><span class="koboSpan" id="kobo.16.1">) to finish</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.17.1">Using Cypress bundled packages</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.18.1">Using Cypress fixtures to provide mock data</span></li>
</ul>
<h1 class="heading-1" id="_idParaDest-375"><span class="koboSpan" id="kobo.19.1">Technical requirements</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.20.1">For the recipes in this chapter, ensure your setup is complete as per the 'Technical Requirements' in the 'Angular-Cookbook-2E' GitHub repository. </span><span class="koboSpan" id="kobo.20.2">For setup details, visit: </span><a href="https://github.com/PacktPublishing/Angular-Cookbook-2E/tree/main/docs/technical-requirements.md"><span class="url"><span class="koboSpan" id="kobo.21.1">https://github.com/PacktPublishing/Angular-Cookbook-2E/tree/main/docs/technical-requirements.md</span></span></a><span class="koboSpan" id="kobo.22.1">. </span><span class="koboSpan" id="kobo.22.2">The starter code for this chapter is located at </span><a href="https://github.com/PacktPublishing/Angular-Cookbook-2E/tree/main/start/apps/chapter11"><span class="url"><span class="koboSpan" id="kobo.23.1">https://github.com/PacktPublishing/Angular-Cookbook-2E/tree/main/start/apps/chapter11</span></span></a><span class="koboSpan" id="kobo.24.1">.</span></p>
<h1 class="heading-1" id="_idParaDest-376"><span class="koboSpan" id="kobo.25.1">Writing your first Cypress test</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.26.1">If you have been writing E2E tests</span><a id="_idIndexMarker886"/><span class="koboSpan" id="kobo.27.1"> already, you might have been doing this using Protractor. </span><span class="koboSpan" id="kobo.27.2">Working with Cypress is a completely different experience, though. </span><span class="koboSpan" id="kobo.27.3">In this recipe, you’ll set up Cypress with an existing Angular application and write your first E2E test with Cypress.</span></p>
<h2 class="heading-2" id="_idParaDest-377"><span class="koboSpan" id="kobo.28.1">Getting ready</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.29.1">The app that we are going to work with resides in </span><code class="inlineCode"><span class="koboSpan" id="kobo.30.1">start/apps/chapter11/ng-cypress-starter</span></code><span class="koboSpan" id="kobo.31.1"> inside the cloned repository:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.32.1">Open the code repository in your code editor.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.33.1">Open the terminal, navigate to the code repository directory, and run the following command to serve the project:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.34.1">npm run serve ng-cypress-starter
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.35.1">This should open the app in a new browser tab, and you should see the following:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.36.1"><img alt="" role="presentation" src="../Images/B18469_11_01.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.37.1">Figure 11.1: ng-cypress-starter app running on localhost:4200</span></p> </li>
</ol>
<h2 class="heading-2" id="_idParaDest-378"><span class="koboSpan" id="kobo.38.1">How to do it…</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.39.1">The app we’re working with is a simple counter application. </span><span class="koboSpan" id="kobo.39.2">It has minimum and maximum values and some buttons that can increment, decrement, and reset the counter’s value. </span><span class="koboSpan" id="kobo.39.3">We’ll start by configuring Cypress for our application and will then move toward writing the test:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.40.1">Since we’re using an NX workspace, the setup here looks different from a regular Angular application. </span><span class="koboSpan" id="kobo.40.2">Open a new terminal window/tab and make sure you’re inside the workspace’s root folder. </span><span class="koboSpan" id="kobo.40.3">Once inside, run the following command to install </span><strong class="keyWord"><span class="koboSpan" id="kobo.41.1">Cypress</span></strong><span class="koboSpan" id="kobo.42.1"> in our project:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.43.1">cd start &amp;&amp; npm install --save-dev @nx/cypress
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.44.1">Now, run the following command</span><a id="_idIndexMarker887"/><span class="koboSpan" id="kobo.45.1"> from the workspace’s root folder to create a </span><code class="inlineCode"><span class="koboSpan" id="kobo.46.1">cypress</span></code><span class="koboSpan" id="kobo.47.1"> project for the app as follows:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.48.1">cd start &amp;&amp; nx g @nx/cypress:cypress-project ng-cypress-starter-e2e --project=ng-cypress-starter --directory apps/chapter11/ng-cypress-starter-e2e
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.49.1">When (or if) asked, choose the </span><code class="inlineCode"><span class="koboSpan" id="kobo.50.1">Vite</span></code><span class="koboSpan" id="kobo.51.1"> bundler for Cypress during the installation since Vite is a faster bundler and provides a faster development server as well. </span><span class="koboSpan" id="kobo.51.2">And select the “Ap provided” so we have the folder </span><code class="inlineCode"><span class="koboSpan" id="kobo.52.1">ng-cy-starter-e2e</span></code><span class="koboSpan" id="kobo.53.1"> created in </span><code class="inlineCode"><span class="koboSpan" id="kobo.54.1">start/apps/chapter11</span></code><span class="koboSpan" id="kobo.55.1"> folder. </span><span class="koboSpan" id="kobo.55.2">You’ll see that a new folder named </span><code class="inlineCode"><span class="koboSpan" id="kobo.56.1">ng-cypress-starter-e2e</span></code><span class="koboSpan" id="kobo.57.1"> will be created inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.58.1">start/apps</span></code><span class="koboSpan" id="kobo.59.1"> folder.</span></p></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="3"><span class="koboSpan" id="kobo.60.1">Let us run a script to rename our app from </span><code class="inlineCode"><span class="koboSpan" id="kobo.61.1">chapter11-ng-cypress-starter-e2e</span></code><span class="koboSpan" id="kobo.62.1"> to </span><code class="inlineCode"><span class="koboSpan" id="kobo.63.1">ng-cypress-starter-e2e</span></code><span class="koboSpan" id="kobo.64.1">. </span><span class="koboSpan" id="kobo.64.2">This will make it easier for us to run the </span><code class="inlineCode"><span class="koboSpan" id="kobo.65.1">e2e</span></code><span class="koboSpan" id="kobo.66.1"> tests for this recipe and the next. </span><span class="koboSpan" id="kobo.66.2">Use the following command from the workspace’s root folder:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.67.1">node scripts/rename-app.js chapter11 ng-cypress-starter-e2e start
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.68.1">Now you can run the following command to start the Cypress tests from the workspace’s root folder (outside of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.69.1">start</span></code><span class="koboSpan" id="kobo.70.1"> folder):
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.71.1">npm run e2e ng-cypress-starter
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.72.1">You should be able to use a browser to start running the tests. </span><span class="koboSpan" id="kobo.72.2">I will be using Chrome as the browser for </span><code class="inlineCode"><span class="koboSpan" id="kobo.73.1">e2e</span></code><span class="koboSpan" id="kobo.74.1"> tests in this book.</span></p></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="5"><span class="koboSpan" id="kobo.75.1">Click the </span><code class="inlineCode"><span class="koboSpan" id="kobo.76.1">app.cy.ts</span></code><span class="koboSpan" id="kobo.77.1"> in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.78.1">cypress-chrome</span></code><span class="koboSpan" id="kobo.79.1"> window (the browser window opened as a result of </span><em class="italic"><span class="koboSpan" id="kobo.80.1">step 4</span></em><span class="koboSpan" id="kobo.81.1">) to run the default-created tests. </span><span class="koboSpan" id="kobo.81.2">We will be modifying this file in the recipe to write our own tests. </span><span class="koboSpan" id="kobo.81.3">Once you run the tests, you’ll see them failing. </span><span class="koboSpan" id="kobo.81.4">But do not worry about it since we have not written our own tests.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.82.1">Let us create our first test now. </span><span class="koboSpan" id="kobo.82.2">We will just check whether the title in the header of our app says </span><code class="inlineCode"><span class="koboSpan" id="kobo.83.1">Your first Cypress test in Angular</span></code><span class="koboSpan" id="kobo.84.1">. </span><span class="koboSpan" id="kobo.84.2">Let us replace the entire content of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.85.1">src/e2e/support/app.po.ts</span></code><span class="koboSpan" id="kobo.86.1"> file by creating a </span><strong class="keyWord"><span class="koboSpan" id="kobo.87.1">PO </span></strong><span class="koboSpan" id="kobo.88.1">(</span><strong class="keyWord"><span class="koboSpan" id="kobo.89.1">Page Object</span></strong><span class="koboSpan" id="kobo.90.1">) in the file as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.91.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.92.1">const</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.93.1">getHeaderTitle</span></span><span class="koboSpan" id="kobo.94.1"> = () =&gt;
</span><span class="hljs-keyword"> </span><span class="koboSpan" id="kobo.95.1"> cy.</span><span class="hljs-title"><span class="koboSpan" id="kobo.96.1">get</span></span><span class="koboSpan" id="kobo.97.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.98.1">'.toolbar__title'</span></span><span class="koboSpan" id="kobo.99.1">);
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.100.1">We will now import</span><a id="_idIndexMarker888"/><span class="koboSpan" id="kobo.101.1"> the </span><code class="inlineCode"><span class="koboSpan" id="kobo.102.1">getHeaderTitle</span></code><span class="koboSpan" id="kobo.103.1"> in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.104.1">src/e2e/app.cy.ts</span></code><span class="koboSpan" id="kobo.105.1"> file and replace the first test as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.106.1">import</span></span><span class="koboSpan" id="kobo.107.1"> { getHeaderTitle } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.108.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.109.1">'../support/app.po'</span></span><span class="koboSpan" id="kobo.110.1">;
 
</span><span class="hljs-title"><span class="koboSpan" id="kobo.111.1">describe</span></span><span class="koboSpan" id="kobo.112.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.113.1">'ng-cypress-starter'</span></span><span class="koboSpan" id="kobo.114.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.115.1">() =&gt;</span></span><span class="koboSpan" id="kobo.116.1"> {
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.117.1">beforeEach</span></span><span class="koboSpan" id="kobo.118.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.119.1">() =&gt;</span></span><span class="koboSpan" id="kobo.120.1"> cy.</span><span class="hljs-title"><span class="koboSpan" id="kobo.121.1">visit</span></span><span class="koboSpan" id="kobo.122.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.123.1">'/'</span></span><span class="koboSpan" id="kobo.124.1">));
 
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.125.1">it</span></span><span class="koboSpan" id="kobo.126.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.127.1">'should display the correct header title'</span></span><span class="koboSpan" id="kobo.128.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.129.1">() =&gt;</span></span><span class="koboSpan" id="kobo.130.1"> {
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.131.1">getHeaderTitle</span></span><span class="koboSpan" id="kobo.132.1">().</span><span class="hljs-title"><span class="koboSpan" id="kobo.133.1">should</span></span><span class="koboSpan" id="kobo.134.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.135.1">'contain.text'</span></span><span class="koboSpan" id="kobo.136.1">,</span><span class="hljs-string"><span class="koboSpan" id="kobo.137.1">'Your first</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.138.1">Cypress test in Angular'</span></span><span class="koboSpan" id="kobo.139.1">);
  });
});
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.140.1">If you look again at the Cypress window, you should see the test passing as follows:
    </span><figure class="mediaobject"><span class="koboSpan" id="kobo.141.1"><img alt="" role="presentation" src="../Images/B18469_11_02.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.142.1">Figure 11.2: Our first Cypress test passes</span></p></li>
</ol>
<p class="normal"><em class="italic"><span class="koboSpan" id="kobo.143.1">Easy, right?</span></em><span class="koboSpan" id="kobo.144.1"> Now that you know how to configure Cypress for an Angular app (especially in NX), see the next section to understand how it works.</span></p>
<h2 class="heading-2" id="_idParaDest-379"><span class="koboSpan" id="kobo.145.1">How it works…</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.146.1">Cypress can be integrated</span><a id="_idIndexMarker889"/><span class="koboSpan" id="kobo.147.1"> with absolutely any framework and web development project. </span><span class="koboSpan" id="kobo.147.2">One interesting fact is that Cypress uses Mocha as the test runner behind the scenes. </span><span class="koboSpan" id="kobo.147.3">The tooling for Cypress watches for code changes so that you do not have to recompile the tests repeatedly. </span><span class="koboSpan" id="kobo.147.4">Cypress also adds a shell around the application being tested to capture logs and access DOM elements during the tests, and some functionality for debugging tests.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.148.1">At the very top of our </span><code class="inlineCode"><span class="koboSpan" id="kobo.149.1">app.cy.ts</span></code><span class="koboSpan" id="kobo.150.1"> file, we use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.151.1">describe</span></code><span class="koboSpan" id="kobo.152.1"> method, which defines the test suite, defining the context of the tests about to be written inside. </span><span class="koboSpan" id="kobo.152.2">Then, we use a </span><code class="inlineCode"><span class="koboSpan" id="kobo.153.1">beforeEach</span></code><span class="koboSpan" id="kobo.154.1"> method to specify what should happen before each test is executed. </span><span class="koboSpan" id="kobo.154.2">Since each test starts with no data, we first must make sure that Cypress navigates to our application’s URL: </span><code class="inlineCode"><span class="koboSpan" id="kobo.155.1">http://localhost:4200</span></code><span class="koboSpan" id="kobo.156.1">. </span><span class="koboSpan" id="kobo.156.2">The reason we just specify </span><code class="inlineCode"><span class="koboSpan" id="kobo.157.1">cy.visit('/')</span></code><span class="koboSpan" id="kobo.158.1"> and it still works is that NX automagically configures it with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.159.1">@nx/cypress</span></code><span class="koboSpan" id="kobo.160.1"> package. </span><span class="koboSpan" id="kobo.160.2">If you add Cypress to a standard Angular app (not in an NX workspace), you will have to specify the </span><code class="inlineCode"><span class="koboSpan" id="kobo.161.1">baseUrl</span></code><span class="koboSpan" id="kobo.162.1"> in the Cypress config file (</span><code class="inlineCode"><span class="koboSpan" id="kobo.163.1">cypress.config.ts</span></code><span class="koboSpan" id="kobo.164.1">) as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.165.1">import</span></span><span class="koboSpan" id="kobo.166.1"> { defineConfig } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.167.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.168.1">'cypress'</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.169.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.170.1">default</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.171.1">defineConfig</span></span><span class="koboSpan" id="kobo.172.1">({
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.173.1">e2e</span></span><span class="koboSpan" id="kobo.174.1">: {
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.175.1">baseUrl</span></span><span class="koboSpan" id="kobo.176.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.177.1">'http://localhost:4200'</span></span><span class="koboSpan" id="kobo.178.1">,
  },
})
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.179.1">However, NX does this for us for the recipes of this book. </span><span class="koboSpan" id="kobo.179.2">Therefore, we just have to provide relative URLs in our tests.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.180.1">For each of our tests, we use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.181.1">it</span></code><span class="koboSpan" id="kobo.182.1"> method to specify the title for them. </span><span class="koboSpan" id="kobo.182.2">You will notice that in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.183.1">app.cy.ts</span></code><span class="koboSpan" id="kobo.184.1"> file, we are importing</span><a id="_idIndexMarker890"/><span class="koboSpan" id="kobo.185.1"> the </span><code class="inlineCode"><span class="koboSpan" id="kobo.186.1">getHeaderTitle</span></code><span class="koboSpan" id="kobo.187.1"> method from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.188.1">support/app.po</span></code><span class="koboSpan" id="kobo.189.1"> file. </span><span class="koboSpan" id="kobo.189.2">As mentioned earlier in the recipe, </span><strong class="keyWord"><span class="koboSpan" id="kobo.190.1">PO</span></strong><span class="koboSpan" id="kobo.191.1"> means </span><strong class="keyWord"><span class="koboSpan" id="kobo.192.1">page object</span></strong><span class="koboSpan" id="kobo.193.1">. </span><span class="koboSpan" id="kobo.193.2">This is a widespread practice to use these objects to contain functions that return </span><strong class="keyWord"><span class="koboSpan" id="kobo.194.1">Document Object Module</span></strong><span class="koboSpan" id="kobo.195.1"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.196.1">DOM</span></strong><span class="koboSpan" id="kobo.197.1">) elements. </span><span class="koboSpan" id="kobo.197.2">This keeps our tests clear of code that interacts with the DOM to retrieve elements, and we have reusable functions for our tests. </span><span class="koboSpan" id="kobo.197.3">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.198.1">app.po</span></code><span class="koboSpan" id="kobo.199.1"> file, you can see that we use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.200.1">cy.get</span></code><span class="koboSpan" id="kobo.201.1"> method to retrieve a single element that has the class </span><code class="inlineCode"><span class="koboSpan" id="kobo.202.1">toolbar__title</span></code><span class="koboSpan" id="kobo.203.1"> applied to it. </span><span class="koboSpan" id="kobo.203.2">All the Angular applications for the recipes in this book have a header and a title that shows what the recipe is about. </span><span class="koboSpan" id="kobo.203.3">Notice that in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.204.1">app.cy.ts</span></code><span class="koboSpan" id="kobo.205.1"> file, we use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.206.1">getHeaderTitle</span></code><span class="koboSpan" id="kobo.207.1"> method to get the target element from our HTML page. </span><span class="koboSpan" id="kobo.207.2">And then we use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.208.1">should()</span></code><span class="koboSpan" id="kobo.209.1"> method to compare the text of the title with the expected value </span><code class="inlineCode"><span class="koboSpan" id="kobo.210.1">Your first Cypress test in Angular</span></code><span class="koboSpan" id="kobo.211.1">. </span><span class="koboSpan" id="kobo.211.2">Notice that we are using ‘</span><code class="inlineCode"><span class="koboSpan" id="kobo.212.1">contain.text</span></code><span class="koboSpan" id="kobo.213.1">' instead of </span><code class="inlineCode"><span class="koboSpan" id="kobo.214.1">'have.text'</span></code><span class="koboSpan" id="kobo.215.1"> because there can be whitespace in the target element. </span><span class="koboSpan" id="kobo.215.2">The following are some other examples of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.216.1">should</span></code><span class="koboSpan" id="kobo.217.1"> method with some different statements:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.218.1">should('be.visible')</span></code></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.219.1">should('be.empty')</span></code></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.220.1">should('be.visible')</span></code></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.221.1">should('have.class''my-class')</span></code></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.222.1">should('have.id''newUserId')</span></code></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.223.1">should('be.visible')</span></code></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.224.1">should('have.focus')</span></code></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.225.1">Now that you understand</span><a id="_idIndexMarker891"/><span class="koboSpan" id="kobo.226.1"> how the recipe works, see the next section for some useful links.</span></p>
<h2 class="heading-2" id="_idParaDest-380"><span class="koboSpan" id="kobo.227.1">See also</span></h2>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.228.1">cy.get</span></code> <a id="_idIndexMarker892"/><span class="koboSpan" id="kobo.229.1">documentation: </span><a href="https://docs.cypress.io/api/commands/get"><span class="url"><span class="koboSpan" id="kobo.230.1">https://docs.cypress.io/api/commands/get</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.231.1">Cypress</span><a id="_idIndexMarker893"/><span class="koboSpan" id="kobo.232.1"> documentation – W</span><em class="italic"><span class="koboSpan" id="kobo.233.1">riting Your First Test</span></em><span class="koboSpan" id="kobo.234.1">: </span><a href="https://docs.cypress.io/guides/getting-started/writing-your-first-test.html"><span class="url"><span class="koboSpan" id="kobo.235.1">https://docs.cypress.io/guides/getting-started/writing-your-first-test.html</span></span></a></li>
</ul>
<h1 class="heading-1" id="_idParaDest-381"><span class="koboSpan" id="kobo.236.1">Validating if a DOM element is visible on the view</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.237.1">In most web applications, there</span><a id="_idIndexMarker894"/><span class="koboSpan" id="kobo.238.1"> is at least one element/view that is shown based on a certain condition. </span><span class="koboSpan" id="kobo.238.2">Otherwise, it is hidden. </span><span class="koboSpan" id="kobo.238.3">When it comes to making sure the end users see the right content in the right situations, it becomes necessary to test them well. </span><span class="koboSpan" id="kobo.238.4">In this recipe, you are going to learn how to check if an element is visible on the DOM.</span></p>
<h2 class="heading-2" id="_idParaDest-382"><span class="koboSpan" id="kobo.239.1">Getting ready</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.240.1">The app that we are going to work with resides in </span><code class="inlineCode"><span class="koboSpan" id="kobo.241.1">start/apps/chapter11/ng-cy-element-visibility</span></code><span class="koboSpan" id="kobo.242.1"> inside the cloned repository. </span><span class="koboSpan" id="kobo.242.2">However, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.243.1">e2e</span></code><span class="koboSpan" id="kobo.244.1"> tests are in the folder </span><code class="inlineCode"><span class="koboSpan" id="kobo.245.1">start/apps/chapter11/ng-cy-element-visibility-e2e</span></code><span class="koboSpan" id="kobo.246.1">. </span><span class="koboSpan" id="kobo.246.2">In this recipe, we are going to modify files in both folders. </span><span class="koboSpan" id="kobo.246.3">Let’s run the e2e tests first by following these steps:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.247.1">Open the code repository in your code editor.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.248.1">Open the terminal, navigate to the code repository directory, and run the following command to run the e2e tests for the project:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.249.1">npm run e2e ng-cy-element-visibility
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.250.1">This should open the Cypress</span><a id="_idIndexMarker895"/><span class="koboSpan" id="kobo.251.1"> window. </span><span class="koboSpan" id="kobo.251.2">Select Chrome for testing and click the </span><code class="inlineCode"><span class="koboSpan" id="kobo.252.1">app.cy.ts</span></code><span class="koboSpan" id="kobo.253.1"> file to run the tests and you should see the following:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.254.1"><img alt="" role="presentation" src="../Images/B18469_11_03.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.255.1">Figure 11.3: Cypress tests running for the ng-cy-element-visibility app</span></p></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.256.1">Now that we have the app and the Cypress tests running locally, let us see the steps of the recipe in the next section.</span></p>
<h2 class="heading-2" id="_idParaDest-383"><span class="koboSpan" id="kobo.257.1">How to do it…</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.258.1">We have the same old counter app from the previous recipe. </span><span class="koboSpan" id="kobo.258.2">However, some things have changed. </span><span class="koboSpan" id="kobo.258.3">We now have a button at the top that toggles the visibility of the counter component </span><code class="inlineCode"><span class="koboSpan" id="kobo.259.1">(CounterComponent)</span></code><span class="koboSpan" id="kobo.260.1">. </span><span class="koboSpan" id="kobo.260.2">Also, we must hover over the counter card to see the </span><strong class="screenText"><span class="koboSpan" id="kobo.261.1">Increment</span></strong><span class="koboSpan" id="kobo.262.1">, </span><strong class="screenText"><span class="koboSpan" id="kobo.263.1">Decrement</span></strong><span class="koboSpan" id="kobo.264.1">, and </span><strong class="screenText"><span class="koboSpan" id="kobo.265.1">Reset</span></strong><span class="koboSpan" id="kobo.266.1"> action buttons.</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.267.1">Let’s create the page objects necessary for our tests. </span><span class="koboSpan" id="kobo.267.2">We’ll create functions to return the toggle button and the counter card from the page object </span><code class="inlineCode"><span class="koboSpan" id="kobo.268.1">app.po.ts</span></code><span class="koboSpan" id="kobo.269.1"> file. </span><span class="koboSpan" id="kobo.269.2">Update the </span><code class="inlineCode"><span class="koboSpan" id="kobo.270.1">src/support/app.po.ts</span></code><span class="koboSpan" id="kobo.271.1"> file in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.272.1">start/apps/chapter11/ng-cy-element-visibility-e2e</span></code><span class="koboSpan" id="kobo.273.1"> folder as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.274.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.275.1">const</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.276.1">getHeaderTitle</span></span><span class="koboSpan" id="kobo.277.1"> = () =&gt;
</span><span class="hljs-keyword"> </span><span class="koboSpan" id="kobo.278.1">cy.</span><span class="hljs-title"><span class="koboSpan" id="kobo.279.1">get</span></span><span class="koboSpan" id="kobo.280.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.281.1">'.toolbar__title'</span></span><span class="koboSpan" id="kobo.282.1">);
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.283.1">export</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.284.1">const</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.285.1">getToggleCounterButton</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.286.1"> = () =&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.287.1">cy.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.288.1">get</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.289.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.290.1">'[data-test-id="toggleCounterBtn"]'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.291.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.292.1">export</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.293.1">const</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.294.1">getCounterCard</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.295.1"> = () =&gt; cy.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.296.1">get</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.297.1">(</span></strong></span>
<span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.298.1">'[data-test-id="counterCard"]'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.299.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.300.1">export</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.301.1">const</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.302.1">getCounterActions</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.303.1"> = () =&gt; </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.304.1">getCounterCard</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.305.1">()</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.306.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.307.1">find</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.308.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.309.1">'button'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.310.1">);</span></strong></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.311.1">Let’s add the relevant</span><a id="_idIndexMarker896"/><span class="koboSpan" id="kobo.312.1"> test IDs now to the HTML. </span><span class="koboSpan" id="kobo.312.2">We’ll add the </span><code class="inlineCode"><span class="koboSpan" id="kobo.313.1">test-id</span></code><span class="koboSpan" id="kobo.314.1"> attributes for both the toggle-counter button and the counter element. </span><span class="koboSpan" id="kobo.314.2">Modify the file </span><code class="inlineCode"><span class="koboSpan" id="kobo.315.1">ng-cy-element-visibility/src/app/app.component.html</span></code><span class="koboSpan" id="kobo.316.1"> as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.317.1">...
</span><span class="hljs-tag"><span class="koboSpan" id="kobo.318.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.319.1">main</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.320.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.321.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.322.1">"content"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.323.1">role</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.324.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.325.1">"main"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.326.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.327.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.328.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.329.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.330.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.331.1">"..."</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.332.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.333.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.334.1">button</span></span><span class="hljs-tag"> </span><span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.335.1">data-test-id</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.336.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.337.1">"toggleCounterBtn"</span></strong></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.338.1"> (</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.339.1">click</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.340.1">)=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.341.1">"toggleCounterVisibility()"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.342.1">&gt;</span></span><span class="koboSpan" id="kobo.343.1">Toggle Counter
        Visibility</span><span class="hljs-tag"><span class="koboSpan" id="kobo.344.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.345.1">button</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.346.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.347.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.348.1">app-counter</span></span><span class="hljs-tag"> </span><span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.349.1">data-test-id</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.350.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.351.1">"counterCard"</span></strong></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.352.1">*</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.353.1">ngIf</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.354.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.355.1">"visibility ===</span></span>
<span class="hljs-tag"> </span><span class="hljs-string"><span class="koboSpan" id="kobo.356.1"> visibilityOptions.Visible"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.357.1">&gt;&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.358.1">app-counter</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.359.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.360.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.361.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.362.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.363.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.364.1">main</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.365.1">&gt;</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.366.1">Now, we will write a test to ensure that our counter card is shown and hidden when we click the toggle-counter button. </span><span class="koboSpan" id="kobo.366.2">To do this, update the </span><code class="inlineCode"><span class="koboSpan" id="kobo.367.1">ng-cy-element-visibility-e2e/src/e2e/app.cy.ts</span></code><span class="koboSpan" id="kobo.368.1"> file as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.369.1">import</span></span><span class="koboSpan" id="kobo.370.1"> { </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.371.1">getCounterCard</span></strong></span><span class="koboSpan" id="kobo.372.1">, getHeaderTitle, </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.373.1">getToggleCounterButton </span></strong></span><span class="koboSpan" id="kobo.374.1">} </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.375.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.376.1">'../support/app.po'</span></span><span class="koboSpan" id="kobo.377.1">;
</span><span class="hljs-title"><span class="koboSpan" id="kobo.378.1">describe</span></span><span class="koboSpan" id="kobo.379.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.380.1">'ng-cypress-starter'</span></span><span class="koboSpan" id="kobo.381.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.382.1">() =&gt;</span></span><span class="koboSpan" id="kobo.383.1"> {
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.384.1">beforeEach</span></span><span class="koboSpan" id="kobo.385.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.386.1">() =&gt;</span></span><span class="koboSpan" id="kobo.387.1"> cy.</span><span class="hljs-title"><span class="koboSpan" id="kobo.388.1">visit</span></span><span class="koboSpan" id="kobo.389.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.390.1">'/'</span></span><span class="koboSpan" id="kobo.391.1">));
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.392.1">it</span></span><span class="koboSpan" id="kobo.393.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.394.1">'should display the correct header title'</span></span><span class="koboSpan" id="kobo.395.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.396.1">() =&gt;</span></span><span class="koboSpan" id="kobo.397.1"> ...});
  </span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.398.1">it</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.399.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.400.1">'should toggle visibility of counter card when the</span></strong></span>
<span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.401.1">toggle button is clicked'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.402.1">, </span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.403.1">() =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.404.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.405.1">getCounterCard</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.406.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.407.1">should</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.408.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.409.1">'</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.410.1">exist'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.411.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.412.1">getToggleCounterButton</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.413.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.414.1">click</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.415.1">();</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.416.1">getCounterCard</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.417.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.418.1">should</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.419.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.420.1">'not.exist'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.421.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.422.1">getToggleCounterButton</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.423.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.424.1">click</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.425.1">();</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.426.1">getCounterCard</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.427.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.428.1">should</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.429.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.430.1">'exist'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.431.1">);</span></strong></span><span class="koboSpan" id="kobo.432.1">
  }</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.433.1">);</span></strong></span><span class="koboSpan" id="kobo.434.1">
});
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.435.1">Now, we’ll write another test to check if our action buttons (</span><code class="inlineCode"><span class="koboSpan" id="kobo.436.1">Increment</span></code><span class="koboSpan" id="kobo.437.1">,</span><strong class="keyWord"> </strong><code class="inlineCode"><span class="koboSpan" id="kobo.438.1">Decrement</span></code><span class="koboSpan" id="kobo.439.1">,</span><strong class="keyWord"> </strong><span class="koboSpan" id="kobo.440.1">and</span><strong class="keyWord"> </strong><code class="inlineCode"><span class="koboSpan" id="kobo.441.1">Reset</span></code><span class="koboSpan" id="kobo.442.1">) show up when</span><a id="_idIndexMarker897"/><span class="koboSpan" id="kobo.443.1"> we hover over the </span><code class="inlineCode"><span class="koboSpan" id="kobo.444.1">Counter</span></code><span class="koboSpan" id="kobo.445.1"> component. </span><span class="koboSpan" id="kobo.445.2">Update the </span><code class="inlineCode"><span class="koboSpan" id="kobo.446.1">app.cy.ts</span></code><span class="koboSpan" id="kobo.447.1"> file again, as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.448.1">import</span></span><span class="koboSpan" id="kobo.449.1"> { </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.450.1">getCounterActions</span></strong></span><span class="koboSpan" id="kobo.451.1">, getCounterCard, getHeaderTitle, getToggleCounterButton } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.452.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.453.1">'../support/app.po'</span></span><span class="koboSpan" id="kobo.454.1">;
</span><span class="hljs-title"><span class="koboSpan" id="kobo.455.1">describe</span></span><span class="koboSpan" id="kobo.456.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.457.1">'ng-cypress-starter'</span></span><span class="koboSpan" id="kobo.458.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.459.1">() =&gt;</span></span><span class="koboSpan" id="kobo.460.1"> {
  ...
  </span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.461.1">it</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.462.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.463.1">'should show the action buttons when the counter card is hovered'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.464.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.465.1">() =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.466.1"> { </span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.467.1">getCounterCard</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.468.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.469.1">trigger</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.470.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.471.1">'mouseover'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.472.1">); </span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.473.1">getCounterActions</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.474.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.475.1">should</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.476.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.477.1">'have.length'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.478.1">, </span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.479.1">3</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.480.1">); </span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.481.1">getCounterActions</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.482.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.483.1">contains</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.484.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.485.1">'Increment'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.486.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.487.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.488.1">should</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.489.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.490.1">'be.visible'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.491.1">); </span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.492.1">getCounterActions</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.493.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.494.1">contains</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.495.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.496.1">'Decrement'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.497.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.498.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.499.1">should</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.500.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.501.1">'be.visible'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.502.1">); </span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.503.1">getCounterActions</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.504.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.505.1">contains</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.506.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.507.1">'Reset'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.508.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.509.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.510.1">should</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.511.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.512.1">'be.visible'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.513.1">); </span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.514.1">});</span></strong></span><span class="koboSpan" id="kobo.515.1">
});
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.516.1">If you look at the Cypress window now, you should see the test failing, as follows:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.517.1"><img alt="" role="presentation" src="../Images/B18469_11_04.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.518.1">Figure 11.4: Unable to get action buttons on hovering</span></p>
<p class="normal"><span class="koboSpan" id="kobo.519.1">The reason for the test’s failure is that Cypress does not currently provide a </span><strong class="keyWord"><span class="koboSpan" id="kobo.520.1">CSS</span></strong><span class="koboSpan" id="kobo.521.1"> hover effect. </span><span class="koboSpan" id="kobo.521.2">To work around this, we will install a package in the next step.</span></p></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="5"><span class="koboSpan" id="kobo.522.1">Stop running the e2e tests</span><a id="_idIndexMarker898"/><span class="koboSpan" id="kobo.523.1"> and then install the </span><code class="inlineCode"><span class="koboSpan" id="kobo.524.1">cypress-real-events</span></code><span class="koboSpan" id="kobo.525.1"> package, as follows from the workspace’s root folder:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.526.1">cd start &amp;&amp; npm install --save-dev cypress-real-events
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.527.1">Now, open the </span><code class="inlineCode"><span class="koboSpan" id="kobo.528.1">src/support/e2e.ts</span></code><span class="koboSpan" id="kobo.529.1"> file in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.530.1">ng-cy-element-visibility-e2e</span></code><span class="koboSpan" id="kobo.531.1"> project and update it, as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.532.1">...
</span><span class="hljs-comment"><span class="koboSpan" id="kobo.533.1">// Import commands.js using ES2015 syntax:</span></span>
<span class="code-highlight"><strong class="hljs-comment-slc"><span class="koboSpan" id="kobo.534.1">/// &lt;reference types="cypress-real-events" /&gt;</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.535.1">import</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.536.1">'./commands'</span></span><span class="koboSpan" id="kobo.537.1">;
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.538.1">import</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.539.1">'cypress-real-events/support'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.540.1">;</span></strong></span><span class="koboSpan" id="kobo.541.1">
...
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.542.1">Now, update the </span><code class="inlineCode"><span class="koboSpan" id="kobo.543.1">app.cy.ts</span></code><span class="koboSpan" id="kobo.544.1"> file to use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.545.1">realHover</span></code><span class="koboSpan" id="kobo.546.1"> method from the package on the </span><code class="inlineCode"><span class="koboSpan" id="kobo.547.1">counter card</span></code><span class="koboSpan" id="kobo.548.1"> element, as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.549.1">...
</span><span class="hljs-title"><span class="koboSpan" id="kobo.550.1">describe</span></span><span class="koboSpan" id="kobo.551.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.552.1">'ng-cypress-starter'</span></span><span class="koboSpan" id="kobo.553.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.554.1">() =&gt;</span></span><span class="koboSpan" id="kobo.555.1"> {
  ...
 
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.556.1">it</span></span><span class="koboSpan" id="kobo.557.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.558.1">'should show the action buttons when the counter card is hovered'</span></span><span class="koboSpan" id="kobo.559.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.560.1">() =&gt;</span></span><span class="koboSpan" id="kobo.561.1">
    {
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.562.1">getCounterCard</span></span><span class="koboSpan" id="kobo.563.1">()</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.564.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.565.1">realHover</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.566.1">();</span></strong></span><span class="koboSpan" id="kobo.567.1">
    ...
  </span><span class="koboSpan" id="kobo.567.2">})
});
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.568.1">Now, run the </span><code class="inlineCode"><span class="koboSpan" id="kobo.569.1">npm run e2e ng-cy-element-visibility</span></code><span class="koboSpan" id="kobo.570.1"> command again from the workspace root (if it is not running already). </span><span class="koboSpan" id="kobo.570.2">You should see all the tests passing, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.571.1">Figure 11.5</span></em><span class="koboSpan" id="kobo.572.1">:</span></li>
</ol>
<figure class="mediaobject"><span class="koboSpan" id="kobo.573.1"><img alt="" role="presentation" src="../Images/B18469_11_05.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.574.1">Figure 11.5: All tests passing </span></p>
<p class="normal"><span class="koboSpan" id="kobo.575.1">Awesome! </span><span class="koboSpan" id="kobo.575.2">You’ve just learned how to check the visibility of DOM elements in different scenarios. </span><span class="koboSpan" id="kobo.575.3">These are, of course, not the only options available to identify and interact with DOM elements. </span><span class="koboSpan" id="kobo.575.4">You can refer to the Cypress documentation for more possibilities. </span><span class="koboSpan" id="kobo.575.5">Now that you have finished </span><a id="_idIndexMarker899"/><span class="koboSpan" id="kobo.576.1">the recipe, see the next section to understand how it works.</span></p>
<h2 class="heading-2" id="_idParaDest-384"><span class="koboSpan" id="kobo.577.1">How it works…</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.578.1">We started the recipe by building the POs. </span><span class="koboSpan" id="kobo.578.2">It is a good idea to do so to have the functions ready for when we write the tests. </span><span class="koboSpan" id="kobo.578.3">And if a function doesn’t exist to get a particular page object, we can create it on the go. </span><span class="koboSpan" id="kobo.578.4">Notice that we check </span><code class="inlineCode"><span class="koboSpan" id="kobo.579.1">getCounterCard</span></code><span class="koboSpan" id="kobo.580.1"> with a </span><code class="inlineCode"><span class="koboSpan" id="kobo.581.1">should('exist')</span></code><span class="koboSpan" id="kobo.582.1"> statement. </span><span class="koboSpan" id="kobo.582.2">If you don’t already know, we could have used </span><code class="inlineCode"><span class="koboSpan" id="kobo.583.1">should('be.visible')</span></code><span class="koboSpan" id="kobo.584.1"> as well, and that would work too. </span><span class="koboSpan" id="kobo.584.2">But when we want to make sure that it is not visible, we can’t use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.585.1">should('not.be.visible')</span></code><span class="koboSpan" id="kobo.586.1"> statement. </span><span class="koboSpan" id="kobo.586.2">And now you’ll be thinking, ‘‘What??’’ </span><span class="koboSpan" id="kobo.586.3">Exactly! </span><span class="koboSpan" id="kobo.586.4">Since </span><code class="inlineCode"><span class="koboSpan" id="kobo.587.1">'visible'</span></code><span class="koboSpan" id="kobo.588.1"> in Cypress is built so that the element exists in the DOM and is visible too, it can’t accommodate cases where an element doesn’t exist in the DOM if we use </span><code class="inlineCode"><span class="koboSpan" id="kobo.589.1">'be.visible'</span></code><span class="koboSpan" id="kobo.590.1"> or </span><code class="inlineCode"><span class="koboSpan" id="kobo.591.1">'not.be.visible'</span></code><span class="koboSpan" id="kobo.592.1">. </span><span class="koboSpan" id="kobo.592.2">And since we use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.593.1">*ngIf</span></code><span class="koboSpan" id="kobo.594.1"> directive to show or hide our </span><code class="inlineCode"><span class="koboSpan" id="kobo.595.1">Counter</span></code> <code class="inlineCode"><span class="koboSpan" id="kobo.596.1">component</span></code><span class="koboSpan" id="kobo.597.1">, it ends up either </span><em class="italic"><span class="koboSpan" id="kobo.598.1">existing </span></em><span class="koboSpan" id="kobo.599.1">in the DOM or not. </span><span class="koboSpan" id="kobo.599.2">Hence, using </span><code class="inlineCode"><span class="koboSpan" id="kobo.600.1">should('exist')</span></code><span class="koboSpan" id="kobo.601.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.602.1">should('not.exis')</span></code><span class="koboSpan" id="kobo.603.1"> is the appropriate choice here.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.604.1">For the next test, we wanted to see if hovering (or doing a mouse over) on the counter card displays the action buttons. </span><span class="koboSpan" id="kobo.604.2">For this, we could use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.605.1">trigger</span></code><span class="koboSpan" id="kobo.606.1"> method on the counter card with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.607.1">mouseover</span></code><span class="koboSpan" id="kobo.608.1"> event. </span><span class="koboSpan" id="kobo.608.2">However, that won’t work. </span><span class="koboSpan" id="kobo.608.3">Why? </span><span class="koboSpan" id="kobo.608.4">Because all the hover workarounds in Cypress eventually lead to triggering the JavaScript events and doesn’t affect the CSS pseudo selectors, and since we have our action buttons (with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.609.1">'.counter__actions__action'</span></code><span class="koboSpan" id="kobo.610.1"> selector) shown on the </span><code class="inlineCode"><span class="koboSpan" id="kobo.611.1">:hover</span></code><span class="koboSpan" id="kobo.612.1"> (CSS) of the element with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.613.1">'.counter'</span></code><span class="koboSpan" id="kobo.614.1"> selector, our tests fail because, in the tests, our action buttons are not actually shown. </span><span class="koboSpan" id="kobo.614.2">To tackle the issue, we use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.615.1">cypress-real-events</span></code><span class="koboSpan" id="kobo.616.1"> package, which has the </span><code class="inlineCode"><span class="koboSpan" id="kobo.617.1">realHover </span></code><span class="koboSpan" id="kobo.618.1">method that affects the pseudo selectors and eventually shows our action</span><a id="_idIndexMarker900"/><span class="koboSpan" id="kobo.619.1"> buttons.</span></p>
<h2 class="heading-2" id="_idParaDest-385"><span class="koboSpan" id="kobo.620.1">See also</span></h2>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.621.1">Cypress official </span><a id="_idIndexMarker901"/><span class="koboSpan" id="kobo.622.1">documentation on the visibility of items: </span><a href="https://docs.cypress.io/guides/core-concepts/interacting-with-elements.html#Visibility"><span class="url"><span class="koboSpan" id="kobo.623.1">https://docs.cypress.io/guides/core-concepts/interacting-with-elements.html#Visibility</span></span></a></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.624.1">cypress-real-events</span></code><span class="koboSpan" id="kobo.625.1"> project</span><a id="_idIndexMarker902"/><span class="koboSpan" id="kobo.626.1"> repository: </span><a href="https://github.com/dmtrKovalenko/cypress-real-events"><span class="url"><span class="koboSpan" id="kobo.627.1">https://github.com/dmtrKovalenko/cypress-real-events</span></span></a></li>
</ul>
<h1 class="heading-1" id="_idParaDest-386"><span class="koboSpan" id="kobo.628.1">Testing form inputs and submission</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.629.1">If you’re building a web app, there’s a high</span><a id="_idIndexMarker903"/><span class="koboSpan" id="kobo.630.1"> chance that you’re going to have at least one form in it, and when it comes to forms, we need to make sure that we have the right </span><strong class="keyWord"><span class="koboSpan" id="kobo.631.1">User Experience</span></strong><span class="koboSpan" id="kobo.632.1"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.633.1">UX</span></strong><span class="koboSpan" id="kobo.634.1">) and the right business logic in place. </span><span class="koboSpan" id="kobo.634.2">What better way to make sure everything works as expected than writing E2E tests for them? </span><span class="koboSpan" id="kobo.634.3">In this recipe, we’re going to test a form using Cypress and validate if the correct errors are being shown in appropriate situations.</span></p>
<h2 class="heading-2" id="_idParaDest-387"><span class="koboSpan" id="kobo.635.1">Getting ready</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.636.1">The app that we are going to work with resides in </span><code class="inlineCode"><span class="koboSpan" id="kobo.637.1">start/apps/chapter11/ng-cy-forms</span></code><span class="koboSpan" id="kobo.638.1"> inside the cloned repository. </span><span class="koboSpan" id="kobo.638.2">However, the e2e tests are in the folder </span><code class="inlineCode"><span class="koboSpan" id="kobo.639.1">start/apps/chapter11/ng-cy-forms-e2e</span></code><span class="koboSpan" id="kobo.640.1">. </span><span class="koboSpan" id="kobo.640.2">In this recipe, we’re going to modify files in both folders. </span><span class="koboSpan" id="kobo.640.3">Let’s run the e2e tests first by following these steps:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.641.1">Open the code repository in your code editor.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.642.1">Open the terminal, navigate to the code repository directory, and run the following command to run the e2e tests for the project:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.643.1">npm run e2e ng-cy-forms
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.644.1">This should open the Cypress window. </span><span class="koboSpan" id="kobo.644.2">Select Chrome for testing and click the </span><code class="inlineCode"><span class="koboSpan" id="kobo.645.1">app.cy.ts</span></code><span class="koboSpan" id="kobo.646.1"> file to run the tests and you should see the following:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.647.1"><img alt="" role="presentation" src="../Images/B18469_11_06.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.648.1">Figure 11.6: Cypress tests running for the app ng-cy-forms</span></p></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.649.1">Now that we have the Cypress</span><a id="_idIndexMarker904"/><span class="koboSpan" id="kobo.650.1"> tests running, let’s see the steps of the recipe in the next section.</span></p>
<h2 class="heading-2" id="_idParaDest-388"><span class="koboSpan" id="kobo.651.1">How to do it…</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.652.1">We have to make sure that we see a </span><strong class="keyWord"><span class="koboSpan" id="kobo.653.1">new log</span></strong><span class="koboSpan" id="kobo.654.1"> when the form is successfully submitted with a new version. </span><span class="koboSpan" id="kobo.654.2">We also need to make sure that we see relevant errors if the version input is empty, or if the value of the version input is an invalid value. </span><span class="koboSpan" id="kobo.654.3">Let’s get started:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.655.1">Let’s create the page objects required for our tests. </span><span class="koboSpan" id="kobo.655.2">We already have the </span><code class="inlineCode"><span class="koboSpan" id="kobo.656.1">data-test-id</span></code><span class="koboSpan" id="kobo.657.1"> attribute on the items we want to use in the tests. </span><span class="koboSpan" id="kobo.657.2">So, we can reference them in the page object file. </span><span class="koboSpan" id="kobo.657.3">Update the </span><code class="inlineCode"><span class="koboSpan" id="kobo.658.1">start/apps/chapter11/ng-cy-forms-e2e/src/support/app.po.ts</span></code><span class="koboSpan" id="kobo.659.1"> file as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.660.1">export</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.661.1">const</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.662.1">getHeaderTitle</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.663.1"> = () =&gt; cy.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.664.1">get</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.665.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.666.1">'.toolbar__title'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.667.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.668.1">export</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.669.1">const</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.670.1">getVersionInput</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.671.1"> = () =&gt; cy.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.672.1">get</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.673.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.674.1">'[data-test-id="versionInput"]'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.675.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.676.1">export</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.677.1">const</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.678.1">getRequiredError</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.679.1"> = () =&gt; cy.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.680.1">get</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.681.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.682.1">'[data-test-id="versionReqErr"]'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.683.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.684.1">export</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.685.1">const</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.686.1">getMismatchError</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.687.1"> = () =&gt; cy.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.688.1">get</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.689.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.690.1">'[data-test-id="versionMismatchErr"]'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.691.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.692.1">export</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.693.1">const</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.694.1">getSubmitButton</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.695.1"> = () =&gt; cy.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.696.1">get</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.697.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.698.1">'[data-test-id="submitVersionBtn"]'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.699.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.700.1">export</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.701.1">const</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.702.1">getLogsListItems</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.703.1"> = () =&gt; cy.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.704.1">get</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.705.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.706.1">'[data-test-id="logsList"] .logs__item'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.707.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.708.1">export</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.709.1">const</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.710.1">getLatestVersion</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.711.1"> = () =&gt; cy.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.712.1">get</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.713.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.714.1">'[data-test-id="latestVersion"]'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.715.1">);</span></strong></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.716.1">We will first validate</span><a id="_idIndexMarker905"/><span class="koboSpan" id="kobo.717.1"> that our form cannot be submitted unless we have a valid version. </span><span class="koboSpan" id="kobo.717.2">To do that, let’s make sure that the </span><strong class="screenText"><span class="koboSpan" id="kobo.718.1">Submit</span></strong><span class="koboSpan" id="kobo.719.1"> button is disabled when the input gets cleared after typing, or when there’s an invalid value. </span><span class="koboSpan" id="kobo.719.2">Open the </span><code class="inlineCode"><span class="koboSpan" id="kobo.720.1">src/e2e/app.cy.ts</span></code><span class="koboSpan" id="kobo.721.1"> file in the e2e project and add a test, as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.722.1">import</span></span><span class="koboSpan" id="kobo.723.1"> { getHeaderTitle, </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.724.1">getSubmitButton, getVersionInput</span></strong></span><span class="koboSpan" id="kobo.725.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.726.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.727.1">'../support/app.po'</span></span><span class="koboSpan" id="kobo.728.1">;
</span><span class="hljs-title"><span class="koboSpan" id="kobo.729.1">describe</span></span><span class="koboSpan" id="kobo.730.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.731.1">'ng-cy-forms'</span></span><span class="koboSpan" id="kobo.732.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.733.1">() =&gt;</span></span><span class="koboSpan" id="kobo.734.1"> {
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.735.1">beforeEach</span></span><span class="koboSpan" id="kobo.736.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.737.1">() =&gt;</span></span><span class="koboSpan" id="kobo.738.1"> cy.</span><span class="hljs-title"><span class="koboSpan" id="kobo.739.1">visit</span></span><span class="koboSpan" id="kobo.740.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.741.1">'/'</span></span><span class="koboSpan" id="kobo.742.1">));
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.743.1">it</span></span><span class="koboSpan" id="kobo.744.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.745.1">'should display the correct header title'</span></span><span class="koboSpan" id="kobo.746.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.747.1">() =&gt;</span></span><span class="koboSpan" id="kobo.748.1"> {...});
  </span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.749.1">it</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.750.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.751.1">'should have the submit button disabled on invalid input'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.752.1">, </span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.753.1">() =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.754.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.755.1">getVersionInput</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.756.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.757.1">type</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.758.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.759.1">'invalid input'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.760.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.761.1">getSubmitButton</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.762.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.763.1">should</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.764.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.765.1">'be.disabled'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.766.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.767.1">getVersionInput</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.768.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.769.1">clear</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.770.1">();</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.771.1">getSubmitButton</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.772.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.773.1">should</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.774.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.775.1">'be.disabled'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.776.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.777.1">getVersionInput</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.778.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.779.1">type</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.780.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.781.1">'0.0.1'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.782.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.783.1">getSubmitButton</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.784.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.785.1">should</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.786.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.787.1">'be.enabled'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.788.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.789.1">});</span></strong></span><span class="koboSpan" id="kobo.790.1">
});
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.791.1">If you look at the Cypress window and exapand the tests, you should see the tests passing, as follows:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.792.1"><img alt="" role="presentation" src="../Images/B18469_11_07.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.793.1">Figure 11.7: Checking if the Submit button is disabled when there is invalid input</span></p> </li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="3"><span class="koboSpan" id="kobo.794.1">Let’s add another test</span><a id="_idIndexMarker906"/><span class="koboSpan" id="kobo.795.1"> that validates that we see a new version log when submitting a valid version. </span><span class="koboSpan" id="kobo.795.2">Add another test in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.796.1">app.cy.ts</span></code><span class="koboSpan" id="kobo.797.1"> file, as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.798.1">...
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.799.1">import</span></span><span class="koboSpan" id="kobo.800.1"> { getHeaderTitle, getLatestVersion, </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.801.1">getLogsListItems</span></strong></span><span class="koboSpan" id="kobo.802.1">, getSubmitButton, getVersionInput } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.803.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.804.1">'../support/app.po'</span></span><span class="koboSpan" id="kobo.805.1">;
 
</span><span class="hljs-title"><span class="koboSpan" id="kobo.806.1">describe</span></span><span class="koboSpan" id="kobo.807.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.808.1">'ng-cy-forms'</span></span><span class="koboSpan" id="kobo.809.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.810.1">() =&gt;</span></span><span class="koboSpan" id="kobo.811.1"> {
  ...
  </span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.812.1">it</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.813.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.814.1">'should add a new version log on valid version submission'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.815.1">, </span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.816.1">() =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.817.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.818.1">getLogsListItems</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.819.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.820.1">should</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.821.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.822.1">'have.length'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.823.1">, </span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.824.1">1</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.825.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.826.1">getVersionInput</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.827.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.828.1">type</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.829.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.830.1">'0.0.1'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.831.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.832.1">getSubmitButton</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.833.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.834.1">click</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.835.1">();</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.836.1">getLogsListItems</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.837.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.838.1">should</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.839.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.840.1">'have.length'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.841.1">, </span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.842.1">2</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.843.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.844.1">getLogsListItems</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.845.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.846.1">eq</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.847.1">(</span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.848.1">1</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.849.1">).</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.850.1">then</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.851.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.852.1">el</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.853.1"> =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.854.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.855.1">expect</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.856.1">(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.857.1">el.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.858.1">text</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.859.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.860.1">trim</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.861.1">()</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.862.1">).</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.863.1">to</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.864.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.865.1">eq</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.866.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.867.1">'version changed to 0.0.1'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.868.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.869.1">});</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.870.1">});</span></strong></span><span class="koboSpan" id="kobo.871.1">
});
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.872.1">We’ll add another test now to make sure that we can see the latest version above the version logs. </span><span class="koboSpan" id="kobo.872.2">Let’s modify the </span><code class="inlineCode"><span class="koboSpan" id="kobo.873.1">app.cy.ts</span></code><span class="koboSpan" id="kobo.874.1"> file, as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.875.1">...
</span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.876.1">describe</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.877.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.878.1">'ng-cy-forms'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.879.1">, </span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.880.1">() =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.881.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.882.1">...</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.883.1">it</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.884.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.885.1">'should display the latest version'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.886.1">, </span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.887.1">() =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.888.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.889.1">getLatestVersion</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.890.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.891.1">should</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.892.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.893.1">'have.text'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.894.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.895.1">'Latest Version = 0.0.0'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.896.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.897.1">getVersionInput</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.898.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.899.1">type</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.900.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.901.1">'0.0.1'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.902.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.903.1">getSubmitButton</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.904.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.905.1">click</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.906.1">();</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.907.1">getLatestVersion</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.908.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.909.1">should</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.910.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.911.1">'have.text'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.912.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.913.1">'Latest Version = 0.0.1'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.914.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.915.1">});</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.916.1">});</span></strong></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.917.1">We will now add a test</span><a id="_idIndexMarker907"/><span class="koboSpan" id="kobo.918.1"> that will verify if the user sees the error </span><code class="inlineCode"><span class="koboSpan" id="kobo.919.1">'Version number is required'</span></code><span class="koboSpan" id="kobo.920.1"> when the version input is cleared after typing something, i.e., before the value is submitted. </span><span class="koboSpan" id="kobo.920.2">Add the test in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.921.1">app.cy.ts</span></code><span class="koboSpan" id="kobo.922.1"> file, as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.923.1">import</span></span><span class="koboSpan" id="kobo.924.1"> { getHeaderTitle, getLatestVersion, getLogsListItems, </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.925.1">getRequiredError</span></strong></span><span class="koboSpan" id="kobo.926.1">, getSubmitButton, getVersionInput } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.927.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.928.1">'../support/app.po'</span></span><span class="koboSpan" id="kobo.929.1">;
 
</span><span class="hljs-title"><span class="koboSpan" id="kobo.930.1">describe</span></span><span class="koboSpan" id="kobo.931.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.932.1">'ng-cy-forms'</span></span><span class="koboSpan" id="kobo.933.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.934.1">() =&gt;</span></span><span class="koboSpan" id="kobo.935.1"> {
  ...
  </span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.936.1">it</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.937.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.938.1">'should show the version required error when the input </span></strong></span> <span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.939.1">gets clered after typing something'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.940.1">, () =&gt; {</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.941.1">getVersionInput</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.942.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.943.1">type</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.944.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.945.1">'0.0.1'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.946.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.947.1">getVersionInput</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.948.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.949.1">clear</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.950.1">();</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.951.1">getRequiredError</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.952.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.953.1">should</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.954.1">(</span></strong></span><span class="hljs-string"><span class="koboSpan" id="kobo.955.1">'exist'</span></span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.956.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.957.1">getRequiredError</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.958.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.959.1">should</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.960.1">(</span></strong></span><span class="hljs-string"><span class="koboSpan" id="kobo.961.1">'be.visible'</span></span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.962.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.963.1">getRequiredError</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.964.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.965.1">then</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.966.1">(el =&gt; {</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.967.1">expect</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.968.1">(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.969.1">el.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.970.1">text</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.971.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.972.1">trim</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.973.1">()</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.974.1">).to.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.975.1">eq</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.976.1">(</span></strong></span><span class="hljs-string"><span class="koboSpan" id="kobo.977.1">'Version number is required'</span></span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.978.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.979.1">});</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.980.1">});</span></strong></span><span class="koboSpan" id="kobo.981.1">
});
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.982.1">Finally, let us write a test to make sure we show an error message on invalid inputs. </span><span class="koboSpan" id="kobo.982.2">Add another test in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.983.1">app.cy.ts</span></code><span class="koboSpan" id="kobo.984.1"> file, as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.985.1">...
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.986.1">import</span></span><span class="koboSpan" id="kobo.987.1"> { getHeaderTitle, getLatestVersion, getLogsListItems, </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.988.1">getMismatchError</span></strong></span><span class="koboSpan" id="kobo.989.1">, getRequiredError, getSubmitButton, getVersionInput } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.990.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.991.1">'../support/app.po'</span></span><span class="koboSpan" id="kobo.992.1">;
</span><span class="hljs-title"><span class="koboSpan" id="kobo.993.1">describe</span></span><span class="koboSpan" id="kobo.994.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.995.1">'ng-cy-forms'</span></span><span class="koboSpan" id="kobo.996.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.997.1">() =&gt;</span></span><span class="koboSpan" id="kobo.998.1"> {
  ...
  </span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.999.1">it</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1000.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1001.1">'should show the invalid input error when the </span></strong></span> <span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1002.1">version input is invalid'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1003.1">, </span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1004.1">() =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1005.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1006.1">getVersionInput</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1007.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1008.1">type</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1009.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1010.1">'abc123'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1011.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1012.1">getMismatchError</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1013.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1014.1">should</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1015.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1016.1">'exist'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1017.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1018.1">getMismatchError</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1019.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1020.1">should</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1021.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1022.1">'be.visible'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1023.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1024.1">getMismatchError</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1025.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1026.1">then</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1027.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1028.1">el</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1029.1"> =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1030.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1031.1">expect</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1032.1">(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1033.1">el.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1034.1">text</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1035.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1036.1">trim</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1037.1">()</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1038.1">).</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1039.1">to</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1040.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1041.1">eq</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1042.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1043.1">'Version number does not match the pattern (x.x.x)'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1044.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1045.1">});</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1046.1">});</span></strong></span><span class="koboSpan" id="kobo.1047.1">
});
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1048.1">If you look at the </span><strong class="screenText"><span class="koboSpan" id="kobo.1049.1">Tests</span></strong><span class="koboSpan" id="kobo.1050.1"> window</span><a id="_idIndexMarker908"/><span class="koboSpan" id="kobo.1051.1"> now, you should see all the tests passing, as follows:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1052.1"><img alt="" role="presentation" src="../Images/B18469_11_08.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1053.1">Figure 11.8: All tests passing for the app</span></p> </li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.1054.1">Awesome! </span><span class="koboSpan" id="kobo.1054.2">You now know how to use Cypress to test forms with some interesting use cases and assertions. </span><span class="koboSpan" id="kobo.1054.3">See the next section to understand how it all works.</span></p>
<h2 class="heading-2" id="_idParaDest-389"><span class="koboSpan" id="kobo.1055.1">How it works…</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1056.1">We start by implementing</span><a id="_idIndexMarker909"/><span class="koboSpan" id="kobo.1057.1"> some page objects in our </span><code class="inlineCode"><span class="koboSpan" id="kobo.1058.1">app.po.ts</span></code><span class="koboSpan" id="kobo.1059.1"> file since we can reuse those methods to get the elements easily. </span><span class="koboSpan" id="kobo.1059.2">Since our app’s logic has a rule that the </span><strong class="screenText"><span class="koboSpan" id="kobo.1060.1">Submit</span></strong><span class="koboSpan" id="kobo.1061.1"> button should be disabled until we have a valid version in the version input, we use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1062.1">'be.disabled'</span></code><span class="koboSpan" id="kobo.1063.1"> assertion on the </span><strong class="screenText"><span class="koboSpan" id="kobo.1064.1">Submit</span></strong><span class="koboSpan" id="kobo.1065.1"> button, as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.1066.1">getSubmitButton</span></span><span class="koboSpan" id="kobo.1067.1">().</span><span class="hljs-title"><span class="koboSpan" id="kobo.1068.1">should</span></span><span class="koboSpan" id="kobo.1069.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1070.1">'be.disabled'</span></span><span class="koboSpan" id="kobo.1071.1">);
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1072.1">We then use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1073.1">getVersionInput().type('...')</span></code><span class="koboSpan" id="kobo.1074.1"> function to type the desired values in the version input and check if the button is disabled either when we have an invalid value for the version input, or no value entered at all.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1075.1">Then we check if there is a new log added to the logs list when a valid version is submitted. </span><span class="koboSpan" id="kobo.1075.2">The important chunk of code for this test is as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.1076.1">getLogsListItems</span></span><span class="koboSpan" id="kobo.1077.1">().</span><span class="hljs-title"><span class="koboSpan" id="kobo.1078.1">eq</span></span><span class="koboSpan" id="kobo.1079.1">(</span><span class="hljs-number"><span class="koboSpan" id="kobo.1080.1">1</span></span><span class="koboSpan" id="kobo.1081.1">).</span><span class="hljs-title"><span class="koboSpan" id="kobo.1082.1">then</span></span><span class="koboSpan" id="kobo.1083.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.1084.1">el</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1085.1"> =&gt;</span></span><span class="koboSpan" id="kobo.1086.1"> {
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.1087.1">expect</span></span><span class="koboSpan" id="kobo.1088.1">(
     el.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1089.1">text</span></span><span class="koboSpan" id="kobo.1090.1">().</span><span class="hljs-title"><span class="koboSpan" id="kobo.1091.1">trim</span></span><span class="koboSpan" id="kobo.1092.1">()
  ).</span><span class="hljs-property"><span class="koboSpan" id="kobo.1093.1">to</span></span><span class="koboSpan" id="kobo.1094.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1095.1">eq</span></span><span class="koboSpan" id="kobo.1096.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1097.1">'version changed to 0.0.1'</span></span><span class="koboSpan" id="kobo.1098.1">)
});
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1099.1">Notice that we get the list of logs, i.e., the log items. </span><span class="koboSpan" id="kobo.1099.2">Then we use </span><code class="inlineCode"><span class="koboSpan" id="kobo.1100.1">eq(1)</span></code><span class="koboSpan" id="kobo.1101.1"> to get the second element from the list. </span><span class="koboSpan" id="kobo.1101.2">Then we use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1102.1">then</span></code><span class="koboSpan" id="kobo.1103.1"> method to get the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1104.1">jQuery&lt;HTMLElement&gt;</span></code><span class="koboSpan" id="kobo.1105.1"> so we can use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1106.1">trim</span></code><span class="koboSpan" id="kobo.1107.1"> method on the text content of the element. </span><span class="koboSpan" id="kobo.1107.2">This is because when writing HTML templates for Angular applications, we might end up writing the content in the HTML tags in a formatted way that ends up including whitespaces in the text content. </span><span class="koboSpan" id="kobo.1107.3">So, it is a clever idea to trim the text before using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1108.1">expect</span></code><span class="koboSpan" id="kobo.1109.1"> function against the expected value. </span><span class="koboSpan" id="kobo.1109.2">Alternatively, you can use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1110.1">.should('contain.text', 'EXPECTED_TEXT')</span></code><span class="koboSpan" id="kobo.1111.1"> assertion instead of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1112.1">.should('have.text', 'EXPECTED_TEXT')</span></code><span class="koboSpan" id="kobo.1113.1"> assertion.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1114.1">For the cases where we want to check that the appropriate errors are being displayed, we ensure the following:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.1115.1">The error element exists on the DOM</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1116.1">The error element is visible to the user</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1117.1">The error element has the appropriate error message</span></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.1118.1">Notice that we use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1119.1">then</span></code><span class="koboSpan" id="kobo.1120.1"> method to get the error elements to trim the text content before our test assertions, like what we did for the log item’s text content validation.</span></p>
<h2 class="heading-2" id="_idParaDest-390"><span class="koboSpan" id="kobo.1121.1">See also</span></h2>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.1122.1">Cypress recipes – Form interactions: </span><a href="https://github.com/cypress-io/cypress-example-recipes/tree/master/examples/testing-dom__form-interactions"><span class="url"><span class="koboSpan" id="kobo.1123.1">https://github.com/cypress-io/cypress-example-recipes/tree/master/examples/testing-dom__form-interactions</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1124.1">Cypress recipes – Login form: </span><a href="https://github.com/cypress-io/cypress-example-recipes/tree/master/examples/logging-in__html-web-forms"><span class="url"><span class="koboSpan" id="kobo.1125.1">https://github.com/cypress-io/cypress-example-recipes/tree/master/examples/logging-in__html-web-forms</span></span></a></li>
</ul>
<h1 class="heading-1" id="_idParaDest-391"><span class="koboSpan" id="kobo.1126.1">Waiting for XHRs to finish</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1127.1">Testing </span><strong class="keyWord"><span class="koboSpan" id="kobo.1128.1">User Interface</span></strong><span class="koboSpan" id="kobo.1129.1"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.1130.1">UI</span></strong><span class="koboSpan" id="kobo.1131.1">) transitions is the essence of E2E testing. </span><span class="koboSpan" id="kobo.1131.2">While it is important to test the predicted</span><a id="_idIndexMarker910"/><span class="koboSpan" id="kobo.1132.1"> outcome of an action right away, there might be cases where the outcome</span><a id="_idIndexMarker911"/><span class="koboSpan" id="kobo.1133.1"> has a dependency. </span><span class="koboSpan" id="kobo.1133.2">For instance, if a user fills out the </span><strong class="screenText"><span class="koboSpan" id="kobo.1134.1">Login</span></strong><span class="koboSpan" id="kobo.1135.1"> form, we can’t show the success toast until we have a successful response from the backend server, hence we can’t test whether the success toast is shown right away. </span><span class="koboSpan" id="kobo.1135.2">In this recipe, you’re going to learn how to wait for a specific XHR call to be completed before performing an assertion.</span></p>
<h2 class="heading-2" id="_idParaDest-392"><span class="koboSpan" id="kobo.1136.1">Getting ready</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1137.1">The app that we are going to work with resides in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1138.1">start/apps/chapter11/ng-cy-http-requests</span></code><span class="koboSpan" id="kobo.1139.1"> inside the cloned repository. </span><span class="koboSpan" id="kobo.1139.2">However, the e2e tests are in the folder </span><code class="inlineCode"><span class="koboSpan" id="kobo.1140.1">start/apps/chapter11/ng-cy-http-requests-e2e</span></code><span class="koboSpan" id="kobo.1141.1">. </span><span class="koboSpan" id="kobo.1141.2">In this recipe, we’re going to modify files for the e2e project only. </span><span class="koboSpan" id="kobo.1141.3">Let’s run the e2e tests by following these steps:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1142.1">Open the code repository in your code editor.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1143.1">Open the terminal, navigate to the code repository directory, and run the following command to run the e2e tests for the project:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1144.1">npm run e2e ng-cy-http-requests
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1145.1">This should open the Cypress window. </span><span class="koboSpan" id="kobo.1145.2">Select Chrome for testing and click the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1146.1">app.cy.ts</span></code><span class="koboSpan" id="kobo.1147.1"> file to run the tests, and you should see the following:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1148.1"><img alt="" role="presentation" src="../Images/B18469_11_09.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1149.1">Figure 11.9: Cypress tests running for the ng-cy-http-requests app</span></p> </li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.1150.1">Now that we have the Cypress</span><a id="_idIndexMarker912"/><span class="koboSpan" id="kobo.1151.1"> tests running, let’s see the steps of the recipe in the next section.</span></p>
<h2 class="heading-2" id="_idParaDest-393"><span class="koboSpan" id="kobo.1152.1">How to do it…</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1153.1">We are going to start with some tests that will work just fine. </span><span class="koboSpan" id="kobo.1153.2">However, if there’s a delay in the response for the HTTP calls, they will fail. </span><span class="koboSpan" id="kobo.1153.3">That is because Cypress has a timeout of 4,000 </span><strong class="keyWord"><span class="koboSpan" id="kobo.1154.1">milliseconds</span></strong><span class="koboSpan" id="kobo.1155.1"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.1156.1">ms</span></strong><span class="koboSpan" id="kobo.1157.1">) (4 seconds), during which it tries the assertion again and again until the assertion passes. </span><span class="koboSpan" id="kobo.1157.2">What if our XHR takes more than 4,000 ms? </span><span class="koboSpan" id="kobo.1157.3">Let’s try it out in the recipe:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1158.1">We will write our test first. </span><span class="koboSpan" id="kobo.1158.2">We’ll make sure that we get 10 users from the HTTP call’s response. </span><span class="koboSpan" id="kobo.1158.3">But before that, we will create the desired page objects for this recipe in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1159.1">users.po.ts</span></code><span class="koboSpan" id="kobo.1160.1"> file, as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1161.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1162.1">const</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1163.1">getUsersCards</span></span><span class="koboSpan" id="kobo.1164.1"> = () =&gt; {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1165.1">return</span></span><span class="koboSpan" id="kobo.1166.1"> cy.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1167.1">get</span></span><span class="koboSpan" id="kobo.1168.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1169.1">'app-users ul li'</span></span><span class="koboSpan" id="kobo.1170.1">);
}
 
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1171.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1172.1">const</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1173.1">getSearchInput</span></span><span class="koboSpan" id="kobo.1174.1"> = () =&gt; {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1175.1">return</span></span><span class="koboSpan" id="kobo.1176.1"> cy.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1177.1">get</span></span><span class="koboSpan" id="kobo.1178.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1179.1">'[data-test-id="searchUsersInput"]'</span></span><span class="koboSpan" id="kobo.1180.1">);
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1181.1">Update the users.cy.ts file to add the following test:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1182.1">import</span></span><span class="koboSpan" id="kobo.1183.1"> { getUsersCards } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1184.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1185.1">'../support/users.po'</span></span><span class="koboSpan" id="kobo.1186.1">;
</span><span class="hljs-title"><span class="koboSpan" id="kobo.1187.1">describe</span></span><span class="koboSpan" id="kobo.1188.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1189.1">'ng-cy-http-requests &gt; users'</span></span><span class="koboSpan" id="kobo.1190.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.1191.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1192.1"> {
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.1193.1">beforeEach</span></span><span class="koboSpan" id="kobo.1194.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.1195.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1196.1"> cy.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1197.1">visit</span></span><span class="koboSpan" id="kobo.1198.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1199.1">'/users'</span></span><span class="koboSpan" id="kobo.1200.1">));
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.1201.1">it</span></span><span class="koboSpan" id="kobo.1202.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1203.1">'should get the users list from the server and display'</span></span><span class="koboSpan" id="kobo.1204.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.1205.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1206.1"> {
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1207.1">getUsersCards</span></span><span class="koboSpan" id="kobo.1208.1">().</span><span class="hljs-title"><span class="koboSpan" id="kobo.1209.1">should</span></span><span class="koboSpan" id="kobo.1210.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1211.1">'have.length'</span></span><span class="koboSpan" id="kobo.1212.1">, </span><span class="hljs-number"><span class="koboSpan" id="kobo.1213.1">10</span></span><span class="koboSpan" id="kobo.1214.1">);
  });
});
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1215.1">We will write another test</span><a id="_idIndexMarker913"/><span class="koboSpan" id="kobo.1216.1"> to check if we get the searched users based on the search input’s value. </span><span class="koboSpan" id="kobo.1216.2">Add another test in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1217.1">users.cy.ts</span></code><span class="koboSpan" id="kobo.1218.1"> file as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1219.1">import</span></span><span class="koboSpan" id="kobo.1220.1"> { </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1221.1">getSearchInput</span></strong></span><span class="koboSpan" id="kobo.1222.1">, getUsersCards } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1223.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1224.1">'../support/users.po'</span></span><span class="koboSpan" id="kobo.1225.1">;
</span><span class="code-highlight"><strong class="hljs-slc"> </strong></span>
<span class="hljs-title"><span class="koboSpan" id="kobo.1226.1">describe</span></span><span class="koboSpan" id="kobo.1227.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1228.1">'ng-cy-http-requests &gt; users'</span></span><span class="koboSpan" id="kobo.1229.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.1230.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1231.1"> { 
  ...
  </span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1232.1">it</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1233.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1234.1">'</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1235.1">should get the users list on searching'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1236.1">, </span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1237.1">() =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1238.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1239.1">getSearchInput</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1240.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1241.1">type</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1242.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1243.1">'rube'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1244.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1245.1">getUsersCards</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1246.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1247.1">should</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1248.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1249.1">'have.length'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1250.1">, </span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.1251.1">1</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1252.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1253.1">getUsersCards</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1254.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1255.1">find</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1256.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1257.1">'h4'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1258.1">).</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1259.1">should</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1260.1">(</span></strong></span>
<span class="code-highlight"><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1261.1">el</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1262.1"> =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1263.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1264.1">expect</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1265.1">(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1266.1">el.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1267.1">text</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1268.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1269.1">trim</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1270.1">()</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1271.1">).</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1272.1">to</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1273.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1274.1">eq</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1275.1">(</span></strong></span>
<span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1276.1">'Ruben Wheeler'</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1277.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1278.1">}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1279.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1280.1">});</span></strong></span><span class="koboSpan" id="kobo.1281.1">
});
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1282.1">You should see both tests passing, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.1283.1">Figure 11.10</span></em><span class="koboSpan" id="kobo.1284.1">. </span><span class="koboSpan" id="kobo.1284.2">However, this is not the best way of writing UI tests as they should be </span><em class="italic"><span class="koboSpan" id="kobo.1285.1">independent</span></em><span class="koboSpan" id="kobo.1286.1"> of the data received from actual API servers. </span><span class="koboSpan" id="kobo.1286.2">In practice, we usually mock the API calls, which you will learn about in the </span><em class="italic"><span class="koboSpan" id="kobo.1287.1">Using Cypress fixtures to provide mock data</span></em><span class="koboSpan" id="kobo.1288.1"> recipe later in this chapter.</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1289.1"><img alt="" role="presentation" src="../Images/B18469_11_10.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1290.1">Figure 11.10: Tests for the user page passing</span></p> </li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="4"><span class="koboSpan" id="kobo.1291.1">First of all, we need to simulate</span><a id="_idIndexMarker914"/><span class="koboSpan" id="kobo.1292.1"> the scenario where the desired result occurs after 4,000 ms. </span><span class="koboSpan" id="kobo.1292.2">We’ll use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1293.1">delay</span></code><span class="koboSpan" id="kobo.1294.1"> operator from </span><code class="inlineCode"><span class="koboSpan" id="kobo.1295.1">rxjs</span></code><span class="koboSpan" id="kobo.1296.1"> for this, with a delay of 5,000 ms. </span><span class="koboSpan" id="kobo.1296.2">Let’s apply it in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1297.1">user.service.ts</span></code><span class="koboSpan" id="kobo.1298.1"> file in the project, as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1299.1">…
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1300.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1301.1"> { </span></strong><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.1302.1">EMPTY</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1303.1">, </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1304.1">Observable</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1305.1">, delay, map, mergeMap, </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1306.1">of</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1307.1"> } </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1308.1">from</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1309.1">'rxjs'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1310.1">;</span></strong></span>
<span class="hljs-meta"><span class="koboSpan" id="kobo.1311.1">@Injectable</span></span><span class="koboSpan" id="kobo.1312.1">({
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1313.1">providedIn</span></span><span class="koboSpan" id="kobo.1314.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.1315.1">'root'</span></span><span class="koboSpan" id="kobo.1316.1">
})
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1317.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1318.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1319.1">UserService</span></span><span class="koboSpan" id="kobo.1320.1"> {
  http = </span><span class="hljs-title"><span class="koboSpan" id="kobo.1321.1">inject</span></span><span class="koboSpan" id="kobo.1322.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.1323.1">HttpClient</span></span><span class="koboSpan" id="kobo.1324.1">);
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.1325.1">getAll</span></span><span class="koboSpan" id="kobo.1326.1">(): </span><span class="hljs-title"><span class="koboSpan" id="kobo.1327.1">Observable</span></span><span class="koboSpan" id="kobo.1328.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.1329.1">User</span></span><span class="koboSpan" id="kobo.1330.1">[]&gt; {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1331.1">return</span></span> <span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1332.1">of</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1333.1">(</span></strong><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.1334.1">EMPTY</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1335.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1336.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1337.1">pipe</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1338.1">(</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1339.1">delay</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1340.1">(</span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.1341.1">5000</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1342.1">),</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1343.1">mergeMap</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1344.1">(</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1345.1">() =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1346.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1347.1">return</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.1348.1">this</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1349.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1350.1">http</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1351.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1352.1">get</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1353.1">&lt;</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1354.1">User</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1355.1">[]&gt;(</span></strong></span>
<span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1356.1">'/assets/users.json'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1357.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1358.1">})</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1359.1">);</span></strong></span><span class="koboSpan" id="kobo.1360.1">
  }
  ...}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1361.1">If you now check the Cypress tests, you should see a test failing, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.1362.1">Figure 11.11</span></em><span class="koboSpan" id="kobo.1363.1">:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1364.1"><img alt="" role="presentation" src="../Images/B18469_11_11.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1365.1">Figure 11.11: Assertion failing for the test for searching a particular user</span></p></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="5"><span class="koboSpan" id="kobo.1366.1">We can now try to fix </span><a id="_idIndexMarker915"/><span class="koboSpan" id="kobo.1367.1">this, so it doesn’t matter how long the XHR takes—we’ll always wait for it to be completed before making an assertion. </span><span class="koboSpan" id="kobo.1367.2">Let’s intercept the XHR call and create an alias for it so that we can use it later to wait for the XHR call. </span><span class="koboSpan" id="kobo.1367.3">Update the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1368.1">users.cy.ts</span></code><span class="koboSpan" id="kobo.1369.1"> file, as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1370.1">...
</span><span class="hljs-title"><span class="koboSpan" id="kobo.1371.1">describe</span></span><span class="koboSpan" id="kobo.1372.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1373.1">'ng-cy-http-requests &gt; users'</span></span><span class="koboSpan" id="kobo.1374.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.1375.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1376.1"> {
  </span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1377.1">beforeEach</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1378.1">(</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1379.1">() =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1380.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1381.1">cy.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1382.1">intercept</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1383.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1384.1">'/assets/users.json'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1385.1">).</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1386.1">as</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1387.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1388.1">'searchUsers'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1389.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1390.1">cy.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1391.1">visit</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1392.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1393.1">'/users'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1394.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1395.1">});</span></strong></span><span class="koboSpan" id="kobo.1396.1">
  ...
</span><span class="koboSpan" id="kobo.1396.2">});
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1397.1">Now, let’s use the alias</span><a id="_idIndexMarker916"/><span class="koboSpan" id="kobo.1398.1"> to wait for the XHR call to complete before the assertion. </span><span class="koboSpan" id="kobo.1398.2">Update the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1399.1">users.cy.ts</span></code><span class="koboSpan" id="kobo.1400.1"> file, as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1401.1">...
</span><span class="hljs-title"><span class="koboSpan" id="kobo.1402.1">describe</span></span><span class="koboSpan" id="kobo.1403.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1404.1">'ng-cy-http-requests &gt; users'</span></span><span class="koboSpan" id="kobo.1405.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.1406.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1407.1"> {
  ...
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.1408.1">it</span></span><span class="koboSpan" id="kobo.1409.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1410.1">'should get the users list from the server and display'</span></span><span class="koboSpan" id="kobo.1411.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.1412.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1413.1"> {
    </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1414.1">cy.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1415.1">wait</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1416.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1417.1">'@searchUsers'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1418.1">, {</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1419.1">timeout</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1420.1">: </span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.1421.1">10000</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1422.1">});</span></strong></span>
<span class="hljs-title"><span class="koboSpan" id="kobo.1423.1">getUsersCards</span></span><span class="koboSpan" id="kobo.1424.1">().</span><span class="hljs-title"><span class="koboSpan" id="kobo.1425.1">should</span></span><span class="koboSpan" id="kobo.1426.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1427.1">'have.length'</span></span><span class="koboSpan" id="kobo.1428.1">, </span><span class="hljs-number"><span class="koboSpan" id="kobo.1429.1">10</span></span><span class="koboSpan" id="kobo.1430.1">);
  });
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.1431.1">it</span></span><span class="koboSpan" id="kobo.1432.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1433.1">'should get the users list on searching'</span></span><span class="koboSpan" id="kobo.1434.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.1435.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1436.1"> {
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1437.1">getSearchInput</span></span><span class="koboSpan" id="kobo.1438.1">().</span><span class="hljs-title"><span class="koboSpan" id="kobo.1439.1">type</span></span><span class="koboSpan" id="kobo.1440.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1441.1">'rube'</span></span><span class="koboSpan" id="kobo.1442.1">);
    </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1443.1">cy.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1444.1">wait</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1445.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1446.1">'@searchUsers'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1447.1">, {</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1448.1">timeout</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1449.1">: </span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.1450.1">10000</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1451.1">});</span></strong></span>
<span class="hljs-title"><span class="koboSpan" id="kobo.1452.1">getUsersCards</span></span><span class="koboSpan" id="kobo.1453.1">().</span><span class="hljs-title"><span class="koboSpan" id="kobo.1454.1">should</span></span><span class="koboSpan" id="kobo.1455.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1456.1">'have.length'</span></span><span class="koboSpan" id="kobo.1457.1">, </span><span class="hljs-number"><span class="koboSpan" id="kobo.1458.1">1</span></span><span class="koboSpan" id="kobo.1459.1">);
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1460.1">getUsersCards</span></span><span class="koboSpan" id="kobo.1461.1">().</span><span class="hljs-title"><span class="koboSpan" id="kobo.1462.1">find</span></span><span class="koboSpan" id="kobo.1463.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1464.1">'h4'</span></span><span class="koboSpan" id="kobo.1465.1">).</span><span class="hljs-title"><span class="koboSpan" id="kobo.1466.1">should</span></span><span class="koboSpan" id="kobo.1467.1">(...);
  });
});
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1468.1">If you check the Cypress tests now for </span><code class="inlineCode"><span class="koboSpan" id="kobo.1469.1">users.cy.ts</span></code><span class="koboSpan" id="kobo.1470.1">, you should see all of them pass, as follows:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1471.1"><img alt="" role="presentation" src="../Images/B18469_11_12.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1472.1">Figure 11.12: Tests waiting for the XHR call to be completed before the assertion</span></p> </li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.1473.1">Great! </span><span class="koboSpan" id="kobo.1473.2">You now know how to implement E2E tests with Cypress that include waiting for a particular XHR call to finish</span><a id="_idIndexMarker917"/><span class="koboSpan" id="kobo.1474.1"> before an assertion. </span><span class="koboSpan" id="kobo.1474.2">To understand all the magic behind the recipe, see the next section.</span></p>
<h2 class="heading-2" id="_idParaDest-394"><span class="koboSpan" id="kobo.1475.1">How it works…</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1476.1">In the recipe, we use</span><a id="_idIndexMarker918"/><span class="koboSpan" id="kobo.1477.1"> something called variable aliasing. </span><span class="koboSpan" id="kobo.1477.2">We first use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1478.1">cy.intercept</span></code><span class="koboSpan" id="kobo.1479.1"> method so that Cypress can listen to the network call. </span><span class="koboSpan" id="kobo.1479.2">Note that we use the specific URL that is </span><code class="inlineCode"><span class="koboSpan" id="kobo.1480.1">/assets/users.json</span></code><span class="koboSpan" id="kobo.1481.1"> as the parameter, and then we use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1482.1">.as('searchUsers')</span></code><span class="koboSpan" id="kobo.1483.1"> statement to give an alias for this interception. </span><span class="koboSpan" id="kobo.1483.2">Notice that we modified the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1484.1">user.service.ts</span></code><span class="koboSpan" id="kobo.1485.1">, which causes a delay of 5,000 ms before the API call is made.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1486.1">Cypress has a default timeout of 4,000 ms, and we don’t want to restrict our API calls to be handled in our tests within 4,000 ms. </span><span class="koboSpan" id="kobo.1486.2">Therefore, we use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1487.1">cy.wait('@searchUsers');</span></code><span class="koboSpan" id="kobo.1488.1"> statement, using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1489.1">searchUsers</span></code><span class="koboSpan" id="kobo.1490.1"> alias to inform Cypress that it must wait until the aliased interception happens—that is, until the network call is made, regardless of how long it takes until Cypress’s second timeout (30,000 ms for network calls) is reached. </span><span class="koboSpan" id="kobo.1490.2">This makes our current tests pass, even though the default 4,000 ms Cypress timeout and 5,000 ms (about 5 seconds) timeout for HTTP calls in Cypress have already passed before actually making the network call. </span><span class="koboSpan" id="kobo.1490.3">Magic, isn’t it?</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1491.1">Note that Cypress has a default timeout of 4,000 ms for assertions such as checking if an element is visible or has a particular text. </span><span class="koboSpan" id="kobo.1491.2">It has a default timeout of 5,000 ms for HTTP calls to be initiated. </span><span class="koboSpan" id="kobo.1491.3">This made our test a bit tricky since we are delaying the initiation of the HTTP call while trying to simulate that the response is delayed from the server. </span><span class="koboSpan" id="kobo.1491.4">Due to this, we had to use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1492.1">options</span></code><span class="koboSpan" id="kobo.1493.1"> argument for </span><code class="inlineCode"><span class="koboSpan" id="kobo.1494.1">cy.wait</span></code><span class="koboSpan" id="kobo.1495.1"> including setting the timeout to 10,000 ms. </span><span class="koboSpan" id="kobo.1495.2">This allows Cypress to wait for the call to be initiated in 5,000 ms (which we added to the user service). </span><span class="koboSpan" id="kobo.1495.3">In a real-world scenario, your HTTP call will be instantly initiated, and the response may be delayed. </span><span class="koboSpan" id="kobo.1495.4">Cypress waits for 5,000 ms for the call to be initiated, so you should be fine. </span><span class="koboSpan" id="kobo.1495.5">As soon as the call is initiated, Cypress defaults to the 30,000 ms timeout to wait</span><a id="_idIndexMarker919"/><span class="koboSpan" id="kobo.1496.1"> for the response.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1497.1">Well, I hope you liked this recipe—see the next section for a link for further reading.</span></p>
<h2 class="heading-2" id="_idParaDest-395"><span class="koboSpan" id="kobo.1498.1">See also</span></h2>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.1499.1">Waiting</span><a id="_idIndexMarker920"/><span class="koboSpan" id="kobo.1500.1"> in Cypress: </span><a href="https://docs.cypress.io/api/commands/wait"><span class="url"><span class="koboSpan" id="kobo.1501.1">https://docs.cypress.io/api/commands/wait</span></span></a></li>
</ul>
<h1 class="heading-1" id="_idParaDest-396"><span class="koboSpan" id="kobo.1502.1">Using Cypress bundled packages</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1503.1">Cypress provides a bunch of bundled</span><a id="_idIndexMarker921"/><span class="koboSpan" id="kobo.1504.1"> tools and packages that we can use in our tests to make things easier, not because writing tests with Cypress is otherwise hard but because these libraries are used by many developers already and so they’re familiar with them. </span><span class="koboSpan" id="kobo.1504.2">In this recipe, we’re going to look at the bundled jQuery, Lodash, and Minimatch libraries to test some of our use cases.</span></p>
<h2 class="heading-2" id="_idParaDest-397"><span class="koboSpan" id="kobo.1505.1">Getting ready</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1506.1">The app that we are going to work with resides in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1507.1">start/apps/chapter11/ng-cy-bun-pack</span></code><span class="koboSpan" id="kobo.1508.1"> inside the cloned repository. </span><span class="koboSpan" id="kobo.1508.2">However, the e2e tests are in the folder </span><code class="inlineCode"><span class="koboSpan" id="kobo.1509.1">start/apps/chapter11/ng-cy-bun-pack-e2e</span></code><span class="koboSpan" id="kobo.1510.1">. </span><span class="koboSpan" id="kobo.1510.2">And in the recipe, we’re going to modify files for the e2e project only. </span><span class="koboSpan" id="kobo.1510.3">Let’s run the e2e tests by following these steps:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1511.1">Open the code repository in your code editor.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1512.1">Open the terminal, navigate to the code repository directory, and run the following command to run the e2e tests for the project:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1513.1">npm run e2e ng-cy-bun-pack
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1514.1">This should open the Cypress </span><a id="_idIndexMarker922"/><span class="koboSpan" id="kobo.1515.1">window. </span><span class="koboSpan" id="kobo.1515.2">Select </span><strong class="screenText"><span class="koboSpan" id="kobo.1516.1">Chrome </span></strong><span class="koboSpan" id="kobo.1517.1">for testing and click the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1518.1">users.cy.ts</span></code><span class="koboSpan" id="kobo.1519.1"> file to run the tests, and you should see the following:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1520.1"><img alt="" role="presentation" src="../Images/B18469_11_13.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1521.1">Figure 11.13: ng-cy-bun-pack app tests running with Cypress</span></p> </li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.1522.1">Now that we have the Cypress tests running, let’s see the steps of the recipe in the next section.</span></p>
<h2 class="heading-2" id="_idParaDest-398"><span class="koboSpan" id="kobo.1523.1">How to do it…</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1524.1">For this recipe, we have the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1525.1">users</span></code><span class="koboSpan" id="kobo.1526.1"> list and a search app that fetches some users from a JSON file using an HTTP request. </span><span class="koboSpan" id="kobo.1526.2">We’re going to assert a few conditions for the DOM, validate the response from the API, and assert the URL changes as well. </span><span class="koboSpan" id="kobo.1526.3">Let’s get started:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1527.1">First, we’ll try out the bundled </span><code class="inlineCode"><span class="koboSpan" id="kobo.1528.1">jQuery</span></code><span class="koboSpan" id="kobo.1529.1"> library along with Cypress. </span><span class="koboSpan" id="kobo.1529.2">We can access this using </span><code class="inlineCode"><span class="koboSpan" id="kobo.1530.1">Cypress.$</span></code><span class="koboSpan" id="kobo.1531.1">. </span><span class="koboSpan" id="kobo.1531.2">Let’s add another test and log out some DOM elements. </span><span class="koboSpan" id="kobo.1531.3">Update the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1532.1">users.cy.ts</span></code><span class="koboSpan" id="kobo.1533.1"> file, as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1534.1">...
</span><span class="hljs-title"><span class="koboSpan" id="kobo.1535.1">describe</span></span><span class="koboSpan" id="kobo.1536.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1537.1">'Users List Page'</span></span><span class="koboSpan" id="kobo.1538.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.1539.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1540.1"> {
  ...
  </span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1541.1">it</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1542.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1543.1">'should show the no results found message on search'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1544.1">, </span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1545.1">() =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1546.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1547.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1548.1"> { $ } = </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1549.1">Cypress</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1550.1">;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1551.1">cy.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1552.1">wait</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1553.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1554.1">'@searchUsers'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1555.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1556.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1557.1"> searchInput = $(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1558.1">'[data-test- id="searchUsersInput"]'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1559.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.1560.1">console</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1561.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1562.1">log</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1563.1">(searchInput);</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1564.1">})</span></strong></span><span class="koboSpan" id="kobo.1565.1">
});
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1566.1">If you look at the tests (Cypress window) now, and specifically</span><a id="_idIndexMarker923"/><span class="koboSpan" id="kobo.1567.1"> the console, you should see the log, as follows:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1568.1"><img alt="" role="presentation" src="../Images/B18469_11_14.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1569.1">Figure 11.14: Search input logged using jQuery via Cypress.$</span></p> </li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="2"><span class="koboSpan" id="kobo.1570.1">Now, let’s try to change the value of the search input so we can see the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1571.1">'No results'</span></code><span class="koboSpan" id="kobo.1572.1"> message. </span><span class="koboSpan" id="kobo.1572.2">Update the test further as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.1573.1">it</span></span><span class="koboSpan" id="kobo.1574.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1575.1">'should show the no results found message on search'</span></span><span class="koboSpan" id="kobo.1576.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.1577.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1578.1"> {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1579.1">const</span></span><span class="koboSpan" id="kobo.1580.1"> { $ } = </span><span class="hljs-title"><span class="koboSpan" id="kobo.1581.1">Cypress</span></span><span class="koboSpan" id="kobo.1582.1">;
    cy.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1583.1">wait</span></span><span class="koboSpan" id="kobo.1584.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1585.1">'@searchUsers'</span></span><span class="koboSpan" id="kobo.1586.1">);
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1587.1">const</span></span><span class="koboSpan" id="kobo.1588.1"> searchInput = $(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1589.1">'[data-test-id="searchUsersInput"]'</span></span><span class="koboSpan" id="kobo.1590.1">);
    </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1591.1">cy.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1592.1">wrap</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1593.1">(searchInput).</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1594.1">type</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1595.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1596.1">'abc123'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1597.1">);</span></strong></span><span class="koboSpan" id="kobo.1598.1">
});
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1599.1">Let’s add a new page object element in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1600.1">users.po.ts</span></code><span class="koboSpan" id="kobo.1601.1"> file so we can get the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1602.1">noResults</span></code><span class="koboSpan" id="kobo.1603.1"> message. </span><span class="koboSpan" id="kobo.1603.2">Update the file as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1604.1">...
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1605.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1606.1">const</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1607.1">getNoResultsMessage</span></span><span class="koboSpan" id="kobo.1608.1"> = () =&gt; {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1609.1">return</span></span><span class="koboSpan" id="kobo.1610.1"> cy.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1611.1">get</span></span><span class="koboSpan" id="kobo.1612.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1613.1">'[data-test-id="noResultsFoundMessage"]'</span></span><span class="koboSpan" id="kobo.1614.1">);
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1615.1">Let’s log the ‘‘</span><code class="inlineCode"><span class="koboSpan" id="kobo.1616.1">no results</span></code><span class="koboSpan" id="kobo.1617.1">'’ message using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1618.1">jQuery</span></code><span class="koboSpan" id="kobo.1619.1"> element by using the page object in combination with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1620.1">then</span></code><span class="koboSpan" id="kobo.1621.1"> method. </span><span class="koboSpan" id="kobo.1621.2">Update the test in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1622.1">users.cy.ts</span></code><span class="koboSpan" id="kobo.1623.1"> file as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.1624.1">it</span></span><span class="koboSpan" id="kobo.1625.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1626.1">'should show the no results found message on search'</span></span><span class="koboSpan" id="kobo.1627.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.1628.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1629.1"> {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1630.1">const</span></span><span class="koboSpan" id="kobo.1631.1"> { $ } = </span><span class="hljs-title"><span class="koboSpan" id="kobo.1632.1">Cypress</span></span><span class="koboSpan" id="kobo.1633.1">;
    cy.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1634.1">wait</span></span><span class="koboSpan" id="kobo.1635.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1636.1">'@searchUsers'</span></span><span class="koboSpan" id="kobo.1637.1">);
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1638.1">const</span></span><span class="koboSpan" id="kobo.1639.1"> searchInput = $(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1640.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1641.1">[data-test-id="searchUsersInput"]'</span></span><span class="koboSpan" id="kobo.1642.1">);
    cy.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1643.1">wrap</span></span><span class="koboSpan" id="kobo.1644.1">(searchInput).</span><span class="hljs-title"><span class="koboSpan" id="kobo.1645.1">type</span></span><span class="koboSpan" id="kobo.1646.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1647.1">'abc123'</span></span><span class="koboSpan" id="kobo.1648.1">);
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1649.1">getNoResultsMessage</span></span><span class="koboSpan" id="kobo.1650.1">().</span><span class="hljs-title"><span class="koboSpan" id="kobo.1651.1">then</span></span><span class="koboSpan" id="kobo.1652.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.1653.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1654.1">el</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1655.1">) =&gt;</span></span><span class="koboSpan" id="kobo.1656.1"> {
      </span><span class="hljs-variable"><span class="koboSpan" id="kobo.1657.1">console</span></span><span class="koboSpan" id="kobo.1658.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1659.1">log</span></span><span class="koboSpan" id="kobo.1660.1">(el);
    });
  });
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1661.1">You should see the no results</span><a id="_idIndexMarker924"/><span class="koboSpan" id="kobo.1662.1"> message in the console in the Cypress window, as follows:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1663.1"><img alt="" role="presentation" src="../Images/B18469_11_15.png"/></span></figure>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1664.1">Figure 11.15: noResults message logged using jQuery via Cypress.$</span></figure>
<p class="normal"><span class="koboSpan" id="kobo.1665.1">As you can see, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1666.1">jQuery</span></code><span class="koboSpan" id="kobo.1667.1"> element is logged in the console. </span><span class="koboSpan" id="kobo.1667.2">We’ll now use the Chai assertions to validate that it exists and has a message.</span></p> </li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="5"><span class="koboSpan" id="kobo.1668.1">Update the test further to check that the element exists and has the following text:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.1669.1">it</span></span><span class="koboSpan" id="kobo.1670.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1671.1">'should show the no results found message on search'</span></span><span class="koboSpan" id="kobo.1672.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.1673.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1674.1"> {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1675.1">const</span></span><span class="koboSpan" id="kobo.1676.1"> { $ } = </span><span class="hljs-title"><span class="koboSpan" id="kobo.1677.1">Cypress</span></span><span class="koboSpan" id="kobo.1678.1">;
    cy.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1679.1">wait</span></span><span class="koboSpan" id="kobo.1680.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1681.1">'@searchUsers'</span></span><span class="koboSpan" id="kobo.1682.1">);
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1683.1">const</span></span><span class="koboSpan" id="kobo.1684.1"> searchInput = $(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1685.1">'[data-test-</span></span>
<span class="hljs-keyword"> </span><span class="hljs-string"><span class="koboSpan" id="kobo.1686.1">id="searchUsersInput"]'</span></span><span class="koboSpan" id="kobo.1687.1">);
    cy.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1688.1">wrap</span></span><span class="koboSpan" id="kobo.1689.1">(searchInput).</span><span class="hljs-title"><span class="koboSpan" id="kobo.1690.1">type</span></span><span class="koboSpan" id="kobo.1691.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1692.1">'abc123'</span></span><span class="koboSpan" id="kobo.1693.1">);
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1694.1">getNoResultsMessage</span></span><span class="koboSpan" id="kobo.1695.1">().</span><span class="hljs-title"><span class="koboSpan" id="kobo.1696.1">then</span></span><span class="koboSpan" id="kobo.1697.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.1698.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1699.1">el</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1700.1">) =&gt;</span></span><span class="koboSpan" id="kobo.1701.1"> {
      </span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1702.1">expect</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1703.1">(el).</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1704.1">to</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1705.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1706.1">exist</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1707.1">;</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1708.1">expect</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1709.1">(el.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1710.1">text</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1711.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1712.1">trim</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1713.1">()).</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1714.1">to</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1715.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1716.1">eq</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1717.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1718.1">'Nothing returned for </span></strong></span> <span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1719.1">the following search'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1720.1">);</span></strong></span><span class="koboSpan" id="kobo.1721.1">
    });
  });
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1722.1">If you see the test now in Cypress, it should</span><a id="_idIndexMarker925"/><span class="koboSpan" id="kobo.1723.1"> be passing, as follows:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1724.1"><img alt="" role="presentation" src="../Images/B18469_11_16.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1725.1">Figure 11.16: Test passing with the usage of jQuery via Cypress</span></p></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="6"><span class="koboSpan" id="kobo.1726.1">We’re now going to use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1727.1">lodash.js</span></code><span class="koboSpan" id="kobo.1728.1"> package that is bundled with Cypress to iterate over each card and ensure the date of birth is correctly formatted. </span><span class="koboSpan" id="kobo.1728.2">Write another test in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1729.1">users.cy.ts</span></code><span class="koboSpan" id="kobo.1730.1"> file, as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1731.1">...
</span><span class="hljs-title"><span class="koboSpan" id="kobo.1732.1">describe</span></span><span class="koboSpan" id="kobo.1733.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1734.1">'Users List Page'</span></span><span class="koboSpan" id="kobo.1735.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.1736.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1737.1"> {
  ...
  </span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1738.1">it</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1739.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1740.1">'should show the dob on each user in the correct format'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1741.1">, </span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1742.1">() =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1743.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1744.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1745.1"> { $, _ } = </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1746.1">Cypress</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1747.1">;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1748.1">cy.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1749.1">wait</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1750.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1751.1">'@searchUsers'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1752.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1753.1">getUsersCards</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1754.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1755.1">then</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1756.1">(</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1757.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1758.1">cards</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1759.1">) =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1760.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1761.1">_.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1762.1">forEach</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1763.1">(cards, </span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1764.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1765.1">card</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1766.1">) =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1767.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1768.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1769.1"> cardItem = $(card);</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1770.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1771.1"> dobText = cardItem.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1772.1">find</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1773.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1774.1">'.dob'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1775.1">).</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1776.1">text</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1777.1">();</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1778.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1779.1"> dob = dobText.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1780.1">split</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1781.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1782.1">'Birthday:'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1783.1">)[</span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.1784.1">1</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1785.1">].</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1786.1">trim</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1787.1">();</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1788.1">expect</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1789.1">(dobRegex.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1790.1">test</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1791.1">(</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1792.1">dob</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1793.1">)).</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1794.1">to</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1795.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1796.1">be</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1797.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1798.1">true</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1799.1">;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1800.1">})</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1801.1">});</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1802.1">});</span></strong></span><span class="koboSpan" id="kobo.1803.1">
});
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1804.1">Let’s add another test</span><a id="_idIndexMarker926"/><span class="koboSpan" id="kobo.1805.1"> to use </span><code class="inlineCode"><span class="koboSpan" id="kobo.1806.1">lodash</span></code><span class="koboSpan" id="kobo.1807.1"> again. </span><span class="koboSpan" id="kobo.1807.2">We’ll ensure that all the names of the users are unique on the view, that is, there are no duplicate user cards. </span><span class="koboSpan" id="kobo.1807.3">Add another test in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1808.1">users.cy.ts</span></code><span class="koboSpan" id="kobo.1809.1"> file, as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1810.1">...
</span><span class="hljs-title"><span class="koboSpan" id="kobo.1811.1">describe</span></span><span class="koboSpan" id="kobo.1812.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1813.1">'Users List Page'</span></span><span class="koboSpan" id="kobo.1814.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.1815.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1816.1"> {
  ...
  </span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1817.1">it</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1818.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1819.1">'should have unique names for all the users'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1820.1">, </span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1821.1">() =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1822.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1823.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1824.1"> { $, _ } = </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1825.1">Cypress</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1826.1">;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1827.1">cy.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1828.1">wait</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1829.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1830.1">'@searchUsers'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1831.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1832.1">getUsersCards</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1833.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1834.1">then</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1835.1">(</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1836.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1837.1">cards</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1838.1">) =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1839.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1840.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1841.1"> names = _.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1842.1">map</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1843.1">(cards, </span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1844.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1845.1">card</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1846.1">) =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1847.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1848.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1849.1"> cardItem = $(card);</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1850.1">return</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1851.1"> cardItem.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1852.1">find</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1853.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1854.1">'h4'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1855.1">).</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1856.1">text</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1857.1">();</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1858.1">});</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1859.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1860.1"> uniqueNames = _.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1861.1">uniq</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1862.1">(names);</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1863.1">expect</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1864.1">(names.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1865.1">length</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1866.1">).</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1867.1">to</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1868.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1869.1">equal</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1870.1">(uniqueNames.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1871.1">length</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1872.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1873.1">});</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1874.1">});</span></strong></span><span class="koboSpan" id="kobo.1875.1">
});
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1876.1">The next package we’ll explore is the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1877.1">minimatch</span></code><span class="koboSpan" id="kobo.1878.1"> package. </span><span class="koboSpan" id="kobo.1878.2">When we tap on a user card, it opens the user details. </span><span class="koboSpan" id="kobo.1878.3">Since we append a timestamp to the URL as a query parameter, we can’t compare the URL as an exact match with our assertion. </span><span class="koboSpan" id="kobo.1878.4">Let’s use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1879.1">minimatch</span></code><span class="koboSpan" id="kobo.1880.1"> package to assert using a pattern instead. </span><span class="koboSpan" id="kobo.1880.2">Add a new test, as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1881.1">...
</span><span class="hljs-title"><span class="koboSpan" id="kobo.1882.1">describe</span></span><span class="koboSpan" id="kobo.1883.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1884.1">'Users List Page'</span></span><span class="koboSpan" id="kobo.1885.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.1886.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1887.1"> {
  ...
  </span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1888.1">it</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1889.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1890.1">'should go to the user details page with the user uuid'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1891.1">, </span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1892.1">() =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1893.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1894.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1895.1"> { minimatch, $ } = </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1896.1">Cypress</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1897.1">;</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1898.1">getUsersCards</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1899.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1900.1">then</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1901.1">(</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1902.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1903.1">cards</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1904.1">) =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1905.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1906.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1907.1"> userCard = cards[</span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.1908.1">0</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1909.1">];</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1910.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1911.1"> uuid = $(userCard).</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1912.1">attr</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1913.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1914.1">'ng-reflect-router-link'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1915.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1916.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1917.1">split</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1918.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1919.1">'/users/'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1920.1">)[</span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.1921.1">1</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1922.1">];</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1923.1">cy.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1924.1">wrap</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1925.1">(userCard).</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1926.1">click</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1927.1">();</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1928.1">cy.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1929.1">url</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1930.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1931.1">should</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1932.1">(</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1933.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1934.1">url</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1935.1">) =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1936.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1937.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1938.1"> urlMatches = </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1939.1">minimatch</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1940.1">(url,</span></strong></span>
<span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1941.1">`</span></strong><strong class="hljs-subst-slc"><span class="koboSpan" id="kobo.1942.1">${location.origin}</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1943.1">/users/</span></strong><strong class="hljs-subst-slc"><span class="koboSpan" id="kobo.1944.1">${uuid}</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1945.1">*`</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1946.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1947.1">{ </span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1948.1">debug</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1949.1">: </span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.1950.1">true</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1951.1"> });</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1952.1">expect</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1953.1">(urlMatches).</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1954.1">to</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1955.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1956.1">equal</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1957.1">(</span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.1958.1">true</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1959.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1960.1">});</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1961.1">});</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1962.1">});</span></strong></span><span class="koboSpan" id="kobo.1963.1">
});
</span></code></pre>
</li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.1964.1">The tests have now all passed using the bundled packages with Cypress. </span><span class="koboSpan" id="kobo.1964.2">Now that we’ve finished the recipe, let’s see how it all works in the next section.</span></p>
<h2 class="heading-2" id="_idParaDest-399"><span class="koboSpan" id="kobo.1965.1">How it works…</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1966.1">Cypress bundles </span><code class="inlineCode"><span class="koboSpan" id="kobo.1967.1">jQuery</span></code><span class="koboSpan" id="kobo.1968.1"> with it and we use</span><a id="_idIndexMarker927"/><span class="koboSpan" id="kobo.1969.1"> it via the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1970.1">Cypress.$</span></code><span class="koboSpan" id="kobo.1971.1"> property. </span><span class="koboSpan" id="kobo.1971.2">This allows us to perform everything that the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1972.1">jQuery</span></code><span class="koboSpan" id="kobo.1973.1"> function permits us to. </span><span class="koboSpan" id="kobo.1973.2">For example, you can use the following functions from the bundled </span><code class="inlineCode"><span class="koboSpan" id="kobo.1974.1">jQuery</span></code><span class="koboSpan" id="kobo.1975.1">:</span></p>
<ul>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1976.1">each</span></code><span class="koboSpan" id="kobo.1977.1">:</span><ul>
<li class="bulletList"><span class="koboSpan" id="kobo.1978.1">Usage: </span><code class="inlineCode"><span class="koboSpan" id="kobo.1979.1">$(elements).each(function(index, element) {})</span></code></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1980.1">Description: Iterates over a jQuery object, executing a function for each matched element</span></li>
</ul>
</li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1981.1">text</span></code><span class="koboSpan" id="kobo.1982.1">:</span><ul>
<li class="bulletList"><span class="koboSpan" id="kobo.1983.1">Usage: </span><code class="inlineCode"><span class="koboSpan" id="kobo.1984.1">$(selector).text()</span></code></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1985.1">Description: Gets the combined text contents of each element in the set of matched elements, including their descendants</span></li>
</ul>
</li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1986.1">val</span></code><span class="koboSpan" id="kobo.1987.1">:</span><ul>
<li class="bulletList"><span class="koboSpan" id="kobo.1988.1">Usage: </span><code class="inlineCode"><span class="koboSpan" id="kobo.1989.1">$(selector).val()</span></code></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1990.1">Description: Gets the current value of the first element in the set of matched elements</span></li>
</ul>
</li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1991.1">hasClass</span></code><span class="koboSpan" id="kobo.1992.1">:</span><ul>
<li class="bulletList"><span class="koboSpan" id="kobo.1993.1">Usage: </span><code class="inlineCode"><span class="koboSpan" id="kobo.1994.1">$(selector).hasClass(className)</span></code></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1995.1">Description: Determines whether any of the matched elements are assigned to the given class</span></li>
</ul>
</li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1996.1">addClass</span></code><span class="koboSpan" id="kobo.1997.1">:</span><ul>
<li class="bulletList"><span class="koboSpan" id="kobo.1998.1">Usage: </span><code class="inlineCode"><span class="koboSpan" id="kobo.1999.1">$(selector).addClass(className)</span></code></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2000.1">Description: Adds the specified class(es) to each element in the set of matched elements</span></li>
</ul>
</li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.2001.1">removeClass</span></code><span class="koboSpan" id="kobo.2002.1">:</span><ul>
<li class="bulletList"><span class="koboSpan" id="kobo.2003.1">Usage: </span><code class="inlineCode"><span class="koboSpan" id="kobo.2004.1">$(selector).removeClass(className)</span></code></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2005.1">Description: Removes a single class, multiple classes, or all classes from each element in the set of matched elements</span></li>
</ul>
</li>
</ul>
<div class="note">
<p class="normal"><span class="koboSpan" id="kobo.2006.1">IMPORTANT NOTE</span></p>
<p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.2007.1">Cypress.$</span></code><span class="koboSpan" id="kobo.2008.1"> can only fetch from the document</span><a id="_idIndexMarker928"/><span class="koboSpan" id="kobo.2009.1"> elements that are available immediately on the DOM. </span><span class="koboSpan" id="kobo.2009.2">This is great for debugging the DOM using the Chrome DevTools in the Cypress test window. </span><span class="koboSpan" id="kobo.2009.3">However, it is important to understand that it doesn’t have any context about the Angular change detection. </span><span class="koboSpan" id="kobo.2009.4">Also, you can’t query any element that isn’t visible on the page right from the beginning, as we experienced in the recipe—that is, it doesn’t wait for XHR calls for the elements to be visible.</span></p>
</div>
<p class="normal"><span class="koboSpan" id="kobo.2010.1">Cypress also bundles </span><code class="inlineCode"><span class="koboSpan" id="kobo.2011.1">lodash</span></code><span class="koboSpan" id="kobo.2012.1"> and exposes</span><a id="_idIndexMarker929"/><span class="koboSpan" id="kobo.2013.1"> it via the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2014.1">Cypress._</span></code><span class="koboSpan" id="kobo.2015.1"> object. </span><span class="koboSpan" id="kobo.2015.2">In the recipe, we use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2016.1">_.each()</span></code><span class="koboSpan" id="kobo.2017.1"> method to iterate over the card items to perform several tasks. </span><span class="koboSpan" id="kobo.2017.2">We also use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2018.1">_.uniq</span></code><span class="koboSpan" id="kobo.2019.1"> method, which takes an array and returns an array of unique items. </span><span class="koboSpan" id="kobo.2019.2">We then compare the lengths of both the original array and the unique array to ensure that our original array has all unique names. </span><span class="koboSpan" id="kobo.2019.3">Note that we can use any </span><code class="inlineCode"><span class="koboSpan" id="kobo.2020.1">lodash</span></code><span class="koboSpan" id="kobo.2021.1"> method in our Cypress tests and not just the mentioned methods.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2022.1">We also used the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2023.1">minimatch</span></code><span class="koboSpan" id="kobo.2024.1"> package, which Cypress exposes via the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2025.1">Cypress.minimatch</span></code><span class="koboSpan" id="kobo.2026.1"> object. </span><span class="koboSpan" id="kobo.2026.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.2027.1">minimatch</span></code><span class="koboSpan" id="kobo.2028.1"> package is great for matching and testing glob patterns against strings. </span><span class="koboSpan" id="kobo.2028.2">We use it to test the URL after navigating to a user’s detail page using a pattern. </span><span class="koboSpan" id="kobo.2028.3">One important thing to know when using </span><code class="inlineCode"><span class="koboSpan" id="kobo.2029.1">minimatch</span></code><span class="koboSpan" id="kobo.2030.1"> is that it compares the globs, which should contain the entire URL and not a string </span><em class="italic"><span class="koboSpan" id="kobo.2031.1">acting like a Regex</span></em><span class="koboSpan" id="kobo.2032.1">. </span><span class="koboSpan" id="kobo.2032.2">That’s why we use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2033.1">`{location.origin}/users/${uuid}*`</span></code><span class="koboSpan" id="kobo.2034.1"> statement to include the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2035.1">location.origin</span></code><span class="koboSpan" id="kobo.2036.1">.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2037.1">Easy peasy. </span><span class="koboSpan" id="kobo.2037.2">Now that you understand how</span><a id="_idIndexMarker930"/><span class="koboSpan" id="kobo.2038.1"> the recipe works, see the next section</span><a id="_idIndexMarker931"/><span class="koboSpan" id="kobo.2039.1"> for some</span><a id="_idIndexMarker932"/><span class="koboSpan" id="kobo.2040.1"> useful links.</span></p>
<h2 class="heading-2" id="_idParaDest-400"><span class="koboSpan" id="kobo.2041.1">See also</span></h2>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.2042.1">Cypress</span><a id="_idIndexMarker933"/><span class="koboSpan" id="kobo.2043.1"> bundled libraries: </span><a href="https://docs.cypress.io/guides/references/bundled-tools"><span class="url"><span class="koboSpan" id="kobo.2044.1">https://docs.cypress.io/guides/references/bundled-tools</span></span></a></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.2045.1">jQuery</span></code><span class="koboSpan" id="kobo.2046.1">: </span><a href="https://jquery.com/"><span class="url"><span class="koboSpan" id="kobo.2047.1">https://jquery.com/</span></span></a></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.2048.1">lodash</span></code><span class="koboSpan" id="kobo.2049.1">: </span><a href="https://lodash.com"><span class="url"><span class="koboSpan" id="kobo.2050.1">https://lodash.com</span></span></a></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.2051.1">Minimatch.js</span></code><span class="koboSpan" id="kobo.2052.1">: </span><a href="https://github.com/isaacs/minimatch"><span class="url"><span class="koboSpan" id="kobo.2053.1">https://github.com/isaacs/minimatch</span></span></a></li>
</ul>
<h1 class="heading-1" id="_idParaDest-401"><span class="koboSpan" id="kobo.2054.1">Using Cypress fixtures to provide mock data</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.2055.1">When it comes to writing E2E tests, fixtures</span><a id="_idIndexMarker934"/><span class="koboSpan" id="kobo.2056.1"> play a great role in making sure the tests</span><a id="_idIndexMarker935"/><span class="koboSpan" id="kobo.2057.1"> are not flaky (don’t have different results in different test runs). </span><span class="koboSpan" id="kobo.2057.2">Consider that your tests rely on fetching data from your API server, or your tests include snapshot testing, which includes fetching images from a </span><strong class="keyWord"><span class="koboSpan" id="kobo.2058.1">Content Delivery Network</span></strong><span class="koboSpan" id="kobo.2059.1"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.2060.1">CDN</span></strong><span class="koboSpan" id="kobo.2061.1">) or a third-party API. </span><span class="koboSpan" id="kobo.2061.2">Although they’re technically required for the tests to run</span><a id="_idIndexMarker936"/><span class="koboSpan" id="kobo.2062.1"> successfully, it is not important that the server data and the images are fetched from the original source; therefore, we can create fixtures for them. </span><span class="koboSpan" id="kobo.2062.2">In this recipe, we’ll create fixtures for the bucket data to avoid having to run the server for the e2e tests.</span></p>
<h2 class="heading-2" id="_idParaDest-402"><span class="koboSpan" id="kobo.2063.1">Getting ready</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2064.1">The app that we are going to work with resides in </span><code class="inlineCode"><span class="koboSpan" id="kobo.2065.1">start/apps/chapter11/ng-cy-mock-data</span></code><span class="koboSpan" id="kobo.2066.1"> inside the cloned repository. </span><span class="koboSpan" id="kobo.2066.2">However, the e2e tests are in the folder </span><code class="inlineCode"><span class="koboSpan" id="kobo.2067.1">start/apps/chapter11/ng-cy-mock-data-e2e</span></code><span class="koboSpan" id="kobo.2068.1">. </span><span class="koboSpan" id="kobo.2068.2">In this recipe, we’re going to modify files for the e2e project only. </span><span class="koboSpan" id="kobo.2068.3">Let’s run the e2e tests by following these steps:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.2069.1">Open the code repository in your code editor.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.2070.1">Open the terminal, navigate to the code repository directory, and run the following command to run the e2e tests for the project with an API server:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.2071.1">npm run e2e ng-cy-mock-data with-server
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2072.1">This should open the Cypress window along with the server. </span><span class="koboSpan" id="kobo.2072.2">Select Chrome for testing and click the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2073.1">app.cy.ts</span></code><span class="koboSpan" id="kobo.2074.1"> file to run the tests, and you should see the following:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2075.1"><img alt="" role="presentation" src="../Images/B18469_11_17.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2076.1">Figure 11.17: ng-cy-mock-data tests running with Cypress</span></p></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.2077.1">Now that we have the Cypress</span><a id="_idIndexMarker937"/><span class="koboSpan" id="kobo.2078.1"> tests running, let’s see the steps</span><a id="_idIndexMarker938"/><span class="koboSpan" id="kobo.2079.1"> of the recipe in the next section.</span></p>
<h2 class="heading-2" id="_idParaDest-403"><span class="koboSpan" id="kobo.2080.1">How to do it…</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2081.1">We have the bucket app, which we have used in many recipes in this book. </span><span class="koboSpan" id="kobo.2081.2">However, we’ll write some e2e tests in this one with Cypress. </span><span class="koboSpan" id="kobo.2081.3">The interesting part is that the app talks to a backend server to manage the bucket items. </span><span class="koboSpan" id="kobo.2081.4">Our tests are going to break when we add or remove items from the bucket with the real API. </span><span class="koboSpan" id="kobo.2081.5">Let’s get started:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.2082.1">Our backend (</span><code class="inlineCode"><span class="koboSpan" id="kobo.2083.1">fake-be</span></code><span class="koboSpan" id="kobo.2084.1">) returns four bucket items by default. </span><span class="koboSpan" id="kobo.2084.2">See the </span><em class="italic"><span class="koboSpan" id="kobo.2085.1">How it works… </span></em><span class="koboSpan" id="kobo.2086.1">section to understand how. </span><span class="koboSpan" id="kobo.2086.2">We will add a new test to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2087.1">app.cy.ts</span></code><span class="koboSpan" id="kobo.2088.1"> file later to ensure that we are able to add another item to the bucket. </span><span class="koboSpan" id="kobo.2088.2">But before that, let’s add some page objects in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2089.1">app.po.ts</span></code><span class="koboSpan" id="kobo.2090.1"> file, as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2091.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2092.1">const</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2093.1">getHeaderTitle</span></span><span class="koboSpan" id="kobo.2094.1"> = () =&gt;
</span><span class="hljs-keyword"> </span><span class="koboSpan" id="kobo.2095.1">cy.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2096.1">get</span></span><span class="koboSpan" id="kobo.2097.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2098.1">'.toolbar__title'</span></span><span class="koboSpan" id="kobo.2099.1">);
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2100.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2101.1">const</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2102.1">getFruits</span></span><span class="koboSpan" id="kobo.2103.1"> = () =&gt; cy.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2104.1">get</span></span><span class="koboSpan" id="kobo.2105.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2106.1">'.fruits__item'</span></span><span class="koboSpan" id="kobo.2107.1">);
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2108.1">export</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2109.1">const</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2110.1">getFruitSelector</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2111.1"> = () =&gt; cy.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2112.1">get</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2113.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2114.1">'[data-test-id="fruitSelector"'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2115.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2116.1">export</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2117.1">const</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2118.1">getAddItemSubmitButton</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2119.1"> = () =&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2120.1">cy.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2121.1">get</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2122.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2123.1">'[data-test-id="addItemSubmitBtn"'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2124.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2125.1">export</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2126.1">const</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2127.1">getSuccessToast</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2128.1"> = () =&gt; cy.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2129.1">get</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2130.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2131.1">'#toast-container .toast-success'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2132.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2133.1">export</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2134.1">const</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2135.1">getErrorToast</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2136.1"> = () =&gt; cy.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2137.1">get</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2138.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2139.1">'#toast-</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2140.1">container .toast-error'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2141.1">);</span></strong></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2142.1">Now we can add our test</span><a id="_idIndexMarker939"/><span class="koboSpan" id="kobo.2143.1"> to ensure that we’re able to add</span><a id="_idIndexMarker940"/><span class="koboSpan" id="kobo.2144.1"> an item to the bucket. </span><span class="koboSpan" id="kobo.2144.2">Add the following test to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2145.1">app.cy.ts</span></code><span class="koboSpan" id="kobo.2146.1"> file:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2147.1">import</span></span><span class="koboSpan" id="kobo.2148.1"> { </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2149.1">getAddItemSubmitButton</span></strong></span><span class="koboSpan" id="kobo.2150.1">, </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2151.1">getFruitSelector</span></strong></span><span class="koboSpan" id="kobo.2152.1">, getFruits, getHeaderTitle, </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2153.1">getSuccessToast </span></strong></span><span class="koboSpan" id="kobo.2154.1">} </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2155.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2156.1">'../support/app.po'</span></span><span class="koboSpan" id="kobo.2157.1">;
 
</span><span class="hljs-title"><span class="koboSpan" id="kobo.2158.1">describe</span></span><span class="koboSpan" id="kobo.2159.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2160.1">'ng-cy-mock-data'</span></span><span class="koboSpan" id="kobo.2161.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.2162.1">() =&gt;</span></span><span class="koboSpan" id="kobo.2163.1"> {
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.2164.1">beforeEach</span></span><span class="koboSpan" id="kobo.2165.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.2166.1">() =&gt;</span></span><span class="koboSpan" id="kobo.2167.1"> {
    cy.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2168.1">visit</span></span><span class="koboSpan" id="kobo.2169.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2170.1">'/'</span></span><span class="koboSpan" id="kobo.2171.1">)
  });
 
  …
 
  </span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2172.1">it</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2173.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2174.1">'should add a bucket item to the list'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2175.1">, </span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.2176.1">() =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2177.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2178.1">getFruitSelector</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2179.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2180.1">select</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2181.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2182.1">'Apple </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2183.1"><img alt="" role="presentation" src="../Images/B18469_11_001.png"/></span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2184.1">'</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.2185.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2186.1">getAddItemSubmitButton</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.2187.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2188.1">click</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.2189.1">();</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2190.1">getSuccessToast</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.2191.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2192.1">should</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.2193.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2194.1">'be.visible'</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.2195.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2196.1">getSuccessToast</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.2197.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2198.1">then</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.2199.1">(</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.2200.1">el =&gt; {</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2201.1">expect</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.2202.1">(el.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2203.1">text</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.2204.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2205.1">trim</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.2206.1">()).to.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2207.1">eq</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.2208.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2209.1">'Bucket item added'</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.2210.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.2211.1">});</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2212.1">getFruits</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.2213.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2214.1">should</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.2215.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2216.1">'have.length'</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.2217.1">, </span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.2218.1">5</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.2219.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.2220.1">});</span></strong></span><span class="koboSpan" id="kobo.2221.1"> 
 
});
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2222.1">This is the point where our tests start to break, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.2223.1">Figure 11.18</span></em><span class="koboSpan" id="kobo.2224.1">. </span><span class="koboSpan" id="kobo.2224.2">Since our test adds an item every time it runs to the actual server, we cannot expect the server to return the same number of items (four items) as our test, until we restart the server.</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2225.1"><img alt="" role="presentation" src="../Images/B18469_11_18.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2226.1">Figure 11.18: Tests failing because of adding data to a real server</span></p> </li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="3"><span class="koboSpan" id="kobo.2227.1">We will first create</span><a id="_idIndexMarker941"/><span class="koboSpan" id="kobo.2228.1"> a fixture for our HTTP call </span><a id="_idIndexMarker942"/><span class="koboSpan" id="kobo.2229.1">to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2230.1">fake-be</span></code><span class="koboSpan" id="kobo.2231.1"> backend. </span><span class="koboSpan" id="kobo.2231.2">Create a new file under the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2232.1">src/fixtures</span></code><span class="koboSpan" id="kobo.2233.1"> folder, named </span><code class="inlineCode"><span class="koboSpan" id="kobo.2234.1">get-bucket.json</span></code><span class="koboSpan" id="kobo.2235.1">. </span><span class="koboSpan" id="kobo.2235.2">Then add the following JSON data to it:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2236.1">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.2237.1">"bucket"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2238.1">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.2239.1">[</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.2240.1">{</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.2241.1">"id"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2242.1">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.2243.1">1</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2244.1">,</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.2245.1">"name"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2246.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2247.1">"Apple </span><span class="koboSpan" id="kobo.2248.1"><img alt="" role="presentation" src="../Images/B18469_11_001.png"/></span><span class="koboSpan" id="kobo.2249.1">"</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.2250.1">},</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.2251.1">{</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.2252.1">"id"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2253.1">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.2254.1">2</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2255.1">,</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.2256.1">"name"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2257.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2258.1">"Banana </span><span class="koboSpan" id="kobo.2259.1"><img alt="" role="presentation" src="../Images/B18469_11_003.png"/></span><span class="koboSpan" id="kobo.2260.1">"</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.2261.1">},</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.2262.1">{</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.2263.1">"id"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2264.1">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.2265.1">3</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2266.1">,</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.2267.1">"name"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2268.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2269.1">"Grapes </span><span class="koboSpan" id="kobo.2270.1"><img alt="" role="presentation" src="../Images/B18469_11_004.png"/></span><span class="koboSpan" id="kobo.2271.1">"</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.2272.1">},</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.2273.1">{</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.2274.1">"id"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2275.1">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.2276.1">4</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2277.1">,</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.2278.1">"name"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2279.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2280.1">"Cherry </span><span class="koboSpan" id="kobo.2281.1"><img alt="" role="presentation" src="../Images/B18469_11_005.png"/></span><span class="koboSpan" id="kobo.2282.1">"</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.2283.1">}</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.2284.1">]</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.2285.1">}</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2286.1">Now, let’s use the fixture in our </span><code class="inlineCode"><span class="koboSpan" id="kobo.2287.1">app.cy.ts</span></code><span class="koboSpan" id="kobo.2288.1"> file. </span><span class="koboSpan" id="kobo.2288.2">We’ll use it in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2289.1">beforeEach</span></code><span class="koboSpan" id="kobo.2290.1"> life cycle hook since we want to use the fixture for all the tests in the file. </span><span class="koboSpan" id="kobo.2290.2">Update the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2291.1">app.cy.ts</span></code><span class="koboSpan" id="kobo.2292.1"> file, as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2293.1">...
</span><span class="hljs-title"><span class="koboSpan" id="kobo.2294.1">describe</span></span><span class="koboSpan" id="kobo.2295.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2296.1">'ng-cy-mock-data'</span></span><span class="koboSpan" id="kobo.2297.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.2298.1">() =&gt;</span></span><span class="koboSpan" id="kobo.2299.1"> {
  </span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2300.1">beforeEach</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2301.1">(</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.2302.1">() =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2303.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2304.1">cy.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2305.1">fixture</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2306.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2307.1">"get-bucket"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2308.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2309.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2310.1">then</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2311.1">(</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.2312.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.2313.1">response</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.2314.1">) =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2315.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2316.1">cy.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2317.1">intercept</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2318.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2319.1">'GET'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2320.1">, </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2321.1">'http://localhost:3333/api/bucket'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2322.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2323.1">response)</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2324.1">return</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2325.1"> cy.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2326.1">fixture</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2327.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2328.1">"-bucket"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2329.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2330.1">})</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2331.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2332.1">visit</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2333.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2334.1">'/'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2335.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2336.1">})</span></strong></span><span class="koboSpan" id="kobo.2337.1">;
     ...
</span><span class="koboSpan" id="kobo.2337.2">});
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2338.1">This does not fix the issue since the add item to bucket call is still sent to the real API. </span><span class="koboSpan" id="kobo.2338.2">We’ll have to create the fixture for it as well.</span></p> </li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="5"><span class="koboSpan" id="kobo.2339.1">Create a new file inside</span><a id="_idIndexMarker943"/><span class="koboSpan" id="kobo.2340.1"> the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2341.1">src/fixtures</span></code><span class="koboSpan" id="kobo.2342.1"> folder. </span><span class="koboSpan" id="kobo.2342.2">Name</span><a id="_idIndexMarker944"/><span class="koboSpan" id="kobo.2343.1"> it </span><code class="inlineCode"><span class="koboSpan" id="kobo.2344.1">add-bucket-item.json</span></code><span class="koboSpan" id="kobo.2345.1"> and add the following code to it:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2346.1">{</span></span>
<span class="hljs-attr"><span class="koboSpan" id="kobo.2347.1">"fruit"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2348.1">:</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.2349.1">{</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.2350.1">"id"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2351.1">:</span></span> <span class="hljs-number"><span class="koboSpan" id="kobo.2352.1">5</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2353.1">,</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.2354.1">"name"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2355.1">:</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2356.1">"Apple </span><span class="koboSpan" id="kobo.2357.1"><img alt="" role="presentation" src="../Images/B18469_11_001.png"/></span><span class="koboSpan" id="kobo.2358.1">"</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.2359.1">}</span></span>
<span class="hljs-punctuation"><span class="koboSpan" id="kobo.2360.1">}</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2361.1">We will now use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2362.1">add-bucket-item</span></code><span class="koboSpan" id="kobo.2363.1"> fixture in our tests file. </span><span class="koboSpan" id="kobo.2363.2">Update the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2364.1">app.cy.ts</span></code><span class="koboSpan" id="kobo.2365.1"> file, as follows to use the fixture:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2366.1">...
 
</span><span class="hljs-title"><span class="koboSpan" id="kobo.2367.1">describe</span></span><span class="koboSpan" id="kobo.2368.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2369.1">'ng-cy-mock-data'</span></span><span class="koboSpan" id="kobo.2370.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.2371.1">() =&gt;</span></span><span class="koboSpan" id="kobo.2372.1"> {
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.2373.1">beforeEach</span></span><span class="koboSpan" id="kobo.2374.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.2375.1">() =&gt;</span></span><span class="koboSpan" id="kobo.2376.1"> {
    cy.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2377.1">fixture</span></span><span class="koboSpan" id="kobo.2378.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2379.1">"get-bucket"</span></span><span class="koboSpan" id="kobo.2380.1">)
      .</span><span class="hljs-title"><span class="koboSpan" id="kobo.2381.1">then</span></span><span class="koboSpan" id="kobo.2382.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.2383.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2384.1">getBucketResp</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2385.1">) =&gt;</span></span><span class="koboSpan" id="kobo.2386.1"> {
        cy.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2387.1">intercept</span></span><span class="koboSpan" id="kobo.2388.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2389.1">'GET'</span></span><span class="koboSpan" id="kobo.2390.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.2391.1">'http://localhost:3333/api/bucket'</span></span><span class="koboSpan" id="kobo.2392.1">,
          getBucketResp)
        </span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2393.1">return</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2394.1"> cy.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2395.1">fixture</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2396.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2397.1">"add-bucket-item"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2398.1">);</span></strong></span><span class="koboSpan" id="kobo.2399.1">
      })
      </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2400.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2401.1">then</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2402.1">(</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.2403.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.2404.1">addItemResp</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.2405.1">) =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2406.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2407.1">cy.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2408.1">intercept</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2409.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2410.1">'POST'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2411.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2412.1">'http://localhost:3333/api/bucket'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2413.1">, addItemResp)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2414.1">})</span></strong></span><span class="koboSpan" id="kobo.2415.1">
.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2416.1">visit</span></span><span class="koboSpan" id="kobo.2417.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2418.1">'/'</span></span><span class="koboSpan" id="kobo.2419.1">)
  });
  ...
</span><span class="koboSpan" id="kobo.2419.2">});
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2420.1">Now if you run the e2e tests, you should</span><a id="_idIndexMarker945"/><span class="koboSpan" id="kobo.2421.1"> see all the tests passing. </span><span class="koboSpan" id="kobo.2421.2">It does</span><a id="_idIndexMarker946"/><span class="koboSpan" id="kobo.2422.1"> not matter how many times you refresh the Cypress window; they will always pass because the responses are the same every time:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2423.1"><img alt="" role="presentation" src="../Images/B18469_11_19.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2424.1">Figure 11.19: Tests passing for add-bucket-item with fixtures</span></p></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="7"><span class="koboSpan" id="kobo.2425.1">We will now create a test for deleting an item and ensuring that we see the toast and one item is removed from the view. </span><span class="koboSpan" id="kobo.2425.2">Let’s add another test in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2426.1">app.cy.ts</span></code><span class="koboSpan" id="kobo.2427.1"> file as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2428.1">...
</span><span class="hljs-title"><span class="koboSpan" id="kobo.2429.1">describe</span></span><span class="koboSpan" id="kobo.2430.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2431.1">'ng-cy-mock-data'</span></span><span class="koboSpan" id="kobo.2432.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.2433.1">() =&gt;</span></span><span class="koboSpan" id="kobo.2434.1"> {
  ...
  </span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2435.1">it</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2436.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2437.1">'should delete a bucket item from the list'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2438.1">, </span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.2439.1">() =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2440.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2441.1">getFruits</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2442.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2443.1">should</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2444.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2445.1">'have.length'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2446.1">, </span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.2447.1">4</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2448.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2449.1">getFruits</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2450.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2451.1">eq</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2452.1">(</span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.2453.1">0</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2454.1">).</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2455.1">find</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2456.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2457.1">'.fruits__item__delete-icon'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2458.1">).</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2459.1">click</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2460.1">();</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2461.1">getSuccessToast</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2462.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2463.1">should</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2464.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2465.1">'be.visible'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2466.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2467.1">getSuccessToast</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2468.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2469.1">then</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2470.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.2471.1">el</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.2472.1"> =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2473.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2474.1">expect</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2475.1">(el.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2476.1">text</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2477.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2478.1">trim</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2479.1">()).</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.2480.1">to</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2481.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2482.1">eq</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2483.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2484.1">'Bucket item deleted'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2485.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2486.1">});</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2487.1">getFruits</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2488.1">().</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2489.1">should</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2490.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2491.1">'have.length'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2492.1">, </span></strong><strong class="hljs-number-slc"><span class="koboSpan" id="kobo.2493.1">3</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2494.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2495.1">});</span></strong></span><span class="koboSpan" id="kobo.2496.1">
});
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2497.1">If you run the tests now, you’ll see</span><a id="_idIndexMarker947"/><span class="koboSpan" id="kobo.2498.1"> that the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2499.1">delete item</span></code><span class="koboSpan" id="kobo.2500.1"> test fails</span><a id="_idIndexMarker948"/><span class="koboSpan" id="kobo.2501.1"> because it can’t find the item. </span><span class="koboSpan" id="kobo.2501.2">That’s because this </span><code class="inlineCode"><span class="koboSpan" id="kobo.2502.1">DELETE</span></code><span class="koboSpan" id="kobo.2503.1"> call is still being sent to the actual server. </span><span class="koboSpan" id="kobo.2503.2">If you had your server running, you would see an error, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.2504.1">Figure 11.20</span></em><span class="koboSpan" id="kobo.2505.1">:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2506.1"><img alt="" role="presentation" src="../Images/B18469_11_20.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2507.1">Figure 11.20: Item not found error</span></p></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="8"><span class="koboSpan" id="kobo.2508.1">We’ll create a new fixture in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2509.1">src/fixtures</span></code><span class="koboSpan" id="kobo.2510.1"> folder named </span><code class="inlineCode"><span class="koboSpan" id="kobo.2511.1">delete-bucket-item.json</span></code><span class="koboSpan" id="kobo.2512.1">. </span><span class="koboSpan" id="kobo.2512.2">Add the following code to it:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2513.1">{</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.2514.1">"success"</span></span><span class="hljs-punctuation"><span class="koboSpan" id="kobo.2515.1">:</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2516.1">true</span></span> <span class="hljs-punctuation"><span class="koboSpan" id="kobo.2517.1">}</span></span>
</code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.2518.1">Now let’s use the fixture in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2519.1">app.cy.ts</span></code><span class="koboSpan" id="kobo.2520.1"> file in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2521.1">beforeEach()</span></code><span class="koboSpan" id="kobo.2522.1"> hook, as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.2523.1">...
</span><span class="hljs-title"><span class="koboSpan" id="kobo.2524.1">describe</span></span><span class="koboSpan" id="kobo.2525.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2526.1">'ng-cy-mock-data'</span></span><span class="koboSpan" id="kobo.2527.1">, </span><span class="hljs-function"><span class="koboSpan" id="kobo.2528.1">() =&gt;</span></span><span class="koboSpan" id="kobo.2529.1"> {
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.2530.1">beforeEach</span></span><span class="koboSpan" id="kobo.2531.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.2532.1">() =&gt;</span></span><span class="koboSpan" id="kobo.2533.1"> {
    cy.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2534.1">fixture</span></span><span class="koboSpan" id="kobo.2535.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2536.1">"get-bucket"</span></span><span class="koboSpan" id="kobo.2537.1">)
      .</span><span class="hljs-title"><span class="koboSpan" id="kobo.2538.1">then</span></span><span class="koboSpan" id="kobo.2539.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.2540.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2541.1">response</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2542.1">) =&gt;</span></span><span class="koboSpan" id="kobo.2543.1"> {
        cy.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2544.1">intercept</span></span><span class="koboSpan" id="kobo.2545.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2546.1">'GET'</span></span><span class="koboSpan" id="kobo.2547.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.2548.1">'http://localhost:3333/api/bucket'</span></span><span class="koboSpan" id="kobo.2549.1">,
          response)
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2550.1">return</span></span><span class="koboSpan" id="kobo.2551.1"> cy.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2552.1">fixture</span></span><span class="koboSpan" id="kobo.2553.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2554.1">"add-bucket-item"</span></span><span class="koboSpan" id="kobo.2555.1">);
      })
      .</span><span class="hljs-title"><span class="koboSpan" id="kobo.2556.1">then</span></span><span class="koboSpan" id="kobo.2557.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.2558.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2559.1">response</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2560.1">) =&gt;</span></span><span class="koboSpan" id="kobo.2561.1"> {
        cy.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2562.1">intercept</span></span><span class="koboSpan" id="kobo.2563.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2564.1">'POST'</span></span><span class="koboSpan" id="kobo.2565.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.2566.1">'http://localhost:3333/api/bucket'</span></span><span class="koboSpan" id="kobo.2567.1">,
          response)
        </span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2568.1">return</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2569.1"> cy.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2570.1">fixture</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2571.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2572.1">"delete-bucket-item"</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2573.1">);</span></strong></span><span class="koboSpan" id="kobo.2574.1">
      })
      </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2575.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2576.1">then</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2577.1">(</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.2578.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.2579.1">deleteItemResp</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.2580.1">) =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2581.1"> { </span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2582.1">cy.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2583.1">intercept</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2584.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2585.1">'DELETE'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2586.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2587.1">'</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2588.1">http://localhost:3333/api/bucket/*'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2589.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2590.1">deleteItemResp) </span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2591.1">})</span></strong></span><span class="koboSpan" id="kobo.2592.1">
      .</span><span class="hljs-title"><span class="koboSpan" id="kobo.2593.1">visit</span></span><span class="koboSpan" id="kobo.2594.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2595.1">'/'</span></span><span class="koboSpan" id="kobo.2596.1">)
  });
  ...
</span><span class="koboSpan" id="kobo.2596.2">});
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2597.1">If you see the tests</span><a id="_idIndexMarker949"/><span class="koboSpan" id="kobo.2598.1"> now, all of them should</span><a id="_idIndexMarker950"/><span class="koboSpan" id="kobo.2599.1"> be passing, as follows:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.2600.1"><img alt="" role="presentation" src="../Images/B18469_11_21.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.2601.1">Figure 11.21: All tests passing after using fixtures</span></p></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.2602.1">Great! </span><span class="koboSpan" id="kobo.2602.2">You now know how to use fixtures in Cypress E2E tests. </span><span class="koboSpan" id="kobo.2602.3">Now that you’ve finished the recipe, see the next section for how this works.</span></p>
<h2 class="heading-2" id="_idParaDest-404"><span class="koboSpan" id="kobo.2603.1">How it works…</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2604.1">We had an initial test in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2605.1">app.cy.ts</span></code><span class="koboSpan" id="kobo.2606.1"> file to ensure that we get four bucket items from the server when the app loads. </span><span class="koboSpan" id="kobo.2606.2">You can see the backend file that sends the default bucket data, which resides at </span><code class="inlineCode"><span class="koboSpan" id="kobo.2607.1">&lt;workspace-root&gt;/codewithahsan/e2e/fake-be/src/app/bucket/bucket.service.ts</span></code><span class="koboSpan" id="kobo.2608.1">. </span><span class="koboSpan" id="kobo.2608.2">However, as soon as we start adding items to the bucket via our tests, our tests break because we’re working with real data. </span><span class="koboSpan" id="kobo.2608.3">And we should rarely be doing that to ensure we can make assertions accurately. </span><span class="koboSpan" id="kobo.2608.4">That’s why big teams have test environments where they seed the data into the database if they really want to work with real data. </span><span class="koboSpan" id="kobo.2608.5">Since our bucket app is super small, and we don’t really need to work with real data, we add fixtures in this recipe. </span><span class="koboSpan" id="kobo.2608.6">Fixtures in a Cypress test are registered with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2609.1">cy.fixture</span></code><span class="koboSpan" id="kobo.2610.1"> method, which allows us to use data from a file. </span><span class="koboSpan" id="kobo.2610.2">In this recipe, we use fixtures for all the HTTP calls the app makes to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2611.1">fake-be</span></code><span class="koboSpan" id="kobo.2612.1"> server, that is, the following:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.2613.1">Get all bucket data – </span><code class="inlineCode"><span class="koboSpan" id="kobo.2614.1">GET</span></code> <code class="inlineCode"><span class="koboSpan" id="kobo.2615.1">http://localhost:3333/api/bucket</span></code></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2616.1">Add item to the bucket – </span><code class="inlineCode"><span class="koboSpan" id="kobo.2617.1">POST</span></code> <code class="inlineCode"><span class="koboSpan" id="kobo.2618.1">http://localhost:3333/api/bucket</span></code></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2619.1">Delete item from the bucket – </span><code class="inlineCode"><span class="koboSpan" id="kobo.2620.1">DELETE</span></code> <code class="inlineCode"><span class="koboSpan" id="kobo.2621.1">http://localhost:3333/api/bucket/ITEM_ID</span></code></li>
</ul>
<p class="normal"><span class="koboSpan" id="kobo.2622.1">Notice that for each HTTP call, we use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2623.1">cy.fixture('FIXTURE_NAME')</span></code><span class="koboSpan" id="kobo.2624.1"> without the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2625.1">.json</span></code><span class="koboSpan" id="kobo.2626.1"> extension, which essentially points to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2627.1">cypress/fixture/FIXTURE_NAME.json</span></code><span class="koboSpan" id="kobo.2628.1"> file.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2629.1">First, we use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2630.1">cy.fixture</span></code><span class="koboSpan" id="kobo.2631.1"> method to register the fixture (or to fetch it). </span><span class="koboSpan" id="kobo.2631.2">Then we use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2632.1">then</span></code><span class="koboSpan" id="kobo.2633.1"> method to get the contents of the fixture (JSON) file. </span><span class="koboSpan" id="kobo.2633.2">Then we use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2634.1">cy.intercept</span></code><span class="koboSpan" id="kobo.2635.1"> method to intercept the HTTP call using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2636.1">GET</span></code><span class="koboSpan" id="kobo.2637.1">/</span><code class="inlineCode"><span class="koboSpan" id="kobo.2638.1">POST</span></code><span class="koboSpan" id="kobo.2639.1">/</span><code class="inlineCode"><span class="koboSpan" id="kobo.2640.1">DELETE</span></code><span class="koboSpan" id="kobo.2641.1"> method and the URL pattern as a </span><code class="inlineCode"><span class="koboSpan" id="kobo.2642.1">Minimatch</span></code><span class="koboSpan" id="kobo.2643.1"> glob pattern to intercept the HTTP call to get the fixture response and provide it as the response</span><a id="_idIndexMarker951"/><span class="koboSpan" id="kobo.2644.1"> for the HTTP call. </span><span class="koboSpan" id="kobo.2644.2">As a result, all the intercepted calls matching the glob patterns</span><a id="_idIndexMarker952"/><span class="koboSpan" id="kobo.2645.1"> use our fixtures.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.2646.1">Now that you understand how the recipe works, see the next section for some resources.</span></p>
<h2 class="heading-2" id="_idParaDest-405"><span class="koboSpan" id="kobo.2647.1">See also</span></h2>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.2648.1">Cypress fixtures</span><a id="_idIndexMarker953"/><span class="koboSpan" id="kobo.2649.1"> documentation: </span><a href="https://docs.cypress.io/api/commands/fixture"><span class="url"><span class="koboSpan" id="kobo.2650.1">https://docs.cypress.io/api/commands/fixture</span></span></a></li>
<li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.2651.1">cy.intercept</span></code><span class="koboSpan" id="kobo.2652.1"> method</span><a id="_idIndexMarker954"/><span class="koboSpan" id="kobo.2653.1"> documentation: </span><a href="https://docs.cypress.io/api/commands/intercept"><span class="url"><span class="koboSpan" id="kobo.2654.1">https://docs.cypress.io/api/commands/intercept</span></span></a></li>
</ul>
<h1 class="heading-1"><span class="koboSpan" id="kobo.2655.1">Learn more on Discord</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.2656.1">To join the Discord community for this book – where you can share feedback, ask questions to the author, and learn about new releases – follow the QR code below:</span></p>
<p class="normal"><a href="Chapter_11.xhtml"><span class="url"><span class="koboSpan" id="kobo.2657.1">https://packt.link/AngularCookbook2e</span></span></a></p>
<p class="normal"><span class="koboSpan" id="kobo.2658.1"><img alt="" role="presentation" src="../Images/QR_Code1388317275422265.png"/></span></p>
</div>
</body></html>