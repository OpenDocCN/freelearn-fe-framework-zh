<html><head></head><body>
  <div class="Basic-Text-Frame" id="_idContainer335">
   <h1 class="chapterNumber">
    <span class="koboSpan" id="kobo.1.1">
     16
    </span>
   </h1>
   <h1 class="chapterTitle" id="_idParaDest-317">
    <span class="koboSpan" id="kobo.2.1">
     React Server Components &amp; Server Actions
    </span>
   </h1>
   <div class="note">
    <p class="normal">
     <span class="koboSpan" id="kobo.3.1">
      Learning Objectives
     </span>
    </p>
    <p class="normal">
     <span class="koboSpan" id="kobo.4.1">
      By the end of this chapter, you will be able to do the following:
     </span>
    </p>
    <ul>
     <li class="bulletList">
      <span class="koboSpan" id="kobo.5.1">
       Create and use
      </span>
      <strong class="keyWord">
       <span class="koboSpan" id="kobo.6.1">
        React Server Components
       </span>
      </strong>
      <span class="koboSpan" id="kobo.7.1">
       (
      </span>
      <strong class="keyWord">
       <span class="koboSpan" id="kobo.8.1">
        RSCs
       </span>
      </strong>
      <span class="koboSpan" id="kobo.9.1">
       )
      </span>
     </li>
     <li class="bulletList">
      <span class="koboSpan" id="kobo.10.1">
       Describe how (and when) RSCs are executed and rendered to the screen
      </span>
     </li>
     <li class="bulletList">
      <span class="koboSpan" id="kobo.11.1">
       Fetch data and perform asynchronous operations with the help of RSCs
      </span>
     </li>
     <li class="bulletList">
      <span class="koboSpan" id="kobo.12.1">
       Draw server-client boundaries by building and using client components
      </span>
     </li>
     <li class="bulletList">
      <span class="koboSpan" id="kobo.13.1">
       Perform server-side data mutations with the help of Server Actions
      </span>
     </li>
     <li class="bulletList">
      <span class="koboSpan" id="kobo.14.1">
       Update the
      </span>
      <strong class="keyWord">
       <span class="koboSpan" id="kobo.15.1">
        user interface
       </span>
      </strong>
      <span class="koboSpan" id="kobo.16.1">
       (
      </span>
      <strong class="keyWord">
       <span class="koboSpan" id="kobo.17.1">
        UI
       </span>
      </strong>
      <span class="koboSpan" id="kobo.18.1">
       ) in response to Server Actions
      </span>
     </li>
    </ul>
   </div>
   <h1 class="heading-1" id="_idParaDest-318">
    <span class="koboSpan" id="kobo.19.1">
     Introduction
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.20.1">
     In the previous
    </span>
    <a id="_idIndexMarker817">
    </a>
    <span class="koboSpan" id="kobo.21.1">
     chapter, you learned that you can use
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.22.1">
      server-side rendering
     </span>
    </strong>
    <span class="koboSpan" id="kobo.23.1">
     (
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.24.1">
      SSR
     </span>
    </strong>
    <span class="koboSpan" id="kobo.25.1">
     ) to render React components on the server.
    </span>
    <span class="koboSpan" id="kobo.25.2">
     SSR ensures that users receive a fully populated HTML document upon their initial HTTP request, not an almost empty page shell.
    </span>
    <span class="koboSpan" id="kobo.25.3">
     You were also introduced to Next.js and learned how you may use that framework to build React apps that come with SSR (and many other useful features) out of the box.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.26.1">
     This chapter
    </span>
    <a id="_idIndexMarker818">
    </a>
    <span class="koboSpan" id="kobo.27.1">
     builds upon the previous one—specifically, you’ll
    </span>
    <a id="_idIndexMarker819">
    </a>
    <span class="koboSpan" id="kobo.28.1">
     learn about two crucial React features that are unlocked by Next.js:
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.29.1">
      React Server Components
     </span>
    </strong>
    <span class="koboSpan" id="kobo.30.1">
     (
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.31.1">
      RSCs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.32.1">
     ) and
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.33.1">
      Server Actions
     </span>
    </strong>
    <span class="koboSpan" id="kobo.34.1">
     .
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.35.1">
     Throughout this chapter, you’ll learn how these two features help with data fetching and mutations, and why you can’t use them in every React project, even though they’re technically
    </span>
    <a id="_idIndexMarker820">
    </a>
    <span class="koboSpan" id="kobo.36.1">
     part of React—not Next.js.
    </span>
   </p>
   <div class="note">
    <p class="normal">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.37.1">
       Note
      </span>
     </strong>
    </p>
    <p class="normal">
     <span class="koboSpan" id="kobo.38.1">
      RSCs and Server Actions are relatively new React features.
     </span>
     <span class="koboSpan" id="kobo.38.2">
      Supporting them in custom React projects is tricky, as you will learn throughout this chapter.
     </span>
    </p>
    <p class="normal">
     <span class="koboSpan" id="kobo.39.1">
      Whilst unlikely, it is possible that concepts or features related to RSCs or Server Actions change.
     </span>
     <span class="koboSpan" id="kobo.39.2">
      It’s also possible that supporting these features in custom projects gets easier.
     </span>
    </p>
    <p class="normal">
     <span class="koboSpan" id="kobo.40.1">
      That’s why this book comes with a dedicated document that tracks any significant changes you should be aware of:
     </span>
     <a href="https://github.com/mschwarzmueller/book-react-key-concepts-e2/blob/main/CHANGELOG.md">
      <span class="url">
       <span class="koboSpan" id="kobo.41.1">
        https://github.com/mschwarzmueller/book-react-key-concepts-e2/blob/main/CHANGELOG.md
       </span>
      </span>
     </a>
     <span class="koboSpan" id="kobo.42.1">
      .
     </span>
    </p>
   </div>
   <h1 class="heading-1" id="_idParaDest-319">
    <span class="koboSpan" id="kobo.43.1">
     The Problem with Server-side Data Fetching
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.44.1">
     If you have an SSR-enabled React app, either by manually enabling it, for example, in a Vite-based project, or by using a framework like Next.js, your React component functions get
    </span>
    <a id="_idIndexMarker821">
    </a>
    <span class="koboSpan" id="kobo.45.1">
     executed on the server.
    </span>
    <span class="koboSpan" id="kobo.45.2">
     Thus, any data required by those components should be fetched on the server.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.46.1">
     But as explained in the previous chapter, in the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.47.1">
      Server-side Data Fetching Is Not Trivial
     </span>
    </em>
    <span class="koboSpan" id="kobo.48.1">
     section, sending HTTP requests with the help of
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.49.1">
      useEffect()
     </span>
    </code>
    <span class="koboSpan" id="kobo.50.1">
     or trying to update the UI via
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.51.1">
      useState()
     </span>
    </code>
    <span class="koboSpan" id="kobo.52.1">
     does not work when using SSR.
    </span>
    <span class="koboSpan" id="kobo.52.2">
     On the server, React only calls the component functions once—it does not re-execute them when the state changes.
    </span>
    <span class="koboSpan" id="kobo.52.3">
     It also doesn’t call your effect functions.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.53.1">
     This is a serious limitation since many React apps need to fetch data from some backend or a database.
    </span>
    <span class="koboSpan" id="kobo.53.2">
     Not being able to fetch and render that data on the server means that website visitors will again receive incomplete HTML documents (and wait for the data to be fetched on the client side), and search engine crawlers will not see the most important content of the web page.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.54.1">
     That’s one of the reasons why React introduced
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.55.1">
      RSCs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.56.1">
     .
    </span>
   </p>
   <h1 class="heading-1" id="_idParaDest-320">
    <span class="koboSpan" id="kobo.57.1">
     Introducing RSCs
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.58.1">
     RSCs, despite their name, are not necessarily components that run on a server.
    </span>
    <span class="koboSpan" id="kobo.58.2">
     Instead, their defining
    </span>
    <a id="_idIndexMarker822">
    </a>
    <span class="koboSpan" id="kobo.59.1">
     characteristic is that their component functions are never, under any circumstances, executed on the client side!
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.60.1">
     Consequently, RSCs may be executed on a server, but they may also be called during the build process, hence pre-generating components at build time.
    </span>
    <span class="koboSpan" id="kobo.60.2">
     They definitely won’t be executed in the browser, though.
    </span>
   </p>
   <figure class="mediaobject">
    <span class="koboSpan" id="kobo.61.1">
     <img alt="A diagram of a server  Description automatically generated" src="image/B31339_16_01.png"/>
    </span>
   </figure>
   <p class="packt_figref">
    <span class="koboSpan" id="kobo.62.1">
     Figure 16.1: RSCs can’t be called from the client side
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.63.1">
     But what’s the purpose of RSCs?
    </span>
    <span class="koboSpan" id="kobo.63.2">
     How are they created and used?
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-321">
    <span class="koboSpan" id="kobo.64.1">
     Making Sense of RSCs
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.65.1">
     The core
    </span>
    <a id="_idIndexMarker823">
    </a>
    <span class="koboSpan" id="kobo.66.1">
     idea behind RSCs is that you can build components that render outside of the browser (e.g., on the server).
    </span>
    <span class="koboSpan" id="kobo.66.2">
     As a result, these components can execute code that wouldn’t work in the browser—for example, because Node.js-specific APIs are used, or code that relies on credentials (e.g., database credentials) that must not be exposed to the client.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.67.1">
     Unlike “normal” components (client components) that are rendered via SSR, RSCs can be rendered (on the server) after the initial page load.
    </span>
    <span class="koboSpan" id="kobo.67.2">
     Hence, RSCs are not just about rendering an initial page snapshot.
    </span>
    <span class="koboSpan" id="kobo.67.3">
     In addition, RSCs can fetch data on the server side.
    </span>
    <span class="koboSpan" id="kobo.67.4">
     Later in this chapter, the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.68.1">
      RSCs vs Server-side Rendering
     </span>
    </em>
    <span class="koboSpan" id="kobo.69.1">
     section will take a closer look at the relationship between RSCs and “normal” components rendered via SSR.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.70.1">
     Hence, RSCs solve an important problem: they allow you to intertwine frontend and backend React code.
    </span>
    <span class="koboSpan" id="kobo.70.2">
     Whereas, in the past, before RSCs, you typically had to build separate
    </span>
    <a id="_idIndexMarker824">
    </a>
    <span class="koboSpan" id="kobo.71.1">
     backend and frontend web applications, you can now build integrated fullstack apps that blend server-side and client-side React code.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.72.1">
     Using RSCs
    </span>
    <a id="_idIndexMarker825">
    </a>
    <span class="koboSpan" id="kobo.73.1">
     therefore offers various advantages:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.74.1">
      Building fully integrated fullstack applications where the backend and frontend are closely connected and use the same server becomes much easier.
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.75.1">
      Asynchronous server-side data fetching inside of components becomes possible: Unlike on the client side (or when using SSR), React allows you to use
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.76.1">
       async/await
      </span>
     </code>
     <span class="koboSpan" id="kobo.77.1">
      and return a
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.78.1">
       Promise
      </span>
     </code>
     <span class="koboSpan" id="kobo.79.1">
      value in your component functions.
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.80.1">
      Website visitors download smaller client-side JavaScript bundles since the code of RSCs is omitted.
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.81.1">
      Running compute-heavy operations or using large third-party libraries gets easier since the operations and their code can be outsourced to the server (or to the build process).
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.82.1">
      Code or credentials that shouldn’t be accessible by your website users can be moved into RSCs.
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.83.1">
     For example, thanks to RSCs, you can create components like this:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.84.1">import</span></span><span class="koboSpan" id="kobo.85.1"> pg </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.86.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.87.1">'pg'</span></span><span class="koboSpan" id="kobo.88.1">; </span><span class="hljs-comment"><span class="koboSpan" id="kobo.89.1">// pg package (more info: node-postgres.com)</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.90.1">const</span></span><span class="koboSpan" id="kobo.91.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.92.1">Client</span></span><span class="koboSpan" id="kobo.93.1"> } = pg
 
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.94.1">const</span></span><span class="koboSpan" id="kobo.95.1"> client = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.96.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.97.1">Client</span></span><span class="koboSpan" id="kobo.98.1">({
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.99.1">user</span></span><span class="koboSpan" id="kobo.100.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.101.1">'username'</span></span><span class="koboSpan" id="kobo.102.1">,
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.103.1">password</span></span><span class="koboSpan" id="kobo.104.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.105.1">'your-password'</span></span><span class="koboSpan" id="kobo.106.1">,
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.107.1">host</span></span><span class="koboSpan" id="kobo.108.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.109.1">'my.database-server.com'</span></span><span class="koboSpan" id="kobo.110.1">,
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.111.1">port</span></span><span class="koboSpan" id="kobo.112.1">: </span><span class="hljs-number"><span class="koboSpan" id="kobo.113.1">5334</span></span><span class="koboSpan" id="kobo.114.1">,
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.115.1">database</span></span><span class="koboSpan" id="kobo.116.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.117.1">'demo'</span></span><span class="koboSpan" id="kobo.118.1">,
});
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.119.1">async</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.120.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.121.1">ProductsPage</span></span><span class="koboSpan" id="kobo.122.1">() {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.123.1">await</span></span><span class="koboSpan" id="kobo.124.1"> client.</span><span class="hljs-title"><span class="koboSpan" id="kobo.125.1">connect</span></span><span class="koboSpan" id="kobo.126.1">();
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.127.1">const</span></span><span class="koboSpan" id="kobo.128.1"> res = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.129.1">await</span></span><span class="koboSpan" id="kobo.130.1"> client.</span><span class="hljs-title"><span class="koboSpan" id="kobo.131.1">query</span></span><span class="koboSpan" id="kobo.132.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.133.1">'SELECT * FROM products'</span></span><span class="koboSpan" id="kobo.134.1">); 
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.135.1">await</span></span><span class="koboSpan" id="kobo.136.1"> client.</span><span class="hljs-title"><span class="koboSpan" id="kobo.137.1">end</span></span><span class="koboSpan" id="kobo.138.1">();
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.139.1">return</span></span><span class="koboSpan" id="kobo.140.1"> (
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.141.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.142.1">ul</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.143.1">&gt;</span></span>
<span class="language-xml"><span class="koboSpan" id="kobo.144.1">      {res.rows.map(row =&gt; </span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.145.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.146.1">li</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.147.1">key</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.148.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.149.1">{row.id}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.150.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.151.1">{row.title}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.152.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.153.1">li</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.154.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.155.1">)}</span></span>
<span class="language-xml">    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.156.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.157.1">ul</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.158.1">&gt;</span></span><span class="koboSpan" id="kobo.159.1">
  );
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.160.1">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.161.1">
      ProductsPage
     </span>
    </code>
    <span class="koboSpan" id="kobo.162.1">
     component contains code that reaches out to a PostgreSQL database to fetch product data from there.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.163.1">
     Without RSCs, this kind of component would be impossible to build and use.
    </span>
    <span class="koboSpan" id="kobo.163.2">
     You wouldn’t be
    </span>
    <a id="_idIndexMarker826">
    </a>
    <span class="koboSpan" id="kobo.164.1">
     allowed to use
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.165.1">
      async/await
     </span>
    </code>
    <span class="koboSpan" id="kobo.166.1">
     , the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.167.1">
      pg
     </span>
    </code>
    <span class="koboSpan" id="kobo.168.1">
     package might rely on some APIs that are not available in the browser, and you would expose your database credentials in the client-side code bundle.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.169.1">
     All these things are allowed when building RSCs.
    </span>
    <span class="koboSpan" id="kobo.169.2">
     React explicitly does allow you to return a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.170.1">
      Promise
     </span>
    </code>
    <span class="koboSpan" id="kobo.171.1">
     (and hence use
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.172.1">
      async/await
     </span>
    </code>
    <span class="koboSpan" id="kobo.173.1">
     ) when building an RSC.
    </span>
    <span class="koboSpan" id="kobo.173.2">
     Since the code is guaranteed to never end up on the client side, connecting to a database is safe, too.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.174.1">
     Therefore, you can easily build fully integrated fullstack apps where backend and frontend code blend seamlessly.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.175.1">
     However, using RSCs is both simple and complex at the same time, as the next section will explain.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-322">
    <span class="koboSpan" id="kobo.176.1">
     Creating &amp; Using RSCs
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.177.1">
     In a Next.js
    </span>
    <a id="_idIndexMarker827">
    </a>
    <span class="koboSpan" id="kobo.178.1">
     project that uses the App Router, all React
    </span>
    <a id="_idIndexMarker828">
    </a>
    <span class="koboSpan" id="kobo.179.1">
     components, no matter if used as pages or nested in some other component, are, by default, RSCs.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.180.1">
     As you can tell if you inspect any React component function in a Next.js project, there really is nothing special about them.
    </span>
    <span class="koboSpan" id="kobo.180.2">
     They look like regular React components:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.181.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.182.1">default</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.183.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.184.1">ServerComponentInfo</span></span><span class="koboSpan" id="kobo.185.1">() {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.186.1">return</span></span> <span class="hljs-tag"><span class="koboSpan" id="kobo.187.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.188.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.189.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.190.1">This is a React Server Component.</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.191.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.192.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.193.1">&gt;</span></span><span class="koboSpan" id="kobo.194.1">;
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.195.1">
     You may use
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.196.1">
      async/await
     </span>
    </code>
    <span class="koboSpan" id="kobo.197.1">
     with them, but you don’t have to.
    </span>
    <span class="koboSpan" id="kobo.197.2">
     You may use server-side APIs and packages, but you don’t have to.
    </span>
    <span class="koboSpan" id="kobo.197.3">
     So, creating RSCs is simple—they’re just normal components after all.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.198.1">
     The same is true for using them—you use them as you always used React components: as custom JSX elements:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.199.1">&lt;</span><span class="hljs-title"><span class="koboSpan" id="kobo.200.1">ServerComponentInfo</span></span><span class="koboSpan" id="kobo.201.1"> /&gt;
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.202.1">
     As you
    </span>
    <a id="_idIndexMarker829">
    </a>
    <span class="koboSpan" id="kobo.203.1">
     can see, you wouldn’t be able to tell that
    </span>
    <a id="_idIndexMarker830">
    </a>
    <span class="koboSpan" id="kobo.204.1">
     this is a special kind of component.
    </span>
    <span class="koboSpan" id="kobo.204.2">
     It’s created and used as you learned it through this entire book.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.205.1">
     Nonetheless, all the other components from all the other chapters of this book, which were used
    </span>
    <a id="_idIndexMarker831">
    </a>
    <span class="koboSpan" id="kobo.206.1">
     in Vite-based React projects, were not RSCs.
    </span>
    <span class="koboSpan" id="kobo.206.2">
     They were regular components or
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.207.1">
      client components
     </span>
    </strong>
    <span class="koboSpan" id="kobo.208.1">
     .
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.209.1">
     So, what makes the components in a Next.js project special?
    </span>
    <span class="koboSpan" id="kobo.209.2">
     Why is a feature provided by React available in Next.js projects but not necessarily in other React projects (e.g., in Vite-based projects)?
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-323">
    <span class="koboSpan" id="kobo.210.1">
     Unlocking RSCs in React Projects
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.211.1">
     RSCs are a feature provided by React, not Next.js.
    </span>
    <span class="koboSpan" id="kobo.211.2">
     Yet, not all React projects can use this feature.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.212.1">
     The reason
    </span>
    <a id="_idIndexMarker832">
    </a>
    <span class="koboSpan" id="kobo.213.1">
     for that, and for why RSCs are available in Next.js projects, is the Next.js build process and what Next.js does to these components (and to the entire React project code, actually) behind the scenes.
    </span>
    <span class="koboSpan" id="kobo.213.2">
     At a high level, you can think of Next.js doing the following things:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.214.1">
      The build workflow and bundling process separates server and client components to ensure that no RSC code ends up on the client side.
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.215.1">
      Next.js sets up API endpoints (i.e., URL addresses to which the client-side code may send requests) that trigger RSC component functions on the server and return instructions that allow the client-side React code to update the UI.
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.216.1">
      Next.js calls these endpoints when needed—for example, when navigating to a new page.
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.217.1">
      Next.js passes the API response (which contains these rendering instructions) to React, which uses the returned instructions to update the UI as needed.
     </span>
    </li>
   </ul>
   <figure class="mediaobject">
    <span class="koboSpan" id="kobo.218.1">
     <img alt="img" src="image/B31339_16_02.png"/>
    </span>
   </figure>
   <p class="packt_figref">
    <span class="koboSpan" id="kobo.219.1">
     Figure 16.2: Client and server component code are separated; communication happens via HTTP requests
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.220.1">
     Technically, it’s a bit more complex than that, but for the purpose of this book and for using the
    </span>
    <a id="_idIndexMarker833">
    </a>
    <span class="koboSpan" id="kobo.221.1">
     feature, a deep understanding of the internals is not required—just as you don’t need to understand what exactly happens internally when using
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.222.1">
      useState()
     </span>
    </code>
    <span class="koboSpan" id="kobo.223.1">
     , for example.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.224.1">
     You can verify the mentioned points by running a demo Next.js project you find here:
    </span>
    <a href="https://github.com/mschwarzmueller/book-react-key-concepts-e2/tree/16-rsc-server-actions/examples/01-rsc-intro">
     <span class="url">
      <span class="koboSpan" id="kobo.225.1">
       https://github.com/mschwarzmueller/book-react-key-concepts-e2/tree/16-rsc-server-actions/examples/01-rsc-intro
      </span>
     </span>
    </a>
    <span class="koboSpan" id="kobo.226.1">
     .
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.227.1">
     This demo app consists of two basic page component files:
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.228.1">
      app/page.js
     </span>
    </code>
    <span class="koboSpan" id="kobo.229.1">
     and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.230.1">
      app/info/page.js
     </span>
    </code>
    <span class="koboSpan" id="kobo.231.1">
     .
    </span>
    <span class="koboSpan" id="kobo.231.2">
     The main page component (the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.232.1">
      Home
     </span>
    </code>
    <span class="koboSpan" id="kobo.233.1">
     component inside
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.234.1">
      app/page.js
     </span>
    </code>
    <span class="koboSpan" id="kobo.235.1">
     ) outputs a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.236.1">
      ServerComponentInfo
     </span>
    </code>
    <span class="koboSpan" id="kobo.237.1">
     component:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.238.1">import</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.239.1">ServerComponentInfo</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.240.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.241.1">'../components/ServerComponentInfo'</span></span><span class="koboSpan" id="kobo.242.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.243.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.244.1">default</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.245.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.246.1">Home</span></span><span class="koboSpan" id="kobo.247.1">() {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.248.1">return</span></span> <span class="hljs-tag"><span class="koboSpan" id="kobo.249.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.250.1">ServerComponentInfo</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.251.1"> /&gt;</span></span><span class="koboSpan" id="kobo.252.1">;
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.253.1">
     That component in turn simply outputs some static, hardcoded content:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.254.1">import</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.255.1">Link</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.256.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.257.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.258.1">next/link'</span></span><span class="koboSpan" id="kobo.259.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.260.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.261.1">default</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.262.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.263.1">ServerComponentInfo</span></span><span class="koboSpan" id="kobo.264.1">() {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.265.1">return</span></span><span class="koboSpan" id="kobo.266.1"> (
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.267.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.268.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.269.1">id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.270.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.271.1">"rsc-info"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.272.1">&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.273.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.274.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.275.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.276.1">This is a React Server Component.</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.277.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.278.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.279.1">&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.280.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.281.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.282.1">&gt;&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.283.1">Link</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.284.1">href</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.285.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.286.1">"/info"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.287.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.288.1">Learn More</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.289.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.290.1">Link</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.291.1">&gt;&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.292.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.293.1">&gt;</span></span>
<span class="language-xml">    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.294.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.295.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.296.1">&gt;</span></span><span class="koboSpan" id="kobo.297.1">
  );
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.298.1">
     Both the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.299.1">
      Home
     </span>
    </code>
    <span class="koboSpan" id="kobo.300.1">
     and the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.301.1">
      ServerComponentInfo
     </span>
    </code>
    <span class="koboSpan" id="kobo.302.1">
     components are RSCs—simply because they are components in a Next.js project.
    </span>
    <span class="koboSpan" id="kobo.302.2">
     As mentioned earlier, all components in Next.js
    </span>
    <a id="_idIndexMarker834">
    </a>
    <span class="koboSpan" id="kobo.303.1">
     projects are server components by default.
    </span>
    <span class="koboSpan" id="kobo.303.2">
     If these components were part of a Vite-based React project that is not set up to support RSCs, these components would instead be “normal” components (client components).
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.304.1">
     In the same demo project, there is also a component for the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.305.1">
      /info
     </span>
    </code>
    <span class="koboSpan" id="kobo.306.1">
     page.
    </span>
    <span class="koboSpan" id="kobo.306.2">
     This component contains some code that wouldn’t work in a component that isn’t an RSC:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.307.1">import</span></span><span class="koboSpan" id="kobo.308.1"> fs </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.309.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.310.1">'node:fs/promises'</span></span><span class="koboSpan" id="kobo.311.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.312.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.313.1">default</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.314.1">async</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.315.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.316.1">InfoPage</span></span><span class="koboSpan" id="kobo.317.1">() {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.318.1">const</span></span><span class="koboSpan" id="kobo.319.1"> info = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.320.1">await</span></span><span class="koboSpan" id="kobo.321.1"> fs.</span><span class="hljs-title"><span class="koboSpan" id="kobo.322.1">readFile</span></span><span class="koboSpan" id="kobo.323.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.324.1">'data/rsc-info.json'</span></span><span class="koboSpan" id="kobo.325.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.326.1">'utf-8'</span></span><span class="koboSpan" id="kobo.327.1">);
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.328.1">const</span></span><span class="koboSpan" id="kobo.329.1"> { summary } = </span><span class="hljs-title"><span class="koboSpan" id="kobo.330.1">JSON</span></span><span class="koboSpan" id="kobo.331.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.332.1">parse</span></span><span class="koboSpan" id="kobo.333.1">(info);
  
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.334.1">return</span></span><span class="koboSpan" id="kobo.335.1"> (
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.336.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.337.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.338.1">id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.339.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.340.1">"info-page"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.341.1">&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.342.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.343.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.344.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.345.1">Understanding React Server Components</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.346.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.347.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.348.1">&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.349.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.350.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.351.1">&gt;</span></span>
<span class="language-xml"><span class="koboSpan" id="kobo.352.1">        {summary}</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.353.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.354.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.355.1">&gt;</span></span>
<span class="language-xml">    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.356.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.357.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.358.1">&gt;</span></span><span class="koboSpan" id="kobo.359.1">
  );
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.360.1">
     This code wouldn’t work in any of the (Vite-based) React projects you saw before in this book because of the following reasons:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.361.1">
      The
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.362.1">
       InfoPage
      </span>
     </code>
     <span class="koboSpan" id="kobo.363.1">
      component uses Node’s
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.364.1">
       fs
      </span>
     </code>
     <span class="koboSpan" id="kobo.365.1">
      package to load data from a
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.366.1">
       rsc-info.json
      </span>
     </code>
     <span class="koboSpan" id="kobo.367.1">
      file (which is part of the project).
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.368.1">
      The component uses
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.369.1">
       async/await
      </span>
     </code>
     <span class="koboSpan" id="kobo.370.1">
      , hence returning a
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.371.1">
       Promise
      </span>
     </code>
     <span class="koboSpan" id="kobo.372.1">
      that eventually yields the JSX code (i.e., the React elements).
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.373.1">
     In projects that do not support RSCs, you’re not able to use server-side APIs since all the code runs
    </span>
    <a id="_idIndexMarker835">
    </a>
    <span class="koboSpan" id="kobo.374.1">
     in the browser.
    </span>
    <span class="koboSpan" id="kobo.374.2">
     You’re also not allowed to return a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.375.1">
      Promise
     </span>
    </code>
    <span class="koboSpan" id="kobo.376.1">
     in your components.
    </span>
    <span class="koboSpan" id="kobo.376.2">
     In non-RSCs, that would not be considered a valid component function return value.
    </span>
    <span class="koboSpan" id="kobo.376.3">
     When working with RSCs, both things are allowed and possible, though.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.377.1">
     As mentioned in the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.378.1">
      Making Sense of RSCs
     </span>
    </em>
    <span class="koboSpan" id="kobo.379.1">
     section, using server-side functionalities (like Node.js APIs) is something that’s unlocked because the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.380.1">
      InfoPage
     </span>
    </code>
    <span class="koboSpan" id="kobo.381.1">
     component, like all components in Next.js projects, is an RSC.
    </span>
    <span class="koboSpan" id="kobo.381.2">
     For RSCs, React also supports the usage of
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.382.1">
      async/await
     </span>
    </code>
    <span class="koboSpan" id="kobo.383.1">
     .
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.384.1">
     Consequently, as expected, you won’t find the code of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.385.1">
      InfoPage
     </span>
    </code>
    <span class="koboSpan" id="kobo.386.1">
     component in the client-side JavaScript code bundles.
    </span>
    <span class="koboSpan" id="kobo.386.2">
     You can verify this by visiting the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.387.1">
      /info
     </span>
    </code>
    <span class="koboSpan" id="kobo.388.1">
     page.
    </span>
    <span class="koboSpan" id="kobo.388.2">
     If you open the
    </span>
    <strong class="screenText">
     <span class="koboSpan" id="kobo.389.1">
      Network
     </span>
    </strong>
    <span class="koboSpan" id="kobo.390.1">
     tab in the browser developer tools, and you then reload the page, you’ll see all the HTTP requests sent to the server.
    </span>
    <span class="koboSpan" id="kobo.390.2">
     This includes all requests for JavaScript code files that are needed on the client side of this React app.
    </span>
   </p>
   <figure class="mediaobject">
    <span class="koboSpan" id="kobo.391.1">
     <img alt="A screenshot of a computer  Description automatically generated" src="image/B31339_16_03.png"/>
    </span>
   </figure>
   <p class="packt_figref">
    <span class="koboSpan" id="kobo.392.1">
     Figure 16.3: When visiting /info, requests for CSS, JS, and some other files are sent to the server
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.393.1">
     If you
    </span>
    <a id="_idIndexMarker836">
    </a>
    <span class="koboSpan" id="kobo.394.1">
     then go through all the JavaScript files requested and search for
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.395.1">
      rsc-info.json
     </span>
    </code>
    <span class="koboSpan" id="kobo.396.1">
     in the downloaded code files, you won’t have any matches in any file.
    </span>
    <span class="koboSpan" id="kobo.396.2">
     This proves that this code, which is part of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.397.1">
      InfoPage
     </span>
    </code>
    <span class="koboSpan" id="kobo.398.1">
     component function, does not end up in any client-side code bundle.
    </span>
   </p>
   <figure class="mediaobject">
    <span class="koboSpan" id="kobo.399.1">
     <img alt="A screenshot of a computer  Description automatically generated" src="image/B31339_16_04.png"/>
    </span>
   </figure>
   <p class="packt_figref">
    <span class="koboSpan" id="kobo.400.1">
     Figure 16.4: The data source filename that’s included in the RSC code can’t be found on the client side
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.401.1">
     How does
    </span>
    <a id="_idIndexMarker837">
    </a>
    <span class="koboSpan" id="kobo.402.1">
     the content fetched from the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.403.1">
      rsc-info.json
     </span>
    </code>
    <span class="koboSpan" id="kobo.404.1">
     file show up on the screen then?
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.405.1">
     This gets answered if you use a different browser than Chrome or Edge.
    </span>
    <span class="koboSpan" id="kobo.405.2">
     This is required since there is a bug with the
    </span>
    <strong class="screenText">
     <span class="koboSpan" id="kobo.406.1">
      Network
     </span>
    </strong>
    <span class="koboSpan" id="kobo.407.1">
     tab in the developer tools of Chrome/Edge that leads to the response of a request being hidden under certain circumstances.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.408.1">
     Instead, you can, for example, use Firefox, to visit the root page (
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.409.1">
      /
     </span>
    </code>
    <span class="koboSpan" id="kobo.410.1">
     ).
    </span>
    <span class="koboSpan" id="kobo.410.2">
     There, click the link that’s visible on the page to navigate to the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.411.1">
      /info
     </span>
    </code>
    <span class="koboSpan" id="kobo.412.1">
     page.
    </span>
    <span class="koboSpan" id="kobo.412.2">
     As you do so, one new HTTP request will be sent.
    </span>
    <span class="koboSpan" id="kobo.412.3">
     If you inspect that request and its response (in Firefox’s browser developer tools), you’ll see the serialized RSC instructions that are returned by the server.
    </span>
   </p>
   <figure class="mediaobject">
    <span class="koboSpan" id="kobo.413.1">
     <img alt="img" src="image/B31339_16_05.png"/>
    </span>
   </figure>
   <p class="packt_figref">
    <span class="koboSpan" id="kobo.414.1">
     Figure 16.5: Serialized instructions for client-side React are received from the server
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.415.1">
     As you
    </span>
    <a id="_idIndexMarker838">
    </a>
    <span class="koboSpan" id="kobo.416.1">
     can see, it’s not HTML content that’s received as a response.
    </span>
    <span class="koboSpan" id="kobo.416.2">
     Instead, it’s a bunch of serialized instructions that are translated to DOM elements by React on the client side (i.e., in the browser).
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.417.1">
     Therefore, as you can tell, building and using RSCs is simple, but preparing the project to handle them is not.
    </span>
    <span class="koboSpan" id="kobo.417.2">
     Instead, you need a build process that separates client and server code, and API endpoints that invoke server component functions on the server.
    </span>
    <span class="koboSpan" id="kobo.417.3">
     You also need client-side code that sends requests to those API endpoints whenever the server components should be rendered.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-324">
    <span class="koboSpan" id="kobo.418.1">
     RSCs and Server Actions Can’t Be Used in All Projects
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.419.1">
     Thus far in this book, whenever some new React feature was introduced, you could simply
    </span>
    <a id="_idIndexMarker839">
    </a>
    <span class="koboSpan" id="kobo.420.1">
     use it in your React project, no matter
    </span>
    <a id="_idIndexMarker840">
    </a>
    <span class="koboSpan" id="kobo.421.1">
     whether it was a project created and managed by Vite or any other tool (e.g.,
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.422.1">
      create-react-app
     </span>
    </strong>
    <span class="koboSpan" id="kobo.423.1">
     ).
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.424.1">
     With RSCs and Server Actions, this changes.
    </span>
    <span class="koboSpan" id="kobo.424.2">
     Due to the many things that must be done behind the scenes (see the previous section), even though these are features provided by React, you can’t just start using them in any React project.
    </span>
    <span class="koboSpan" id="kobo.424.3">
     Instead, to unlock these features, you must have a project that’s configured to support them.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.425.1">
     As a result, at the point of time where this book is written, RSCs and Server Actions can really only be used with the help of frameworks that integrate and actively support these features—for example, the Next.js framework.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.426.1">
     Of course, it is
    </span>
    <a id="_idIndexMarker841">
    </a>
    <span class="koboSpan" id="kobo.427.1">
     technically possible to
    </span>
    <a id="_idIndexMarker842">
    </a>
    <span class="koboSpan" id="kobo.428.1">
     set up a project that supports both features on your own, but it requires advanced knowledge regarding backend development and build workflow configuration.
    </span>
    <span class="koboSpan" id="kobo.428.2">
     Consequently, most React projects that need these features rely on frameworks like Next.js.
    </span>
    <span class="koboSpan" id="kobo.428.3">
     Since the way you work with RSCs and Server Actions will always be the same, no matter in which kind of project you use them, this book will therefore ignore the custom setup part and instead focus on how to use these two core concepts.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-325">
    <span class="koboSpan" id="kobo.429.1">
     RSCs vs Server-side Rendering
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.430.1">
     At first sight, using RSCs may look similar to SSR React components.
    </span>
    <span class="koboSpan" id="kobo.430.2">
     After all, both concepts
    </span>
    <a id="_idIndexMarker843">
    </a>
    <span class="koboSpan" id="kobo.431.1">
     are about running some code outside of the browser.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.432.1">
     But
    </span>
    <a id="_idIndexMarker844">
    </a>
    <span class="koboSpan" id="kobo.433.1">
     even though the concepts sound similar, they are quite different.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.434.1">
     SSR is all about rendering a component tree to HTML when a request is received.
    </span>
    <span class="koboSpan" id="kobo.434.2">
     It’s about creating an initial page snapshot, in the end.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.435.1">
     In addition, when building an interactive web application, a vital part of SSR is that the pre-rendered HTML snapshot gets hydrated on the client side—as explained in the previous chapter (see the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.436.1">
      Making Sense of Server-side Rendering (SSR)
     </span>
    </em>
    <span class="koboSpan" id="kobo.437.1">
     section and
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.438.1">
      Figure 15.3
     </span>
    </em>
    <span class="koboSpan" id="kobo.439.1">
     ).
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.440.1">
     As a result, when using SSR, the entire component tree with all its component functions is evaluated on the server side as well as on the client side.
    </span>
    <span class="koboSpan" id="kobo.440.2">
     There is no split between server-side and client-side code—it’s the same app and the same component tree on both sides.
    </span>
    <span class="koboSpan" id="kobo.440.3">
     For that reason, you also can’t have any server-exclusive code in your React components.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.441.1">
     With RSCs, that changes.
    </span>
    <span class="koboSpan" id="kobo.441.2">
     The code of their component functions, as explained in the previous sections, never ends up on the client side.
    </span>
   </p>
   <figure class="mediaobject">
    <span class="koboSpan" id="kobo.442.1">
     <img alt="A diagram of a software application  Description automatically generated" src="image/B31339_16_06.png"/>
    </span>
   </figure>
   <p class="packt_figref">
    <span class="koboSpan" id="kobo.443.1">
     Figure 16.6: RSCs are not hydrated; instead, their output is requested via HTTP requests
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.444.1">
     That’s
    </span>
    <a id="_idIndexMarker845">
    </a>
    <span class="koboSpan" id="kobo.445.1">
     why an SSR-enabled project doesn’t automatically support RSCs.
    </span>
    <span class="koboSpan" id="kobo.445.2">
     On the other hand, you could
    </span>
    <a id="_idIndexMarker846">
    </a>
    <span class="koboSpan" id="kobo.446.1">
     set up a project that supports RSCs but also uses SSR for some components—components that should be pre-rendered on the server but that are also needed on the client side (e.g., because they add interactivity to the page).
    </span>
    <span class="koboSpan" id="kobo.446.2">
     These types of components will be explored in the next section.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.447.1">
     It’s also worth noting that RSCs, like server-side rendered components in SSR projects, only execute once per request.
    </span>
    <span class="koboSpan" id="kobo.447.2">
     However, RSCs, unlike “normal” components rendered via SSR, can be executed on-demand while the app is running.
    </span>
    <span class="koboSpan" id="kobo.447.3">
     They’re not limited to being called to create an initial page snapshot.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.448.1">
     There is an important question, though: how can you add interactivity, and, for example, handle user input, in React apps where all components are rendered on the server?
    </span>
    <span class="koboSpan" id="kobo.448.2">
     User interaction takes place in the browser, after all.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-326">
    <span class="koboSpan" id="kobo.449.1">
     RSCs vs Client Components
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.450.1">
     RSCs provide
    </span>
    <a id="_idIndexMarker847">
    </a>
    <span class="koboSpan" id="kobo.451.1">
     some convincing
    </span>
    <a id="_idIndexMarker848">
    </a>
    <span class="koboSpan" id="kobo.452.1">
     advantages (see the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.453.1">
      Making Sense of RSCs
     </span>
    </em>
    <span class="koboSpan" id="kobo.454.1">
     section), but they also introduce one potentially big problem: if all the component code “lives” and executes on the server, there’s no room for client-side interactivity.
    </span>
   </p>
   <h3 class="heading-3" id="_idParaDest-327">
    <span class="koboSpan" id="kobo.455.1">
     Not All Components Should Be RSCs
    </span>
   </h3>
   <p class="normal">
    <span class="koboSpan" id="kobo.456.1">
     If you have a component that needs to manage some state (e.g., some shopping cart that should only be shown upon user interaction), that state and the UI must be managed and
    </span>
    <a id="_idIndexMarker849">
    </a>
    <span class="koboSpan" id="kobo.457.1">
     updated by client-side React.
    </span>
    <span class="koboSpan" id="kobo.457.2">
     Because that was (and is) one of the main selling points of React: you can use it to build highly reactive and interactive UIs.
    </span>
    <span class="koboSpan" id="kobo.457.3">
     But this goal clearly clashes with the idea of RSCs, where no component code makes it to the browser, and where components are only rendered once per request.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.458.1">
     That’s why React
    </span>
    <a id="_idIndexMarker850">
    </a>
    <span class="koboSpan" id="kobo.459.1">
     allows you to define so-called
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.460.1">
      server-client boundaries
     </span>
    </strong>
    <span class="koboSpan" id="kobo.461.1">
     by adding the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.462.1">
      'use client'
     </span>
    </code>
    <span class="koboSpan" id="kobo.463.1">
     directive at the top of files that contain component functions that should run on the client side.
    </span>
   </p>
   <figure class="mediaobject">
    <span class="koboSpan" id="kobo.464.1">
     <img alt="img" src="image/B31339_16_07.png"/>
    </span>
   </figure>
   <p class="packt_figref">
    <span class="koboSpan" id="kobo.465.1">
     Figure 16.7: The ‘use client’ directive creates a boundary between server-side and client-side code
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.466.1">
     You already encountered
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.467.1">
      'use client'
     </span>
    </code>
    <span class="koboSpan" id="kobo.468.1">
     in the previous chapter, in the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.469.1">
      Highlighting Active Links &amp; Using the ‘use client’ Directive
     </span>
    </em>
    <span class="koboSpan" id="kobo.470.1">
     section.
    </span>
    <span class="koboSpan" id="kobo.470.2">
     Back then, this directive didn’t make a lot of sense.
    </span>
    <span class="koboSpan" id="kobo.470.3">
     Now, with your newly gained knowledge about RSCs, the purpose behind this directive will become clearer.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.471.1">
     With
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.472.1">
      'use client'
     </span>
    </code>
    <span class="koboSpan" id="kobo.473.1">
     added to a component file, the components defined in that file become client components.
    </span>
    <span class="koboSpan" id="kobo.473.2">
     Client components are also pre-rendered on the server, but their code
    </span>
    <a id="_idIndexMarker851">
    </a>
    <span class="koboSpan" id="kobo.474.1">
     executes on the client side, too.
    </span>
    <span class="koboSpan" id="kobo.474.2">
     They are hydrated, as explained in the previous chapter.
    </span>
    <span class="koboSpan" id="kobo.474.3">
     Thus, unlike the code of server components, the code of client components makes it to the client side:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-string"><span class="koboSpan" id="kobo.475.1">'use client'</span></span><span class="koboSpan" id="kobo.476.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.477.1">import</span></span><span class="koboSpan" id="kobo.478.1"> { useState } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.479.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.480.1">'react'</span></span><span class="koboSpan" id="kobo.481.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.482.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.483.1">default</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.484.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.485.1">Cart</span></span><span class="koboSpan" id="kobo.486.1">() {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.487.1">const</span></span><span class="koboSpan" id="kobo.488.1"> [isVisible, setIsVisible] = </span><span class="hljs-title"><span class="koboSpan" id="kobo.489.1">useState</span></span><span class="koboSpan" id="kobo.490.1">(</span><span class="hljs-literal"><span class="koboSpan" id="kobo.491.1">false</span></span><span class="koboSpan" id="kobo.492.1">);
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.493.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.494.1">handleCartVisibility</span></span><span class="koboSpan" id="kobo.495.1">() {
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.496.1">setIsVisible</span></span><span class="koboSpan" id="kobo.497.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.498.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.499.1">prevState</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.500.1">) =&gt;</span></span><span class="koboSpan" id="kobo.501.1"> !prevState);
  }
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.502.1">return</span></span><span class="koboSpan" id="kobo.503.1"> (
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.504.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.505.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.506.1">id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.507.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.508.1">"cart"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.509.1">&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.510.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.511.1">button</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.512.1">onClick</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.513.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.514.1">{handleCartVisibility}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.515.1">&gt;</span></span>
<span class="language-xml"><span class="koboSpan" id="kobo.516.1">        {isVisible ? </span><span class="koboSpan" id="kobo.516.2">'Hide Cart' : 'Show Cart'}</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.517.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.518.1">button</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.519.1">&gt;</span></span>
<span class="language-xml"><span class="koboSpan" id="kobo.520.1">      {isVisible &amp;&amp; </span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.521.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.522.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.523.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.524.1">Cart Items</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.525.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.526.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.527.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.528.1">}</span></span>
<span class="language-xml">    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.529.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.530.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.531.1">&gt;</span></span><span class="koboSpan" id="kobo.532.1">
  );
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.533.1">
     In this example, the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.534.1">
      Cart
     </span>
    </code>
    <span class="koboSpan" id="kobo.535.1">
     component is a client component because
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.536.1">
      'use client'
     </span>
    </code>
    <span class="koboSpan" id="kobo.537.1">
     is added at the top of the file.
    </span>
    <span class="koboSpan" id="kobo.537.2">
     This is required because the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.538.1">
      Cart
     </span>
    </code>
    <span class="koboSpan" id="kobo.539.1">
     component uses the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.540.1">
      useState()
     </span>
    </code>
    <span class="koboSpan" id="kobo.541.1">
     Hook, which only works in the browser.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.542.1">
     Whenever you add the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.543.1">
      'use client'
     </span>
    </code>
    <span class="koboSpan" id="kobo.544.1">
     directive to a component file, the component functions in that file will be included in the client-side code bundle.
    </span>
    <span class="koboSpan" id="kobo.544.2">
     Thus, the component functions can (and will) be executed in the browser—therefore you can use features that rely on running there, like
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.545.1">
      useState()
     </span>
    </code>
    <span class="koboSpan" id="kobo.546.1">
     or code that should run upon user input (e.g., if a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.547.1">
      &lt;button&gt;
     </span>
    </code>
    <span class="koboSpan" id="kobo.548.1">
     was pressed).
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.549.1">
     That’s also why Next.js shows an error if you try to use a Hook in a component that’s not marked as a client component via
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.550.1">
      'use client'
     </span>
    </code>
    <span class="koboSpan" id="kobo.551.1">
     .
    </span>
   </p>
   <figure class="mediaobject">
    <span class="koboSpan" id="kobo.552.1">
     <img alt="img" src="image/B31339_16_08.png"/>
    </span>
   </figure>
   <p class="packt_figref">
    <span class="koboSpan" id="kobo.553.1">
     Figure 16.8: Next.js complains about the usage of the useState() Hook in an RSC
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.554.1">
     This error occurs because you’re trying to build something impossible: a component that’s only
    </span>
    <a id="_idIndexMarker852">
    </a>
    <span class="koboSpan" id="kobo.555.1">
     evaluated on the server but that also reacts to user input and updates some state.
    </span>
    <span class="koboSpan" id="kobo.555.2">
     Since the latter, as you learned in
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.556.1">
      Chapter 4
     </span>
    </em>
    <span class="koboSpan" id="kobo.557.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.558.1">
      Working with Events and State
     </span>
    </em>
    <span class="koboSpan" id="kobo.559.1">
     , will typically result in a UI update, the code needs to execute on the client side—something that’s clearly in conflict with the goal of running the component code only on the server.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.560.1">
     Thus,
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.561.1">
      'use client'
     </span>
    </code>
    <span class="koboSpan" id="kobo.562.1">
     must be added whenever you have a component that needs to run in the browser.
    </span>
   </p>
   <div class="note">
    <p class="normal">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.563.1">
       Note
      </span>
     </strong>
    </p>
    <p class="normal">
     <span class="koboSpan" id="kobo.564.1">
      Of course, you will not need to add the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.565.1">
       'use client'
      </span>
     </code>
     <span class="koboSpan" id="kobo.566.1">
      directive in projects that don’t implement RSCs.
     </span>
     <span class="koboSpan" id="kobo.566.2">
      That’s why you didn’t see it in any other React project in earlier chapters.
     </span>
    </p>
   </div>
   <h3 class="heading-3" id="_idParaDest-328">
    <span class="koboSpan" id="kobo.567.1">
     ‘use client’ Affects Child Components, Too!
    </span>
   </h3>
   <p class="normal">
    <span class="koboSpan" id="kobo.568.1">
     Using the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.569.1">
      'use client'
     </span>
    </code>
    <span class="koboSpan" id="kobo.570.1">
     directive in a component file has one very important implication: all
    </span>
    <a id="_idIndexMarker853">
    </a>
    <span class="koboSpan" id="kobo.571.1">
     nested components become client components, too—even if you don’t use
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.572.1">
      'use client'
     </span>
    </code>
    <span class="koboSpan" id="kobo.573.1">
     in their component files.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.574.1">
     This is technically necessary since the JSX code of client components is re-evaluated, and all custom components used there are re-executed, every time the client component function is called again (e.g., because of some state change)—that’s something you learned in
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.575.1">
      Chapter 10
     </span>
    </em>
    <span class="koboSpan" id="kobo.576.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.577.1">
      Behind the Scenes of React and Optimization Opportunities
     </span>
    </em>
    <span class="koboSpan" id="kobo.578.1">
     .
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.579.1">
     As a result, all the components nested inside a client component must be client components themselves since their code would otherwise not be available on the client side.
    </span>
   </p>
   <figure class="mediaobject">
    <span class="koboSpan" id="kobo.580.1">
     <img alt="A diagram of a product  Description automatically generated" src="image/B31339_16_09.png"/>
    </span>
   </figure>
   <p class="packt_figref">
    <span class="koboSpan" id="kobo.581.1">
     Figure 16.9: Child components of client components become client components, too
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.582.1">
     To keep the
    </span>
    <a id="_idIndexMarker854">
    </a>
    <span class="koboSpan" id="kobo.583.1">
     client code bundle small and performant, it’s typically a good idea to maximize the number of server components and thus minimize the number of client components.
    </span>
    <span class="koboSpan" id="kobo.583.2">
     Since nested components of client components become client components automatically, you should therefore try to move the server-client boundary (i.e., the usage of
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.584.1">
      'use client'
     </span>
    </code>
    <span class="koboSpan" id="kobo.585.1">
     ) as far down the component tree as possible.
    </span>
    <span class="koboSpan" id="kobo.585.2">
     Ideally, only the leaves of your component tree use React Hooks or handle user input.
    </span>
    <span class="koboSpan" id="kobo.585.3">
     Put in other words: only use
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.586.1">
      'use client'
     </span>
    </code>
    <span class="koboSpan" id="kobo.587.1">
     when you must and try to affect as few components with it as possible.
    </span>
   </p>
   <figure class="mediaobject">
    <span class="koboSpan" id="kobo.588.1">
     <img alt="A diagram of a product  Description automatically generated" src="image/B31339_16_10.png"/>
    </span>
   </figure>
   <p class="packt_figref">
    <span class="koboSpan" id="kobo.589.1">
     Figure 16.10: The majority of components are RSCs
    </span>
   </p>
   <p class="normal">
    <em class="italic">
     <span class="koboSpan" id="kobo.590.1">
      Figure 16.10
     </span>
    </em>
    <span class="koboSpan" id="kobo.591.1">
     shows an
    </span>
    <a id="_idIndexMarker855">
    </a>
    <span class="koboSpan" id="kobo.592.1">
     example component tree where only a small subset of all components are client components.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.593.1">
     The question therefore is this: how can you combine and optimize the usage of server and client components in React projects that support RSCs?
    </span>
   </p>
   <h3 class="heading-3" id="_idParaDest-329">
    <span class="koboSpan" id="kobo.594.1">
     Combining RSCs and Client Components
    </span>
   </h3>
   <p class="normal">
    <span class="koboSpan" id="kobo.595.1">
     Typically, you’ll end up with React projects where most components don’t need to be client components (therefore, they should be RSCs), but where some component functions
    </span>
    <a id="_idIndexMarker856">
    </a>
    <span class="koboSpan" id="kobo.596.1">
     do need to run in the browser (i.e., they do need
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.597.1">
      'use client'
     </span>
    </code>
    <span class="koboSpan" id="kobo.598.1">
     ).
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.599.1">
     You can think of
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.600.1">
      'use client'
     </span>
    </code>
    <span class="koboSpan" id="kobo.601.1">
     marking the point in the component tree where the component type switches from server to client component (see
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.602.1">
      Figure 16.9
     </span>
    </em>
    <span class="koboSpan" id="kobo.603.1">
     and
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.604.1">
      Figure 16.10
     </span>
    </em>
    <span class="koboSpan" id="kobo.605.1">
     ).
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.606.1">
     For that reason, React allows you to combine both kinds of components in the same project, though, you need to follow a couple of important rules:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.607.1">
      Server components may import and render client components (i.e., output a client component in their JSX code).
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.608.1">
      Client components must not directly import and render server components that rely on server-side features.
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.609.1">
      Client components may implicitly render server components via props (e.g., via the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.610.1">
       children
      </span>
     </code>
     <span class="koboSpan" id="kobo.611.1">
      prop).
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.612.1">
     To make
    </span>
    <a id="_idIndexMarker857">
    </a>
    <span class="koboSpan" id="kobo.613.1">
     these rules a bit less abstract, each case will be shown with a concrete example.
    </span>
   </p>
   <h4 class="heading-4">
    <span class="koboSpan" id="kobo.614.1">
     Outputting Client Components in Server Components
    </span>
   </h4>
   <p class="normal">
    <span class="koboSpan" id="kobo.615.1">
     You can
    </span>
    <a id="_idIndexMarker858">
    </a>
    <span class="koboSpan" id="kobo.616.1">
     use client components in the JSX code of server components without issues.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.617.1">
     Consider the following example
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.618.1">
      UserTodos
     </span>
    </code>
    <span class="koboSpan" id="kobo.619.1">
     component, which allows users to manage an array of to-dos that’s stored locally via
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.620.1">
      localStorage
     </span>
    </code>
    <span class="koboSpan" id="kobo.621.1">
     :
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-string"><span class="koboSpan" id="kobo.622.1">'use client'</span></span><span class="koboSpan" id="kobo.623.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.624.1">import</span></span><span class="koboSpan" id="kobo.625.1"> { useEffect, useRef, useState } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.626.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.627.1">'react'</span></span><span class="koboSpan" id="kobo.628.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.629.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.630.1">default</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.631.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.632.1">UserTodos</span></span><span class="koboSpan" id="kobo.633.1">() {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.634.1">const</span></span><span class="koboSpan" id="kobo.635.1"> todoRef = </span><span class="hljs-title"><span class="koboSpan" id="kobo.636.1">useRef</span></span><span class="koboSpan" id="kobo.637.1">(</span><span class="hljs-literal"><span class="koboSpan" id="kobo.638.1">null</span></span><span class="koboSpan" id="kobo.639.1">);
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.640.1">const</span></span><span class="koboSpan" id="kobo.641.1"> [todos, setTodos] = </span><span class="hljs-title"><span class="koboSpan" id="kobo.642.1">useState</span></span><span class="koboSpan" id="kobo.643.1">([]);
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.644.1">useEffect</span></span><span class="koboSpan" id="kobo.645.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.646.1">() =&gt;</span></span><span class="koboSpan" id="kobo.647.1"> {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.648.1">const</span></span><span class="koboSpan" id="kobo.649.1"> storedTodos = </span><span class="hljs-variable"><span class="koboSpan" id="kobo.650.1">localStorage</span></span><span class="koboSpan" id="kobo.651.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.652.1">getItem</span></span><span class="koboSpan" id="kobo.653.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.654.1">'todos'</span></span><span class="koboSpan" id="kobo.655.1">);
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.656.1">setTodos</span></span><span class="koboSpan" id="kobo.657.1">(storedTodos ? </span><span class="hljs-title"><span class="koboSpan" id="kobo.658.1">JSON</span></span><span class="koboSpan" id="kobo.659.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.660.1">parse</span></span><span class="koboSpan" id="kobo.661.1">(storedTodos) : []);
  }, []);
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.662.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.663.1">handleAddTodo</span></span><span class="koboSpan" id="kobo.664.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.665.1">event</span></span><span class="koboSpan" id="kobo.666.1">) {
    event.</span><span class="hljs-title"><span class="koboSpan" id="kobo.667.1">preventDefault</span></span><span class="koboSpan" id="kobo.668.1">();
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.669.1">const</span></span><span class="koboSpan" id="kobo.670.1"> todo = todoRef.</span><span class="hljs-property"><span class="koboSpan" id="kobo.671.1">current</span></span><span class="koboSpan" id="kobo.672.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.673.1">value</span></span><span class="koboSpan" id="kobo.674.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.675.1">trim</span></span><span class="koboSpan" id="kobo.676.1">();
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.677.1">const</span></span><span class="koboSpan" id="kobo.678.1"> newTodo = {
      </span><span class="hljs-attr"><span class="koboSpan" id="kobo.679.1">id</span></span><span class="koboSpan" id="kobo.680.1">: </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.681.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.682.1">Date</span></span><span class="koboSpan" id="kobo.683.1">().</span><span class="hljs-title"><span class="koboSpan" id="kobo.684.1">getTime</span></span><span class="koboSpan" id="kobo.685.1">(),
      </span><span class="hljs-attr"><span class="koboSpan" id="kobo.686.1">text</span></span><span class="koboSpan" id="kobo.687.1">: todo,
    };
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.688.1">setTodos</span></span><span class="koboSpan" id="kobo.689.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.690.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.691.1">prevTodos</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.692.1">) =&gt;</span></span><span class="koboSpan" id="kobo.693.1"> [...prevTodos, newTodo]);
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.694.1">const</span></span><span class="koboSpan" id="kobo.695.1"> storedTodos = </span><span class="hljs-variable"><span class="koboSpan" id="kobo.696.1">localStorage</span></span><span class="koboSpan" id="kobo.697.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.698.1">getItem</span></span><span class="koboSpan" id="kobo.699.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.700.1">'todos'</span></span><span class="koboSpan" id="kobo.701.1">);
    </span><span class="hljs-variable"><span class="koboSpan" id="kobo.702.1">localStorage</span></span><span class="koboSpan" id="kobo.703.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.704.1">setItem</span></span><span class="koboSpan" id="kobo.705.1">(
      </span><span class="hljs-string"><span class="koboSpan" id="kobo.706.1">'todos'</span></span><span class="koboSpan" id="kobo.707.1">,
      </span><span class="hljs-title"><span class="koboSpan" id="kobo.708.1">JSON</span></span><span class="koboSpan" id="kobo.709.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.710.1">stringify</span></span><span class="koboSpan" id="kobo.711.1">(
        storedTodos 
          ? </span><span class="koboSpan" id="kobo.711.2">[...</span><span class="hljs-title"><span class="koboSpan" id="kobo.712.1">JSON</span></span><span class="koboSpan" id="kobo.713.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.714.1">parse</span></span><span class="koboSpan" id="kobo.715.1">(storedTodos), newTodo] 
          : [newTodo]
      )
    );
  }
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.716.1">return</span></span><span class="koboSpan" id="kobo.717.1"> (
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.718.1">&lt;&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.719.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.720.1">form</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.721.1">onSubmit</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.722.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.723.1">{handleAddTodo}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.724.1">&gt;</span></span>
<span class="language-xml">        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.725.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.726.1">input</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.727.1">type</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.728.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.729.1">"text"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.730.1">placeholder</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.731.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.732.1">"Your to-do"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.733.1">ref</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.734.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.735.1">{todoRef}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.736.1"> /&gt;</span></span>
<span class="language-xml">        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.737.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.738.1">button</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.739.1">type</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.740.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.741.1">"submit"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.742.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.743.1">Add</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.744.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.745.1">button</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.746.1">&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.747.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.748.1">form</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.749.1">&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.750.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.751.1">ul</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.752.1">&gt;</span></span>
<span class="language-xml"><span class="koboSpan" id="kobo.753.1">        {todos.map((todo) =&gt; (</span></span>
<span class="language-xml">          </span><span class="hljs-tag"><span class="koboSpan" id="kobo.754.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.755.1">li</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.756.1">key</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.757.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.758.1">{todo.id}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.759.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.760.1">{todo.text}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.761.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.762.1">li</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.763.1">&gt;</span></span>
<span class="language-xml"><span class="koboSpan" id="kobo.764.1">        ))}</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.765.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.766.1">ul</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.767.1">&gt;</span></span>
<span class="language-xml">    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.768.1">&lt;/&gt;</span></span><span class="koboSpan" id="kobo.769.1">
  );
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.770.1">
     Since
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.771.1">
      localStorage
     </span>
    </code>
    <span class="koboSpan" id="kobo.772.1">
     (a browser API), refs, state (
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.773.1">
      todos
     </span>
    </code>
    <span class="koboSpan" id="kobo.774.1">
     via
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.775.1">
      useState()
     </span>
    </code>
    <span class="koboSpan" id="kobo.776.1">
     ), and event listeners (
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.777.1">
      submit
     </span>
    </code>
    <span class="koboSpan" id="kobo.778.1">
     via
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.779.1">
      onSubmit
     </span>
    </code>
    <span class="koboSpan" id="kobo.780.1">
     ) are used, this must be a client component.
    </span>
    <span class="koboSpan" id="kobo.780.2">
     That’s why
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.781.1">
      'use client'
     </span>
    </code>
    <span class="koboSpan" id="kobo.782.1">
     is added at the top of the file.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.783.1">
     However, this
    </span>
    <a id="_idIndexMarker859">
    </a>
    <span class="koboSpan" id="kobo.784.1">
     component can be used in a server component without issues:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.785.1">import</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.786.1">UserTodos</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.787.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.788.1">'../components/UserTodos'</span></span><span class="koboSpan" id="kobo.789.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.790.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.791.1">default</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.792.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.793.1">Home</span></span><span class="koboSpan" id="kobo.794.1">() {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.795.1">return</span></span><span class="koboSpan" id="kobo.796.1"> (
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.797.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.798.1">main</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.799.1">&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.800.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.801.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.802.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.803.1">Manage your to-dos with ease!</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.804.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.805.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.806.1">&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.807.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.808.1">UserTodos</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.809.1"> /&gt;</span></span>
<span class="language-xml">    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.810.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.811.1">main</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.812.1">&gt;</span></span><span class="koboSpan" id="kobo.813.1">
  );
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.814.1">
     That’s possible because client components can also be rendered on the server—they’re just not exclusive to that environment (unlike RSCs, which are).
    </span>
    <span class="koboSpan" id="kobo.814.2">
     Put in other words: client components are rendered on the server like all components were in SSR projects that do not support RSCs (e.g., the Vite-based SSR-enabled project from the previous section).
    </span>
    <span class="koboSpan" id="kobo.814.3">
     An initial snapshot is rendered upon the first request, thereafter client-side React takes
    </span>
    <a id="_idIndexMarker860">
    </a>
    <span class="koboSpan" id="kobo.815.1">
     over and hydrates the component.
    </span>
   </p>
   <div class="note">
    <p class="normal">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.816.1">
       Note
      </span>
     </strong>
    </p>
    <p class="normal">
     <span class="koboSpan" id="kobo.817.1">
      In the preceding example, data is loaded from
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.818.1">
       localStorage
      </span>
     </code>
     <span class="koboSpan" id="kobo.819.1">
      via
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.820.1">
       useEffect()
      </span>
     </code>
     <span class="koboSpan" id="kobo.821.1">
      .
     </span>
     <span class="koboSpan" id="kobo.821.2">
      This is done to ensure that the code runs on the server.
     </span>
     <span class="koboSpan" id="kobo.821.3">
      Since
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.822.1">
       localStorage
      </span>
     </code>
     <span class="koboSpan" id="kobo.823.1">
      is not available there, accessing it without wrapping with
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.824.1">
       useEffect()
      </span>
     </code>
     <span class="koboSpan" id="kobo.825.1">
      would cause an error.
     </span>
    </p>
    <p class="normal">
     <span class="koboSpan" id="kobo.826.1">
      Since
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.827.1">
       useEffect()
      </span>
     </code>
     <span class="koboSpan" id="kobo.828.1">
      is ignored on the server, it’s a safe way of using browser-exclusive APIs.
     </span>
    </p>
   </div>
   <h4 class="heading-4">
    <span class="koboSpan" id="kobo.829.1">
     Outputting Server Components in Client Components
    </span>
   </h4>
   <p class="normal">
    <span class="koboSpan" id="kobo.830.1">
     As already mentioned in the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.831.1">
      ‘use client’ Affects Child Components, Too!
     </span>
    </em>
    <span class="koboSpan" id="kobo.832.1">
     section, you can’t
    </span>
    <a id="_idIndexMarker861">
    </a>
    <span class="koboSpan" id="kobo.833.1">
     import server components into client components and render them there.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.834.1">
     Though, in many situations, you’ll not get an error.
    </span>
    <span class="koboSpan" id="kobo.834.2">
     For example, you might have a client-side
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.835.1">
      Cart
     </span>
    </code>
    <span class="koboSpan" id="kobo.836.1">
     component defined like this:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.837.1">'use client'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.838.1">;</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.839.1">import</span></span><span class="koboSpan" id="kobo.840.1"> { useState } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.841.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.842.1">'react'</span></span><span class="koboSpan" id="kobo.843.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.844.1">import</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.845.1">CartItem</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.846.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.847.1">'./CartItem'</span></span><span class="koboSpan" id="kobo.848.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.849.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.850.1">default</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.851.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.852.1">Cart</span></span><span class="koboSpan" id="kobo.853.1">() {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.854.1">const</span></span><span class="koboSpan" id="kobo.855.1"> [isVisible, setIsVisible] = </span><span class="hljs-title"><span class="koboSpan" id="kobo.856.1">useState</span></span><span class="koboSpan" id="kobo.857.1">(</span><span class="hljs-literal"><span class="koboSpan" id="kobo.858.1">false</span></span><span class="koboSpan" id="kobo.859.1">);
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.860.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.861.1">handleCartVisibility</span></span><span class="koboSpan" id="kobo.862.1">() {
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.863.1">setIsVisible</span></span><span class="koboSpan" id="kobo.864.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.865.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.866.1">prevState</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.867.1">) =&gt;</span></span><span class="koboSpan" id="kobo.868.1"> !prevState);
  }
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.869.1">return</span></span><span class="koboSpan" id="kobo.870.1"> (
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.871.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.872.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.873.1">id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.874.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.875.1">"cart"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.876.1">&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.877.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.878.1">button</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.879.1">onClick</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.880.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.881.1">{handleCartVisibility}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.882.1">&gt;</span></span>
<span class="language-xml"><span class="koboSpan" id="kobo.883.1">        {isVisible ? </span><span class="koboSpan" id="kobo.883.2">'Hide Cart' : 'Show Cart'}</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.884.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.885.1">button</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.886.1">&gt;</span></span>
<span class="language-xml"><span class="koboSpan" id="kobo.887.1">      {isVisible &amp;&amp; (</span></span>
<span class="language-xml">        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.888.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.889.1">ul</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.890.1">&gt;</span></span>
          <span class="code-highlight"><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.891.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.892.1">CartItem</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.893.1">title</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.894.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.895.1">{</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.896.1">'</span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.897.1">Book</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.898.1">'</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.899.1">}</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.900.1">quantity</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.901.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.902.1">{1}</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.903.1"> /&gt;</span></strong></span>
          <span class="code-highlight"><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.904.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.905.1">CartItem</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.906.1">title</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.907.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.908.1">{</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.909.1">'</span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.910.1">Pen</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.911.1">'</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.912.1">}</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.913.1">quantity</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.914.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.915.1">{2}</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.916.1"> /&gt;</span></strong></span>
          <span class="code-highlight"><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.917.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.918.1">CartItem</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.919.1">title</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.920.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.921.1">{</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.922.1">'</span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.923.1">Pencil</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.924.1">'</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.925.1">}</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.926.1">quantity</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.927.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.928.1">{5}</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.929.1"> /&gt;</span></strong></span>
<span class="language-xml">        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.930.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.931.1">ul</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.932.1">&gt;</span></span>
<span class="language-xml"><span class="koboSpan" id="kobo.933.1">      )}</span></span>
<span class="language-xml">    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.934.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.935.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.936.1">&gt;</span></span><span class="koboSpan" id="kobo.937.1">
  );
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.938.1">
     Unlike
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.939.1">
      Cart
     </span>
    </code>
    <span class="koboSpan" id="kobo.940.1">
     , the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.941.1">
      CartItem
     </span>
    </code>
    <span class="koboSpan" id="kobo.942.1">
     component function might be a server component (i.e., it’s not
    </span>
    <a id="_idIndexMarker862">
    </a>
    <span class="koboSpan" id="kobo.943.1">
     marked via
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.944.1">
      'use client'
     </span>
    </code>
    <span class="koboSpan" id="kobo.945.1">
     ):
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.946.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.947.1">default</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.948.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.949.1">CartItem</span></span><span class="koboSpan" id="kobo.950.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.951.1">{ title, quantity }</span></span><span class="koboSpan" id="kobo.952.1">) {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.953.1">return</span></span><span class="koboSpan" id="kobo.954.1"> (
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.955.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.956.1">li</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.957.1">&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.958.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.959.1">article</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.960.1">&gt;</span></span>
<span class="language-xml">        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.961.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.962.1">h2</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.963.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.964.1">{title}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.965.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.966.1">h2</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.967.1">&gt;</span></span>
<span class="language-xml">        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.968.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.969.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.970.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.971.1">Quantity: {quantity}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.972.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.973.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.974.1">&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.975.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.976.1">article</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.977.1">&gt;</span></span>
<span class="language-xml">    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.978.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.979.1">li</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.980.1">&gt;</span></span><span class="koboSpan" id="kobo.981.1">
  );
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.982.1">
     This code works because the component that used to be a server component (
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.983.1">
      CartItem
     </span>
    </code>
    <span class="koboSpan" id="kobo.984.1">
     ) simply becomes a client component once it is imported and used in a client component file.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.985.1">
     You will, however, face an error message if you’re trying to import and use a server component that uses server component-specific features, like a Node.js API or
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.986.1">
      async/await
     </span>
    </code>
    <span class="koboSpan" id="kobo.987.1">
     .
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.988.1">
     For example, the following adjusted
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.989.1">
      DynamicCartItem
     </span>
    </code>
    <span class="koboSpan" id="kobo.990.1">
     component tries to use Node’s
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.991.1">
      fs
     </span>
    </code>
    <span class="koboSpan" id="kobo.992.1">
     package to load a cart item from a file:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.993.1">import</span></span><span class="koboSpan" id="kobo.994.1"> fs </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.995.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.996.1">'node:fs/promises'</span></span><span class="koboSpan" id="kobo.997.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.998.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.999.1">default</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1000.1">async</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1001.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1002.1">DyncamicCartItem</span></span><span class="koboSpan" id="kobo.1003.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.1004.1">{ id }</span></span><span class="koboSpan" id="kobo.1005.1">) {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1006.1">const</span></span><span class="koboSpan" id="kobo.1007.1"> data = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1008.1">await</span></span><span class="koboSpan" id="kobo.1009.1"> fs.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1010.1">readFile</span></span><span class="koboSpan" id="kobo.1011.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1012.1">`data/cart.json`</span></span><span class="koboSpan" id="kobo.1013.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.1014.1">'utf8'</span></span><span class="koboSpan" id="kobo.1015.1">);
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1016.1">const</span></span><span class="koboSpan" id="kobo.1017.1"> storedCart = </span><span class="hljs-title"><span class="koboSpan" id="kobo.1018.1">JSON</span></span><span class="koboSpan" id="kobo.1019.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1020.1">parse</span></span><span class="koboSpan" id="kobo.1021.1">(data);
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1022.1">const</span></span><span class="koboSpan" id="kobo.1023.1"> cartItem = storedCart.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1024.1">find</span></span><span class="koboSpan" id="kobo.1025.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.1026.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1027.1">item</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1028.1">) =&gt;</span></span><span class="koboSpan" id="kobo.1029.1"> item.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1030.1">id</span></span><span class="koboSpan" id="kobo.1031.1"> === id);
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1032.1">return</span></span><span class="koboSpan" id="kobo.1033.1"> (
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1034.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1035.1">li</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1036.1">&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1037.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1038.1">article</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1039.1">&gt;</span></span>
<span class="language-xml">        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1040.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1041.1">h2</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1042.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.1043.1">{cartItem.title}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1044.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1045.1">h2</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1046.1">&gt;</span></span>
<span class="language-xml">        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1047.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1048.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1049.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.1050.1">Quantity: {cartItem.quantity}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1051.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1052.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1053.1">&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1054.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1055.1">article</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1056.1">&gt;</span></span>
<span class="language-xml">    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1057.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1058.1">li</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1059.1">&gt;</span></span><span class="koboSpan" id="kobo.1060.1">
  );
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1061.1">
     Importing and using this component in the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1062.1">
      Cart
     </span>
    </code>
    <span class="koboSpan" id="kobo.1063.1">
     component will cause an error.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1064.1">
     Trying
    </span>
    <a id="_idIndexMarker863">
    </a>
    <span class="koboSpan" id="kobo.1065.1">
     to run this code will lead to an error message being shown on the screen because React fails to automatically convert
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1066.1">
      CartItem
     </span>
    </code>
    <span class="koboSpan" id="kobo.1067.1">
     to a client component (due to the usage of RSC-exclusive features).
    </span>
    <span class="koboSpan" id="kobo.1067.2">
     Therefore, it’ll complain about some server-side code (e.g., some Node.js API) you’re trying to use on the client side.
    </span>
   </p>
   <figure class="mediaobject">
    <span class="koboSpan" id="kobo.1068.1">
     <img alt="img" src="image/B31339_16_11.png"/>
    </span>
   </figure>
   <p class="packt_figref">
    <span class="koboSpan" id="kobo.1069.1">
     Figure 16.11: React complains about the usage of a Node.js API in the browser
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1070.1">
     Hence, in situations like this, you’ll need to restructure your application to end up with a valid component combination again.
    </span>
    <span class="koboSpan" id="kobo.1070.2">
     For example, by passing server components as props to client components, instead of directly importing and rendering them.
    </span>
   </p>
   <h4 class="heading-4">
    <span class="koboSpan" id="kobo.1071.1">
     Rendering Server Components via Props
    </span>
   </h4>
   <p class="normal">
    <span class="koboSpan" id="kobo.1072.1">
     You can’t import and use server components that perform some server-side exclusive operation (like using Node.js APIs) in client components.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1073.1">
     But
    </span>
    <a id="_idIndexMarker864">
    </a>
    <span class="koboSpan" id="kobo.1074.1">
     you can change your client component code to not directly import and use the server component.
    </span>
    <span class="koboSpan" id="kobo.1074.2">
     Instead, you can expect to get a server component as a prop—for example, via the special
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1075.1">
      children
     </span>
    </code>
    <span class="koboSpan" id="kobo.1076.1">
     prop about which you learned in
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1077.1">
      Chapter 3
     </span>
    </em>
    <span class="koboSpan" id="kobo.1078.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1079.1">
      Components and Props
     </span>
    </em>
    <span class="koboSpan" id="kobo.1080.1">
     :
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-string"><span class="koboSpan" id="kobo.1081.1">'use client'</span></span><span class="koboSpan" id="kobo.1082.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1083.1">import</span></span><span class="koboSpan" id="kobo.1084.1"> { useState } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1085.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1086.1">'react'</span></span><span class="koboSpan" id="kobo.1087.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1088.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1089.1">default</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1090.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1091.1">Cart</span></span><span class="koboSpan" id="kobo.1092.1">(</span><span class="code-highlight"><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1093.1">{ children }</span></strong></span><span class="koboSpan" id="kobo.1094.1">) {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1095.1">const</span></span><span class="koboSpan" id="kobo.1096.1"> [isVisible, setIsVisible] = </span><span class="hljs-title"><span class="koboSpan" id="kobo.1097.1">useState</span></span><span class="koboSpan" id="kobo.1098.1">(</span><span class="hljs-literal"><span class="koboSpan" id="kobo.1099.1">false</span></span><span class="koboSpan" id="kobo.1100.1">);
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1101.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1102.1">handleCartVisibility</span></span><span class="koboSpan" id="kobo.1103.1">() {
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1104.1">setIsVisible</span></span><span class="koboSpan" id="kobo.1105.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.1106.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1107.1">prevState</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1108.1">) =&gt;</span></span><span class="koboSpan" id="kobo.1109.1"> !prevState);
  }
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1110.1">return</span></span><span class="koboSpan" id="kobo.1111.1"> (
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1112.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1113.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1114.1">id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1115.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1116.1">"cart"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1117.1">&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1118.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1119.1">button</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1120.1">onClick</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1121.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1122.1">{handleCartVisibility}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1123.1">&gt;</span></span>
<span class="language-xml"><span class="koboSpan" id="kobo.1124.1">        {isVisible ? </span><span class="koboSpan" id="kobo.1124.2">'Hide Cart' : 'Show Cart'}</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1125.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1126.1">button</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1127.1">&gt;</span></span>
<span class="language-xml"><span class="koboSpan" id="kobo.1128.1">      {isVisible &amp;&amp; </span></span><span class="code-highlight"><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1129.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1130.1">ul</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1131.1">&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1132.1">{children}</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1133.1">&lt;/</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1134.1">ul</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1135.1">&gt;</span></strong></span><span class="language-xml"><span class="koboSpan" id="kobo.1136.1">}</span></span>
<span class="language-xml">    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1137.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1138.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1139.1">&gt;</span></span><span class="koboSpan" id="kobo.1140.1">
  );
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1141.1">
     This
    </span>
    <a id="_idIndexMarker865">
    </a>
    <span class="koboSpan" id="kobo.1142.1">
     adjusted
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1143.1">
      Cart
     </span>
    </code>
    <span class="koboSpan" id="kobo.1144.1">
     component is still a client component.
    </span>
    <span class="koboSpan" id="kobo.1144.2">
     However, since it no longer directly imports and renders the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1145.1">
      DynamicCartItem
     </span>
    </code>
    <span class="koboSpan" id="kobo.1146.1">
     server component, React is happy.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1147.1">
     Instead, the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1148.1">
      DynamicCartItem
     </span>
    </code>
    <span class="koboSpan" id="kobo.1149.1">
     component is now imported and output in the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1150.1">
      Home
     </span>
    </code>
    <span class="koboSpan" id="kobo.1151.1">
     component like this:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1152.1">import</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1153.1">DyncamicCartItem</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1154.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1155.1">'../components/DynamicCartItem'</span></span><span class="koboSpan" id="kobo.1156.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1157.1">import</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1158.1">Cart</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1159.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1160.1">'../components/Cart'</span></span><span class="koboSpan" id="kobo.1161.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1162.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1163.1">default</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1164.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1165.1">Home</span></span><span class="koboSpan" id="kobo.1166.1">() {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1167.1">return</span></span><span class="koboSpan" id="kobo.1168.1"> (
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1169.1">&lt;&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1170.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1171.1">header</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1172.1">&gt;</span></span>
<span class="language-xml">        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1173.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1174.1">Cart</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1175.1">&gt;</span></span>
<span class="language-xml">          </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1176.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1177.1">DyncamicCartItem</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1178.1">id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1179.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1180.1">{1}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1181.1"> /&gt;</span></span>
<span class="language-xml">          </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1182.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1183.1">DyncamicCartItem</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1184.1">id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1185.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1186.1">{2}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1187.1"> /&gt;</span></span>
<span class="language-xml">          </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1188.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1189.1">DyncamicCartItem</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1190.1">id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1191.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1192.1">{3}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1193.1"> /&gt;</span></span>
<span class="language-xml">        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1194.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1195.1">Cart</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1196.1">&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1197.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1198.1">header</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1199.1">&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1200.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1201.1">main</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1202.1">&gt;</span></span>
<span class="language-xml">        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1203.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1204.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1205.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.1206.1">Some dummy app</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1207.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1208.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1209.1">&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1210.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1211.1">main</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1212.1">&gt;</span></span>
<span class="language-xml">    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1213.1">&lt;/&gt;</span></span><span class="koboSpan" id="kobo.1214.1">
  );
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1215.1">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1216.1">
      DynamicCartItem
     </span>
    </code>
    <span class="koboSpan" id="kobo.1217.1">
     elements are passed as a value for the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1218.1">
      children
     </span>
    </code>
    <span class="koboSpan" id="kobo.1219.1">
     prop to the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1220.1">
      Cart
     </span>
    </code>
    <span class="koboSpan" id="kobo.1221.1">
     component.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1222.1">
     This might be unintuitive at first but it’s vital to understand that this works because the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1223.1">
      DynamicCartItem
     </span>
    </code>
    <span class="koboSpan" id="kobo.1224.1">
     components are now rendered as part of another server component—the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1225.1">
      Home
     </span>
    </code>
    <span class="koboSpan" id="kobo.1226.1">
     component.
    </span>
    <span class="koboSpan" id="kobo.1226.2">
     It’s the result of that rendering process that’s then passed as a value to the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1227.1">
      Cart
     </span>
    </code>
    <span class="koboSpan" id="kobo.1228.1">
     component.
    </span>
    <span class="koboSpan" id="kobo.1228.2">
     That component therefore does not include the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1229.1">
      DynamicCartItem
     </span>
    </code>
    <span class="koboSpan" id="kobo.1230.1">
     component in its part of the component tree.
    </span>
    <span class="koboSpan" id="kobo.1230.2">
     Instead, both
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1231.1">
      Cart
     </span>
    </code>
    <span class="koboSpan" id="kobo.1232.1">
     and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1233.1">
      DynamicCartItem
     </span>
    </code>
    <span class="koboSpan" id="kobo.1234.1">
     are direct children of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1235.1">
      Home
     </span>
    </code>
    <span class="koboSpan" id="kobo.1236.1">
     component.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1237.1">
     The
    </span>
    <a id="_idIndexMarker866">
    </a>
    <span class="koboSpan" id="kobo.1238.1">
     overall application component tree would look like this:
    </span>
   </p>
   <figure class="mediaobject">
    <span class="koboSpan" id="kobo.1239.1">
     <img alt="img" src="image/B31339_16_12.png"/>
    </span>
   </figure>
   <p class="packt_figref">
    <span class="koboSpan" id="kobo.1240.1">
     Figure 16.12: DynamicCartItem and Cart are both direct child components of the Home component
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1241.1">
     Even though, in the finished UI, it might look as if the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1242.1">
      DynamicCartItem
     </span>
    </code>
    <span class="koboSpan" id="kobo.1243.1">
     is a child of
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1244.1">
      Cart
     </span>
    </code>
    <span class="koboSpan" id="kobo.1245.1">
     , technically, it’s not.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1246.1">
     It’s key to understand that wrapping a component with another component (
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1247.1">
      &lt;Cart&gt;&lt;DynamicCartItem /&gt;&lt;/Cart&gt;
     </span>
    </code>
    <span class="koboSpan" id="kobo.1248.1">
     ) leads to a different component tree structure than rendering a component inside another component.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1249.1">
     This is therefore a pattern that can be useful in situations where you might need to include a server component in a client component.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1250.1">
     Overall, you are able to combine RSCs and client components as needed.
    </span>
    <span class="koboSpan" id="kobo.1250.2">
     Furthermore, Next.js also provides some additional features that can help with RSCs and data fetching via RSCs.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-330">
    <span class="koboSpan" id="kobo.1251.1">
     Advanced Data Fetching with Next.js
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.1252.1">
     As mentioned before, in the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1253.1">
      Making Sense of RSCs
     </span>
    </em>
    <span class="koboSpan" id="kobo.1254.1">
     section, data fetching via RSCs offers various
    </span>
    <a id="_idIndexMarker867">
    </a>
    <span class="koboSpan" id="kobo.1255.1">
     advantages compared to data fetching in
    </span>
    <a id="_idIndexMarker868">
    </a>
    <span class="koboSpan" id="kobo.1256.1">
     client components.
    </span>
    <span class="koboSpan" id="kobo.1256.2">
     You don’t have to use
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1257.1">
      useEffect()
     </span>
    </code>
    <span class="koboSpan" id="kobo.1258.1">
     to send HTTP requests to separate backend APIs, you can directly reach out to a database, you can use
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1259.1">
      async/await
     </span>
    </code>
    <span class="koboSpan" id="kobo.1260.1">
     , and so on.
    </span>
    <span class="koboSpan" id="kobo.1260.2">
     Therefore, it’s absolutely recommended to fetch data via RSCs whenever possible.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1261.1">
     When working with Next.js, RSC-based data fetching becomes even easier because Next.js helps with showing fallback content while you’re waiting for data to arrive.
    </span>
   </p>
   <h3 class="heading-3" id="_idParaDest-331">
    <span class="koboSpan" id="kobo.1262.1">
     Managing Loading States with Next.js
    </span>
   </h3>
   <p class="normal">
    <span class="koboSpan" id="kobo.1263.1">
     When working with Next.js (with the App Router), you can define
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1264.1">
      loading.js
     </span>
    </code>
    <span class="koboSpan" id="kobo.1265.1">
     files inside the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1266.1">
      app/
     </span>
    </code>
    <span class="koboSpan" id="kobo.1267.1">
     folder
    </span>
    <a id="_idIndexMarker869">
    </a>
    <span class="koboSpan" id="kobo.1268.1">
     to set up components that will be rendered while sibling or nested server components are loading data.
    </span>
    <span class="koboSpan" id="kobo.1268.2">
     Next.js determines whether a component is loading data or not by checking whether it returns a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1269.1">
      Promise
     </span>
    </code>
    <span class="koboSpan" id="kobo.1270.1">
     that hasn’t resolved yet.
    </span>
   </p>
   <div class="note">
    <p class="normal">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1271.1">
       Note
      </span>
     </strong>
    </p>
    <p class="normal">
     <span class="koboSpan" id="kobo.1272.1">
      The next chapter will dive even deeper into handling loading states and showing fallback content.
     </span>
     <span class="koboSpan" id="kobo.1272.2">
      It will explore React’s Suspense feature, which allows for granular loading state management as data streams in.
     </span>
    </p>
   </div>
   <p class="normal">
    <span class="koboSpan" id="kobo.1273.1">
     Consider this example
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1274.1">
      GoalsPage
     </span>
    </code>
    <span class="koboSpan" id="kobo.1275.1">
     component, which fetches data from a file:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1276.1">import</span></span><span class="koboSpan" id="kobo.1277.1"> fs </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1278.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1279.1">'node:fs/promises'</span></span><span class="koboSpan" id="kobo.1280.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1281.1">async</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1282.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1283.1">fetchGoals</span></span><span class="koboSpan" id="kobo.1284.1">() {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1285.1">await</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1286.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1287.1">Promise</span></span><span class="koboSpan" id="kobo.1288.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.1289.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1290.1">resolve</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1291.1">) =&gt;</span></span> <span class="hljs-built_in"><span class="koboSpan" id="kobo.1292.1">setTimeout</span></span><span class="koboSpan" id="kobo.1293.1">(resolve, </span><span class="hljs-number"><span class="koboSpan" id="kobo.1294.1">3000</span></span><span class="koboSpan" id="kobo.1295.1">)); </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1296.1">// delay</span></span>
  <span class="hljs-keyword"><span class="koboSpan" id="kobo.1297.1">const</span></span><span class="koboSpan" id="kobo.1298.1"> goals = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1299.1">await</span></span><span class="koboSpan" id="kobo.1300.1"> fs.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1301.1">readFile</span></span><span class="koboSpan" id="kobo.1302.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1303.1">'./data/user-goals.json'</span></span><span class="koboSpan" id="kobo.1304.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.1305.1">'utf-8'</span></span><span class="koboSpan" id="kobo.1306.1">);
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1307.1">return</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1308.1">JSON</span></span><span class="koboSpan" id="kobo.1309.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1310.1">parse</span></span><span class="koboSpan" id="kobo.1311.1">(goals);
}
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1312.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1313.1">default</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1314.1">async</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1315.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1316.1">GoalsPage</span></span><span class="koboSpan" id="kobo.1317.1">() {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1318.1">const</span></span><span class="koboSpan" id="kobo.1319.1"> fetchedGoals = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1320.1">await</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1321.1">fetchGoals</span></span><span class="koboSpan" id="kobo.1322.1">();
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1323.1">return</span></span><span class="koboSpan" id="kobo.1324.1"> (
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1325.1">&lt;&gt;</span></span>
<span class="language-xml">    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1326.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1327.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1328.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.1329.1">Top User Goals</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1330.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1331.1">h1</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1332.1">&gt;</span></span>
<span class="language-xml">    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1333.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1334.1">ul</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1335.1">&gt;</span></span>
<span class="language-xml"><span class="koboSpan" id="kobo.1336.1">      {fetchedGoals.map((goal) =&gt; (</span></span>
<span class="language-xml">        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1337.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1338.1">li</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1339.1">key</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1340.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1341.1">{goal}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1342.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.1343.1">{goal}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1344.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1345.1">li</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1346.1">&gt;</span></span>
<span class="language-xml"><span class="koboSpan" id="kobo.1347.1">      ))}</span></span>
<span class="language-xml">    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1348.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1349.1">ul</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1350.1">&gt;</span></span>
<span class="language-xml">    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1351.1">&lt;/&gt;</span></span><span class="koboSpan" id="kobo.1352.1">
  );
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1353.1">
     The function (
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1354.1">
      fetchGoals()
     </span>
    </code>
    <span class="koboSpan" id="kobo.1355.1">
     ) that performs the actual data fetching has a delay built-in to simulate
    </span>
    <a id="_idIndexMarker870">
    </a>
    <span class="koboSpan" id="kobo.1356.1">
     a slow database or network connection.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1357.1">
     Without a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1358.1">
      loading.js
     </span>
    </code>
    <span class="koboSpan" id="kobo.1359.1">
     file added to the project, the user will stare at a blank or outdated page for a couple of seconds before the requested page is rendered.
    </span>
   </p>
   <figure class="mediaobject">
    <span class="koboSpan" id="kobo.1360.1">
     <img alt="A screenshot of a computer  Description automatically generated" src="image/B31339_16_13.png"/>
    </span>
   </figure>
   <p class="packt_figref">
    <span class="koboSpan" id="kobo.1361.1">
     Figure 16.13: After clicking the link, it takes three seconds for the new page to load
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1362.1">
     This behavior occurs because the new page is not ready yet and can’t be rendered since it’s still fetching data.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1363.1">
     To improve the user experience, a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1364.1">
      loading.js
     </span>
    </code>
    <span class="koboSpan" id="kobo.1365.1">
     file can be added next to the slow
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1366.1">
      app/goals/page.js
     </span>
    </code>
    <span class="koboSpan" id="kobo.1367.1">
     file (or, if necessary, in some parent folder, since
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1368.1">
      loading.js
     </span>
    </code>
    <span class="koboSpan" id="kobo.1369.1">
     will also display its content for child routes).
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1370.1">
     Inside the newly created
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1371.1">
      app/goals/loading.js
     </span>
    </code>
    <span class="koboSpan" id="kobo.1372.1">
     file, a regular React component is created.
    </span>
    <span class="koboSpan" id="kobo.1372.2">
     Like all components in Next.js projects, this is an RSC by default:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1373.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1374.1">default</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1375.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1376.1">LoadingGoals</span></span><span class="koboSpan" id="kobo.1377.1">() {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1378.1">return</span></span> <span class="hljs-tag"><span class="koboSpan" id="kobo.1379.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1380.1">p</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1381.1">id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1382.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1383.1">"fallback"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1384.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.1385.1">Loading user goals, please wait...</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1386.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1387.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1388.1">&gt;</span></span><span class="koboSpan" id="kobo.1389.1">;
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1390.1">
     The component name (
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1391.1">
      LoadingGoals
     </span>
    </code>
    <span class="koboSpan" id="kobo.1392.1">
     ) does not matter.
    </span>
    <span class="koboSpan" id="kobo.1392.2">
     But this component now ensures that the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1393.1">
      Loading user goals, please wait…
     </span>
    </code>
    <span class="koboSpan" id="kobo.1394.1">
     fallback text is shown on the screen while the user waits for the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1395.1">
      GoalsPage
     </span>
    </code>
    <span class="koboSpan" id="kobo.1396.1">
     to load and render.
    </span>
   </p>
   <figure class="mediaobject">
    <span class="koboSpan" id="kobo.1397.1">
     <img alt="img" src="image/B31339_16_14.png"/>
    </span>
   </figure>
   <p class="packt_figref">
    <span class="koboSpan" id="kobo.1398.1">
     Figure 16.14: The loading fallback content is shown while the page is transitioning
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1399.1">
     Of course, you can
    </span>
    <a id="_idIndexMarker871">
    </a>
    <span class="koboSpan" id="kobo.1400.1">
     show any fallback content of your choice—it doesn’t have to be some simple text as in this example.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1401.1">
     Therefore, when working with Next.js, adding
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1402.1">
      loading.js
     </span>
    </code>
    <span class="koboSpan" id="kobo.1403.1">
     files to define fallback components can tremendously improve the experience of your website users.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1404.1">
     Besides fetching data, many React apps also need to change data at some point.
    </span>
   </p>
   <h1 class="heading-1" id="_idParaDest-332">
    <span class="koboSpan" id="kobo.1405.1">
     From Data Fetching to Data Mutations
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.1406.1">
     At this
    </span>
    <a id="_idIndexMarker872">
    </a>
    <span class="koboSpan" id="kobo.1407.1">
     point, you have learned a lot about RSCs, client components, and how they can (and cannot) work together.
    </span>
    <span class="koboSpan" id="kobo.1407.2">
     In the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1408.1">
      Making Sense of RSCs
     </span>
    </em>
    <span class="koboSpan" id="kobo.1409.1">
     section, you also learned about some advantages offered by RSCs.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1410.1">
     Of course, you also might want to change data, though—not just load and display it.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-333">
    <span class="koboSpan" id="kobo.1411.1">
     Handling Data Mutations with Server Actions
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.1412.1">
     React does
    </span>
    <a id="_idIndexMarker873">
    </a>
    <span class="koboSpan" id="kobo.1413.1">
     not just provide support for RSCs; it also allows you to add so-called
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.1414.1">
      Server Actions
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1415.1">
     to your applications.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1416.1">
     Server Actions
    </span>
    <a id="_idIndexMarker874">
    </a>
    <span class="koboSpan" id="kobo.1417.1">
     build up on the same idea
    </span>
    <a id="_idIndexMarker875">
    </a>
    <span class="koboSpan" id="kobo.1418.1">
     as client (form) actions, which were introduced and explained in
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1419.1">
      Chapter 9
     </span>
    </em>
    <span class="koboSpan" id="kobo.1420.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1421.1">
      Handling User Input &amp; Forms with Form Actions
     </span>
    </em>
    <span class="koboSpan" id="kobo.1422.1">
     .
    </span>
    <span class="koboSpan" id="kobo.1422.2">
     However, Server Actions, as their name implies, will execute on the server side, not on the client side.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1423.1">
     Hence, you can use Server Actions to retrieve submitted user input on the server and process it there.
    </span>
    <span class="koboSpan" id="kobo.1423.2">
     For example, you could store the submitted data in a file or database.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1424.1">
     Consequently, Server Actions are an important building block when aiming to build fully integrated fullstack React applications.
    </span>
    <span class="koboSpan" id="kobo.1424.2">
     Typically, data fetching alone is not enough, which is why the Server Actions feature exists.
    </span>
    <span class="koboSpan" id="kobo.1424.3">
     By having both, RSCs and Server Actions, you’re able to fetch and mutate data on the server, while still enabling interactive client-side user experiences where needed.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-334">
    <span class="koboSpan" id="kobo.1425.1">
     Unlocking Server Actions in React Projects
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.1426.1">
     Like RSCs, you can’t use Server Actions in all React projects.
    </span>
    <span class="koboSpan" id="kobo.1426.2">
     Instead, a special project setup is
    </span>
    <a id="_idIndexMarker876">
    </a>
    <span class="koboSpan" id="kobo.1427.1">
     required to use this feature.
    </span>
    <span class="koboSpan" id="kobo.1427.2">
     For example, Next.js projects support Server Actions out of the box (when using the App Router).
    </span>
    <span class="koboSpan" id="kobo.1427.3">
     Just as with RSCs, you can think of Next.js doing the following things:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.1428.1">
      The build workflow and bundling process separate the code that belongs to Server Actions so that it doesn’t end up in the client-side bundle.
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.1429.1">
      Next.js sets up API endpoints that trigger the Server Action functions and respond with any return values defined in those functions.
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.1430.1">
      Next.js calls these endpoints when needed (e.g., when submitting a form that’s connected to a Server Action—as shown in the next section).
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.1431.1">
     Therefore, Server Actions, like RSCs, can be tricky to support in custom projects that do not use Next.js.
    </span>
    <span class="koboSpan" id="kobo.1431.2">
     It’s absolutely possible to create custom projects that provide support for both Server Actions and RSCs, but it’s not trivial.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1432.1">
     Thankfully, using Server Actions (in projects that support them) is not complicated, though.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-335">
    <span class="koboSpan" id="kobo.1433.1">
     Defining and Triggering Server Actions
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.1434.1">
     As mentioned in the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1435.1">
      Handling Data Mutations with Server Actions
     </span>
    </em>
    <span class="koboSpan" id="kobo.1436.1">
     section, Server Actions
    </span>
    <a id="_idIndexMarker877">
    </a>
    <span class="koboSpan" id="kobo.1437.1">
     are very similar to the client form actions you already know from
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1438.1">
      Chapter 9
     </span>
    </em>
    <span class="koboSpan" id="kobo.1439.1">
     .
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1440.1">
     But there
    </span>
    <a id="_idIndexMarker878">
    </a>
    <span class="koboSpan" id="kobo.1441.1">
     are two key differences that must be considered when creating a Server Action:
    </span>
   </p>
   <ul>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.1442.1">
      A Server Action function must be asynchronous— (i.e., it must use
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1443.1">
       async/await
      </span>
     </code>
     <span class="koboSpan" id="kobo.1444.1">
      ).
     </span>
     <span class="koboSpan" id="kobo.1444.2">
      There are no synchronous Server Actions.
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.1445.1">
      Inside the Server Action function, at the very beginning of the function body, you must add the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1446.1">
       'use server'
      </span>
     </code>
     <span class="koboSpan" id="kobo.1447.1">
      directive.
     </span>
    </li>
   </ul>
   <p class="normal">
    <span class="koboSpan" id="kobo.1448.1">
     A valid Server Action can therefore be defined and used in a component like this:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1449.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1450.1">default</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1451.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1452.1">UserFeedback</span></span><span class="koboSpan" id="kobo.1453.1">() {
  </span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1454.1">async</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1455.1">function</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1456.1">saveFeedback</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1457.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1458.1">formData</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1459.1">) {</span></strong></span>
    <span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1460.1">'use server'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1461.1">;</span></strong></span>
    <span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1462.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1463.1"> feedback = formData.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1464.1">get</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1465.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1466.1">'feedback'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1467.1">);</span></strong></span>
    <span class="code-highlight"><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.1468.1">console</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1469.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1470.1">log</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1471.1">(feedback);</span></strong></span>
  <span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1472.1">}</span></strong></span>
  <span class="hljs-keyword"><span class="koboSpan" id="kobo.1473.1">return</span></span><span class="koboSpan" id="kobo.1474.1"> (
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1475.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1476.1">form</span></span><span class="hljs-tag"> </span><span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1477.1">action</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1478.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1479.1">{saveFeedback}</span></strong></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1480.1">&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1481.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1482.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1483.1">&gt;</span></span>
<span class="language-xml">        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1484.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1485.1">label</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1486.1">htmlFor</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1487.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1488.1">"feedback"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1489.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.1490.1">Your feedback</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1491.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1492.1">label</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1493.1">&gt;</span></span>
<span class="language-xml">        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1494.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1495.1">textarea</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1496.1">id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1497.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1498.1">"feedback"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1499.1">name</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1500.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1501.1">"feedback"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1502.1">rows</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1503.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1504.1">{3}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1505.1"> /&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1506.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1507.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1508.1">&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1509.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1510.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1511.1">&gt;&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1512.1">button</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1513.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.1514.1">Submit</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1515.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1516.1">button</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1517.1">&gt;&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1518.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1519.1">&gt;</span></span>
<span class="language-xml">    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1520.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1521.1">form</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1522.1">&gt;</span></span><span class="koboSpan" id="kobo.1523.1">
  );
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1524.1">
     As you can see, besides the fact that it must be asynchronous and that it uses the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1525.1">
      'use server'
     </span>
    </code>
    <span class="koboSpan" id="kobo.1526.1">
     directive, this action function looks like the ones you saw in
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1527.1">
      Chapter 9
     </span>
    </em>
    <span class="koboSpan" id="kobo.1528.1">
     .
    </span>
    <span class="koboSpan" id="kobo.1528.2">
     It receives a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1529.1">
      formData
     </span>
    </code>
    <span class="koboSpan" id="kobo.1530.1">
     object that will be provided by React when the form is submitted, and you set the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1531.1">
      action
     </span>
    </code>
    <span class="koboSpan" id="kobo.1532.1">
     function as a value for the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1533.1">
      action
     </span>
    </code>
    <span class="koboSpan" id="kobo.1534.1">
     prop on a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1535.1">
      &lt;form&gt;
     </span>
    </code>
    <span class="koboSpan" id="kobo.1536.1">
     element.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1537.1">
     As mentioned in the previous section, if you were to search for this code in the code files downloaded by the browser, you wouldn’t find it—this code really only runs on the server side.
    </span>
   </p>
   <div class="note">
    <p class="normal">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.1538.1">
       Note
      </span>
     </strong>
    </p>
    <p class="normal">
     <span class="koboSpan" id="kobo.1539.1">
      The
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1540.1">
       UserFeedback
      </span>
     </code>
     <span class="koboSpan" id="kobo.1541.1">
      component from the previous example is an RSC.
     </span>
    </p>
    <p class="normal">
     <span class="koboSpan" id="kobo.1542.1">
      If you think about it, this might be strange, though.
     </span>
     <span class="koboSpan" id="kobo.1542.2">
      After all, this component does handle some user input and interaction.
     </span>
     <span class="koboSpan" id="kobo.1542.3">
      Why does it work without
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1543.1">
       'use client'
      </span>
     </code>
     <span class="koboSpan" id="kobo.1544.1">
      then?
     </span>
    </p>
    <p class="normal">
     <span class="koboSpan" id="kobo.1545.1">
      Because Server Actions (bound to the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1546.1">
       &lt;form&gt;
      </span>
     </code>
     <span class="koboSpan" id="kobo.1547.1">
      's
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1548.1">
       action
      </span>
     </code>
     <span class="koboSpan" id="kobo.1549.1">
      prop) are special.
     </span>
     <span class="koboSpan" id="kobo.1549.2">
      React explicitly supports this pattern inside of RSCs.
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1550.1">
       'use client'
      </span>
     </code>
     <span class="koboSpan" id="kobo.1551.1">
      is indeed required for any other kind of user input handling (e.g., if you rely on the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1552.1">
       onSubmit
      </span>
     </code>
     <span class="koboSpan" id="kobo.1553.1">
      or
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1554.1">
       onChange
      </span>
     </code>
     <span class="koboSpan" id="kobo.1555.1">
      props).
     </span>
     <span class="koboSpan" id="kobo.1555.2">
      But binding Server Actions via the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1556.1">
       action
      </span>
     </code>
     <span class="koboSpan" id="kobo.1557.1">
      prop is supported.
     </span>
    </p>
    <p class="normal">
     <span class="koboSpan" id="kobo.1558.1">
      Furthermore, it’s important to understand that the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.1559.1">
       'use server'
      </span>
     </code>
     <span class="koboSpan" id="kobo.1560.1">
      directive only exists to mark actions as Server Actions.
     </span>
     <span class="koboSpan" id="kobo.1560.2">
      You, for example, can’t use it to mark components as server components.
     </span>
    </p>
   </div>
   <p class="normal">
    <span class="koboSpan" id="kobo.1561.1">
     Of course, the
    </span>
    <a id="_idIndexMarker879">
    </a>
    <span class="koboSpan" id="kobo.1562.1">
     preceding example Server Action currently only logs
    </span>
    <a id="_idIndexMarker880">
    </a>
    <span class="koboSpan" id="kobo.1563.1">
     the input to the console.
    </span>
    <span class="koboSpan" id="kobo.1563.2">
     A more realistic action would probably store that data somewhere and redirect the user to some other page.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-336">
    <span class="koboSpan" id="kobo.1564.1">
     Handling User Input &amp; Updating the UI
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.1565.1">
     Consider
    </span>
    <a id="_idIndexMarker881">
    </a>
    <span class="koboSpan" id="kobo.1566.1">
     this updated
    </span>
    <a id="_idIndexMarker882">
    </a>
    <span class="koboSpan" id="kobo.1567.1">
     version of the previous example:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1568.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1569.1"> { storeFeedback } </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1570.1">from</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1571.1">'../lib/feedback-db'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1572.1">;</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1573.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1574.1">UserFeedback</span></span><span class="koboSpan" id="kobo.1575.1">() {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1576.1">async</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1577.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1578.1">saveFeedback</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1579.1">(formData) {</span></span>
    <span class="hljs-string"><span class="koboSpan" id="kobo.1580.1">'use server'</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1581.1">;</span></span>
    <span class="hljs-keyword"><span class="koboSpan" id="kobo.1582.1">const</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1583.1"> feedback = formData.</span></span><span class="hljs-title"><span class="koboSpan" id="kobo.1584.1">get</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1585.1">(</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1586.1">'feedback'</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1587.1">);</span></span>
    <span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1588.1">storeFeedback</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1589.1">(feedback);</span></strong></span><span class="koboSpan" id="kobo.1590.1">
  }
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1591.1">return</span></span><span class="koboSpan" id="kobo.1592.1"> (
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1593.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1594.1">form</span></span><span class="hljs-tag"> </span><span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1595.1">action</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1596.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1597.1">{saveFeedback}</span></strong></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1598.1">&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1599.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1600.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1601.1">&gt;</span></span>
<span class="language-xml">        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1602.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1603.1">label</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1604.1">htmlFor</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1605.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1606.1">"feedback"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1607.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.1608.1">Your feedback</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1609.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1610.1">label</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1611.1">&gt;</span></span>
<span class="language-xml">        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1612.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1613.1">textarea</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1614.1">id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1615.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1616.1">"feedback"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1617.1">name</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1618.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1619.1">"feedback"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1620.1">rows</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1621.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1622.1">{3}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1623.1"> /&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1624.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1625.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1626.1">&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1627.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1628.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1629.1">&gt;&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1630.1">button</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1631.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.1632.1">Submit</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1633.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1634.1">button</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1635.1">&gt;&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1636.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1637.1">&gt;</span></span>
<span class="language-xml">    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1638.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1639.1">form</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1640.1">&gt;</span></span><span class="koboSpan" id="kobo.1641.1">
  );
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1642.1">
     The
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1643.1">
      saveFeedback()
     </span>
    </code>
    <span class="koboSpan" id="kobo.1644.1">
     Server
    </span>
    <a id="_idIndexMarker883">
    </a>
    <span class="koboSpan" id="kobo.1645.1">
     Action now stores the extracted feedback via the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1646.1">
      storeFeedback()
     </span>
    </code>
    <span class="koboSpan" id="kobo.1647.1">
     function.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1648.1">
     This
    </span>
    <a id="_idIndexMarker884">
    </a>
    <span class="koboSpan" id="kobo.1649.1">
     function is defined like this:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1650.1">import</span></span><span class="koboSpan" id="kobo.1651.1"> fs </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1652.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1653.1">'node:fs/promises'</span></span><span class="koboSpan" id="kobo.1654.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1655.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1656.1">async</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1657.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1658.1">storeFeedback</span></span><span class="koboSpan" id="kobo.1659.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.1660.1">text</span></span><span class="koboSpan" id="kobo.1661.1">) {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1662.1">const</span></span><span class="koboSpan" id="kobo.1663.1"> storedFeedback = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1664.1">await</span></span><span class="koboSpan" id="kobo.1665.1"> fs.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1666.1">readFile</span></span><span class="koboSpan" id="kobo.1667.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1668.1">'data/user-feedback.json'</span></span><span class="koboSpan" id="kobo.1669.1">);
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1670.1">const</span></span><span class="koboSpan" id="kobo.1671.1"> feedback = </span><span class="hljs-title"><span class="koboSpan" id="kobo.1672.1">JSON</span></span><span class="koboSpan" id="kobo.1673.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1674.1">parse</span></span><span class="koboSpan" id="kobo.1675.1">(storedFeedback);
  feedback.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1676.1">push</span></span><span class="koboSpan" id="kobo.1677.1">({ </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1678.1">id</span></span><span class="koboSpan" id="kobo.1679.1">: </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1680.1">new</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1681.1">Date</span></span><span class="koboSpan" id="kobo.1682.1">().</span><span class="hljs-title"><span class="koboSpan" id="kobo.1683.1">getTime</span></span><span class="koboSpan" id="kobo.1684.1">(), text });
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1685.1">await</span></span><span class="koboSpan" id="kobo.1686.1"> fs.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1687.1">writeFile</span></span><span class="koboSpan" id="kobo.1688.1">(
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.1689.1">'data/user-feedback.json'</span></span><span class="koboSpan" id="kobo.1690.1">, 
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1691.1">JSON</span></span><span class="koboSpan" id="kobo.1692.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1693.1">stringify</span></span><span class="koboSpan" id="kobo.1694.1">(feedback)
  );
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1695.1">
     In a real app, data might be stored in a database.
    </span>
    <span class="koboSpan" id="kobo.1695.2">
     Here, in this simple example, it’s simply stored in a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1696.1">
      user-feedback.json
     </span>
    </code>
    <span class="koboSpan" id="kobo.1697.1">
     file that’s part of the overall Next.js project.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1698.1">
     As you can tell, just as you can directly reach out to a file or database from inside an RSC, you are able to directly edit a file or send a database query from inside a Server Action.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1699.1">
     You can also update the UI by programmatically navigating the user to a different page thereafter.
    </span>
    <span class="koboSpan" id="kobo.1699.2">
     In a Next.js application, you can use the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1700.1">
      redirect()
     </span>
    </code>
    <span class="koboSpan" id="kobo.1701.1">
     function provided by Next.js to trigger such a navigation action—for example, right after storing the submitted feedback text:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1702.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1703.1"> { redirect } </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1704.1">from</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1705.1">'next/navigation'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1706.1">;</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1707.1">import</span></span><span class="koboSpan" id="kobo.1708.1"> { storeFeedback } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1709.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1710.1">'../lib/feedback-db'</span></span><span class="koboSpan" id="kobo.1711.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1712.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1713.1">default</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1714.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1715.1">UserFeedback</span></span><span class="koboSpan" id="kobo.1716.1">() {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1717.1">async</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1718.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1719.1">saveFeedback</span></span><span class="koboSpan" id="kobo.1720.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.1721.1">formData</span></span><span class="koboSpan" id="kobo.1722.1">) {
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.1723.1">'use server'</span></span><span class="koboSpan" id="kobo.1724.1">;
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1725.1">const</span></span><span class="koboSpan" id="kobo.1726.1"> feedback = formData.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1727.1">get</span></span><span class="koboSpan" id="kobo.1728.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1729.1">'feedback'</span></span><span class="koboSpan" id="kobo.1730.1">);
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1731.1">await</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1732.1">storeFeedback</span></span><span class="koboSpan" id="kobo.1733.1">(feedback);
    </span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1734.1">redirect</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1735.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1736.1">'/thanks'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1737.1">)</span></strong></span><span class="koboSpan" id="kobo.1738.1">
  }
  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1739.1">// same JSX code as before, hence omitted</span></span><span class="koboSpan" id="kobo.1740.1">
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1741.1">
     This is a very
    </span>
    <a id="_idIndexMarker885">
    </a>
    <span class="koboSpan" id="kobo.1742.1">
     common pattern when building fullstack applications
    </span>
    <a id="_idIndexMarker886">
    </a>
    <span class="koboSpan" id="kobo.1743.1">
     since you often want to navigate your website users to a different page once they have submitted data.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1744.1">
     But you can also use a different pattern and update the UI that contains the form, based on the form submission.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-337">
    <span class="koboSpan" id="kobo.1745.1">
     Server Actions and useActionState()
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.1746.1">
     You might
    </span>
    <a id="_idIndexMarker887">
    </a>
    <span class="koboSpan" id="kobo.1747.1">
     remember the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1748.1">
      useActionState()
     </span>
    </code>
    <span class="koboSpan" id="kobo.1749.1">
     Hook from
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1750.1">
      Chapter 9
     </span>
    </em>
    <span class="koboSpan" id="kobo.1751.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1752.1">
      Handling User Input &amp; Forms with Form Actions
     </span>
    </em>
    <span class="koboSpan" id="kobo.1753.1">
     .
    </span>
    <span class="koboSpan" id="kobo.1753.2">
     This Hook can be used to derive some component state from a (form) action.
    </span>
    <span class="koboSpan" id="kobo.1753.3">
     That state, in turn, can be used to update the UI based
    </span>
    <a id="_idIndexMarker888">
    </a>
    <span class="koboSpan" id="kobo.1754.1">
     on the result of the action.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1755.1">
     Since a Server Action is a special kind of form action, you can use that same Hook to update the UI based on your Server Action and its returned values.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1756.1">
     For example, you could try using
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1757.1">
      useActionState()
     </span>
    </code>
    <span class="koboSpan" id="kobo.1758.1">
     in the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1759.1">
      UserFeedback
     </span>
    </code>
    <span class="koboSpan" id="kobo.1760.1">
     component like this:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1761.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1762.1"> { useActionState } </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1763.1">from</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1764.1">'react'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1765.1">;</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1766.1">import</span></span><span class="koboSpan" id="kobo.1767.1"> { redirect } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1768.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1769.1">'next/navigation'</span></span><span class="koboSpan" id="kobo.1770.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1771.1">import</span></span><span class="koboSpan" id="kobo.1772.1"> { storeFeedback } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1773.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1774.1">'../lib/feedback-db'</span></span><span class="koboSpan" id="kobo.1775.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1776.1">import</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1777.1">FeedbackForm</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1778.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1779.1">'./FeedbackForm'</span></span><span class="koboSpan" id="kobo.1780.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1781.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1782.1">default</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1783.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1784.1">UserFeedback</span></span><span class="koboSpan" id="kobo.1785.1">() {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1786.1">async</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1787.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1788.1">saveFeedback</span></span><span class="koboSpan" id="kobo.1789.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.1790.1">prevState, formData</span></span><span class="koboSpan" id="kobo.1791.1">) {
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.1792.1">'use server'</span></span><span class="koboSpan" id="kobo.1793.1">;
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1794.1">const</span></span><span class="koboSpan" id="kobo.1795.1"> feedback = formData.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1796.1">get</span></span><span class="koboSpan" id="kobo.1797.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1798.1">'feedback'</span></span><span class="koboSpan" id="kobo.1799.1">);
    </span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1800.1">if</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1801.1"> (!feedback || feedback.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1802.1">trim</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1803.1">() === </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1804.1">''</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1805.1">) {</span></strong></span>
      <span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1806.1">return</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1807.1"> { </span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1808.1">error</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1809.1">: </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1810.1">'Please provide some feedback!'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1811.1"> };</span></strong></span>
    <span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1812.1">}</span></strong></span>
    <span class="hljs-keyword"><span class="koboSpan" id="kobo.1813.1">await</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1814.1">storeFeedback</span></span><span class="koboSpan" id="kobo.1815.1">(feedback);
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1816.1">redirect</span></span><span class="koboSpan" id="kobo.1817.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1818.1">'/thanks'</span></span><span class="koboSpan" id="kobo.1819.1">);
  }
  </span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1820.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1821.1"> [formState, formAction] = </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1822.1">useActionState</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1823.1">(saveFeedback, {</span></strong></span>
    <span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1824.1">error</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1825.1">: </span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.1826.1">null</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1827.1">,</span></strong></span>
  <span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1828.1">});</span></strong></span>
  <span class="hljs-keyword"><span class="koboSpan" id="kobo.1829.1">return</span></span><span class="koboSpan" id="kobo.1830.1"> (
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1831.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1832.1">form</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1833.1">action</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1834.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1835.1">{formAction}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1836.1">&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1837.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1838.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1839.1">&gt;</span></span>
<span class="language-xml">        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1840.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1841.1">label</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1842.1">htmlFor</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1843.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1844.1">"feedback"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1845.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.1846.1">Your feedback</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1847.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1848.1">label</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1849.1">&gt;</span></span>
<span class="language-xml">        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1850.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1851.1">textarea</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1852.1">id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1853.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1854.1">"feedback"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1855.1">name</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1856.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1857.1">"feedback"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1858.1">rows</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1859.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1860.1">{3}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1861.1"> /&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1862.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1863.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1864.1">&gt;</span></span>
<span class="language-xml">      </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1865.1">{formState.error &amp;&amp; </span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1866.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1867.1">p</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1868.1">id</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1869.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1870.1">"error"</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1871.1">&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1872.1">{formState.error}</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1873.1">&lt;/</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.1874.1">p</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.1875.1">&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1876.1">}</span></strong></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1877.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1878.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1879.1">&gt;</span></span>
<span class="language-xml">        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1880.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1881.1">button</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1882.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.1883.1">Submit</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1884.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1885.1">button</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1886.1">&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1887.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1888.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1889.1">&gt;</span></span>
<span class="language-xml">    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1890.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1891.1">form</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1892.1">&gt;</span></span><span class="koboSpan" id="kobo.1893.1">
  );
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1894.1">
     However, using
    </span>
    <a id="_idIndexMarker889">
    </a>
    <span class="koboSpan" id="kobo.1895.1">
     this code
    </span>
    <a id="_idIndexMarker890">
    </a>
    <span class="koboSpan" id="kobo.1896.1">
     would cause an error:
    </span>
   </p>
   <figure class="mediaobject">
    <span class="koboSpan" id="kobo.1897.1">
     <img alt="img" src="image/B31339_16_15.png"/>
    </span>
   </figure>
   <p class="packt_figref">
    <span class="koboSpan" id="kobo.1898.1">
     Figure 16.15: React complaints about the usage of a Hook in an RSC
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1899.1">
     It’s an error message you already know from the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1900.1">
      Not All Components Should Be RSCs
     </span>
    </em>
    <span class="koboSpan" id="kobo.1901.1">
     section and
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1902.1">
      Figure 16.8
     </span>
    </em>
    <span class="koboSpan" id="kobo.1903.1">
     .
    </span>
    <span class="koboSpan" id="kobo.1903.2">
     React does not allow the usage of Hooks in RSCs—and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1904.1">
      UserFeedback
     </span>
    </code>
    <span class="koboSpan" id="kobo.1905.1">
     is an RSC.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1906.1">
     The solution, of course, is straightforward: simply add the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1907.1">
      'use client'
     </span>
    </code>
    <span class="koboSpan" id="kobo.1908.1">
     directive at the top of the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1909.1">
      UserFeedback.js
     </span>
    </code>
    <span class="koboSpan" id="kobo.1910.1">
     file:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1911.1">'use client'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1912.1">;</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1913.1">import</span></span><span class="koboSpan" id="kobo.1914.1"> { useActionState } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1915.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1916.1">'react'</span></span><span class="koboSpan" id="kobo.1917.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1918.1">import</span></span><span class="koboSpan" id="kobo.1919.1"> { redirect } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1920.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1921.1">'next/navigation'</span></span><span class="koboSpan" id="kobo.1922.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1923.1">import</span></span><span class="koboSpan" id="kobo.1924.1"> { storeFeedback } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1925.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1926.1">'../lib/feedback-db'</span></span><span class="koboSpan" id="kobo.1927.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1928.1">import</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1929.1">FeedbackForm</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1930.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1931.1">'./FeedbackForm'</span></span><span class="koboSpan" id="kobo.1932.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1933.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1934.1">default</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1935.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1936.1">UserFeedback</span></span><span class="koboSpan" id="kobo.1937.1">() {
  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1938.1">// component code didn't change, hence omitted</span></span><span class="koboSpan" id="kobo.1939.1">
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.1940.1">
     But with
    </span>
    <a id="_idIndexMarker891">
    </a>
    <span class="koboSpan" id="kobo.1941.1">
     this change applied, you’ll encounter another error message:
    </span>
   </p>
   <figure class="mediaobject">
    <span class="koboSpan" id="kobo.1942.1">
     <img alt="img" src="image/B31339_16_16.png"/>
    </span>
   </figure>
   <p class="packt_figref">
    <span class="koboSpan" id="kobo.1943.1">
     Figure 16.16: React now complains about the usage of ‘use server’ and ‘use client’ in the same file
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1944.1">
     This error
    </span>
    <a id="_idIndexMarker892">
    </a>
    <span class="koboSpan" id="kobo.1945.1">
     message occurs because the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1946.1">
      UserFeedback
     </span>
    </code>
    <span class="koboSpan" id="kobo.1947.1">
     component file is currently using both the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1948.1">
      'use client'
     </span>
    </code>
    <span class="koboSpan" id="kobo.1949.1">
     and
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1950.1">
      'use server'
     </span>
    </code>
    <span class="koboSpan" id="kobo.1951.1">
     directives—in different places, but in the same file.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1952.1">
     Put in other words: you can only define a Server Action (and hence use
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1953.1">
      'use server'
     </span>
    </code>
    <span class="koboSpan" id="kobo.1954.1">
     ) inside an RSC—not inside a client component.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1955.1">
     One possible solution for this problem is to move the feedback form and the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1956.1">
      useActionState()
     </span>
    </code>
    <span class="koboSpan" id="kobo.1957.1">
     Hook into a new component that will be used as a child component of
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1958.1">
      UserFeedbackForm
     </span>
    </code>
    <span class="koboSpan" id="kobo.1959.1">
     .
    </span>
    <span class="koboSpan" id="kobo.1959.2">
     The Server Action function can then be passed via props to that newly added component.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.1960.1">
     For example, you can create a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.1961.1">
      FeedbackForm
     </span>
    </code>
    <span class="koboSpan" id="kobo.1962.1">
     component that looks like this:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-string"><span class="koboSpan" id="kobo.1963.1">'use client'</span></span><span class="koboSpan" id="kobo.1964.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1965.1">import</span></span><span class="koboSpan" id="kobo.1966.1"> { useActionState } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1967.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1968.1">'react'</span></span><span class="koboSpan" id="kobo.1969.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1970.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1971.1">default</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1972.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1973.1">FeedbackForm</span></span><span class="koboSpan" id="kobo.1974.1">(</span><span class="code-highlight"><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1975.1">{action}</span></strong></span><span class="koboSpan" id="kobo.1976.1">) {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1977.1">const</span></span><span class="koboSpan" id="kobo.1978.1"> [formState, formAction] = </span><span class="hljs-title"><span class="koboSpan" id="kobo.1979.1">useActionState</span></span><span class="koboSpan" id="kobo.1980.1">(</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1981.1">action</span></strong></span><span class="koboSpan" id="kobo.1982.1">, {
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1983.1">error</span></span><span class="koboSpan" id="kobo.1984.1">: </span><span class="hljs-literal"><span class="koboSpan" id="kobo.1985.1">null</span></span><span class="koboSpan" id="kobo.1986.1">,
  });
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1987.1">return</span></span><span class="koboSpan" id="kobo.1988.1"> (
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1989.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1990.1">form</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1991.1">action</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1992.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1993.1">{formAction}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1994.1">&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1995.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1996.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1997.1">&gt;</span></span>
<span class="language-xml">        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1998.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1999.1">label</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2000.1">htmlFor</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2001.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2002.1">"feedback"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2003.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.2004.1">Your feedback</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2005.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2006.1">label</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2007.1">&gt;</span></span>
<span class="language-xml">        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2008.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2009.1">textarea</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2010.1">id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2011.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2012.1">"feedback"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2013.1">name</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2014.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2015.1">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2016.1">feedback"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2017.1">rows</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2018.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2019.1">{3}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2020.1"> /&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2021.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2022.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2023.1">&gt;</span></span>
<span class="language-xml"><span class="koboSpan" id="kobo.2024.1">      {formState.error &amp;&amp; </span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2025.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2026.1">p</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2027.1">id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2028.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2029.1">"error"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2030.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.2031.1">{formState.error}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2032.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2033.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2034.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.2035.1">}</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2036.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2037.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2038.1">&gt;</span></span>
<span class="language-xml">        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2039.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2040.1">button</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2041.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.2042.1">Submit</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2043.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2044.1">button</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2045.1">&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2046.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2047.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2048.1">&gt;</span></span>
<span class="language-xml">    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2049.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2050.1">form</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2051.1">&gt;</span></span><span class="koboSpan" id="kobo.2052.1">
  );
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.2053.1">
     This
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2054.1">
      FeedbackForm
     </span>
    </code>
    <span class="koboSpan" id="kobo.2055.1">
     component
    </span>
    <a id="_idIndexMarker893">
    </a>
    <span class="koboSpan" id="kobo.2056.1">
     expects an
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2057.1">
      action
     </span>
    </code>
    <span class="koboSpan" id="kobo.2058.1">
     prop, which is then
    </span>
    <a id="_idIndexMarker894">
    </a>
    <span class="koboSpan" id="kobo.2059.1">
     passed as a value to
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2060.1">
      useActionState()
     </span>
    </code>
    <span class="koboSpan" id="kobo.2061.1">
     .
    </span>
    <span class="koboSpan" id="kobo.2061.2">
     Consequently, the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2062.1">
      FeedbackForm
     </span>
    </code>
    <span class="koboSpan" id="kobo.2063.1">
     component can be used in the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2064.1">
      UserFeedback
     </span>
    </code>
    <span class="koboSpan" id="kobo.2065.1">
     component like this:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.2066.1">import</span></span><span class="koboSpan" id="kobo.2067.1"> { redirect } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2068.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2069.1">'next/navigation'</span></span><span class="koboSpan" id="kobo.2070.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2071.1">import</span></span><span class="koboSpan" id="kobo.2072.1"> { storeFeedback } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2073.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2074.1">'../lib/feedback-db'</span></span><span class="koboSpan" id="kobo.2075.1">;
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2076.1">import</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2077.1">FeedbackForm</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2078.1">from</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2079.1">'./FeedbackForm'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2080.1">;</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2081.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2082.1">default</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2083.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2084.1">UserFeedback</span></span><span class="koboSpan" id="kobo.2085.1">() {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2086.1">async</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2087.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2088.1">saveFeedback</span></span><span class="koboSpan" id="kobo.2089.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.2090.1">prevState, formData</span></span><span class="koboSpan" id="kobo.2091.1">) {
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.2092.1">'use server'</span></span><span class="koboSpan" id="kobo.2093.1">;
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2094.1">const</span></span><span class="koboSpan" id="kobo.2095.1"> feedback = formData.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2096.1">get</span></span><span class="koboSpan" id="kobo.2097.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2098.1">'feedback'</span></span><span class="koboSpan" id="kobo.2099.1">);
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2100.1">if</span></span><span class="koboSpan" id="kobo.2101.1"> (!feedback || feedback.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2102.1">trim</span></span><span class="koboSpan" id="kobo.2103.1">() === </span><span class="hljs-string"><span class="koboSpan" id="kobo.2104.1">''</span></span><span class="koboSpan" id="kobo.2105.1">) {
      </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2106.1">return</span></span><span class="koboSpan" id="kobo.2107.1"> { </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2108.1">error</span></span><span class="koboSpan" id="kobo.2109.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.2110.1">'Please provide some feedback!'</span></span><span class="koboSpan" id="kobo.2111.1"> };
    }
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2112.1">await</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2113.1">storeFeedback</span></span><span class="koboSpan" id="kobo.2114.1">(feedback);
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.2115.1">redirect</span></span><span class="koboSpan" id="kobo.2116.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2117.1">'/thanks'</span></span><span class="koboSpan" id="kobo.2118.1">);
  }
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2119.1">return</span></span> <span class="code-highlight"><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2120.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.2121.1">FeedbackForm</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.2122.1">action</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2123.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2124.1">{saveFeedback}</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.2125.1"> /&gt;</span></strong></span><span class="koboSpan" id="kobo.2126.1">;
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.2127.1">
     If you were to run this code, the application would work without any problems.
    </span>
    <span class="koboSpan" id="kobo.2127.2">
     So, again, just as with RSCs, it’s all about coming up with a working component structure.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2128.1">
     This is an absolutely valid way of solving this problem.
    </span>
    <span class="koboSpan" id="kobo.2128.2">
     But if you would rather not split the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2129.1">
      UserFeedback
     </span>
    </code>
    <span class="koboSpan" id="kobo.2130.1">
     component into multiple components and outsource the form into
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2131.1">
      FeedbackForm
     </span>
    </code>
    <span class="koboSpan" id="kobo.2132.1">
     , there is also another possible solution.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-338">
    <span class="koboSpan" id="kobo.2133.1">
     Storing Server Actions in Separate Files
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.2134.1">
     You can define Server Actions directly inside of RSCs.
    </span>
    <span class="koboSpan" id="kobo.2134.2">
     As you learned in the previous chapter, you can also pass them around via props.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2135.1">
     As an alternative, React also permits storing them in separate files.
    </span>
    <span class="koboSpan" id="kobo.2135.2">
     Doing so allows you to build
    </span>
    <a id="_idIndexMarker895">
    </a>
    <span class="koboSpan" id="kobo.2136.1">
     leaner components since the Server Action code is moved out of the component functions.
    </span>
    <span class="koboSpan" id="kobo.2136.2">
     Furthermore, React is fine with importing a Server Action that’s stored in a separate file into a client component file.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2137.1">
     Considering the previous code examples, you could move the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2138.1">
      saveFeedback()
     </span>
    </code>
    <span class="koboSpan" id="kobo.2139.1">
     Server Action into a separate
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2140.1">
      actions/feedback.js
     </span>
    </code>
    <span class="koboSpan" id="kobo.2141.1">
     file in your Next.js project folder—though, the file and folder names are entirely up to you.
    </span>
    <span class="koboSpan" id="kobo.2141.2">
     In that file, you can then also move the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2142.1">
      '
     </span>
    </code>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2143.1">
      use server'
     </span>
    </code>
    <span class="koboSpan" id="kobo.2144.1">
     directive out of the Server Action and put it at the top of the file:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-string"><span class="koboSpan" id="kobo.2145.1">'use server'</span></span><span class="koboSpan" id="kobo.2146.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2147.1">import</span></span><span class="koboSpan" id="kobo.2148.1"> { redirect } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2149.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2150.1">'next/navigation'</span></span><span class="koboSpan" id="kobo.2151.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2152.1">import</span></span><span class="koboSpan" id="kobo.2153.1"> { storeFeedback } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2154.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2155.1">'../lib/feedback-db'</span></span><span class="koboSpan" id="kobo.2156.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2157.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2158.1">async</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2159.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2160.1">saveFeedback</span></span><span class="koboSpan" id="kobo.2161.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.2162.1">prevState, formData</span></span><span class="koboSpan" id="kobo.2163.1">) {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2164.1">const</span></span><span class="koboSpan" id="kobo.2165.1"> feedback = formData.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2166.1">get</span></span><span class="koboSpan" id="kobo.2167.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2168.1">'feedback'</span></span><span class="koboSpan" id="kobo.2169.1">);
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2170.1">if</span></span><span class="koboSpan" id="kobo.2171.1"> (!feedback || feedback.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2172.1">trim</span></span><span class="koboSpan" id="kobo.2173.1">() === </span><span class="hljs-string"><span class="koboSpan" id="kobo.2174.1">''</span></span><span class="koboSpan" id="kobo.2175.1">) {
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2176.1">return</span></span><span class="koboSpan" id="kobo.2177.1"> { </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2178.1">error</span></span><span class="koboSpan" id="kobo.2179.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.2180.1">'Please provide some feedback!'</span></span><span class="koboSpan" id="kobo.2181.1"> };
  }
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2182.1">await</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2183.1">storeFeedback</span></span><span class="koboSpan" id="kobo.2184.1">(feedback);
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.2185.1">redirect</span></span><span class="koboSpan" id="kobo.2186.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.2187.1">'/thanks'</span></span><span class="koboSpan" id="kobo.2188.1">);
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.2189.1">
     Adding the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2190.1">
      'use server'
     </span>
    </code>
    <span class="koboSpan" id="kobo.2191.1">
     directive at the top of the file enables you to create multiple Server Action functions in that same file.
    </span>
    <span class="koboSpan" id="kobo.2191.2">
     You can then export and use them in any other file they might be needed in.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2192.1">
     For example, you can import the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2193.1">
      saveFeedback()
     </span>
    </code>
    <span class="koboSpan" id="kobo.2194.1">
     action into the
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2195.1">
      UserFeedback
     </span>
    </code>
    <span class="koboSpan" id="kobo.2196.1">
     component, which now doesn’t need the separate
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2197.1">
      FeedbackForm
     </span>
    </code>
    <span class="koboSpan" id="kobo.2198.1">
     child component anymore.
    </span>
    <span class="koboSpan" id="kobo.2198.2">
     Since externally stored Server Actions can be imported into client component files without issues, the final
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2199.1">
      UserFeedback.js
     </span>
    </code>
    <span class="koboSpan" id="kobo.2200.1">
     file looks like this:
    </span>
   </p>
   <pre class="programlisting code"><code class="hljs-code"><span class="hljs-string"><span class="koboSpan" id="kobo.2201.1">'use client'</span></span><span class="koboSpan" id="kobo.2202.1">;
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2203.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2204.1"> { saveFeedback } </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2205.1">from</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.2206.1">'../actions/feedback'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2207.1">;</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.2208.1">import</span></span><span class="koboSpan" id="kobo.2209.1"> { useActionState } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2210.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.2211.1">'react'</span></span><span class="koboSpan" id="kobo.2212.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2213.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2214.1">default</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.2215.1">function</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2216.1">UserFeedback</span></span><span class="koboSpan" id="kobo.2217.1">() {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2218.1">const</span></span><span class="koboSpan" id="kobo.2219.1"> [formState, formAction] = </span><span class="hljs-title"><span class="koboSpan" id="kobo.2220.1">useActionState</span></span><span class="koboSpan" id="kobo.2221.1">(</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2222.1">saveFeedback</span></strong></span><span class="koboSpan" id="kobo.2223.1">, {
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2224.1">error</span></span><span class="koboSpan" id="kobo.2225.1">: </span><span class="hljs-literal"><span class="koboSpan" id="kobo.2226.1">null</span></span><span class="koboSpan" id="kobo.2227.1">,
  });
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2228.1">return</span></span><span class="koboSpan" id="kobo.2229.1"> (
    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2230.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2231.1">form</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2232.1">action</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2233.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2234.1">{formAction}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2235.1">&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2236.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2237.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2238.1">&gt;</span></span>
<span class="language-xml">        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2239.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2240.1">label</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2241.1">htmlFor</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2242.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2243.1">"feedback"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2244.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.2245.1">Your feedback</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2246.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2247.1">label</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2248.1">&gt;</span></span>
<span class="language-xml">        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2249.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2250.1">textarea</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2251.1">id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2252.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2253.1">"feedback"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2254.1">name</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2255.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2256.1">"feedback"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2257.1">rows</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2258.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2259.1">{3}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2260.1"> /&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2261.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2262.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2263.1">&gt;</span></span>
<span class="language-xml"><span class="koboSpan" id="kobo.2264.1">      {formState.error &amp;&amp; </span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2265.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2266.1">p</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.2267.1">id</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2268.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.2269.1">"error"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2270.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.2271.1">{formState.error}</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2272.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2273.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2274.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.2275.1">}</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2276.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2277.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2278.1">&gt;</span></span>
<span class="language-xml">        </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2279.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2280.1">button</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2281.1">&gt;</span></span><span class="language-xml"><span class="koboSpan" id="kobo.2282.1">Submit</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2283.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2284.1">button</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2285.1">&gt;</span></span>
<span class="language-xml">      </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2286.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2287.1">p</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2288.1">&gt;</span></span>
<span class="language-xml">    </span><span class="hljs-tag"><span class="koboSpan" id="kobo.2289.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.2290.1">form</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.2291.1">&gt;</span></span><span class="koboSpan" id="kobo.2292.1">
  );
}
</span></code></pre>
   <p class="normal">
    <span class="koboSpan" id="kobo.2293.1">
     Therefore, storing
    </span>
    <a id="_idIndexMarker896">
    </a>
    <span class="koboSpan" id="kobo.2294.1">
     Server Actions in separate files does not just lead to leaner components, but can also help prevent unnecessary component refactoring.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2295.1">
     Though, no matter which approach you choose, you can use Server Actions to handle form submissions on the server.
    </span>
    <span class="koboSpan" id="kobo.2295.2">
     Together with RSCs, you can therefore build fullstack applications that seamlessly blend client-side and server-side code.
    </span>
   </p>
   <h1 class="heading-1" id="_idParaDest-339">
    <span class="koboSpan" id="kobo.2296.1">
     Summary and Key Takeaways
    </span>
   </h1>
   <ul>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.2297.1">
      React supports two special server-side functionalities: RSCs and Server Actions.
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.2298.1">
      Both features are not available in React projects unless the project is specifically configured to support them—typically, you’ll therefore need to use a framework that supports these features (e.g., Next.js).
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.2299.1">
      RSCs are components that are never rendered on the client side—instead, they may be rendered on the server (initiated via HTTP requests) or during the build process.
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.2300.1">
      RSCs return rendering instructions that are picked up by client-side React.
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.2301.1">
      Since RSCs never run on the client side, you may use server-exclusive APIs and features in them.
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.2302.1">
      React also permits RSCs to return
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.2303.1">
       Promise
      </span>
     </code>
     <span class="koboSpan" id="kobo.2304.1">
      values, hence you can use
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.2305.1">
       async/await
      </span>
     </code>
     <span class="koboSpan" id="kobo.2306.1">
      and fetch data asynchronously without issues in RSCs.
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.2307.1">
      In order to build interactive websites where the UI may change after being rendered, you can also mark components as client components by using the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.2308.1">
       'use client'
      </span>
     </code>
     <span class="koboSpan" id="kobo.2309.1">
      directive.
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.2310.1">
      Only client components can use Hooks like
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.2311.1">
       useState()
      </span>
     </code>
     <span class="koboSpan" id="kobo.2312.1">
      or set up event listeners.
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.2313.1">
      Client components are also pre-rendered on the server, but unlike RSCs, they may also execute on the client side.
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.2314.1">
      You may import and use client components inside of RSCs.
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.2315.1">
      When importing server components into client components, the server components automatically become client components, if possible.
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.2316.1">
      If an RSC can’t be converted into a client component (e.g., because it uses
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.2317.1">
       async/await
      </span>
     </code>
     <span class="koboSpan" id="kobo.2318.1">
      ), you’ll need to restructure the component tree.
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.2319.1">
      You may pass server components to client components (without converting them) via props.
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.2320.1">
      React helps with handling form submissions on the server via Server Actions.
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.2321.1">
      Server Actions work like client actions (see
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.2322.1">
       Chapter 9
      </span>
     </em>
     <span class="koboSpan" id="kobo.2323.1">
      ) but must be asynchronous (
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.2324.1">
       async/await
      </span>
     </code>
     <span class="koboSpan" id="kobo.2325.1">
      ) and use the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.2326.1">
       'use server'
      </span>
     </code>
     <span class="koboSpan" id="kobo.2327.1">
      directive.
     </span>
    </li>
    <li class="bulletList">
     <span class="koboSpan" id="kobo.2328.1">
      You can define Server Actions inside of RSCs or in separate files—in the latter scenario, you can move the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.2329.1">
       'use server'
      </span>
     </code>
     <span class="koboSpan" id="kobo.2330.1">
      directive to the top of the file to define multiple Server Actions in the same file.
     </span>
    </li>
   </ul>
   <h2 class="heading-2" id="_idParaDest-340">
    <span class="koboSpan" id="kobo.2331.1">
     What’s Next?
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.2332.1">
     In this chapter, you learned about RSCs and Server Actions.
    </span>
    <span class="koboSpan" id="kobo.2332.2">
     You learned that creating and using them is relatively straightforward, but that supporting them in projects is not—hence frameworks like Next.js are commonly used to take advantage of these features.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2333.1">
     This chapter gave you an idea of how RSCs and Server Actions work behind the scenes, and which advantages are offered by these features.
    </span>
    <span class="koboSpan" id="kobo.2333.2">
     Throughout this chapter, you also learned about client components and how to combine server and client components.
    </span>
    <span class="koboSpan" id="kobo.2333.3">
     Finally, Server Actions were discussed and different ways of defining and using Server Actions were shown.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2334.1">
     The next chapter will build up on this chapter and explore how React’s
    </span>
    <strong class="keyWord">
     <span class="koboSpan" id="kobo.2335.1">
      Suspense
     </span>
    </strong>
    <span class="koboSpan" id="kobo.2336.1">
     functionality may help with showing fallback content while fetched data is being streamed in.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-341">
    <span class="koboSpan" id="kobo.2337.1">
     Test Your Knowledge!
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.2338.1">
     Test your knowledge of the concepts covered in this chapter by answering the following questions.
    </span>
    <span class="koboSpan" id="kobo.2338.2">
     You can then compare your answers to examples that can be found at
    </span>
    <a href="https://github.com/mschwarzmueller/book-react-key-concepts-e2/blob/16-rsc-server-actions/exercises/questions-answers.md">
     <span class="url">
      <span class="koboSpan" id="kobo.2339.1">
       https://github.com/mschwarzmueller/book-react-key-concepts-e2/blob/16-rsc-server-actions/exercises/questions-answers.md
      </span>
     </span>
    </a>
    <span class="koboSpan" id="kobo.2340.1">
     :
    </span>
   </p>
   <ol>
    <li class="numberedList" value="1">
     <span class="koboSpan" id="kobo.2341.1">
      What is the defining characteristic of React Server Components?
     </span>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.2342.1">
      What are the problems that React Server Components solve?
     </span>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.2343.1">
      How are React Server Components created and used in Next.js projects?
     </span>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.2344.1">
      Why can’t React Server Components and Server Actions be used in all React projects?
     </span>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.2345.1">
      What is the key difference between Server-Side Rendering (SSR) and React Server Components (RSCs)?
     </span>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.2346.1">
      What is the purpose of the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.2347.1">
       'use client'
      </span>
     </code>
     <span class="koboSpan" id="kobo.2348.1">
      directive?
     </span>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.2349.1">
      How does the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.2350.1">
       'use client'
      </span>
     </code>
     <span class="koboSpan" id="kobo.2351.1">
      directive affect child components?
     </span>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.2352.1">
      What are the rules for combining server components and client components?
     </span>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.2353.1">
      How can you handle loading states in Next.js while fetching data with RSCs?
     </span>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.2354.1">
      What are Server Actions in React, and how do they differ from client actions?
     </span>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.2355.1">
      How can you trigger a Server Action?
     </span>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.2356.1">
      How can you update the UI after a Server Action?
     </span>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.2357.1">
      Can you define Server Actions in separate files?
     </span>
    </li>
   </ol>
   <h1 class="heading-1" id="_idParaDest-342">
    <span class="koboSpan" id="kobo.2358.1">
     Apply What You Learned
    </span>
   </h1>
   <p class="normal">
    <span class="koboSpan" id="kobo.2359.1">
     With all the newly gained knowledge about Next.js, it’s time to apply it to a real demo project—a demo application that will be rendered on the server.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2360.1">
     In the following section, you’ll find an activity that allows you to practice working with Next.js.
    </span>
    <span class="koboSpan" id="kobo.2360.2">
     As always, you will also need to employ some of the concepts covered in earlier chapters.
    </span>
   </p>
   <h2 class="heading-2" id="_idParaDest-343">
    <span class="koboSpan" id="kobo.2361.1">
     Activity 16.1: Build a Mini Blog
    </span>
   </h2>
   <p class="normal">
    <span class="koboSpan" id="kobo.2362.1">
     In this activity, your job is to build a very simple blog website (with Next.js) that allows users to create and view blog posts.
    </span>
    <span class="koboSpan" id="kobo.2362.2">
     Each blog post should consist of a title, date, and body text.
    </span>
    <span class="koboSpan" id="kobo.2362.3">
     A list of blog post titles and dates should be rendered on the starting page (
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2363.1">
      /
     </span>
    </code>
    <span class="koboSpan" id="kobo.2364.1">
     ); upon clicking on a post, users should be taken to the details page (
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2365.1">
      /blog/&lt;some-id&gt;
     </span>
    </code>
    <span class="koboSpan" id="kobo.2366.1">
     ), which shows the complete blog post data.
    </span>
    <span class="koboSpan" id="kobo.2366.2">
     A
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2367.1">
      /blog/new
     </span>
    </code>
    <span class="koboSpan" id="kobo.2368.1">
     page should display a form that can be used to create a new post.
    </span>
   </p>
   <p class="normal">
    <span class="koboSpan" id="kobo.2369.1">
     Posts should be stored in a
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2370.1">
      posts.json
     </span>
    </code>
    <span class="koboSpan" id="kobo.2371.1">
     file (which may simply store an array of post objects).
    </span>
    <span class="koboSpan" id="kobo.2371.2">
     After creating a new post, users should be redirected to that post’s detail page.
    </span>
    <span class="koboSpan" id="kobo.2371.3">
     If users leave either the title or the body field (or both) empty, an error message should be displayed below the form.
    </span>
   </p>
   <div class="note">
    <p class="normal">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.2372.1">
       Note
      </span>
     </strong>
    </p>
    <p class="normal">
     <span class="koboSpan" id="kobo.2373.1">
      You can find a starting project snapshot for this activity at
     </span>
     <a href="https://github.com/mschwarzmueller/book-react-key-concepts-e2/tree/16-rsc-server-actions/activities/practice-1-start">
      <span class="url">
       <span class="koboSpan" id="kobo.2374.1">
        https://github.com/mschwarzmueller/book-react-key-concepts-e2/tree/16-rsc-server-actions/activities/practice-1-start
       </span>
      </span>
     </a>
     <span class="koboSpan" id="kobo.2375.1">
      .
     </span>
     <span class="koboSpan" id="kobo.2375.2">
      When downloading this code, you’ll always download the entire repository.
     </span>
     <span class="koboSpan" id="kobo.2375.3">
      Make sure to then navigate to the subfolder with the starting code (
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.2376.1">
       activities/practice-1-start
      </span>
     </code>
     <span class="koboSpan" id="kobo.2377.1">
      , in this case) to use the right code snapshot.
     </span>
    </p>
    <p class="normal">
     <span class="koboSpan" id="kobo.2378.1">
      In the provided starting project, you can explore the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.2379.1">
       globals.css
      </span>
     </code>
     <span class="koboSpan" id="kobo.2380.1">
      file to get an idea of the elements and element structure you might want to use to take advantage of the provided styles.
     </span>
     <span class="koboSpan" id="kobo.2380.2">
      Of course, you can also set up and use your own styles.
     </span>
    </p>
   </div>
   <p class="normal">
    <span class="koboSpan" id="kobo.2381.1">
     After downloading the code and running
    </span>
    <code class="inlineCode">
     <span class="koboSpan" id="kobo.2382.1">
      npm install
     </span>
    </code>
    <span class="koboSpan" id="kobo.2383.1">
     in the project folder to install all required dependencies, the solution steps are as follows:
    </span>
   </p>
   <ol>
    <li class="numberedList" value="1">
     <span class="koboSpan" id="kobo.2384.1">
      Add three new
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.2385.1">
       page.js
      </span>
     </code>
     <span class="koboSpan" id="kobo.2386.1">
      files (and an appropriate folder structure) for the three pages:
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.2387.1">
       /
      </span>
     </code>
     <span class="koboSpan" id="kobo.2388.1">
      ,
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.2389.1">
       /blog/new
      </span>
     </code>
     <span class="koboSpan" id="kobo.2390.1">
      , and
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.2391.1">
       /blog/&lt;some-id&gt;
      </span>
     </code>
     <span class="koboSpan" id="kobo.2392.1">
      .
     </span>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.2393.1">
      Add a new
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.2394.1">
       posts.json
      </span>
     </code>
     <span class="koboSpan" id="kobo.2395.1">
      file in a
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.2396.1">
       data/
      </span>
     </code>
     <span class="koboSpan" id="kobo.2397.1">
      folder in the root project folder.
     </span>
     <span class="koboSpan" id="kobo.2397.2">
      This file should initially store an empty array.
     </span>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.2398.1">
      Output a
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.2399.1">
       &lt;form&gt;
      </span>
     </code>
     <span class="koboSpan" id="kobo.2400.1">
      with title and body input fields on the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.2401.1">
       /blog/new
      </span>
     </code>
     <span class="koboSpan" id="kobo.2402.1">
      page.
     </span>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.2403.1">
      Create a new Server Action in a separate file and import and “connect” it to
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.2404.1">
       &lt;form&gt;
      </span>
     </code>
     <span class="koboSpan" id="kobo.2405.1">
      .
     </span>
     <span class="koboSpan" id="kobo.2405.2">
      The Server Action should retrieve the entered title and body text, create a new object, which also includes an ID and creation date snapshot, and store that data in the
     </span>
     <code class="inlineCode">
      <span class="koboSpan" id="kobo.2406.1">
       posts.json
      </span>
     </code>
     <span class="koboSpan" id="kobo.2407.1">
      file.
     </span>
     <span class="koboSpan" id="kobo.2407.2">
      Data must be stored such that existing blog posts aren’t lost.
     </span>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.2408.1">
      Update the Server Action to implement input validation and output the validation results above the submit button.
     </span>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.2409.1">
      Fetch the blog posts on the starting page and output a list of blog posts (title and date).
     </span>
     <span class="koboSpan" id="kobo.2409.2">
      Each post should be clickable and take the user to the details page.
     </span>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.2410.1">
      On the details page, fetch and output the blog post details (by using the ID).
     </span>
    </li>
    <li class="numberedList">
     <span class="koboSpan" id="kobo.2411.1">
      Finally, redirect the user to the appropriate details page from inside the Server Action, after a blog post is created.
     </span>
    </li>
   </ol>
   <p class="normal">
    <span class="koboSpan" id="kobo.2412.1">
     The final page should look as shown in the following screenshots:
    </span>
   </p>
   <figure class="mediaobject">
    <span class="koboSpan" id="kobo.2413.1">
     <img alt="img" src="image/B31339_16_17.png"/>
    </span>
   </figure>
   <p class="packt_figref">
    <span class="koboSpan" id="kobo.2414.1">
     Figure 16.17: The home page, showing a list of blog posts
    </span>
   </p>
   <figure class="mediaobject">
    <span class="koboSpan" id="kobo.2415.1">
     <img alt="img" src="image/B31339_16_18.png"/>
    </span>
   </figure>
   <p class="packt_figref">
    <span class="koboSpan" id="kobo.2416.1">
     Figure 16.18: The /blog/new page, waiting for user input
    </span>
   </p>
   <figure class="mediaobject">
    <span class="koboSpan" id="kobo.2417.1">
     <img alt="img" src="image/B31339_16_19.png"/>
    </span>
   </figure>
   <p class="packt_figref">
    <span class="koboSpan" id="kobo.2418.1">
     Figure 16.19: The /blog/&lt;some-id&gt; page displaying blog post details
    </span>
   </p>
   <div class="note">
    <p class="normal">
     <strong class="keyWord">
      <span class="koboSpan" id="kobo.2419.1">
       Note
      </span>
     </strong>
    </p>
    <p class="normal">
     <span class="koboSpan" id="kobo.2420.1">
      You can find the full code for this activity, and an example solution, here:
     </span>
     <a href="https://github.com/mschwarzmueller/book-react-key-concepts-e2/tree/16-rsc-server-actions/activities/practice-1">
      <span class="url">
       <span class="koboSpan" id="kobo.2421.1">
        https://github.com/mschwarzmueller/book-react-key-concepts-e2/tree/16-rsc-server-actions/activities/practice-1
       </span>
      </span>
     </a>
     <span class="koboSpan" id="kobo.2422.1">
      .
     </span>
    </p>
   </div>
  </div>
 </body></html>