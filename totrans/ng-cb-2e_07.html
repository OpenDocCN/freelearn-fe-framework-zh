<html><head></head><body>
<div class="Basic-Text-Frame" id="_idContainer137">
<h1 class="chapterNumber"><span class="koboSpan" id="kobo.1.1">7</span></h1>
<h1 class="chapterTitle" id="_idParaDest-227"><span class="koboSpan" id="kobo.2.1">Understanding Angular Navigation and Routing</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.3.1">One of the most amazing things about Angular is that it is an entire ecosystem (a framework) rather than a library. </span><span class="koboSpan" id="kobo.3.2">In this ecosystem, the Angular router is one of the most critical blocks to learn about and understand. </span><span class="koboSpan" id="kobo.3.3">In this chapter, you’ll learn some really cool techniques for routing and navigation in Angular. </span><span class="koboSpan" id="kobo.3.4">You’ll learn about how to guard your routes, listen to route changes, and configure global actions on route changes.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.4.1">The following are the recipes we’re going to cover in this chapter:</span></p>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.5.1">Creating routes in an Angular (standalone) app</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.6.1">Lazily loaded routes in Angular</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.7.1">Preloading route strategies</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.8.1">Authorized access to routes using route guards</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.9.1">Working with route parameters</span></li>
<li class="bulletList"><span class="koboSpan" id="kobo.10.1">Showing a global loader between route changes</span></li>
</ul>
<h1 class="heading-1" id="_idParaDest-228"><span class="koboSpan" id="kobo.11.1">Technical requirements</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.12.1">For the recipes in this chapter, ensure your setup is complete as per the 'Technical Requirements' in the 'Angular-Cookbook-2E' GitHub repository. </span><span class="koboSpan" id="kobo.12.2">For setup details, visit: </span><a href="https://github.com/PacktPublishing/Angular-Cookbook-2E/tree/main/docs/technical-requirements.md"><span class="url"><span class="koboSpan" id="kobo.13.1">https://github.com/PacktPublishing/Angular-Cookbook-2E/tree/main/docs/technical-requirements.md</span></span></a><span class="koboSpan" id="kobo.14.1">. </span><span class="koboSpan" id="kobo.14.2">The starter code for this chapter is located at </span><a href="https://github.com/PacktPublishing/Angular-Cookbook-2E/tree/main/start/apps/chapter07"><span class="url"><span class="koboSpan" id="kobo.15.1">https://github.com/PacktPublishing/Angular-Cookbook-2E/tree/main/start/apps/chapter07</span></span></a><span class="koboSpan" id="kobo.16.1">.</span></p>
<h1 class="heading-1" id="_idParaDest-229"><span class="koboSpan" id="kobo.17.1">Creating routes in an Angular (standalone) app</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.18.1">If you ask me about how we used to create</span><a id="_idIndexMarker442"/><span class="koboSpan" id="kobo.19.1"> projects for web applications 7–8 years </span><a id="_idIndexMarker443"/><span class="koboSpan" id="kobo.20.1">ago, you’ll be astonished to learn how difficult it was. </span><span class="koboSpan" id="kobo.20.2">Luckily, the tools and standards have evolved in the software development industry and, when it comes to Angular, starting a project is super easy. </span><span class="koboSpan" id="kobo.20.3">With the Angular standalone apps, the configuration is much smaller for the application’s bootstrap process and for routing. </span><span class="koboSpan" id="kobo.20.4">In this recipe, you’re going to implement some routes in a fresh Angular application.</span></p>
<h2 class="heading-2" id="_idParaDest-230"><span class="koboSpan" id="kobo.21.1">Getting ready</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.22.1">The app that we are going to work with resides in </span><code class="inlineCode"><span class="koboSpan" id="kobo.23.1">start/apps/chapter07/ng-basic-routing</span></code><span class="koboSpan" id="kobo.24.1"> inside the cloned repository:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.25.1">Open the code repository in your code editor.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.26.1">Open the terminal, navigate to the code repository directory, and run the following command to serve the project:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.27.1">npm run serve ng-basic-routing
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.28.1">This should open the app in a new browser tab. </span><span class="koboSpan" id="kobo.28.2">You should see the following:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.29.1"><img alt="" role="presentation" src="../Images/B18469_07_01.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.30.1">Figure 7.1: ng-basic-routes app running on http://localhost:4200</span></p> </li>
</ol>
<h2 class="heading-2" id="_idParaDest-231"><span class="koboSpan" id="kobo.31.1">How to do it…</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.32.1">We’ll configure routing in the app, add some routes, and add the links to those routes in the headers. </span><span class="koboSpan" id="kobo.32.2">Let’s get started:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.33.1">First, create a file named </span><code class="inlineCode"><span class="koboSpan" id="kobo.34.1">app.routes.ts</span></code><span class="koboSpan" id="kobo.35.1"> inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.36.1">app</span></code><span class="koboSpan" id="kobo.37.1"> folder and add the following code to it:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.38.1">import</span></span><span class="koboSpan" id="kobo.39.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.40.1">Route</span></span><span class="koboSpan" id="kobo.41.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.42.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.43.1">'@angular/router'</span></span><span class="koboSpan" id="kobo.44.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.45.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.46.1">const</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.47.1">appRoutes</span></span><span class="koboSpan" id="kobo.48.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.49.1">Route</span></span><span class="koboSpan" id="kobo.50.1">[] = [];
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.51.1">Now update the file </span><code class="inlineCode"><span class="koboSpan" id="kobo.52.1">app.config.ts</span></code><span class="koboSpan" id="kobo.53.1"> in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.54.1">src</span></code><span class="koboSpan" id="kobo.55.1"> folder with the following changes:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.56.1">import</span></span><span class="koboSpan" id="kobo.57.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.58.1">ApplicationConfig</span></span><span class="koboSpan" id="kobo.59.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.60.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.61.1">'@angular/core'</span></span><span class="koboSpan" id="kobo.62.1">;
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.63.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.64.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.65.1">provideRouter,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.66.1">withEnabledBlockingInitialNavigation,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.67.1">} </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.68.1">from</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.69.1">'@angular/router'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.70.1">;</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.71.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.72.1"> { appRoutes } </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.73.1">from</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.74.1">'./app.routes'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.75.1">;</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.76.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.77.1">const</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.78.1">appConfig</span></span><span class="koboSpan" id="kobo.79.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.80.1">ApplicationConfig</span></span><span class="koboSpan" id="kobo.81.1"> = {
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.82.1">providers</span></span><span class="koboSpan" id="kobo.83.1">: [</span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.84.1">provideRouter</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.85.1">(appRoutes,</span></strong></span> <span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.86.1">withEnabledBlockingInitialNavigation</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.87.1">())</span></strong></span><span class="koboSpan" id="kobo.88.1">],
};
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.89.1">Now let’s create some</span><a id="_idIndexMarker444"/><span class="koboSpan" id="kobo.90.1"> components (as pages). </span><span class="koboSpan" id="kobo.90.2">We’re going </span><a id="_idIndexMarker445"/><span class="koboSpan" id="kobo.91.1">to create a home page and an </span><code class="inlineCode"><span class="koboSpan" id="kobo.92.1">about</span></code><span class="koboSpan" id="kobo.93.1"> page. </span><span class="koboSpan" id="kobo.93.2">Running the following </span><code class="inlineCode"><span class="koboSpan" id="kobo.94.1">npx</span></code><span class="koboSpan" id="kobo.95.1"> command in the terminal from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.96.1">start</span></code><span class="koboSpan" id="kobo.97.1"> folder in the workspace. </span><span class="koboSpan" id="kobo.97.2">If asked, you can use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.98.1">@nx/angular:component</span></code><span class="koboSpan" id="kobo.99.1"> schematics and choose the “As provided” action:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.100.1">nx g c home --directory apps/chapter07/ng-basic-routing/src/app/home --standalone
nx g c about --directory apps/chapter07/ng-basic-routing/src/app/about --standalone
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.101.1">You should see two new folders created in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.102.1">app</span></code><span class="koboSpan" id="kobo.103.1"> folder of the project now.</span></p></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="4"><span class="koboSpan" id="kobo.104.1">We will configure the routes now. </span><span class="koboSpan" id="kobo.104.2">Update the </span><code class="inlineCode"><span class="koboSpan" id="kobo.105.1">app.routes.ts</span></code><span class="koboSpan" id="kobo.106.1"> file that we created in </span><em class="italic"><span class="koboSpan" id="kobo.107.1">step 1</span></em><span class="koboSpan" id="kobo.108.1"> as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.109.1">import</span></span><span class="koboSpan" id="kobo.110.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.111.1">Route</span></span><span class="koboSpan" id="kobo.112.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.113.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.114.1">'@angular/router'</span></span><span class="koboSpan" id="kobo.115.1">;
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.116.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.117.1"> { </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.118.1">AboutComponent</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.119.1"> } </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.120.1">from</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.121.1">'./about/about.component'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.122.1">;</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.123.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.124.1"> { </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.125.1">HomeComponent</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.126.1"> } </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.127.1">from</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.128.1">'./home/home.component'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.129.1">;</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.130.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.131.1">const</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.132.1">appRoutes</span></span><span class="koboSpan" id="kobo.133.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.134.1">Route</span></span><span class="koboSpan" id="kobo.135.1">[] = [</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.136.1">{</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.137.1">path</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.138.1">: </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.139.1">''</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.140.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.141.1">pathMatch</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.142.1">: </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.143.1">'full'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.144.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.145.1">redirectTo</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.146.1">: </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.147.1">'home'</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.148.1">}, {</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.149.1">path</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.150.1">: </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.151.1">'home'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.152.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.153.1">component</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.154.1">: </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.155.1">HomeComponent</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.156.1">}, {</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.157.1">path</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.158.1">: </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.159.1">'about'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.160.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.161.1">component</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.162.1">: </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.163.1">AboutComponent</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.164.1">}</span></strong></span><span class="koboSpan" id="kobo.165.1">
];
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.166.1">All that remains is to hook</span><a id="_idIndexMarker446"/><span class="koboSpan" id="kobo.167.1"> the routes in the view using </span><code class="inlineCode"><span class="koboSpan" id="kobo.168.1">&lt;router-outlet&gt;</span></code><span class="koboSpan" id="kobo.169.1"> in the</span><a id="_idIndexMarker447"/><span class="koboSpan" id="kobo.170.1"> template. </span><span class="koboSpan" id="kobo.170.2">Update the </span><code class="inlineCode"><span class="koboSpan" id="kobo.171.1">app.component.html</span></code><span class="koboSpan" id="kobo.172.1"> file as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.173.1">&lt;!-- Toolbar --&gt;</span></span><span class="koboSpan" id="kobo.174.1">
...
</span><span class="hljs-tag"><span class="koboSpan" id="kobo.175.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.176.1">main</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.177.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.178.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.179.1">"content"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.180.1">role</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.181.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.182.1">"main"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.183.1">&gt;</span></span>
<span class="code-highlight"><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.184.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.185.1">router-outlet</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.186.1">&gt;&lt;/</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.187.1">router-outlet</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.188.1">&gt;</span></strong></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.189.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.190.1">main</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.191.1">&gt;</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.192.1">But wait! </span><span class="koboSpan" id="kobo.192.2">That crashes the app. </span><span class="koboSpan" id="kobo.192.3">That’s because the </span><code class="inlineCode"><span class="koboSpan" id="kobo.193.1">AppComponent</span></code><span class="koboSpan" id="kobo.194.1"> doesn’t understand routing yet.</span></p> </li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="6"><span class="koboSpan" id="kobo.195.1">Update the </span><code class="inlineCode"><span class="koboSpan" id="kobo.196.1">app.component.ts</span></code><span class="koboSpan" id="kobo.197.1"> file to add the </span><code class="inlineCode"><span class="koboSpan" id="kobo.198.1">RouterModule</span></code><span class="koboSpan" id="kobo.199.1"> in it as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.200.1">...
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.201.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.202.1"> { </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.203.1">RouterModule</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.204.1"> } </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.205.1">from</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.206.1">'@angular/router'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.207.1">;</span></strong></span>
<span class="hljs-meta"><span class="koboSpan" id="kobo.208.1">@Component</span></span><span class="koboSpan" id="kobo.209.1">({
  ...,
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.210.1">imports</span></span><span class="koboSpan" id="kobo.211.1">: [</span><span class="hljs-title"><span class="koboSpan" id="kobo.212.1">CommonModule</span></span><span class="koboSpan" id="kobo.213.1">, </span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.214.1">RouterModule</span></strong></span><span class="koboSpan" id="kobo.215.1">],
})
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.216.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.217.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.218.1">AppComponent</span></span><span class="koboSpan" id="kobo.219.1"> {}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.220.1">And voilà ! </span><span class="koboSpan" id="kobo.220.2">You should be able to see the </span><code class="inlineCode"><span class="koboSpan" id="kobo.221.1">home</span></code><span class="koboSpan" id="kobo.222.1"> component now, as follows:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.223.1"><img alt="" role="presentation" src="../Images/B18469_07_02.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.224.1">Figure 7.2: The home component in the ng-basic-routes app</span></p>
<p class="normal"><span class="koboSpan" id="kobo.225.1">If you look at the URL, it defaults to </span><code class="inlineCode"><span class="koboSpan" id="kobo.226.1">http://localhost:4200/home</span></code><span class="koboSpan" id="kobo.227.1"> even if you try to go to </span><code class="inlineCode"><span class="koboSpan" id="kobo.228.1">https://localhost:4200</span></code><span class="koboSpan" id="kobo.229.1">.</span></p> </li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="7"><span class="koboSpan" id="kobo.230.1">Finally, we’ll add the links</span><a id="_idIndexMarker448"/><span class="koboSpan" id="kobo.231.1"> for the routes in the</span><a id="_idIndexMarker449"/><span class="koboSpan" id="kobo.232.1"> header. </span><span class="koboSpan" id="kobo.232.2">Update </span><code class="inlineCode"><span class="koboSpan" id="kobo.233.1">app.component.html</span></code><span class="koboSpan" id="kobo.234.1"> as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.235.1">&lt;!-- Toolbar --&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.236.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.237.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.238.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.239.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.240.1">"toolbar"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.241.1">role</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.242.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.243.1">"banner"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.244.1">&gt;</span></span><span class="koboSpan" id="kobo.245.1">
  ...
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.246.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.247.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.248.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.249.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.250.1">"spacer"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.251.1">&gt;&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.252.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.253.1">&gt;</span></span>
<span class="code-highlight"><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.254.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.255.1">div</span></strong><strong class="hljs-tag-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.256.1">class</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.257.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.258.1">"route-links"</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.259.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.260.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.261.1">div</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.262.1">class</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.263.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.264.1">"route-links__route-link"</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.265.1">routerLink</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.266.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.267.1">"/home"</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.268.1">routerLinkActive</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.269.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.270.1">"route-links__route-link--active"</span></strong></span>
<span class="code-highlight"><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.271.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.272.1">Home</span></strong></span>
<span class="code-highlight"><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.273.1">&lt;/</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.274.1">div</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.275.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.276.1">&lt;</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.277.1">div</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.278.1">class</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.279.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.280.1">"route-links__route-link"</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.281.1">routerLink</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.282.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.283.1">"/about"</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.284.1">routerLinkActive</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.285.1">=</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.286.1">"route-links__route-link--active"</span></strong></span>
<span class="code-highlight"><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.287.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.288.1">About</span></strong></span>
<span class="code-highlight"><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.289.1">&lt;/</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.290.1">div</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.291.1">&gt;</span></strong></span>
<span class="code-highlight"><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.292.1">&lt;/</span></strong><strong class="hljs-name-slc"><span class="koboSpan" id="kobo.293.1">div</span></strong><strong class="hljs-tag-slc"><span class="koboSpan" id="kobo.294.1">&gt;</span></strong></span><span class="koboSpan" id="kobo.295.1">
  ...
</span><span class="hljs-tag"><span class="koboSpan" id="kobo.296.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.297.1">main</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.298.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.299.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.300.1">"content"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.301.1">role</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.302.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.303.1">"main"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.304.1">&gt;</span></span><span class="koboSpan" id="kobo.305.1">...</span><span class="hljs-tag"><span class="koboSpan" id="kobo.306.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.307.1">main</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.308.1">&gt;</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.309.1">Now, if you click the </span><strong class="screenText"><span class="koboSpan" id="kobo.310.1">About</span></strong><span class="koboSpan" id="kobo.311.1"> link at the top, you should be able to see the </span><code class="inlineCode"><span class="koboSpan" id="kobo.312.1">about</span></code><span class="koboSpan" id="kobo.313.1"> route, as follows:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.314.1"><img alt="" role="presentation" src="../Images/B18469_07_03.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.315.1">Figure 7.3: The about component in the ng-basic-routes app</span></p></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.316.1">Awesome! </span><span class="koboSpan" id="kobo.316.2">Within a few minutes, and with the help of Angular router and NX CLI, we were able to create a home page and an </span><code class="inlineCode"><span class="koboSpan" id="kobo.317.1">about</span></code><span class="koboSpan" id="kobo.318.1"> page, and we configured routing as well. </span><span class="koboSpan" id="kobo.318.2">The wonders of the modern web!</span></p>
<p class="normal"><span class="koboSpan" id="kobo.319.1">Now that you know how basic routing</span><a id="_idIndexMarker450"/><span class="koboSpan" id="kobo.320.1"> is implemented, the next section will help</span><a id="_idIndexMarker451"/><span class="koboSpan" id="kobo.321.1"> you to understand how it works.</span></p>
<h2 class="heading-2" id="_idParaDest-232"><span class="koboSpan" id="kobo.322.1">How it works…</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.323.1">When we create an Angular app without the </span><code class="inlineCode"><span class="koboSpan" id="kobo.324.1">--routing</span></code><span class="koboSpan" id="kobo.325.1"> flag, we don’t get the </span><code class="inlineCode"><span class="koboSpan" id="kobo.326.1">app.routes.ts</span></code><span class="koboSpan" id="kobo.327.1"> file or have the configuration added in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.328.1">main.ts</span></code><span class="koboSpan" id="kobo.329.1"> file. </span><span class="koboSpan" id="kobo.329.2">For this example, we worked with an app that already had this flag set. </span><span class="koboSpan" id="kobo.329.3">If you were to start a new project, you might as well just use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.330.1">--routing</span></code><span class="koboSpan" id="kobo.331.1"> flag while creating the app to have routing set up in the app from the start. </span><span class="koboSpan" id="kobo.331.2">Then we created some standalone components using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.332.1">nx g c &lt;component name&gt; –standalone</span></code><span class="koboSpan" id="kobo.333.1"> command. </span><span class="koboSpan" id="kobo.333.2">If you were using the Angular CLI instead of an NX monorepo, you would just replace </span><code class="inlineCode"><span class="koboSpan" id="kobo.334.1">nx</span></code><span class="koboSpan" id="kobo.335.1"> with </span><code class="inlineCode"><span class="koboSpan" id="kobo.336.1">ng</span></code><span class="koboSpan" id="kobo.337.1"> in the preceding command, and the rest would be the same. </span><span class="koboSpan" id="kobo.337.2">Using </span><code class="inlineCode"><span class="koboSpan" id="kobo.338.1">npx</span></code><span class="koboSpan" id="kobo.339.1"> allows us to use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.340.1">nx</span></code><span class="koboSpan" id="kobo.341.1"> package without globally installing it in our system. </span><span class="koboSpan" id="kobo.341.2">Since we have a standalone app, i.e., the </span><code class="inlineCode"><span class="koboSpan" id="kobo.342.1">AppComponent</span></code><span class="koboSpan" id="kobo.343.1"> is a standalone component (notice the </span><code class="inlineCode"><span class="koboSpan" id="kobo.344.1">standalone: true</span></code><span class="koboSpan" id="kobo.345.1"> in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.346.1">app.component.ts</span></code><span class="koboSpan" id="kobo.347.1"> file), we had to import the </span><code class="inlineCode"><span class="koboSpan" id="kobo.348.1">RouterModule</span></code><span class="koboSpan" id="kobo.349.1"> to it to be able to use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.350.1">&lt;router-outlet&gt;</span></code><span class="koboSpan" id="kobo.351.1"> and the </span><code class="inlineCode"><span class="koboSpan" id="kobo.352.1">routeLink</span></code><span class="koboSpan" id="kobo.353.1"> attribute on the links. </span><span class="koboSpan" id="kobo.353.2">We configured the routes by using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.354.1">provideRouter</span></code><span class="koboSpan" id="kobo.355.1"> function in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.356.1">main.ts</span></code><span class="koboSpan" id="kobo.357.1"> file with the routes since we don’t have an </span><code class="inlineCode"><span class="koboSpan" id="kobo.358.1">AppModule</span></code><span class="koboSpan" id="kobo.359.1"> (because the app is a standalone app).</span></p>
<h2 class="heading-2" id="_idParaDest-233"><span class="koboSpan" id="kobo.360.1">See also</span></h2>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.361.1">Angular router</span><a id="_idIndexMarker452"/><span class="koboSpan" id="kobo.362.1"> docs: </span><a href="https://angular.io/guide/router"><span class="url"><span class="koboSpan" id="kobo.363.1">https://angular.io/guide/router</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.364.1">Angular standalone</span><a id="_idIndexMarker453"/><span class="koboSpan" id="kobo.365.1"> components: </span><a href="https://angular.io/guide/standalone-components"><span class="url"><span class="koboSpan" id="kobo.366.1">https://angular.io/guide/standalone-components</span></span></a></li>
</ul>
<h1 class="heading-1" id="_idParaDest-234"><span class="koboSpan" id="kobo.367.1">Lazily loaded routes in Angular</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.368.1">In the previous recipe, we learned</span><a id="_idIndexMarker454"/><span class="koboSpan" id="kobo.369.1"> how to create a basic routing app with eagerly loaded </span><a id="_idIndexMarker455"/><span class="koboSpan" id="kobo.370.1">routes. </span><span class="koboSpan" id="kobo.370.2">In this recipe, you’ll learn how to work with feature modules to lazily load them instead of loading them when the app loads. </span><span class="koboSpan" id="kobo.370.3">For this recipe, we’ll assume that we already have the routes in place, and we just need to load them lazily.</span></p>
<h2 class="heading-2" id="_idParaDest-235"><span class="koboSpan" id="kobo.371.1">Getting ready</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.372.1">The app that we are going to work with resides in </span><code class="inlineCode"><span class="koboSpan" id="kobo.373.1">start/apps/chapter07/ng-lazy-routing</span></code><span class="koboSpan" id="kobo.374.1"> inside the cloned repository:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.375.1">Open the code repository in your code editor.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.376.1">Open the terminal, navigate to the code repository directory, and run the following command to serve the project:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.377.1">npm run serve ng-lazy-routing
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.378.1">This should open the app in a new browser tab. </span><span class="koboSpan" id="kobo.378.2">If you open the </span><strong class="screenText"><span class="koboSpan" id="kobo.379.1">Network</span></strong><span class="koboSpan" id="kobo.380.1"> tab, you should see the following:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.381.1"><img alt="" role="presentation" src="../Images/B18469_07_04.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.382.1">Figure 7.4: ng-lazy-routing app running on http://localhost:4200</span></p></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.383.1">Now that we have the app running locally, let’s see the steps of the recipe in the next section.</span></p>
<h2 class="heading-2" id="_idParaDest-236"><span class="koboSpan" id="kobo.384.1">How to do it…</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.385.1">As shown in </span><em class="italic"><span class="koboSpan" id="kobo.386.1">Figure 7.4</span></em><span class="koboSpan" id="kobo.387.1">, we have all the components</span><a id="_idIndexMarker456"/><span class="koboSpan" id="kobo.388.1"> and modules inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.389.1">main.js</span></code><span class="koboSpan" id="kobo.390.1"> file. </span><span class="koboSpan" id="kobo.390.2">Therefore, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.391.1">main.js</span></code><span class="koboSpan" id="kobo.392.1"> file is about 11.9 KB in size (this could change depending on how Angular</span><a id="_idIndexMarker457"/><span class="koboSpan" id="kobo.393.1"> further optimizes the framework). </span><span class="koboSpan" id="kobo.393.2">We’ll modify the code and the routing structure to achieve lazy loading. </span><span class="koboSpan" id="kobo.393.3">As a result, the files of the routes will load when we navigate to them. </span><span class="koboSpan" id="kobo.393.4">Before the </span><em class="italic"><span class="koboSpan" id="kobo.394.1">standalone components</span></em><span class="koboSpan" id="kobo.395.1"> era, this step was difficult. </span><span class="koboSpan" id="kobo.395.2">And even today, if you work with Angular applications using </span><code class="inlineCode"><span class="koboSpan" id="kobo.396.1">NgModules</span></code><span class="koboSpan" id="kobo.397.1">, you will find that it takes a lot more code to set up your routing. </span><span class="koboSpan" id="kobo.397.2">But since our application has only standalone components, see how easy it becomes to change it:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.398.1">Update the </span><code class="inlineCode"><span class="koboSpan" id="kobo.399.1">app.routes.ts</span></code><span class="koboSpan" id="kobo.400.1"> to use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.401.1">loadComponent</span></code><span class="koboSpan" id="kobo.402.1"> method instead of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.403.1">component</span></code><span class="koboSpan" id="kobo.404.1"> property in the routes, as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.405.1">import</span></span><span class="koboSpan" id="kobo.406.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.407.1">Route</span></span><span class="koboSpan" id="kobo.408.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.409.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.410.1">'@angular/router'</span></span><span class="koboSpan" id="kobo.411.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.412.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.413.1">const</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.414.1">appRoutes</span></span><span class="koboSpan" id="kobo.415.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.416.1">Route</span></span><span class="koboSpan" id="kobo.417.1">[] = [{
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.418.1">path</span></span><span class="koboSpan" id="kobo.419.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.420.1">''</span></span><span class="koboSpan" id="kobo.421.1">,
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.422.1">pathMatch</span></span><span class="koboSpan" id="kobo.423.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.424.1">'full'</span></span><span class="koboSpan" id="kobo.425.1">,
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.426.1">redirectTo</span></span><span class="koboSpan" id="kobo.427.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.428.1">'home'</span></span><span class="koboSpan" id="kobo.429.1">
}</span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.430.1">, {</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.431.1">path</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.432.1">: </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.433.1">'home'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.434.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.435.1">loadComponent</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.436.1">: </span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.437.1">() =&gt;</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.438.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.439.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.440.1">'./home/home.component'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.441.1">).</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.442.1">then</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.443.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.444.1">m</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.445.1"> =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.446.1"> m.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.447.1">HomeComponent</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.448.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.449.1">}, {</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.450.1">path</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.451.1">: </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.452.1">'about'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.453.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.454.1">loadComponent</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.455.1">: </span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.456.1">() =&gt;</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.457.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.458.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.459.1">'./about/about.component'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.460.1">).</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.461.1">then</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.462.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.463.1">m</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.464.1"> =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.465.1"> m.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.466.1">AboutComponent</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.467.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.468.1">}</span></strong></span><span class="koboSpan" id="kobo.469.1">];
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.470.1">Refresh the app and you’ll see that the bundle size for the </span><code class="inlineCode"><span class="koboSpan" id="kobo.471.1">main.js</span></code><span class="koboSpan" id="kobo.472.1"> file is down to 8.3 KB, which was about 11.9 KB before. </span><span class="koboSpan" id="kobo.472.2">See the following screenshot:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.473.1"><img alt="" role="presentation" src="../Images/B18469_07_05.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.474.1">Figure 7.5: Reduced size of main.js on app load</span></p>
<p class="normal"><span class="koboSpan" id="kobo.475.1">But what about the </span><code class="inlineCode"><span class="koboSpan" id="kobo.476.1">Home</span></code><span class="koboSpan" id="kobo.477.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.478.1">About</span></code><code class="inlineCode"><a id="_idIndexMarker458"/></code><span class="koboSpan" id="kobo.479.1"> routes? </span><span class="koboSpan" id="kobo.479.2">And what about lazy loading? </span><span class="koboSpan" id="kobo.479.3">Well, tap the </span><strong class="screenText"><span class="koboSpan" id="kobo.480.1">About</span></strong><span class="koboSpan" id="kobo.481.1"> route </span><a id="_idIndexMarker459"/><span class="koboSpan" id="kobo.482.1">from the header and you’ll see a new JavaScript file being downloaded in the </span><strong class="screenText"><span class="koboSpan" id="kobo.483.1">Network</span></strong><span class="koboSpan" id="kobo.484.1"> tab specifically for the route. </span><span class="koboSpan" id="kobo.484.2">That’s lazy loading in action! </span><span class="koboSpan" id="kobo.484.3">See the following screenshot:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.485.1"><img alt="" role="presentation" src="../Images/B18469_07_06.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.486.1">Figure 7.6: about route being lazily loaded</span></p></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.487.1">Awesomesauce! </span><span class="koboSpan" id="kobo.487.2">You just became lazy! </span><span class="koboSpan" id="kobo.487.3">Just kidding. </span><span class="koboSpan" id="kobo.487.4">You just learned the art of lazily loading routes and feature components in your Angular app. </span><span class="koboSpan" id="kobo.487.5">You can now show this off to your friends as well.</span></p>
<h2 class="heading-2" id="_idParaDest-237"><span class="koboSpan" id="kobo.488.1">How it works…</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.489.1">Angular works with modules and components and, usually, the features are broken down into either </span><code class="inlineCode"><span class="koboSpan" id="kobo.490.1">NgModules</span></code><span class="koboSpan" id="kobo.491.1">, or with standalone components, the components themselves are lazily loaded. </span><span class="koboSpan" id="kobo.491.2">We’re going to look into the standalone components perspective. </span><span class="koboSpan" id="kobo.491.3">As we know, </span><code class="inlineCode"><span class="koboSpan" id="kobo.492.1">AppComponent</span></code><span class="koboSpan" id="kobo.493.1"> serves as the entry point for the standalone Angular app and Angular will import and bundle anything that is imported in </span><code class="inlineCode"><span class="koboSpan" id="kobo.494.1">AppComponent</span></code><span class="koboSpan" id="kobo.495.1"> during the build process, resulting in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.496.1">main.js</span></code><span class="koboSpan" id="kobo.497.1"> file. </span><span class="koboSpan" id="kobo.497.2">However, if we want to lazily load our routes/feature components, we need to avoid importing feature components in </span><code class="inlineCode"><span class="koboSpan" id="kobo.498.1">AppComponent</span></code><span class="koboSpan" id="kobo.499.1"> directly or even importing them in the routes. </span><span class="koboSpan" id="kobo.499.2">Instead, we can use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.500.1">loadChildren</span></code><span class="koboSpan" id="kobo.501.1"> method for lazily loading other modules, or the </span><code class="inlineCode"><span class="koboSpan" id="kobo.502.1">loadComponent</span></code><span class="koboSpan" id="kobo.503.1"> method to lazily load other standalone</span><a id="_idIndexMarker460"/><span class="koboSpan" id="kobo.504.1"> components. </span><span class="koboSpan" id="kobo.504.2">That’s what we did in this recipe. </span><span class="koboSpan" id="kobo.504.3">It is important to note that</span><a id="_idIndexMarker461"/><span class="koboSpan" id="kobo.505.1"> the routes stayed the same in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.506.1">app.routes.ts</span></code><span class="koboSpan" id="kobo.507.1"> file.</span></p>
<h2 class="heading-2" id="_idParaDest-238"><span class="koboSpan" id="kobo.508.1">See also</span></h2>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.509.1">Lazily loading modules</span><a id="_idIndexMarker462"/><span class="koboSpan" id="kobo.510.1"> in Angular: </span><a href="https://angular.io/guide/lazy-loading-ngmodules"><span class="url"><span class="koboSpan" id="kobo.511.1">https://angular.io/guide/lazy-loading-ngmodules</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.512.1">Lazily loading standalone</span><a id="_idIndexMarker463"/><span class="koboSpan" id="kobo.513.1"> components: </span><a href="https://angular.io/guide/standalone-components#routing-and-lazy-loading"><span class="url"><span class="koboSpan" id="kobo.514.1">https://angular.io/guide/standalone-components#routing-and-lazy-loading</span></span></a></li>
</ul>
<h1 class="heading-1" id="_idParaDest-239"><span class="koboSpan" id="kobo.515.1">Preloading route strategies</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.516.1">We’re already familiar</span><a id="_idIndexMarker464"/><span class="koboSpan" id="kobo.517.1"> with how to lazily load different feature modules during navigation. </span><span class="koboSpan" id="kobo.517.2">Sometimes, though, you might want to preload subsequent routes to make the next route navigation instantaneous or might even want to use a custom preloading strategy based on your application’s business logic. </span><span class="koboSpan" id="kobo.517.3">In this recipe, you’ll learn about the </span><code class="inlineCode"><span class="koboSpan" id="kobo.518.1">PreloadAllModules</span></code><span class="koboSpan" id="kobo.519.1"> strategy and also implement a custom strategy to cherry-pick which modules should be preloaded.</span></p>
<h2 class="heading-2" id="_idParaDest-240"><span class="koboSpan" id="kobo.520.1">Getting ready</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.521.1">The app that we are going to work with resides in </span><code class="inlineCode"><span class="koboSpan" id="kobo.522.1">start/apps/chapter07/ng-route-preload-strat</span></code><span class="koboSpan" id="kobo.523.1"> inside the cloned repository:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.524.1">Open the code repository in your code editor.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.525.1">Open the terminal, navigate to the code repository directory, and run the following command to serve the project:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.526.1">npm run serve ng-route-preload-strat
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.527.1">This should open</span><a id="_idIndexMarker465"/><span class="koboSpan" id="kobo.528.1"> the app in a new browser tab. </span><span class="koboSpan" id="kobo.528.2">If you log in as an admin, you should see the following:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.529.1"><img alt="" role="presentation" src="../Images/B18469_07_07.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.530.1">Figure 7.7: The ng-route-preload-strat app running on http://localhost:4200</span></p></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="3"><span class="koboSpan" id="kobo.531.1">Open Chrome DevTools by pressing </span><em class="keystroke"><span class="koboSpan" id="kobo.532.1">Ctrl</span></em><span class="koboSpan" id="kobo.533.1"> + </span><em class="keystroke"><span class="koboSpan" id="kobo.534.1">Shift</span></em><span class="koboSpan" id="kobo.535.1"> + </span><em class="keystroke"><span class="koboSpan" id="kobo.536.1">C</span></em><span class="koboSpan" id="kobo.537.1"> on Windows or </span><em class="keystroke"><span class="koboSpan" id="kobo.538.1">Cmd</span></em><span class="koboSpan" id="kobo.539.1"> + </span><em class="keystroke"><span class="koboSpan" id="kobo.540.1">Shift</span></em><span class="koboSpan" id="kobo.541.1"> + </span><em class="keystroke"><span class="koboSpan" id="kobo.542.1">C</span></em><span class="koboSpan" id="kobo.543.1"> on Mac.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.544.1">Navigate to the </span><strong class="screenText"><span class="koboSpan" id="kobo.545.1">Network</span></strong><span class="koboSpan" id="kobo.546.1"> tab and filter on JavaScript files only. </span><span class="koboSpan" id="kobo.546.2">You should see something like this:
    </span><figure class="mediaobject"><span class="koboSpan" id="kobo.547.1"><img alt="" role="presentation" src="../Images/B18469_07_08.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.548.1">Figure 7.8: JavaScript files loaded on app load</span></p></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.549.1">Now that we have the app running locally, let’s see the next section for this recipe.</span></p>
<h2 class="heading-2" id="_idParaDest-241"><span class="koboSpan" id="kobo.550.1">How to do it…</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.551.1">Notice in </span><em class="italic"><span class="koboSpan" id="kobo.552.1">Figure 7.8</span></em><span class="koboSpan" id="kobo.553.1"> the first network</span><a id="_idIndexMarker466"/><span class="koboSpan" id="kobo.554.1"> call. </span><span class="koboSpan" id="kobo.554.2">It is the JavaScript bundle that contains the </span><code class="inlineCode"><span class="koboSpan" id="kobo.555.1">admin</span></code><span class="koboSpan" id="kobo.556.1"> component and the </span><code class="inlineCode"><span class="koboSpan" id="kobo.557.1">bucket</span></code><span class="koboSpan" id="kobo.558.1"> component. </span><span class="koboSpan" id="kobo.558.2">Although the routes in </span><code class="inlineCode"><span class="koboSpan" id="kobo.559.1">app-routes.t</span></code><span class="koboSpan" id="kobo.560.1">s are all configured to be lazily loaded, we can still look into what happens if we use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.561.1">PreloadAllModules</span></code><span class="koboSpan" id="kobo.562.1"> strategy and then a custom preload strategy:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.563.1">We’re going to try out the </span><code class="inlineCode"><span class="koboSpan" id="kobo.564.1">PreloadAllModules</span></code><span class="koboSpan" id="kobo.565.1"> strategy first. </span><span class="koboSpan" id="kobo.565.2">To use it, let’s modify the </span><code class="inlineCode"><span class="koboSpan" id="kobo.566.1">app/app.config.ts</span></code><span class="koboSpan" id="kobo.567.1"> file as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.568.1">import</span></span><span class="koboSpan" id="kobo.569.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.570.1">ApplicationConfig</span></span><span class="koboSpan" id="kobo.571.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.572.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.573.1">'@angular/core'</span></span><span class="koboSpan" id="kobo.574.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.575.1">import</span></span><span class="koboSpan" id="kobo.576.1"> {
  </span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.577.1">PreloadAllModules</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.578.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.579.1">provideRouter</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.580.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.581.1">withEnabledBlockingInitialNavigation</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.582.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.583.1">withPreloading</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.584.1">,</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.585.1">}</span></strong></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.586.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.587.1">'@angular/router'</span></span><span class="koboSpan" id="kobo.588.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.589.1">import</span></span><span class="koboSpan" id="kobo.590.1"> { appRoutes } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.591.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.592.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.593.1">./app.routes'</span></span><span class="koboSpan" id="kobo.594.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.595.1">import</span></span><span class="koboSpan" id="kobo.596.1"> { provideAnimations } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.597.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.598.1">'@angular/platform-browser/animations'</span></span><span class="koboSpan" id="kobo.599.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.600.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.601.1">const</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.602.1">appConfig</span></span><span class="koboSpan" id="kobo.603.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.604.1">ApplicationConfig</span></span><span class="koboSpan" id="kobo.605.1"> = {
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.606.1">providers</span></span><span class="koboSpan" id="kobo.607.1">: [
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.608.1">provideRouter</span></span><span class="koboSpan" id="kobo.609.1">(
      appRoutes,
      </span><span class="hljs-title"><span class="koboSpan" id="kobo.610.1">withEnabledBlockingInitialNavigation</span></span><span class="koboSpan" id="kobo.611.1">(),
      </span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.612.1">withPreloading</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.613.1">(</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.614.1">PreloadAllModules</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.615.1">)</span></strong></span><span class="koboSpan" id="kobo.616.1">
    ),
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.617.1">provideAnimations</span></span><span class="koboSpan" id="kobo.618.1">(),
  ],
};
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.619.1">If you refresh the app, you should see all the JavaScript bundles being downloaded for all components, as follows:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.620.1"><img alt="" role="presentation" src="../Images/B18469_07_09.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.621.1">Figure 7.9: All components being loaded eagerly using PreloadAllModules strategy</span></p>
<p class="normal"><span class="koboSpan" id="kobo.622.1">This already provides huge performance</span><a id="_idIndexMarker467"/><span class="koboSpan" id="kobo.623.1"> benefits because the minimal </span><code class="inlineCode"><span class="koboSpan" id="kobo.624.1">app</span></code> <code class="inlineCode"><span class="koboSpan" id="kobo.625.1">shell</span></code><span class="koboSpan" id="kobo.626.1"> is loaded first, and then all the other bundles are preloaded in parallel. </span><span class="koboSpan" id="kobo.626.2">This means that whenever the user navigates to a page now, they will not have to download the route’s bundle and navigate right away (i.e., navigation will be faster). </span><span class="koboSpan" id="kobo.626.3">But what if we wanted to preload only the </span><code class="inlineCode"><span class="koboSpan" id="kobo.627.1">admin</span></code><span class="koboSpan" id="kobo.628.1"> module, supposing our app is intended for admins mostly? </span><span class="koboSpan" id="kobo.628.2">We’ll create a custom preload strategy for that.</span></p></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="2"><span class="koboSpan" id="kobo.629.1">Let’s create a service named </span><code class="inlineCode"><span class="koboSpan" id="kobo.630.1">CustomPreloadStrategy</span></code><span class="koboSpan" id="kobo.631.1"> by running the following command from within the </span><code class="inlineCode"><span class="koboSpan" id="kobo.632.1">start</span></code><span class="koboSpan" id="kobo.633.1"> folder:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.634.1">nx g service app-preload-strategy --project ng-route-preload-strat
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.635.1">In order to use our preload strategy service with Angular, our service needs to implement the </span><code class="inlineCode"><span class="koboSpan" id="kobo.636.1">PreloadingStrategy</span></code><span class="koboSpan" id="kobo.637.1"> interface from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.638.1">@angular/router</span></code><span class="koboSpan" id="kobo.639.1"> package. </span><span class="koboSpan" id="kobo.639.2">Modify the newly created service as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.640.1">import</span></span><span class="koboSpan" id="kobo.641.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.642.1">Injectable</span></span><span class="koboSpan" id="kobo.643.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.644.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.645.1">'@angular/core'</span></span><span class="koboSpan" id="kobo.646.1">;
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.647.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.648.1"> { </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.649.1">PreloadingStrategy</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.650.1"> } </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.651.1">from</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.652.1">'@angular/router'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.653.1">;</span></strong></span>
<span class="hljs-meta"><span class="koboSpan" id="kobo.654.1">@Injectable</span></span><span class="koboSpan" id="kobo.655.1">({
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.656.1">providedIn</span></span><span class="koboSpan" id="kobo.657.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.658.1">'root'</span></span><span class="koboSpan" id="kobo.659.1">
})
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.660.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.661.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.662.1">CustomPreloadStrategyService</span></span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.663.1">implements</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.664.1">PreloadingStrategy</span></strong></span><span class="koboSpan" id="kobo.665.1"> {
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.666.1">Next, we need to implement the </span><code class="inlineCode"><span class="koboSpan" id="kobo.667.1">preload</span></code><span class="koboSpan" id="kobo.668.1"> method from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.669.1">PreloadingStrategy</span></code><span class="koboSpan" id="kobo.670.1"> interface for our service to work properly. </span><span class="koboSpan" id="kobo.670.2">Let’s modify </span><code class="inlineCode"><span class="koboSpan" id="kobo.671.1">CustomPreloadStrategyService</span></code><span class="koboSpan" id="kobo.672.1"> to implement the </span><code class="inlineCode"><span class="koboSpan" id="kobo.673.1">preload</span></code><span class="koboSpan" id="kobo.674.1"> method, as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.675.1">import</span></span><span class="koboSpan" id="kobo.676.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.677.1">Injectable</span></span><span class="koboSpan" id="kobo.678.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.679.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.680.1">'@angular/core'</span></span><span class="koboSpan" id="kobo.681.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.682.1">import</span></span><span class="koboSpan" id="kobo.683.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.684.1">PreloadingStrategy</span></span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.685.1">, </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.686.1">Route</span></strong></span><span class="koboSpan" id="kobo.687.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.688.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.689.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.690.1">@angular/router'</span></span><span class="koboSpan" id="kobo.691.1">;
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.692.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.693.1"> { </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.694.1">Observable</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.695.1">, </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.696.1">of</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.697.1"> } </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.698.1">from</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.699.1">'rxjs'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.700.1">;</span></strong></span>
<span class="hljs-meta"><span class="koboSpan" id="kobo.701.1">@Injectable</span></span><span class="koboSpan" id="kobo.702.1">({...})
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.703.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.704.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.705.1">CustomPreloadStrategyService</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.706.1">implements</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.707.1">PreloadingStrategy</span></span><span class="koboSpan" id="kobo.708.1"> {
  </span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.709.1">preload</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.710.1">(</span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.711.1">route</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.712.1">: </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.713.1">Route</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.714.1">, </span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.715.1">load</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.716.1">: </span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.717.1">() =&gt;</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.718.1">Observable</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.719.1">&lt;</span></strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.720.1">any</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.721.1">&gt;):</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.722.1">Observable</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.723.1">&lt;</span></strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.724.1">any</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.725.1">&gt; {</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.726.1">return</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.727.1">of</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.728.1">(</span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.729.1">null</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.730.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.731.1">}</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.732.1">logAndLoad</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.733.1">(</span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.734.1">route</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.735.1">: </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.736.1">Route</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.737.1">, </span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.738.1">load</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.739.1">: () =&gt; </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.740.1">Observable</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.741.1">&lt;</span></strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.742.1">any</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.743.1">&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.744.1">) {</span></strong></span>
<span class="code-highlight"><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.745.1">console</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.746.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.747.1">log</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.748.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.749.1">`Preloading route: </span></strong><strong class="hljs-subst-slc"><span class="koboSpan" id="kobo.750.1">${route.path}</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.751.1">`</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.752.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.753.1">return</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.754.1">load</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.755.1">();</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.756.1">}</span></strong></span><span class="koboSpan" id="kobo.757.1">
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.758.1">Right now, our </span><code class="inlineCode"><span class="koboSpan" id="kobo.759.1">preload</span></code><span class="koboSpan" id="kobo.760.1"> method returns </span><code class="inlineCode"><span class="koboSpan" id="kobo.761.1">of(null)</span></code><span class="koboSpan" id="kobo.762.1">. </span><span class="koboSpan" id="kobo.762.2">Instead, in order to decide which routes to preload, we’re going</span><a id="_idIndexMarker468"/><span class="koboSpan" id="kobo.763.1"> to add an object to our route definitions as the </span><code class="inlineCode"><span class="koboSpan" id="kobo.764.1">data</span></code><span class="koboSpan" id="kobo.765.1"> object that has a Boolean value for </span><code class="inlineCode"><span class="koboSpan" id="kobo.766.1">admin</span></code><span class="koboSpan" id="kobo.767.1"> routes and </span><code class="inlineCode"><span class="koboSpan" id="kobo.768.1">employee</span></code><span class="koboSpan" id="kobo.769.1"> routes to preload. </span><span class="koboSpan" id="kobo.769.2">Let’s modify the </span><code class="inlineCode"><span class="koboSpan" id="kobo.770.1">app-routes.ts</span></code><span class="koboSpan" id="kobo.771.1"> as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.772.1">...
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.773.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.774.1">const</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.775.1">appRoutes</span></span><span class="koboSpan" id="kobo.776.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.777.1">Route</span></span><span class="koboSpan" id="kobo.778.1">[] = [
  { </span><span class="hljs-attr"><span class="koboSpan" id="kobo.779.1">path</span></span><span class="koboSpan" id="kobo.780.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.781.1">''</span></span><span class="koboSpan" id="kobo.782.1">, ...},
  { </span><span class="hljs-attr"><span class="koboSpan" id="kobo.783.1">path</span></span><span class="koboSpan" id="kobo.784.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.785.1">'auth'</span></span><span class="koboSpan" id="kobo.786.1">, ...},
  { </span><span class="hljs-attr"><span class="koboSpan" id="kobo.787.1">path</span></span><span class="koboSpan" id="kobo.788.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.789.1">'admin'</span></span><span class="koboSpan" id="kobo.790.1">, ..., </span><span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.791.1">data</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.792.1">: { </span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.793.1">loadForAdmin</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.794.1">: </span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.795.1">true</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.796.1"> } </span></strong></span><span class="koboSpan" id="kobo.797.1">},
  {
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.798.1">path</span></span><span class="koboSpan" id="kobo.799.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.800.1">'admin-campaign'</span></span><span class="koboSpan" id="kobo.801.1">,
    ...,
    </span><span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.802.1">data</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.803.1">: { </span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.804.1">loadForAdmin</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.805.1">: </span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.806.1">true</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.807.1"> }</span></strong></span><span class="koboSpan" id="kobo.808.1">
  },
  {
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.809.1">path</span></span><span class="koboSpan" id="kobo.810.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.811.1">'employee'</span></span><span class="koboSpan" id="kobo.812.1">,
    ...,
   </span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.813.1">data</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.814.1">: { </span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.815.1">loadForEmployee</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.816.1">: </span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.817.1">true</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.818.1"> },</span></strong></span><span class="koboSpan" id="kobo.819.1">
  },
  {
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.820.1">path</span></span><span class="koboSpan" id="kobo.821.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.822.1">'employee-campaign'</span></span><span class="koboSpan" id="kobo.823.1">,
    ...,
    </span><span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.824.1">data</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.825.1">: { </span></strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.826.1">loadForEmployee</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.827.1">: </span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.828.1">true</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.829.1"> },</span></strong></span><span class="koboSpan" id="kobo.830.1">
  },
];
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.831.1">Now let’s add the logic to our </span><code class="inlineCode"><span class="koboSpan" id="kobo.832.1">preload</span></code><span class="koboSpan" id="kobo.833.1"> method in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.834.1">AppPreloadStrategyService</span></code><span class="koboSpan" id="kobo.835.1"> class to work with the properties added in </span><em class="italic"><span class="koboSpan" id="kobo.836.1">step 5</span></em><span class="koboSpan" id="kobo.837.1">. </span><span class="koboSpan" id="kobo.837.2">We’re going to first inject</span><a id="_idIndexMarker469"/><span class="koboSpan" id="kobo.838.1"> the </span><code class="inlineCode"><span class="koboSpan" id="kobo.839.1">AuthService</span></code><span class="koboSpan" id="kobo.840.1"> and will create some variables inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.841.1">preload</span></code><span class="koboSpan" id="kobo.842.1"> method. </span><span class="koboSpan" id="kobo.842.2">Update the </span><code class="inlineCode"><span class="koboSpan" id="kobo.843.1">app-preload-strategy.service.ts</span></code><span class="koboSpan" id="kobo.844.1"> file as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.845.1">...
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.846.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.847.1"> { </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.848.1">AuthService</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.849.1"> } </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.850.1">from</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.851.1">'./auth/auth.service'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.852.1">;</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.853.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.854.1"> { </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.855.1">UserType</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.856.1"> } </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.857.1">from</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.858.1">'./constants/user-type'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.859.1">;</span></strong></span><span class="koboSpan" id="kobo.860.1">
...
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.861.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.862.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.863.1">AppPreloadStrategyService</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.864.1">implements</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.865.1">PreloadingStrategy</span></span><span class="koboSpan" id="kobo.866.1"> {
  </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.867.1">auth = </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.868.1">inject</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.869.1">(</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.870.1">AuthService</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.871.1">);</span></strong></span>
<span class="hljs-title"><span class="koboSpan" id="kobo.872.1">preload</span></span><span class="koboSpan" id="kobo.873.1">(</span><span class="hljs-attr"><span class="koboSpan" id="kobo.874.1">route</span></span><span class="koboSpan" id="kobo.875.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.876.1">Route</span></span><span class="koboSpan" id="kobo.877.1">, </span><span class="hljs-attr"><span class="koboSpan" id="kobo.878.1">load</span></span><span class="koboSpan" id="kobo.879.1">: </span><span class="hljs-function"><span class="koboSpan" id="kobo.880.1">() =&gt;</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.881.1">Observable</span></span><span class="koboSpan" id="kobo.882.1">&lt;</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.883.1">any</span></span><span class="koboSpan" id="kobo.884.1">&gt;): </span><span class="hljs-title"><span class="koboSpan" id="kobo.885.1">Observable</span></span><span class="koboSpan" id="kobo.886.1">&lt;</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.887.1">any</span></span><span class="koboSpan" id="kobo.888.1">&gt; {
    </span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.889.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.890.1"> isLoggedIn = </span></strong><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.891.1">this</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.892.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.893.1">auth</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.894.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.895.1">isLoggedIn</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.896.1">();</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.897.1">if</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.898.1"> (!isLoggedIn) {</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.899.1">return</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.900.1">of</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.901.1">(</span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.902.1">null</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.903.1">)</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.904.1">}</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.905.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.906.1"> isAdmin = </span></strong><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.907.1">this</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.908.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.909.1">auth</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.910.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.911.1">loggedInUserType</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.912.1"> ===</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.913.1">UserType</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.914.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.915.1">Admin</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.916.1">;</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.917.1">return</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.918.1">of</span></span><span class="koboSpan" id="kobo.919.1">(</span><span class="hljs-literal"><span class="koboSpan" id="kobo.920.1">null</span></span><span class="koboSpan" id="kobo.921.1">)
  }
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.922.1">logAndLoad</span></span><span class="koboSpan" id="kobo.923.1">(</span><span class="hljs-attr"><span class="koboSpan" id="kobo.924.1">route</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.925.1">: </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.926.1">Route</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.927.1">, </span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.928.1">load</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.929.1">: () =&gt; </span></span><span class="hljs-title"><span class="koboSpan" id="kobo.930.1">Observable</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.931.1">&lt;</span></span><span class="hljs-built_in"><span class="koboSpan" id="kobo.932.1">any</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.933.1">&gt;</span></span><span class="koboSpan" id="kobo.934.1">) {...}
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.935.1">Let’s modify the </span><code class="inlineCode"><span class="koboSpan" id="kobo.936.1">preload</span></code><span class="koboSpan" id="kobo.937.1"> method further to work with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.938.1">loadForAdmin</span></code><span class="koboSpan" id="kobo.939.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.940.1">loadForEmployee</span></code><span class="koboSpan" id="kobo.941.1"> route data properties as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.942.1">...
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.943.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.944.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.945.1">CustomPreloadStrategyService</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.946.1">implements</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.947.1">PreloadingStrategy</span></span><span class="koboSpan" id="kobo.948.1"> {
...
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.949.1">preload</span></span><span class="koboSpan" id="kobo.950.1">(</span><span class="hljs-attr"><span class="koboSpan" id="kobo.951.1">route</span></span><span class="koboSpan" id="kobo.952.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.953.1">Route</span></span><span class="koboSpan" id="kobo.954.1">, </span><span class="hljs-attr"><span class="koboSpan" id="kobo.955.1">load</span></span><span class="koboSpan" id="kobo.956.1">: </span><span class="hljs-function"><span class="koboSpan" id="kobo.957.1">() =&gt;</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.958.1">Observable</span></span><span class="koboSpan" id="kobo.959.1">&lt;</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.960.1">any</span></span><span class="koboSpan" id="kobo.961.1">&gt;):
</span><span class="hljs-title"> </span> <span class="hljs-title"><span class="koboSpan" id="kobo.962.1">Observable</span></span><span class="koboSpan" id="kobo.963.1">&lt;</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.964.1">any</span></span><span class="koboSpan" id="kobo.965.1">&gt; {
    ...
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.966.1">const</span></span><span class="koboSpan" id="kobo.967.1"> isAdmin = </span><span class="hljs-variable"><span class="koboSpan" id="kobo.968.1">this</span></span><span class="koboSpan" id="kobo.969.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.970.1">auth</span></span><span class="koboSpan" id="kobo.971.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.972.1">loggedInUserType</span></span><span class="koboSpan" id="kobo.973.1"> ===
</span><span class="hljs-keyword"> </span> <span class="hljs-title"><span class="koboSpan" id="kobo.974.1">UserType</span></span><span class="koboSpan" id="kobo.975.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.976.1">Admin</span></span><span class="koboSpan" id="kobo.977.1">;
    </span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.978.1">if</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.979.1"> (</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.980.1">(isAdmin &amp;&amp; route.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.981.1">data</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.982.1">?.[</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.983.1">'loadForAdmin'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.984.1">]) ||</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.985.1">(!isAdmin &amp;&amp; route.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.986.1">data</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.987.1">?.[</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.988.1">'loadForEmployee'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.989.1">])</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.990.1">) {</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.991.1">return</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.992.1">this</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.993.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.994.1">logAndLoad</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.995.1">(route, load);</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.996.1">}</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.997.1">return</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.998.1">of</span></span><span class="koboSpan" id="kobo.999.1">(</span><span class="hljs-literal"><span class="koboSpan" id="kobo.1000.1">null</span></span><span class="koboSpan" id="kobo.1001.1">)
  }
}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1002.1">The final step is to use our custom</span><a id="_idIndexMarker470"/><span class="koboSpan" id="kobo.1003.1"> preloading strategy. </span><span class="koboSpan" id="kobo.1003.2">In order to do so, modify the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1004.1">app/app.config.ts</span></code><span class="koboSpan" id="kobo.1005.1"> file as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1006.1">import</span></span><span class="koboSpan" id="kobo.1007.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.1008.1">ApplicationConfig</span></span><span class="koboSpan" id="kobo.1009.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1010.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1011.1">'@angular/core'</span></span><span class="koboSpan" id="kobo.1012.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1013.1">import</span></span><span class="koboSpan" id="kobo.1014.1"> {
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.1015.1">provideRouter</span></span><span class="koboSpan" id="kobo.1016.1">,
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.1017.1">withEnabledBlockingInitialNavigation</span></span><span class="koboSpan" id="kobo.1018.1">,
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.1019.1">withPreloading</span></span><span class="koboSpan" id="kobo.1020.1">,
} </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1021.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1022.1">'@angular/router'</span></span><span class="koboSpan" id="kobo.1023.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1024.1">import</span></span><span class="koboSpan" id="kobo.1025.1"> { appRoutes } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1026.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1027.1">'./app.routes'</span></span><span class="koboSpan" id="kobo.1028.1">;
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1029.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1030.1"> { </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1031.1">AppPreloadStrategyService</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1032.1"> } </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1033.1">from</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1034.1">'./app-preload-strategy.service'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1035.1">;</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1036.1">i</span></span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1037.1">mport</span></span><span class="koboSpan" id="kobo.1038.1"> { provideAnimations } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1039.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1040.1">'@angular/platform-browser/animations'</span></span><span class="koboSpan" id="kobo.1041.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1042.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1043.1">const</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.1044.1">appConfig</span></span><span class="koboSpan" id="kobo.1045.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.1046.1">ApplicationConfig</span></span><span class="koboSpan" id="kobo.1047.1"> = {
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1048.1">providers</span></span><span class="koboSpan" id="kobo.1049.1">: [
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1050.1">provideRouter</span></span><span class="koboSpan" id="kobo.1051.1">(
      appRoutes,
      </span><span class="hljs-title"><span class="koboSpan" id="kobo.1052.1">withEnabledBlockingInitialNavigation</span></span><span class="koboSpan" id="kobo.1053.1">(),
      </span><span class="hljs-title"><span class="koboSpan" id="kobo.1054.1">withPreloading</span></span><span class="koboSpan" id="kobo.1055.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.1056.1">AppPreloadStrategyService</span></span><span class="koboSpan" id="kobo.1057.1">)
    ),
    </span><span class="hljs-title"><span class="koboSpan" id="kobo.1058.1">provideAnimations</span></span><span class="koboSpan" id="kobo.1059.1">(),
  ],
};
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1060.1">Voilà! </span><span class="koboSpan" id="kobo.1060.2">If you refresh the app now and monitor the </span><strong class="screenText"><span class="koboSpan" id="kobo.1061.1">Network</span></strong><span class="koboSpan" id="kobo.1062.1"> tab, you’ll notice when you’re logged in as </span><code class="inlineCode"><span class="koboSpan" id="kobo.1063.1">admin</span></code><span class="koboSpan" id="kobo.1064.1">, you can see in the console log that the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1065.1">admin-campaign</span></code><span class="koboSpan" id="kobo.1066.1"> route is preloaded, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.1067.1">Figure 7.10</span></em><span class="koboSpan" id="kobo.1068.1">:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1069.1"><img alt="" role="presentation" src="../Images/B18469_07_10.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1070.1">Figure 7.10: Preloading the admin-campaign route when landing on the admin route using the custom preload strategy</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1071.1">You can also have a look</span><a id="_idIndexMarker471"/><span class="koboSpan" id="kobo.1072.1"> at the </span><strong class="screenText"><span class="koboSpan" id="kobo.1073.1">Network</span></strong><span class="koboSpan" id="kobo.1074.1"> tab to see the bundles being downloaded:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1075.1"><img alt="" role="presentation" src="../Images/B18469_07_11.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1076.1">Figure 7.11: JavaScript bundle for admin-campaign route preloaded</span></p></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.1077.1">Try logging out and logging in as an employee. </span><span class="koboSpan" id="kobo.1077.2">You’ll see the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1078.1">employee-campaign</span></code><span class="koboSpan" id="kobo.1079.1"> route being preloaded. </span><span class="koboSpan" id="kobo.1079.2">Not only that, if you refresh the employee-campaign route, you’ll see the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1080.1">employee</span></code><span class="koboSpan" id="kobo.1081.1"> route being preloaded as well. </span><span class="koboSpan" id="kobo.1081.2">The same goes for the admin-campaign and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1082.1">admin</span></code><span class="koboSpan" id="kobo.1083.1"> routes.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1084.1">Now that you’ve finished the recipe, see the next section on how this works.</span></p>
<h2 class="heading-2" id="_idParaDest-242"><span class="koboSpan" id="kobo.1085.1">How it works…</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1086.1">Angular provides a great way to implement our own custom preloading strategy for our feature modules. </span><span class="koboSpan" id="kobo.1086.2">We can decide easily which modules should be preloaded and which should not. </span><span class="koboSpan" id="kobo.1086.3">In the recipe, we learned a very simple way to configure the preloading using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1087.1">data</span></code><span class="koboSpan" id="kobo.1088.1"> object of the routes configuration by adding properties named </span><code class="inlineCode"><span class="koboSpan" id="kobo.1089.1">loadForAdmin</span></code><span class="koboSpan" id="kobo.1090.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1091.1">loadForEmployee</span></code><span class="koboSpan" id="kobo.1092.1">. </span><span class="koboSpan" id="kobo.1092.2">We created our own custom preloading strategy service named </span><code class="inlineCode"><span class="koboSpan" id="kobo.1093.1">AppPreloadStrategyService</span></code><span class="koboSpan" id="kobo.1094.1">, which implements the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1095.1">PreloadingStrategy</span></code><span class="koboSpan" id="kobo.1096.1"> interface from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1097.1">@angular/router</span></code><span class="koboSpan" id="kobo.1098.1"> package. </span><span class="koboSpan" id="kobo.1098.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1099.1">PreloadingStrategy</span></code><span class="koboSpan" id="kobo.1100.1"> class provides a method named </span><code class="inlineCode"><span class="koboSpan" id="kobo.1101.1">preload</span></code><span class="koboSpan" id="kobo.1102.1">, which has the following signature:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-title"><span class="koboSpan" id="kobo.1103.1">preload</span></span><span class="koboSpan" id="kobo.1104.1">(</span><span class="hljs-attr"><span class="koboSpan" id="kobo.1105.1">route</span></span><span class="koboSpan" id="kobo.1106.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.1107.1">Route</span></span><span class="koboSpan" id="kobo.1108.1">, </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1109.1">load</span></span><span class="koboSpan" id="kobo.1110.1">: </span><span class="hljs-function"><span class="koboSpan" id="kobo.1111.1">() =&gt;</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1112.1">Observable</span></span><span class="koboSpan" id="kobo.1113.1">&lt;</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1114.1">any</span></span><span class="koboSpan" id="kobo.1115.1">&gt;) =&gt; </span><span class="hljs-title"><span class="koboSpan" id="kobo.1116.1">Observable</span></span><span class="koboSpan" id="kobo.1117.1">&lt;</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1118.1">any</span></span><span class="koboSpan" id="kobo.1119.1">&gt;
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1120.1">The argument named </span><code class="inlineCode"><span class="koboSpan" id="kobo.1121.1">load </span></code><span class="koboSpan" id="kobo.1122.1">is a method</span><a id="_idIndexMarker472"/><span class="koboSpan" id="kobo.1123.1"> from the Angular router that allows us to load the component/module by calling it. </span><span class="koboSpan" id="kobo.1123.2">As a result, it provides an observable. </span><span class="koboSpan" id="kobo.1123.3">Since the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1124.1">preload</span></code><span class="koboSpan" id="kobo.1125.1"> method must return an observable, we return </span><code class="inlineCode"><span class="koboSpan" id="kobo.1126.1">of(null)</span></code><span class="koboSpan" id="kobo.1127.1"> when we do not want to preload a route, or we return </span><code class="inlineCode"><span class="koboSpan" id="kobo.1128.1">load</span></code><span class="koboSpan" id="kobo.1129.1"> (which returns an observable) when we want to load the component associated with the route. </span><span class="koboSpan" id="kobo.1129.2">The target in general is to have a custom preloading strategy that uses the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1130.1">preload</span></code><span class="koboSpan" id="kobo.1131.1"> method to decide whether a route should be preloaded. </span><span class="koboSpan" id="kobo.1131.2">That is because Angular goes through each route using our custom preloading strategy and lets us decide which routes to preload. </span><span class="koboSpan" id="kobo.1131.3">And that is it. </span><span class="koboSpan" id="kobo.1131.4">We can see if the logged-in user is </span><code class="inlineCode"><span class="koboSpan" id="kobo.1132.1">admin</span></code><span class="koboSpan" id="kobo.1133.1"> and has the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1134.1">loadForAdmin</span></code><span class="koboSpan" id="kobo.1135.1"> property in the route’s data, or if the logged-in user is an employee and has the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1136.1">loadForEmployee</span></code><span class="koboSpan" id="kobo.1137.1"> property in the route’s data. </span><span class="koboSpan" id="kobo.1137.2">We then preload the route. </span><span class="koboSpan" id="kobo.1137.3">Otherwise, we don’t. </span><span class="koboSpan" id="kobo.1137.4">And there’s no preloading when the user is not logged in.</span></p>
<h2 class="heading-2" id="_idParaDest-243"><span class="koboSpan" id="kobo.1138.1">See also</span></h2>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.1139.1">Route preloading strategies</span><a id="_idIndexMarker473"/><span class="koboSpan" id="kobo.1140.1"> article on </span><code class="inlineCode"><span class="koboSpan" id="kobo.1141.1">web.dev</span></code><span class="koboSpan" id="kobo.1142.1">: </span><a href="https://web.dev/route-preloading-in-angular/"><span class="url"><span class="koboSpan" id="kobo.1143.1">https://web.dev/route-preloading-in-angular/</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1144.1">Route preloading strategies in Angular: </span><a href="https://www.youtube.com/watch?v=RQGLcMnh9k8"><span class="url"><span class="koboSpan" id="kobo.1145.1">https://www.youtube.com/watch?v=RQGLcMnh9k8</span></span></a></li>
</ul>
<h1 class="heading-1" id="_idParaDest-244"><span class="koboSpan" id="kobo.1146.1">Authorized access to routes using route guards</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1147.1">Not all routes in your Angular</span><a id="_idIndexMarker474"/><span class="koboSpan" id="kobo.1148.1"> app should be accessible to everyone</span><a id="_idIndexMarker475"/><span class="koboSpan" id="kobo.1149.1"> in the world. </span><span class="koboSpan" id="kobo.1149.2">In this recipe, we’ll learn how to create route guards in Angular to prevent unauthorized access to routes.</span></p>
<h2 class="heading-2" id="_idParaDest-245"><span class="koboSpan" id="kobo.1150.1">Getting ready</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1151.1">The app that we are going to work with resides in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1152.1">start/apps/chapter07/ng-route-guards</span></code><span class="koboSpan" id="kobo.1153.1"> inside the cloned repository:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1154.1">Open the code repository in your code editor.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1155.1">Open the terminal, navigate to the code repository directory, and run the following command to serve the project:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1156.1">npm run serve ng-route-guards
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1157.1">This should open the app in a new browser tab. </span><span class="koboSpan" id="kobo.1157.2">You should see the following:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1158.1"><img alt="" role="presentation" src="../Images/B18469_07_12.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1159.1">Figure 7.12: ng-route-guards app running on http://localhost:4200</span></p> </li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.1160.1">Now that we have the app running locally, let’s see the steps of the recipe in the next section.</span></p>
<h2 class="heading-2" id="_idParaDest-246"><span class="koboSpan" id="kobo.1161.1">How to do it…</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1162.1">We have an app with a couple</span><a id="_idIndexMarker476"/><span class="koboSpan" id="kobo.1163.1"> of routes already set up. </span><span class="koboSpan" id="kobo.1163.2">You can</span><a id="_idIndexMarker477"/><span class="koboSpan" id="kobo.1164.1"> log in as either an employee or an admin to get to the bucket list of the app. </span><span class="koboSpan" id="kobo.1164.2">However, if you tap any of the two buttons in the header, you’ll see that you can navigate to the </span><strong class="screenText"><span class="koboSpan" id="kobo.1165.1">Admin</span></strong><span class="koboSpan" id="kobo.1166.1"> and </span><strong class="screenText"><span class="koboSpan" id="kobo.1167.1">Employee</span></strong><span class="koboSpan" id="kobo.1168.1"> sections even without being logged in. </span><span class="koboSpan" id="kobo.1168.2">This is what we want to prevent from happening. </span><span class="koboSpan" id="kobo.1168.3">Notice in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1169.1">auth.service.ts</span></code><span class="koboSpan" id="kobo.1170.1"> file that we already have a way for the user to log in, and we can check whether the user is logged in or not using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1171.1">isLoggedIn</span></code><span class="koboSpan" id="kobo.1172.1"> method:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1173.1">First, let’s create a route guard that will only allow the user to go to the particular routes if the user is logged</span><a id="_idIndexMarker478"/><span class="koboSpan" id="kobo.1174.1"> in. </span><span class="koboSpan" id="kobo.1174.2">We’ll name it </span><code class="inlineCode"><span class="koboSpan" id="kobo.1175.1">AuthGuard</span></code><span class="koboSpan" id="kobo.1176.1">. </span><span class="koboSpan" id="kobo.1176.2">Let’s create a new file inside the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1177.1">auth</span></code><span class="koboSpan" id="kobo.1178.1"> folder</span><a id="_idIndexMarker479"/><span class="koboSpan" id="kobo.1179.1"> and name it </span><code class="inlineCode"><span class="koboSpan" id="kobo.1180.1">auth.guards.ts</span></code><span class="koboSpan" id="kobo.1181.1">. </span><span class="koboSpan" id="kobo.1181.2">Then add the following code:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1182.1">import</span></span><span class="koboSpan" id="kobo.1183.1"> { inject } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1184.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1185.1">"@angular/core"</span></span><span class="koboSpan" id="kobo.1186.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1187.1">import</span></span><span class="koboSpan" id="kobo.1188.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.1189.1">CanActivateFn</span></span><span class="koboSpan" id="kobo.1190.1">, </span><span class="hljs-title"><span class="koboSpan" id="kobo.1191.1">Router</span></span><span class="koboSpan" id="kobo.1192.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1193.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1194.1">"@angular/router"</span></span><span class="koboSpan" id="kobo.1195.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1196.1">import</span></span><span class="koboSpan" id="kobo.1197.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.1198.1">AuthService</span></span><span class="koboSpan" id="kobo.1199.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1200.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1201.1">"./auth.service"</span></span><span class="koboSpan" id="kobo.1202.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1203.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1204.1">const</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.1205.1">canActivateAdminOrEmployee</span></span><span class="koboSpan" id="kobo.1206.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.1207.1">CanActivateFn</span></span><span class="koboSpan" id="kobo.1208.1"> =
</span><span class="hljs-keyword"> </span> <span class="hljs-function"><span class="koboSpan" id="kobo.1209.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1210.1"> {
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1211.1">const</span></span><span class="koboSpan" id="kobo.1212.1"> router = </span><span class="hljs-title"><span class="koboSpan" id="kobo.1213.1">inject</span></span><span class="koboSpan" id="kobo.1214.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.1215.1">Router</span></span><span class="koboSpan" id="kobo.1216.1">);
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1217.1">const</span></span><span class="koboSpan" id="kobo.1218.1"> authService = </span><span class="hljs-title"><span class="koboSpan" id="kobo.1219.1">inject</span></span><span class="koboSpan" id="kobo.1220.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.1221.1">AuthService</span></span><span class="koboSpan" id="kobo.1222.1">);
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1223.1">const</span></span><span class="koboSpan" id="kobo.1224.1"> isLoggedIn = authService.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1225.1">isLoggedIn</span></span><span class="koboSpan" id="kobo.1226.1">();
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1227.1">if</span></span><span class="koboSpan" id="kobo.1228.1"> (!isLoggedIn) {
    router.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1229.1">navigate</span></span><span class="koboSpan" id="kobo.1230.1">([</span><span class="hljs-string"><span class="koboSpan" id="kobo.1231.1">'/auth'</span></span><span class="koboSpan" id="kobo.1232.1">]);
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1233.1">return</span></span> <span class="hljs-literal"><span class="koboSpan" id="kobo.1234.1">false</span></span><span class="koboSpan" id="kobo.1235.1">;
  }
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1236.1">return</span></span> <span class="hljs-literal"><span class="koboSpan" id="kobo.1237.1">true</span></span><span class="koboSpan" id="kobo.1238.1">;
};
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1239.1">Now we can add this guard to the routes. </span><span class="koboSpan" id="kobo.1239.2">Update </span><code class="inlineCode"><span class="koboSpan" id="kobo.1240.1">app.routes.ts</span></code><span class="koboSpan" id="kobo.1241.1"> as follows:
        </span><pre class="programlisting code"><code class="hljs-code"> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1242.1">import</span></span><span class="koboSpan" id="kobo.1243.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.1244.1">Route</span></span><span class="koboSpan" id="kobo.1245.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1246.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1247.1">'@angular/router'</span></span><span class="koboSpan" id="kobo.1248.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1249.1">import</span></span><span class="koboSpan" id="kobo.1250.1"> { canActivateAdminOrEmployee } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1251.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1252.1">'./auth/auth.guards'</span></span><span class="koboSpan" id="kobo.1253.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1254.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1255.1">const</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.1256.1">appRoutes</span></span><span class="koboSpan" id="kobo.1257.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.1258.1">Route</span></span><span class="koboSpan" id="kobo.1259.1">[] = [
  {...},
  { </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1260.1">path</span></span><span class="koboSpan" id="kobo.1261.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.1262.1">'auth'</span></span><span class="koboSpan" id="kobo.1263.1">, ... </span><span class="koboSpan" id="kobo.1263.2">},
  {
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1264.1">path</span></span><span class="koboSpan" id="kobo.1265.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.1266.1">'admin'</span></span><span class="koboSpan" id="kobo.1267.1">,
    ...,
    </span><span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1268.1">canActivate</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1269.1">: [canActivateAdminOrEmployee]</span></strong></span><span class="koboSpan" id="kobo.1270.1">
  },
  {
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1271.1">path</span></span><span class="koboSpan" id="kobo.1272.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.1273.1">'employee'</span></span><span class="koboSpan" id="kobo.1274.1">,
    ...,
    </span><span class="code-highlight"><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1275.1">canActivate</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1276.1">: [canActivateAdminOrEmployee]</span></strong></span><span class="koboSpan" id="kobo.1277.1">
  }
];
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1278.1">If you try to go to the Admin or Employee pages without being logged in now, you’ll see you are not able to do that anymore thanks to the route guard.</span></p></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="3"><span class="koboSpan" id="kobo.1279.1">Let’s make sure we can’t go</span><a id="_idIndexMarker480"/><span class="koboSpan" id="kobo.1280.1"> to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1281.1">auth</span></code><span class="koboSpan" id="kobo.1282.1"> page if we’re already</span><a id="_idIndexMarker481"/><span class="koboSpan" id="kobo.1283.1"> logged in. </span><span class="koboSpan" id="kobo.1283.2">Add a function guard in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1284.1">auth.guards.ts</span></code><span class="koboSpan" id="kobo.1285.1"> file as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1286.1">...
</span><span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1287.1">import</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1288.1"> { </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1289.1">UserType</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1290.1"> } </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1291.1">from</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1292.1">'../constants/user-type'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1293.1">;</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1294.1">export</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1295.1">const</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-attr-slc"><span class="koboSpan" id="kobo.1296.1">canActivateLogin</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1297.1">: </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1298.1">CanActivateFn</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1299.1"> = </span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1300.1">() =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1301.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1302.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1303.1"> router = </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1304.1">inject</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1305.1">(</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1306.1">Router</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1307.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1308.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1309.1"> authService = </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1310.1">inject</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1311.1">(</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1312.1">AuthService</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1313.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1314.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1315.1"> isLoggedIn = authService.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1316.1">isLoggedIn</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1317.1">();</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1318.1">if</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1319.1"> (router.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1320.1">url</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1321.1"> === </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1322.1">'/'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1323.1"> &amp;&amp; isLoggedIn) {</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1324.1">const</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1325.1"> isAdmin = authService.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1326.1">loggedInUserType</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1327.1"> ===</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1328.1">UserType</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1329.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1330.1">Admin</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1331.1">;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1332.1">router.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1333.1">navigate</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1334.1">([</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1335.1">`/</span></strong><strong class="hljs-subst-slc"><span class="koboSpan" id="kobo.1336.1">${isAdmin ? </span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1337.1">'admin'</span></strong><strong class="hljs-subst-slc"><span class="koboSpan" id="kobo.1338.1"> :</span></strong></span>
<span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1339.1">'employee'</span></strong><strong class="hljs-subst-slc"><span class="koboSpan" id="kobo.1340.1">}</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1341.1">`</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1342.1">])</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1343.1">return</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.1344.1">false</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1345.1">}</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1346.1">return</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1347.1"> !authService.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1348.1">isLoggedIn</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1349.1">()</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1350.1">}</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1351.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1352.1">const</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.1353.1">canActivateAdminOrEmployee</span></span><span class="koboSpan" id="kobo.1354.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.1355.1">CanActivateFn</span></span><span class="koboSpan" id="kobo.1356.1"> = </span><span class="hljs-function"><span class="koboSpan" id="kobo.1357.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1358.1"> {...};
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1359.1">If you log in, and then click the browser’s </span><strong class="screenText"><span class="koboSpan" id="kobo.1360.1">Back</span></strong><span class="koboSpan" id="kobo.1361.1"> button, you’ll see you can’t go back to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1362.1">/auth</span></code><span class="koboSpan" id="kobo.1363.1"> page either. </span><span class="koboSpan" id="kobo.1363.2">Even if you open a new tab and go to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1364.1">http://localhost:4200</span></code><span class="koboSpan" id="kobo.1365.1">, you’ll see that it takes you to the correct page based on the logged-in user’s type.</span></p> </li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.1366.1">Great! </span><span class="koboSpan" id="kobo.1366.2">You now are an authorization expert when it comes to guarding routes. </span><span class="koboSpan" id="kobo.1366.3">With great power comes great responsibility. </span><span class="koboSpan" id="kobo.1366.4">Use it wisely.</span></p>
<h2 class="heading-2" id="_idParaDest-247"><span class="koboSpan" id="kobo.1367.1">How it works…</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1368.1">Angular has switched to functional route guards since Angular v14.2. </span><span class="koboSpan" id="kobo.1368.2">This makes it much easier to configure the routes compared to the previous version. </span><span class="koboSpan" id="kobo.1368.3">There are many route guards, such as </span><code class="inlineCode"><span class="koboSpan" id="kobo.1369.1">CanActivate</span></code><span class="koboSpan" id="kobo.1370.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1371.1">CanDeactivate</span></code><span class="koboSpan" id="kobo.1372.1">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1373.1">CanActivateChildren</span></code><span class="koboSpan" id="kobo.1374.1">. </span><span class="koboSpan" id="kobo.1374.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1375.1">provideRouter</span></code><span class="koboSpan" id="kobo.1376.1"> function used in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1377.1">main.ts</span></code><span class="koboSpan" id="kobo.1378.1"> makes it possible for us to provide the routes with functional route guards. </span><span class="koboSpan" id="kobo.1378.2">A route can take the guards as an array against the guard property name. </span><span class="koboSpan" id="kobo.1378.3">You can see how we provided our </span><code class="inlineCode"><span class="koboSpan" id="kobo.1379.1">canActivateAdminOrEmployee</span></code><span class="koboSpan" id="kobo.1380.1"> guard against both the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1381.1">/employee</span></code><span class="koboSpan" id="kobo.1382.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1383.1">/admin</span></code><span class="koboSpan" id="kobo.1384.1"> routes in </span><em class="italic"><span class="koboSpan" id="kobo.1385.1">step 2</span></em><span class="koboSpan" id="kobo.1386.1">. </span><span class="koboSpan" id="kobo.1386.2">A functional guard is supposed to return a Boolean value or a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1387.1">UrlTree</span></code><span class="koboSpan" id="kobo.1388.1">, a </span><strong class="keyWord"><span class="koboSpan" id="kobo.1389.1">promise</span></strong><span class="koboSpan" id="kobo.1390.1"> of Boolean or </span><code class="inlineCode"><span class="koboSpan" id="kobo.1391.1">UrlTree</span></code><span class="koboSpan" id="kobo.1392.1">, or an observable of Boolean or </span><code class="inlineCode"><span class="koboSpan" id="kobo.1393.1">UrlTree</span></code><span class="koboSpan" id="kobo.1394.1">. </span><span class="koboSpan" id="kobo.1394.2">We’ve focused on the Boolean value’s usage in our recipe. </span><span class="koboSpan" id="kobo.1394.3">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1395.1">canActivateAdminOrEmployee</span></code><span class="koboSpan" id="kobo.1396.1"> guard, we check if the user is logged in. </span><span class="koboSpan" id="kobo.1396.2">If that’s true, we allow the route to be activated (i.e., we allow the routing to happen), or we navigate to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1397.1">/auth</span></code><span class="koboSpan" id="kobo.1398.1"> route. </span><span class="koboSpan" id="kobo.1398.2">In the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1399.1">canActivateLogin</span></code><span class="koboSpan" id="kobo.1400.1"> guard, we do something a bit more complex. </span><span class="koboSpan" id="kobo.1400.2">Since someone could land on the home page (the route is </span><code class="inlineCode"><span class="koboSpan" id="kobo.1401.1">/</span></code><span class="koboSpan" id="kobo.1402.1">, which redirects to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1403.1">/auth</span></code><span class="koboSpan" id="kobo.1404.1">), we have to first check if the user is logged in, and if that’s the case, then which type of user this is. </span><span class="koboSpan" id="kobo.1404.2">Based </span><a id="_idIndexMarker482"/><span class="koboSpan" id="kobo.1405.1">on evaluation, we route the user</span><a id="_idIndexMarker483"/><span class="koboSpan" id="kobo.1406.1"> to either the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1407.1">/employee</span></code><span class="koboSpan" id="kobo.1408.1"> or </span><code class="inlineCode"><span class="koboSpan" id="kobo.1409.1">/admin</span></code><span class="koboSpan" id="kobo.1410.1"> route.</span></p>
<h2 class="heading-2" id="_idParaDest-248"><span class="koboSpan" id="kobo.1411.1">See also</span></h2>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.1412.1">Preventing unauthorized</span><a id="_idIndexMarker484"/><span class="koboSpan" id="kobo.1413.1"> access in Angular routes: </span><a href="https://angular.io/guide/router#preventing-unauthorized-access"><span class="url"><span class="koboSpan" id="kobo.1414.1">https://angular.io/guide/router#preventing-unauthorized-access</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.1415.1">Angular</span><a id="_idIndexMarker485"/> <code class="inlineCode"><span class="koboSpan" id="kobo.1416.1">CanActivateFn</span></code><span class="koboSpan" id="kobo.1417.1"> docs: </span><a href="https://angular.io/api/router/CanActivateFn "><span class="url"><span class="koboSpan" id="kobo.1418.1">https://angular.io/api/router/CanActivateFn</span></span></a></li>
</ul>
<h1 class="heading-1" id="_idParaDest-249"><span class="koboSpan" id="kobo.1419.1">Working with route parameters</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1420.1">Whether it is about building</span><a id="_idIndexMarker486"/><span class="koboSpan" id="kobo.1421.1"> a REST API using Node.js or configuring routes in Angular, setting up routes is an absolute art, especially when it comes to working with parameters. </span><span class="koboSpan" id="kobo.1421.2">In this recipe, you’ll create some routes with parameters and will learn how to get those parameters in your components once the route is active.</span></p>
<h2 class="heading-2" id="_idParaDest-250"><span class="koboSpan" id="kobo.1422.1">Getting ready</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1423.1">The app that we are going to work with resides in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1424.1">start/apps/chapter07/ng-route-params</span></code><span class="koboSpan" id="kobo.1425.1"> inside the cloned repository:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1426.1">Open the code repository in your code editor.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1427.1">Open the terminal, navigate to the code repository directory, and run the following command to serve the project:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1428.1">npm run serve ng-route-guards
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1429.1">This should open the app in a new browser tab. </span><span class="koboSpan" id="kobo.1429.2">You should see the following:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1430.1"><img alt="" role="presentation" src="../Images/B18469_07_13.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1431.1">Figure 7.13: The ng-route-params app running on localhost:4200</span></p></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.1432.1">Now that we have the app running</span><a id="_idIndexMarker487"/><span class="koboSpan" id="kobo.1433.1"> locally, let’s see the steps of the recipe in the next section.</span></p>
<h2 class="heading-2" id="_idParaDest-251"><span class="koboSpan" id="kobo.1434.1">How to do it…</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1435.1">The problem right now is that we have a route for opening the user details, but we don’t see anything, i.e., we have a blank page. </span><span class="koboSpan" id="kobo.1435.2">That’s because this route doesn’t have any idea about which user to show. </span><span class="koboSpan" id="kobo.1435.3">Wouldn’t it be nice to have a way to pass the clicked user’s information from the users list page to the user detail page? </span><span class="koboSpan" id="kobo.1435.4">That’s exactly what we’re going to do in this recipe:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1436.1">First, we have to make our user route capable of accepting the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1437.1">route</span></code><span class="koboSpan" id="kobo.1438.1"> parameter. </span><span class="koboSpan" id="kobo.1438.2">This is going to be a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1439.1">required</span></code><span class="koboSpan" id="kobo.1440.1"> parameter, which means the route will not work without passing this. </span><span class="koboSpan" id="kobo.1440.2">Let’s modify </span><code class="inlineCode"><span class="koboSpan" id="kobo.1441.1">app.routes.ts</span></code><span class="koboSpan" id="kobo.1442.1"> to add this required parameter to the route definition, as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1443.1">import</span></span><span class="koboSpan" id="kobo.1444.1"> { </span><span class="hljs-title"><span class="koboSpan" id="kobo.1445.1">Route</span></span><span class="koboSpan" id="kobo.1446.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1447.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1448.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1449.1">@angular/router'</span></span><span class="koboSpan" id="kobo.1450.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1451.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1452.1">const</span></span> <span class="hljs-attr"><span class="koboSpan" id="kobo.1453.1">appRoutes</span></span><span class="koboSpan" id="kobo.1454.1">: </span><span class="hljs-title"><span class="koboSpan" id="kobo.1455.1">Route</span></span><span class="koboSpan" id="kobo.1456.1">[] = [
  { </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1457.1">path</span></span><span class="koboSpan" id="kobo.1458.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.1459.1">''</span></span><span class="koboSpan" id="kobo.1460.1">, ...},
  { </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1461.1">path</span></span><span class="koboSpan" id="kobo.1462.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.1463.1">'users'</span></span><span class="koboSpan" id="kobo.1464.1">, ...},
  {
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1465.1">path</span></span><span class="koboSpan" id="kobo.1466.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.1467.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1468.1">users/</span></span><span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1469.1">:uuid</span></strong></span><span class="hljs-string"><span class="koboSpan" id="kobo.1470.1">'</span></span><span class="koboSpan" id="kobo.1471.1">,
    </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1472.1">loadComponent</span></span><span class="koboSpan" id="kobo.1473.1">: </span><span class="hljs-function"><span class="koboSpan" id="kobo.1474.1">() =&gt;</span></span><span class="koboSpan" id="kobo.1475.1"> ...,
  },
];
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1476.1">We’ll now update the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1477.1">src/app/components/users-list/users-list.component.html</span></code><span class="koboSpan" id="kobo.1478.1"> file to change the links to use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1479.1">uuid</span></code><span class="koboSpan" id="kobo.1480.1"> as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag"><span class="koboSpan" id="kobo.1481.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1482.1">ul</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1483.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1484.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1485.1">li</span></span>
<span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1486.1">routerLink</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1487.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1488.1">"/users/</span></span><span class="code-highlight"><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1489.1">{{user.uuid}}</span></strong></span><span class="hljs-string"><span class="koboSpan" id="kobo.1490.1">"</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1491.1">    *</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1492.1">ngFor</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1493.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1494.1">"let user of users"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1495.1">&gt;</span></span><span class="koboSpan" id="kobo.1496.1">
    ...
  </span><span class="hljs-tag"><span class="koboSpan" id="kobo.1497.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1498.1">li</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1499.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1500.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1501.1">ul</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1502.1">&gt;</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1503.1">We’re now able to navigate</span><a id="_idIndexMarker488"/><span class="koboSpan" id="kobo.1504.1"> to a particular user’s route using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1505.1">uuid</span></code><span class="koboSpan" id="kobo.1506.1">, and you should also be able to see it in the address bar as follows:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1507.1"><img alt="" role="presentation" src="../Images/B18469_07_14.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1508.1">Figure 7.14: The UUID being shown in the address bar</span></p></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="3"><span class="koboSpan" id="kobo.1509.1">To get the user from </span><code class="inlineCode"><span class="koboSpan" id="kobo.1510.1">UserService</span></code><span class="koboSpan" id="kobo.1511.1"> based on the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1512.1">uuid</span></code><span class="koboSpan" id="kobo.1513.1">, we need to get the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1514.1">uuid</span></code><span class="koboSpan" id="kobo.1515.1"> value in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1516.1">UserDetailsComponent</span></code><span class="koboSpan" id="kobo.1517.1"> from the route parameters. </span><span class="koboSpan" id="kobo.1517.2">Let’s update the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1518.1">user-details.component.ts</span></code><span class="koboSpan" id="kobo.1519.1"> as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1520.1">...
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1521.1">import</span></span><span class="koboSpan" id="kobo.1522.1"> { </span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1523.1">ActivatedRoute</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1524.1">, </span></strong></span><span class="hljs-title"><span class="koboSpan" id="kobo.1525.1">RouterModule</span></span><span class="koboSpan" id="kobo.1526.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1527.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1528.1">'@angular/router'</span></span><span class="koboSpan" id="kobo.1529.1">;
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1530.1">import</span></span><span class="koboSpan" id="kobo.1531.1"> { </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1532.1">filter, map,</span></strong></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1533.1">Observable</span></span><span class="koboSpan" id="kobo.1534.1">} </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1535.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1536.1">'rxjs'</span></span><span class="koboSpan" id="kobo.1537.1">;
...
</span><span class="hljs-meta"><span class="koboSpan" id="kobo.1538.1">@Component</span></span><span class="koboSpan" id="kobo.1539.1">({...})
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1540.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1541.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1542.1">UserDetailsComponent</span></span><span class="koboSpan" id="kobo.1543.1"> {
  </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1544.1">route = </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1545.1">inject</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1546.1">(</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1547.1">ActivatedRoute</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1548.1">);</span></strong></span><span class="koboSpan" id="kobo.1549.1">
  ...
  </span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1550.1">constructor</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1551.1">() {</span></strong></span>
<span class="code-highlight"><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.1552.1">this</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1553.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1554.1">user$</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1555.1"> = </span></strong><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.1556.1">this</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1557.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1558.1">route</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1559.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1560.1">paramMap</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1561.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1562.1">pipe</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1563.1">(</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1564.1">map</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1565.1">(</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1566.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1567.1">params</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1568.1">) =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1569.1"> params.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1570.1">get</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1571.1">(</span></strong><strong class="hljs-string-slc"><span class="koboSpan" id="kobo.1572.1">'uuid'</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1573.1">)),</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1574.1">filter</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1575.1">(</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1576.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1577.1">uuid</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1578.1">) =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1579.1"> !!uuid),</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1580.1">map</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1581.1">(</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1582.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1583.1">uuid</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1584.1">) =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1585.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1586.1">return</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.1587.1">this</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1588.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1589.1">userService</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1590.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1591.1">getById</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1592.1">(uuid </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1593.1">as</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.1594.1">string</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1595.1">) ||</span></strong></span>
<span class="code-highlight"><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.1596.1">null</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1597.1">;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1598.1">})</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1599.1">);</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1600.1">}</span></strong></span><span class="koboSpan" id="kobo.1601.1">
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1602.1">You should be able to see the user we clicked from the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1603.1">/users</span></code><span class="koboSpan" id="kobo.1604.1"> page now. </span><span class="koboSpan" id="kobo.1604.2">The only thing remaining is showing similar users.</span></p></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="4"><span class="koboSpan" id="kobo.1605.1">Instead of creating another</span><a id="_idIndexMarker489"/><span class="koboSpan" id="kobo.1606.1"> subscription, we can tap into the one we created in the previous step using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1607.1">tap</span></code><span class="koboSpan" id="kobo.1608.1"> operator from RxJS. </span><span class="koboSpan" id="kobo.1608.2">Update the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1609.1">user-details.component.ts</span></code><span class="koboSpan" id="kobo.1610.1"> file further, as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1611.1">...
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1612.1">import</span></span><span class="koboSpan" id="kobo.1613.1"> { filter, map, </span><span class="hljs-title"><span class="koboSpan" id="kobo.1614.1">Observable</span></span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1615.1">, </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1616.1">of</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1617.1">, tap</span></strong></span><span class="koboSpan" id="kobo.1618.1">} </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1619.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1620.1">'rxjs'</span></span><span class="koboSpan" id="kobo.1621.1">;
...
</span><span class="hljs-meta"><span class="koboSpan" id="kobo.1622.1">@Component</span></span><span class="koboSpan" id="kobo.1623.1">({...})
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1624.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1625.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1626.1">UserDetailsComponent</span></span><span class="koboSpan" id="kobo.1627.1"> {
  ...
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.1628.1">constructor</span></span><span class="koboSpan" id="kobo.1629.1">() {
    </span><span class="hljs-variable"><span class="koboSpan" id="kobo.1630.1">this</span></span><span class="koboSpan" id="kobo.1631.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1632.1">user$</span></span><span class="koboSpan" id="kobo.1633.1"> = </span><span class="hljs-variable"><span class="koboSpan" id="kobo.1634.1">this</span></span><span class="koboSpan" id="kobo.1635.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1636.1">route</span></span><span class="koboSpan" id="kobo.1637.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1638.1">paramMap</span></span><span class="koboSpan" id="kobo.1639.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1640.1">pipe</span></span><span class="koboSpan" id="kobo.1641.1">(
      </span><span class="hljs-title"><span class="koboSpan" id="kobo.1642.1">map</span></span><span class="koboSpan" id="kobo.1643.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.1644.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1645.1">params</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1646.1">) =&gt;</span></span><span class="koboSpan" id="kobo.1647.1"> params.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1648.1">get</span></span><span class="koboSpan" id="kobo.1649.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1650.1">'uuid'</span></span><span class="koboSpan" id="kobo.1651.1">)),
      </span><span class="hljs-title"><span class="koboSpan" id="kobo.1652.1">filter</span></span><span class="koboSpan" id="kobo.1653.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.1654.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1655.1">uuid</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1656.1">) =&gt;</span></span><span class="koboSpan" id="kobo.1657.1"> !!uuid),
      </span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1658.1">tap</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1659.1">(</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1660.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1661.1">uuid</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1662.1">) =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1663.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.1664.1">this</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1665.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1666.1">similarUsers$</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1667.1"> =</span></strong></span>
<span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1668.1">of</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1669.1">(</span></strong><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.1670.1">this</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1671.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1672.1">userService</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1673.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1674.1">getSimilar</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1675.1">(uuid </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1676.1">as</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-built_in-slc"><span class="koboSpan" id="kobo.1677.1">string</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1678.1">))</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1679.1">}),</span></strong></span>
<span class="hljs-title"><span class="koboSpan" id="kobo.1680.1">map</span></span><span class="koboSpan" id="kobo.1681.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.1682.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.1683.1">uuid</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.1684.1">) =&gt;</span></span><span class="koboSpan" id="kobo.1685.1"> {...})
    );
  }
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1686.1">And boom, you should be able to see both the clicked user and similar users, as follows:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1687.1"><img alt="" role="presentation" src="../Images/B18469_07_15.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1688.1">Figure 7.15: The UUID being shown in the address bar</span></p> </li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.1689.1">Great! </span><span class="koboSpan" id="kobo.1689.2">With this change, you can try refreshing</span><a id="_idIndexMarker490"/><span class="koboSpan" id="kobo.1690.1"> the app on the home page and then click any user. </span><span class="koboSpan" id="kobo.1690.2">You should see the current user as well as similar users being loaded. </span><span class="koboSpan" id="kobo.1690.3">To understand all the magic behind the recipe, see the next section.</span></p>
<h2 class="heading-2" id="_idParaDest-252"><span class="koboSpan" id="kobo.1691.1">How it works…</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1692.1">It all begins when we change our route’s path to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1693.1">user/:userId</span></code><span class="koboSpan" id="kobo.1694.1">. </span><span class="koboSpan" id="kobo.1694.2">This makes </span><code class="inlineCode"><span class="koboSpan" id="kobo.1695.1">userId</span></code><span class="koboSpan" id="kobo.1696.1"> a parameter for our route. </span><span class="koboSpan" id="kobo.1696.2">The other piece of the puzzle is to retrieve this parameter in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1697.1">UserDetailsComponent</span></code><span class="koboSpan" id="kobo.1698.1"> and then use it to get the target user, as well as similar users. </span><span class="koboSpan" id="kobo.1698.2">For that, we use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1699.1">ActivatedRoute</span></code><span class="koboSpan" id="kobo.1700.1"> service. </span><span class="koboSpan" id="kobo.1700.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1701.1">ActivatedRoute</span></code><span class="koboSpan" id="kobo.1702.1"> service holds a lot of necessary information about the current route and, therefore, we were able to fetch the current route’s </span><code class="inlineCode"><span class="koboSpan" id="kobo.1703.1">uuid</span></code><span class="koboSpan" id="kobo.1704.1"> parameter by subscribing to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1705.1">paramMap</span></code><span class="koboSpan" id="kobo.1706.1"> observable, so even if the parameter changes while staying on a user’s page, we still execute the necessary operations. </span><span class="koboSpan" id="kobo.1706.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.1707.1">ActivatedRoute</span></code><span class="koboSpan" id="kobo.1708.1"> also has a </span><code class="inlineCode"><span class="koboSpan" id="kobo.1709.1">queryParamMap</span></code><span class="koboSpan" id="kobo.1710.1"> observable, but it works for query parameters instead of route parameters. </span><span class="koboSpan" id="kobo.1710.2">And if you don’t want to subscribe to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1711.1">paramMap</span></code><span class="koboSpan" id="kobo.1712.1"> observable and just want the value to appear once inside </span><code class="inlineCode"><span class="koboSpan" id="kobo.1713.1">ngOnInit</span></code><span class="koboSpan" id="kobo.1714.1"> or in the constructor, you can also use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1715.1">snapshot</span></code><span class="koboSpan" id="kobo.1716.1"> property on the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1717.1">ActivatedRoute</span></code><span class="koboSpan" id="kobo.1718.1"> object as follows:</span></p>
<pre class="programlisting code"><code class="hljs-code"><span class="hljs-variable"><span class="koboSpan" id="kobo.1719.1">this</span></span><span class="koboSpan" id="kobo.1720.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1721.1">route</span></span><span class="koboSpan" id="kobo.1722.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1723.1">snapshot</span></span><span class="koboSpan" id="kobo.1724.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1725.1">paramMap</span></span><span class="koboSpan" id="kobo.1726.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.1727.1">get</span></span><span class="koboSpan" id="kobo.1728.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1729.1">'uuid'</span></span><span class="koboSpan" id="kobo.1730.1">);
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1731.1">Notice that with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1732.1">paramMap</span></code><span class="koboSpan" id="kobo.1733.1"> observable, we also use the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1734.1">tap</span></code><span class="koboSpan" id="kobo.1735.1"> operator to do something extra. </span><span class="koboSpan" id="kobo.1735.2">That is assigning the value of similar users to the desired observable. </span><span class="koboSpan" id="kobo.1735.3">Since both of the observables are only used in the template with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1736.1">async</span></code><span class="koboSpan" id="kobo.1737.1"> pipe, there is no need to unsubscribe them ourselves as Angular takes care of it. </span><span class="koboSpan" id="kobo.1737.2">Also, if you re-assign a new observable to a property being used by the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1738.1">async</span></code><span class="koboSpan" id="kobo.1739.1"> pipe, it automatically subscribes to the new one and cancels the previous subscription.</span></p>
<p class="normal"><span class="koboSpan" id="kobo.1740.1">Note that you can also provide</span><a id="_idIndexMarker491"/><span class="koboSpan" id="kobo.1741.1"> resolved values from the route definition directly to the component as </span><code class="inlineCode"><span class="koboSpan" id="kobo.1742.1">@Input()</span></code><span class="koboSpan" id="kobo.1743.1"> properties using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1744.1">bindToComponentInputs</span></code><span class="koboSpan" id="kobo.1745.1"> or </span><code class="inlineCode"><span class="koboSpan" id="kobo.1746.1">withComponentInputBinding</span></code><span class="koboSpan" id="kobo.1747.1"> properties introduced in v16 for the Angular Router for Angular modules and standalone components, respectively. </span><span class="koboSpan" id="kobo.1747.2">See the next section for relevant links including an article explaining the use of </span><code class="inlineCode"><span class="koboSpan" id="kobo.1748.1">withComponentInputBinding</span></code><span class="koboSpan" id="kobo.1749.1"> as well.</span></p>
<h2 class="heading-2" id="_idParaDest-253"><span class="koboSpan" id="kobo.1750.1">See also</span></h2>
<ul>
<li class="bulletList"><em class="italic"><span class="koboSpan" id="kobo.1751.1">Accessing</span></em><em class="italic"><a id="_idIndexMarker492"/></em><em class="italic"><span class="koboSpan" id="kobo.1752.1"> query parameters and fragments</span></em><span class="koboSpan" id="kobo.1753.1">: </span><a href="https://angular.io/guide/router#accessing-query-parameters-and-fragments"><span class="url"><span class="koboSpan" id="kobo.1754.1">https://angular.io/guide/router#accessing-query-parameters-and-fragments</span></span></a></li>
<li class="bulletList"><em class="italic"><span class="koboSpan" id="kobo.1755.1">Getting route</span></em><em class="italic"><a id="_idIndexMarker493"/></em><em class="italic"><span class="koboSpan" id="kobo.1756.1"> information</span></em><span class="koboSpan" id="kobo.1757.1"> – Angular docs: </span><a href="https://angular.io/guide/router#getting-route-information"><span class="url"><span class="koboSpan" id="kobo.1758.1">https://angular.io/guide/router#getting-route-information</span></span></a></li>
<li class="bulletList"><em class="italic"><span class="koboSpan" id="kobo.1759.1">Bind Route Info</span></em><em class="italic"><a id="_idIndexMarker494"/></em><em class="italic"><span class="koboSpan" id="kobo.1760.1"> to Component Inputs (New Router feature)</span></em><span class="koboSpan" id="kobo.1761.1">: </span><a href="https://itnext.io/bind-route-info-to-component-inputs-new-router-feature-1d747e559dc4"><span class="url"><span class="koboSpan" id="kobo.1762.1">https://itnext.io/bind-route-info-to-component-inputs-new-router-feature-1d747e559dc4</span></span></a></li>
</ul>
<h1 class="heading-1" id="_idParaDest-254"><span class="koboSpan" id="kobo.1763.1">Showing a global loader between route changes</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.1764.1">Building user interfaces that are snappy</span><a id="_idIndexMarker495"/><span class="koboSpan" id="kobo.1765.1"> and fast is key to winning users. </span><span class="koboSpan" id="kobo.1765.2">The apps</span><a id="_idIndexMarker496"/><span class="koboSpan" id="kobo.1766.1"> become much more enjoyable for the end users, and it could bring a lot of value to the owners/creators of the apps. </span><span class="koboSpan" id="kobo.1766.2">One of the core experiences on the modern web is to show a loader when something is happening in the background. </span><span class="koboSpan" id="kobo.1766.3">In this recipe, you’ll learn how to create a global user interface loader in your Angular app that shows whenever there is a route transition in the app.</span></p>
<h2 class="heading-2" id="_idParaDest-255"><span class="koboSpan" id="kobo.1767.1">Getting ready</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1768.1">The app that we are going to work with resides in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1769.1">start/apps/chapter07/ng-global-loader</span></code><span class="koboSpan" id="kobo.1770.1"> inside the cloned repository:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1771.1">Open the code repository in your code editor.</span></li>
<li class="numberedList"><span class="koboSpan" id="kobo.1772.1">Open the terminal, navigate to the code repository directory, and run the following command to serve the project:
        </span><pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1773.1">npm run serve ng-global-loader
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1774.1">This should open the app</span><a id="_idIndexMarker497"/><span class="koboSpan" id="kobo.1775.1"> in a new browser tab</span><a id="_idIndexMarker498"/><span class="koboSpan" id="kobo.1776.1"> and you should see the following:</span></p>
<figure class="mediaobject"><span class="koboSpan" id="kobo.1777.1"><img alt="" role="presentation" src="../Images/B18469_07_16.png"/></span></figure>
<p class="packt_figref"><span class="koboSpan" id="kobo.1778.1">Figure 7.16: ng-global-loader app running on http://localhost:4200</span></p> </li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.1779.1">Now that we have the app running locally, let’s see the steps of the recipe in the next section.</span></p>
<h2 class="heading-2" id="_idParaDest-256"><span class="koboSpan" id="kobo.1780.1">How to do it…</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.1781.1">If you try logging in or logging out, you’ll see that it takes a while before the route changes. </span><span class="koboSpan" id="kobo.1781.2">We’re simulating a delay in route change manually in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1782.1">canActivateLogin</span></code><span class="koboSpan" id="kobo.1783.1"> route guard in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1784.1">start/apps/chapter07/ng-global-loader/src/app/auth/auth.guard.ts</span></code><span class="koboSpan" id="kobo.1785.1"> file, which uses the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1786.1">delay</span></code><span class="koboSpan" id="kobo.1787.1"> operator from RxJS in an observable chain before checking if the user is logged in, and the type of user. </span><span class="koboSpan" id="kobo.1787.2">The intention is to simulate the use cases where you need to route based on an HTTP call. </span><span class="koboSpan" id="kobo.1787.3">In this recipe, we have the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1788.1">LoaderComponent</span></code><span class="koboSpan" id="kobo.1789.1"> already created, which we must use during the route changes:</span></p>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="1"><span class="koboSpan" id="kobo.1790.1">We’ll begin by adding a new property in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1791.1">app.component.ts</span></code><span class="koboSpan" id="kobo.1792.1"> that says </span><code class="inlineCode"><span class="koboSpan" id="kobo.1793.1">isRouting</span></code><span class="koboSpan" id="kobo.1794.1">. </span><span class="koboSpan" id="kobo.1794.2">We’ll initialize it as </span><code class="inlineCode"><span class="koboSpan" id="kobo.1795.1">true</span></code><span class="koboSpan" id="kobo.1796.1"> for now. </span><span class="koboSpan" id="kobo.1796.2">We’ll also import the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1797.1">LoaderComponent</span></code><span class="koboSpan" id="kobo.1798.1"> class in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1799.1">AppComponent</span></code><span class="koboSpan" id="kobo.1800.1"> class’s </span><code class="inlineCode"><span class="koboSpan" id="kobo.1801.1">imports</span></code><span class="koboSpan" id="kobo.1802.1"> so we can use it in the template. </span><span class="koboSpan" id="kobo.1802.2">Update the file as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1803.1">...
</span><span class="hljs-meta"><span class="koboSpan" id="kobo.1804.1">@Component</span></span><span class="koboSpan" id="kobo.1805.1">({
  ...
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1806.1">imports</span></span><span class="koboSpan" id="kobo.1807.1">: [</span><span class="hljs-title"><span class="koboSpan" id="kobo.1808.1">RouterModule</span></span><span class="koboSpan" id="kobo.1809.1">, </span><span class="hljs-title"><span class="koboSpan" id="kobo.1810.1">CommonModule</span></span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1811.1">, </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1812.1">LoaderComponent</span></strong></span><span class="koboSpan" id="kobo.1813.1">],
  </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1814.1">providers</span></span><span class="koboSpan" id="kobo.1815.1">: [...],
})
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1816.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1817.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1818.1">AppComponent</span></span><span class="koboSpan" id="kobo.1819.1"> {
  ...
  </span><span class="koboSpan" id="kobo.1819.2">router = </span><span class="hljs-title"><span class="koboSpan" id="kobo.1820.1">inject</span></span><span class="koboSpan" id="kobo.1821.1">(</span><span class="hljs-title"><span class="koboSpan" id="kobo.1822.1">Router</span></span><span class="koboSpan" id="kobo.1823.1">);
  </span><span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1824.1">isRouting = </span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.1825.1">true</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1826.1">;</span></strong></span><span class="koboSpan" id="kobo.1827.1">
  ...
</span><span class="koboSpan" id="kobo.1827.2">}
</span></code></pre>
</li>
<li class="numberedList"><span class="koboSpan" id="kobo.1828.1">Now we’ll add the loader </span><a id="_idIndexMarker499"/><span class="koboSpan" id="kobo.1829.1">in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1830.1">app.component.html</span></code><span class="koboSpan" id="kobo.1831.1"> to show</span><a id="_idIndexMarker500"/><span class="koboSpan" id="kobo.1832.1"> it conditionally, and we’ll wrap the entire app content in another variable. </span><span class="koboSpan" id="kobo.1832.2">Update the file as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-tag"><span class="koboSpan" id="kobo.1833.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1834.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1835.1"> *</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1836.1">ngIf</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1837.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1838.1">"isRouting; else app"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1839.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1840.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1841.1">"loader-container</span></span>
<span class="hljs-tag"> </span><span class="hljs-string"><span class="koboSpan" id="kobo.1842.1"> fixed w-full h-full flex items-center justify-center "</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1843.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1844.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1845.1">app-loader</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1846.1">&gt;&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1847.1">app-loader</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1848.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1849.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1850.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1851.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1852.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1853.1">ng-template</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1854.1"> #</span></span><span class="hljs-attr"><span class="koboSpan" id="kobo.1855.1">app</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1856.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1857.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1858.1">div</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1859.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1860.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1861.1">"toolbar"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1862.1">role</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1863.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1864.1">"banner"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1865.1">&gt;</span></span><span class="koboSpan" id="kobo.1866.1">...</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1867.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1868.1">div</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1869.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1870.1">&lt;</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1871.1">main</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1872.1">class</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1873.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1874.1">"content"</span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="koboSpan" id="kobo.1875.1">role</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1876.1">=</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1877.1">"main"</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1878.1">&gt;</span></span><span class="koboSpan" id="kobo.1879.1">...</span><span class="hljs-tag"><span class="koboSpan" id="kobo.1880.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1881.1">main</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1882.1">&gt;</span></span>
<span class="hljs-tag"><span class="koboSpan" id="kobo.1883.1">&lt;/</span></span><span class="hljs-name"><span class="koboSpan" id="kobo.1884.1">ng-template</span></span><span class="hljs-tag"><span class="koboSpan" id="kobo.1885.1">&gt;</span></span>
</code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1886.1">You should be able to see the loader consistently on the screen now, on every route. </span><span class="koboSpan" id="kobo.1886.2">However, we want to make it work with the Angular Router.</span></p> </li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="3"><span class="koboSpan" id="kobo.1887.1">We’ll now update the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1888.1">app.component.ts</span></code><span class="koboSpan" id="kobo.1889.1"> file to listen to the router service’s </span><code class="inlineCode"><span class="koboSpan" id="kobo.1890.1">events</span></code><span class="koboSpan" id="kobo.1891.1"> property, and take an action upon the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1892.1">NavigationStart</span></code><span class="koboSpan" id="kobo.1893.1"> event. </span><span class="koboSpan" id="kobo.1893.2">Modify the code in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1894.1">app.component.ts</span></code><span class="koboSpan" id="kobo.1895.1"> file as follows:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1896.1">import</span></span><span class="koboSpan" id="kobo.1897.1"> { </span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1898.1">NavigationStart</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1899.1">,</span></strong></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1900.1">Router</span></span><span class="koboSpan" id="kobo.1901.1">, </span><span class="hljs-title"><span class="koboSpan" id="kobo.1902.1">RouterModule</span></span><span class="koboSpan" id="kobo.1903.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1904.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1905.1">'@angular/router'</span></span><span class="koboSpan" id="kobo.1906.1">;
...
</span><span class="hljs-meta"><span class="koboSpan" id="kobo.1907.1">@Component</span></span><span class="koboSpan" id="kobo.1908.1">({...})
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1909.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1910.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1911.1">AppComponent</span></span><span class="koboSpan" id="kobo.1912.1"> {
  </span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1913.1">constructor</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1914.1">() {</span></strong></span>
<span class="code-highlight"><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.1915.1">this</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1916.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1917.1">router</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1918.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1919.1">events</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1920.1">.</span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1921.1">subscribe</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1922.1">(</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1923.1">(</span></strong><strong class="hljs-params-slc"><span class="koboSpan" id="kobo.1924.1">event</span></strong><strong class="hljs-function-slc"><span class="koboSpan" id="kobo.1925.1">) =&gt;</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1926.1"> {</span></strong></span>
<span class="code-highlight"><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1927.1">if</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1928.1"> (event </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.1929.1">instanceof</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1930.1">NavigationStart</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1931.1">) {</span></strong></span>
<span class="code-highlight"><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.1932.1">this</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1933.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.1934.1">isRouting</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1935.1"> = </span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.1936.1">true</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1937.1">;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1938.1">}</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1939.1">})</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.1940.1">}</span></strong></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1941.1">get</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1942.1">isLoggedIn</span></span><span class="koboSpan" id="kobo.1943.1">() {...}
}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.1944.1">If you refresh the app, you’ll notice that </span><code class="inlineCode"><span class="koboSpan" id="kobo.1945.1">&lt;app-loader&gt;</span></code><span class="koboSpan" id="kobo.1946.1"> still never goes away. </span><span class="koboSpan" id="kobo.1946.2">That’s because we’re not marking the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1947.1">isRouting</span></code><span class="koboSpan" id="kobo.1948.1"> property as </span><code class="inlineCode"><span class="koboSpan" id="kobo.1949.1">false</span></code><span class="koboSpan" id="kobo.1950.1"> anywhere.</span></p></li>
</ol>
<ol class="numberedList" style="list-style-type: decimal;">
<li class="numberedList" value="4"><span class="koboSpan" id="kobo.1951.1">To mark </span><code class="inlineCode"><span class="koboSpan" id="kobo.1952.1">isRouting</span></code><span class="koboSpan" id="kobo.1953.1"> as </span><code class="inlineCode"><span class="koboSpan" id="kobo.1954.1">false</span></code><span class="koboSpan" id="kobo.1955.1">, we need</span><a id="_idIndexMarker501"/><span class="koboSpan" id="kobo.1956.1"> to check for three different</span><a id="_idIndexMarker502"/><span class="koboSpan" id="kobo.1957.1"> events: </span><code class="inlineCode"><span class="koboSpan" id="kobo.1958.1">NavigationEnd</span></code><span class="koboSpan" id="kobo.1959.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1960.1">NavigationError</span></code><span class="koboSpan" id="kobo.1961.1">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.1962.1">NavigationCancel</span></code><span class="koboSpan" id="kobo.1963.1">. </span><span class="koboSpan" id="kobo.1963.2">Let’s add some more logic to handle these three events and mark the property as </span><code class="inlineCode"><span class="koboSpan" id="kobo.1964.1">false</span></code><span class="koboSpan" id="kobo.1965.1">:
        </span><pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1966.1">...
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1967.1">import</span></span><span class="koboSpan" id="kobo.1968.1"> { </span><span class="code-highlight"><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1969.1">NavigationCancel</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1970.1">, </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1971.1">NavigationEnd</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1972.1">, </span></strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.1973.1">NavigationError</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.1974.1">,</span></strong></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1975.1">NavigationStart</span></span><span class="koboSpan" id="kobo.1976.1">, </span><span class="hljs-title"><span class="koboSpan" id="kobo.1977.1">Router</span></span><span class="koboSpan" id="kobo.1978.1">, </span><span class="hljs-title"><span class="koboSpan" id="kobo.1979.1">RouterModule</span></span><span class="koboSpan" id="kobo.1980.1"> } </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1981.1">from</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1982.1">'@angular/router'</span></span><span class="koboSpan" id="kobo.1983.1">;
...
</span><span class="hljs-meta"><span class="koboSpan" id="kobo.1984.1">@Component</span></span><span class="koboSpan" id="kobo.1985.1">({...})
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1986.1">export</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1987.1">class</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1988.1">AppComponent</span></span><span class="koboSpan" id="kobo.1989.1"> {
  ...
  </span><span class="koboSpan" id="kobo.1989.2">isRouting = </span><span class="code-highlight"><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.1990.1">false</span></strong></span><span class="koboSpan" id="kobo.1991.1">;
  </span><span class="hljs-title"><span class="koboSpan" id="kobo.1992.1">constructor</span></span><span class="koboSpan" id="kobo.1993.1">() {
    </span><span class="hljs-variable"><span class="koboSpan" id="kobo.1994.1">this</span></span><span class="koboSpan" id="kobo.1995.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1996.1">router</span></span><span class="koboSpan" id="kobo.1997.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.1998.1">events</span></span><span class="koboSpan" id="kobo.1999.1">.</span><span class="hljs-title"><span class="koboSpan" id="kobo.2000.1">subscribe</span></span><span class="koboSpan" id="kobo.2001.1">(</span><span class="hljs-function"><span class="koboSpan" id="kobo.2002.1">(</span></span><span class="hljs-params"><span class="koboSpan" id="kobo.2003.1">event</span></span><span class="hljs-function"><span class="koboSpan" id="kobo.2004.1">) =&gt;</span></span><span class="koboSpan" id="kobo.2005.1"> {
      </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2006.1">if</span></span><span class="koboSpan" id="kobo.2007.1"> (event </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.2008.1">instanceof</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.2009.1">NavigationStart</span></span><span class="koboSpan" id="kobo.2010.1">) {
        </span><span class="hljs-variable"><span class="koboSpan" id="kobo.2011.1">this</span></span><span class="koboSpan" id="kobo.2012.1">.</span><span class="hljs-property"><span class="koboSpan" id="kobo.2013.1">isRouting</span></span><span class="koboSpan" id="kobo.2014.1"> = </span><span class="hljs-literal"><span class="koboSpan" id="kobo.2015.1">true</span></span><span class="koboSpan" id="kobo.2016.1">;
      }</span><span class="code-highlight"><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2017.1">else</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2018.1">if</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2019.1"> (</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2020.1">event </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2021.1">instanceof</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2022.1">NavigationEnd</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2023.1"> ||</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2024.1">event </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2025.1">instanceof</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2026.1">NavigationError</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2027.1"> ||</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2028.1">event </span></strong><strong class="hljs-keyword-slc"><span class="koboSpan" id="kobo.2029.1">instanceof</span></strong><strong class="hljs-slc"> </strong><strong class="hljs-title-slc"><span class="koboSpan" id="kobo.2030.1">NavigationCancel</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2031.1">) {</span></strong></span>
<span class="code-highlight"><strong class="hljs-variable-slc"><span class="koboSpan" id="kobo.2032.1">this</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2033.1">.</span></strong><strong class="hljs-property-slc"><span class="koboSpan" id="kobo.2034.1">isRouting</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2035.1"> = </span></strong><strong class="hljs-literal-slc"><span class="koboSpan" id="kobo.2036.1">false</span></strong><strong class="hljs-slc"><span class="koboSpan" id="kobo.2037.1">;</span></strong></span>
<span class="code-highlight"><strong class="hljs-slc"><span class="koboSpan" id="kobo.2038.1">}</span></strong></span><span class="koboSpan" id="kobo.2039.1">
    })
  }
  ...
</span><span class="koboSpan" id="kobo.2039.2">}
</span></code></pre>
<p class="normal"><span class="koboSpan" id="kobo.2040.1">We now have a global loader that shows during the route navigation among different pages.</span></p></li>
</ol>
<p class="normal"><span class="koboSpan" id="kobo.2041.1">Congrats on finishing the recipe. </span><span class="koboSpan" id="kobo.2041.2">You now can implement a global loader in Angular apps, which will show from the navigation start to the navigation end.</span></p>
<h2 class="heading-2" id="_idParaDest-257"><span class="koboSpan" id="kobo.2042.1">How it works…</span></h2>
<p class="normal"><span class="koboSpan" id="kobo.2043.1">The router service is a very powerful service in Angular. </span><span class="koboSpan" id="kobo.2043.2">It has a lot of methods as well as observables that we can use for different tasks in our apps. </span><span class="koboSpan" id="kobo.2043.3">For this recipe, we used the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2044.1">events</span></code><span class="koboSpan" id="kobo.2045.1"> observable. </span><span class="koboSpan" id="kobo.2045.2">By subscribing to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2046.1">events</span></code><span class="koboSpan" id="kobo.2047.1"> observable, we can listen to all the events that the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2048.1">Router</span></code><span class="koboSpan" id="kobo.2049.1"> service emits through</span><a id="_idIndexMarker503"/><span class="koboSpan" id="kobo.2050.1"> the observable. </span><span class="koboSpan" id="kobo.2050.2">One of the most common use cases for this (especially being a </span><strong class="keyWord"><span class="koboSpan" id="kobo.2051.1">Single-Page Application</span></strong><span class="koboSpan" id="kobo.2052.1"> (</span><strong class="keyWord"><span class="koboSpan" id="kobo.2053.1">SPA</span></strong><span class="koboSpan" id="kobo.2054.1">)) is tracking page visits with Google Analytics or Mixpanel. </span><span class="koboSpan" id="kobo.2054.2">For this recipe, we were only interested in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2055.1">NavigationStart</span></code><span class="koboSpan" id="kobo.2056.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.2057.1">NavigationEnd</span></code><span class="koboSpan" id="kobo.2058.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.2059.1">NavigationError</span></code><span class="koboSpan" id="kobo.2060.1">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.2061.1">NavigationCancel</span></code><span class="koboSpan" id="kobo.2062.1"> events. </span><span class="koboSpan" id="kobo.2062.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.2063.1">NavigationStart</span></code><span class="koboSpan" id="kobo.2064.1"> event is emitted when the router starts navigation. </span><span class="koboSpan" id="kobo.2064.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.2065.1">NavigationEnd</span></code><span class="koboSpan" id="kobo.2066.1"> event is emitted when the navigation ends successfully. </span><span class="koboSpan" id="kobo.2066.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.2067.1">NavigationCancel</span></code><span class="koboSpan" id="kobo.2068.1"> event is emitted when the navigation is canceled due to a route guard returning </span><code class="inlineCode"><span class="koboSpan" id="kobo.2069.1">false</span></code><span class="koboSpan" id="kobo.2070.1">, or redirects by using </span><code class="inlineCode"><span class="koboSpan" id="kobo.2071.1">UrlTree</span></code><span class="koboSpan" id="kobo.2072.1"> due to some reason. </span><span class="koboSpan" id="kobo.2072.2">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.2073.1">NavigationError</span></code><span class="koboSpan" id="kobo.2074.1"> event is emitted when there’s an error due to any reason during the navigation. </span><span class="koboSpan" id="kobo.2074.2">All of these events are of the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2075.1">Event</span></code><span class="koboSpan" id="kobo.2076.1"> type and we can identify the type of the event by checking whether it is an instance of the target event, using the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2077.1">instanceof</span></code><span class="koboSpan" id="kobo.2078.1"> keyword. </span><span class="koboSpan" id="kobo.2078.2">Notice that since we had the subscription to the </span><code class="inlineCode"><span class="koboSpan" id="kobo.2079.1">Router.events</span></code><span class="koboSpan" id="kobo.2080.1"> property in </span><code class="inlineCode"><span class="koboSpan" id="kobo.2081.1">AppComponent</span></code><span class="koboSpan" id="kobo.2082.1">, we didn’t have to worry about unsubscribing the subscription because there’s only one subscription in</span><a id="_idIndexMarker504"/><span class="koboSpan" id="kobo.2083.1"> the app, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.2084.1">AppComponent</span></code><span class="koboSpan" id="kobo.2085.1"> will not be destroyed throughout the life cycle </span><a id="_idIndexMarker505"/><span class="koboSpan" id="kobo.2086.1">of the app.</span></p>
<h2 class="heading-2" id="_idParaDest-258"><span class="koboSpan" id="kobo.2087.1">See also</span></h2>
<ul>
<li class="bulletList"><span class="koboSpan" id="kobo.2088.1">Router events</span><a id="_idIndexMarker506"/><span class="koboSpan" id="kobo.2089.1"> docs: </span><a href="https://angular.io/guide/router#router-events"><span class="url"><span class="koboSpan" id="kobo.2090.1">https://angular.io/guide/router#router-events</span></span></a></li>
<li class="bulletList"><span class="koboSpan" id="kobo.2091.1">Router service</span><a id="_idIndexMarker507"/><span class="koboSpan" id="kobo.2092.1"> docs: </span><a href="https://angular.io/api/router/Router"><span class="url"><span class="koboSpan" id="kobo.2093.1">https://angular.io/api/router/Router</span></span></a></li>
</ul>
<h1 class="heading-1"><span class="koboSpan" id="kobo.2094.1">Learn more on Discord</span></h1>
<p class="normal"><span class="koboSpan" id="kobo.2095.1">To join the Discord community for this book – where you can share feedback, ask questions to the author, and learn about new releases – follow the QR code below:</span></p>
<p class="normal"><a href="Chapter_7.xhtml"><span class="url"><span class="koboSpan" id="kobo.2096.1">https://packt.link/AngularCookbook2e</span></span></a></p>
<p class="normal"><span class="koboSpan" id="kobo.2097.1"><img alt="" role="presentation" src="../Images/QR_Code1388317275422265.png"/></span></p>
</div>
</body></html>